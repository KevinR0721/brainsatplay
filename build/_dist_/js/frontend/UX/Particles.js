var p=Object.defineProperty;var l=(o,t,s)=>(typeof t!="symbol"&&(t+=""),t in o?p(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s);export class Particles{constructor(t=100,s=!0,r=void 0,c=void 0){l(this,"updateParticle",t=>{if(this.particles[t].x+=this.particles[t].vx+this.particles[t].vx*this.frameRate,this.particles[t].y+=this.particles[t].vy+this.particles[t].vx*this.frameRate,this.particles[t].vx>this.settings.maxSpeed||this.particles[t].vy>this.settings.maxSpeed||this.particles[t].vx<-this.settings.maxSpeed||this.particles[t].vy<-this.settings.maxSpeed){var s=this.normalize2D([this.particles[t].vx,this.particles[t].vy]);this.particles[t].vx=s[0]*this.settings.maxSpeed,this.particles[t].vy=s[1]*this.settings.maxSpeed}this.particles[t].y+this.settings.particleSize>this.settings.groundLevel&&(this.particles[t].vy*=this.settings.yBounce,this.particles[t].vx*=-this.settings.xBounce,this.particles[t].y=this.settings.groundLevel-this.settings.particleSize),this.particles[t].y-this.settings.particleSize<this.settings.ceilingWall&&(this.particles[t].vy*=this.settings.yBounce,this.particles[t].vx*=-this.settings.xBounce,this.particles[t].y=this.settings.ceilingWall+this.settings.particleSize),this.particles[t].x-this.settings.particleSize<=this.settings.leftWall&&(this.particles[t].vx*=this.settings.xBounce,this.particles[t].x=this.settings.leftWall+this.settings.particleSize),this.particles[t].x+this.settings.particleSize>=this.settings.rightWall&&(this.particles[t].vx*=this.settings.xBounce,this.particles[t].x=this.settings.rightWall-this.settings.particleSize),this.particles[t].vy+=this.settings.gravity,this.particles[t].life++,this.particles[t].life>=this.particles[t].maxLife&&this.particles.splice(t,1)});l(this,"animate",()=>{this.settings.velocityFunc!==void 0&&this.settings.velocityFunc(),this.draw(),setTimeout(()=>{this.animationId=requestAnimationFrame(this.animate)},16)});l(this,"draw",()=>{if(this.settings.startingX=Math.random()*this.canvas.width,this.settings.startingY=Math.random()*this.canvas.height,this.settings.groundLevel=this.canvas.height*.999,this.settings.ceilingLevel=this.canvas.height*.001,this.settings.rightWall=this.canvas.width*.999,this.settings.leftWall=this.canvas.height*.001,this.lastFrame=this.thisFrame,this.thisFrame=performance.now(),this.frameRate=(this.thisFrame-this.lastFrame)*.001,this.context.fillStyle="rgba(10,10,10,0.8)",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="red",this.context.fillRect(0,0,this.settings.leftWall,this.canvas.height),this.context.fillRect(this.settings.rightWall,0,this.canvas.width,this.canvas.height),this.context.fillRect(0,this.settings.groundLevel,this.canvas.width,this.canvas.height),this.context.fillRect(0,0,this.canvas.width,this.settings.ceilingWall),this.particles.length<this.settings.maxParticles)for(;this.particles.length<this.settings.maxParticles;)this.genParticle();for(var t in this.particles)this.updateParticle(t),this.context.clearRect(this.settings.leftWall,this.settings.groundLevel,this.canvas.width,this.canvas.height),this.context.beginPath(),this.context.fillStyle="rgb("+String(Math.abs(this.particles[t].vx)*75)+","+String(Math.abs(this.particles[t].vy)*25)+","+String(255-Math.abs(this.particles[t].vx)*75)+")",this.context.arc(this.particles[t].x,this.particles[t].y,this.settings.particleSize,0,Math.PI*2,!0),this.context.closePath(),this.context.fill()});if(this.canvasId=r,this.canvas=null,this.context=null,this.animationId=null,this.lastFrame=0,this.thisFrame=0,this.frameRate=1,this.randomSeed=s,this.particles=[],this.particleIndex=0,this.settings={maxParticles:t,particleSize:5,startingX:Math.random()*100,startingY:Math.random()*100,maxSpeed:3,xBounce:-1,yBounce:-1,gravity:0,maxLife:Infinity,groundLevel:200*.999,leftWall:200*.001,rightWall:200*.999,ceilingWall:200*.001,velocityFunc:c},this.seedsX=[],this.seedsY=[],this.currentAngle=0,this.randomSeed&&this.seedAngles(),this.canvasId&&(this.canvas=document.getElementById(this.canvasId),this.context=this.canvas.getContext("2d"),this.settings.startingX=Math.random()*this.canvas.width,this.settings.startingY=Math.random()*this.canvas.height,this.settings.groundLevel=this.canvas.height*.999,this.settings.ceilingLevel=this.canvas.height*.001,this.settings.rightWall=this.canvas.width*.999,this.settings.leftWall=this.canvas.height*.001),this.particles.length<this.settings.maxParticles)for(;this.particles.length<this.settings.maxParticles;)this.genParticle();r&&this.draw()}seedAngles(){this.seedsX=[],this.seedsY=[];for(var t=0;t<this.settings.maxParticles;t++)this.seedsX.push(Math.random()*20-10),this.seedsY.push(Math.random()*30-10)}genParticle(){if(this.particleIndex!==this.settings.maxParticles){var t={};t.x=this.settings.startingX,t.y=this.settings.startingY,t.vx=0,t.vy=0,this.randomSeed===!0&&(t.vx=this.seedsX[this.currentAngle],t.vy=this.seedsY[this.currentAngle],this.currentAngle++),t.id=this.particleIndex,t.life=0,t.maxLife=this.settings.maxLife,this.particles[this.particleIndex]=t,this.particleIndex++}else this.randomSeed===!0&&(this.seedAngles(),this.currentAngle=0),this.particleIndex=0}normalize2D(t=[]){var s=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2));return[t[0]/s,t[1]/s]}stop(){cancelAnimationFrame(this.animationId)}}export class Boids{constructor(t=200,s=void 0){l(this,"init",()=>{if(this.particleClass=new Particles(this.boidsCount,!0,this.canvasId),this.canvasId!==void 0){this.swirlAnchor=[this.particleClass.canvas.width*.45,this.particleClass.canvas.height*.5,0],this.attractorAnchor=this.swirlAnchor;for(var t=0;t<this.boidsCount;t++)this.boidsPos[t]=[this.particleClass.particles[t].x,this.particleClass.particles[t].y,Math.random()],this.boidsVel[t]=[Math.random()*.01,Math.random()*.01,Math.random()*.01];this.particleClass.animate(),this.animate()}});l(this,"reinit",()=>{this.stop(),this.init()});l(this,"start",()=>{this.canvasId!==void 0&&this.particleClass.animate(),this.animate()});l(this,"stop",()=>{cancelAnimationFrame(this.animationId),this.particleClass.stop()});l(this,"calcBoids",()=>{for(var t=[],s=0;s<this.boidsCount;s++){var r=[],c=[],h=this.boidsPos[s],i=[0,0,0],e=this.boidsVel[s],n=0;t:for(var v=0;v<this.boidsCount;v++){var a=Math.floor(Math.random()*this.boidsCount);if(a!==s){if(c.length>this.groupingSize)break t;var d=this.distance3D(this.boidsPos[s],this.boidsPos[a]);d>this.groupingRadius||(c.push(d),r.push(a),h=[h[0]+this.boidsPos[a][0],h[1]+this.boidsPos[a][1],h[2]+this.boidsPos[a][2]],i=[i[0]+(this.boidsPos[s][0]-this.boidsPos[a][0])*(1/d),i[1]+this.boidsPos[s][1]-this.boidsPos[a][1]*(1/d),i[2]+(this.boidsPos[s][2]-this.boidsPos[a][2]+1)*(1/d)],(i[0]==Infinity||i[0]==-Infinity||i[0]>3||i[0]<-3||i[1]==Infinity||i[1]==-Infinity||i[1]>3||i[1]<-3||i[2]==Infinity||i[2]==-Infinity||i[2]>3||i[2]<-3)&&(i=[Math.random()*4-2,Math.random()*4-2,Math.random()*4-2]),e=[e[0]+this.boidsVel[a][0],e[1]+this.boidsVel[a][1],e[2]+this.boidsVel[a][2]],n++)}}h=[this.cohesionMul*(h[0]/n-this.boidsPos[s][0]),this.cohesionMul*(h[1]/n-this.boidsPos[s][1]),this.cohesionMul*(h[2]/n-this.boidsPos[s][2])],e=[-(this.alignmentMul*e[1]/n),this.alignmentMul*e[0]/n,this.alignmentMul*e[2]/n],i=[this.separationMul*i[0],this.separationMul*i[1],this.separationMul*i[2]];var g=[0,0,0];this.useSwirl==!0&&(g=[-(this.boidsPos[s][1]-this.swirlAnchor[1])*this.swirlMul,(this.boidsPos[s][0]-this.swirlAnchor[0])*this.swirlMul,(this.boidsPos[s][2]-this.swirlAnchor[2])*this.swirlMul]);var u=[0,0,0];this.useAttractor==!0&&(u=[(this.attractorAnchor[0]-this.boidsPos[s][0])*this.attractorMul,(this.attractorAnchor[1]-this.boidsPos[s][1])*this.attractorMul,(this.attractorAnchor[2]-this.boidsPos[s][2])*this.attractorMul]),t.push([this.boidsVel[s][0]*this.dragMul+h[0]+e[0]+i[0]+g[0]+u[0],this.boidsVel[s][1]*this.dragMul+h[1]+e[1]+i[1]+g[1]+u[1],this.boidsVel[s][2]*this.dragMul+h[2]+e[2]+i[2]+g[2]+u[1]])}return t.length==this.boidsCount?(this.boidsVel=t,!0):!1});l(this,"animate",()=>{this.updateParticles(),setTimeout(()=>{this.animationId=requestAnimationFrame(this.animate)},20)});l(this,"updateParticles",()=>{var t=this.calcBoids();if(t==!0){var s=performance.now()*5e-5;if(this.canvasId)var r=[Math.sin(s)*Math.sin(s)*this.particleClass.canvas.width*.3+this.particleClass.canvas.width*.2,this.particleClass.canvas.height*.3,0];this.swirlAnchor=r,this.attractorAnchor=r,this.lastFrame=this.thisFrame,this.thisFrame=performance.now(),this.frameRate=(this.thisFrame-this.lastFrame)*.001,this.boidsPos.forEach((c,h)=>{h<=this.particleClass.particles.length&&(this.particleClass.particles[h].vx+=this.boidsVel[h][0]*this.frameRate*this.boidsMul,this.particleClass.particles[h].vy+=this.boidsVel[h][1]*this.frameRate*this.boidsMul,this.particleClass.animationId===null&&this.particleClass.updateParticle(h)),this.boidsPos[h][0]=this.particleClass.particles[h].x,this.boidsPos[h][1]=this.particleClass.particles[h].y})}});this.boidsCount=t,this.boidsPos=new Array(t).fill([0,0,0]),this.boidsVel=new Array(t).fill([0,0,0]),this.groupingSize=10,this.groupingRadius=1e4,this.boidsMul=1,this.dragMul=.1,this.cohesionMul=.01,this.alignmentMul=.5,this.separationMul=3,this.swirlMul=5e-4,this.attractorMul=.003,this.useAttractor=!0,this.useSwirl=!0,this.attractorAnchor=[.5,.5,0],this.swirlAnchor=[.5,.5,0],this.boundingBox,this.animationId=null,this.lastFrame=0,this.thisFrame=0,this.frameRate=0,this.canvasId=s,this.particleClass=null,this.init()}distance3D(t,s){return Math.sqrt(Math.pow(s[0]-t[0],2)+Math.pow(s[1]-t[1],2)+Math.pow(s[2]-t[2],2))}shuffleArr(t){for(var s=[];t.length>0;){var r=Math.floor(Math.random()*t.length);s.push(t[r])}return s}onData(t){this.swirlMul+=t*3e-4,this.swirlMul<0?this.swirlMul=0:this.swirlMul>.001&&(this.swirlMul=.01)}}
