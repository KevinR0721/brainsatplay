var f=Object.defineProperty;var p=(n,e,o)=>(typeof e!="symbol"&&(e+=""),e in n?f(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o);export class SoundJS{constructor(){p(this,"finishedLoading",e=>{e.forEach(o=>{this.sourceList.push(this.ctx.createBufferSource());var s=this.sourceList.length-1;this.sourceList[s].buffer=o,this.sourceList[s].onended=()=>{this.sourceList.splice(s,1)},this.sourceList[s].connect(this.gainNode)})});window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,this.ctx=null;try{this.ctx=new AudioContext}catch(e){alert("Your browser does not support AudioContext!"),console.log(e)}this.sourceList=[],this.recordedData=[],this.recorder=null,this.buffer=[],this.osc=[],this.gainNode=this.ctx.createGain(),this.analyserNode=this.ctx.createAnalyser(),this.out=this.ctx.destination,this.gainNode.connect(this.analyserNode),this.analyserNode.connect(this.out)}playFreq(e=[1e3],o=0,s="sine",i=this.ctx.currentTime){e.forEach(r=>{var t=this.osc.length;this.osc[t]=this.ctx.createOscillator(),this.osc[t].start(),this.osc[t].onended=()=>{this.osc.splice(t,1)},this.osc[t].type=s,this.osc[t].connect(this.gainNode),this.osc[t].frequency.setValueAtTime(r,i),o!=0&&this.osc[t].stop(i+o)})}stopFreq(e=0,o=1,s=0){for(var i=e;i<o;i++)this.osc[oscIndex]?this.osc[oscIndex].stop(this.ctx.currentTime+s):console.log("No oscillator found.")}addSounds(e=[""]){var o=new BufferLoader(this.ctx,e,this.finishedLoading);o.load()}playSound(e,o=0,s=!1,i=this.ctx.currentTime){s===!0&&(this.sourceList[e].loop=!0),this.sourceList[e].start(i),o!==0&&this.sourceList[e].stop(i+o)}stopSound(e){this.sourceList[e].stop(0)}setPlaybackRate(e,o){this.sourceList[e].playbackRate.value=o}record(e=new Date().toISOString(),o={audio:!0,video:!1},s=null,i=null){var r=null,t=null,c=s;c===null&&(o.video!==!1?c=["video/webm","video/webm;codecs=vp8","video/webm;codecs=vp9","video/webm;codecs=vp8.0","video/webm;codecs=vp9.0","video/webm;codecs=h264","video/webm;codecs=H264","video/webm;codecs=avc1","video/webm;codecs=vp8,opus","video/WEBM;codecs=VP8,OPUS","video/webm;codecs=vp9,opus","video/webm;codecs=vp8,vp9,opus","video/webm;codecs=h264,opus","video/webm;codecs=h264,vp9,opus","video/x-matroska;codecs=avc1"]:o.audio===!0&&(c=["audio/wav","audio/mp3","audio/webm","audio/webm;codecs=opus","audio/webm;codecs=pcm","audio/ogg","audio/x-matroska"]));for(var d=0;d<c.length;d++)if(MediaRecorder.isTypeSupported(c[d])===!0){r=c[d],console.log("Supported type: ",r),c[d].indexOf("webm")!==-1&&(t=".webm"),c[d].indexOf("ogg")!==-1&&(t=".ogg"),c[d].indexOf("mp3")!==-1&&(t=".mp3"),c[d].indexOf("wav")!==-1&&(t=".wav"),c[d].indexOf("x-matroska")!==-1&&(t=".mkv");break}if(r!==null){let v=function(u){console.log(u)};navigator.mediaDevices.getUserMedia(o).then(u=>{console.log("Media stream created."),i!==null&&(i.src=window.URL.createObjectURL(u)),this.recorder=new MediaRecorder(u),this.recorder.onstop=l=>{console.log("Media recorded, saving...");var w=new Blob(this.recordedData,{type:r}),h=URL.createObjectURL(w),a=document.createElement("a");document.body.appendChild(a),a.style="display: none",a.href=h,a.download=e+t,a.click(),window.URL.revokeObjectURL(h)},this.recorder.ondataavailable=l=>{this.recordedData.push(l.data)},this.recorder.start()},v)}else alert("Cannot record! Check function call settings, ensure browser is compatible.")}replayRecording(e){this.recordedData.length>1&&(this.buffer=new Blob(this.recordedData),e.src=window.URL.createObjectURL(buffer))}}
