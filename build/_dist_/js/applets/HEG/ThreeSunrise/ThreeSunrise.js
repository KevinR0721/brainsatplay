var k=Object.defineProperty;var u=(c,i,s)=>(typeof i!="symbol"&&(i+=""),i in c?k(c,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[i]=s);import{brainsatplay as W}from"../../../brainsatplay.js";import{DOMFragment as j}from"../../../frontend/utils/DOMFragment.js";import*as e from"../../../../../_snowpack/pkg/three.js";import*as o from"../../../../../_snowpack/pkg/postprocessing.js";import B from"./textures/8k_earth_daymap.jpg.proxy.js";import R from"./textures/clouds_8k.jpg.proxy.js";import _ from"./textures/moon_4k.jpg.proxy.js";import C from"./textures/8k_earth_nightmap.jpg.proxy.js";import G from"./textures/8k_earth_specular_map.tif.proxy.js";export class ThreeSunriseApplet{constructor(i=document.body,s=new W,h=[]){u(this,"render",()=>{if(this.bci.atlas.settings.heg){let s=this.bci.atlas.data.heg[0].count;if(s>=2){let h=40;s<h&&(h=s);let l=this.bci.atlas.data.heg[0].ratio.slice(s-h),m=this.bci.atlas.data.heg[0].ratio[s-1]-this.mean(l);this.onData(m),this.draw()}}this.threeWidth!==this.AppletHTML.node.clientWidth&&(this.threeWidth=this.AppletHTML.node.clientWidth,this.renderer.setPixelRatio(this.threeWidth/this.AppletHTML.node.clientHeight),this.renderer.setSize(this.threeWidth,this.AppletHTML.node.clientHeight),this.composer.setSize(this.threeWidth,this.AppletHTML.node.clientHeight),this.camera.aspect=this.threeWidth/this.AppletHTML.node.clientHeight,this.camera.updateProjectionMatrix()),this.ticks-=this.change*1e3,this.sphereMesh.rotation.y+=this.change*.25,this.cloudMesh.rotation.y=this.sphereMesh.rotation.y,this.points.rotation.y-=this.change;var i=(this.ticks+2900)*.001;this.pointLight.position.x=Math.sin(i)*40,this.pointLight.position.z=Math.cos(i)*40,this.redpointLight.position.x=Math.sin(i-.15)*40,this.redpointLight.position.z=Math.cos(i-.15)*40,this.redpointLight2.position.x=Math.sin(i+.15)*40,this.redpointLight2.position.z=Math.cos(i+.15)*40,this.sunMesh.position.x=Math.sin(i)*40,this.sunMesh.position.z=Math.cos(i)*40,this.moonMesh.position.x=Math.sin(i*1.05+.83)*30,this.moonMesh.position.z=Math.cos(i*1.05+.83)*30,this.composer.render(),setTimeout(()=>{this.threeAnim=requestAnimationFrame(this.render)},15)});this.bci=s,this.parentNode=i,this.settings=h,this.AppletHTML=null,this.props={id:String(Math.floor(Math.random()*1e6))},this.scene,this.renderer,this.camera,this.composer,this.points,this.sunMesh,this.sphereMesh,this.cloudMesh,this.pointLight,this.redpointLight,this.redpointLight2,this.godrayeffect,this.bloomEffect,this.bloompass,this.renderPass,this.godraypass,this.begin=0,this.ticks=0,this.change=15e-5,this.threeAnim,this.threeWidth=100}init(){let i=(h=this.props)=>`
            <div id='`+h.id+`'>
                <div id="`+h.id+`threeContainer"></div>
            </div>
            `,s=(h=this.props)=>{this.scene=new e.Scene,this.camera=new e.PerspectiveCamera(75,400/435,.1,1e3),this.camera.position.x=1.5,this.camera.position.y=.5,this.camera.position.z=2,this.camera.rotation.x=-.3,this.camera.rotation.y=-.2,this.camera.rotation.z=-.2,this.renderer=new e.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,document.getElementById(h.id+"threeContainer").appendChild(this.renderer.domElement);for(var l=5e3,m=[],p=0;p<l;p++){var L=e.Math.randFloatSpread(500),y=e.Math.randFloatSpread(1e3),v=e.Math.randFloatSpread(1500);m.push(L,y,v)}var g=new e.BufferGeometry;g.setAttribute("position",new e.Float32BufferAttribute(m,3));for(var t=new e.Color,n=[],p=0;p<l;p++){var r=Math.random();r<=.15?(t.set("skyblue"),n.push(t.r,t.g,t.b)):r>.15&&r<=.3?(t.set("royalblue"),n.push(t.r,t.g,t.b)):r>.3&&r<=.45?(t.set("purple"),n.push(t.r,t.g,t.b)):r>.45&&r<=.6?(t.set("firebrick"),n.push(t.r,t.g,t.b)):r>.6&&r<.9?(t.set("white"),n.push(t.r,t.g,t.b)):(t.set("goldenrod"),n.push(t.r,t.g,t.b))}g.setAttribute("color",new e.Float32BufferAttribute(n,3));var x=new e.PointsMaterial({vertexColors:e.VertexColors,opacity:.99});this.points=new e.Points(g,x),this.scene.add(this.points);var b=new e.MeshBasicMaterial({wireframe:!1,color:16771270}),S=new e.SphereBufferGeometry(.5,20,20);this.sunMesh=new e.Mesh(S,b),this.sunMesh.position.set(5,0,-10),this.scene.add(this.sunMesh),console.log(window.location.pathname);var d=new e.TextureLoader,f=d.load(B);f.anisotropy=this.renderer.capabilities.getMaxAnisotropy();var w=d.load(C);w.anisotropy=this.renderer.capabilities.getMaxAnisotropy();var A=d.load(G);A.anisotropy=this.renderer.capabilities.getMaxAnisotropy();var a=new e.MeshStandardMaterial({wireframe:!1,color:10609662,roughness:.7,metalness:1});a.map=f,a.emissiveMap=w,a.emissive=t.set("yellow"),a.emissiveIntensity=.5,a.map.minFilter=e.LinearFilter;var H=new e.SphereBufferGeometry(2,500,500);this.sphereMesh=new e.Mesh(H,a),this.sphereMesh.castShadow=!0,this.sphereMesh.receiveShadow=!0,this.scene.add(this.sphereMesh);var M=d.load(R);M.anisotropy=this.renderer.capabilities.getMaxAnisotropy();var T=new e.MeshStandardMaterial({transparent:!0,map:M,alphaMap:M}),P=new e.SphereBufferGeometry(2.01,500,500);this.cloudMesh=new e.Mesh(P,T),this.cloudMesh.receiveShadow=!0,this.scene.add(this.cloudMesh);var E=d.load(_),z=new e.MeshStandardMaterial({map:E,roughness:1,metalness:1.2}),F=new e.SphereBufferGeometry(1,50,50);this.moonMesh=new e.Mesh(F,z),this.moonMesh.position.set(0,0,-5),this.moonMesh.castShadow=!0,this.moonMesh.receiveShadow=!0,this.scene.add(this.moonMesh),this.pointLight=new e.PointLight(16777215),this.pointLight.position.set(0,0,-8),this.pointLight.castShadow=!0,this.pointLight.intensity=4,this.pointLight.shadow.mapSize.width=4096,this.pointLight.shadow.mapSize.height=4096,this.scene.add(this.pointLight),this.redpointLight=new e.PointLight(16722997),this.redpointLight.position.set(0,0,-8),this.redpointLight.intensity=1,this.scene.add(this.redpointLight),this.redpointLight2=new e.PointLight(16722997),this.redpointLight2.position.set(0,0,-8),this.redpointLight2.intensity=2,this.scene.add(this.redpointLight2),this.composer=new o.EffectComposer(this.renderer),this.renderPass=new o.RenderPass(this.scene,this.camera),this.composer.addPass(this.renderPass),this.godrayeffect=new o.GodRaysEffect(this.camera,this.sunMesh,{height:720,kernelSize:o.KernelSize.SMALL,density:3,decay:.92,weight:.5,exposure:.6,samples:60,clampMax:1}),this.godrayeffect.dithering=!0,this.godraypass=new o.EffectPass(this.camera,this.godrayeffect),this.composer.addPass(this.godraypass),this.bloomEffect=new o.BloomEffect({blendFunction:o.BlendFunction.SCREEN,kernelSize:o.KernelSize.SMALL,luminanceThreshold:.1,luminanceSmoothing:.5,opacity:2,height:480}),this.bloompass=new o.EffectPass(this.camera,this.bloomEffect),this.composer.addPass(this.bloompass),this.renderPass.renderToScreen=!1,this.godraypass.renderToScreen=!1,this.bloompass.renderToScreen=!0,this.sphereMesh.rotation.z-=.3,this.sphereMesh.rotation.y+=.5,this.sphereMesh.rotation.x=Math.random(),this.cloudMesh.rotation.y=Math.random()*2,this.points.rotation.z+=1,this.begin=0,this.ticks=0,this.change=15e-5,this.threeAnim};this.AppletHTML=new j(i,this.parentNode,this.props,s,void 0,"NEVER"),this.settings.length>0&&this.configure(this.settings),this.threeWidth!==this.AppletHTML.node.clientWidth&&(this.threeWidth=this.AppletHTML.node.clientWidth,this.renderer.setPixelRatio(this.threeWidth/this.AppletHTML.node.clientHeight),this.renderer.setSize(this.threeWidth,this.AppletHTML.node.clientHeight),this.composer.setSize(this.threeWidth,this.AppletHTML.node.clientHeight),this.camera.aspect=this.threeWidth/this.AppletHTML.node.clientHeight,this.camera.updateProjectionMatrix()),this.render()}deinit(){cancelAnimationFrame(this.threeAnim),this.renderer.domElement.addEventListener("dblclick",null,!1),this.composer=null,this.scene=null,this.projector=null,this.camera=null,this.controls=null,this.sphereMesh=null,this.points=null,this.AppletHTML.deleteNode()}responsive(){}configure(i=[]){i.forEach((s,h)=>{})}onData(i){this.change=i*.04}}u(ThreeSunriseApplet,"devices",["heg"]);
