var o=Object.defineProperty;var l=(n,t,e)=>(typeof t!="symbol"&&(t+=""),t in n?o(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e);import{brainsatplay as d}from"../../brainsatplay.js";import{DOMFragment as c}from"../../frontend/utils/DOMFragment.js";import{SoundJS as g}from"../../frontend/UX/Sound.js";export class CircleApplet{constructor(t=document.body,e=new d,i=[]){l(this,"updateLoop",()=>{if(this.looping){if(this.bci.atlas.settings.heg){let t=this.bci.atlas.data.heg[0].count;if(t>=2){let e=40;t<e&&(e=t);let i=this.bci.atlas.data.heg[0].ratio.slice(t-e),s=this.bci.atlas.data.heg[0].ratio[t-1]-this.mean(i);this.angleChange=s,this.draw()}}setTimeout(()=>{this.loop=requestAnimationFrame(this.updateLoop)},16)}});l(this,"draw",()=>{let t=this.canvas.width,e=this.canvas.height;var i=this.ctx.createRadialGradient(t*.5,e*.5,2,t*.5,e*.5,100*this.angle*this.angle);i.addColorStop(0,"purple"),i.addColorStop(.25,"dodgerblue"),i.addColorStop(.32,"skyblue"),i.addColorStop(1,this.bgColor),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,t,e),this.ctx.beginPath(),(this.angle>1.57||this.angleChange>0)&&(this.angle<3.14||this.angleChange<0)&&(this.angle+=this.angleChange*.1,this.soundFX!==null&&(this.soundFX.osc[0].frequency.value+=this.angleChange*100));var s=e*.04+e*.46*Math.abs(Math.cos(this.angle));this.ctx.arc(t*.5,e*.5,s,0,Math.PI*2,!1),this.ctx.closePath(),this.ctx.fillStyle=this.cColor,this.ctx.fill()});this.bci=e,this.parentNode=t,this.settings=i,this.AppletHTML=null,this.props={id:String(Math.floor(Math.random()*1e6))},this.loop=null,this.looping=!1,this.canvas=null,this.ctx=null,this.angle=1.57,this.angleChange=0,this.soundFX=null,this.hidden=!1,this.bgColor="#34baeb",this.cColor="#ff3a17"}init(){let t=(i=this.props)=>`
            <div id=`+i.id+`>
                <div id='`+i.id+`menu' style='position:absolute; z-index:3; '>
                    <table id='`+i.id+`table' style='z-index:99;'>
                        <td><button id='`+i.id+`audio'>Tone</button></td>
                    </table>
                    <button id='`+i.id+`showhide' style='opacity:0.3;'>Hide UI</button>
                </div>
                <canvas id='`+i.id+`canvas' height='100%' width='100%' style='width:100%; height:100%;'></canvas>
            </div>
            `,e=(i=this.props)=>{let s=document.getElementById(i.id+"audio");s.style.opacity=.3,s.onclick=()=>{this.soundFX===null?(this.soundFX=new g,this.soundFX.gainNode.gain.value=.1,this.soundFX.playFreq([300]),s.style.opacity=1):this.soundFX.gainNode.gain.value===0?(this.soundFX.gainNode.gain.value=.1,s.style.opacity=1):(this.soundFX.gainNode.gain.value=0,s.style.opacity=.2)};let a=document.getElementById(i.id+"showhide"),h=document.getElementById(i.id+"table");a.onclick=()=>{this.hidden===!1?(h.style.display="none",a.innerHTML="Show UI",this.hidden=!0):(h.style.display="",a.innerHTML="Hide UI",this.hidden=!1)},a.onmouseover=()=>{a.style.opacity=1},a.onmouseleave=()=>{a.style.opacity=.2},this.canvas=document.getElementById(i.id+"canvas"),this.ctx=this.canvas.getContext("2d"),this.draw()};this.AppletHTML=new c(t,this.parentNode,this.props,e,void 0,"NEVER"),this.settings.length>0&&this.configure(this.settings),this.looping=!0,this.loop=this.updateLoop()}deinit(){this.looping=!1,cancelAnimationFrame(this.loop),this.soundFX!==null&&this.soundFX.osc[0].stop(0),this.AppletHTML.deleteNode()}responsive(){this.canvas.width=this.AppletHTML.node.clientWidth,this.canvas.height=this.AppletHTML.node.clientHeight,this.canvas.style.width=this.AppletHTML.node.clientWidth,this.canvas.style.height=this.AppletHTML.node.clientHeight,this.draw()}configure(t=[]){t.forEach((e,i)=>{})}mean(t){var e=t.reduce((i,s)=>s+=i);return e/t.length}}l(CircleApplet,"devices",["heg"]);
