var c=Object.defineProperty;var o=(d,i,e)=>(typeof i!="symbol"&&(i+=""),i in d?c(d,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[i]=e);import{brainsatplay as r}from"../../brainsatplay.js";import{DOMFragment as u}from"../../frontend/utils/DOMFragment.js";import{SoundJS as g}from"../../frontend/UX/Sound.js";export class HillClimberApplet{constructor(i=document.body,e=new r,t=[]){o(this,"updateLoop",()=>{if(this.bci.atlas.settings.heg){let i=this.bci.atlas.data.heg[0].count,e=40;i<e&&(e=i);let t=this.bci.atlas.data.heg[0].ratio.slice(i-e),s=this.bci.atlas.data.heg[0].ratio[i-1]-this.mean(t);this.onData(s)}this.draw(),setTimeout(()=>{this.animationId=requestAnimationFrame(this.updateLoop)},this.updateInterval)});o(this,"draw",()=>{this.soundFX!=null&&(this.hillScore[this.hillScore.length-1]>this.hillScore[this.hillScore.length-2]?this.soundFX.playFreq([650+this.hillScore[this.hillScore.length-1]],.05):this.hillScore[this.hillScore.length-1]<this.hillScore[this.hillScore.length-2]&&this.soundFX.playFreq([250+this.hillScore[this.hillScore.length-1]],.05));var i=this.c.width,e=this.c.height,t=[],s=i/this.relativeWidth,n=(this.meterWidth+this.meterGap)*s,a=1;if(this.hillScore[this.hillScore.length-1]>e&&(a=e/this.hillScore[this.hillScore.length-1]),this.ctx.clearRect(0,0,i,e),this.mode==0)for(var h=0;h<this.hillNum;h++){var l=this.hillScore[h]*a;l<0&&(l=0),t.length<Math.round(this.hillNum)&&t.push(l),this.ctx.fillStyle=this.capStyle,l<t[h]?this.ctx.fillRect(h*n,e- --t[h],this.meterWidth*s,this.capHeight):(this.ctx.fillRect(h*n,e-l,this.meterWidth*s,this.capHeight),t[h]=l),this.ctx.fillStyle=this.gradient,this.ctx.fillRect(h*n,e-l+this.capHeight,this.meterWidth*s,e)}if(this.mode==1){this.ctx.fillStyle=this.gradient,this.ctx.beginPath(),this.ctx.moveTo(0,e-this.hillScore[0]);for(var h=0;h<this.hillNum;h++){var l=this.hillScore[h]*a;l<0&&(l=0),this.ctx.lineTo(h*n,e-l),h==this.hillNum-1&&this.ctx.lineTo(i,e-l)}this.ctx.lineTo(i,e),this.ctx.lineTo(0,e),this.ctx.closePath(),this.ctx.fill()}this.hillScore.shift(),this.hillScore.push(this.hillScore[this.hillScore.length-1])});this.bci=e,this.parentNode=i,this.settings=t,this.AppletHTML=null,this.props={id:String(Math.floor(Math.random()*1e6))},this.mode=1,this.c=!1,this.ctx=!1,this.gradient=null,this.soundFX=null,this.hidden=!1,this.updateInterval=1e3,this.allCapsReachBottom=!1,this.meterWidth=12,this.meterGap=2,this.hillNum=150,this.capHeight=2,this.capStyle="#fff",this.relativeWidth=this.hillNum*(this.meterWidth+this.meterGap),this.hillScore=[...Array(this.hillNum).fill(50)],this.animationId=null}init(){let i=(t=this.props)=>`
            <div id="`+t.id+`"> 
                <div id="`+t.id+`menu" style='position:absolute; z-index:4;'> 
                    <table> 
                        <tr><td><button id="`+t.id+`hillsRbutton">Reset</button></td></tr> 
                        <tr><td><button id="`+t.id+`hillsModebutton">Mode</button></td></tr> 
                        <tr><td><button id="`+t.id+`hillsAudbutton">Audio</button></td></tr> 
                        <tr><td><input type="number" id="`+t.id+`speed" placeholder="Update (Sec)"></input></td></tr> 
                        <tr><td><button id="`+t.id+`hillsSpeedbutton">Set Speed</button></tr></td> 
                    </table> 
                </div> 
                <button id="`+t.id+`showhide" style='float:right; z-index:4;'>Hide UI</button>'
                <canvas id="`+t.id+`canvas" style='z-index:1;'></canvas>
            </div> 
            `,e=(t=this.props)=>{this.c=document.getElementById(this.props.id+"canvas"),this.ctx=this.c.getContext("2d"),this.gradient=this.ctx.createLinearGradient(0,0,0,this.c.height),this.gradient.addColorStop(1,"dodgerblue"),this.gradient.addColorStop(.9,"green"),this.gradient.addColorStop(.8,"springgreen"),this.gradient.addColorStop(.65,"sandybrown"),this.gradient.addColorStop(.45,"slategray"),this.gradient.addColorStop(.35,"silver"),this.gradient.addColorStop(.2,"snow"),this.gradient.addColorStop(.1,"white"),this.gradient.addColorStop(0,"gold"),document.getElementById(t.id+"hillsAudbutton").style.opacity=.3,document.getElementById(t.id+"hillsRbutton").onclick=()=>{this.hillScore=[...Array(this.hillNum).fill(50)]},document.getElementById(t.id+"hillsModebutton").onclick=()=>{this.mode==0?this.mode=1:this.mode=0},document.getElementById(t.id+"hillsAudbutton").onclick=()=>{this.soundFX==null?(this.soundFX=new g,document.getElementById(t.id+"hillsAudbutton").style.opacity=1):this.soundFX.gainNode.gain.value==0?(this.soundFX.gainNode.gain.value=1,document.getElementById(t.id+"hillsAudbutton").style.opacity=1):(this.soundFX.gainNode.gain.value=0,document.getElementById(t.id+"hillsAudbutton").style.opacity=.3)},document.getElementById(t.id+"hillsSpeedbutton").onclick=()=>{this.updateInterval=document.getElementById(t.id+"speed").value*1e3},document.getElementById(t.id+"showhide").onclick=()=>{this.hidden==!1?(this.hidden=!0,document.getElementById(t.id+"showhide").innerHTML="Show UI",document.getElementById(t.id+"menu").style.display="none"):(this.hidden=!1,document.getElementById(t.id+"showhide").innerHTML="Hide UI",document.getElementById(t.id+"menu").style.display="")}};this.AppletHTML=new u(i,this.parentNode,this.props,e,void 0,"NEVER"),this.settings.length>0&&this.configure(this.settings),this.updateLoop()}deinit(){this.stop(),this.soundFX!=null&&this.soundFX.osc[0]!=null&&this.soundFX.osc[0].stop(0),this.AppletHTML.deleteNode()}responsive(){let i=document.getElementById(this.props.id+"canvas");i.width=this.AppletHTML.node.clientWidth,i.height=this.AppletHTML.node.clientHeight}configure(i=[]){i.forEach((e,t)=>{})}onData(i){var e=this.hillScore[this.hillScore.length-1]+i*20;this.hillScore[this.hillScore.length-1]=e,this.hillScore[this.hillScore.length-1]<10&&(this.hillScore[this.hillScore.length-1]=10),i>0&&(this.hillScore[this.hillScore.length-1]+=.5),i<0&&(this.hillScore[this.hillScore.length-1]-=.3)}stop(){this.animationId!=null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}}o(HillClimberApplet,"devices",["heg"]);
