import*as t from"../../../../../../../_snowpack/pkg/three.js";import{DigitalGlitch as u}from"../../../../../../../_snowpack/pkg/three/examples/jsm/shaders/DigitalGlitch.js";export{o as GlitchPass};const h=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(h.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}});const o=function(e){h.call(this),u===void 0&&console.error("THREE.GlitchPass relies on THREE.DigitalGlitch");var a=u;this.uniforms=t.UniformsUtils.clone(a.uniforms),e==null&&(e=64),this.uniforms.tDisp.value=this.generateHeightmap(e),this.material=new t.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.camera=new t.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new t.Scene,this.quad=new t.Mesh(new t.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.goWild=!1,this.glitchFrequency=1/3,this.lastGlitchTime=Date.now(),this.randTimeOffset=0,this.timingVariability=5,this.generateTrigger()};o.prototype=Object.assign(Object.create(h.prototype),{constructor:o,render:function(e,a,r,i,s){this.uniforms.tDiffuse.value=r.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0;const l=(Date.now()-this.lastGlitchTime-this.randTimeOffset)/1e3-1/this.glitchFrequency;l>=0||this.goWild==!0?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=t.Math.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=t.Math.randFloat(0,1),this.uniforms.distortion_y.value=t.Math.randFloat(0,1),this.uniforms.seed_x.value=t.Math.randFloat(-.3,.3),this.uniforms.seed_y.value=t.Math.randFloat(-.3,.3)):this.goWild==!1&&(this.uniforms.byp.value=1),l>=this.randGlitchTime/1e3&&(this.lastGlitchTime=Date.now(),this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=t.Math.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=t.Math.randFloat(-1,1),this.uniforms.seed_y.value=t.Math.randFloat(-1,1),this.uniforms.distortion_x.value=t.Math.randFloat(0,1),this.uniforms.distortion_y.value=t.Math.randFloat(0,1),this.generateTrigger(),this.randTimeOffset=Math.max(-this.randGlitchTime*.5,this.timingVariability*Math.random())),this.quad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene,this.camera)):(e.setRenderTarget(a),this.clear&&e.clear(),e.render(this.scene,this.camera))},generateTrigger:function(){this.randGlitchTime=t.Math.randInt(100,500)},generateHeightmap:function(e){for(var a=new Float32Array(e*e*3),r=e*e,i=0;i<r;i++){var s=t.Math.randFloat(0,1);a[i*3+0]=s,a[i*3+1]=s,a[i*3+2]=s}var n=new t.DataTexture(a,e,e,t.RGBFormat,t.FloatType);return n.needsUpdate=!0,n}});
