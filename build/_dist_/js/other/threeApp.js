var W=Object.defineProperty;var w=(d,e,i)=>(typeof e!="symbol"&&(e+=""),e in d?W(d,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):d[e]=i);import{HEGwebAPI as b}from"./HEGwebAPI.js";import*as t from"../../../_snowpack/pkg/three.js";import*as n from"../../../_snowpack/pkg/postprocessing.js";export class graphNode{constructor(e=null,i=[null],h=null){this.id=h,this.parent=e,this.children=i,this.globalPos={x:0,y:0,z:0},this.localPos={x:0,y:0,z:0},this.globalRot={x:0,y:0,z:0},this.localRot={x:0,y:0,z:0},this.functions=[],this.model=null,this.mesh=[0,0,0,1,1,1],this.colors=[0,0,0,255,255,255],this.materials=[],this.textures=[],e!==null&&this.inherit(e)}inherit(e){this.parent=e,this.globalPos=e.globalPos,this.globalRot=e.globalRot,this.functions.concat(e.functions),this.children.forEach(i=>{i.globalPos=e.global,i.functions.concat(e.functions)})}addChild(e){this.children.push(e)}removeChild(e){this.children.forEach((i,h)=>{i.id==e&&this.children.splice(h,1)})}translate(e=[0,0,0]){this.globalPos=[this.globalPos.x+e[0],this.globalPos.y+e[1],this.globalPos.z+e[2]],this.children.forEach(i=>{i.translate(e)})}rotate(e=[0,0,0]){this.globalRot.x+=e[0],this.globalRot.y+=e[1],this.globalRot.z+=e[2],this.children.forEach(i=>{i.rotate(e)})}}export class ThreeGlobe{constructor(){w(this,"destroyThreeApp",()=>{cancelAnimationFrame(this.threeAnim),this.renderer.domElement.addEventListener("dblclick",null,!1),this.composer=null,this.scene=null,this.projector=null,this.camera=null,this.controls=null,this.sphereMesh=null,this.points=null,b.removeParent("threeContainer")});w(this,"render",()=>{this.threeWidth!=window.innerWidth-20&&(this.threeWidth=window.innerWidth-20,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.threeWidth,435),this.composer.setSize(this.threeWidth,435),this.camera.aspect=this.threeWidth/435,this.camera.updateProjectionMatrix()),this.ticks-=this.change*1e3,this.sphereMesh.rotation.y+=this.change*.25,this.cloudMesh.rotation.y=this.sphereMesh.rotation.y,this.points.rotation.y-=this.change;var e=(this.ticks+2900)*.001;this.pointLight.position.x=Math.sin(e)*40,this.pointLight.position.z=Math.cos(e)*40,this.redpointLight.position.x=Math.sin(e-.15)*40,this.redpointLight.position.z=Math.cos(e-.15)*40,this.redpointLight2.position.x=Math.sin(e+.15)*40,this.redpointLight2.position.z=Math.cos(e+.15)*40,this.sunMesh.position.x=Math.sin(e)*40,this.sunMesh.position.z=Math.cos(e)*40,this.moonMesh.position.x=Math.sin(e*1.05+.83)*30,this.moonMesh.position.z=Math.cos(e*1.05+.83)*30,this.composer.render(),this.threeAnim=requestAnimationFrame(this.render)});var e='<div id="threeContainer" class="canvasContainer"></div>';b.appendFragment(e,"main_body"),this.scene=new t.Scene,this.camera=new t.PerspectiveCamera(75,(window.innerWidth-20)/435,.1,1e3),this.renderer=new t.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth-20,435),this.renderer.shadowMap.enabled=!0,document.getElementById("threeContainer").appendChild(this.renderer.domElement);for(var i=5e3,h=[],r=0;r<i;r++){var g=t.Math.randFloatSpread(500),c=t.Math.randFloatSpread(1e3),u=t.Math.randFloatSpread(1500);h.push(g,c,u)}var p=new t.BufferGeometry;p.setAttribute("position",new t.Float32BufferAttribute(h,3));for(var s=new t.Color,o=[],r=0;r<i;r++){var a=Math.random();a<=.15?(s.set("skyblue"),o.push(s.r,s.g,s.b)):a>.15&&a<=.3?(s.set("royalblue"),o.push(s.r,s.g,s.b)):a>.3&&a<=.45?(s.set("purple"),o.push(s.r,s.g,s.b)):a>.45&&a<=.6?(s.set("firebrick"),o.push(s.r,s.g,s.b)):a>.6&&a<.9?(s.set("white"),o.push(s.r,s.g,s.b)):(s.set("goldenrod"),o.push(s.r,s.g,s.b))}p.setAttribute("color",new t.Float32BufferAttribute(o,3));var y=new t.PointsMaterial({vertexColors:t.VertexColors,opacity:.99});this.points=new t.Points(p,y),this.scene.add(this.points);var x=new t.MeshBasicMaterial({wireframe:!1,color:16771270}),S=new t.SphereBufferGeometry(.5,20,20);this.sunMesh=new t.Mesh(S,x),this.sunMesh.position.set(5,0,-10),this.scene.add(this.sunMesh),console.log(window.location.pathname);var L=require("../assets/textures/8k_earth_daymap.jpg"),m=new t.TextureLoader,f=m.load(L);f.anisotropy=this.renderer.capabilities.getMaxAnisotropy();var v=m.load(require("../assets/textures/8k_earth_nightmap.jpg"));v.anisotropy=this.renderer.capabilities.getMaxAnisotropy();var P=m.load(require("../assets/textures/8k_earth_specular_map.tif"));P.anisotropy=this.renderer.capabilities.getMaxAnisotropy();var l=new t.MeshStandardMaterial({wireframe:!1,color:10609662,roughness:.7,metalness:1});l.map=f,l.emissiveMap=v,l.emissive=s.set("yellow"),l.emissiveIntensity=.5,l.map.minFilter=t.LinearFilter;var z=new t.SphereBufferGeometry(2,500,500);this.sphereMesh=new t.Mesh(z,l),this.sphereMesh.castShadow=!0,this.sphereMesh.receiveShadow=!0,this.scene.add(this.sphereMesh);var E=require("../assets/textures/clouds_8k.jpg"),M=m.load(E);M.anisotropy=this.renderer.capabilities.getMaxAnisotropy();var A=new t.MeshStandardMaterial({transparent:!0,map:M,alphaMap:M}),k=new t.SphereBufferGeometry(2.01,500,500);this.cloudMesh=new t.Mesh(k,A),this.cloudMesh.receiveShadow=!0,this.scene.add(this.cloudMesh);var F=require("../assets/textures/moon_4k.jpg"),B=require("../assets/textures/moon_displace_4k.jpg"),R=m.load(F),C=new t.MeshStandardMaterial({map:R,roughness:1,metalness:1.2}),_=new t.SphereBufferGeometry(1,50,50);this.moonMesh=new t.Mesh(_,C),this.moonMesh.position.set(0,0,-5),this.moonMesh.castShadow=!0,this.moonMesh.receiveShadow=!0,this.scene.add(this.moonMesh),this.pointLight=new t.PointLight(16777215),this.pointLight.position.set(0,0,-8),this.pointLight.castShadow=!0,this.pointLight.intensity=4,this.pointLight.shadow.mapSize.width=4096,this.pointLight.shadow.mapSize.height=4096,this.scene.add(this.pointLight),this.redpointLight=new t.PointLight(16722997),this.redpointLight.position.set(0,0,-8),this.redpointLight.intensity=1,this.scene.add(this.redpointLight),this.redpointLight2=new t.PointLight(16722997),this.redpointLight2.position.set(0,0,-8),this.redpointLight2.intensity=2,this.scene.add(this.redpointLight2),this.composer=new n.EffectComposer(this.renderer),this.renderPass=new n.RenderPass(this.scene,this.camera),this.composer.addPass(this.renderPass),this.godrayeffect=new n.GodRaysEffect(this.camera,this.sunMesh,{height:720,kernelSize:n.KernelSize.SMALL,density:3,decay:.92,weight:.5,exposure:.6,samples:60,clampMax:1}),this.godrayeffect.dithering=!0,this.godraypass=new n.EffectPass(this.camera,this.godrayeffect),this.composer.addPass(this.godraypass),this.bloomEffect=new n.BloomEffect({blendFunction:n.BlendFunction.SCREEN,kernelSize:n.KernelSize.SMALL,luminanceThreshold:.1,luminanceSmoothing:.5,opacity:2,height:480}),this.bloompass=new n.EffectPass(this.camera,this.bloomEffect),this.composer.addPass(this.bloompass),this.renderPass.renderToScreen=!1,this.godraypass.renderToScreen=!1,this.bloompass.renderToScreen=!0,this.sphereMesh.rotation.z-=.3,this.sphereMesh.rotation.y+=.5,this.sphereMesh.rotation.x=Math.random(),this.cloudMesh.rotation.y=Math.random()*2,this.points.rotation.z+=1,this.camera.position.x=1.5,this.camera.position.y=.5,this.camera.position.z=2,this.camera.rotation.x=-.3,this.camera.rotation.y=-.2,this.camera.rotation.z=-.2,this.begin=0,this.ticks=0,this.change=15e-5,this.threeAnim,this.threeWidth=window.innerWidth-20,this.render()}onData(e){this.change=e*.04}}function T(d){for(var e=(1+Math.sqrt(5))*.5,i=(2-e)*(2*Math.PI),h=[],r=0;r<d;r++){var g=r/d,c=Math.acos(1-2*g),u=i*r,p=Math.sin(c)*Math.cos(u),s=Math.sin(c)*Math.sin(u),o=Math.cos(c);h.push(p,s,o)}return h}
