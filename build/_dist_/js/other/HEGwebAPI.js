var b=Object.defineProperty;var d=(u,t,e)=>(typeof t!="symbol"&&(t+=""),t in u?b(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e);var p=(u,t,e)=>new Promise((s,a)=>{var i=o=>{try{h(e.next(o))}catch(r){a(r)}},n=o=>{try{h(e.throw(o))}catch(r){a(r)}},h=o=>o.done?s(o.value):Promise.resolve(o.value).then(i,n);h((e=e.apply(u,t)).next())});export class HEGwebAPI{constructor(t="",e=["us","Red","IR","Ratio","Ambient","drdt","ddrdt"],s="|",a=0,i=3,n=!0,h="main_body"){d(this,"openEvent",t=>{this.alloutput.push(t.data),console.log("HEGDUINO","Events Connected")});d(this,"errorEvent",t=>{t.target.readyState!=EventSource.OPEN&&(this.alloutput.push(t.data),console.log("HEGDUINO","Events Disconnected"))});d(this,"messageEvent",t=>{console.log("HEGDUINO",t.data),this.alloutput.push(t.data)});d(this,"hegEvent",t=>{this.handleEventData(t.data,this.delimiter,this.uIdx,this.rIdx)});this.alloutput=[],this.raw=[],this.filtered=[],this.clock=[],this.useMs=!1,this.ratio=[],this.startTime=0,this.slowSMA=0,this.slowSMAarr=[0],this.fastSMA=0,this.fastSMAarr=[0],this.smaSlope=0,this.scoreArr=[0],this.replay=!1,this.csvDat=[],this.csvIndex=0,this.curIndex=0,this.noteIndex=[],this.noteText=[],this.host=t,this.source="",this.platform=navigator.userAgent.toLowerCase(),this.sensitivity=null,this.header=e,this.delimiter=s,this.uIdx=a,this.rIdx=i,this.defaultUI=n,this.ui=!1,n==!0&&(this.parentId=h,this.createUI(h,e)),this.createEventListeners(t)}resetVars(){this.startTime=0,this.alloutput=[],this.raw=[],this.filtered=[],this.clock=[],this.ratio=[],this.slowSMA=0,this.slowSMAarr=[0],this.fastSMA=0,this.fastSMAarr[0],this.smaSlope=0,this.scoreArr=[0],this.replay=!1,this.csvDat=[],this.csvIndex=0,this.curIndex=0,this.noteIndex=[],this.noteText=[]}static appendFragment(t,e){var s=document.createDocumentFragment(),a=document.createElement("div");a.innerHTML=t,a.setAttribute("id",e+"_child"),s.appendChild(a),document.getElementById(e).appendChild(s)}static deleteFragment(t,e){var s=document.getElementById(e);document.getElementById(t).removeChild(s)}static appendFragmentMulti(t,e,s){var a=document.createDocumentFragment(),i=document.createElement("div");i.innerHTML=t,i.setAttribute("id",e+"_child"),a.appendChild(i),document.getElementById(e).appendChild(a)}static removeElement(t){var e=document.getElementById(t);e.parentNode.removeChild(e)}static removeParent(t){var e=document.getElementById(t);e.parentNode.parentNode.removeChild(e.parentNode)}static removeParentParent(t){var e=document.getElementById(t);e.parentNode.parentNode.parentNode.removeChild(e.parentNode.parentNode)}static sma(t,e){for(var s=[],a=0;a<t.length;a++)if(a==0)s.push(t[0]);else if(a<e){var i=t.slice(0,a+1);s.push(i.reduce((n,h)=>h+=n)/(a+1))}else{var i=t.slice(a-e,a);s.push(i.reduce((h,o)=>o+=h)/e)}return s}smaScore(t){this.slowSMAarr=HEGwebAPI.sma(t,40),this.fastSMAarr=HEGwebAPI.sma(t,20),this.fastSMA=this.fastSMAarr[this.fastSMAarr.length-1],this.slowSMA=this.slowSMAarr[this.slowSMAarr.length-1],this.smaSlope=this.fastSMA-this.slowSMA}saveCSV(t=this.filtered,e=new Date().toISOString(),s=this.delimiter,a=this.header.join(",")+",Notes",i=!0){var n=a+`
`;t.forEach((o,r)=>{n+=o.split(s).join(","),i==!0&&this.noteIndex.indexOf(r)!=-1&&(n+=","+[this.noteText[this.noteIndex.indexOf(r)]]),o.indexOf(`
`)<0&&(n+=`
`)});var h=document.createElement("a");h.href="data:text/csv;charset=utf-8,"+encodeURI(n),h.target="_blank",e!=""?h.download=e+".csv":h.download=Date().toISOString()+".csv",h.click()}openFile(t=","){var e=document.createElement("input");e.type="file",e.onchange=s=>{this.csvDat=[];var a=s.target.files[0],i=new FileReader;i.readAsText(a),i.onload=n=>{var h=n.target.result,o=h.split(`
`);o.pop(),o.forEach((r,l)=>{if(l==0)var c=r.split(t);else{var c=r.split(t);this.csvDat.push(c)}}),this.onOpen()},e.value=""},e.click()}handleScore(){}replayCSV(){this.csvIndex<2&&(this.startTime==0&&(this.startTime=this.csvDat[this.csvIndex][0]),this.clock.push(parseInt(this.csvDat[this.csvIndex][0])),this.ratio.push(parseFloat(this.csvDat[this.csvIndex][3]))),this.csvIndex++,this.csvIndex<this.csvDat.length-1?(this.startTime==0&&(this.startTime=this.csvDat[this.csvIndex][0]),this.clock.push(parseInt(this.csvDat[this.csvIndex][0])),this.ratio.push(parseFloat(this.csvDat[this.csvIndex][3])),this.clock.length>=2&&(this.handleScore(),this.updateStreamRow(this.csvDat[this.csvIndex]))):(this.replay=!1,this.csvDat=[],this.csvIndex=0),this.useMs==!0?setTimeout(()=>{this.replayCSV()},this.clock[this.csvIndex]-this.clock[this.csvIndex-1]):setTimeout(()=>{this.replayCSV()},(this.clock[this.csvIndex]-this.clock[this.csvIndex-1])*.001)}openCSV(){var t=document.createElement("input");t.type="file",t.onchange=e=>{this.csvDat=[],this.csvIndex=0;var s=e.target.files[0],a=new FileReader;a.readAsText(s),a.onload=i=>{this.resetVars();var n=i.target.result,h=n.split(`
`);h.pop(),h.forEach((o,r)=>{if(r==0)var l=o.split(",");else{var l=o.split(",");this.csvDat.push(l)}}),this.replay=!0,this.replayCSV()},t.value=""},t.click()}handleEventData(t,e="|",s=0,a=3){if(console.log("HEGDUINO",t),this.raw[this.raw.length-1]!=t){this.ui==!0&&(document.getElementById("heg").innerHTML=t);var i=new CustomEvent("on_read",{detail:{data:t}});if(window.parent.dispatchEvent(i),window.parent.postMessage(t,"*"),t.includes(e)){this.raw.push(t);var n=t.split(e),h=parseFloat(n[a]);if(h>0){if(this.startTime==0&&(this.startTime=parseInt(n[0])),this.clock.push(parseInt(n[s])),this.ratio.push(parseFloat(n[a])),this.clock.length>5){var o=HEGwebAPI.sma(this.ratio.slice(this.ratio.length-5,this.ratio.length),5);(this.ratio[this.ratio.length-1]<o[4]*.7||this.ratio[this.ratio.length-1]>o[4]*1.3)&&(this.ratio[this.ratio.length-1]=this.ratio[this.ratio.length-2],n[a]=o),this.filtered.push(n.join(e))}this.handleScore(),this.defaultUI==!0&&this.updateStreamRow(n)}}}else this.replay==!1;this.endOfEvent()}endOfEvent(){}createEventListeners(t=""){window.EventSource&&(this.source=new EventSource(t+"/events"),this.source.addEventListener("open",this.openEvent,!1),this.source.addEventListener("error",this.errorEvent,!1),this.source.addEventListener("message",this.messageEvent,!1),this.source.addEventListener("heg",this.hegEvent,!1))}removeEventListeners(){window.EventSource&&(this.source.close(),this.source.removeEventListener("open",this.openEvent,!1),this.source.removeEventListener("error",this.errorEvent,!1),this.source.removeEventListener("message",this.messageEvent,!1),this.source.removeEventListener("heg",this.hegEvent,!1))}updateStreamHeader(t=this.header){var e="<tr>";t.forEach(s=>{e+="<th>"+s+"</th>"}),e+="</tr>",document.getElementById("dataNames").innerHTML=e}updateStreamRow(t){var e="<tr>";t.forEach(s=>{e+="<td>"+s+"</td>"}),e+="</tr>",document.getElementById("dataTable").innerHTML=e}makeStreamTable(t=this.header){var e='<div id="tableHead"><table class="dattable" id="dataNames"></table></div>',s='<div id="tableDat"><table class="dattable" id="dataTable"><tr><td>Awaiting Data...</td></tr></table></div>';HEGwebAPI.appendFragment(e,"sTableContainer"),HEGwebAPI.appendFragment(s,"sTableContainer"),this.updateStreamHeader(t),this.defaultUI=!0}createUI(t,e=this.header){var s='<div id="hegapi" class="hegapi">       <table>       <tr><td><button id="startbutton" class="button startbutton">Start HEG</button></td>         <td><button id="stopbutton" class="button stopbutton" type="submit">Stop HEG</button></td></tr>       <tr><td colspan="2"><hr></td></tr>       <tr id="commandrow"><td><input type="text" id="command" name="command" placeholder="Command"></td><td><button id="sendbutton" class="button sendbutton">Send</button></td></tr>       <tr><td colspan="2"><hr></td></tr>       <tr><td colspan="2"><button class="button" id="resetSession" name="resetSession">Reset Session</button></td></tr>       <tr><td colspan="2"><hr></td></tr>       <tr><td colspan="2" id="sensitivityLabel">Scoring Sensitivity</td></tr>       <tr id="sensitivityrow"><td><button class="button" id="reset_s">Default</button></td>         <td>Sensitivity: <span id="sensitivityVal">1.00</span><br><input type="range" class="slider" id="sensitivity" min="1" max="1000" value="100"></td></tr>       <tr><td colspan="2"><hr></td></tr>       <tr id="timerow"><td><div id="timestamp">Get Current Time</div></td><td><button id="getTime" class="button">Get Time</button></td></tr>       <tr id="noterow"><td colspan="2"><textarea id="noteText" placeholder="Point of Interest"></textarea></td></tr>      <tr id-"savenoterow"><td colspan="2"><button id="saveNote" class="button">Annotate</button></td></tr>       <tr><td colspan="2"><hr></td></tr>       <tr id="csvrow"><td ><input type="text" id="csvname" name="csvname" placeholder="session_data"></input></td>         <td><button class="button saveLoadButtons" id="savecsv">Save CSV</button></td></tr>       <tr><td colspan="2"><button class="button saveLoadButtons" id="replaycsv">Replay CSV</button></td></tr>       <tr><td colspan="2"><hr></td></tr>       <tr><td colspan="2" id="hostlabel">Host</td></tr>       <tr id="hostrow"><td><input type="text" id="hostname" name="hostname" placeholder="http://192.168.4.1"></input></td><td><button id="submithost" class="button">Connect</button></td></tr>        <tr><td colspan="2"><hr></td></tr>       </table></div>       <iframe name="dummyframe" id="dummyframe" class="dummy"></iframe>       ',a='<dataDiv id="dataDiv"></dataDiv>',i='<div id="rawDiv"><div id="sTableContainer"></div></div>',n='<msgDiv id="message">Output:</div>',h='<eventDiv id="heg">Not connected...</eventDiv>';HEGwebAPI.appendFragment(a,t),HEGwebAPI.appendFragment(s,"dataDiv"),HEGwebAPI.appendFragment(i,"dataDiv"),HEGwebAPI.appendFragment(n,"rawDiv"),HEGwebAPI.appendFragment(h,"rawDiv"),this.makeStreamTable(e),document.getElementById("getTime").onclick=()=>{this.curIndex=this.clock.length-1,this.useMs==!0?document.getElementById("timestamp").innerHTML=(this.clock[this.clock.length-1]*.001).toFixed(2)+"s":document.getElementById("timestamp").innerHTML=(this.clock[this.clock.length-1]*1e-6).toFixed(2)+"s"},document.getElementById("saveNote").onclick=()=>{this.noteIndex.push(this.curIndex),this.noteText.push(document.getElementById("noteText").value),document.getElementById("noteText").value="",this.curIndex=-1,document.getElementById("timestamp").innerHTML="Get Current Time"},document.getElementById("savecsv").onclick=()=>{this.saveCSV()},document.getElementById("replaycsv").onclick=()=>{this.openCSV()},document.getElementById("resetSession").onclick=()=>{this.resetVars()},this.sensitivity=document.getElementById("sensitivity"),document.getElementById("reset_s").onclick=()=>{this.sensitivity.value=100,document.getElementById("sensitivityVal").innerHTML=(this.sensitivity.value*.01).toFixed(2)},document.getElementById("sensitivity").oninput=()=>{document.getElementById("sensitivityVal").innerHTML=(this.sensitivity.value*.01).toFixed(2)},document.getElementById("startbutton").onclick=()=>{var o=new XMLHttpRequest;o.open("POST",this.host+"/startHEG",!0),o.send(),o.onerror=function(){o.abort()}},document.getElementById("stopbutton").onclick=()=>{var o=new XMLHttpRequest;o.open("POST",this.host+"/stopHEG",!0),o.send(),o.onerror=function(){o.abort()}},document.getElementById("sendbutton").onclick=()=>{var o=new FormData;o.append("command",document.getElementById("command").value);var r=new XMLHttpRequest;r.open("POST",this.host+"/command",!0),r.send(o),r.onerror=function(){r.abort()}},document.getElementById("submithost").onclick=()=>{window.EventSource&&this.removeEventListeners(),document.getElementById("hostname").value.length>2?this.host=document.getElementById("hostname").value:this.host="http://192.168.4.1",document.getElementById("startbutton").onclick=()=>{var o=new XMLHttpRequest;o.open("POST",this.host+"/startHEG",!0),o.send(),o.onerror=function(){o.abort()}},document.getElementById("stopbutton").onclick=()=>{var o=new XMLHttpRequest;o.open("POST",this.host+"/stopHEG",!0),o.send(),o.onerror=function(){o.abort()}},document.getElementById("sendbutton").onclick=()=>{var o=new FormData;o.append("command",document.getElementById("command").value);var r=new XMLHttpRequest;r.open("POST",this.host+"/command",!0),r.send(o),r.onerror=function(){r.abort()}},this.createEventListeners(this.host),console.log("Attempting connection at "+this.host)},this.ui=!0}}export class graphJS{constructor(t=[1155],e=[0,255,0,1],s=1,a=[1400,600],i="main_body",n="g",h=!0){d(this,"changeArr",t=>{if(t.length<10)console.log("new array too small, needs 10 points minimum");else{if(this.VERTEX_LENGTH>t.length&&(this.VERTEX_LENGTH=t.length),this.viewing==0)for(var e=1;e<=this.VERTEX_LENGTH;e++)this.graphY1[e]=t[t.length-1-(this.VERTEX_LENGTH-e)];if(this.viewing==1)for(var e=1;e<=this.VERTEX_LENGTH;e++)this.graphY2[e]=t[t.length-1-(this.VERTEX_LENGTH-e)]}});d(this,"draw",()=>{this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.createVertices(this.xAxis,[255,255,255,.6]),this.gl.drawArrays(this.gl.LINES,0,2),this.createVertices(this.yAxis,[255,255,255,.6]),this.gl.drawArrays(this.gl.LINES,0,2),this.createVertices(this.xgradient,[70,70,70,.8]),this.gl.drawArrays(this.gl.LINES,0,12),this.createVertices(this.ygradient,[70,70,70,.8]),this.gl.drawArrays(this.gl.LINES,0,6),this.viewing==0&&(this.vertices=this.makePoints(this.VERTEX_LENGTH,this.graphY1)),this.viewing==1&&(this.vertices=this.makePoints(this.VERTEX_LENGTH,this.graphY2)),this.createVertices(this.vertices),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,new Float32Array(this.vertices)),this.gl.drawArrays(this.gl.LINE_STRIP,0,this.VERTEX_LENGTH),this.graphtext.clearRect(0,0,this.canvas.width,this.canvas.height),window.innerWidth>700?this.graphtext.canvas.height=this.canvas.height*(window.innerHeight/window.innerWidth)*1.3:this.graphtext.canvas.height=this.canvas.height,this.graphtext.canvas.width=this.canvas.width*1.3,this.graphtext.font="2em Arial";var t=0;this.useMs==!0?t=Math.floor(this.clock*.001):t=Math.floor(this.clock*1e-6);var e=Math.floor(t*.01667);t=t-e*60,t<10&&(t="0"+t),this.viewing==0&&(this.graphtext.fillStyle="#00ff00",this.graphtext.fillText("  Time: "+e+":"+t,this.graphtext.canvas.width-300,50),this.graphtext.fillText("  Ratio: "+this.ratio.toFixed(2),this.graphtext.canvas.width-500,50),this.graphtext.fillStyle="#99ffbb",this.graphtext.fillText("    Score: "+this.graphY1[this.graphY1.length-1].toFixed(2),this.graphtext.canvas.width-720,50)),this.viewing==1&&(this.graphtext.fillStyle="#00ff00",this.graphtext.fillText("  Time: "+e+":"+t,this.graphtext.canvas.width-300,50),this.graphtext.fillText("    Score: "+this.graphY1[this.graphY1.length-1].toFixed(2)+"  ",this.graphtext.canvas.width-720,50),this.graphtext.fillStyle="#99ffbb",this.graphtext.fillText("   Ratio: "+this.ratio.toFixed(2),this.graphtext.canvas.width-500,50)),this.graphtext.fillStyle="#707070";var s=this.graphtext.canvas.width*.125;this.graphtext.fillText((this.invScale*.75-this.yoffset).toFixed(3),s,this.graphtext.canvas.height*.125),this.graphtext.fillText((this.invScale*.5-this.yoffset).toFixed(3),s,this.graphtext.canvas.height*.25),this.graphtext.fillText((this.invScale*.25-this.yoffset).toFixed(3),s,this.graphtext.canvas.height*.375),this.graphtext.fillText((this.invScale*-.25-this.yoffset).toFixed(3),s,this.graphtext.canvas.height*.625),this.graphtext.fillText((this.invScale*-.5-this.yoffset).toFixed(3),s,this.graphtext.canvas.height*.75),this.graphtext.fillText((this.invScale*-.75-this.yoffset).toFixed(3),s,this.graphtext.canvas.height*.875),this.sampleRate!=null&&(this.graphtext.fillStyle="#303030",this.graphtext.fillText(Math.ceil(this.sampleRate*this.VERTEX_LENGTH*.5).toFixed(0)+"s",this.graphtext.canvas.width*.501,this.graphtext.canvas.height*.85),this.graphtext.fillText(Math.ceil(this.sampleRate*this.VERTEX_LENGTH*.25).toFixed(0)+"s",this.graphtext.canvas.width*.751,this.graphtext.canvas.height*.85),this.graphtext.fillText(Math.ceil(this.sampleRate*this.VERTEX_LENGTH*.75).toFixed(0)+"s",this.graphtext.canvas.width*.251,this.graphtext.canvas.height*.85)),setTimeout(()=>{this.animationId=requestAnimationFrame(this.draw)},40)});this.gl,this.shaderProgram,this.vertices,this.canvas,this.animationId=null,this.canvasId=n,this.textId=n+"text",this.color=e,this.res=a,this.sampleRate=null,this.clock=0,this.useMs=!1,this.ratio=0,this.score=0,this.viewing=0,this.autoscale=!0,this.nPoints=t,this.VERTEX_LENGTH=t,this.graphY1=[...Array(this.VERTEX_LENGTH).fill(0)],this.graphY2=[...Array(this.VERTEX_LENGTH).fill(0)],this.yscale=s,this.invScale=1/this.yscale,this.xoffset=0,this.yoffset=0,this.xAxis=new Float32Array([-1,0,1,0]),this.yAxis=new Float32Array([-.765,-1,-.765,1]),this.xgradient=new Float32Array([-1,-.75,1,-.75,-1,-.5,1,-.5,-1,-.25,1,-.25,-1,.25,1,.25,-1,.5,1,.5,-1,.75,1,.75]),this.ygradient=new Float32Array([-.5,-1,-.5,1,0,-1,0,1,.5,-1,.5,1]),this.VERTEX_SHADER=`
      attribute vec4 coords;
      void main(void) {
        gl_Position = coords;
      }
    `,this.FRAGMENT_SHADER=`
      precision mediump float;
      uniform vec4 color;
      void main(void) {
        gl_FragColor = color;
      }
    `;var o='<div id="shaderContainer">     <canvas class="webglcss" id="'+this.canvasId+'"></canvas><canvas class="webglcss" id="'+this.canvasId+'text"></canvas></div>';HEGwebAPI.appendFragment(o,i),this.defaultUI=h,h==!0&&this.createUI(i),this.initGL(n),this.createShader(),this.createVertices(e),this.graphtext=document.getElementById(this.textId).getContext("2d"),this.draw()}resetVars(){this.startTime=null,this.clock=0,this.ratio=0,this.score=0,this.viewing=0,this.VERTEX_LENGTH=this.nPoints,this.graphY1=[...Array(this.VERTEX_LENGTH).fill(0)],this.graphY2=[...Array(this.VERTEX_LENGTH).fill(0)],this.xoffset=0,this.yoffset=0}createUI(t){var e='<div class="scale">       <table id="graphSliderTable">       <tr><td id="xoffsettd">X Offset:<br><input type="range" class="slider" id="xoffset" min=0 max=1000 value=0></td><td><button id="xoffsetbutton" class="button">Reset</button></td></tr>       <tr><td id="xscaletd">X Scale:<br><input type="range" class="slider" id="xscale" min=10 max='+(this.VERTEX_LENGTH*5).toFixed(0)+" value="+this.VERTEX_LENGTH.toFixed(0)+'></td><td><button id="xscalebutton" class="button">Reset</button></td></tr>       <tr><td id="yoffsettd">Y Offset:<br><input type="range" class="slider" id="yoffset" min=0 max=10000 value=5000></td><td><button id="yoffsetbutton" class="button">Reset</button></td></tr>       <tr><td id="yscaletd">Y Scale:<br><input type="range" class="slider" id="yscale" min=1 max=400 value='+this.yscale*200+'></td><td><button id="yscalebutton" class="button">Reset</button></td></tr>       </table><br>       <table id="graphViewTable"><tr><td id="autoscaletd">Autoscale:<input type="checkbox" id="autoscale" checked></td><td>View:</td><td><form name="graphform">Score<input type="radio" name="graphview" value="0" checked>Ratio<input type="radio" name="graphview" value="1"></form></td></tr></table>       </div>     ';HEGwebAPI.appendFragment(e,t),this.xoffsetSlider=document.getElementById("xoffset"),this.xscaleSlider=document.getElementById("xscale"),this.yoffsetSlider=document.getElementById("yoffset"),this.yscaleSlider=document.getElementById("yscale"),this.yoffsetSlider.oninput=()=>{this.yoffset=(this.yoffsetSlider.value-5e3)*.002},this.yscaleSlider.oninput=()=>{this.yscale=this.yscaleSlider.value*.005,this.invScale=1/this.yscale},document.getElementById("yoffsetbutton").onclick=()=>{this.yoffset=0},document.getElementById("yscalebutton").onclick=()=>{this.yscaleSlider.value=200,this.yscale=1,this.invScale=1},document.getElementById("autoscale").onclick=()=>{this.autoscale=document.getElementById("autoscale").checked};for(var s=document.graphform.graphview,a=0;a<s.length;a++)s[a].addEventListener("change",()=>{this.viewing=s.value})}setCanvasSize(){this.canvas.width=this.res[0],this.canvas.height=this.res[1],this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}initGL(t){this.canvas=document.querySelector("#"+t),this.gl=this.canvas.getContext("webgl"),this.setCanvasSize(),console.log(this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.clearColor(0,0,0,1)}makePoints(t,e){const s=t-1;return Array.from({length:t*2},(a,i)=>{const h=(i*.5|0)/s,o=i%2;return this.autoscale==!0&&(e[i]>this.invScale?(this.invScale=e[i],this.yscale=1/this.invScale,this.yscaleSlider.value=this.yscale*200):e[i]<0-this.invScale&&(this.invScale=0-e[i],this.yscale=1/this.invScale,this.yscaleSlider.value=this.yscale*200)),o?e[i]*this.yscale+this.yoffset:h*4-1})}createVertices(t,e=this.color){const s=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.DYNAMIC_DRAW);const a=this.gl.getAttribLocation(this.shaderProgram,"coords");this.gl.vertexAttribPointer(a,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(a);const i=this.gl.getUniformLocation(this.shaderProgram,"color");this.gl.uniform4f(i,this.normalize(e[0]),this.normalize(e[1]),this.normalize(e[2]),e[3])}createShader(){const t=this.VERTEX_SHADER,e=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(e,t),this.gl.compileShader(e);const s=this.FRAGMENT_SHADER,a=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(a,s),this.gl.compileShader(a),this.shaderProgram=this.gl.createProgram(),this.gl.attachShader(this.shaderProgram,e),this.gl.attachShader(this.shaderProgram,a),this.gl.linkProgram(this.shaderProgram),this.gl.useProgram(this.shaderProgram)}deInit(){cancelAnimationFrame(this.animationId)}normalize(t,e=255,s=0){return(t-s)/(e-s)}}export class circleJS{constructor(t="#34baeb",e="#ff3a17",s=[window.innerWidth,"440"],a="main_body",i="circlecanvas",n=!0,h="circlecanvasmenu"){d(this,"draw",()=>{this.defaultUI&&(window.innerWidth>=700?this.c.width=window.innerWidth-30:this.c.width=700);var t=this.c.width,e=this.c.height;this.ctx.clearRect(0,0,t,e),this.ctx.fillStyle=this.bgColor,this.ctx.fillRect(0,0,t,e);var s=this.ctx.createRadialGradient(t*.5,e*.5,2,t*.5,e*.5,100*this.angle*this.angle);s.addColorStop(0,"purple"),s.addColorStop(.25,"dodgerblue"),s.addColorStop(.32,"skyblue"),s.addColorStop(1,this.bgColor),this.ctx.fillStyle=s,this.ctx.fillRect(0,0,t,e),this.ctx.beginPath(),(this.angle>1.57||this.angleChange>0)&&(this.angle<3.14||this.angleChange<0)&&(this.angle+=this.angleChange*.1,this.soundFX!=null&&(this.soundFX.osc[0].frequency.value+=this.angleChange*100));var a=e*.04+e*.46*Math.abs(Math.cos(this.angle));this.ctx.arc(t*.5,e*.5,a,0,Math.PI*2,!1),this.ctx.closePath(),this.ctx.fillStyle=this.cColor,this.ctx.fill(),setTimeout(()=>{this.animationId=requestAnimationFrame(this.draw)},15)});this.createCanvas(a,i,s),this.c=document.getElementById(i),this.ctx=this.c.getContext("2d"),this.parentId=a,this.canvasId=i,this.canvasmenuId=h,this.soundFX=null,this.defaultUI=n,this.hidden=!1,n==!0&&this.createUI(a),this.c.width=s[0],this.c.height=s[1],this.animationId=null,this.angle=1.57,this.angleChange=0,this.bgColor=t,this.cColor=e,this.draw()}createCanvas(t,e,s=["600","600"]){var a='<div id="canvasContainer" class="canvasContainer"><canvas class="circlecss" id="'+e+'" height="'+s[1]+'" width="'+s[0]+'"></canvas></div>';HEGwebAPI.appendFragment(a,t)}createUI(t){var e='<div id="'+this.canvasmenuId+'" class="circleapi">     <table id="circletable" class="circletable">     <tr><td><button class="button" id="circleAudiobutton">Audio</button></td></tr>     </table>     </div>     <button id="showhide" name="showhide" class="showhide">Hide UI</button>';HEGwebAPI.appendFragment(e,t),document.getElementById("circleAudiobutton").style.opacity=.3,document.getElementById("circleAudiobutton").onclick=()=>{this.soundFX==null?(this.soundFX=new SoundJS,this.soundFX.gain.gain.value=.1,this.soundFX.playFreq([300]),document.getElementById("circleAudiobutton").style.opacity=1):this.soundFX.gain.gain.value==0?(this.soundFX.gain.gain.value=.1,document.getElementById("circleAudiobutton").style.opacity=1):(this.soundFX.gain.gain.value=0,document.getElementById("circleAudiobutton").style.opacity=.3)},document.getElementById("showhide").onclick=()=>{this.hidden==!1?(document.getElementById(canvasmenuId).style.display="none",document.getElementById("showhide").innerHTML="Show UI",this.hidden=!0):(document.getElementById(canvasmenuId).style.display="",document.getElementById("showhide").innerHTML="Hide UI",this.hidden=!1)}}deInit(){cancelAnimationFrame(this.animationId),this.soundFX!=null&&this.soundFX.osc[0].stop(0)}onData(t){this.angleChange=t}}export class videoJS{constructor(t=["700","440"],e="main_body",s="vidapi",a="vidbox",i=!0){d(this,"startVideo",()=>{this.playRate<.1?this.vidQuery.playbackRate=0:this.vidQuery.playbackRate=this.playRate});d(this,"stopVideo",()=>{this.vidQuery.playbackRate=0});d(this,"animateRect",()=>{this.defaultUI==!0&&this.sliderfocus==!1&&(this.timeSlider.value=Math.floor(1e3*this.vidQuery.currentTime/this.vidQuery.duration)),this.gl.clearColor(0,0,.1,this.alpha),this.gl.clear(this.gl.COLOR_BUFFER_BIT),setTimeout(()=>{this.animationId=requestAnimationFrame(this.animateRect)},15)});this.playRate=1,this.alpha=0,this.volume=.5,this.useAlpha=!0,this.useRate=!0,this.useVol=!0,this.useTime=!1,this.ampScore=0,this.ampThreshold=0,this.diff=0,this.enableControls=!1,this.parentId=e,this.vidapiId=s,this.vidContainerId=a,this.animationId=null,this.vidQuery,this.c,this.gl;var n='<div class="vidbox" id="'+this.vidContainerId+'"><video id="'+this.vidContainerId+'vid" height="'+t[1]+'px" width="'+t[0]+'px" class="vidcss" src="https://vjs.zencdn.net/v/oceans.mp4" type="video/mp4" autoplay loop muted></video>         <canvas class="vidglcss" id="'+this.vidContainerId+'canvas"></canvas></div>         <input class="file_wrapper" id="fs" name="fs" type="file" accept="video/*"/>';HEGwebAPI.appendFragment(n,e),this.defaultUI=i,this.sliderfocus=!1,this.hidden=!1,i==!0&&this.addUI(e),this.init(i)}setupButtons(){document.getElementById("startbutton").addEventListener("click",this.startVideo,!1),document.getElementById("stopbutton").addEventListener("click",this.stopVideo,!1),document.getElementById("play").onclick=()=>{this.vidQuery.playbackRate==0?(this.useRate==!0?this.vidQuery.playbackRate=this.playRate:(this.playRate=1,this.vidQuery.playbackRate=1),document.getElementById("play").innerHTML="||"):(this.vidQuery.playbackRate=0,document.getElementById("play").innerHTML=">")},document.getElementById("useAlpha").onclick=()=>{this.useAlpha==!0?(this.useAlpha=!1,this.alpha=0,document.getElementById("useAlpha").style.opacity="0.3"):(this.useAlpha=!0,document.getElementById("useAlpha").style.opacity="1.0")},document.getElementById("useRate").onclick=()=>{this.useRate==!0?(this.useRate=!1,this.playRate=1,this.vidQuery.playbackRate=1,document.getElementById("useRate").style.opacity="0.3"):(this.useTime=!1,this.useRate=!0,this.playRate=1,this.vidQuery.playbackRate=1,document.getElementById("useRate").style.opacity="1.0",document.getElementById("useTime").style.opacity="0.3")},document.getElementById("useVol").onclick=()=>{this.useVol==!0?(this.vidQuery.muted=!0,this.useVol=!1,this.volume=0,this.vidQuery.volume=0,document.getElementById("useVol").style.opacity="0.3"):(this.useVol=!0,this.vidQuery.muted=!1,this.volume=.5,this.vidQuery.volume=.5,document.getElementById("useVol").style.opacity="1.0")},document.getElementById("useTime").onclick=()=>{this.useTime==!0?(this.useTime=!1,this.playRate=1,this.vidQuery.playbackRate=1,document.getElementById("useTime").style.opacity="0.3"):(this.useRate=!1,this.useTime=!0,this.playRate=0,this.vidQuery.playbackRate=0,document.getElementById("useRate").style.opacity="0.3",document.getElementById("useTime").style.opacity="1.0")},this.timeSlider.addEventListener("change",()=>{var t=this.vidQuery.duration*(this.timeSlider.value/1e3);this.vidQuery.currentTime=t}),this.timeSlider.onmousedown=()=>{this.sliderfocus=!0},this.timeSlider.ontouchstart=()=>{this.sliderfocus=!0},this.timeSlider.onchange=()=>{this.sliderfocus=!1},document.getElementById("minus1min").onclick=()=>{this.vidQuery.currentTime-=60},document.getElementById("plus1min").onclick=()=>{this.vidQuery.currentTime+=60},document.getElementById("minus10sec").onclick=()=>{this.vidQuery.currentTime-=10},document.getElementById("plus10sec").onclick=()=>{this.vidQuery.currentTime+=10},document.getElementById("showhide").onclick=()=>{this.hidden==!1?(this.hidden=!0,document.getElementById("showhide").innerHTML="Show UI",document.getElementById("vidbuttons").style.display="none",document.getElementById("timeDiv").style.display="none",document.getElementById("fs").style.display="none"):(this.hidden=!1,document.getElementById("showhide").innerHTML="Hide UI",document.getElementById("vidbuttons").style.display="",document.getElementById("timeDiv").style.display="",document.getElementById("fs").style.display="")}}deInit(){document.getElementById("startbutton").removeEventListener("click",this.startVideo),document.getElementById("stopbutton").removeEventListener("click",this.stopVideo),cancelAnimationFrame(this.animationId)}addUI(t){var e='<div id="'+this.vidapiId+'">        <button class="showhide" id="showhide" name="showhide">Hide UI</button>        <div id="timeDiv" class="timeDiv"><input id="timeSlider" class="slider timeSlider" type="range" min="0" max="1000" value="0"><br><br>        <div id="vidbar" class="vidbar"><button id="minus1min" name="minus1min">--</button><button id="minus10sec" name="minus10sec">-</button><button id="play" name="play">||</button><button id="plus10sec" name="plus10sec">+</button><button id="plus1min" name="plus1min">++</button></div></div>        <div id="vidbuttons" class="vidbuttons"><table class="vidtable">           <tr><td>Feedback:</td></tr>           <tr><td><button class="button vdfade" id="useAlpha" name="useAlpha">Fade</button></td></tr>           <tr><td><button class="button vdspeed" id="useRate" name="useRate">Speed</button></td></tr>           <tr><td><button class="button vdvol" id="useVol" name="useVol">Volume</button></td></tr>           <tr><td><button class="button" id="useTime" name="useTime">Time</button></td></tr>           </table></div>         </div>';HEGwebAPI.appendFragment(e,t),document.getElementById("useTime").style.opacity="0.3",this.timeSlider=document.getElementById("timeSlider"),this.localFileVideoPlayer()}localFileVideoPlayer(){"use strict";var t=window.URL||window.webkitURL,e=function(i,n){var h=document.querySelector("#message");h.innerHTML=i,h.className=n?"error":"info"},s=function(i){var n=this.files[0],h=n.type,o=document.querySelector("video"),r=o.canPlayType(h);r===""&&(r="no");var l='Can play type "'+h+'": '+r,c=r==="no";if(e(l,c),!c){var m=t.createObjectURL(n);o.src=m}},a=document.querySelector('input[name="fs"]');a.addEventListener("change",s,!1)}onData(t){this.useAlpha==!0&&(this.alpha<.8||t>0)&&(this.alpha>0||t<0)&&(this.alpha-t<0?this.alpha=0:this.alpha-t>.8?this.alpha=.8:this.alpha-=t),this.useRate==!0&&(this.vidQuery.playbackRate<3||t<0)&&(this.vidQuery.playbackRate>0||t>0)&&(this.playRate=this.vidQuery.playbackRate+t*.5,this.playRate<.05&&this.playRate>0?this.vidQuery.playbackRate=0:this.playRate<0?this.vidQuery.currentTime+=t:this.playRate>.05&&this.playRate<.1?this.vidQuery.playbackRate=.1:this.vidQuery.playbackRate=this.playRate),this.useVol==!0&&(this.vidQuery.volume<1||t<0)&&(this.vidQuery.volume>0||t>0)&&(this.volume=this.vidQuery.volume+t*.5,this.volume<0?this.vidQuery.volume=0:this.volume>1?this.vidQuery.volume=1:this.vidQuery.volume=this.volume),this.useTime==!0&&(this.vidQuery.currentTime+=t*10)}init(t){this.vidQuery=document.getElementById(this.vidContainerId+"vid"),this.useVol==!0&&(this.vidQuery.muted=!1,this.vidQuery.volume=.5,this.volume=.5),this.c=document.getElementById(this.vidContainerId+"canvas"),this.c.width=this.vidQuery.width,this.c.height=this.vidQuery.height;var e=this.vidQuery.getBoundingClientRect();this.c.style.top=e.top+"px",this.c.style.height=e.bottom-e.top+"px",this.gl=this.c.getContext("webgl"),this.gl.clearColor(0,0,.1,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),t==!0&&this.setupButtons(),this.animateRect()}}export class audioJS{constructor(t=[window.innerWidth,"800"],e="main_body",s="audio",a="audmenu",i=!0){d(this,"drawMeter",()=>{var t=this.c.width,e=this.c.height,s=t/this.relativeWidth,a=new Uint8Array(this.audio.analyser.frequencyBinCount);if(this.audio.analyser.getByteFrequencyData(a),this.status===0){for(var i=a.length-1;i>=0;i--)a[i]=0;this.allCapsReachBottom=!0;for(var i=this.capYPositionArray.length-1;i>=0;i--)this.allCapsReachBottom=this.allCapsReachBottom&&this.capYPositionArray[i]===0;if(this.allCapsReachBottom){cancelAnimationFrame(this.animationId);return}}var n=Math.round(a.length*.75/this.meterNum);this.ctx.clearRect(0,0,t,e);for(var i=0;i<this.meterNum;i++){var h=a[i*n];this.capYPositionArray.length<this.meterNum&&this.capYPositionArray.push(h),this.capYPositionArray[i]=this.capYPositionArray[i]-.5,this.ctx.fillStyle=this.capStyle;var o=this.meterWidth*s+this.meterGap*s;h<this.capYPositionArray[i]?this.ctx.fillRect(i*o,e-this.capYPositionArray[i],this.meterWidth*s,this.capHeight):(this.ctx.fillRect(i*o,e-h,this.meterWidth*s,this.capHeight),this.capYPositionArray[i]=h),this.ctx.fillStyle=this.gradient,this.ctx.fillRect(i*o,e-h+this.capHeight,this.meterWidth*s,e)}});d(this,"drawLine",()=>{var t=this.c.width,e=this.c.height,s=t/this.relativeWidth,a=new Uint8Array(this.audio.analyser.frequencyBinCount);if(this.audio.analyser.getByteFrequencyData(a),this.status===0){for(var i=a.length-1;i>=0;i--)a[i]=0;this.allCapsReachBottom=!0;for(var i=this.capYPositionArray.length-1;i>=0;i--)this.allCapsReachBottom=this.allCapsReachBottom&&this.capYPositionArray[i]===0;if(this.allCapsReachBottom){cancelAnimationFrame(this.animationId);return}}var n=Math.round(a.length*.75/this.meterNum);this.ctx.clearRect(0,0,t,e),this.ctx.beginPath(),this.ctx.moveTo(0,e-this.capYPositionArray[0]*2);for(var i=0;i<this.meterNum;i++){var h=a[i*n];this.capYPositionArray[i]=h;var o=(this.meterWidth+this.meterGap)*s;this.ctx.lineTo(i*o,e-this.capYPositionArray[i]*2)}this.ctx.strokeStyle="red",this.ctx.stroke()});d(this,"drawCircle",()=>{var t=this.c.width*.5,e=this.c.height*.5,s=150,a=new Uint8Array(this.audio.analyser.frequencyBinCount);this.audio.analyser.getByteFrequencyData(a);var i=this.ctx.createRadialGradient(t,e,2,t,e,600+a[100]);i.addColorStop(0,"blue"),i.addColorStop(.25,"purple"),i.addColorStop(1,"rgba(255,69,0,0)"),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,this.c.width,this.c.height);var n=this.ctx.createRadialGradient(t*.2,e*1.7,1,t*.2,e*1.7,2+a[2]*.5);n.addColorStop(0,"yellow"),n.addColorStop(.2,"greenyellow"),n.addColorStop(1,"rgba(255,69,0,0)"),this.ctx.fillStyle=n,this.ctx.fillRect(0,0,this.c.width,this.c.height);var h=this.ctx.createRadialGradient(t*.2,e*.3,1,t*.2,e*.3,2+a[200]*.5);h.addColorStop(0,"red"),h.addColorStop(.2,"crimson"),h.addColorStop(1,"rgba(255,69,0,0)"),this.ctx.fillStyle=h,this.ctx.fillRect(0,0,this.c.width,this.c.height);var o=this.ctx.createRadialGradient(t*1.8,e*.3,1,t*1.8,e*.3,2+a[100]*.5);o.addColorStop(0,"hotpink"),o.addColorStop(.2,"magenta"),o.addColorStop(1,"rgba(255,69,0,0)"),this.ctx.fillStyle=o,this.ctx.fillRect(0,0,this.c.width,this.c.height);var r=this.ctx.createRadialGradient(t*1.8,e*1.7,1,t*1.8,e*1.7,2+a[50]*.5);r.addColorStop(0,"deepskyblue"),r.addColorStop(.2,"skyblue"),r.addColorStop(1,"rgba(255,69,0,0)"),this.ctx.fillStyle=r,this.ctx.fillRect(0,0,this.c.width,this.c.height);for(var l=0;l<this.meterNum;l++){var c=Math.PI*2/this.meterNum,m=a[l],v=t+Math.cos(c*l)*s,g=e+Math.sin(c*l)*s,f=t+Math.cos(c*l)*(s+m),y=e+Math.sin(c*l)*(s+m),x="rgb("+a[l]+", "+a[l]+", "+205+")";this.ctx.strokeStyle=x,this.ctx.lineWidth=this.capHeight,this.ctx.beginPath(),this.ctx.moveTo(v,g),this.ctx.lineTo(f,y),this.ctx.stroke()}});d(this,"draw",()=>{this.c.width=window.innerWidth,this.mode==0?this.drawMeter():this.mode==1?this.drawLine():this.mode==2&&this.drawCircle(),setTimeout(()=>{this.animationId=requestAnimationFrame(this.draw)},15)});this.audioId=s,this.audmenuId=a;var n='<div id="'+this.audioId+'" class="visualizerDiv" class-"canvasContainer">     <canvas class="audiocanvas" id="'+this.audioId+'canvas" width="'+t[0]+'" height="'+t[1]+'"></canvas>       </div>     ';HEGwebAPI.appendFragment(n,e),this.c=document.getElementById(this.audioId+"canvas"),this.ctx=this.c.getContext("2d"),this.gradient=this.ctx.createLinearGradient(0,0,0,this.c.height),this.gradient.addColorStop(1,"springgreen"),this.gradient.addColorStop(.75,"yellow"),this.gradient.addColorStop(0,"red"),this.defaultUI=i,this.hidden=!1,i==!0&&this.initUI(e),this.maxVol=.5,this.file=null,this.fileName=null,this.audio=null,this.info=document.getElementById("fileinfo").innerHTML,this.menu=document.getElementById(this.audmenuId),this.infoUpdateId=null,this.animationId=null,this.status=0,this.forceStop=!1,this.allCapsReachBottom=!1,this.useVol=!0,this.meterWidth=14,this.meterGap=2,this.capHeight=2,this.capStyle="#fff",this.meterNum=256,this.capYPositionArray=[],this.relativeWidth=this.meterNum*(this.meterWidth+this.meterGap),this.mode=2,this.init()}stopAudio(){this.animationId!==null&&cancelAnimationFrame(this.animationId),this.audio!==null&&this.audio.sourceList.length>0&&this.audio.sourceList[0].stop(0)}createVisualizer(t){this.audio.finishedLoading([t]),this.audio.sourceList[0].start(0),this.audio.gain.gain.setValueAtTime(this.maxVol,this.audio.ctx.currentTime),this.status=1,this.audio.sourceList[0].onended=()=>{this.endAudio()},this.updateInfo("Playing "+this.fileName,!1),this.info="Playing "+this.fileName,document.getElementById("fileWrapper").style.opacity=.2,this.draw()}initUI(t){var e='<div id="'+this.audmenuId+'">         <table id="audtable" class="audtable">          <tr><td>Feedback: </td></tr>           <tr><td><button id="useVol" name="useVol" class="button">Volume</button></td></tr>           <tr><td><button id="modebutton" name="modebutton" class="button">Mode</button></td></tr>         </table>        <input type="range" class="slider volSlider" id="volSlider" name="volSlider" min="0" max="100" value="'+toString(this.maxVol*100)+'">         <div id="fileWrapper" class="file_wrapper">           <div id="fileinfo"></div>           <input type="file" id="uploadedFile"></input>         </div>         </div>         <button id="showhide" name="showhide" class="showhide">Hide UI</button>       ';HEGwebAPI.appendFragment(e,t),document.getElementById("useVol").onclick=()=>{this.useVol==!1?(this.useVol=!0,document.getElementById("useVol").style.opacity="1.0"):(this.useVol=!1,this.maxVol=document.getElementById("volSlider").value*.01,this.audio.gain!=null&&this.audio.gain.gain.setValueAtTime(this.maxVol,this.audio.ctx.currentTime),document.getElementById("useVol").style.opacity="0.3")},document.getElementById("volSlider").oninput=()=>{this.maxVol=document.getElementById("volSlider").value*.01,this.audio.gain!=null&&this.audio.gain.gain.setValueAtTime(this.maxVol,this.audio.ctx.currentTime)},document.getElementById("modebutton").onclick=()=>{this.mode==0?this.mode=1:this.mode==1?this.mode=2:this.mode=0},document.getElementById("showhide").onclick=()=>{this.hidden==!1?(this.hidden=!0,document.getElementById("showhide").innerHTML="Show UI",document.getElementById(this.audmenuId).style.display="none"):(this.hidden=!1,document.getElementById("showhide").innerHTML="Hide UI",document.getElementById(this.audmenuId).style.display="")}}decodeAudio(){var t=this.file,e=new FileReader;e.onload=s=>{var a=s.target.result;this.audio.ctx!==null&&(this.updateInfo("Decoding the audio",!0),this.audio.ctx.decodeAudioData(a,i=>{this.updateInfo("Decode successful, starting the visualizer",!0),this.createVisualizer(i)},i=>{this.updateInfo("Failed to decode the file!",!1),console.log(i)}))},e.onerror=function(s){this.updateInfo("Failed to read the file!",!1),console.log(s)},this.updateInfo("Starting read the file",!0),e.readAsArrayBuffer(t)}onData(t){if(this.useVol==!0){var e=this.audio.gain.gain.value+t;e>this.maxVol&&(e=this.maxVol),e<0&&(e=0),this.defaultUI==!0&&(document.getElementById("volSlider").value=e*100),this.audio.gain.gain.value=e}}endAudio(){if(this.forceStop){this.forceStop=!1,this.status=1;return}this.status=0;var t="Song ended...";document.getElementById("fileWrapper").style.opacity=1,document.getElementById("fileinfo").innerHTML=t,this.info=t,document.getElementById("uploadedFile").value=""}updateInfo(t,e){var s=document.getElementById("fileinfo"),a="...",i=0;if(s.innerHTML=t+a.substring(0,i++),this.infoUpdateId!==null&&clearTimeout(this.infoUpdateId),e){var n=()=>{i>3&&(i=0),s.innerHTML=t+a.substring(0,i++),this.infoUpdateId=setTimeout(n,250)};this.infoUpdateId=setTimeout(n,250)}}init(){var t=document.getElementById("uploadedFile"),e=document.getElementById(this.audioId+"canvas");t.onchange=()=>{this.audio=new SoundJS,this.audio.ctx!==null&&t.files.length!==0&&(this.file=t.files[0],this.fileName=this.file.name,this.status===1&&(this.forceStop=!0),document.getElementById("fileWrapper").style.opacity=1,this.updateInfo("Uploading",!0),this.decodeAudio())},e.addEventListener("dragenter",()=>{document.getElementById("fileWrapper").style.opacity=1,this.updateInfo("Drop it on the page",!0)},!1),e.addEventListener("dragover",function(s){s.stopPropagation(),s.preventDefault(),s.dataTransfer.dropEffect="copy"},!1),e.addEventListener("dragleave",()=>{document.getElementById("fileWrapper").style.opacity=.2,this.updateInfo(this.info,!1)},!1),e.addEventListener("drop",s=>{s.stopPropagation(),s.preventDefault(),this.audio.ctx!==null&&(document.getElementById("fileWrapper").style.opacity=1,this.updateInfo("Uploading",!0),this.file=s.dataTransfer.files[0],this.status===1&&(document.getElementById("fileWrapper").style.opacity=1,this.forceStop=!0),this.fileName=this.file.name,this.decodeAudio())},!1)}}export class hillJS{constructor(t=["1400","500"],e=2e3,s="main_body",a="hillscanvas",i=!0,n="hillsmenu"){d(this,"draw",()=>{this.soundFX!=null&&(this.hillScore[this.hillScore.length-1]>this.hillScore[this.hillScore.length-2]?this.soundFX.playFreq([650+this.hillScore[this.hillScore.length-1]],.05):this.hillScore[this.hillScore.length-1]<this.hillScore[this.hillScore.length-2]&&this.soundFX.playFreq([250+this.hillScore[this.hillScore.length-1]],.05));var t=this.c.width,e=this.c.height,s=[],a=t/this.relativeWidth,i=(this.meterWidth+this.meterGap)*a,n=1;if(this.hillScore[this.hillScore.length-1]>e&&(n=e/this.hillScore[this.hillScore.length-1]),this.ctx.clearRect(0,0,t,e),this.mode==0)for(var h=0;h<this.hillNum;h++){var o=this.hillScore[h]*n;o<0&&(o=0),s.length<Math.round(this.hillNum)&&s.push(o),this.ctx.fillStyle=this.capStyle,o<s[h]?this.ctx.fillRect(h*i,e- --s[h],this.meterWidth*a,this.capHeight):(this.ctx.fillRect(h*i,e-o,this.meterWidth*a,this.capHeight),s[h]=o),this.ctx.fillStyle=this.gradient,this.ctx.fillRect(h*i,e-o+this.capHeight,this.meterWidth*a,e)}if(this.mode==1){this.ctx.fillStyle=this.gradient,this.ctx.beginPath(),this.ctx.moveTo(0,e-this.hillScore[0]);for(var h=0;h<this.hillNum;h++){var o=this.hillScore[h]*n;o<0&&(o=0),this.ctx.lineTo(h*i,e-o),h==this.hillNum-1&&this.ctx.lineTo(t,e-o)}this.ctx.lineTo(t,e),this.ctx.lineTo(0,e),this.ctx.closePath(),this.ctx.fill()}this.hillScore.shift(),this.hillScore.push(this.hillScore[this.hillScore.length-1]),setTimeout(()=>{this.animationId=requestAnimationFrame(this.draw)},this.updateInterval)});this.canvasId=a,this.canvasmenuId=n;var h='<div id="canvasContainer" class="canvasContainer">       <canvas class="hillcss" id="'+this.canvasId+'" width="'+t[0]+'" height="'+t[1]+'"></canvas>       ';HEGwebAPI.appendFragment(h,s),this.defaultUI=i,i==!0&&(this.initUI(s),this.menu=document.getElementById(this.canvasmenuId)),this.c=document.getElementById(this.canvasId),this.ctx=this.c.getContext("2d"),this.hidden=!1,this.soundFX=null,this.gradient=this.ctx.createLinearGradient(0,0,0,this.c.height),this.gradient.addColorStop(1,"dodgerblue"),this.gradient.addColorStop(.9,"green"),this.gradient.addColorStop(.8,"springgreen"),this.gradient.addColorStop(.65,"sandybrown"),this.gradient.addColorStop(.45,"slategray"),this.gradient.addColorStop(.35,"silver"),this.gradient.addColorStop(.2,"snow"),this.gradient.addColorStop(.1,"white"),this.gradient.addColorStop(0,"gold"),this.mode=1,this.updateInterval=e,this.allCapsReachBottom=!1,this.meterWidth=12,this.meterGap=2,this.hillNum=150,this.capHeight=2,this.capStyle="#fff",this.relativeWidth=this.hillNum*(this.meterWidth+this.meterGap),this.updateInterval=e,this.hillScore=[...Array(this.hillNum).fill(50)],this.animationId=null,this.draw()}cancelDraw(){this.animationId!=null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}initUI(t){var e='<div id="'+this.canvasmenuId+'" class="hillapi">     <table class="hilltable">     <tr><td><button class="button" id="hillsRbutton">Reset</button></td></tr>     <tr><td><button class="button" id="hillsModebutton">Mode</button></td></tr>     <tr><td><button class="button" id="hillsAudbutton">Audio</button></td></tr>     <tr><td><input type="number" id="speed" name="speed" placeholder="Update (Sec)"></input></td></tr>     <tr><td><button id="hillsSpeedbutton">Set Speed</button></tr></td>     </table>     </div>     <button id="showhide" name="showhide" class="showhide">Hide UI</button>';HEGwebAPI.appendFragment(e,t),document.getElementById("hillsAudbutton").style.opacity=.3,document.getElementById("hillsRbutton").onclick=()=>{this.hillScore=[...Array(this.hillNum).fill(50)]},document.getElementById("hillsModebutton").onclick=()=>{this.mode==0?this.mode=1:this.mode=0},document.getElementById("hillsAudbutton").onclick=()=>{this.soundFX==null?(this.soundFX=new SoundJS,document.getElementById("hillsAudbutton").style.opacity=1):this.soundFX.gain.gain.value==0?(this.soundFX.gain.gain.value=1,document.getElementById("hillsAudbutton").style.opacity=1):(this.soundFX.gain.gain.value=0,document.getElementById("hillsAudbutton").style.opacity=.3)},document.getElementById("hillsSpeedbutton").onclick=()=>{this.updateInterval=document.getElementById("speed").value*1e3},document.getElementById("startbutton").addEventListener("click",this.draw,!1),document.getElementById("stopbutton").addEventListener("click",this.cancelDraw,!1),document.getElementById("showhide").onclick=()=>{this.hidden==!1?(this.hidden=!0,document.getElementById("showhide").innerHTML="Show UI",document.getElementById(this.canvasmenuId).style.display="none"):(this.hidden=!1,document.getElementById("showhide").innerHTML="Hide UI",document.getElementById(this.canvasmenuId).style.display="")}}deInit(){document.getElementById("startbutton").removeEventListener("click",this.draw),document.getElementById("stopbutton").removeEventListener("click",this.cancelDraw),this.soundFX!=null&&this.soundFX.osc[0]!=null&&this.soundFX.osc[0].stop(0)}onData(t){var e=this.hillScore[this.hillScore.length-1]+t*20;this.hillScore[this.hillScore.length-1]=e,this.hillScore[this.hillScore.length-1]<10&&(this.hillScore[this.hillScore.length-1]=10),t>0&&(this.hillScore[this.hillScore.length-1]+=.5),t<0&&(this.hillScore[this.hillScore.length-1]-=.3)}}export class textReaderJS{constructor(t="this is a test",e=["800","400"],s="main_body",a="textcanvas",i=!0,n="textcanvasmenu"){d(this,"startpxf",()=>{this.pxf=this.lastpxf});d(this,"stoppxf",()=>{this.lastpxf=this.pxf,this.pxf=0});d(this,"draw",()=>{this.maxXPos=this.c.width,this.textXPos+=this.pxf,this.ctx.clearRect(0,0,this.c.width,this.c.height),this.ctx.font="2em Arial",this.ctx.fillStyle="#ffffff",this.ctx.fillText(this.text,this.maxXPos-this.textXPos,this.c.height*.5),setTimeout(()=>{this.animationId=requestAnimationFrame(this.draw)},15)});this.text=t,this.canvasId=a,this.canvasmenuId=n,this.parentId=s;var h="<div id='"+this.canvasId+"container' class='canvasContainer'><canvas id='"+this.canvasId+"' class='textreadercss' width='"+e[0]+"' height='"+e[1]+"'></canvas></div>";HEGwebAPI.appendFragment(h,s),this.defaultUI=i,this.hidden=!1,i==!0&&(this.text="Leap clear of all that is corporeal, and make yourself grown to a like expanse with that greatness which is beyond all measure... rise above all time and become eternal... then you will apprehend God.       Think that for you too nothing is impossible; deem that you too are immortal, and that you are able to grasp all things in your thought, to know every craft and science; find your home in the haunts of every living creature;       make yourself higher than all heights and lower than all depths; bring together in yourself all opposites of quality, heat and cold, dryness and fluidity;       think that you are everywhere at once, on land, at sea, in heaven; think that you are not yet begotten, that you are in the womb, that you are young, that you are old, that you have died, that you are in the world beyond the grave;       grasp in your thought all of this at once, all times and places, all substances and qualities and magnitudes together; then you can apprehend God.       But if you shut up your soul in your body, and abase yourself, and say \u201CI know nothing, I can do nothing; I am afraid of earth and sea, I cannot mount to heaven; I know not what I was, nor what I shall be,\u201D then what have you to do with God?",this.initUI()),this.c=document.getElementById(this.canvasId),this.ctx=this.c.getContext("2d"),this.pxf=.5,this.lastpxf=this.pxf,this.textXPos=0,this.maxXPos=window.innerWidth,this.animationId,this.draw()}initUI(){var t="<div id='"+this.canvasmenuId+"' class='textmenu'>     <textarea id='"+this.canvasId+"Textarea'>Breathe in, Breathe out, Breathe in, Breathe out...</textarea><br>     <button id='"+this.canvasId+"submittext' class='button'>Submit</button>     </div><button id='showhide' name='showhide' class='showhide'>Hide UI</button>";HEGwebAPI.appendFragment(t,this.parentId),document.getElementById(this.canvasId+"submittext").onclick=()=>{this.text=document.getElementById(this.textId+"Textarea").value,this.textXPos=0},document.getElementById("showhide").onclick=()=>{this.hidden==!1?(this.hidden=!0,document.getElementById("showhide").innerHTML="Show UI",document.getElementById(this.canvasId+"menu").style.display="none"):(this.hidden=!1,document.getElementById("showhide").innerHTML="Hide UI",document.getElementById(this.canvasId+"menu").style.display="")},document.getElementById("startbutton").addEventListener("click",this.startpxf,!1),document.getElementById("stopbutton").addEventListener("click",this.stoppxf,!1)}deInit(){document.getElementById("startbutton").removeEventListener("click",this.startpxf),document.getElementById("stopbutton").removeEventListener("click",this.stoppxf)}onData(t){this.pxf+=t}}export class boidsJS{constructor(t=200,e=[window.innerWidth,"440"],s="main_body",a="boidscanvas",i=!0,n="boidscanvasmenu"){d(this,"draw",()=>{var t=this.calcBoids();if(t==!0){var e=performance.now()*5e-5,s=[Math.sin(e)*Math.sin(e)*this.renderer.canvas.width*.3+this.renderer.canvas.width*.2,this.renderer.canvas.height*.3,0];this.swirlAnchor=s,this.attractorAnchor=s,this.lastFrame=this.thisFrame,this.thisFrame=performance.now(),this.frameRate=(this.thisFrame-this.lastFrame)*.001,this.boidsPos.forEach((a,i)=>{i<=this.renderer.particles.length&&(this.renderer.particles[i].vx+=this.boidsVel[i][0]*this.frameRate*this.boidsMul,this.renderer.particles[i].vy+=this.boidsVel[i][1]*this.frameRate*this.boidsMul),this.boidsPos[i][0]=this.renderer.particles[i].x,this.boidsPos[i][1]=this.renderer.particles[i].y})}setTimeout(()=>{this.animationId=requestAnimationFrame(this.draw)},20)});this.parentId=s,this.res=e,this.canvasId=a,this.defaultUI=i,this.canvasMenuId=n,this.animationId=null,this.boidsCount=t,this.boidsPos=[],this.boidsVel=[],this.groupingSize=10,this.groupingRadius=1e4,this.boidsMul=1,this.dragMul=.1,this.cohesionMul=.01,this.alignmentMul=.5,this.separationMul=3,this.swirlMul=5e-4,this.attractorMul=.003,this.useAttractor=!0,this.useSwirl=!0,this.attractorAnchor=[.5,.5,0],this.swirlAnchor=[.5,.5,0],this.boundingBox,this.lastFrame=0,this.thisFrame=0,this.frameRate=0,this.renderer=new Particles(!1,this.boidsCount,this.res,this.parentId,this.canvasId,this.defaultUI,this.canvasmenuId);var h=()=>{setTimeout(()=>{if(this.renderer.particles.length==this.renderer.settings.maxParticles){this.swirlAnchor=[this.renderer.canvas.width*.45,this.renderer.canvas.height*.5,0],this.attractorAnchor=this.swirlAnchor;for(var o=0;o<this.boidsCount;o++)this.boidsPos.push([Math.random()*this.renderer.canvas.width,Math.random()*this.renderer.canvas.height,Math.random()]),this.renderer.particles[idx].x=this.boidsPos[o][0],this.renderer.particles[idx].y=this.boidsPos[o][1],this.boidsVel.push([Math.random()*.01,Math.random()*.01,Math.random()*.01]);this.animationId=requestAnimationFrame(this.draw)}else h()},300)};h()}calcBoids(){for(var t=[],e=0;e<this.boidsCount;e++){var s=[],a=[],i=this.boidsPos[e],n=[0,0,0],h=this.boidsVel[e],o=0;t:for(var r=0;r<this.boidsCount;r++){var l=Math.floor(Math.random()*this.boidsCount);if(l!==e){if(a.length>this.groupingSize)break t;var c=this.distance3D(this.boidsPos[e],this.boidsPos[l]);c>this.groupingRadius||(a.push(c),s.push(l),i=[i[0]+this.boidsPos[l][0],i[1]+this.boidsPos[l][1],i[2]+this.boidsPos[l][2]],n=[n[0]+(this.boidsPos[e][0]-this.boidsPos[l][0])*(1/c),n[1]+this.boidsPos[e][1]-this.boidsPos[l][1]*(1/c),n[2]+(this.boidsPos[e][2]-this.boidsPos[l][2]+1)*(1/c)],(n[0]==Infinity||n[0]==-Infinity||n[0]>3||n[0]<-3||n[1]==Infinity||n[1]==-Infinity||n[1]>3||n[1]<-3||n[2]==Infinity||n[2]==-Infinity||n[2]>3||n[2]<-3)&&(n=[Math.random()*4-2,Math.random()*4-2,Math.random()*4-2]),h=[h[0]+this.boidsVel[l][0],h[1]+this.boidsVel[l][1],h[2]+this.boidsVel[l][2]],o++)}}i=[this.cohesionMul*(i[0]/o-this.boidsPos[e][0]),this.cohesionMul*(i[1]/o-this.boidsPos[e][1]),this.cohesionMul*(i[2]/o-this.boidsPos[e][2])],h=[-(this.alignmentMul*h[1]/o),this.alignmentMul*h[0]/o,this.alignmentMul*h[2]/o],n=[this.separationMul*n[0],this.separationMul*n[1],this.separationMul*n[2]];var m=[0,0,0];this.useSwirl==!0&&(m=[-(this.boidsPos[e][1]-this.swirlAnchor[1])*this.swirlMul,(this.boidsPos[e][0]-this.swirlAnchor[0])*this.swirlMul,(this.boidsPos[e][2]-this.swirlAnchor[2])*this.swirlMul]);var v=[0,0,0];this.useAttractor==!0&&(v=[(this.attractorAnchor[0]-this.boidsPos[e][0])*this.attractorMul,(this.attractorAnchor[1]-this.boidsPos[e][1])*this.attractorMul,(this.attractorAnchor[2]-this.boidsPos[e][2])*this.attractorMul]),t.push([this.boidsVel[e][0]*this.dragMul+i[0]+h[0]+n[0]+m[0]+v[0],this.boidsVel[e][1]*this.dragMul+i[1]+h[1]+n[1]+m[1]+v[1],this.boidsVel[e][2]*this.dragMul+i[2]+h[2]+n[2]+m[2]+v[1]])}return t.length==this.boidsCount?(this.boidsVel=t,!0):!1}distance3D(t,e){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}shuffleArr(t){for(var e=[];t.length>0;){var s=Math.floor(Math.random()*t.length);e.push(t[s])}return e}deInit(){cancelAnimationFrame(this.animationId)}onData(t){this.swirlMul+=t*3e-4,this.swirlMul<0?this.swirlMul=0:this.swirlMul>.01&&(this.swirlMul=.01)}}export class Particles{constructor(t=!0,e=100,s=[window.innerWidth,"440"],a="main_body",i="particlecanvas",n=!0,h="particlecanvas"){d(this,"updateParticle",t=>{if(this.particles[t].x+=this.particles[t].vx+this.particles[t].vx*this.frameRate,this.particles[t].y+=this.particles[t].vy+this.particles[t].vx*this.frameRate,this.particles[t].vx>this.settings.maxSpeed||this.particles[t].vy>this.settings.maxSpeed||this.particles[t].vx<-this.settings.maxSpeed||this.particles[t].vy<-this.settings.maxSpeed){var e=this.normalize2D([this.particles[t].vx,this.particles[t].vy]);this.particles[t].vx=e[0]*this.settings.maxSpeed,this.particles[t].vy=e[1]*this.settings.maxSpeed}this.particles[t].y+this.settings.particleSize>this.settings.groundLevel&&(this.particles[t].vy*=this.settings.yBounce,this.particles[t].vx*=-this.settings.xBounce,this.particles[t].y=this.settings.groundLevel-this.settings.particleSize),this.particles[t].y-this.settings.particleSize<this.settings.ceilingWall&&(this.particles[t].vy*=this.settings.yBounce,this.particles[t].vx*=-this.settings.xBounce,this.particles[t].y=this.settings.ceilingWall+this.settings.particleSize),this.particles[t].x-this.settings.particleSize<=this.settings.leftWall&&(this.particles[t].vx*=this.settings.xBounce,this.particles[t].x=this.settings.leftWall+this.settings.particleSize),this.particles[t].x+this.settings.particleSize>=this.settings.rightWall&&(this.particles[t].vx*=this.settings.xBounce,this.particles[t].x=this.settings.rightWall-this.settings.particleSize),this.particles[t].vy+=this.settings.gravity,this.particles[t].life++,this.particles[t].life>=this.particles[t].maxLife&&this.particles.splice(t,1)});d(this,"draw",()=>{if(this.lastFrame=this.thisFrame,this.thisFrame=performance.now(),this.frameRate=(this.thisFrame-this.lastFrame)*.001,this.context.fillStyle="rgba(10,10,10,0.8)",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="red",this.context.fillRect(0,0,this.settings.leftWall,this.canvas.height),this.context.fillRect(this.settings.rightWall,0,this.canvas.width,this.canvas.height),this.context.fillRect(0,this.settings.groundLevel,this.canvas.width,this.canvas.height),this.context.fillRect(0,0,this.canvas.width,this.settings.ceilingWall),this.particles.length<this.settings.maxParticles)for(var t=0;t<this.settings.maxParticles-this.particles.length;t++)this.genParticle();for(var t in this.particles)this.updateParticle(t),this.context.clearRect(this.settings.leftWall,this.settings.groundLevel,this.canvas.width,this.canvas.height),this.context.beginPath(),this.context.fillStyle="rgb("+String(Math.abs(this.particles[t].vx)*75)+","+String(Math.abs(this.particles[t].vx)*25)+","+String(255-Math.abs(this.particles[t].vx)*75)+")",this.context.arc(this.particles[t].x,this.particles[t].y,this.settings.particleSize,0,Math.PI*2,!0),this.context.closePath(),this.context.fill();setTimeout(()=>{this.animationId=requestAnimationFrame(this.draw)},20)});this.canvasId=i,this.parentId=a,this.defaultUI=n,this.canvasmenuId=h;var o='<div id="canvasContainer" class="canvasContainer">       <canvas class="boidscss" id="'+this.canvasId+'" width="'+s[0]+'" height="'+s[1]+'"></canvas>       ';HEGwebAPI.appendFragment(o,this.parentId),this.canvas=document.getElementById(this.canvasId),this.context=this.canvas.getContext("2d"),this.animationId=null,this.lastFrame=0,this.thisFrame=0,this.frameRate=1,this.useDefaultAnim=t,this.posX=20,this.posY=this.canvas.height/2,this.particles=[],this.particleIndex=0,this.settings={maxParticles:e,particleSize:5,startingX:this.canvas.width/2,startingY:this.canvas.height/4,maxSpeed:3,xBounce:-1,yBounce:-1,gravity:0,maxLife:Infinity,groundLevel:this.canvas.height*.999,leftWall:this.canvas.width*.001,rightWall:this.canvas.width*.999,ceilingWall:this.canvas.height*.001},this.seedsX=[],this.seedsY=[],this.currentAngle=0,this.useDefaultAnim==!0&&this.seedAngles(),this.animationId=requestAnimationFrame(this.draw)}seedAngles(){this.seedsX=[],this.seedsY=[];for(var t=0;t<this.settings.maxParticles;t++)this.seedsX.push(Math.random()*20-10),this.seedsY.push(Math.random()*30-10)}genParticle(){if(this.particleIndex!==this.settings.maxParticles){var t={};t.x=this.settings.startingX,t.y=this.settings.startingY,t.vx=0,t.vy=0,this.useDefaultAnim==!0&&(t.vx=this.seedsX[this.currentAngle],t.vy=this.seedsY[this.currentAngle],this.currentAngle++),t.id=this.particleIndex,t.life=0,t.maxLife=this.settings.maxLife,this.particles[this.particleIndex]=t,this.particleIndex++}else this.useDefaultAnim==!0&&(this.seedAngles(),this.currentAngle=0),this.particleIndex=0}normalize2D(t=[]){var e=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2));return[t[0]/e,t[1]/e]}deInit(){cancelAnimationFrame(this.animationId)}}export class BufferLoader{constructor(t,e,s){this.ctx=t,this.urlList=e,this.onload=s,this.bufferList=new Array,this.loadCount=0}loadBuffer(t="",e){var s=new XMLHttpRequest;s.responseType="arraybuffer";var a=null;if(t.indexOf("http://")!=-1||t.indexOf("file://")!=-1){s.open("GET",t,!0),s.onreadystatechange=()=>{s.readyState===4&&(s.status===200||s.status==0)&&(a=s.response)};var i=this;s.onload=function(){i.ctx.decodeAudioData(a,function(o){if(!o){alert("error decoding file data: "+t);return}i.bufferList[e]=o,++i.loadCount==i.urlList.length&&i.onload(i.bufferList)},function(o){console.error("decodeAudioData error: ",o)})},s.onerror=function(){alert("BufferLoader: XHR error")},s.send()}else{var i=this,n=new FileReader;n.onload=function(r){var l=r.target.result,c=i.ctx;c!==null&&(console.log("Decoding audio..."),c.decodeAudioData(l,function(m){if(m)console.log("File decoded successfully!");else{alert("Error decoding file data: "+t);return}i.bufferList[e]=m,++i.loadCount==i.urlList.length&&i.onload(i.bufferList)},function(m){console.error("decodeAudioData error: ",m)}))},n.onerror=function(r){console.log(r)};var h=document.createElement("input");h.type="file",h.multiple=!0,h.onchange=r=>{n.readAsArrayBuffer(r.target.files[0]),h.value=""},h.click()}}load(){for(var t=0;t<this.urlList.length;++t)this.loadBuffer(this.urlList[t],t)}}export class SoundJS{constructor(){d(this,"finishedLoading",t=>{t.forEach(e=>{this.sourceList.push(this.ctx.createBufferSource());var s=this.sourceList.length-1;this.sourceList[s].buffer=e,this.sourceList[s].onended=()=>{this.sourceList.splice(s,1)},this.sourceList[s].connect(this.gain)})});window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,this.ctx=null;try{this.ctx=new AudioContext}catch(t){alert("Your browser does not support AudioContext!"),console.log(t)}this.sourceList=[],this.recordedData=[],this.recorder=null,this.buffer=[],this.osc=[],this.gain=this.ctx.createGain(),this.analyser=this.ctx.createAnalyser(),this.out=this.ctx.destination,this.gain.connect(this.analyser),this.analyser.connect(this.out)}playFreq(t=[1e3],e=0,s="sine",a=this.ctx.currentTime){t.forEach(i=>{var n=this.osc.length;this.osc[n]=this.ctx.createOscillator(),this.osc[n].start(),this.osc[n].onended=()=>{this.osc.splice(n,1)},this.osc[n].type=s,this.osc[n].connect(this.gain),this.osc[n].frequency.setValueAtTime(i,a),e!=0&&this.osc[n].stop(a+e)})}stopFreq(t=0,e=1,s=0){for(var a=t;a<e;a++)this.osc[oscIndex]?this.osc[oscIndex].stop(this.ctx.currentTime+s):console.log("No oscillator found.")}addSounds(t=[""]){var e=new BufferLoader(this.ctx,t,this.finishedLoading);e.load()}playSound(t,e=0,s=!1,a=this.ctx.currentTime){s==!0&&(this.sourceList[t].loop=!0),this.sourceList[t].start(a),e!=0&&this.sourceList[t].stop(a+e)}stopSound(t){this.sourceList[t].stop(0)}setPlaybackRate(t,e){this.sourceList[t].playbackRate.value=e}record(t=new Date().toISOString(),e={audio:!0,video:!1},s=null,a=null){var i=null,n=null,h=s;h==null&&(e.video!=!1?h=["video/webm","video/webm;codecs=vp8","video/webm;codecs=vp9","video/webm;codecs=vp8.0","video/webm;codecs=vp9.0","video/webm;codecs=h264","video/webm;codecs=H264","video/webm;codecs=avc1","video/webm;codecs=vp8,opus","video/WEBM;codecs=VP8,OPUS","video/webm;codecs=vp9,opus","video/webm;codecs=vp8,vp9,opus","video/webm;codecs=h264,opus","video/webm;codecs=h264,vp9,opus","video/x-matroska;codecs=avc1"]:e.audio==!0&&(h=["audio/wav","audio/mp3","audio/webm","audio/webm;codecs=opus","audio/webm;codecs=pcm","audio/ogg","audio/x-matroska"]));for(var o=0;o<h.length;o++)if(MediaRecorder.isTypeSupported(h[o])==!0){i=h[o],console.log("Supported type: ",i),h[o].indexOf("webm")!=-1&&(n=".webm"),h[o].indexOf("ogg")!=-1&&(n=".ogg"),h[o].indexOf("mp3")!=-1&&(n=".mp3"),h[o].indexOf("wav")!=-1&&(n=".wav"),h[o].indexOf("x-matroska")!=-1&&(n=".mkv");break}if(i!=null){let r=function(l){console.log(l)};navigator.mediaDevices.getUserMedia(e).then(l=>{console.log("Media stream created."),a!=null&&(a.src=window.URL.createObjectURL(l)),this.recorder=new MediaRecorder(l),this.recorder.onstop=c=>{console.log("Media recorded, saving...");var m=new Blob(this.recordedData,{type:i}),v=URL.createObjectURL(m),g=document.createElement("a");document.body.appendChild(g),g.style="display: none",g.href=v,g.download=t+n,g.click(),window.URL.revokeObjectURL(v)},this.recorder.ondataavailable=c=>{this.recordedData.push(c.data)},this.recorder.start()},r)}else alert("Cannot record! Check function call settings, ensure browser is compatible.")}replayRecording(t){this.recordedData.length>1&&(this.buffer=new Blob(this.recordedData),t.src=window.URL.createObjectURL(buffer))}}export class geolocateJS{constructor(){navigator.geolocation||alert("Geolocation not supported in this browser!"),this.locationData=[]}showPosition(t){this.locationData.push(new Date().toISOString()+","+t.coords.latitude+","+t.coords.longitude)}getPosition(){navigator.geolocation.getCurrentPosition(this.showPosition)}}export class bleUtils{constructor(t=!1,e="6e400001-b5a3-f393-e0a9-e50e24dcca9e",s="6e400002-b5a3-f393-e0a9-e50e24dcca9e",a="6e400003-b5a3-f393-e0a9-e50e24dcca9e",i=!0,n="main_body",h="blebutton"){d(this,"initBLE",(t=this.serviceUUID,e=this.rxUUID,s=this.txUUID)=>{navigator.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:[t]}).then(i=>(this.device=i,i.gatt.connect())).then(a(100)).then(i=>i.getPrimaryService(t)).then(a(100)).then(i=>(this.service=i,i.getCharacteristic(e).then(a(100)).then(n=>(this.rxchar=n,n.writeValue(this.encoder.encode("t")))),this.android==!0&&i.getCharacteristic(e).then(a(1e3)).then(n=>n.writeValue(this.encoder.encode("o"))),i.getCharacteristic(s))).then(a(1100)).then(i=>(this.txchar=i,i.startNotifications())).then(a(100)).then(i=>{i.addEventListener("characteristicvaluechanged",this.onNotificationCallback)}).then(a(100)).then(this.onConnectedCallback()).catch(i=>{console.error(i)});function a(i){return function(n){return new Promise(h=>setTimeout(()=>h(n),i))}}});d(this,"onNotificationCallback",t=>{var e=this.decoder.decode(t.target.value);console.log("BLE MSG: ",e)});d(this,"onConnectedCallback",()=>{});d(this,"sendMessage",t=>{this.rxchar.writeValue(this.encoder.encode(t))});d(this,"disconnect",()=>{var t;return(t=this.server)==null?void 0:t.disconnect()});d(this,"onDisconnected",()=>{console.log("BLE device disconnected!")});d(this,"onReadAsyncCallback",t=>{console.log("BLE Data: ",t)});d(this,"stopReadAsync",()=>{this.doReadHeg=!1,tx.writeValue(this.encoder.encode("f"))});d(this,"spsinterval",()=>{setTimeout(()=>{console.log("SPS",this.n+""),this.n=0,this.spsinterval()},1e3)});this.serviceUUID=e,this.rxUUID=s,this.txUUID=a,this.encoder=new TextEncoder("utf-8"),this.decoder=new TextDecoder("utf-8"),this.device=null,this.server=null,this.service=null,this.rxchar=null,this.txchar=null,this.parentId=n,this.buttonId=h,this.async=t,this.android=navigator.userAgent.toLowerCase().indexOf("android")>-1,this.n,(i=!0)&&this.initUI(n,h)}initUI(t,e){this.device!=null&&this.device.gatt.connected&&(this.device.gatt.disconnect(),console.log("device disconnected"));var s='<button id="'+e+'">BLE Connect</button>';HEGwebAPI.appendFragment(s,t),document.getElementById(e).onclick=()=>{this.async===!1?this.initBLE():this.initBLEasync()}}connectAsync(){return p(this,null,function*(){var a;this.device=yield navigator.bluetooth.requestDevice({filters:[{namePrefix:"HEG"}],optionalServices:[this.serviceUUID]}),console.log("BLE Device: ",this.device);const t=yield(a=this.device.gatt)==null?void 0:a.connect();if(!t)throw"no connection";this.device.addEventListener("gattserverdisconnected",onDisconnected),this.server=t;const e=yield this.server.getPrimaryService(this.serviceUUID),s=yield e.getCharacteristic(this.rxUUID);return yield s.writeValue(this.encoder.encode("t")),this.android==!0&&(yield s.writeValue(this.encoder.encode("o"))),this.characteristic=yield e.getCharacteristic(this.txUUID),this.onConnectedCallback(),!0})}readDeviceAsync(){return p(this,null,function*(){if(!this.characteristic)throw console.log("HEG not connected"),"error";this.doReadHeg=!0;for(var t="";this.doReadHeg;){const e=this.decoder.decode(yield this.characteristic.readValue());e!==this.data&&(t=e,console.log(t),this.n+=1,this.onReadAsyncCallback(t))}})}initBLEasync(){return p(this,null,function*(){yield this.connectAsync(),this.readDeviceasync(),this.spsinterval()})}}
