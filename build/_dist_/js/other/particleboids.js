var f=Object.defineProperty;var v=(o,t,s)=>(typeof t!="symbol"&&(t+=""),t in o?f(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s);export class boidsJS{constructor(t=200,s=[window.innerWidth,"440"],n="main_body",l="boidscanvas",h=!0,i="boidscanvasmenu"){v(this,"draw",()=>{var t=this.calcBoids();if(t==!0){var s=performance.now()*5e-5,n=[Math.sin(s)*Math.sin(s)*this.renderer.canvas.width*.3+this.renderer.canvas.width*.2,this.renderer.canvas.height*.3,0];this.swirlAnchor=n,this.attractorAnchor=n,this.lastFrame=this.thisFrame,this.thisFrame=performance.now(),this.frameRate=(this.thisFrame-this.lastFrame)*.001,this.boidsPos.forEach((l,h)=>{h<=this.renderer.particles.length&&(this.renderer.particles[h].vx+=this.boidsVel[h][0]*this.frameRate*this.boidsMul,this.renderer.particles[h].vy+=this.boidsVel[h][1]*this.frameRate*this.boidsMul),this.boidsPos[h][0]=this.renderer.particles[h].x,this.boidsPos[h][1]=this.renderer.particles[h].y})}setTimeout(()=>{this.animationId=requestAnimationFrame(this.draw)},20)});this.parentId=n,this.res=s,this.canvasId=l,this.defaultUI=h,this.canvasMenuId=i,this.animationId=null,this.boidsCount=t,this.boidsPos=[],this.boidsVel=[],this.groupingSize=10,this.groupingRadius=1e4,this.boidsMul=1,this.dragMul=.1,this.cohesionMul=.01,this.alignmentMul=.5,this.separationMul=3,this.swirlMul=5e-4,this.attractorMul=.003,this.useAttractor=!0,this.useSwirl=!0,this.attractorAnchor=[.5,.5,0],this.swirlAnchor=[.5,.5,0],this.boundingBox,this.lastFrame=0,this.thisFrame=0,this.frameRate=0,this.renderer=new Particles(!1,this.boidsCount,this.res,this.parentId,this.canvasId,this.defaultUI,this.canvasmenuId);var e=()=>{setTimeout(()=>{if(this.renderer.particles.length==this.renderer.settings.maxParticles){this.swirlAnchor=[this.renderer.canvas.width*.45,this.renderer.canvas.height*.5,0],this.attractorAnchor=this.swirlAnchor;for(var r=0;r<this.boidsCount;r++)this.boidsPos.push([Math.random()*this.renderer.canvas.width,Math.random()*this.renderer.canvas.height,Math.random()]),this.boidsVel.push([Math.random()*.01,Math.random()*.01,Math.random()*.01]);this.boidsPos.forEach((d,a)=>{this.renderer.particles[a].x=d[0],this.renderer.particles[a].y=d[1]}),this.animationId=requestAnimationFrame(this.draw)}else e()},300)};e()}calcBoids(){for(var t=[],s=0;s<this.boidsCount;s++){var n=[],l=[],h=this.boidsPos[s],i=[0,0,0],e=this.boidsVel[s],r=0;t:for(var d=0;d<this.boidsCount;d++){var a=Math.floor(Math.random()*this.boidsCount);if(a!==s){if(l.length>this.groupingSize)break t;var c=this.distance3D(this.boidsPos[s],this.boidsPos[a]);c>this.groupingRadius||(l.push(c),n.push(a),h=[h[0]+this.boidsPos[a][0],h[1]+this.boidsPos[a][1],h[2]+this.boidsPos[a][2]],i=[i[0]+(this.boidsPos[s][0]-this.boidsPos[a][0])*(1/c),i[1]+this.boidsPos[s][1]-this.boidsPos[a][1]*(1/c),i[2]+(this.boidsPos[s][2]-this.boidsPos[a][2]+1)*(1/c)],(i[0]==Infinity||i[0]==-Infinity||i[0]>3||i[0]<-3||i[1]==Infinity||i[1]==-Infinity||i[1]>3||i[1]<-3||i[2]==Infinity||i[2]==-Infinity||i[2]>3||i[2]<-3)&&(i=[Math.random()*4-2,Math.random()*4-2,Math.random()*4-2]),e=[e[0]+this.boidsVel[a][0],e[1]+this.boidsVel[a][1],e[2]+this.boidsVel[a][2]],r++)}}h=[this.cohesionMul*(h[0]/r-this.boidsPos[s][0]),this.cohesionMul*(h[1]/r-this.boidsPos[s][1]),this.cohesionMul*(h[2]/r-this.boidsPos[s][2])],e=[-(this.alignmentMul*e[1]/r),this.alignmentMul*e[0]/r,this.alignmentMul*e[2]/r],i=[this.separationMul*i[0],this.separationMul*i[1],this.separationMul*i[2]];var u=[0,0,0];this.useSwirl==!0&&(u=[-(this.boidsPos[s][1]-this.swirlAnchor[1])*this.swirlMul,(this.boidsPos[s][0]-this.swirlAnchor[0])*this.swirlMul,(this.boidsPos[s][2]-this.swirlAnchor[2])*this.swirlMul]);var g=[0,0,0];this.useAttractor==!0&&(g=[(this.attractorAnchor[0]-this.boidsPos[s][0])*this.attractorMul,(this.attractorAnchor[1]-this.boidsPos[s][1])*this.attractorMul,(this.attractorAnchor[2]-this.boidsPos[s][2])*this.attractorMul]),t.push([this.boidsVel[s][0]*this.dragMul+h[0]+e[0]+i[0]+u[0]+g[0],this.boidsVel[s][1]*this.dragMul+h[1]+e[1]+i[1]+u[1]+g[1],this.boidsVel[s][2]*this.dragMul+h[2]+e[2]+i[2]+u[2]+g[1]])}return t.length==this.boidsCount?(this.boidsVel=t,!0):!1}distance3D(t,s){return Math.sqrt(Math.pow(s[0]-t[0],2)+Math.pow(s[1]-t[1],2)+Math.pow(s[2]-t[2],2))}shuffleArr(t){for(var s=[];t.length>0;){var n=Math.floor(Math.random()*t.length);s.push(t[n])}return s}deInit(){cancelAnimationFrame(this.animationId)}onData(t){this.swirlMul+=t*3e-4,this.swirlMul<0?this.swirlMul=0:this.swirlMul>.01&&(this.swirlMul=.01)}}export class Particles{constructor(t=!0,s=100,n=[window.innerWidth,"440"],l="main_body",h="particlecanvas",i=!0,e="particlecanvas"){v(this,"updateParticle",t=>{if(this.particles[t].x+=this.particles[t].vx+this.particles[t].vx*this.frameRate,this.particles[t].y+=this.particles[t].vy+this.particles[t].vx*this.frameRate,this.particles[t].vx>this.settings.maxSpeed||this.particles[t].vy>this.settings.maxSpeed||this.particles[t].vx<-this.settings.maxSpeed||this.particles[t].vy<-this.settings.maxSpeed){var s=this.normalize2D([this.particles[t].vx,this.particles[t].vy]);this.particles[t].vx=s[0]*this.settings.maxSpeed,this.particles[t].vy=s[1]*this.settings.maxSpeed}this.particles[t].y+this.settings.particleSize>this.settings.groundLevel&&(this.particles[t].vy*=this.settings.yBounce,this.particles[t].vx*=-this.settings.xBounce,this.particles[t].y=this.settings.groundLevel-this.settings.particleSize),this.particles[t].y-this.settings.particleSize<this.settings.ceilingWall&&(this.particles[t].vy*=this.settings.yBounce,this.particles[t].vx*=-this.settings.xBounce,this.particles[t].y=this.settings.ceilingWall+this.settings.particleSize),this.particles[t].x-this.settings.particleSize<=this.settings.leftWall&&(this.particles[t].vx*=this.settings.xBounce,this.particles[t].x=this.settings.leftWall+this.settings.particleSize),this.particles[t].x+this.settings.particleSize>=this.settings.rightWall&&(this.particles[t].vx*=this.settings.xBounce,this.particles[t].x=this.settings.rightWall-this.settings.particleSize),this.particles[t].vy+=this.settings.gravity,this.particles[t].life++,this.particles[t].life>=this.particles[t].maxLife&&this.particles.splice(t,1)});v(this,"draw",()=>{if(this.lastFrame=this.thisFrame,this.thisFrame=performance.now(),this.frameRate=(this.thisFrame-this.lastFrame)*.001,this.context.fillStyle="rgba(10,10,10,0.8)",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="red",this.context.fillRect(0,0,this.settings.leftWall,this.canvas.height),this.context.fillRect(this.settings.rightWall,0,this.canvas.width,this.canvas.height),this.context.fillRect(0,this.settings.groundLevel,this.canvas.width,this.canvas.height),this.context.fillRect(0,0,this.canvas.width,this.settings.ceilingWall),this.particles.length<this.settings.maxParticles)for(var t=0;t<this.settings.maxParticles-this.particles.length;t++)this.genParticle();for(var t in this.particles)this.updateParticle(t),this.context.clearRect(this.settings.leftWall,this.settings.groundLevel,this.canvas.width,this.canvas.height),this.context.beginPath(),this.context.fillStyle="rgb("+String(Math.abs(this.particles[t].vx)*75)+","+String(Math.abs(this.particles[t].vx)*25)+","+String(255-Math.abs(this.particles[t].vx)*75)+")",this.context.arc(this.particles[t].x,this.particles[t].y,this.settings.particleSize,0,Math.PI*2,!0),this.context.closePath(),this.context.fill();setTimeout(()=>{this.animationId=requestAnimationFrame(this.draw)},20)});this.canvasId=h,this.parentId=l,this.defaultUI=i,this.canvasmenuId=e;var r='<div id="canvasContainer" class="canvasContainer">       <canvas class="boidscss" id="'+this.canvasId+'" width="'+n[0]+'" height="'+n[1]+'"></canvas>       ';HEGwebAPI.appendFragment(r,this.parentId),this.canvas=document.getElementById(this.canvasId),this.context=this.canvas.getContext("2d"),this.animationId=null,this.lastFrame=0,this.thisFrame=0,this.frameRate=1,this.useDefaultAnim=t,this.posX=20,this.posY=this.canvas.height/2,this.particles=[],this.particleIndex=0,this.settings={maxParticles:s,particleSize:5,startingX:this.canvas.width/2,startingY:this.canvas.height/4,maxSpeed:3,xBounce:-1,yBounce:-1,gravity:0,maxLife:Infinity,groundLevel:this.canvas.height*.999,leftWall:this.canvas.width*.001,rightWall:this.canvas.width*.999,ceilingWall:this.canvas.height*.001},this.seedsX=[],this.seedsY=[],this.currentAngle=0,this.useDefaultAnim==!0&&this.seedAngles(),this.animationId=requestAnimationFrame(this.draw)}seedAngles(){this.seedsX=[],this.seedsY=[];for(var t=0;t<this.settings.maxParticles;t++)this.seedsX.push(Math.random()*20-10),this.seedsY.push(Math.random()*30-10)}genParticle(){if(this.particleIndex!==this.settings.maxParticles){var t={};t.x=this.settings.startingX,t.y=this.settings.startingY,t.vx=0,t.vy=0,this.useDefaultAnim==!0&&(t.vx=this.seedsX[this.currentAngle],t.vy=this.seedsY[this.currentAngle],this.currentAngle++),t.id=this.particleIndex,t.life=0,t.maxLife=this.settings.maxLife,this.particles[this.particleIndex]=t,this.particleIndex++}else this.useDefaultAnim==!0&&(this.seedAngles(),this.currentAngle=0),this.particleIndex=0}normalize2D(t=[]){var s=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2));return[t[0]/s,t[1]/s]}deInit(){cancelAnimationFrame(this.animationId)}}
