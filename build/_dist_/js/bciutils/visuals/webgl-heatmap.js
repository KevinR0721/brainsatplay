(function(){var H,V,P,v,G,Y,w,z,q,B,j=[].indexOf||function(r){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===r)return e;return-1};z=function(){var r,e,i,s;if(window.WebGLRenderingContext!=null)return s=["WEBKIT","MOZ","MS","O"],i=/^WEBKIT_(.*)|MOZ_(.*)|MS_(.*)|O_(.*)/,r=WebGLRenderingContext.prototype.getExtension,WebGLRenderingContext.prototype.getExtension=function(o){var h,d,u,l,p;if(d=o.match(i),d!==null&&(o=d[1]),h=r.call(this,o),h===null){for(l=0,p=s.length;l<p;l++)if(u=s[l],h=r.call(this,u+"_"+o),h!==null)return h;return null}else return h},e=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getSupportedExtensions=function(){var o,h,d,u,l,p;for(u=e.call(this),d=[],l=0,p=u.length;l<p;l++)o=u[l],h=o.match(i),h!==null&&(o=h[1]),j.call(d,o)<0&&d.push(o);return d}},q=function(){var r,e,i,s,o,h,d,u,l,p,g,F,b,m;if(o=function(){var t,a,n;return t=document.createElement("canvas"),t.width=2,t.height=2,a=t.getContext("2d"),n=a.getImageData(0,0,2,2),n.data.set(new Uint8ClampedArray([0,0,0,0,255,255,255,255,0,0,0,0,255,255,255,255])),a.putImageData(n,0,0),t},o(),e=function(t,a){var n,c,f,T,_,E,S,O,x,y,U,A,R,L;if(E=t.createProgram(),R=t.createShader(t.VERTEX_SHADER),t.attachShader(E,R),t.shaderSource(R,`attribute vec2 position;
void main(){
    gl_Position = vec4(position, 0.0, 1.0);
}`),t.compileShader(R),!t.getShaderParameter(R,t.COMPILE_STATUS))throw t.getShaderInfoLog(R);if(f=t.createShader(t.FRAGMENT_SHADER),t.attachShader(E,f),t.shaderSource(f,`uniform sampler2D source;
void main(){
    gl_FragColor = texture2D(source, vec2(1.0, 1.0));
}`),t.compileShader(f),!t.getShaderParameter(f,t.COMPILE_STATUS))throw t.getShaderInfoLog(f);if(t.linkProgram(E),!t.getProgramParameter(E,t.LINK_STATUS))throw t.getProgramInfoLog(E);return t.useProgram(E),c=function(){return t.deleteShader(f),t.deleteShader(R),t.deleteProgram(E),t.deleteBuffer(n),t.deleteTexture(x),t.deleteTexture(A),t.deleteFramebuffer(T),t.bindBuffer(t.ARRAY_BUFFER,null),t.useProgram(null),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},A=t.createTexture(),t.bindTexture(t.TEXTURE_2D,A),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),T=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,T),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,A,0),y=o(),x=t.createTexture(),t.bindTexture(t.TEXTURE_2D,x),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,a,y),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),L=new Float32Array([1,1,-1,1,-1,-1,1,1,-1,-1,1,-1]),n=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,L,t.STATIC_DRAW),_=t.getAttribLocation(E,"position"),U=t.getUniformLocation(E,"source"),t.enableVertexAttribArray(_),t.vertexAttribPointer(_,2,t.FLOAT,!1,0,0),t.uniform1i(U,0),t.drawArrays(t.TRIANGLES,0,6),S=new Uint8Array(4*4),t.readPixels(0,0,2,2,t.RGBA,t.UNSIGNED_BYTE,S),O=Math.abs(S[0]-127)<10,c(),O},s=function(t,a){var n;return n=t.createTexture(),t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,a,null),t.getError()===0?(t.deleteTexture(n),!0):(t.deleteTexture(n),!1)},r=function(t,a){var n,c,f;return f=t.createTexture(),t.bindTexture(t.TEXTURE_2D,f),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,a,null),c=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,c),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,f,0),n=t.checkFramebufferStatus(t.FRAMEBUFFER),t.deleteTexture(f),t.deleteFramebuffer(c),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),n===t.FRAMEBUFFER_COMPLETE},l=[],p={},g=[],i=function(){var t,a,n,c,f,T,_;t=document.createElement("canvas"),n=null;try{n=t.getContext("experimental-webgl"),n===null&&(n=t.getContext("webgl"))}catch(E){}if(n!=null&&(T=n.getExtension("OES_texture_float"),T===null?s(n,n.FLOAT)?(_=!0,l.push("OES_texture_float"),p.OES_texture_float={shim:!0}):(_=!1,g.push("OES_texture_float")):s(n,n.FLOAT)?(_=!0,l.push("OES_texture_float")):(_=!1,g.push("OES_texture_float")),_&&(a=n.getExtension("WEBGL_color_buffer_float"),a===null?r(n,n.FLOAT)?(l.push("WEBGL_color_buffer_float"),p.WEBGL_color_buffer_float={shim:!0,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863}):g.push("WEBGL_color_buffer_float"):r(n,n.FLOAT)?l.push("WEBGL_color_buffer_float"):g.push("WEBGL_color_buffer_float"),a=n.getExtension("OES_texture_float_linear"),a===null?e(n,n.FLOAT)?(l.push("OES_texture_float_linear"),p.OES_texture_float_linear={shim:!0}):g.push("OES_texture_float_linear"):e(n,n.FLOAT)?l.push("OES_texture_float_linear"):g.push("OES_texture_float_linear")),c=n.getExtension("OES_texture_half_float"),c===null?s(n,36193)?(f=!0,l.push("OES_texture_half_float"),c=p.OES_texture_half_float={HALF_FLOAT_OES:36193,shim:!0}):(f=!1,g.push("OES_texture_half_float")):s(n,c.HALF_FLOAT_OES)?(f=!0,l.push("OES_texture_half_float")):(f=!1,g.push("OES_texture_half_float")),f))return a=n.getExtension("EXT_color_buffer_half_float"),a===null?r(n,c.HALF_FLOAT_OES)?(l.push("EXT_color_buffer_half_float"),p.EXT_color_buffer_half_float={shim:!0,RGBA16F_EXT:34842,RGB16F_EXT:34843,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863}):g.push("EXT_color_buffer_half_float"):r(n,c.HALF_FLOAT_OES)?l.push("EXT_color_buffer_half_float"):g.push("EXT_color_buffer_half_float"),a=n.getExtension("OES_texture_half_float_linear"),a===null?e(n,c.HALF_FLOAT_OES)?(l.push("OES_texture_half_float_linear"),p.OES_texture_half_float_linear={shim:!0}):g.push("OES_texture_half_float_linear"):e(n,c.HALF_FLOAT_OES)?l.push("OES_texture_half_float_linear"):g.push("OES_texture_half_float_linear")},window.WebGLRenderingContext!=null){for(i(),F={},b=0,m=g.length;b<m;b++)u=g[b],F[u]=!0;return h=WebGLRenderingContext.prototype.getExtension,WebGLRenderingContext.prototype.getExtension=function(t){var a;return a=p[t],a===void 0?F[t]?null:h.call(this,t):a},d=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getSupportedExtensions=function(){var t,a,n,c,f,T,_;for(n=d.call(this),a=[],c=0,T=n.length;c<T;c++)t=n[c],F[t]===void 0&&a.push(t);for(f=0,_=l.length;f<_;f++)t=l[f],j.call(a,t)<0&&a.push(t);return a},WebGLRenderingContext.prototype.getFloatExtension=function(t){var a,n,c,f,T,_,E,S,O,x,y,U,A,R,L,I,C,D,K,Z,J,Q,N,$,M,X;for(t.prefer==null&&(t.prefer=["half"]),t.require==null&&(t.require=[]),t.throws==null&&(t.throws=!0),R=this.getExtension("OES_texture_float"),_=this.getExtension("OES_texture_half_float"),U=this.getExtension("WEBGL_color_buffer_float"),f=this.getExtension("EXT_color_buffer_half_float"),A=this.getExtension("OES_texture_float_linear"),T=this.getExtension("OES_texture_half_float_linear"),y={texture:R!==null,filterable:A!==null,renderable:U!==null,score:0,precision:"single",half:!1,single:!0,type:this.FLOAT},c={texture:_!==null,filterable:T!==null,renderable:f!==null,score:0,precision:"half",half:!0,single:!1,type:($=_!=null?_.HALF_FLOAT_OES:void 0)!=null?$:null},n=[],y.texture&&n.push(y),c.texture&&n.push(c),x=[],I=0,K=n.length;I<K;I++){for(a=n[I],L=!0,M=t.require,C=0,Z=M.length;C<Z;C++)u=M[C],a[u]===!1&&(L=!1);L&&x.push(a)}for(D=0,J=x.length;D<J;D++)for(a=x[D],X=t.prefer,E=N=0,Q=X.length;N<Q;E=++N)O=X[E],S=Math.pow(2,t.prefer.length-E-1),a[O]&&(a.score+=S);if(x.sort(function(W,k){if(W.score===k.score)return 0;if(W.score<k.score)return 1;if(W.score>k.score)return-1}),x.length===0){if(t.throws)throw"No floating point texture support that is "+t.require.join(", ");return null}else return x=x[0],{filterable:x.filterable,renderable:x.renderable,type:x.type,precision:x.precision}}}},z(),q(),v=function(){function r(e,i){var s,o;this.gl=e,o=i.vertex,s=i.fragment,this.program=this.gl.createProgram(),this.vs=this.gl.createShader(this.gl.VERTEX_SHADER),this.fs=this.gl.createShader(this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vs),this.gl.attachShader(this.program,this.fs),this.compileShader(this.vs,o),this.compileShader(this.fs,s),this.link(),this.value_cache={},this.uniform_cache={},this.attribCache={}}return r.prototype.attribLocation=function(e){var i;return i=this.attribCache[e],i===void 0&&(i=this.attribCache[e]=this.gl.getAttribLocation(this.program,e)),i},r.prototype.compileShader=function(e,i){if(this.gl.shaderSource(e,i),this.gl.compileShader(e),!this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS))throw"Shader Compile Error: "+this.gl.getShaderInfoLog(e)},r.prototype.link=function(){if(this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw"Shader Link Error: "+this.gl.getProgramInfoLog(this.program)},r.prototype.use=function(){return this.gl.useProgram(this.program),this},r.prototype.uniformLoc=function(e){var i;return i=this.uniform_cache[e],i===void 0&&(i=this.uniform_cache[e]=this.gl.getUniformLocation(this.program,e)),i},r.prototype.int=function(e,i){var s,o;return s=this.value_cache[e],s!==i&&(this.value_cache[e]=i,o=this.uniformLoc(e),o&&this.gl.uniform1i(o,i)),this},r.prototype.vec2=function(e,i,s){var o;return o=this.uniformLoc(e),o&&this.gl.uniform2f(o,i,s),this},r.prototype.float=function(e,i){var s,o;return s=this.value_cache[e],s!==i&&(this.value_cache[e]=i,o=this.uniformLoc(e),o&&this.gl.uniform1f(o,i)),this},r}(),H=function(){function r(e){this.gl=e,this.buffer=this.gl.createFramebuffer()}return r.prototype.destroy=function(){return this.gl.deleteFRamebuffer(this.buffer)},r.prototype.bind=function(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buffer),this},r.prototype.unbind=function(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this},r.prototype.check=function(){var e;switch(e=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER),e){case this.gl.FRAMEBUFFER_UNSUPPORTED:throw"Framebuffer is unsupported";case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Framebuffer incomplete attachment";case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Framebuffer incomplete dimensions";case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Framebuffer incomplete missing attachment"}return this},r.prototype.color=function(e){return this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,e.target,e.handle,0),this.check(),this},r.prototype.depth=function(e){return this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,e.id),this.check(),this},r.prototype.destroy=function(){return this.gl.deleteFramebuffer(this.buffer)},r}(),G=function(){function r(e,i){var s,o;switch(this.gl=e,i==null&&(i={}),this.channels=this.gl[((s=i.channels)!=null?s:"rgba").toUpperCase()],typeof i.type=="number"?this.type=i.type:this.type=this.gl[((o=i.type)!=null?o:"unsigned_byte").toUpperCase()],this.channels){case this.gl.RGBA:this.chancount=4;break;case this.gl.RGB:this.chancount=3;break;case this.gl.LUMINANCE_ALPHA:this.chancount=2;break;default:this.chancount=1}this.target=this.gl.TEXTURE_2D,this.handle=this.gl.createTexture()}return r.prototype.destroy=function(){return this.gl.deleteTexture(this.handle)},r.prototype.bind=function(e){if(e==null&&(e=0),e>15)throw"Texture unit too large: "+e;return this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.target,this.handle),this},r.prototype.setSize=function(e,i){return this.width=e,this.height=i,this.gl.texImage2D(this.target,0,this.channels,this.width,this.height,0,this.channels,this.type,null),this},r.prototype.upload=function(e){return this.width=e.width,this.height=e.height,this.gl.texImage2D(this.target,0,this.channels,this.channels,this.type,e),this},r.prototype.linear=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this},r.prototype.nearest=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this},r.prototype.clampToEdge=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this},r.prototype.repeat=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this},r}(),P=function(){function r(e,i,s){var o;this.gl=e,this.width=i,this.height=s,o=this.gl.getFloatExtension({require:["renderable"]}),this.texture=new G(this.gl,{type:o.type}).bind(0).setSize(this.width,this.height).nearest().clampToEdge(),this.fbo=new H(this.gl).bind().color(this.texture).unbind()}return r.prototype.use=function(){return this.fbo.bind()},r.prototype.bind=function(e){return this.texture.bind(e)},r.prototype.end=function(){return this.fbo.unbind()},r.prototype.resize=function(e,i){return this.width=e,this.height=i,this.texture.bind(0).setSize(this.width,this.height)},r}(),B=`attribute vec4 position;
varying vec2 texcoord;
void main(){
    texcoord = position.xy*0.5+0.5;
    gl_Position = position;
}`,w=`#ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp int;
    precision highp float;
#else
    precision mediump int;
    precision mediump float;
#endif
uniform sampler2D source;
varying vec2 texcoord;`,V=function(){function r(e,i,s,o){var h,d,u;for(this.heatmap=e,this.gl=i,this.width=s,this.height=o,this.shader=new v(this.gl,{vertex:`attribute vec4 position, intensity;
varying vec2 off, dim;
varying float vIntensity;
uniform vec2 viewport;

void main(){
    dim = abs(position.zw);
    off = position.zw;
    vec2 pos = position.xy + position.zw;
    vIntensity = intensity.x;
    gl_Position = vec4((pos/viewport)*2.0-1.0, 0.0, 1.0);
}`,fragment:`#ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp int;
    precision highp float;
#else
    precision mediump int;
    precision mediump float;
#endif
varying vec2 off, dim;
varying float vIntensity;
void main(){
    float falloff = (1.0 - smoothstep(0.0, 1.0, length(off/dim)));
    float intensity = falloff*vIntensity;
    gl_FragColor = vec4(intensity);
}`}),this.clampShader=new v(this.gl,{vertex:B,fragment:w+`uniform float low, high;
void main(){
    gl_FragColor = vec4(clamp(texture2D(source, texcoord).rgb, low, high), 1.0);
}`}),this.multiplyShader=new v(this.gl,{vertex:B,fragment:w+`uniform float value;
void main(){
    gl_FragColor = vec4(texture2D(source, texcoord).rgb*value, 1.0);
}`}),this.blurShader=new v(this.gl,{vertex:B,fragment:w+`uniform vec2 viewport;
void main(){
    vec4 result = vec4(0.0);
    for(int x=-1; x<=1; x++){
        for(int y=-1; y<=1; y++){
            vec2 off = vec2(x,y)/viewport;
            //float factor = 1.0 - smoothstep(0.0, 1.5, length(off));
            float factor = 1.0;
            result += vec4(texture2D(source, texcoord+off).rgb*factor, factor);
        }
    }
    gl_FragColor = vec4(result.rgb/result.w, 1.0);
}`}),this.nodeBack=new P(this.gl,this.width,this.height),this.nodeFront=new P(this.gl,this.width,this.height),this.vertexBuffer=this.gl.createBuffer(),this.vertexSize=8,this.maxPointCount=1024*10,this.vertexBufferData=new Float32Array(this.maxPointCount*this.vertexSize*6),this.vertexBufferViews=[],h=d=0,u=this.maxPointCount;0<=u?d<u:d>u;h=0<=u?++d:--d)this.vertexBufferViews.push(new Float32Array(this.vertexBufferData.buffer,0,h*this.vertexSize*6));this.bufferIndex=0,this.pointCount=0}return r.prototype.resize=function(e,i){return this.width=e,this.height=i,this.nodeBack.resize(this.width,this.height),this.nodeFront.resize(this.width,this.height)},r.prototype.update=function(){var e,i;if(this.pointCount>0)return this.gl.enable(this.gl.BLEND),this.nodeFront.use(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexBufferViews[this.pointCount],this.gl.STREAM_DRAW),i=this.shader.attribLocation("position"),e=this.shader.attribLocation("intensity"),this.gl.enableVertexAttribArray(1),this.gl.vertexAttribPointer(i,4,this.gl.FLOAT,!1,8*4,0*4),this.gl.vertexAttribPointer(e,4,this.gl.FLOAT,!1,8*4,4*4),this.shader.use().vec2("viewport",this.width,this.height),this.gl.drawArrays(this.gl.TRIANGLES,0,this.pointCount*6),this.gl.disableVertexAttribArray(1),this.pointCount=0,this.bufferIndex=0,this.nodeFront.end(),this.gl.disable(this.gl.BLEND)},r.prototype.clear=function(){return this.nodeFront.use(),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.nodeFront.end()},r.prototype.clamp=function(e,i){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.clampShader.use().int("source",0).float("low",e).float("high",i),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},r.prototype.multiply=function(e){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.multiplyShader.use().int("source",0).float("value",e),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},r.prototype.blur=function(){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.blurShader.use().int("source",0).vec2("viewport",this.width,this.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},r.prototype.swap=function(){var e;return e=this.nodeFront,this.nodeFront=this.nodeBack,this.nodeBack=e},r.prototype.addVertex=function(e,i,s,o,h){return this.vertexBufferData[this.bufferIndex++]=e,this.vertexBufferData[this.bufferIndex++]=i,this.vertexBufferData[this.bufferIndex++]=s,this.vertexBufferData[this.bufferIndex++]=o,this.vertexBufferData[this.bufferIndex++]=h,this.vertexBufferData[this.bufferIndex++]=h,this.vertexBufferData[this.bufferIndex++]=h,this.vertexBufferData[this.bufferIndex++]=h},r.prototype.addPoint=function(e,i,s,o){var h;return s==null&&(s=50),o==null&&(o=.2),this.pointCount>=this.maxPointCount-1&&this.update(),i=this.height-i,h=s/2,this.addVertex(e,i,-h,-h,o),this.addVertex(e,i,+h,-h,o),this.addVertex(e,i,-h,+h,o),this.addVertex(e,i,-h,+h,o),this.addVertex(e,i,+h,-h,o),this.addVertex(e,i,+h,+h,o),this.pointCount+=1},r}(),Y=function(){function r(e){var i,s,o,h,d,u,l,p,g,F,b,m,t;m=e!=null?e:{},this.canvas=m.canvas,this.width=m.width,this.height=m.height,p=m.intensityToAlpha,u=m.gradientTexture,s=m.alphaRange,this.canvas||(this.canvas=document.createElement("canvas"));try{if(this.gl=this.canvas.getContext("experimental-webgl",{depth:!1,antialias:!1}),this.gl===null&&(this.gl=this.canvas.getContext("webgl",{depth:!1,antialias:!1}),this.gl===null))throw"WebGL not supported"}catch(a){throw h=a,"WebGL not supported"}window.WebGLDebugUtils!=null&&(console.log("debugging mode"),this.gl=WebGLDebugUtils.makeDebugContext(this.gl,function(a,n,c){throw WebGLDebugUtils.glEnumToString(a)+" was caused by call to: "+n})),this.gl.enableVertexAttribArray(0),this.gl.blendFunc(this.gl.ONE,this.gl.ONE),u?(b=this.gradientTexture=new G(this.gl,{channels:"rgba"}).bind(0).setSize(2,2).nearest().clampToEdge(),typeof u=="string"?(l=new Image,l.onload=function(){return b.bind().upload(l)},l.src=u):u.width>0&&u.height>0?b.upload(u):u.onload=function(){return b.upload(u)},d=`uniform sampler2D gradientTexture;
vec3 getColor(float intensity){
    return texture2D(gradientTexture, vec2(intensity, 0.0)).rgb;
}`):(b=null,d=`vec3 getColor(float intensity){
    vec3 blue = vec3(0.0, 0.0, 1.0);
    vec3 cyan = vec3(0.0, 1.0, 1.0);
    vec3 green = vec3(0.0, 1.0, 0.0);
    vec3 yellow = vec3(1.0, 1.0, 0.0);
    vec3 red = vec3(1.0, 0.0, 0.0);

    vec3 color = (
        fade(-0.25, 0.25, intensity)*blue +
        fade(0.0, 0.5, intensity)*cyan +
        fade(0.25, 0.75, intensity)*green +
        fade(0.5, 1.0, intensity)*yellow +
        smoothstep(0.75, 1.0, intensity)*red
    );
    return color;
}`),p==null&&(p=!0),p?(t=s!=null?s:[0,1],o=t[0],i=t[1],g=`vec4 alphaFun(vec3 color, float intensity){
    float alpha = smoothstep(`+o.toFixed(8)+", "+i.toFixed(8)+`, intensity);
    return vec4(color*alpha, alpha);
}`):g=`vec4 alphaFun(vec3 color, float intensity){
    return vec4(color, 1.0);
}`,this.shader=new v(this.gl,{vertex:B,fragment:w+(`float linstep(float low, float high, float value){
    return clamp((value-low)/(high-low), 0.0, 1.0);
}

float fade(float low, float high, float value){
    float mid = (low+high)*0.5;
    float range = (high-low)*0.5;
    float x = 1.0 - clamp(abs(mid-value)/range, 0.0, 1.0);
    return smoothstep(0.0, 1.0, x);
}

`+d+`
`+g+`

void main(){
    float intensity = smoothstep(0.0, 1.0, texture2D(source, texcoord).r);
    vec3 color = getColor(intensity);
    gl_FragColor = alphaFun(color, intensity);
}`)}),this.width==null&&(this.width=this.canvas.offsetWidth||2),this.height==null&&(this.height=this.canvas.offsetHeight||2),this.canvas.width=this.width,this.canvas.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.quad=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad),F=new Float32Array([-1,-1,0,1,1,-1,0,1,-1,1,0,1,-1,1,0,1,1,-1,0,1,1,1,0,1]),this.gl.bufferData(this.gl.ARRAY_BUFFER,F,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.heights=new V(this,this.gl,this.width,this.height)}return r.prototype.adjustSize=function(){var e,i;if(i=this.canvas.offsetWidth||2,e=this.canvas.offsetHeight||2,this.width!==i||this.height!==e)return this.gl.viewport(0,0,i,e),this.canvas.width=i,this.canvas.height=e,this.width=i,this.height=e,this.heights.resize(this.width,this.height)},r.prototype.display=function(){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.heights.nodeFront.bind(0),this.gradientTexture&&this.gradientTexture.bind(1),this.shader.use().int("source",0).int("gradientTexture",1),this.gl.drawArrays(this.gl.TRIANGLES,0,6)},r.prototype.update=function(){return this.heights.update()},r.prototype.clear=function(){return this.heights.clear()},r.prototype.clamp=function(e,i){return e==null&&(e=0),i==null&&(i=1),this.heights.clamp(e,i)},r.prototype.multiply=function(e){return e==null&&(e=.95),this.heights.multiply(e)},r.prototype.blur=function(){return this.heights.blur()},r.prototype.addPoint=function(e,i,s,o){return this.heights.addPoint(e,i,s,o)},r.prototype.addPoints=function(e){var i,s,o,h;for(h=[],s=0,o=e.length;s<o;s++)i=e[s],h.push(this.addPoint(i.x,i.y,i.size,i.intensity));return h},r}(),window.createWebGLHeatmap=function(r){return new Y(r)}}).call(this);
