var d=Object.defineProperty;var l=(h,t,e)=>(typeof t!="symbol"&&(t+=""),t in h?d(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e);import"../signal_analysis/BiquadFilters.js";import{DataAtlas as u}from"../DataAtlas.js";import{hegduino as o}from"../hegduino.js";import{DOMFragment as c}from"../../frontend/utils/DOMFragment.js";export class hegduinoPlugin{constructor(t="hegduinousb",e=this.onconnect,a=this.ondisconnect){l(this,"init",(t,e)=>{t.sps=Math.floor(2048/3),t.deviceType="heg";let a=n=>{if(n.indexOf("|")>-1){let i=n.split("|");if(i.length>3){let s=this.atlas.data.heg[t.deviceNum];s.count++,s.count===1&&(s.startTime=Date.now()),this.device.mode==="ble"&&this.device.interface.android===!0?(s.times.push(Date.now()),s.red.push(parseFloat(i[0])),s.ir.push(parseFloat(i[1])),s.ratio.push(parseFloat(i[2]))):(s.times.push(Date.now()),s.red.push(parseFloat(i[1])),s.ir.push(parseFloat(i[2])),s.ratio.push(parseFloat(i[3])),s.ambient.push(parseFloat(i[4])))}}else console.log("HEGDUINO: ",n)};if(this.mode==="hegduinowifi"||this.mode==="hegduinosse"?this.device=new o("wifi",a,()=>{this.atlas.settings.analyzing!==!0&&t.analysis.length>0&&(this.atlas.settings.analyzing=!0,setTimeout(()=>{this.atlas.analyzer()},1200)),this.onconnect()},()=>{this.atlas.settings.analyzing=!1,this.ondisconnect()}):this.mode==="hegduinobt"||this.mode==="hegduinoble"?this.device=new o("ble",a,()=>{this.atlas.settings.analyzing!==!0&&t.analysis.length>0&&(this.atlas.settings.analyzing=!0,setTimeout(()=>{this.atlas.analyzer()},1200)),this.onconnect()},()=>{this.atlas.settings.analyzing=!1,this.ondisconnect()}):(this.mode==="hegduinoserial"||this.mode==="hegduinousb")&&(this.device=new o("usb",a,()=>{this.atlas.settings.analyzing!==!0&&t.analysis.length>0&&(this.atlas.settings.analyzing=!0,setTimeout(()=>{this.atlas.analyzer()},1200)),this.onconnect()},()=>{this.atlas.settings.analyzing=!1,this.ondisconnect()})),e===!0){let n="hegduino";this.atlas=new u(location+":"+this.mode,{hegshared:{sps:t.sps}},n,!0,!0,t.analysis),t.deviceNum=this.atlas.data.heg.length-1,t.useAtlas=!0}else typeof e=="object"&&(this.atlas=e,t.deviceNum=this.atlas.data.heg.length,this.atlas.data.hegshared={sps:t.sps},this.atlas.addHEGCoord(this.atlas.data.heg.length),this.atlas.settings.heg=!0,t.useAtlas=!0,t.analysis.length>0&&(this.atlas.settings.analysis.push(...t.analysis),this.atlas.settings.analyzing||(this.atlas.settings.analyzing=!0,this.atlas.analyzer())))});l(this,"connect",()=>{this.device.connect()});l(this,"disconnect",()=>{this.device.disconnect()});l(this,"onconnect",()=>{});l(this,"ondisconnect",()=>{});l(this,"addControls",(t=document.body)=>{let e=Math.floor(Math.random()*1e4),a=()=>`
            <div id='`+e+`hegduinoControls'>
                <button id='`+e+`hegon'>On</button>
                <button id='`+e+`hegoff'>Off</button>
                <input id='`+e+"hegcmd' type='text' placeholder='R'></input><button id='"+e+`sendcmd'>Send</button>
            </div>
            `,n=()=>{document.getElementById(e+"hegon").onclick=()=>{this.device.sendCommand("t")},document.getElementById(e+"hegoff").onclick=()=>{this.device.sendCommand("f")},document.getElementById(e+"sendcmd").onclick=()=>{this.device.sendCommand(elm(e+"hegcmd").value)}};this.ui=new c(a,t,void 0,n)});this.atlas=null,this.mode=t,this.device=null,this.filters=[],this.ui=null,this.onconnect=e,this.ondisconnect=a}}
