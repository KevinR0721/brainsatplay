var u=Object.defineProperty;var n=(r,e,s)=>(typeof e!="symbol"&&(e+=""),e in r?u(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s);import{DOMFragment as o}from"../../frontend/utils/DOMFragment.js";import"../DataAtlas.js";import"../signal_analysis/BiquadFilters.js";let c;export class webgazerPlugin{constructor(e,s=this.onconnect,l=this.ondisconnect){n(this,"init",(e,s)=>{if(e.deviceType="eyetracker",s===!0){let l="eyetracker";this.atlas=new dataAtlas(location+":"+this.mode,void 0,l,!0,!0,e.analysis),e.deviceNum=this.atlas.data.heg.length-1,e.useAtlas=!0,e.deviceNum=this.atlas.data.eyetracker.length-1}else typeof s=="object"&&(this.atlas=s,e.deviceNum=this.atlas.data.eyetracker.length,this.atlas.addEyeTracker(this.atlas.data.eyetracker.length),this.atlas.settings.eyetracker=!0,e.useAtlas=!0,e.analysis.length>0&&(this.atlas.settings.analysis.push(...e.analysis),this.atlas.settings.analyzing||(this.atlas.settings.analyzing=!0,this.atlas.analyzer())));this.info=e});n(this,"connect",()=>{c.setGazeListener((e,s)=>{if(e==null)return;let l=e.x,h=e.y;if(this.info.useAtlas===!0){let t=this.atlas.data.eyetracker[this.info.deviceNum];t.times.length===0&&(t.startTime=Date.now()),t.times.push(Date.now()),t.x.push(e.x),t.y.push(e.y),t.x.length>10?(t.smax.push(t.x.slice(t.x.length-10).reduce((a,i)=>a+i)/10),t.smay.push(t.y.slice(t.y.length-10).reduce((a,i)=>a+i)/10)):(t.smax.push(t.x.slice(0).reduce((a,i)=>a+i)/t.x.length),t.smay.push(t.y.slice(0).reduce((a,i)=>a+i)/t.y.length))}}).begin(),this.onconnect()});n(this,"disconnect",()=>{c.end(),this.ondisconnect()});n(this,"onconnect",()=>{});n(this,"ondisconnect",()=>{});n(this,"addControls",(e=document.body)=>{let s=Math.floor(Math.random()*1e4),l=()=>`
            `,h=()=>{};this.ui=new o(l,e,void 0,h)});this.atlas=null,this.mode=e,this.device=null,this.filters=[],this.info,this.onconnect=s,this.ondisconnect=l}}
