(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else if(typeof exports === 'object')
		exports["brainsatplay"] = factory();
	else
		root["brainsatplay"] = factory();
})(this, function() {
return /******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ 9954:
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u=undefined;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if( true&&"string"==typeof t)return __webpack_require__(1308)(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]); true?module.exports=l:0}if(parcelRequire=f,i)throw i;return f}({"vCxL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__extends=e,exports.__rest=n,exports.__decorate=o,exports.__param=a,exports.__metadata=u,exports.__awaiter=i,exports.__generator=c,exports.__exportStar=f,exports.__values=l,exports.__read=s,exports.__spread=p,exports.__await=y,exports.__asyncGenerator=_,exports.__asyncDelegator=h,exports.__asyncValues=b,exports.__makeTemplateObject=v,exports.__importStar=d,exports.__importDefault=x,exports.__assign=void 0;var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return exports.__assign=r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)};function n(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&(r[n[o]]=t[n[o]])}return r}function o(t,e,r,n){var o,a=arguments.length,u=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,e,r,n);else for(var i=t.length-1;i>=0;i--)(o=t[i])&&(u=(a<3?o(u):a>3?o(e,r,u):o(e,r))||u);return a>3&&u&&Object.defineProperty(e,r,u),u}function a(t,e){return function(r,n){e(r,n,t)}}function u(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function i(t,e,r,n){return new(r||(r=Promise))(function(o,a){function u(t){try{c(n.next(t))}catch(e){a(e)}}function i(t){try{c(n.throw(t))}catch(e){a(e)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(u,i)}c((n=n.apply(t,e||[])).next())})}function c(t,e){var r,n,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,n=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=e.call(t,u)}catch(i){a=[6,i],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}function f(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}function l(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function s(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)u.push(n.value)}catch(i){o={error:i}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return u}function p(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}function y(t){return this instanceof y?(this.v=t,this):new y(t)}function _(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(t,e||[]),a=[];return n={},u("next"),u("throw"),u("return"),n[Symbol.asyncIterator]=function(){return this},n;function u(t){o[t]&&(n[t]=function(e){return new Promise(function(r,n){a.push([t,e,r,n])>1||i(t,e)})})}function i(t,e){try{(r=o[t](e)).value instanceof y?Promise.resolve(r.value.v).then(c,f):l(a[0][2],r)}catch(n){l(a[0][3],n)}var r}function c(t){i("next",t)}function f(t){i("throw",t)}function l(t,e){t(e),a.shift(),a.length&&i(a[0][0],a[0][1])}}function h(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,o){e[n]=t[n]?function(e){return(r=!r)?{value:y(t[n](e)),done:"return"===n}:o?o(e):e}:o}}function b(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof l?l(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,o){(function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)})(n,o,(e=t[r](e)).done,e.value)})}}}function v(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function x(t){return t&&t.__esModule?t:{default:t}}exports.__assign=r;
},{}],"Qnsq":[function(require,module,exports) {
"use strict";function e(e){return"function"==typeof e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isFunction=e;
},{}],"Q3iD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.config=void 0;var e=!1,r={Promise:void 0,set useDeprecatedSynchronousErrorHandling(r){r&&(new Error).stack;e=r},get useDeprecatedSynchronousErrorHandling(){return e}};exports.config=r;
},{}],"JfKC":[function(require,module,exports) {
"use strict";function e(e){setTimeout(function(){throw e},0)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.hostReportError=e;
},{}],"wIlR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.empty=void 0;var e=require("./config"),r=require("./util/hostReportError"),o={closed:!0,next:function(e){},error:function(o){if(e.config.useDeprecatedSynchronousErrorHandling)throw o;(0,r.hostReportError)(o)},complete:function(){}};exports.empty=o;
},{"./config":"Q3iD","./util/hostReportError":"JfKC"}],"KeTG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isArray=void 0;var r=Array.isArray||function(r){return r&&"number"==typeof r.length};exports.isArray=r;
},{}],"nU7r":[function(require,module,exports) {
"use strict";function e(e){return null!==e&&"object"==typeof e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isObject=e;
},{}],"pMaL":[function(require,module,exports) {
"use strict";function r(r){return Error.call(this),this.message=r?r.length+" errors occurred during unsubscription:\n"+r.map(function(r,t){return t+1+") "+r.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=r,this}Object.defineProperty(exports,"__esModule",{value:!0}),exports.UnsubscriptionError=void 0,r.prototype=Object.create(Error.prototype);var t=r;exports.UnsubscriptionError=t;
},{}],"I8KM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Subscription=void 0;var r=require("./util/isArray"),i=require("./util/isObject"),s=require("./util/isFunction"),t=require("./util/UnsubscriptionError"),n=function(){function n(r){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,r&&(this._unsubscribe=r)}var o;return n.prototype.unsubscribe=function(){var o;if(!this.closed){var u=this._parentOrParents,c=this._unsubscribe,a=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,u instanceof n)u.remove(this);else if(null!==u)for(var f=0;f<u.length;++f){u[f].remove(this)}if((0,s.isFunction)(c))try{c.call(this)}catch(h){o=h instanceof t.UnsubscriptionError?e(h.errors):[h]}if((0,r.isArray)(a)){f=-1;for(var p=a.length;++f<p;){var l=a[f];if((0,i.isObject)(l))try{l.unsubscribe()}catch(h){o=o||[],h instanceof t.UnsubscriptionError?o=o.concat(e(h.errors)):o.push(h)}}}if(o)throw new t.UnsubscriptionError(o)}},n.prototype.add=function(r){var i=r;switch(typeof r){case"function":i=new n(r);case"object":if(i===this||i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if(!(i instanceof n)){var s=i;(i=new n)._subscriptions=[s]}break;default:if(!r)return n.EMPTY;throw new Error("unrecognized teardown "+r+" added to Subscription.")}var t=i._parentOrParents;if(null===t)i._parentOrParents=this;else if(t instanceof n){if(t===this)return i;i._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return i;t.push(this)}var e=this._subscriptions;return null===e?this._subscriptions=[i]:e.push(i),i},n.prototype.remove=function(r){var i=this._subscriptions;if(i){var s=i.indexOf(r);-1!==s&&i.splice(s,1)}},n.EMPTY=((o=new n).closed=!0,o),n}();function e(r){return r.reduce(function(r,i){return r.concat(i instanceof t.UnsubscriptionError?i.errors:i)},[])}exports.Subscription=n;
},{"./util/isArray":"KeTG","./util/isObject":"nU7r","./util/isFunction":"Qnsq","./util/UnsubscriptionError":"pMaL"}],"yAZp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.$$rxSubscriber=exports.rxSubscriber=void 0;var r="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();exports.rxSubscriber=r;var e=r;exports.$$rxSubscriber=e;
},{}],"RaFB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SafeSubscriber=exports.Subscriber=void 0;var r=u(require("tslib")),t=require("./util/isFunction"),e=require("./Observer"),n=require("./Subscription"),o=require("../internal/symbol/rxSubscriber"),i=require("./config"),s=require("./util/hostReportError");function c(){if("function"!=typeof WeakMap)return null;var r=new WeakMap;return c=function(){return r},r}function u(r){if(r&&r.__esModule)return r;if(null===r||"object"!=typeof r&&"function"!=typeof r)return{default:r};var t=c();if(t&&t.has(r))return t.get(r);var e={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in r)if(Object.prototype.hasOwnProperty.call(r,o)){var i=n?Object.getOwnPropertyDescriptor(r,o):null;i&&(i.get||i.set)?Object.defineProperty(e,o,i):e[o]=r[o]}return e.default=r,t&&t.set(r,e),e}var p=function(t){function n(r,o,i){var s=t.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=e.empty;break;case 1:if(!r){s.destination=e.empty;break}if("object"==typeof r){r instanceof n?(s.syncErrorThrowable=r.syncErrorThrowable,s.destination=r,r.add(s)):(s.syncErrorThrowable=!0,s.destination=new b(s,r));break}default:s.syncErrorThrowable=!0,s.destination=new b(s,r,o,i)}return s}return r.__extends(n,t),n.prototype[o.rxSubscriber]=function(){return this},n.create=function(r,t,e){var o=new n(r,t,e);return o.syncErrorThrowable=!1,o},n.prototype.next=function(r){this.isStopped||this._next(r)},n.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},n.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},n.prototype._next=function(r){this.destination.next(r)},n.prototype._error=function(r){this.destination.error(r),this.unsubscribe()},n.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},n.prototype._unsubscribeAndRecycle=function(){var r=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=r,this},n}(n.Subscription);exports.Subscriber=p;var b=function(n){function o(r,o,i,s){var c,u=n.call(this)||this;u._parentSubscriber=r;var p=u;return(0,t.isFunction)(o)?c=o:o&&(c=o.next,i=o.error,s=o.complete,o!==e.empty&&(p=Object.create(o),(0,t.isFunction)(p.unsubscribe)&&u.add(p.unsubscribe.bind(p)),p.unsubscribe=u.unsubscribe.bind(u))),u._context=p,u._next=c,u._error=i,u._complete=s,u}return r.__extends(o,n),o.prototype.next=function(r){if(!this.isStopped&&this._next){var t=this._parentSubscriber;i.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,r)&&this.unsubscribe():this.__tryOrUnsub(this._next,r)}},o.prototype.error=function(r){if(!this.isStopped){var t=this._parentSubscriber,e=i.config.useDeprecatedSynchronousErrorHandling;if(this._error)e&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,r),this.unsubscribe()):(this.__tryOrUnsub(this._error,r),this.unsubscribe());else if(t.syncErrorThrowable)e?(t.syncErrorValue=r,t.syncErrorThrown=!0):(0,s.hostReportError)(r),this.unsubscribe();else{if(this.unsubscribe(),e)throw r;(0,s.hostReportError)(r)}}},o.prototype.complete=function(){var r=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var e=function(){return r._complete.call(r._context)};i.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}},o.prototype.__tryOrUnsub=function(r,t){try{r.call(this._context,t)}catch(e){if(this.unsubscribe(),i.config.useDeprecatedSynchronousErrorHandling)throw e;(0,s.hostReportError)(e)}},o.prototype.__tryOrSetError=function(r,t,e){if(!i.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,e)}catch(n){return i.config.useDeprecatedSynchronousErrorHandling?(r.syncErrorValue=n,r.syncErrorThrown=!0,!0):((0,s.hostReportError)(n),!0)}return!1},o.prototype._unsubscribe=function(){var r=this._parentSubscriber;this._context=null,this._parentSubscriber=null,r.unsubscribe()},o}(p);exports.SafeSubscriber=b;
},{"tslib":"vCxL","./util/isFunction":"Qnsq","./Observer":"wIlR","./Subscription":"I8KM","../internal/symbol/rxSubscriber":"yAZp","./config":"Q3iD","./util/hostReportError":"JfKC"}],"wHmS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.canReportError=e;var r=require("../Subscriber");function e(e){for(;e;){var t=e,o=t.closed,i=t.destination,n=t.isStopped;if(o||n)return!1;e=i&&i instanceof r.Subscriber?i:null}return!0}
},{"../Subscriber":"RaFB"}],"SEU0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.toSubscriber=i;var r=require("../Subscriber"),e=require("../symbol/rxSubscriber"),b=require("../Observer");function i(i,u,s){if(i){if(i instanceof r.Subscriber)return i;if(i[e.rxSubscriber])return i[e.rxSubscriber]()}return i||u||s?new r.Subscriber(i,u,s):new r.Subscriber(b.empty)}
},{"../Subscriber":"RaFB","../symbol/rxSubscriber":"yAZp","../Observer":"wIlR"}],"tjV3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.observable=void 0;var e="function"==typeof Symbol&&Symbol.observable||"@@observable";exports.observable=e;
},{}],"rXfM":[function(require,module,exports) {
"use strict";function e(){}Object.defineProperty(exports,"__esModule",{value:!0}),exports.noop=e;
},{}],"HQCS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pipe=r,exports.pipeFromArray=n;var e=require("./noop");function r(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return n(e)}function n(r){return r?1===r.length?r[0]:function(e){return r.reduce(function(e,r){return r(e)},e)}:e.noop}
},{"./noop":"rXfM"}],"wbSE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Observable=void 0;var r=require("./util/canReportError"),e=require("./util/toSubscriber"),o=require("./symbol/observable"),t=require("./util/pipe"),n=require("./config"),i=function(){function i(r){this._isScalar=!1,r&&(this._subscribe=r)}return i.prototype.lift=function(r){var e=new i;return e.source=this,e.operator=r,e},i.prototype.subscribe=function(r,o,t){var i=this.operator,s=(0,e.toSubscriber)(r,o,t);if(i?s.add(i.call(s,this.source)):s.add(this.source||n.config.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),n.config.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},i.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(o){n.config.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=o),(0,r.canReportError)(e)?e.error(o):console.warn(o)}},i.prototype.forEach=function(r,e){var o=this;return new(e=s(e))(function(e,t){var n;n=o.subscribe(function(e){try{r(e)}catch(o){t(o),n&&n.unsubscribe()}},t,e)})},i.prototype._subscribe=function(r){var e=this.source;return e&&e.subscribe(r)},i.prototype[o.observable]=function(){return this},i.prototype.pipe=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return 0===r.length?this:(0,t.pipeFromArray)(r)(this)},i.prototype.toPromise=function(r){var e=this;return new(r=s(r))(function(r,o){var t;e.subscribe(function(r){return t=r},function(r){return o(r)},function(){return r(t)})})},i.create=function(r){return new i(r)},i}();function s(r){if(r||(r=n.config.Promise||Promise),!r)throw new Error("no Promise impl found");return r}exports.Observable=i;
},{"./util/canReportError":"wHmS","./util/toSubscriber":"SEU0","./symbol/observable":"tjV3","./util/pipe":"HQCS","./config":"Q3iD"}],"xQEi":[function(require,module,exports) {
"use strict";function r(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ObjectUnsubscribedError=void 0,r.prototype=Object.create(Error.prototype);var e=r;exports.ObjectUnsubscribedError=e;
},{}],"fyc3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SubjectSubscription=void 0;var e=i(require("tslib")),t=require("./Subscription");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function i(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var u=n?Object.getOwnPropertyDescriptor(e,s):null;u&&(u.get||u.set)?Object.defineProperty(i,s,u):i[s]=e[s]}return i.default=e,t&&t.set(e,i),i}var n=function(t){function r(e,r){var i=t.call(this)||this;return i.subject=e,i.subscriber=r,i.closed=!1,i}return e.__extends(r,t),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}},r}(t.Subscription);exports.SubjectSubscription=n;
},{"tslib":"vCxL","./Subscription":"I8KM"}],"r9t1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnonymousSubject=exports.Subject=exports.SubjectSubscriber=void 0;var r=c(require("tslib")),e=require("./Observable"),t=require("./Subscriber"),o=require("./Subscription"),s=require("./util/ObjectUnsubscribedError"),i=require("./SubjectSubscription"),n=require("../internal/symbol/rxSubscriber");function u(){if("function"!=typeof WeakMap)return null;var r=new WeakMap;return u=function(){return r},r}function c(r){if(r&&r.__esModule)return r;if(null===r||"object"!=typeof r&&"function"!=typeof r)return{default:r};var e=u();if(e&&e.has(r))return e.get(r);var t={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s)){var i=o?Object.getOwnPropertyDescriptor(r,s):null;i&&(i.get||i.set)?Object.defineProperty(t,s,i):t[s]=r[s]}return t.default=r,e&&e.set(r,t),t}var b=function(e){function t(r){var t=e.call(this,r)||this;return t.destination=r,t}return r.__extends(t,e),t}(t.Subscriber);exports.SubjectSubscriber=b;var p=function(t){function u(){var r=t.call(this)||this;return r.observers=[],r.closed=!1,r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return r.__extends(u,t),u.prototype[n.rxSubscriber]=function(){return new b(this)},u.prototype.lift=function(r){var e=new h(this,this);return e.operator=r,e},u.prototype.next=function(r){if(this.closed)throw new s.ObjectUnsubscribedError;if(!this.isStopped)for(var e=this.observers,t=e.length,o=e.slice(),i=0;i<t;i++)o[i].next(r)},u.prototype.error=function(r){if(this.closed)throw new s.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=r,this.isStopped=!0;for(var e=this.observers,t=e.length,o=e.slice(),i=0;i<t;i++)o[i].error(r);this.observers.length=0},u.prototype.complete=function(){if(this.closed)throw new s.ObjectUnsubscribedError;this.isStopped=!0;for(var r=this.observers,e=r.length,t=r.slice(),o=0;o<e;o++)t[o].complete();this.observers.length=0},u.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},u.prototype._trySubscribe=function(r){if(this.closed)throw new s.ObjectUnsubscribedError;return t.prototype._trySubscribe.call(this,r)},u.prototype._subscribe=function(r){if(this.closed)throw new s.ObjectUnsubscribedError;return this.hasError?(r.error(this.thrownError),o.Subscription.EMPTY):this.isStopped?(r.complete(),o.Subscription.EMPTY):(this.observers.push(r),new i.SubjectSubscription(this,r))},u.prototype.asObservable=function(){var r=new e.Observable;return r.source=this,r},u.create=function(r,e){return new h(r,e)},u}(e.Observable);exports.Subject=p;var h=function(e){function t(r,t){var o=e.call(this)||this;return o.destination=r,o.source=t,o}return r.__extends(t,e),t.prototype.next=function(r){var e=this.destination;e&&e.next&&e.next(r)},t.prototype.error=function(r){var e=this.destination;e&&e.error&&this.destination.error(r)},t.prototype.complete=function(){var r=this.destination;r&&r.complete&&this.destination.complete()},t.prototype._subscribe=function(r){return this.source?this.source.subscribe(r):o.Subscription.EMPTY},t}(p);exports.AnonymousSubject=h;
},{"tslib":"vCxL","./Observable":"wbSE","./Subscriber":"RaFB","./Subscription":"I8KM","./util/ObjectUnsubscribedError":"xQEi","./SubjectSubscription":"fyc3","../internal/symbol/rxSubscriber":"yAZp"}],"vT9o":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.refCount=o;var e=r(require("tslib")),n=require("../Subscriber");function t(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return t=function(){return e},e}function r(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=t();if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)){var i=o?Object.getOwnPropertyDescriptor(e,c):null;i&&(i.get||i.set)?Object.defineProperty(r,c,i):r[c]=e[c]}return r.default=e,n&&n.set(e,r),r}function o(){return function(e){return e.lift(new c(e))}}var c=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,n){var t=this.connectable;t._refCount++;var r=new i(e,t),o=n.subscribe(r);return r.closed||(r.connection=t.connect()),o},e}(),i=function(n){function t(e,t){var r=n.call(this,e)||this;return r.connectable=t,r}return e.__extends(t,n),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var n=e._refCount;if(n<=0)this.connection=null;else if(e._refCount=n-1,n>1)this.connection=null;else{var t=this.connection,r=e._connection;this.connection=null,!r||t&&r!==t||r.unsubscribe()}}else this.connection=null},t}(n.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"kkfD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.connectableObservableDescriptor=exports.ConnectableObservable=void 0;var e=i(require("tslib")),t=require("../Subject"),n=require("../Observable"),r=require("../Subscriber"),o=require("../Subscription"),c=require("../operators/refCount");function u(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function i(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=u();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var c=r?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(n,o,c):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}var s=function(t){function n(e,n){var r=t.call(this)||this;return r.source=e,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return e.__extends(n,t),n.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},n.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},n.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new o.Subscription).add(this.source.subscribe(new a(this.getSubject(),this))),e.closed&&(this._connection=null,e=o.Subscription.EMPTY)),e},n.prototype.refCount=function(){return(0,c.refCount)()(this)},n}(n.Observable);exports.ConnectableObservable=s;var l=s.prototype,b={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:l._subscribe},_isComplete:{value:l._isComplete,writable:!0},getSubject:{value:l.getSubject},connect:{value:l.connect},refCount:{value:l.refCount}};exports.connectableObservableDescriptor=b;var a=function(t){function n(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return e.__extends(n,t),n.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},n.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},n.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},n}(t.SubjectSubscriber),p=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new f(e,n),o=t.subscribe(r);return r.closed||(r.connection=n.connect()),o},e}(),f=function(t){function n(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return e.__extends(n,t),n.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},n}(r.Subscriber);
},{"tslib":"vCxL","../Subject":"r9t1","../Observable":"wbSE","../Subscriber":"RaFB","../Subscription":"I8KM","../operators/refCount":"vT9o"}],"dNgG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.groupBy=s,exports.GroupedObservable=void 0;var t=u(require("tslib")),e=require("../Subscriber"),r=require("../Subscription"),o=require("../Observable"),n=require("../Subject");function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function u(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var u=o?Object.getOwnPropertyDescriptor(t,n):null;u&&(u.get||u.set)?Object.defineProperty(r,n,u):r[n]=t[n]}return r.default=t,e&&e.set(t,r),r}function s(t,e,r,o){return function(n){return n.lift(new c(t,e,r,o))}}var c=function(){function t(t,e,r,o){this.keySelector=t,this.elementSelector=e,this.durationSelector=r,this.subjectSelector=o}return t.prototype.call=function(t,e){return e.subscribe(new p(t,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},t}(),p=function(e){function r(t,r,o,n,i){var u=e.call(this,t)||this;return u.keySelector=r,u.elementSelector=o,u.durationSelector=n,u.subjectSelector=i,u.groups=null,u.attemptedToUnsubscribe=!1,u.count=0,u}return t.__extends(r,e),r.prototype._next=function(t){var e;try{e=this.keySelector(t)}catch(r){return void this.error(r)}this._group(t,e)},r.prototype._group=function(t,e){var r=this.groups;r||(r=this.groups=new Map);var o,i=r.get(e);if(this.elementSelector)try{o=this.elementSelector(t)}catch(c){this.error(c)}else o=t;if(!i){i=this.subjectSelector?this.subjectSelector():new n.Subject,r.set(e,i);var u=new a(e,i,this);if(this.destination.next(u),this.durationSelector){var s=void 0;try{s=this.durationSelector(new a(e,i))}catch(c){return void this.error(c)}this.add(s.subscribe(new l(e,i,this)))}}i.closed||i.next(o)},r.prototype._error=function(t){var e=this.groups;e&&(e.forEach(function(e,r){e.error(t)}),e.clear()),this.destination.error(t)},r.prototype._complete=function(){var t=this.groups;t&&(t.forEach(function(t,e){t.complete()}),t.clear()),this.destination.complete()},r.prototype.removeGroup=function(t){this.groups.delete(t)},r.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))},r}(e.Subscriber),l=function(e){function r(t,r,o){var n=e.call(this,r)||this;return n.key=t,n.group=r,n.parent=o,n}return t.__extends(r,e),r.prototype._next=function(t){this.complete()},r.prototype._unsubscribe=function(){var t=this.parent,e=this.key;this.key=this.parent=null,t&&t.removeGroup(e)},r}(e.Subscriber),a=function(e){function o(t,r,o){var n=e.call(this)||this;return n.key=t,n.groupSubject=r,n.refCountSubscription=o,n}return t.__extends(o,e),o.prototype._subscribe=function(t){var e=new r.Subscription,o=this.refCountSubscription,n=this.groupSubject;return o&&!o.closed&&e.add(new b(o)),e.add(n.subscribe(t)),e},o}(o.Observable);exports.GroupedObservable=a;var b=function(e){function r(t){var r=e.call(this)||this;return r.parent=t,t.count++,r}return t.__extends(r,e),r.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},r}(r.Subscription);
},{"tslib":"vCxL","../Subscriber":"RaFB","../Subscription":"I8KM","../Observable":"wbSE","../Subject":"r9t1"}],"MPU6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BehaviorSubject=void 0;var e=n(require("tslib")),t=require("./Subject"),r=require("./util/ObjectUnsubscribedError");function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)){var i=n?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(r,u,i):r[u]=e[u]}return r.default=e,t&&t.set(e,r),r}var u=function(t){function o(e){var r=t.call(this)||this;return r._value=e,r}return e.__extends(o,t),Object.defineProperty(o.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),o.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return r&&!r.closed&&e.next(this._value),r},o.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new r.ObjectUnsubscribedError;return this._value},o.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},o}(t.Subject);exports.BehaviorSubject=u;
},{"tslib":"vCxL","./Subject":"r9t1","./util/ObjectUnsubscribedError":"xQEi"}],"arqX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Action=void 0;var e=n(require("tslib")),t=require("../Subscription");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var u=o?Object.getOwnPropertyDescriptor(e,i):null;u&&(u.get||u.set)?Object.defineProperty(n,i,u):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}var o=function(t){function r(e,r){return t.call(this)||this}return e.__extends(r,t),r.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},r}(t.Subscription);exports.Action=o;
},{"tslib":"vCxL","../Subscription":"I8KM"}],"llYF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AsyncAction=void 0;var t=r(require("tslib")),e=require("./Action");function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function r(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)){var c=n?Object.getOwnPropertyDescriptor(t,s):null;c&&(c.get||c.set)?Object.defineProperty(r,s,c):r[s]=t[s]}return r.default=t,e&&e.set(t,r),r}var n=function(e){function i(t,i){var r=e.call(this,t,i)||this;return r.scheduler=t,r.work=i,r.pending=!1,r}return t.__extends(i,e),i.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},i.prototype.requestAsyncId=function(t,e,i){return void 0===i&&(i=0),setInterval(t.flush.bind(t,this),i)},i.prototype.recycleAsyncId=function(t,e,i){if(void 0===i&&(i=0),null!==i&&this.delay===i&&!1===this.pending)return e;clearInterval(e)},i.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},i.prototype._execute=function(t,e){var i=!1,r=void 0;try{this.work(t)}catch(n){i=!0,r=!!n&&n||new Error(n)}if(i)return this.unsubscribe(),r},i.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,i=e.actions,r=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&i.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},i}(e.Action);exports.AsyncAction=n;
},{"tslib":"vCxL","./Action":"arqX"}],"pLkv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.QueueAction=void 0;var e=n(require("tslib")),t=require("./AsyncAction");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)){var i=o?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u]}return n.default=e,t&&t.set(e,n),n}var o=function(t){function r(e,r){var n=t.call(this,e,r)||this;return n.scheduler=e,n.work=r,n}return e.__extends(r,t),r.prototype.schedule=function(e,r){return void 0===r&&(r=0),r>0?t.prototype.schedule.call(this,e,r):(this.delay=r,this.state=e,this.scheduler.flush(this),this)},r.prototype.execute=function(e,r){return r>0||this.closed?t.prototype.execute.call(this,e,r):this._execute(e,r)},r.prototype.requestAsyncId=function(e,r,n){return void 0===n&&(n=0),null!==n&&n>0||null===n&&this.delay>0?t.prototype.requestAsyncId.call(this,e,r,n):e.flush(this)},r}(t.AsyncAction);exports.QueueAction=o;
},{"tslib":"vCxL","./AsyncAction":"llYF"}],"QglZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Scheduler=void 0;var e=function(){function e(t,o){void 0===o&&(o=e.now),this.SchedulerAction=t,this.now=o}return e.prototype.schedule=function(e,t,o){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(o,t)},e.now=function(){return Date.now()},e}();exports.Scheduler=e;
},{}],"hnPK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AsyncScheduler=void 0;var e=i(require("tslib")),t=require("../Scheduler");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function i(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var u=n?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(i,o,u):i[o]=e[o]}return i.default=e,t&&t.set(e,i),i}var n=function(r){function i(e,n){void 0===n&&(n=t.Scheduler.now);var o=r.call(this,e,function(){return i.delegate&&i.delegate!==o?i.delegate.now():n()})||this;return o.actions=[],o.active=!1,o.scheduled=void 0,o}return e.__extends(i,r),i.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),i.delegate&&i.delegate!==this?i.delegate.schedule(e,t,n):r.prototype.schedule.call(this,e,t,n)},i.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var r;this.active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}},i}(t.Scheduler);exports.AsyncScheduler=n;
},{"tslib":"vCxL","../Scheduler":"QglZ"}],"j0lZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.QueueScheduler=void 0;var e=n(require("tslib")),r=require("./AsyncScheduler");function t(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return t=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=t();if(r&&r.has(e))return r.get(e);var n={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=u?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}var u=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return e.__extends(t,r),t}(r.AsyncScheduler);exports.QueueScheduler=u;
},{"tslib":"vCxL","./AsyncScheduler":"hnPK"}],"HGOP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.queue=void 0;var e=require("./QueueAction"),u=require("./QueueScheduler"),r=new u.QueueScheduler(e.QueueAction);exports.queue=r;
},{"./QueueAction":"pLkv","./QueueScheduler":"j0lZ"}],"XsKQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.empty=t,exports.EMPTY=void 0;var e=require("../Observable"),r=new e.Observable(function(e){return e.complete()});function t(e){return e?n(e):r}function n(r){return new e.Observable(function(e){return r.schedule(function(){return e.complete()})})}exports.EMPTY=r;
},{"../Observable":"wbSE"}],"VqoH":[function(require,module,exports) {
"use strict";function e(e){return e&&"function"==typeof e.schedule}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isScheduler=e;
},{}],"lrFe":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.subscribeToArray=void 0;var e=function(e){return function(r){for(var o=0,t=e.length;o<t&&!r.closed;o++)r.next(e[o]);r.complete()}};exports.subscribeToArray=e;
},{}],"ZGwk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.scheduleArray=t;var e=require("../Observable"),r=require("../Subscription");function t(t,n){return new e.Observable(function(e){var u=new r.Subscription,s=0;return u.add(n.schedule(function(){s!==t.length?(e.next(t[s++]),e.closed||u.add(this.schedule())):e.complete()})),u})}
},{"../Observable":"wbSE","../Subscription":"I8KM"}],"PJGF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromArray=u;var e=require("../Observable"),r=require("../util/subscribeToArray"),s=require("../scheduled/scheduleArray");function u(u,a){return a?(0,s.scheduleArray)(u,a):new e.Observable((0,r.subscribeToArray)(u))}
},{"../Observable":"wbSE","../util/subscribeToArray":"lrFe","../scheduled/scheduleArray":"ZGwk"}],"wZuk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.of=t;var e=require("../util/isScheduler"),r=require("./fromArray"),u=require("../scheduled/scheduleArray");function t(){for(var t=[],l=0;l<arguments.length;l++)t[l]=arguments[l];var o=t[t.length-1];return(0,e.isScheduler)(o)?(t.pop(),(0,u.scheduleArray)(t,o)):(0,r.fromArray)(t)}
},{"../util/isScheduler":"VqoH","./fromArray":"PJGF","../scheduled/scheduleArray":"ZGwk"}],"FdIu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.throwError=e;var r=require("../Observable");function e(e,o){return o?new r.Observable(function(r){return o.schedule(n,0,{error:e,subscriber:r})}):new r.Observable(function(r){return r.error(e)})}function n(r){var e=r.error;r.subscriber.error(e)}
},{"../Observable":"wbSE"}],"n7Mc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Notification=exports.NotificationKind=void 0;var e,t=require("./observable/empty"),r=require("./observable/of"),o=require("./observable/throwError");exports.NotificationKind=e,function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"}(e||(exports.NotificationKind=e={}));var i=function(){function e(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,r){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return r&&r()}},e.prototype.accept=function(e,t,r){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,r)},e.prototype.toObservable=function(){switch(this.kind){case"N":return(0,r.of)(this.value);case"E":return(0,o.throwError)(this.error);case"C":return(0,t.empty)()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}();exports.Notification=i;
},{"./observable/empty":"XsKQ","./observable/of":"wZuk","./observable/throwError":"FdIu"}],"ezNs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.observeOn=s,exports.ObserveOnMessage=exports.ObserveOnSubscriber=exports.ObserveOnOperator=void 0;var e=n(require("tslib")),t=require("../Subscriber"),r=require("../Notification");function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var o=n?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,t&&t.set(e,r),r}function s(e,t){return void 0===t&&(t=0),function(r){return r.lift(new o(e,t))}}var o=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.scheduler,this.delay))},e}();exports.ObserveOnOperator=o;var u=function(t){function i(e,r,i){void 0===i&&(i=0);var n=t.call(this,e)||this;return n.scheduler=r,n.delay=i,n}return e.__extends(i,t),i.dispatch=function(e){var t=e.notification,r=e.destination;t.observe(r),this.unsubscribe()},i.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(i.dispatch,this.delay,new c(e,this.destination)))},i.prototype._next=function(e){this.scheduleMessage(r.Notification.createNext(e))},i.prototype._error=function(e){this.scheduleMessage(r.Notification.createError(e)),this.unsubscribe()},i.prototype._complete=function(){this.scheduleMessage(r.Notification.createComplete()),this.unsubscribe()},i}(t.Subscriber);exports.ObserveOnSubscriber=u;var c=function(){return function(e,t){this.notification=e,this.destination=t}}();exports.ObserveOnMessage=c;
},{"tslib":"vCxL","../Subscriber":"RaFB","../Notification":"n7Mc"}],"Cp6P":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ReplaySubject=void 0;var e=c(require("tslib")),t=require("./Subject"),r=require("./scheduler/queue"),i=require("./Subscription"),n=require("./operators/observeOn"),o=require("./util/ObjectUnsubscribedError"),s=require("./SubjectSubscription");function u(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function c(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=u();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}var f=function(t){function u(e,r,i){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===r&&(r=Number.POSITIVE_INFINITY);var n=t.call(this)||this;return n.scheduler=i,n._events=[],n._infiniteTimeWindow=!1,n._bufferSize=e<1?1:e,n._windowTime=r<1?1:r,r===Number.POSITIVE_INFINITY?(n._infiniteTimeWindow=!0,n.next=n.nextInfiniteTimeWindow):n.next=n.nextTimeWindow,n}return e.__extends(u,t),u.prototype.nextInfiniteTimeWindow=function(e){var r=this._events;r.push(e),r.length>this._bufferSize&&r.shift(),t.prototype.next.call(this,e)},u.prototype.nextTimeWindow=function(e){this._events.push(new h(this._getNow(),e)),this._trimBufferThenGetEvents(),t.prototype.next.call(this,e)},u.prototype._subscribe=function(e){var t,r=this._infiniteTimeWindow,u=r?this._events:this._trimBufferThenGetEvents(),c=this.scheduler,f=u.length;if(this.closed)throw new o.ObjectUnsubscribedError;if(this.isStopped||this.hasError?t=i.Subscription.EMPTY:(this.observers.push(e),t=new s.SubjectSubscription(this,e)),c&&e.add(e=new n.ObserveOnSubscriber(e,c)),r)for(var h=0;h<f&&!e.closed;h++)e.next(u[h]);else for(h=0;h<f&&!e.closed;h++)e.next(u[h].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},u.prototype._getNow=function(){return(this.scheduler||r.queue).now()},u.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,r=this._windowTime,i=this._events,n=i.length,o=0;o<n&&!(e-i[o].time<r);)o++;return n>t&&(o=Math.max(o,n-t)),o>0&&i.splice(0,o),i},u}(t.Subject);exports.ReplaySubject=f;var h=function(){return function(e,t){this.time=e,this.value=t}}();
},{"tslib":"vCxL","./Subject":"r9t1","./scheduler/queue":"HGOP","./Subscription":"I8KM","./operators/observeOn":"ezNs","./util/ObjectUnsubscribedError":"xQEi","./SubjectSubscription":"fyc3"}],"Scvc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AsyncSubject=void 0;var t=n(require("tslib")),e=require("./Subject"),r=require("./Subscription");function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var s=n?Object.getOwnPropertyDescriptor(t,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}var i=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return t.__extends(o,e),o.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),r.Subscription.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),r.Subscription.EMPTY):e.prototype._subscribe.call(this,t)},o.prototype.next=function(t){this.hasCompleted||(this.value=t,this.hasNext=!0)},o.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},o.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},o}(e.Subject);exports.AsyncSubject=i;
},{"tslib":"vCxL","./Subject":"r9t1","./Subscription":"I8KM"}],"Z56L":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Immediate=void 0;var e=1,t={};function r(e){var r=t[e];r&&r()}var i={setImmediate:function(i){var n=e++;return t[n]=i,Promise.resolve().then(function(){return r(n)}),n},clearImmediate:function(e){delete t[e]}};exports.Immediate=i;
},{}],"k3eS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AsapAction=void 0;var e=i(require("tslib")),t=require("../util/Immediate"),r=require("./AsyncAction");function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}function i(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var u=i?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(r,o,u):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}var o=function(r){function n(e,t){var n=r.call(this,e,t)||this;return n.scheduler=e,n.work=t,n}return e.__extends(n,r),n.prototype.requestAsyncId=function(e,n,i){return void 0===i&&(i=0),null!==i&&i>0?r.prototype.requestAsyncId.call(this,e,n,i):(e.actions.push(this),e.scheduled||(e.scheduled=t.Immediate.setImmediate(e.flush.bind(e,null))))},n.prototype.recycleAsyncId=function(e,n,i){if(void 0===i&&(i=0),null!==i&&i>0||null===i&&this.delay>0)return r.prototype.recycleAsyncId.call(this,e,n,i);0===e.actions.length&&(t.Immediate.clearImmediate(n),e.scheduled=void 0)},n}(r.AsyncAction);exports.AsapAction=o;
},{"tslib":"vCxL","../util/Immediate":"Z56L","./AsyncAction":"llYF"}],"czze":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AsapScheduler=void 0;var e=n(require("tslib")),t=require("./AsyncScheduler");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)){var o=i?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(n,u,o):n[u]=e[u]}return n.default=e,t&&t.set(e,n),n}var i=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e.__extends(r,t),r.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,r=this.actions,n=-1,i=r.length;e=e||r.shift();do{if(t=e.execute(e.state,e.delay))break}while(++n<i&&(e=r.shift()));if(this.active=!1,t){for(;++n<i&&(e=r.shift());)e.unsubscribe();throw t}},r}(t.AsyncScheduler);exports.AsapScheduler=i;
},{"tslib":"vCxL","./AsyncScheduler":"hnPK"}],"ZqYc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.asap=void 0;var e=require("./AsapAction"),r=require("./AsapScheduler"),s=new r.AsapScheduler(e.AsapAction);exports.asap=s;
},{"./AsapAction":"k3eS","./AsapScheduler":"czze"}],"jun6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.async=void 0;var e=require("./AsyncAction"),r=require("./AsyncScheduler"),c=new r.AsyncScheduler(e.AsyncAction);exports.async=c;
},{"./AsyncAction":"llYF","./AsyncScheduler":"hnPK"}],"m8qQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnimationFrameAction=void 0;var e=n(require("tslib")),t=require("./AsyncAction");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var c=o?Object.getOwnPropertyDescriptor(e,i):null;c&&(c.get||c.set)?Object.defineProperty(n,i,c):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}var o=function(t){function r(e,r){var n=t.call(this,e,r)||this;return n.scheduler=e,n.work=r,n}return e.__extends(r,t),r.prototype.requestAsyncId=function(e,r,n){return void 0===n&&(n=0),null!==n&&n>0?t.prototype.requestAsyncId.call(this,e,r,n):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame(function(){return e.flush(null)})))},r.prototype.recycleAsyncId=function(e,r,n){if(void 0===n&&(n=0),null!==n&&n>0||null===n&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,r,n);0===e.actions.length&&(cancelAnimationFrame(r),e.scheduled=void 0)},r}(t.AsyncAction);exports.AnimationFrameAction=o;
},{"tslib":"vCxL","./AsyncAction":"llYF"}],"gboY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnimationFrameScheduler=void 0;var e=n(require("tslib")),t=require("./AsyncScheduler");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var u=i?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(n,o,u):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}var i=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e.__extends(r,t),r.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,r=this.actions,n=-1,i=r.length;e=e||r.shift();do{if(t=e.execute(e.state,e.delay))break}while(++n<i&&(e=r.shift()));if(this.active=!1,t){for(;++n<i&&(e=r.shift());)e.unsubscribe();throw t}},r}(t.AsyncScheduler);exports.AnimationFrameScheduler=i;
},{"tslib":"vCxL","./AsyncScheduler":"hnPK"}],"zUKp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.animationFrame=void 0;var e=require("./AnimationFrameAction"),i=require("./AnimationFrameScheduler"),r=new i.AnimationFrameScheduler(e.AnimationFrameAction);exports.animationFrame=r;
},{"./AnimationFrameAction":"m8qQ","./AnimationFrameScheduler":"gboY"}],"RuMO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VirtualAction=exports.VirtualTimeScheduler=void 0;var e=n(require("tslib")),t=require("./AsyncAction"),r=require("./AsyncScheduler");function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var u=n?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(r,o,u):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}var o=function(t){function r(e,r){void 0===e&&(e=u),void 0===r&&(r=Number.POSITIVE_INFINITY);var i=t.call(this,e,function(){return i.frame})||this;return i.maxFrames=r,i.frame=0,i.index=-1,i}return e.__extends(r,t),r.prototype.flush=function(){for(var e,t,r=this.actions,i=this.maxFrames;(t=r[0])&&t.delay<=i&&(r.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=r.shift();)t.unsubscribe();throw e}},r.frameTimeFactor=10,r}(r.AsyncScheduler);exports.VirtualTimeScheduler=o;var u=function(t){function r(e,r,i){void 0===i&&(i=e.index+=1);var n=t.call(this,e,r)||this;return n.scheduler=e,n.work=r,n.index=i,n.active=!0,n.index=e.index=i,n}return e.__extends(r,t),r.prototype.schedule=function(e,i){if(void 0===i&&(i=0),!this.id)return t.prototype.schedule.call(this,e,i);this.active=!1;var n=new r(this.scheduler,this.work);return this.add(n),n.schedule(e,i)},r.prototype.requestAsyncId=function(e,t,i){void 0===i&&(i=0),this.delay=e.frame+i;var n=e.actions;return n.push(this),n.sort(r.sortActions),!0},r.prototype.recycleAsyncId=function(e,t,r){void 0===r&&(r=0)},r.prototype._execute=function(e,r){if(!0===this.active)return t.prototype._execute.call(this,e,r)},r.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},r}(t.AsyncAction);exports.VirtualAction=u;
},{"tslib":"vCxL","./AsyncAction":"llYF","./AsyncScheduler":"hnPK"}],"LXph":[function(require,module,exports) {
"use strict";function e(e){return e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.identity=e;
},{}],"cUXi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isObservable=r;var e=require("../Observable");function r(r){return!!r&&(r instanceof e.Observable||"function"==typeof r.lift&&"function"==typeof r.subscribe)}
},{"../Observable":"wbSE"}],"Qh4I":[function(require,module,exports) {
"use strict";function r(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArgumentOutOfRangeError=void 0,r.prototype=Object.create(Error.prototype);var e=r;exports.ArgumentOutOfRangeError=e;
},{}],"vsl0":[function(require,module,exports) {
"use strict";function r(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}Object.defineProperty(exports,"__esModule",{value:!0}),exports.EmptyError=void 0,r.prototype=Object.create(Error.prototype);var e=r;exports.EmptyError=e;
},{}],"SZK7":[function(require,module,exports) {
"use strict";function r(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}Object.defineProperty(exports,"__esModule",{value:!0}),exports.TimeoutError=void 0,r.prototype=Object.create(Error.prototype);var e=r;exports.TimeoutError=e;
},{}],"dNh5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.map=o,exports.MapOperator=void 0;var t=n(require("tslib")),r=require("../Subscriber");function e(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return e=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=e();if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var u=o?Object.getOwnPropertyDescriptor(t,i):null;u&&(u.get||u.set)?Object.defineProperty(n,i,u):n[i]=t[i]}return n.default=t,r&&r.set(t,n),n}function o(t,r){return function(e){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return e.lift(new i(t,r))}}var i=function(){function t(t,r){this.project=t,this.thisArg=r}return t.prototype.call=function(t,r){return r.subscribe(new u(t,this.project,this.thisArg))},t}();exports.MapOperator=i;var u=function(r){function e(t,e,n){var o=r.call(this,t)||this;return o.project=e,o.count=0,o.thisArg=n||o,o}return t.__extends(e,r),e.prototype._next=function(t){var r;try{r=this.project.call(this.thisArg,t,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(r)},e}(r.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"lxDK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bindCallback=a;var r=require("../Observable"),e=require("../AsyncSubject"),t=require("../operators/map"),c=require("../util/canReportError"),n=require("../util/isArray"),u=require("../util/isScheduler");function a(s,o,l){if(o){if(!(0,u.isScheduler)(o))return function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return a(s,l).apply(void 0,r).pipe((0,t.map)(function(r){return(0,n.isArray)(r)?o.apply(void 0,r):o(r)}))};l=o}return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var u,a=this,o={context:a,subject:u,callbackFunc:s,scheduler:l};return new r.Observable(function(r){if(l){var n={args:t,subscriber:r,params:o};return l.schedule(i,0,n)}if(!u){u=new e.AsyncSubject;try{s.apply(a,t.concat([function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];u.next(r.length<=1?r[0]:r),u.complete()}]))}catch(b){(0,c.canReportError)(u)?u.error(b):console.warn(b)}}return u.subscribe(r)})}}function i(r){var t=this,c=r.args,n=r.subscriber,u=r.params,a=u.callbackFunc,i=u.context,o=u.scheduler,l=u.subject;if(!l){l=u.subject=new e.AsyncSubject;try{a.apply(i,c.concat([function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var c=r.length<=1?r[0]:r;t.add(o.schedule(s,0,{value:c,subject:l}))}]))}catch(b){l.error(b)}}this.add(l.subscribe(n))}function s(r){var e=r.value,t=r.subject;t.next(e),t.complete()}function o(r){var e=r.err;r.subject.error(e)}
},{"../Observable":"wbSE","../AsyncSubject":"Scvc","../operators/map":"dNh5","../util/canReportError":"wHmS","../util/isArray":"KeTG","../util/isScheduler":"VqoH"}],"uTDa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bindNodeCallback=s;var e=require("../Observable"),r=require("../AsyncSubject"),t=require("../operators/map"),c=require("../util/canReportError"),u=require("../util/isScheduler"),n=require("../util/isArray");function s(i,o,l){if(o){if(!(0,u.isScheduler)(o))return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return s(i,l).apply(void 0,e).pipe((0,t.map)(function(e){return(0,n.isArray)(e)?o.apply(void 0,e):o(e)}))};l=o}return function(){for(var t=[],u=0;u<arguments.length;u++)t[u]=arguments[u];var n={subject:void 0,args:t,callbackFunc:i,scheduler:l,context:this};return new e.Observable(function(e){var u=n.context,s=n.subject;if(l)return l.schedule(a,0,{params:n,subscriber:e,context:u});if(!s){s=n.subject=new r.AsyncSubject;try{i.apply(u,t.concat([function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e.shift();t?s.error(t):(s.next(e.length<=1?e[0]:e),s.complete())}]))}catch(o){(0,c.canReportError)(s)?s.error(o):console.warn(o)}}return s.subscribe(e)})}}function a(e){var t=this,c=e.params,u=e.subscriber,n=e.context,s=c.callbackFunc,a=c.args,l=c.scheduler,b=c.subject;if(!b){b=c.subject=new r.AsyncSubject;try{s.apply(n,a.concat([function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var c=e.shift();if(c)t.add(l.schedule(o,0,{err:c,subject:b}));else{var u=e.length<=1?e[0]:e;t.add(l.schedule(i,0,{value:u,subject:b}))}}]))}catch(d){this.add(l.schedule(o,0,{err:d,subject:b}))}}this.add(b.subscribe(u))}function i(e){var r=e.value,t=e.subject;t.next(r),t.complete()}function o(e){var r=e.err;e.subject.error(r)}
},{"../Observable":"wbSE","../AsyncSubject":"Scvc","../operators/map":"dNh5","../util/canReportError":"wHmS","../util/isScheduler":"VqoH","../util/isArray":"KeTG"}],"hZYI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.OuterSubscriber=void 0;var t=n(require("tslib")),e=require("./Subscriber");function r(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var u=o?Object.getOwnPropertyDescriptor(t,i):null;u&&(u.get||u.set)?Object.defineProperty(n,i,u):n[i]=t[i]}return n.default=t,e&&e.set(t,n),n}var o=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r.prototype.notifyNext=function(t,e,r,n,o){this.destination.next(e)},r.prototype.notifyError=function(t,e){this.destination.error(t)},r.prototype.notifyComplete=function(t){this.destination.complete()},r}(e.Subscriber);exports.OuterSubscriber=o;
},{"tslib":"vCxL","./Subscriber":"RaFB"}],"aQbR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InnerSubscriber=void 0;var e=n(require("tslib")),t=require("./Subscriber");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var u=i?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(n,o,u):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}var i=function(t){function r(e,r,n){var i=t.call(this)||this;return i.parent=e,i.outerValue=r,i.outerIndex=n,i.index=0,i}return e.__extends(r,t),r.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},r.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(t.Subscriber);exports.InnerSubscriber=i;
},{"tslib":"vCxL","./Subscriber":"RaFB"}],"eggw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.subscribeToPromise=void 0;var r=require("./hostReportError"),e=function(e){return function(o){return e.then(function(r){o.closed||(o.next(r),o.complete())},function(r){return o.error(r)}).then(null,r.hostReportError),o}};exports.subscribeToPromise=e;
},{"./hostReportError":"JfKC"}],"AqTP":[function(require,module,exports) {
"use strict";function t(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSymbolIterator=t,exports.$$iterator=exports.iterator=void 0;var r=t();exports.iterator=r;var e=r;exports.$$iterator=e;
},{}],"QEdH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.subscribeToIterable=void 0;var e=require("../symbol/iterator"),r=function(r){return function(t){for(var o=r[e.iterator]();;){var n=o.next();if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof o.return&&t.add(function(){o.return&&o.return()}),t}};exports.subscribeToIterable=r;
},{"../symbol/iterator":"AqTP"}],"buzG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.subscribeToObservable=void 0;var e=require("../symbol/observable"),r=function(r){return function(o){var b=r[e.observable]();if("function"!=typeof b.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return b.subscribe(o)}};exports.subscribeToObservable=r;
},{"../symbol/observable":"tjV3"}],"LS84":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isArrayLike=void 0;var e=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};exports.isArrayLike=e;
},{}],"Ok8F":[function(require,module,exports) {
"use strict";function e(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isPromise=e;
},{}],"vq9L":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.subscribeTo=void 0;var e=require("./subscribeToArray"),r=require("./subscribeToPromise"),i=require("./subscribeToIterable"),s=require("./subscribeToObservable"),o=require("./isArrayLike"),b=require("./isPromise"),u=require("./isObject"),t=require("../symbol/iterator"),a=require("../symbol/observable"),c=function(c){if(c&&"function"==typeof c[a.observable])return(0,s.subscribeToObservable)(c);if((0,o.isArrayLike)(c))return(0,e.subscribeToArray)(c);if((0,b.isPromise)(c))return(0,r.subscribeToPromise)(c);if(c&&"function"==typeof c[t.iterator])return(0,i.subscribeToIterable)(c);var n=(0,u.isObject)(c)?"an invalid object":"'"+c+"'";throw new TypeError("You provided "+n+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};exports.subscribeTo=c;
},{"./subscribeToArray":"lrFe","./subscribeToPromise":"eggw","./subscribeToIterable":"QEdH","./subscribeToObservable":"buzG","./isArrayLike":"LS84","./isPromise":"Ok8F","./isObject":"nU7r","../symbol/iterator":"AqTP","../symbol/observable":"tjV3"}],"JM7e":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.subscribeToResult=b;var e=require("../InnerSubscriber"),r=require("./subscribeTo"),s=require("../Observable");function b(b,i,u,c,n){if(void 0===n&&(n=new e.InnerSubscriber(b,u,c)),!n.closed)return i instanceof s.Observable?i.subscribe(n):(0,r.subscribeTo)(i)(n)}
},{"../InnerSubscriber":"aQbR","./subscribeTo":"vq9L","../Observable":"wbSE"}],"omVc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.combineLatest=a,exports.CombineLatestSubscriber=exports.CombineLatestOperator=void 0;var t=u(require("tslib")),e=require("../util/isScheduler"),r=require("../util/isArray"),i=require("../OuterSubscriber"),o=require("../util/subscribeToResult"),s=require("./fromArray");function n(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return n=function(){return t},t}function u(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=n();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var s=i?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,e&&e.set(t,r),r}var l={};function a(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var o=null,n=null;return(0,e.isScheduler)(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(o=t.pop()),1===t.length&&(0,r.isArray)(t[0])&&(t=t[0]),(0,s.fromArray)(t,n).lift(new c(o))}var c=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new p(t,this.resultSelector))},t}();exports.CombineLatestOperator=c;var p=function(e){function r(t,r){var i=e.call(this,t)||this;return i.resultSelector=r,i.active=0,i.values=[],i.observables=[],i}return t.__extends(r,e),r.prototype._next=function(t){this.values.push(l),this.observables.push(t)},r.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var r=0;r<e;r++){var i=t[r];this.add((0,o.subscribeToResult)(this,i,i,r))}}},r.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},r.prototype.notifyNext=function(t,e,r,i,o){var s=this.values,n=s[r],u=this.toRespond?n===l?--this.toRespond:this.toRespond:0;s[r]=e,0===u&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))},r.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(r){return void this.destination.error(r)}this.destination.next(e)},r}(i.OuterSubscriber);exports.CombineLatestSubscriber=p;
},{"tslib":"vCxL","../util/isScheduler":"VqoH","../util/isArray":"KeTG","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e","./fromArray":"PJGF"}],"lgBy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.scheduleObservable=u;var e=require("../Observable"),r=require("../Subscription"),n=require("../symbol/observable");function u(u,t){return new e.Observable(function(e){var o=new r.Subscription;return o.add(t.schedule(function(){var r=u[n.observable]();o.add(r.subscribe({next:function(r){o.add(t.schedule(function(){return e.next(r)}))},error:function(r){o.add(t.schedule(function(){return e.error(r)}))},complete:function(){o.add(t.schedule(function(){return e.complete()}))}}))})),o})}
},{"../Observable":"wbSE","../Subscription":"I8KM","../symbol/observable":"tjV3"}],"aPE6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.schedulePromise=n;var e=require("../Observable"),r=require("../Subscription");function n(n,u){return new e.Observable(function(e){var t=new r.Subscription;return t.add(u.schedule(function(){return n.then(function(r){t.add(u.schedule(function(){e.next(r),t.add(u.schedule(function(){return e.complete()}))}))},function(r){t.add(u.schedule(function(){return e.error(r)}))})})),t})}
},{"../Observable":"wbSE","../Subscription":"I8KM"}],"XzIO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.scheduleIterable=n;var e=require("../Observable"),r=require("../Subscription"),t=require("../symbol/iterator");function n(n,u){if(!n)throw new Error("Iterable cannot be null");return new e.Observable(function(e){var o,i=new r.Subscription;return i.add(function(){o&&"function"==typeof o.return&&o.return()}),i.add(u.schedule(function(){o=n[t.iterator](),i.add(u.schedule(function(){if(!e.closed){var r,t;try{var n=o.next();r=n.value,t=n.done}catch(u){return void e.error(u)}t?e.complete():(e.next(r),this.schedule())}}))})),i})}
},{"../Observable":"wbSE","../Subscription":"I8KM","../symbol/iterator":"AqTP"}],"CTP2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isInteropObservable=r;var e=require("../symbol/observable");function r(r){return r&&"function"==typeof r[e.observable]}
},{"../symbol/observable":"tjV3"}],"NjuQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isIterable=r;var e=require("../symbol/iterator");function r(r){return r&&"function"==typeof r[e.iterator]}
},{"../symbol/iterator":"AqTP"}],"mNZE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.scheduled=a;var e=require("./scheduleObservable"),r=require("./schedulePromise"),i=require("./scheduleArray"),s=require("./scheduleIterable"),u=require("../util/isInteropObservable"),l=require("../util/isPromise"),t=require("../util/isArrayLike"),o=require("../util/isIterable");function a(a,b){if(null!=a){if((0,u.isInteropObservable)(a))return(0,e.scheduleObservable)(a,b);if((0,l.isPromise)(a))return(0,r.schedulePromise)(a,b);if((0,t.isArrayLike)(a))return(0,i.scheduleArray)(a,b);if((0,o.isIterable)(a)||"string"==typeof a)return(0,s.scheduleIterable)(a,b)}throw new TypeError((null!==a&&typeof a||a)+" is not observable")}
},{"./scheduleObservable":"lgBy","./schedulePromise":"aPE6","./scheduleArray":"ZGwk","./scheduleIterable":"XzIO","../util/isInteropObservable":"CTP2","../util/isPromise":"Ok8F","../util/isArrayLike":"LS84","../util/isIterable":"NjuQ"}],"WXUl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.from=u;var e=require("../Observable"),r=require("../util/subscribeTo"),s=require("../scheduled/scheduled");function u(u,b){return b?(0,s.scheduled)(u,b):u instanceof e.Observable?u:new e.Observable((0,r.subscribeTo)(u))}
},{"../Observable":"wbSE","../util/subscribeTo":"vq9L","../scheduled/scheduled":"mNZE"}],"nFsM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mergeMap=c,exports.MergeMapSubscriber=exports.MergeMapOperator=void 0;var e=s(require("tslib")),t=require("../util/subscribeToResult"),r=require("../OuterSubscriber"),i=require("../InnerSubscriber"),n=require("./map"),o=require("../observable/from");function u(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function s(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=u();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}function c(e,t,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"function"==typeof t?function(i){return i.pipe(c(function(r,i){return(0,o.from)(e(r,i)).pipe((0,n.map)(function(e,n){return t(r,e,i,n)}))},r))}:("number"==typeof t&&(r=t),function(t){return t.lift(new p(e,r))})}var p=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new f(e,this.project,this.concurrent))},e}();exports.MergeMapOperator=p;var f=function(r){function n(e,t,i){void 0===i&&(i=Number.POSITIVE_INFINITY);var n=r.call(this,e)||this;return n.project=t,n.concurrent=i,n.hasCompleted=!1,n.buffer=[],n.active=0,n.index=0,n}return e.__extends(n,r),n.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},n.prototype._tryNext=function(e){var t,r=this.index++;try{t=this.project(e,r)}catch(i){return void this.destination.error(i)}this.active++,this._innerSub(t,e,r)},n.prototype._innerSub=function(e,r,n){var o=new i.InnerSubscriber(this,void 0,void 0);this.destination.add(o),(0,t.subscribeToResult)(this,e,r,n,o)},n.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},n.prototype.notifyNext=function(e,t,r,i,n){this.destination.next(t)},n.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},n}(r.OuterSubscriber);exports.MergeMapSubscriber=f;
},{"tslib":"vCxL","../util/subscribeToResult":"JM7e","../OuterSubscriber":"hZYI","../InnerSubscriber":"aQbR","./map":"dNh5","../observable/from":"WXUl"}],"Nkv4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mergeAll=t;var e=require("./mergeMap"),r=require("../util/identity");function t(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),(0,e.mergeMap)(r.identity,t)}
},{"./mergeMap":"nFsM","../util/identity":"LXph"}],"Yxey":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.concatAll=r;var e=require("./mergeAll");function r(){return(0,e.mergeAll)(1)}
},{"./mergeAll":"Nkv4"}],"CsdO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.concat=o;var e=require("./of"),r=require("../operators/concatAll");function o(){for(var o=[],t=0;t<arguments.length;t++)o[t]=arguments[t];return(0,r.concatAll)()(e.of.apply(void 0,o))}
},{"./of":"wZuk","../operators/concatAll":"Yxey"}],"w9G6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defer=u;var e=require("../Observable"),r=require("./from"),t=require("./empty");function u(u){return new e.Observable(function(e){var o;try{o=u()}catch(i){return void e.error(i)}return(o?(0,r.from)(o):(0,t.empty)()).subscribe(e)})}
},{"../Observable":"wbSE","./from":"WXUl","./empty":"XsKQ"}],"R2GC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.forkJoin=o;var r=require("../Observable"),e=require("../util/isArray"),n=require("../operators/map"),t=require("../util/isObject"),i=require("../util/isObservable"),u=require("./from");function o(){for(var r=[],u=0;u<arguments.length;u++)r[u]=arguments[u];if(1===r.length){var o=r[0];if((0,e.isArray)(o))return l(o,null);if((0,t.isObject)(o)&&!(0,i.isObservable)(o)){var a=Object.keys(o);return l(a.map(function(r){return o[r]}),a)}}if("function"==typeof r[r.length-1]){var f=r.pop();return l(r=1===r.length&&(0,e.isArray)(r[0])?r[0]:r,null).pipe((0,n.map)(function(r){return f.apply(void 0,r)}))}return l(r,null)}function l(e,n){return new r.Observable(function(r){var t=e.length;if(0!==t)for(var i=new Array(t),o=0,l=0,a=function(a){var f=(0,u.from)(e[a]),c=!1;r.add(f.subscribe({next:function(r){c||(c=!0,l++),i[a]=r},error:function(e){return r.error(e)},complete:function(){++o!==t&&c||(l===t&&r.next(n?n.reduce(function(r,e,n){return r[e]=i[n],r},{}):i),r.complete())}}))},f=0;f<t;f++)a(f);else r.complete()})}
},{"../Observable":"wbSE","../util/isArray":"KeTG","../operators/map":"dNh5","../util/isObject":"nU7r","../util/isObservable":"cUXi","./from":"WXUl"}],"ZHZV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromEvent=i;var e=require("../Observable"),n=require("../util/isArray"),t=require("../util/isFunction"),r=require("../operators/map"),o=Object.prototype.toString;function i(o,f,a,c){return(0,t.isFunction)(a)&&(c=a,a=void 0),c?i(o,f,a).pipe((0,r.map)(function(e){return(0,n.isArray)(e)?c.apply(void 0,e):c(e)})):new e.Observable(function(e){u(o,f,function(n){arguments.length>1?e.next(Array.prototype.slice.call(arguments)):e.next(n)},e,a)})}function u(e,n,t,r,o){var i;if(c(e)){var s=e;e.addEventListener(n,t,o),i=function(){return s.removeEventListener(n,t,o)}}else if(a(e)){var v=e;e.on(n,t),i=function(){return v.off(n,t)}}else if(f(e)){var p=e;e.addListener(n,t),i=function(){return p.removeListener(n,t)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var l=0,d=e.length;l<d;l++)u(e[l],n,t,r,o)}r.add(i)}function f(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}function a(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}function c(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}
},{"../Observable":"wbSE","../util/isArray":"KeTG","../util/isFunction":"Qnsq","../operators/map":"dNh5"}],"HFE7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromEventPattern=i;var r=require("../Observable"),e=require("../util/isArray"),t=require("../util/isFunction"),n=require("../operators/map");function i(u,o,a){return a?i(u,o).pipe((0,n.map)(function(r){return(0,e.isArray)(r)?a.apply(void 0,r):a(r)})):new r.Observable(function(r){var e,n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.next(1===e.length?e[0]:e)};try{e=u(n)}catch(i){return void r.error(i)}if((0,t.isFunction)(o))return function(){return o(n,e)}})}
},{"../Observable":"wbSE","../util/isArray":"KeTG","../util/isFunction":"Qnsq","../operators/map":"dNh5"}],"xNZb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.generate=i;var e=require("../Observable"),r=require("../util/identity"),t=require("../util/isScheduler");function i(i,c,n,a,s){var u,d;if(1==arguments.length){var l=i;d=l.initialState,c=l.condition,n=l.iterate,u=l.resultSelector||r.identity,s=l.scheduler}else void 0===a||(0,t.isScheduler)(a)?(d=i,u=r.identity,s=a):(d=i,u=a);return new e.Observable(function(e){var r=d;if(s)return s.schedule(o,0,{subscriber:e,iterate:n,condition:c,resultSelector:u,state:r});for(;;){if(c){var t=void 0;try{t=c(r)}catch(a){return void e.error(a)}if(!t){e.complete();break}}var i=void 0;try{i=u(r)}catch(a){return void e.error(a)}if(e.next(i),e.closed)break;try{r=n(r)}catch(a){return void e.error(a)}}})}function o(e){var r=e.subscriber,t=e.condition;if(!r.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(c){return void r.error(c)}else e.needIterate=!0;if(t){var i=void 0;try{i=t(e.state)}catch(c){return void r.error(c)}if(!i)return void r.complete();if(r.closed)return}var o;try{o=e.resultSelector(e.state)}catch(c){return void r.error(c)}if(!r.closed&&(r.next(o),!r.closed))return this.schedule(e)}}
},{"../Observable":"wbSE","../util/identity":"LXph","../util/isScheduler":"VqoH"}],"SXp5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.iif=t;var e=require("./defer"),r=require("./empty");function t(t,i,u){return void 0===i&&(i=r.EMPTY),void 0===u&&(u=r.EMPTY),(0,e.defer)(function(){return t()?i:u})}
},{"./defer":"w9G6","./empty":"XsKQ"}],"wBpm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isNumeric=e;var r=require("./isArray");function e(e){return!(0,r.isArray)(e)&&e-parseFloat(e)+1>=0}
},{"./isArray":"KeTG"}],"QHLS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.interval=i;var e=require("../Observable"),r=require("../scheduler/async"),u=require("../util/isNumeric");function i(i,c){return void 0===i&&(i=0),void 0===c&&(c=r.async),(!(0,u.isNumeric)(i)||i<0)&&(i=0),c&&"function"==typeof c.schedule||(c=r.async),new e.Observable(function(e){return e.add(c.schedule(s,i,{subscriber:e,counter:0,period:i})),e})}function s(e){var r=e.subscriber,u=e.counter,i=e.period;r.next(u),this.schedule({subscriber:r,counter:u+1,period:i},i)}
},{"../Observable":"wbSE","../scheduler/async":"jun6","../util/isNumeric":"wBpm"}],"DQig":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.merge=u;var e=require("../Observable"),r=require("../util/isScheduler"),l=require("../operators/mergeAll"),t=require("./fromArray");function u(){for(var u=[],o=0;o<arguments.length;o++)u[o]=arguments[o];var n=Number.POSITIVE_INFINITY,p=null,i=u[u.length-1];return(0,r.isScheduler)(i)?(p=u.pop(),u.length>1&&"number"==typeof u[u.length-1]&&(n=u.pop())):"number"==typeof i&&(n=u.pop()),null===p&&1===u.length&&u[0]instanceof e.Observable?u[0]:(0,l.mergeAll)(n)((0,t.fromArray)(u,p))}
},{"../Observable":"wbSE","../util/isScheduler":"VqoH","../operators/mergeAll":"Nkv4","./fromArray":"PJGF"}],"TBTl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.never=t,exports.NEVER=void 0;var e=require("../Observable"),r=require("../util/noop"),o=new e.Observable(r.noop);function t(){return o}exports.NEVER=o;
},{"../Observable":"wbSE","../util/noop":"rXfM"}],"VCq5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onErrorResumeNext=i;var e=require("../Observable"),r=require("./from"),t=require("../util/isArray"),n=require("./empty");function i(){for(var u=[],o=0;o<arguments.length;o++)u[o]=arguments[o];if(0===u.length)return n.EMPTY;var s=u[0],a=u.slice(1);return 1===u.length&&(0,t.isArray)(s)?i.apply(void 0,s):new e.Observable(function(e){var t=function(){return e.add(i.apply(void 0,a).subscribe(e))};return(0,r.from)(s).subscribe({next:function(r){e.next(r)},error:t,complete:t})})}
},{"../Observable":"wbSE","./from":"WXUl","../util/isArray":"KeTG","./empty":"XsKQ"}],"QHfc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pairs=s,exports.dispatch=i;var e=require("../Observable"),r=require("../Subscription");function s(s,t){return t?new e.Observable(function(e){var n=Object.keys(s),b=new r.Subscription;return b.add(t.schedule(i,0,{keys:n,index:0,subscriber:e,subscription:b,obj:s})),b}):new e.Observable(function(e){for(var r=Object.keys(s),i=0;i<r.length&&!e.closed;i++){var t=r[i];s.hasOwnProperty(t)&&e.next([t,s[t]])}e.complete()})}function i(e){var r=e.keys,s=e.index,i=e.subscriber,t=e.subscription,n=e.obj;if(!i.closed)if(s<r.length){var b=r[s];i.next([b,n[b]]),t.add(this.schedule({keys:r,index:s+1,subscriber:i,subscription:t,obj:n}))}else i.complete()}
},{"../Observable":"wbSE","../Subscription":"I8KM"}],"nij6":[function(require,module,exports) {
"use strict";function e(e,r){function t(){return!t.pred.apply(t.thisArg,arguments)}return t.pred=e,t.thisArg=r,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.not=e;
},{}],"HKzi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.filter=i;var t=n(require("tslib")),e=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var o=i?Object.getOwnPropertyDescriptor(t,u):null;o&&(o.get||o.set)?Object.defineProperty(n,u,o):n[u]=t[u]}return n.default=t,e&&e.set(t,n),n}function i(t,e){return function(r){return r.lift(new u(t,e))}}var u=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new o(t,this.predicate,this.thisArg))},t}(),o=function(e){function r(t,r,n){var i=e.call(this,t)||this;return i.predicate=r,i.thisArg=n,i.count=0,i}return t.__extends(r,e),r.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(r){return void this.destination.error(r)}e&&this.destination.next(t)},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"wJ9V":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.partition=s;var e=require("../util/not"),r=require("../util/subscribeTo"),t=require("../operators/filter"),i=require("../Observable");function s(s,u,b){return[(0,t.filter)(u,b)(new i.Observable((0,r.subscribeTo)(s))),(0,t.filter)((0,e.not)(u,b))(new i.Observable((0,r.subscribeTo)(s)))]}
},{"../util/not":"nij6","../util/subscribeTo":"vq9L","../operators/filter":"HKzi","../Observable":"wbSE"}],"bwYX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.race=u,exports.RaceSubscriber=exports.RaceOperator=void 0;var r=o(require("tslib")),t=require("../util/isArray"),e=require("./fromArray"),i=require("../OuterSubscriber"),s=require("../util/subscribeToResult");function n(){if("function"!=typeof WeakMap)return null;var r=new WeakMap;return n=function(){return r},r}function o(r){if(r&&r.__esModule)return r;if(null===r||"object"!=typeof r&&"function"!=typeof r)return{default:r};var t=n();if(t&&t.has(r))return t.get(r);var e={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s)){var o=i?Object.getOwnPropertyDescriptor(r,s):null;o&&(o.get||o.set)?Object.defineProperty(e,s,o):e[s]=r[s]}return e.default=r,t&&t.set(r,e),e}function u(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(1===r.length){if(!(0,t.isArray)(r[0]))return r[0];r=r[0]}return(0,e.fromArray)(r,void 0).lift(new a)}var a=function(){function r(){}return r.prototype.call=function(r,t){return t.subscribe(new c(r))},r}();exports.RaceOperator=a;var c=function(t){function e(r){var e=t.call(this,r)||this;return e.hasFirst=!1,e.observables=[],e.subscriptions=[],e}return r.__extends(e,t),e.prototype._next=function(r){this.observables.push(r)},e.prototype._complete=function(){var r=this.observables,t=r.length;if(0===t)this.destination.complete();else{for(var e=0;e<t&&!this.hasFirst;e++){var i=r[e],n=(0,s.subscribeToResult)(this,i,i,e);this.subscriptions&&this.subscriptions.push(n),this.add(n)}this.observables=null}},e.prototype.notifyNext=function(r,t,e,i,s){if(!this.hasFirst){this.hasFirst=!0;for(var n=0;n<this.subscriptions.length;n++)if(n!==e){var o=this.subscriptions[n];o.unsubscribe(),this.remove(o)}this.subscriptions=null}this.destination.next(t)},e}(i.OuterSubscriber);exports.RaceSubscriber=c;
},{"tslib":"vCxL","../util/isArray":"KeTG","./fromArray":"PJGF","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"N84r":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.range=r,exports.dispatch=t;var e=require("../Observable");function r(r,s,i){return void 0===r&&(r=0),new e.Observable(function(e){void 0===s&&(s=r,r=0);var n=0,o=r;if(i)return i.schedule(t,0,{index:n,count:s,start:r,subscriber:e});for(;;){if(n++>=s){e.complete();break}if(e.next(o++),e.closed)break}})}function t(e){var r=e.start,t=e.index,s=e.count,i=e.subscriber;t>=s?i.complete():(i.next(r),i.closed||(e.index=t+1,e.start=r+1,this.schedule(e)))}
},{"../Observable":"wbSE"}],"RPvN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.timer=s;var e=require("../Observable"),r=require("../scheduler/async"),i=require("../util/isNumeric"),u=require("../util/isScheduler");function s(s,n,t){void 0===s&&(s=0);var d=-1;return(0,i.isNumeric)(n)?d=Number(n)<1?1:Number(n):(0,u.isScheduler)(n)&&(t=n),(0,u.isScheduler)(t)||(t=r.async),new e.Observable(function(e){var r=(0,i.isNumeric)(s)?s:+s-t.now();return t.schedule(c,r,{index:0,period:d,subscriber:e})})}function c(e){var r=e.index,i=e.period,u=e.subscriber;if(u.next(r),!u.closed){if(-1===i)return u.complete();e.index=r+1,this.schedule(e,i)}}
},{"../Observable":"wbSE","../scheduler/async":"jun6","../util/isNumeric":"wBpm","../util/isScheduler":"VqoH"}],"gc1W":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.using=t;var r=require("../Observable"),e=require("./from"),u=require("./empty");function t(t,n){return new r.Observable(function(r){var i,s;try{i=t()}catch(c){return void r.error(c)}try{s=n(i)}catch(c){return void r.error(c)}var o=(s?(0,e.from)(s):u.EMPTY).subscribe(r);return function(){o.unsubscribe(),i&&i.unsubscribe()}})}
},{"../Observable":"wbSE","./from":"WXUl","./empty":"XsKQ"}],"ff2A":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.zip=l,exports.ZipSubscriber=exports.ZipOperator=void 0;var t=a(require("tslib")),e=require("./fromArray"),r=require("../util/isArray"),i=require("../Subscriber"),n=require("../OuterSubscriber"),o=require("../util/subscribeToResult"),s=require("../../internal/symbol/iterator");function u(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return u=function(){return t},t}function a(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=u();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=i?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=t[n]}return r.default=t,e&&e.set(t,r),r}function l(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=t[t.length-1];return"function"==typeof i&&t.pop(),(0,e.fromArray)(t,void 0).lift(new p(i))}var p=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.resultSelector))},t}();exports.ZipOperator=p;var c=function(e){function i(t,r,i){void 0===i&&(i=Object.create(null));var n=e.call(this,t)||this;return n.iterators=[],n.active=0,n.resultSelector="function"==typeof r?r:null,n.values=i,n}return t.__extends(i,e),i.prototype._next=function(t){var e=this.iterators;(0,r.isArray)(t)?e.push(new f(t)):"function"==typeof t[s.iterator]?e.push(new h(t[s.iterator]())):e.push(new y(this.destination,this,t))},i.prototype._complete=function(){var t=this.iterators,e=t.length;if(this.unsubscribe(),0!==e){this.active=e;for(var r=0;r<e;r++){var i=t[r];if(i.stillUnsubscribed)this.destination.add(i.subscribe(i,r));else this.active--}}else this.destination.complete()},i.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},i.prototype.checkIterators=function(){for(var t=this.iterators,e=t.length,r=this.destination,i=0;i<e;i++){if("function"==typeof(s=t[i]).hasValue&&!s.hasValue())return}var n=!1,o=[];for(i=0;i<e;i++){var s,u=(s=t[i]).next();if(s.hasCompleted()&&(n=!0),u.done)return void r.complete();o.push(u.value)}this.resultSelector?this._tryresultSelector(o):r.next(o),n&&r.complete()},i.prototype._tryresultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(r){return void this.destination.error(r)}this.destination.next(e)},i}(i.Subscriber);exports.ZipSubscriber=c;var h=function(){function t(t){this.iterator=t,this.nextResult=t.next()}return t.prototype.hasValue=function(){return!0},t.prototype.next=function(){var t=this.nextResult;return this.nextResult=this.iterator.next(),t},t.prototype.hasCompleted=function(){var t=this.nextResult;return t&&t.done},t}(),f=function(){function t(t){this.array=t,this.index=0,this.length=0,this.length=t.length}return t.prototype[s.iterator]=function(){return this},t.prototype.next=function(t){var e=this.index++,r=this.array;return e<this.length?{value:r[e],done:!1}:{value:null,done:!0}},t.prototype.hasValue=function(){return this.array.length>this.index},t.prototype.hasCompleted=function(){return this.array.length===this.index},t}(),y=function(e){function r(t,r,i){var n=e.call(this,t)||this;return n.parent=r,n.observable=i,n.stillUnsubscribed=!0,n.buffer=[],n.isComplete=!1,n}return t.__extends(r,e),r.prototype[s.iterator]=function(){return this},r.prototype.next=function(){var t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}},r.prototype.hasValue=function(){return this.buffer.length>0},r.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},r.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},r.prototype.notifyNext=function(t,e,r,i,n){this.buffer.push(e),this.parent.checkIterators()},r.prototype.subscribe=function(t,e){return(0,o.subscribeToResult)(this,this.observable,this,e)},r}(n.OuterSubscriber);
},{"tslib":"vCxL","./fromArray":"PJGF","../util/isArray":"KeTG","../Subscriber":"RaFB","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e","../../internal/symbol/iterator":"AqTP"}],"iRqj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Observable",{enumerable:!0,get:function(){return e.Observable}}),Object.defineProperty(exports,"ConnectableObservable",{enumerable:!0,get:function(){return r.ConnectableObservable}}),Object.defineProperty(exports,"GroupedObservable",{enumerable:!0,get:function(){return t.GroupedObservable}}),Object.defineProperty(exports,"observable",{enumerable:!0,get:function(){return n.observable}}),Object.defineProperty(exports,"Subject",{enumerable:!0,get:function(){return i.Subject}}),Object.defineProperty(exports,"BehaviorSubject",{enumerable:!0,get:function(){return u.BehaviorSubject}}),Object.defineProperty(exports,"ReplaySubject",{enumerable:!0,get:function(){return o.ReplaySubject}}),Object.defineProperty(exports,"AsyncSubject",{enumerable:!0,get:function(){return b.AsyncSubject}}),Object.defineProperty(exports,"asapScheduler",{enumerable:!0,get:function(){return a.asap}}),Object.defineProperty(exports,"asyncScheduler",{enumerable:!0,get:function(){return l.async}}),Object.defineProperty(exports,"queueScheduler",{enumerable:!0,get:function(){return c.queue}}),Object.defineProperty(exports,"animationFrameScheduler",{enumerable:!0,get:function(){return p.animationFrame}}),Object.defineProperty(exports,"VirtualTimeScheduler",{enumerable:!0,get:function(){return s.VirtualTimeScheduler}}),Object.defineProperty(exports,"VirtualAction",{enumerable:!0,get:function(){return s.VirtualAction}}),Object.defineProperty(exports,"Scheduler",{enumerable:!0,get:function(){return f.Scheduler}}),Object.defineProperty(exports,"Subscription",{enumerable:!0,get:function(){return d.Subscription}}),Object.defineProperty(exports,"Subscriber",{enumerable:!0,get:function(){return m.Subscriber}}),Object.defineProperty(exports,"Notification",{enumerable:!0,get:function(){return g.Notification}}),Object.defineProperty(exports,"NotificationKind",{enumerable:!0,get:function(){return g.NotificationKind}}),Object.defineProperty(exports,"pipe",{enumerable:!0,get:function(){return y.pipe}}),Object.defineProperty(exports,"noop",{enumerable:!0,get:function(){return O.noop}}),Object.defineProperty(exports,"identity",{enumerable:!0,get:function(){return j.identity}}),Object.defineProperty(exports,"isObservable",{enumerable:!0,get:function(){return P.isObservable}}),Object.defineProperty(exports,"ArgumentOutOfRangeError",{enumerable:!0,get:function(){return x.ArgumentOutOfRangeError}}),Object.defineProperty(exports,"EmptyError",{enumerable:!0,get:function(){return v.EmptyError}}),Object.defineProperty(exports,"ObjectUnsubscribedError",{enumerable:!0,get:function(){return q.ObjectUnsubscribedError}}),Object.defineProperty(exports,"UnsubscriptionError",{enumerable:!0,get:function(){return E.UnsubscriptionError}}),Object.defineProperty(exports,"TimeoutError",{enumerable:!0,get:function(){return S.TimeoutError}}),Object.defineProperty(exports,"bindCallback",{enumerable:!0,get:function(){return h.bindCallback}}),Object.defineProperty(exports,"bindNodeCallback",{enumerable:!0,get:function(){return N.bindNodeCallback}}),Object.defineProperty(exports,"combineLatest",{enumerable:!0,get:function(){return R.combineLatest}}),Object.defineProperty(exports,"concat",{enumerable:!0,get:function(){return k.concat}}),Object.defineProperty(exports,"defer",{enumerable:!0,get:function(){return C.defer}}),Object.defineProperty(exports,"empty",{enumerable:!0,get:function(){return A.empty}}),Object.defineProperty(exports,"EMPTY",{enumerable:!0,get:function(){return A.EMPTY}}),Object.defineProperty(exports,"forkJoin",{enumerable:!0,get:function(){return T.forkJoin}}),Object.defineProperty(exports,"from",{enumerable:!0,get:function(){return V.from}}),Object.defineProperty(exports,"fromEvent",{enumerable:!0,get:function(){return U.fromEvent}}),Object.defineProperty(exports,"fromEventPattern",{enumerable:!0,get:function(){return B.fromEventPattern}}),Object.defineProperty(exports,"generate",{enumerable:!0,get:function(){return w.generate}}),Object.defineProperty(exports,"iif",{enumerable:!0,get:function(){return z.iif}}),Object.defineProperty(exports,"interval",{enumerable:!0,get:function(){return F.interval}}),Object.defineProperty(exports,"merge",{enumerable:!0,get:function(){return J.merge}}),Object.defineProperty(exports,"never",{enumerable:!0,get:function(){return L.never}}),Object.defineProperty(exports,"NEVER",{enumerable:!0,get:function(){return L.NEVER}}),Object.defineProperty(exports,"of",{enumerable:!0,get:function(){return M.of}}),Object.defineProperty(exports,"onErrorResumeNext",{enumerable:!0,get:function(){return G.onErrorResumeNext}}),Object.defineProperty(exports,"pairs",{enumerable:!0,get:function(){return K.pairs}}),Object.defineProperty(exports,"partition",{enumerable:!0,get:function(){return Y.partition}}),Object.defineProperty(exports,"race",{enumerable:!0,get:function(){return _.race}}),Object.defineProperty(exports,"range",{enumerable:!0,get:function(){return D.range}}),Object.defineProperty(exports,"throwError",{enumerable:!0,get:function(){return H.throwError}}),Object.defineProperty(exports,"timer",{enumerable:!0,get:function(){return I.timer}}),Object.defineProperty(exports,"using",{enumerable:!0,get:function(){return Q.using}}),Object.defineProperty(exports,"zip",{enumerable:!0,get:function(){return W.zip}}),Object.defineProperty(exports,"scheduled",{enumerable:!0,get:function(){return X.scheduled}}),Object.defineProperty(exports,"config",{enumerable:!0,get:function(){return Z.config}});var e=require("./internal/Observable"),r=require("./internal/observable/ConnectableObservable"),t=require("./internal/operators/groupBy"),n=require("./internal/symbol/observable"),i=require("./internal/Subject"),u=require("./internal/BehaviorSubject"),o=require("./internal/ReplaySubject"),b=require("./internal/AsyncSubject"),a=require("./internal/scheduler/asap"),l=require("./internal/scheduler/async"),c=require("./internal/scheduler/queue"),p=require("./internal/scheduler/animationFrame"),s=require("./internal/scheduler/VirtualTimeScheduler"),f=require("./internal/Scheduler"),d=require("./internal/Subscription"),m=require("./internal/Subscriber"),g=require("./internal/Notification"),y=require("./internal/util/pipe"),O=require("./internal/util/noop"),j=require("./internal/util/identity"),P=require("./internal/util/isObservable"),x=require("./internal/util/ArgumentOutOfRangeError"),v=require("./internal/util/EmptyError"),q=require("./internal/util/ObjectUnsubscribedError"),E=require("./internal/util/UnsubscriptionError"),S=require("./internal/util/TimeoutError"),h=require("./internal/observable/bindCallback"),N=require("./internal/observable/bindNodeCallback"),R=require("./internal/observable/combineLatest"),k=require("./internal/observable/concat"),C=require("./internal/observable/defer"),A=require("./internal/observable/empty"),T=require("./internal/observable/forkJoin"),V=require("./internal/observable/from"),U=require("./internal/observable/fromEvent"),B=require("./internal/observable/fromEventPattern"),w=require("./internal/observable/generate"),z=require("./internal/observable/iif"),F=require("./internal/observable/interval"),J=require("./internal/observable/merge"),L=require("./internal/observable/never"),M=require("./internal/observable/of"),G=require("./internal/observable/onErrorResumeNext"),K=require("./internal/observable/pairs"),Y=require("./internal/observable/partition"),_=require("./internal/observable/race"),D=require("./internal/observable/range"),H=require("./internal/observable/throwError"),I=require("./internal/observable/timer"),Q=require("./internal/observable/using"),W=require("./internal/observable/zip"),X=require("./internal/scheduled/scheduled"),Z=require("./internal/config");
},{"./internal/Observable":"wbSE","./internal/observable/ConnectableObservable":"kkfD","./internal/operators/groupBy":"dNgG","./internal/symbol/observable":"tjV3","./internal/Subject":"r9t1","./internal/BehaviorSubject":"MPU6","./internal/ReplaySubject":"Cp6P","./internal/AsyncSubject":"Scvc","./internal/scheduler/asap":"ZqYc","./internal/scheduler/async":"jun6","./internal/scheduler/queue":"HGOP","./internal/scheduler/animationFrame":"zUKp","./internal/scheduler/VirtualTimeScheduler":"RuMO","./internal/Scheduler":"QglZ","./internal/Subscription":"I8KM","./internal/Subscriber":"RaFB","./internal/Notification":"n7Mc","./internal/util/pipe":"HQCS","./internal/util/noop":"rXfM","./internal/util/identity":"LXph","./internal/util/isObservable":"cUXi","./internal/util/ArgumentOutOfRangeError":"Qh4I","./internal/util/EmptyError":"vsl0","./internal/util/ObjectUnsubscribedError":"xQEi","./internal/util/UnsubscriptionError":"pMaL","./internal/util/TimeoutError":"SZK7","./internal/observable/bindCallback":"lxDK","./internal/observable/bindNodeCallback":"uTDa","./internal/observable/combineLatest":"omVc","./internal/observable/concat":"CsdO","./internal/observable/defer":"w9G6","./internal/observable/empty":"XsKQ","./internal/observable/forkJoin":"R2GC","./internal/observable/from":"WXUl","./internal/observable/fromEvent":"ZHZV","./internal/observable/fromEventPattern":"HFE7","./internal/observable/generate":"xNZb","./internal/observable/iif":"SXp5","./internal/observable/interval":"QHLS","./internal/observable/merge":"DQig","./internal/observable/never":"TBTl","./internal/observable/of":"wZuk","./internal/observable/onErrorResumeNext":"VCq5","./internal/observable/pairs":"QHfc","./internal/observable/partition":"wJ9V","./internal/observable/race":"bwYX","./internal/observable/range":"N84r","./internal/observable/throwError":"FdIu","./internal/observable/timer":"RPvN","./internal/observable/using":"gc1W","./internal/observable/zip":"ff2A","./internal/scheduled/scheduled":"mNZE","./internal/config":"Q3iD"}],"Pdg2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.audit=o;var t=n(require("tslib")),e=require("../OuterSubscriber"),r=require("../util/subscribeToResult");function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var u=n?Object.getOwnPropertyDescriptor(t,o):null;u&&(u.get||u.set)?Object.defineProperty(r,o,u):r[o]=t[o]}return r.default=t,e&&e.set(t,r),r}function o(t){return function(e){return e.lift(new u(t))}}var u=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.durationSelector))},t}(),s=function(e){function i(t,r){var i=e.call(this,t)||this;return i.durationSelector=r,i.hasValue=!1,i}return t.__extends(i,e),i.prototype._next=function(t){if(this.value=t,this.hasValue=!0,!this.throttled){var e=void 0;try{e=(0,this.durationSelector)(t)}catch(n){return this.destination.error(n)}var i=(0,r.subscribeToResult)(this,e);!i||i.closed?this.clearThrottle():this.add(this.throttled=i)}},i.prototype.clearThrottle=function(){var t=this.value,e=this.hasValue,r=this.throttled;r&&(this.remove(r),this.throttled=null,r.unsubscribe()),e&&(this.value=null,this.hasValue=!1,this.destination.next(t))},i.prototype.notifyNext=function(t,e,r,i){this.clearThrottle()},i.prototype.notifyComplete=function(){this.clearThrottle()},i}(e.OuterSubscriber);
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"jcYn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.auditTime=i;var e=require("../scheduler/async"),r=require("./audit"),t=require("../observable/timer");function i(i,u){return void 0===u&&(u=e.async),(0,r.audit)(function(){return(0,t.timer)(i,u)})}
},{"../scheduler/async":"jun6","./audit":"Pdg2","../observable/timer":"RPvN"}],"mG6b":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.buffer=i;var e=u(require("tslib")),t=require("../OuterSubscriber"),r=require("../util/subscribeToResult");function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n();if(t&&t.has(e))return t.get(e);var r={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=u?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,t&&t.set(e,r),r}function i(e){return function(t){return t.lift(new o(e))}}var o=function(){function e(e){this.closingNotifier=e}return e.prototype.call=function(e,t){return t.subscribe(new f(e,this.closingNotifier))},e}(),f=function(t){function n(e,n){var u=t.call(this,e)||this;return u.buffer=[],u.add((0,r.subscribeToResult)(u,n)),u}return e.__extends(n,t),n.prototype._next=function(e){this.buffer.push(e)},n.prototype.notifyNext=function(e,t,r,n,u){var i=this.buffer;this.buffer=[],this.destination.next(i)},n}(t.OuterSubscriber);
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"f9IP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bufferCount=i;var t=n(require("tslib")),e=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var f=i?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(n,u,f):n[u]=t[u]}return n.default=t,e&&e.set(t,n),n}function i(t,e){return void 0===e&&(e=null),function(r){return r.lift(new u(t,e))}}var u=function(){function t(t,e){this.bufferSize=t,this.startBufferEvery=e,this.subscriberClass=e&&t!==e?s:f}return t.prototype.call=function(t,e){return e.subscribe(new this.subscriberClass(t,this.bufferSize,this.startBufferEvery))},t}(),f=function(e){function r(t,r){var n=e.call(this,t)||this;return n.bufferSize=r,n.buffer=[],n}return t.__extends(r,e),r.prototype._next=function(t){var e=this.buffer;e.push(t),e.length==this.bufferSize&&(this.destination.next(e),this.buffer=[])},r.prototype._complete=function(){var t=this.buffer;t.length>0&&this.destination.next(t),e.prototype._complete.call(this)},r}(e.Subscriber),s=function(e){function r(t,r,n){var i=e.call(this,t)||this;return i.bufferSize=r,i.startBufferEvery=n,i.buffers=[],i.count=0,i}return t.__extends(r,e),r.prototype._next=function(t){var e=this.bufferSize,r=this.startBufferEvery,n=this.buffers,i=this.count;this.count++,i%r==0&&n.push([]);for(var u=n.length;u--;){var f=n[u];f.push(t),f.length===e&&(n.splice(u,1),this.destination.next(f))}},r.prototype._complete=function(){for(var t=this.buffers,r=this.destination;t.length>0;){var n=t.shift();n.length>0&&r.next(n)}e.prototype._complete.call(this)},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"Axj2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bufferTime=s;var e=o(require("tslib")),t=require("../scheduler/async"),r=require("../Subscriber"),n=require("../util/isScheduler");function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function o(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}function s(e){var r=arguments.length,i=t.async;(0,n.isScheduler)(arguments[arguments.length-1])&&(i=arguments[arguments.length-1],r--);var o=null;r>=2&&(o=arguments[1]);var s=Number.POSITIVE_INFINITY;return r>=3&&(s=arguments[2]),function(t){return t.lift(new u(e,o,s,i))}}var u=function(){function e(e,t,r,n){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=r,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new f(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),c=function(){return function(){this.buffer=[]}}(),f=function(t){function r(e,r,n,i,o){var s=t.call(this,e)||this;s.bufferTimeSpan=r,s.bufferCreationInterval=n,s.maxBufferSize=i,s.scheduler=o,s.contexts=[];var u=s.openContext();if(s.timespanOnly=null==n||n<0,s.timespanOnly){var c={subscriber:s,context:u,bufferTimeSpan:r};s.add(u.closeAction=o.schedule(l,r,c))}else{var f={subscriber:s,context:u},p={bufferTimeSpan:r,bufferCreationInterval:n,subscriber:s,scheduler:o};s.add(u.closeAction=o.schedule(h,r,f)),s.add(o.schedule(a,n,p))}return s}return e.__extends(r,t),r.prototype._next=function(e){for(var t,r=this.contexts,n=r.length,i=0;i<n;i++){var o=r[i],s=o.buffer;s.push(e),s.length==this.maxBufferSize&&(t=o)}t&&this.onBufferFull(t)},r.prototype._error=function(e){this.contexts.length=0,t.prototype._error.call(this,e)},r.prototype._complete=function(){for(var e=this.contexts,r=this.destination;e.length>0;){var n=e.shift();r.next(n.buffer)}t.prototype._complete.call(this)},r.prototype._unsubscribe=function(){this.contexts=null},r.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var r=this.bufferTimeSpan,n={subscriber:this,context:e,bufferTimeSpan:r};this.add(e.closeAction=this.scheduler.schedule(l,r,n))}},r.prototype.openContext=function(){var e=new c;return this.contexts.push(e),e},r.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;(t?t.indexOf(e):-1)>=0&&t.splice(t.indexOf(e),1)},r}(r.Subscriber);function l(e){var t=e.subscriber,r=e.context;r&&t.closeContext(r),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function a(e){var t=e.bufferCreationInterval,r=e.bufferTimeSpan,n=e.subscriber,i=e.scheduler,o=n.openContext();n.closed||(n.add(o.closeAction=i.schedule(h,r,{subscriber:n,context:o})),this.schedule(e,t))}function h(e){var t=e.subscriber,r=e.context;t.closeContext(r)}
},{"tslib":"vCxL","../scheduler/async":"jun6","../Subscriber":"RaFB","../util/isScheduler":"VqoH"}],"ZTTP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bufferToggle=s;var t=i(require("tslib")),e=require("../Subscription"),r=require("../util/subscribeToResult"),n=require("../OuterSubscriber");function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function i(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var s=n?Object.getOwnPropertyDescriptor(t,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}function s(t,e){return function(r){return r.lift(new u(t,e))}}var u=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.openings,this.closingSelector))},t}(),c=function(n){function o(t,e,o){var i=n.call(this,t)||this;return i.openings=e,i.closingSelector=o,i.contexts=[],i.add((0,r.subscribeToResult)(i,e)),i}return t.__extends(o,n),o.prototype._next=function(t){for(var e=this.contexts,r=e.length,n=0;n<r;n++)e[n].buffer.push(t)},o.prototype._error=function(t){for(var e=this.contexts;e.length>0;){var r=e.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,n.prototype._error.call(this,t)},o.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var e=t.shift();this.destination.next(e.buffer),e.subscription.unsubscribe(),e.buffer=null,e.subscription=null}this.contexts=null,n.prototype._complete.call(this)},o.prototype.notifyNext=function(t,e,r,n,o){t?this.closeBuffer(t):this.openBuffer(e)},o.prototype.notifyComplete=function(t){this.closeBuffer(t.context)},o.prototype.openBuffer=function(t){try{var e=this.closingSelector.call(this,t);e&&this.trySubscribe(e)}catch(r){this._error(r)}},o.prototype.closeBuffer=function(t){var e=this.contexts;if(e&&t){var r=t.buffer,n=t.subscription;this.destination.next(r),e.splice(e.indexOf(t),1),this.remove(n),n.unsubscribe()}},o.prototype.trySubscribe=function(t){var n=this.contexts,o=new e.Subscription,i={buffer:[],subscription:o};n.push(i);var s=(0,r.subscribeToResult)(this,t,i);!s||s.closed?this.closeBuffer(i):(s.context=i,this.add(s),o.add(s))},o}(n.OuterSubscriber);
},{"tslib":"vCxL","../Subscription":"I8KM","../util/subscribeToResult":"JM7e","../OuterSubscriber":"hZYI"}],"Ul3A":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bufferWhen=u;var t=o(require("tslib")),e=require("../Subscription"),r=require("../OuterSubscriber"),i=require("../util/subscribeToResult");function n(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return n=function(){return t},t}function o(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=n();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var u=i?Object.getOwnPropertyDescriptor(t,o):null;u&&(u.get||u.set)?Object.defineProperty(r,o,u):r[o]=t[o]}return r.default=t,e&&e.set(t,r),r}function u(t){return function(e){return e.lift(new s(t))}}var s=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.closingSelector))},t}(),c=function(r){function n(t,e){var i=r.call(this,t)||this;return i.closingSelector=e,i.subscribing=!1,i.openBuffer(),i}return t.__extends(n,r),n.prototype._next=function(t){this.buffer.push(t)},n.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),r.prototype._complete.call(this)},n.prototype._unsubscribe=function(){this.buffer=null,this.subscribing=!1},n.prototype.notifyNext=function(t,e,r,i,n){this.openBuffer()},n.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},n.prototype.openBuffer=function(){var t=this.closingSubscription;t&&(this.remove(t),t.unsubscribe());var r,n=this.buffer;this.buffer&&this.destination.next(n),this.buffer=[];try{r=(0,this.closingSelector)()}catch(o){return this.error(o)}t=new e.Subscription,this.closingSubscription=t,this.add(t),this.subscribing=!0,t.add((0,i.subscribeToResult)(this,r)),this.subscribing=!1},n}(r.OuterSubscriber);
},{"tslib":"vCxL","../Subscription":"I8KM","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"THoY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.catchError=o;var e=u(require("tslib")),r=require("../OuterSubscriber"),t=require("../InnerSubscriber"),i=require("../util/subscribeToResult");function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n();if(r&&r.has(e))return r.get(e);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)){var o=i?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(t,u,o):t[u]=e[u]}return t.default=e,r&&r.set(e,t),t}function o(e){return function(r){var t=new c(e),i=r.lift(t);return t.caught=i}}var c=function(){function e(e){this.selector=e}return e.prototype.call=function(e,r){return r.subscribe(new s(e,this.selector,this.caught))},e}(),s=function(r){function n(e,t,i){var n=r.call(this,e)||this;return n.selector=t,n.caught=i,n}return e.__extends(n,r),n.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(o){return void r.prototype.error.call(this,o)}this._unsubscribeAndRecycle();var u=new t.InnerSubscriber(this,void 0,void 0);this.add(u),(0,i.subscribeToResult)(this,n,void 0,void 0,u)}},n}(r.OuterSubscriber);
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../InnerSubscriber":"aQbR","../util/subscribeToResult":"JM7e"}],"TMFF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.combineAll=t;var e=require("../observable/combineLatest");function t(t){return function(r){return r.lift(new e.CombineLatestOperator(t))}}
},{"../observable/combineLatest":"omVc"}],"DJQm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.combineLatest=n;var e=require("../util/isArray"),r=require("../observable/combineLatest"),t=require("../observable/from"),o={};function n(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var i=null;return"function"==typeof o[o.length-1]&&(i=o.pop()),1===o.length&&(0,e.isArray)(o[0])&&(o=o[0].slice()),function(e){return e.lift.call((0,t.from)([e].concat(o)),new r.CombineLatestOperator(i))}}
},{"../util/isArray":"KeTG","../observable/combineLatest":"omVc","../observable/from":"WXUl"}],"ZHmI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.concat=t;var e=require("../observable/concat");function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return function(r){return r.lift.call(e.concat.apply(void 0,[r].concat(t)))}}
},{"../observable/concat":"CsdO"}],"DoUK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.concatMap=r;var e=require("./mergeMap");function r(r,t){return(0,e.mergeMap)(r,t,1)}
},{"./mergeMap":"nFsM"}],"APQq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.concatMapTo=t;var e=require("./concatMap");function t(t,r){return(0,e.concatMap)(function(){return t},r)}
},{"./concatMap":"DoUK"}],"U1Ln":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.count=i;var t=n(require("tslib")),e=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var u=i?Object.getOwnPropertyDescriptor(t,o):null;u&&(u.get||u.set)?Object.defineProperty(n,o,u):n[o]=t[o]}return n.default=t,e&&e.set(t,n),n}function i(t){return function(e){return e.lift(new o(t,e))}}var o=function(){function t(t,e){this.predicate=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.predicate,this.source))},t}(),u=function(e){function r(t,r,n){var i=e.call(this,t)||this;return i.predicate=r,i.source=n,i.count=0,i.index=0,i}return t.__extends(r,e),r.prototype._next=function(t){this.predicate?this._tryPredicate(t):this.count++},r.prototype._tryPredicate=function(t){var e;try{e=this.predicate(t,this.index++,this.source)}catch(r){return void this.destination.error(r)}e&&this.count++},r.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"y9EZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.debounce=u;var t=n(require("tslib")),e=require("../OuterSubscriber"),r=require("../util/subscribeToResult");function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var o=n?Object.getOwnPropertyDescriptor(t,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=t[u]}return r.default=t,e&&e.set(t,r),r}function u(t){return function(e){return e.lift(new o(t))}}var o=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.durationSelector))},t}(),s=function(e){function i(t,r){var i=e.call(this,t)||this;return i.durationSelector=r,i.hasValue=!1,i.durationSubscription=null,i}return t.__extends(i,e),i.prototype._next=function(t){try{var e=this.durationSelector.call(this,t);e&&this._tryNext(t,e)}catch(r){this.destination.error(r)}},i.prototype._complete=function(){this.emitValue(),this.destination.complete()},i.prototype._tryNext=function(t,e){var i=this.durationSubscription;this.value=t,this.hasValue=!0,i&&(i.unsubscribe(),this.remove(i)),(i=(0,r.subscribeToResult)(this,e))&&!i.closed&&this.add(this.durationSubscription=i)},i.prototype.notifyNext=function(t,e,r,i,n){this.emitValue()},i.prototype.notifyComplete=function(){this.emitValue()},i.prototype.emitValue=function(){if(this.hasValue){var t=this.value,r=this.durationSubscription;r&&(this.durationSubscription=null,r.unsubscribe(),this.remove(r)),this.value=null,this.hasValue=!1,e.prototype._next.call(this,t)}},i}(e.OuterSubscriber);
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"KBFO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.debounceTime=i;var e=u(require("tslib")),t=require("../Subscriber"),n=require("../scheduler/async");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=u?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}function i(e,t){return void 0===t&&(t=n.async),function(n){return n.lift(new o(e,t))}}var o=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.dueTime,this.scheduler))},e}(),s=function(t){function n(e,n,r){var u=t.call(this,e)||this;return u.dueTime=n,u.scheduler=r,u.debouncedSubscription=null,u.lastValue=null,u.hasValue=!1,u}return e.__extends(n,t),n.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(c,this.dueTime,this))},n.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},n.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}},n.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},n}(t.Subscriber);function c(e){e.debouncedNext()}
},{"tslib":"vCxL","../Subscriber":"RaFB","../scheduler/async":"jun6"}],"YBdz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultIfEmpty=i;var t=n(require("tslib")),e=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var o=i?Object.getOwnPropertyDescriptor(t,u):null;o&&(o.get||o.set)?Object.defineProperty(n,u,o):n[u]=t[u]}return n.default=t,e&&e.set(t,n),n}function i(t){return void 0===t&&(t=null),function(e){return e.lift(new u(t))}}var u=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new o(t,this.defaultValue))},t}(),o=function(e){function r(t,r){var n=e.call(this,t)||this;return n.defaultValue=r,n.isEmpty=!0,n}return t.__extends(r,e),r.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},r.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"rxSS":[function(require,module,exports) {
"use strict";function e(e){return e instanceof Date&&!isNaN(+e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isDate=e;
},{}],"zkgx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.delay=u;var e=s(require("tslib")),t=require("../scheduler/async"),i=require("../util/isDate"),r=require("../Subscriber"),n=require("../Notification");function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}function s(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=r?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(i,n,s):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}function u(e,r){void 0===r&&(r=t.async);var n=(0,i.isDate)(e)?+e-r.now():Math.abs(e);return function(e){return e.lift(new c(n,r))}}var c=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.delay,this.scheduler))},e}(),a=function(t){function i(e,i,r){var n=t.call(this,e)||this;return n.delay=i,n.scheduler=r,n.queue=[],n.active=!1,n.errored=!1,n}return e.__extends(i,t),i.dispatch=function(e){for(var t=e.source,i=t.queue,r=e.scheduler,n=e.destination;i.length>0&&i[0].time-r.now()<=0;)i.shift().notification.observe(n);if(i.length>0){var o=Math.max(0,i[0].time-r.now());this.schedule(e,o)}else this.unsubscribe(),t.active=!1},i.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(i.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},i.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler,i=new h(t.now()+this.delay,e);this.queue.push(i),!1===this.active&&this._schedule(t)}},i.prototype._next=function(e){this.scheduleNotification(n.Notification.createNext(e))},i.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},i.prototype._complete=function(){this.scheduleNotification(n.Notification.createComplete()),this.unsubscribe()},i}(r.Subscriber),h=function(){return function(e,t){this.time=e,this.notification=t}}();
},{"tslib":"vCxL","../scheduler/async":"jun6","../util/isDate":"rxSS","../Subscriber":"RaFB","../Notification":"n7Mc"}],"iVuv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.delayWhen=u;var t=s(require("tslib")),e=require("../Subscriber"),r=require("../Observable"),i=require("../OuterSubscriber"),o=require("../util/subscribeToResult");function n(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return n=function(){return t},t}function s(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=n();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var s=i?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,e&&e.set(t,r),r}function u(t,e){return e?function(r){return new b(r,e).lift(new c(t))}:function(e){return e.lift(new c(t))}}var c=function(){function t(t){this.delayDurationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new p(t,this.delayDurationSelector))},t}(),p=function(e){function r(t,r){var i=e.call(this,t)||this;return i.delayDurationSelector=r,i.completed=!1,i.delayNotifierSubscriptions=[],i.index=0,i}return t.__extends(r,e),r.prototype.notifyNext=function(t,e,r,i,o){this.destination.next(t),this.removeSubscription(o),this.tryComplete()},r.prototype.notifyError=function(t,e){this._error(t)},r.prototype.notifyComplete=function(t){var e=this.removeSubscription(t);e&&this.destination.next(e),this.tryComplete()},r.prototype._next=function(t){var e=this.index++;try{var r=this.delayDurationSelector(t,e);r&&this.tryDelay(r,t)}catch(i){this.destination.error(i)}},r.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},r.prototype.removeSubscription=function(t){t.unsubscribe();var e=this.delayNotifierSubscriptions.indexOf(t);return-1!==e&&this.delayNotifierSubscriptions.splice(e,1),t.outerValue},r.prototype.tryDelay=function(t,e){var r=(0,o.subscribeToResult)(this,t,e);r&&!r.closed&&(this.destination.add(r),this.delayNotifierSubscriptions.push(r))},r.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},r}(i.OuterSubscriber),b=function(e){function r(t,r){var i=e.call(this)||this;return i.source=t,i.subscriptionDelay=r,i}return t.__extends(r,e),r.prototype._subscribe=function(t){this.subscriptionDelay.subscribe(new l(t,this.source))},r}(r.Observable),l=function(e){function r(t,r){var i=e.call(this)||this;return i.parent=t,i.source=r,i.sourceSubscribed=!1,i}return t.__extends(r,e),r.prototype._next=function(t){this.subscribeToSource()},r.prototype._error=function(t){this.unsubscribe(),this.parent.error(t)},r.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},r.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB","../Observable":"wbSE","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"v6b5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.dematerialize=u;var e=n(require("tslib")),t=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=u?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}function u(){return function(e){return e.lift(new i)}}var i=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new o(e))},e}(),o=function(t){function r(e){return t.call(this,e)||this}return e.__extends(r,t),r.prototype._next=function(e){e.observe(this.destination)},r}(t.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"H608":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.distinct=o,exports.DistinctSubscriber=void 0;var e=n(require("tslib")),t=require("../OuterSubscriber"),r=require("../util/subscribeToResult");function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var u=n?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(r,o,u):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}function o(e,t){return function(r){return r.lift(new u(e,t))}}var u=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.keySelector,this.flushes))},e}(),s=function(t){function i(e,i,n){var o=t.call(this,e)||this;return o.keySelector=i,o.values=new Set,n&&o.add((0,r.subscribeToResult)(o,n)),o}return e.__extends(i,t),i.prototype.notifyNext=function(e,t,r,i,n){this.values.clear()},i.prototype.notifyError=function(e,t){this._error(e)},i.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},i.prototype._useKeySelector=function(e){var t,r=this.destination;try{t=this.keySelector(e)}catch(i){return void r.error(i)}this._finalizeNext(t,e)},i.prototype._finalizeNext=function(e,t){var r=this.values;r.has(e)||(r.add(e),this.destination.next(t))},i}(t.OuterSubscriber);exports.DistinctSubscriber=s;
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"hFX7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.distinctUntilChanged=i;var e=n(require("tslib")),t=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var c=i?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(n,o,c):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}function i(e,t){return function(r){return r.lift(new o(e,t))}}var o=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.compare,this.keySelector))},e}(),c=function(t){function r(e,r,n){var i=t.call(this,e)||this;return i.keySelector=n,i.hasKey=!1,"function"==typeof r&&(i.compare=r),i}return e.__extends(r,t),r.prototype.compare=function(e,t){return e===t},r.prototype._next=function(e){var t;try{var r=this.keySelector;t=r?r(e):e}catch(i){return this.destination.error(i)}var n=!1;if(this.hasKey)try{n=(0,this.compare)(this.key,t)}catch(i){return this.destination.error(i)}else this.hasKey=!0;n||(this.key=t,this.destination.next(e))},r}(t.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"Egbr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.distinctUntilKeyChanged=e;var t=require("./distinctUntilChanged");function e(e,n){return(0,t.distinctUntilChanged)(function(t,i){return n?n(t[e],i[e]):t[e]===i[e]})}
},{"./distinctUntilChanged":"hFX7"}],"D7Ma":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.throwIfEmpty=i;var t=o(require("tslib")),r=require("../util/EmptyError"),e=require("../Subscriber");function n(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return n=function(){return t},t}function o(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=n();if(r&&r.has(t))return r.get(t);var e={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var u=o?Object.getOwnPropertyDescriptor(t,i):null;u&&(u.get||u.set)?Object.defineProperty(e,i,u):e[i]=t[i]}return e.default=t,r&&r.set(t,e),e}function i(t){return void 0===t&&(t=a),function(r){return r.lift(new u(t))}}var u=function(){function t(t){this.errorFactory=t}return t.prototype.call=function(t,r){return r.subscribe(new c(t,this.errorFactory))},t}(),c=function(r){function e(t,e){var n=r.call(this,t)||this;return n.errorFactory=e,n.hasValue=!1,n}return t.__extends(e,r),e.prototype._next=function(t){this.hasValue=!0,this.destination.next(t)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var t=void 0;try{t=this.errorFactory()}catch(r){t=r}this.destination.error(t)},e}(e.Subscriber);function a(){return new r.EmptyError}
},{"tslib":"vCxL","../util/EmptyError":"vsl0","../Subscriber":"RaFB"}],"JVEz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.take=o;var t=u(require("tslib")),e=require("../Subscriber"),r=require("../util/ArgumentOutOfRangeError"),n=require("../observable/empty");function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function u(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var o=n?Object.getOwnPropertyDescriptor(t,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=t[u]}return r.default=t,e&&e.set(t,r),r}function o(t){return function(e){return 0===t?(0,n.empty)():e.lift(new c(t))}}var c=function(){function t(t){if(this.total=t,this.total<0)throw new r.ArgumentOutOfRangeError}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.total))},t}(),s=function(e){function r(t,r){var n=e.call(this,t)||this;return n.total=r,n.count=0,n}return t.__extends(r,e),r.prototype._next=function(t){var e=this.total,r=++this.count;r<=e&&(this.destination.next(t),r===e&&(this.destination.complete(),this.unsubscribe()))},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB","../util/ArgumentOutOfRangeError":"Qh4I","../observable/empty":"XsKQ"}],"TbZV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.elementAt=f;var e=require("../util/ArgumentOutOfRangeError"),r=require("./filter"),t=require("./throwIfEmpty"),u=require("./defaultIfEmpty"),n=require("./take");function f(f,i){if(f<0)throw new e.ArgumentOutOfRangeError;var o=arguments.length>=2;return function(a){return a.pipe((0,r.filter)(function(e,r){return r===f}),(0,n.take)(1),o?(0,u.defaultIfEmpty)(i):(0,t.throwIfEmpty)(function(){return new e.ArgumentOutOfRangeError}))}}
},{"../util/ArgumentOutOfRangeError":"Qh4I","./filter":"HKzi","./throwIfEmpty":"D7Ma","./defaultIfEmpty":"YBdz","./take":"JVEz"}],"loee":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.endWith=r;var e=require("../observable/concat");function r(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return function(t){return e.concat.apply(void 0,[t].concat(r))}}
},{"../observable/concat":"CsdO"}],"eEZZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.every=n;var t=i(require("tslib")),e=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function i(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=t[o]}return i.default=t,e&&e.set(t,i),i}function n(t,e){return function(r){return r.lift(new o(t,e,r))}}var o=function(){function t(t,e,r){this.predicate=t,this.thisArg=e,this.source=r}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.predicate,this.thisArg,this.source))},t}(),s=function(e){function r(t,r,i,n){var o=e.call(this,t)||this;return o.predicate=r,o.thisArg=i,o.source=n,o.index=0,o.thisArg=i||o,o}return t.__extends(r,e),r.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},r.prototype._next=function(t){var e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(r){return void this.destination.error(r)}e||this.notifyComplete(!1)},r.prototype._complete=function(){this.notifyComplete(!0)},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"ifNj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.exhaust=o;var t=i(require("tslib")),e=require("../OuterSubscriber"),r=require("../util/subscribeToResult");function n(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return n=function(){return t},t}function i(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=n();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var u=i?Object.getOwnPropertyDescriptor(t,o):null;u&&(u.get||u.set)?Object.defineProperty(r,o,u):r[o]=t[o]}return r.default=t,e&&e.set(t,r),r}function o(){return function(t){return t.lift(new u)}}var u=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new s(t))},t}(),s=function(e){function n(t){var r=e.call(this,t)||this;return r.hasCompleted=!1,r.hasSubscription=!1,r}return t.__extends(n,e),n.prototype._next=function(t){this.hasSubscription||(this.hasSubscription=!0,this.add((0,r.subscribeToResult)(this,t)))},n.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},n.prototype.notifyComplete=function(t){this.remove(t),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},n}(e.OuterSubscriber);
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"DGWU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.exhaustMap=c;var t=s(require("tslib")),e=require("../OuterSubscriber"),r=require("../InnerSubscriber"),i=require("../util/subscribeToResult"),n=require("./map"),o=require("../observable/from");function u(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return u=function(){return t},t}function s(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=u();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=i?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=t[n]}return r.default=t,e&&e.set(t,r),r}function c(t,e){return e?function(r){return r.pipe(c(function(r,i){return(0,o.from)(t(r,i)).pipe((0,n.map)(function(t,n){return e(r,t,i,n)}))}))}:function(e){return e.lift(new p(t))}}var p=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new a(t,this.project))},t}(),a=function(e){function n(t,r){var i=e.call(this,t)||this;return i.project=r,i.hasSubscription=!1,i.hasCompleted=!1,i.index=0,i}return t.__extends(n,e),n.prototype._next=function(t){this.hasSubscription||this.tryNext(t)},n.prototype.tryNext=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(i){return void this.destination.error(i)}this.hasSubscription=!0,this._innerSub(e,t,r)},n.prototype._innerSub=function(t,e,n){var o=new r.InnerSubscriber(this,void 0,void 0);this.destination.add(o),(0,i.subscribeToResult)(this,t,e,n,o)},n.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},n.prototype.notifyNext=function(t,e,r,i,n){this.destination.next(e)},n.prototype.notifyError=function(t){this.destination.error(t)},n.prototype.notifyComplete=function(t){this.destination.remove(t),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},n}(e.OuterSubscriber);
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../InnerSubscriber":"aQbR","../util/subscribeToResult":"JM7e","./map":"dNh5","../observable/from":"WXUl"}],"iYcS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.expand=n,exports.ExpandSubscriber=exports.ExpandOperator=void 0;var e=s(require("tslib")),t=require("../OuterSubscriber"),r=require("../util/subscribeToResult");function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function s(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}function n(e,t,r){return void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===r&&(r=void 0),t=(t||0)<1?Number.POSITIVE_INFINITY:t,function(i){return i.lift(new o(e,t,r))}}var o=function(){function e(e,t,r){this.project=e,this.concurrent=t,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.project,this.concurrent,this.scheduler))},e}();exports.ExpandOperator=o;var u=function(t){function i(e,r,i,s){var n=t.call(this,e)||this;return n.project=r,n.concurrent=i,n.scheduler=s,n.index=0,n.active=0,n.hasCompleted=!1,i<Number.POSITIVE_INFINITY&&(n.buffer=[]),n}return e.__extends(i,t),i.dispatch=function(e){var t=e.subscriber,r=e.result,i=e.value,s=e.index;t.subscribeToProjection(r,i,s)},i.prototype._next=function(e){var t=this.destination;if(t.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){t.next(e);try{var s=(0,this.project)(e,r);if(this.scheduler){var n={subscriber:this,result:s,value:e,index:r};this.destination.add(this.scheduler.schedule(i.dispatch,0,n))}else this.subscribeToProjection(s,e,r)}catch(o){t.error(o)}}else this.buffer.push(e)}},i.prototype.subscribeToProjection=function(e,t,i){this.active++,this.destination.add((0,r.subscribeToResult)(this,e,t,i))},i.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},i.prototype.notifyNext=function(e,t,r,i,s){this._next(t)},i.prototype.notifyComplete=function(e){var t=this.buffer;this.destination.remove(e),this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},i}(t.OuterSubscriber);exports.ExpandSubscriber=u;
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"x5qu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.finalize=u;var e=i(require("tslib")),r=require("../Subscriber"),t=require("../Subscription");function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}function i(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n();if(r&&r.has(e))return r.get(e);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)){var o=i?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(t,u,o):t[u]=e[u]}return t.default=e,r&&r.set(e,t),t}function u(e){return function(r){return r.lift(new o(e))}}var o=function(){function e(e){this.callback=e}return e.prototype.call=function(e,r){return r.subscribe(new c(e,this.callback))},e}(),c=function(r){function n(e,n){var i=r.call(this,e)||this;return i.add(new t.Subscription(n)),i}return e.__extends(n,r),n}(r.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB","../Subscription":"I8KM"}],"t6rP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.find=n,exports.FindValueSubscriber=exports.FindValueOperator=void 0;var e=i(require("tslib")),t=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function i(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,t&&t.set(e,i),i}function n(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return function(r){return r.lift(new o(e,r,!1,t))}}var o=function(){function e(e,t,r,i){this.predicate=e,this.source=t,this.yieldIndex=r,this.thisArg=i}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.source,this.yieldIndex,this.thisArg))},e}();exports.FindValueOperator=o;var s=function(t){function r(e,r,i,n,o){var s=t.call(this,e)||this;return s.predicate=r,s.source=i,s.yieldIndex=n,s.thisArg=o,s.index=0,s}return e.__extends(r,t),r.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete(),this.unsubscribe()},r.prototype._next=function(e){var t=this.predicate,r=this.thisArg,i=this.index++;try{t.call(r||this,e,i,this.source)&&this.notifyComplete(this.yieldIndex?i:e)}catch(n){this.destination.error(n)}},r.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},r}(t.Subscriber);exports.FindValueSubscriber=s;
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"GIlo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.findIndex=r;var e=require("../operators/find");function r(r,t){return function(n){return n.lift(new e.FindValueOperator(r,n,!0,t))}}
},{"../operators/find":"t6rP"}],"f9sd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.first=f;var r=require("../util/EmptyError"),e=require("./filter"),t=require("./take"),i=require("./defaultIfEmpty"),u=require("./throwIfEmpty"),n=require("../util/identity");function f(f,o){var p=arguments.length>=2;return function(l){return l.pipe(f?(0,e.filter)(function(r,e){return f(r,e,l)}):n.identity,(0,t.take)(1),p?(0,i.defaultIfEmpty)(o):(0,u.throwIfEmpty)(function(){return new r.EmptyError}))}}
},{"../util/EmptyError":"vsl0","./filter":"HKzi","./take":"JVEz","./defaultIfEmpty":"YBdz","./throwIfEmpty":"D7Ma","../util/identity":"LXph"}],"P82l":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ignoreElements=u;var e=n(require("tslib")),t=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=u?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}function u(){return function(e){return e.lift(new o)}}var o=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new i(e))},e}(),i=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e.__extends(r,t),r.prototype._next=function(e){},r}(t.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"LqVv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isEmpty=o;var t=n(require("tslib")),e=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var u=o?Object.getOwnPropertyDescriptor(t,i):null;u&&(u.get||u.set)?Object.defineProperty(n,i,u):n[i]=t[i]}return n.default=t,e&&e.set(t,n),n}function o(){return function(t){return t.lift(new i)}}var i=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new u(t))},t}(),u=function(e){function r(t){return e.call(this,t)||this}return t.__extends(r,e),r.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete()},r.prototype._next=function(t){this.notifyComplete(!1)},r.prototype._complete=function(){this.notifyComplete(!0)},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"FbHg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.takeLast=u;var t=i(require("tslib")),e=require("../Subscriber"),r=require("../util/ArgumentOutOfRangeError"),n=require("../observable/empty");function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function i(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var u=n?Object.getOwnPropertyDescriptor(t,i):null;u&&(u.get||u.set)?Object.defineProperty(r,i,u):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}function u(t){return function(e){return 0===t?(0,n.empty)():e.lift(new a(t))}}var a=function(){function t(t){if(this.total=t,this.total<0)throw new r.ArgumentOutOfRangeError}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.total))},t}(),c=function(e){function r(t,r){var n=e.call(this,t)||this;return n.total=r,n.ring=new Array,n.count=0,n}return t.__extends(r,e),r.prototype._next=function(t){var e=this.ring,r=this.total,n=this.count++;e.length<r?e.push(t):e[n%r]=t},r.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var r=this.count>=this.total?this.total:this.count,n=this.ring,o=0;o<r;o++){var i=e++%r;t.next(n[i])}t.complete()},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB","../util/ArgumentOutOfRangeError":"Qh4I","../observable/empty":"XsKQ"}],"xu0X":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.last=f;var t=require("../util/EmptyError"),e=require("./filter"),r=require("./takeLast"),i=require("./throwIfEmpty"),u=require("./defaultIfEmpty"),n=require("../util/identity");function f(f,o){var p=arguments.length>=2;return function(a){return a.pipe(f?(0,e.filter)(function(t,e){return f(t,e,a)}):n.identity,(0,r.takeLast)(1),p?(0,u.defaultIfEmpty)(o):(0,i.throwIfEmpty)(function(){return new t.EmptyError}))}}
},{"../util/EmptyError":"vsl0","./filter":"HKzi","./takeLast":"FbHg","./throwIfEmpty":"D7Ma","./defaultIfEmpty":"YBdz","../util/identity":"LXph"}],"yJbZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapTo=u;var e=n(require("tslib")),t=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=u?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}function u(e){return function(t){return t.lift(new i(e))}}var i=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.value))},e}(),o=function(t){function r(e,r){var n=t.call(this,e)||this;return n.value=r,n}return e.__extends(r,t),r.prototype._next=function(e){this.destination.next(this.value)},r}(t.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"ZwCH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.materialize=o;var t=i(require("tslib")),e=require("../Subscriber"),r=require("../Notification");function n(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return n=function(){return t},t}function i(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=n();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var u=i?Object.getOwnPropertyDescriptor(t,o):null;u&&(u.get||u.set)?Object.defineProperty(r,o,u):r[o]=t[o]}return r.default=t,e&&e.set(t,r),r}function o(){return function(t){return t.lift(new u)}}var u=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new c(t))},t}(),c=function(e){function n(t){return e.call(this,t)||this}return t.__extends(n,e),n.prototype._next=function(t){this.destination.next(r.Notification.createNext(t))},n.prototype._error=function(t){var e=this.destination;e.next(r.Notification.createError(t)),e.complete()},n.prototype._complete=function(){var t=this.destination;t.next(r.Notification.createComplete()),t.complete()},n}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB","../Notification":"n7Mc"}],"U785":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.scan=i;var e=n(require("tslib")),t=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var u=i?Object.getOwnPropertyDescriptor(e,s):null;u&&(u.get||u.set)?Object.defineProperty(n,s,u):n[s]=e[s]}return n.default=e,t&&t.set(e,n),n}function i(e,t){var r=!1;return arguments.length>=2&&(r=!0),function(n){return n.lift(new s(e,t,r))}}var s=function(){function e(e,t,r){void 0===r&&(r=!1),this.accumulator=e,this.seed=t,this.hasSeed=r}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.accumulator,this.seed,this.hasSeed))},e}(),u=function(t){function r(e,r,n,i){var s=t.call(this,e)||this;return s.accumulator=r,s._seed=n,s.hasSeed=i,s.index=0,s}return e.__extends(r,t),Object.defineProperty(r.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),r.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},r.prototype._tryNext=function(e){var t,r=this.index++;try{t=this.accumulator(this.seed,e,r)}catch(n){this.destination.error(n)}this.seed=t,this.destination.next(t)},r}(t.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"BORG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.reduce=n;var e=require("./scan"),t=require("./takeLast"),r=require("./defaultIfEmpty"),u=require("../util/pipe");function n(n,i){return arguments.length>=2?function(a){return(0,u.pipe)((0,e.scan)(n,i),(0,t.takeLast)(1),(0,r.defaultIfEmpty)(i))(a)}:function(r){return(0,u.pipe)((0,e.scan)(function(e,t,r){return n(e,t,r+1)}),(0,t.takeLast)(1))(r)}}
},{"./scan":"U785","./takeLast":"FbHg","./defaultIfEmpty":"YBdz","../util/pipe":"HQCS"}],"BgD2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.max=r;var e=require("./reduce");function r(r){var t="function"==typeof r?function(e,t){return r(e,t)>0?e:t}:function(e,r){return e>r?e:r};return(0,e.reduce)(t)}
},{"./reduce":"BORG"}],"sbfV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.merge=r;var e=require("../observable/merge");function r(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return function(t){return t.lift.call(e.merge.apply(void 0,[t].concat(r)))}}
},{"../observable/merge":"DQig"}],"S3q6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mergeMapTo=r;var e=require("./mergeMap");function r(r,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?(0,e.mergeMap)(function(){return r},t,n):("number"==typeof t&&(n=t),(0,e.mergeMap)(function(){return r},n))}
},{"./mergeMap":"nFsM"}],"wQne":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mergeScan=o,exports.MergeScanSubscriber=exports.MergeScanOperator=void 0;var t=s(require("tslib")),e=require("../util/subscribeToResult"),r=require("../OuterSubscriber"),i=require("../InnerSubscriber");function n(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return n=function(){return t},t}function s(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=n();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)){var o=i?Object.getOwnPropertyDescriptor(t,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=t[s]}return r.default=t,e&&e.set(t,r),r}function o(t,e,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),function(i){return i.lift(new u(t,e,r))}}var u=function(){function t(t,e,r){this.accumulator=t,this.seed=e,this.concurrent=r}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.accumulator,this.seed,this.concurrent))},t}();exports.MergeScanOperator=u;var c=function(r){function n(t,e,i,n){var s=r.call(this,t)||this;return s.accumulator=e,s.acc=i,s.concurrent=n,s.hasValue=!1,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return t.__extends(n,r),n.prototype._next=function(t){if(this.active<this.concurrent){var e=this.index++,r=this.destination,i=void 0;try{i=(0,this.accumulator)(this.acc,t,e)}catch(n){return r.error(n)}this.active++,this._innerSub(i,t,e)}else this.buffer.push(t)},n.prototype._innerSub=function(t,r,n){var s=new i.InnerSubscriber(this,void 0,void 0);this.destination.add(s),(0,e.subscribeToResult)(this,t,r,n,s)},n.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},n.prototype.notifyNext=function(t,e,r,i,n){var s=this.destination;this.acc=e,this.hasValue=!0,s.next(e)},n.prototype.notifyComplete=function(t){var e=this.buffer;this.destination.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},n}(r.OuterSubscriber);exports.MergeScanSubscriber=c;
},{"tslib":"vCxL","../util/subscribeToResult":"JM7e","../OuterSubscriber":"hZYI","../InnerSubscriber":"aQbR"}],"bAWd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.min=r;var e=require("./reduce");function r(r){var t="function"==typeof r?function(e,t){return r(e,t)<0?e:t}:function(e,r){return e<r?e:r};return(0,e.reduce)(t)}
},{"./reduce":"BORG"}],"M6Em":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.multicast=e,exports.MulticastOperator=void 0;var t=require("../observable/ConnectableObservable");function e(e,c){return function(o){var n;if(n="function"==typeof e?e:function(){return e},"function"==typeof c)return o.lift(new r(n,c));var s=Object.create(o,t.connectableObservableDescriptor);return s.source=o,s.subjectFactory=n,s}}var r=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var r=this.selector,c=this.subjectFactory(),o=r(c).subscribe(t);return o.add(e.subscribe(c)),o},t}();exports.MulticastOperator=r;
},{"../observable/ConnectableObservable":"kkfD"}],"S4UH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onErrorResumeNext=c,exports.onErrorResumeNextStatic=f;var e=s(require("tslib")),r=require("../observable/from"),t=require("../util/isArray"),n=require("../OuterSubscriber"),i=require("../InnerSubscriber"),o=require("../util/subscribeToResult");function u(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function s(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u();if(r&&r.has(e))return r.get(e);var t={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(t,i,o):t[i]=e[i]}return t.default=e,r&&r.set(e,t),t}function c(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return 1===e.length&&(0,t.isArray)(e[0])&&(e=e[0]),function(r){return r.lift(new b(e))}}function f(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i;return 1===e.length&&(0,t.isArray)(e[0])&&(e=e[0]),i=e.shift(),(0,r.from)(i,null).lift(new b(e))}var b=function(){function e(e){this.nextSources=e}return e.prototype.call=function(e,r){return r.subscribe(new l(e,this.nextSources))},e}(),l=function(r){function t(e,t){var n=r.call(this,e)||this;return n.destination=e,n.nextSources=t,n}return e.__extends(t,r),t.prototype.notifyError=function(e,r){this.subscribeToNextSource()},t.prototype.notifyComplete=function(e){this.subscribeToNextSource()},t.prototype._error=function(e){this.subscribeToNextSource(),this.unsubscribe()},t.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},t.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();if(e){var r=new i.InnerSubscriber(this,void 0,void 0);this.destination.add(r),(0,o.subscribeToResult)(this,e,void 0,void 0,r)}else this.destination.complete()},t}(n.OuterSubscriber);
},{"tslib":"vCxL","../observable/from":"WXUl","../util/isArray":"KeTG","../OuterSubscriber":"hZYI","../InnerSubscriber":"aQbR","../util/subscribeToResult":"JM7e"}],"u6OS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pairwise=i;var e=n(require("tslib")),t=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)){var o=i?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(n,u,o):n[u]=e[u]}return n.default=e,t&&t.set(e,n),n}function i(){return function(e){return e.lift(new u)}}var u=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new o(e))},e}(),o=function(t){function r(e){var r=t.call(this,e)||this;return r.hasPrev=!1,r}return e.__extends(r,t),r.prototype._next=function(e){this.hasPrev?this.destination.next([this.prev,e]):this.hasPrev=!0,this.prev=e},r}(t.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"jvG2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.partition=t;var e=require("../util/not"),r=require("./filter");function t(t,i){return function(n){return[(0,r.filter)(t,i)(n),(0,r.filter)((0,e.not)(t,i))(n)]}}
},{"../util/not":"nij6","./filter":"HKzi"}],"TdE4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pluck=e;var r=require("./map");function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=e.length;if(0===o)throw new Error("list of properties cannot be empty.");return function(n){return(0,r.map)(t(e,o))(n)}}function t(r,e){return function(t){for(var n=t,o=0;o<e;o++){var u=n[r[o]];if(void 0===u)return;n=u}return n}}
},{"./map":"dNh5"}],"TQAB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.publish=u;var e=require("../Subject"),t=require("./multicast");function u(u){return u?(0,t.multicast)(function(){return new e.Subject},u):(0,t.multicast)(new e.Subject)}
},{"../Subject":"r9t1","./multicast":"M6Em"}],"fUyM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.publishBehavior=t;var e=require("../BehaviorSubject"),r=require("./multicast");function t(t){return function(u){return(0,r.multicast)(new e.BehaviorSubject(t))(u)}}
},{"../BehaviorSubject":"MPU6","./multicast":"M6Em"}],"fQ7S":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.publishLast=r;var e=require("../AsyncSubject"),t=require("./multicast");function r(){return function(r){return(0,t.multicast)(new e.AsyncSubject)(r)}}
},{"../AsyncSubject":"Scvc","./multicast":"M6Em"}],"aqWk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.publishReplay=u;var e=require("../ReplaySubject"),t=require("./multicast");function u(u,r,n,i){n&&"function"!=typeof n&&(i=n);var o="function"==typeof n?n:void 0,c=new e.ReplaySubject(u,r,i);return function(e){return(0,t.multicast)(function(){return c},o)(e)}}
},{"../ReplaySubject":"Cp6P","./multicast":"M6Em"}],"EAaA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.race=t;var r=require("../util/isArray"),e=require("../observable/race");function t(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return function(a){return 1===t.length&&(0,r.isArray)(t[0])&&(t=t[0]),a.lift.call(e.race.apply(void 0,[a].concat(t)))}}
},{"../util/isArray":"KeTG","../observable/race":"bwYX"}],"Fbxf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.repeat=i;var e=u(require("tslib")),t=require("../Subscriber"),r=require("../observable/empty");function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n();if(t&&t.has(e))return t.get(e);var r={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=u?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,t&&t.set(e,r),r}function i(e){return void 0===e&&(e=-1),function(t){return 0===e?(0,r.empty)():e<0?t.lift(new o(-1,t)):t.lift(new o(e-1,t))}}var o=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.count,this.source))},e}(),c=function(t){function r(e,r,n){var u=t.call(this,e)||this;return u.count=r,u.source=n,u}return e.__extends(r,t),r.prototype.complete=function(){if(!this.isStopped){var e=this.source,r=this.count;if(0===r)return t.prototype.complete.call(this);r>-1&&(this.count=r-1),e.subscribe(this._unsubscribeAndRecycle())}},r}(t.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB","../observable/empty":"XsKQ"}],"CT9q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.repeatWhen=o;var t=n(require("tslib")),e=require("../Subject"),i=require("../OuterSubscriber"),r=require("../util/subscribeToResult");function s(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return s=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=s();if(e&&e.has(t))return e.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=r?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=t[n]}return i.default=t,e&&e.set(t,i),i}function o(t){return function(e){return e.lift(new u(t))}}var u=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.notifier,e))},t}(),c=function(i){function s(t,e,r){var s=i.call(this,t)||this;return s.notifier=e,s.source=r,s.sourceIsBeingSubscribedTo=!0,s}return t.__extends(s,i),s.prototype.notifyNext=function(t,e,i,r,s){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},s.prototype.notifyComplete=function(t){if(!1===this.sourceIsBeingSubscribedTo)return i.prototype.complete.call(this)},s.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return i.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next()}},s.prototype._unsubscribe=function(){var t=this.notifications,e=this.retriesSubscription;t&&(t.unsubscribe(),this.notifications=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null},s.prototype._unsubscribeAndRecycle=function(){var t=this._unsubscribe;return this._unsubscribe=null,i.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=t,this},s.prototype.subscribeToRetries=function(){var t;this.notifications=new e.Subject;try{t=(0,this.notifier)(this.notifications)}catch(s){return i.prototype.complete.call(this)}this.retries=t,this.retriesSubscription=(0,r.subscribeToResult)(this,t)},s}(i.OuterSubscriber);
},{"tslib":"vCxL","../Subject":"r9t1","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"ZHEI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.retry=u;var t=n(require("tslib")),e=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var n={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var i=u?Object.getOwnPropertyDescriptor(t,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=t[o]}return n.default=t,e&&e.set(t,n),n}function u(t){return void 0===t&&(t=-1),function(e){return e.lift(new o(t,e))}}var o=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new i(t,this.count,this.source))},t}(),i=function(e){function r(t,r,n){var u=e.call(this,t)||this;return u.count=r,u.source=n,u}return t.__extends(r,e),r.prototype.error=function(t){if(!this.isStopped){var r=this.source,n=this.count;if(0===n)return e.prototype.error.call(this,t);n>-1&&(this.count=n-1),r.subscribe(this._unsubscribeAndRecycle())}},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"GHe2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.retryWhen=u;var r=n(require("tslib")),e=require("../Subject"),t=require("../OuterSubscriber"),i=require("../util/subscribeToResult");function s(){if("function"!=typeof WeakMap)return null;var r=new WeakMap;return s=function(){return r},r}function n(r){if(r&&r.__esModule)return r;if(null===r||"object"!=typeof r&&"function"!=typeof r)return{default:r};var e=s();if(e&&e.has(r))return e.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var u=i?Object.getOwnPropertyDescriptor(r,n):null;u&&(u.get||u.set)?Object.defineProperty(t,n,u):t[n]=r[n]}return t.default=r,e&&e.set(r,t),t}function u(r){return function(e){return e.lift(new o(r,e))}}var o=function(){function r(r,e){this.notifier=r,this.source=e}return r.prototype.call=function(r,e){return e.subscribe(new c(r,this.notifier,this.source))},r}(),c=function(t){function s(r,e,i){var s=t.call(this,r)||this;return s.notifier=e,s.source=i,s}return r.__extends(s,t),s.prototype.error=function(r){if(!this.isStopped){var s=this.errors,n=this.retries,u=this.retriesSubscription;if(n)this.errors=null,this.retriesSubscription=null;else{s=new e.Subject;try{n=(0,this.notifier)(s)}catch(o){return t.prototype.error.call(this,o)}u=(0,i.subscribeToResult)(this,n)}this._unsubscribeAndRecycle(),this.errors=s,this.retries=n,this.retriesSubscription=u,s.next(r)}},s.prototype._unsubscribe=function(){var r=this.errors,e=this.retriesSubscription;r&&(r.unsubscribe(),this.errors=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null},s.prototype.notifyNext=function(r,e,t,i,s){var n=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=n,this.source.subscribe(this)},s}(t.OuterSubscriber);
},{"tslib":"vCxL","../Subject":"r9t1","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"Rd9o":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sample=u;var t=i(require("tslib")),e=require("../OuterSubscriber"),r=require("../util/subscribeToResult");function n(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return n=function(){return t},t}function i(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=n();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var o=i?Object.getOwnPropertyDescriptor(t,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=t[u]}return r.default=t,e&&e.set(t,r),r}function u(t){return function(e){return e.lift(new o(t))}}var o=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new s(t),i=e.subscribe(n);return i.add((0,r.subscribeToResult)(n,this.notifier)),i},t}(),s=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasValue=!1,t}return t.__extends(r,e),r.prototype._next=function(t){this.value=t,this.hasValue=!0},r.prototype.notifyNext=function(t,e,r,n,i){this.emitValue()},r.prototype.notifyComplete=function(){this.emitValue()},r.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},r}(e.OuterSubscriber);
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"nb45":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sampleTime=u;var e=i(require("tslib")),t=require("../Subscriber"),r=require("../scheduler/async");function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}function i(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)){var s=i?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,t&&t.set(e,r),r}function u(e,t){return void 0===t&&(t=r.async),function(r){return r.lift(new s(e,t))}}var s=function(){function e(e,t){this.period=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.period,this.scheduler))},e}(),o=function(t){function r(e,r,n){var i=t.call(this,e)||this;return i.period=r,i.scheduler=n,i.hasValue=!1,i.add(n.schedule(c,r,{subscriber:i,period:r})),i}return e.__extends(r,t),r.prototype._next=function(e){this.lastValue=e,this.hasValue=!0},r.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},r}(t.Subscriber);function c(e){var t=e.subscriber,r=e.period;t.notifyNext(),this.schedule(e,r)}
},{"tslib":"vCxL","../Subscriber":"RaFB","../scheduler/async":"jun6"}],"PMGC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sequenceEqual=o,exports.SequenceEqualSubscriber=exports.SequenceEqualOperator=void 0;var t=n(require("tslib")),e=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var s=o?Object.getOwnPropertyDescriptor(t,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=t[i]}return n.default=t,e&&e.set(t,n),n}function o(t,e){return function(r){return r.lift(new i(t,e))}}var i=function(){function t(t,e){this.compareTo=t,this.comparator=e}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.compareTo,this.comparator))},t}();exports.SequenceEqualOperator=i;var s=function(e){function r(t,r,n){var o=e.call(this,t)||this;return o.compareTo=r,o.comparator=n,o._a=[],o._b=[],o._oneComplete=!1,o.destination.add(r.subscribe(new u(t,o))),o}return t.__extends(r,e),r.prototype._next=function(t){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(t),this.checkValues())},r.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},r.prototype.checkValues=function(){for(var t=this._a,e=this._b,r=this.comparator;t.length>0&&e.length>0;){var n=t.shift(),o=e.shift(),i=!1;try{i=r?r(n,o):n===o}catch(s){this.destination.error(s)}i||this.emit(!1)}},r.prototype.emit=function(t){var e=this.destination;e.next(t),e.complete()},r.prototype.nextB=function(t){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(t),this.checkValues())},r.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},r}(e.Subscriber);exports.SequenceEqualSubscriber=s;var u=function(e){function r(t,r){var n=e.call(this,t)||this;return n.parent=r,n}return t.__extends(r,e),r.prototype._next=function(t){this.parent.nextB(t)},r.prototype._error=function(t){this.parent.error(t),this.unsubscribe()},r.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"KBGh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.share=n;var e=require("./multicast"),r=require("./refCount"),t=require("../Subject");function u(){return new t.Subject}function n(){return function(t){return(0,r.refCount)()((0,e.multicast)(u)(t))}}
},{"./multicast":"M6Em","./refCount":"vT9o","../Subject":"r9t1"}],"xsrM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shareReplay=r;var e=require("../ReplaySubject");function r(e,r,t){var n;return n=e&&"object"==typeof e?e:{bufferSize:e,windowTime:r,refCount:!1,scheduler:t},function(e){return e.lift(u(n))}}function u(r){var u,t,n=r.bufferSize,i=void 0===n?Number.POSITIVE_INFINITY:n,o=r.windowTime,c=void 0===o?Number.POSITIVE_INFINITY:o,s=r.refCount,f=r.scheduler,b=0,d=!1,a=!1;return function(r){b++,u&&!d||(d=!1,u=new e.ReplaySubject(i,c,f),t=r.subscribe({next:function(e){u.next(e)},error:function(e){d=!0,u.error(e)},complete:function(){a=!0,u.complete()}}));var n=u.subscribe(this);this.add(function(){b--,n.unsubscribe(),t&&!a&&s&&0===b&&(t.unsubscribe(),t=void 0,u=void 0)})}}
},{"../ReplaySubject":"Cp6P"}],"angX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.single=o;var e=i(require("tslib")),t=require("../Subscriber"),r=require("../util/EmptyError");function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}function i(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var u=i?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(r,o,u):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}function o(e){return function(t){return t.lift(new u(e,t))}}var u=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.source))},e}(),s=function(t){function n(e,r,n){var i=t.call(this,e)||this;return i.predicate=r,i.source=n,i.seenValue=!1,i.index=0,i}return e.__extends(n,t),n.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)},n.prototype._next=function(e){var t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)},n.prototype.tryNext=function(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(r){this.destination.error(r)}},n.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new r.EmptyError)},n}(t.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB","../util/EmptyError":"vsl0"}],"vMIz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.skip=o;var t=n(require("tslib")),e=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var u=o?Object.getOwnPropertyDescriptor(t,i):null;u&&(u.get||u.set)?Object.defineProperty(n,i,u):n[i]=t[i]}return n.default=t,e&&e.set(t,n),n}function o(t){return function(e){return e.lift(new i(t))}}var i=function(){function t(t){this.total=t}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.total))},t}(),u=function(e){function r(t,r){var n=e.call(this,t)||this;return n.total=r,n.count=0,n}return t.__extends(r,e),r.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"iB53":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.skipLast=u;var t=i(require("tslib")),r=require("../Subscriber"),e=require("../util/ArgumentOutOfRangeError");function n(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return n=function(){return t},t}function i(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=n();if(r&&r.has(t))return r.get(t);var e={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var o=i?Object.getOwnPropertyDescriptor(t,u):null;o&&(o.get||o.set)?Object.defineProperty(e,u,o):e[u]=t[u]}return e.default=t,r&&r.set(t,e),e}function u(t){return function(r){return r.lift(new o(t))}}var o=function(){function t(t){if(this._skipCount=t,this._skipCount<0)throw new e.ArgumentOutOfRangeError}return t.prototype.call=function(t,e){return 0===this._skipCount?e.subscribe(new r.Subscriber(t)):e.subscribe(new s(t,this._skipCount))},t}(),s=function(r){function e(t,e){var n=r.call(this,t)||this;return n._skipCount=e,n._count=0,n._ring=new Array(e),n}return t.__extends(e,r),e.prototype._next=function(t){var r=this._skipCount,e=this._count++;if(e<r)this._ring[e]=t;else{var n=e%r,i=this._ring,u=i[n];i[n]=t,this.destination.next(u)}},e}(r.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB","../util/ArgumentOutOfRangeError":"Qh4I"}],"xmsT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.skipUntil=o;var e=u(require("tslib")),t=require("../OuterSubscriber"),r=require("../InnerSubscriber"),n=require("../util/subscribeToResult");function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)){var o=n?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=e[u]}return r.default=e,t&&t.set(e,r),r}function o(e){return function(t){return t.lift(new s(e))}}var s=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.notifier))},e}(),c=function(t){function i(e,i){var u=t.call(this,e)||this;u.hasValue=!1;var o=new r.InnerSubscriber(u,void 0,void 0);return u.add(o),u.innerSubscription=o,(0,n.subscribeToResult)(u,i,void 0,void 0,o),u}return e.__extends(i,t),i.prototype._next=function(e){this.hasValue&&t.prototype._next.call(this,e)},i.prototype.notifyNext=function(e,t,r,n,i){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},i.prototype.notifyComplete=function(){},i}(t.OuterSubscriber);
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../InnerSubscriber":"aQbR","../util/subscribeToResult":"JM7e"}],"qjDA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.skipWhile=i;var t=n(require("tslib")),e=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var u=i?Object.getOwnPropertyDescriptor(t,o):null;u&&(u.get||u.set)?Object.defineProperty(n,o,u):n[o]=t[o]}return n.default=t,e&&e.set(t,n),n}function i(t){return function(e){return e.lift(new o(t))}}var o=function(){function t(t){this.predicate=t}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.predicate))},t}(),u=function(e){function r(t,r){var n=e.call(this,t)||this;return n.predicate=r,n.skipping=!0,n.index=0,n}return t.__extends(r,e),r.prototype._next=function(t){var e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)},r.prototype.tryCallPredicate=function(t){try{var e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(r){this.destination.error(r)}},r}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"doo6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.startWith=t;var e=require("../observable/concat"),r=require("../util/isScheduler");function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var u=t[t.length-1];return(0,r.isScheduler)(u)?(t.pop(),function(r){return(0,e.concat)(t,r,u)}):function(r){return(0,e.concat)(t,r)}}
},{"../observable/concat":"CsdO","../util/isScheduler":"VqoH"}],"r9wA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SubscribeOnObservable=void 0;var e=s(require("tslib")),r=require("../Observable"),t=require("../scheduler/asap"),i=require("../util/isNumeric");function u(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function s(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u();if(r&&r.has(e))return r.get(e);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var n=i?Object.getOwnPropertyDescriptor(e,s):null;n&&(n.get||n.set)?Object.defineProperty(t,s,n):t[s]=e[s]}return t.default=e,r&&r.set(e,t),t}var n=function(r){function u(e,u,s){void 0===u&&(u=0),void 0===s&&(s=t.asap);var n=r.call(this)||this;return n.source=e,n.delayTime=u,n.scheduler=s,(!(0,i.isNumeric)(u)||u<0)&&(n.delayTime=0),s&&"function"==typeof s.schedule||(n.scheduler=t.asap),n}return e.__extends(u,r),u.create=function(e,r,i){return void 0===r&&(r=0),void 0===i&&(i=t.asap),new u(e,r,i)},u.dispatch=function(e){var r=e.source,t=e.subscriber;return this.add(r.subscribe(t))},u.prototype._subscribe=function(e){var r=this.delayTime,t=this.source;return this.scheduler.schedule(u.dispatch,r,{source:t,subscriber:e})},u}(r.Observable);exports.SubscribeOnObservable=n;
},{"tslib":"vCxL","../Observable":"wbSE","../scheduler/asap":"ZqYc","../util/isNumeric":"wBpm"}],"Et1l":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.subscribeOn=r;var e=require("../observable/SubscribeOnObservable");function r(e,r){return void 0===r&&(r=0),function(n){return n.lift(new t(e,r))}}var t=function(){function r(e,r){this.scheduler=e,this.delay=r}return r.prototype.call=function(r,t){return new e.SubscribeOnObservable(t,this.delay,this.scheduler).subscribe(r)},r}();
},{"../observable/SubscribeOnObservable":"r9wA"}],"g5Rk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.switchMap=c;var t=s(require("tslib")),e=require("../OuterSubscriber"),r=require("../InnerSubscriber"),n=require("../util/subscribeToResult"),i=require("./map"),o=require("../observable/from");function u(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return u=function(){return t},t}function s(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=u();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var o=n?Object.getOwnPropertyDescriptor(t,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}function c(t,e){return"function"==typeof e?function(r){return r.pipe(c(function(r,n){return(0,o.from)(t(r,n)).pipe((0,i.map)(function(t,i){return e(r,t,n,i)}))}))}:function(e){return e.lift(new p(t))}}var p=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new f(t,this.project))},t}(),f=function(e){function i(t,r){var n=e.call(this,t)||this;return n.project=r,n.index=0,n}return t.__extends(i,e),i.prototype._next=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(n){return void this.destination.error(n)}this._innerSub(e,t,r)},i.prototype._innerSub=function(t,e,i){var o=this.innerSubscription;o&&o.unsubscribe();var u=new r.InnerSubscriber(this,void 0,void 0);this.destination.add(u),this.innerSubscription=(0,n.subscribeToResult)(this,t,e,i,u)},i.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},i.prototype._unsubscribe=function(){this.innerSubscription=null},i.prototype.notifyComplete=function(t){this.destination.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},i.prototype.notifyNext=function(t,e,r,n,i){this.destination.next(e)},i}(e.OuterSubscriber);
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../InnerSubscriber":"aQbR","../util/subscribeToResult":"JM7e","./map":"dNh5","../observable/from":"WXUl"}],"CBg8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.switchAll=i;var e=require("./switchMap"),t=require("../util/identity");function i(){return(0,e.switchMap)(t.identity)}
},{"./switchMap":"g5Rk","../util/identity":"LXph"}],"Hs9S":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.switchMapTo=e;var t=require("./switchMap");function e(e,r){return r?(0,t.switchMap)(function(){return e},r):(0,t.switchMap)(function(){return e})}
},{"./switchMap":"g5Rk"}],"qGSv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.takeUntil=i;var e=u(require("tslib")),t=require("../OuterSubscriber"),r=require("../util/subscribeToResult");function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n();if(t&&t.has(e))return t.get(e);var r={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=u?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,t&&t.set(e,r),r}function i(e){return function(t){return t.lift(new o(e))}}var o=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new c(e),u=(0,r.subscribeToResult)(n,this.notifier);return u&&!n.seenValue?(n.add(u),t.subscribe(n)):n},e}(),c=function(t){function r(e){var r=t.call(this,e)||this;return r.seenValue=!1,r}return e.__extends(r,t),r.prototype.notifyNext=function(e,t,r,n,u){this.seenValue=!0,this.complete()},r.prototype.notifyComplete=function(){},r}(t.OuterSubscriber);
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"EYJX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.takeWhile=i;var e=n(require("tslib")),t=require("../Subscriber");function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var u=i?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(n,o,u):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}function i(e,t){return void 0===t&&(t=!1),function(r){return r.lift(new o(e,t))}}var o=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.predicate,this.inclusive))},e}(),u=function(t){function r(e,r,n){var i=t.call(this,e)||this;return i.predicate=r,i.inclusive=n,i.index=0,i}return e.__extends(r,t),r.prototype._next=function(e){var t,r=this.destination;try{t=this.predicate(e,this.index++)}catch(n){return void r.error(n)}this.nextOrComplete(e,t)},r.prototype.nextOrComplete=function(e,t){var r=this.destination;Boolean(t)?r.next(e):(this.inclusive&&r.next(e),r.complete())},r}(t.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB"}],"okAI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.tap=p;var t=i(require("tslib")),e=require("../Subscriber"),r=require("../util/noop"),o=require("../util/isFunction");function n(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return n=function(){return t},t}function i(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=n();if(e&&e.has(t))return e.get(t);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var p=o?Object.getOwnPropertyDescriptor(t,i):null;p&&(p.get||p.set)?Object.defineProperty(r,i,p):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}function p(t,e,r){return function(o){return o.lift(new c(t,e,r))}}var c=function(){function t(t,e,r){this.nextOrObserver=t,this.error=e,this.complete=r}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.nextOrObserver,this.error,this.complete))},t}(),u=function(e){function n(t,n,i,p){var c=e.call(this,t)||this;return c._tapNext=r.noop,c._tapError=r.noop,c._tapComplete=r.noop,c._tapError=i||r.noop,c._tapComplete=p||r.noop,(0,o.isFunction)(n)?(c._context=c,c._tapNext=n):n&&(c._context=n,c._tapNext=n.next||r.noop,c._tapError=n.error||r.noop,c._tapComplete=n.complete||r.noop),c}return t.__extends(n,e),n.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)},n.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},n.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},n}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB","../util/noop":"rXfM","../util/isFunction":"Qnsq"}],"Yoo8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.throttle=u,exports.defaultThrottleConfig=void 0;var t=n(require("tslib")),e=require("../OuterSubscriber"),r=require("../util/subscribeToResult");function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var u=n?Object.getOwnPropertyDescriptor(t,o):null;u&&(u.get||u.set)?Object.defineProperty(r,o,u):r[o]=t[o]}return r.default=t,e&&e.set(t,r),r}var o={leading:!0,trailing:!1};function u(t,e){return void 0===e&&(e=o),function(r){return r.lift(new s(t,e.leading,e.trailing))}}exports.defaultThrottleConfig=o;var s=function(){function t(t,e,r){this.durationSelector=t,this.leading=e,this.trailing=r}return t.prototype.call=function(t,e){return e.subscribe(new l(t,this.durationSelector,this.leading,this.trailing))},t}(),l=function(e){function i(t,r,i,n){var o=e.call(this,t)||this;return o.destination=t,o.durationSelector=r,o._leading=i,o._trailing=n,o._hasValue=!1,o}return t.__extends(i,e),i.prototype._next=function(t){this._hasValue=!0,this._sendValue=t,this._throttled||(this._leading?this.send():this.throttle(t))},i.prototype.send=function(){var t=this._hasValue,e=this._sendValue;t&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=null},i.prototype.throttle=function(t){var e=this.tryDurationSelector(t);e&&this.add(this._throttled=(0,r.subscribeToResult)(this,e))},i.prototype.tryDurationSelector=function(t){try{return this.durationSelector(t)}catch(e){return this.destination.error(e),null}},i.prototype.throttlingDone=function(){var t=this._throttled,e=this._trailing;t&&t.unsubscribe(),this._throttled=null,e&&this.send()},i.prototype.notifyNext=function(t,e,r,i,n){this.throttlingDone()},i.prototype.notifyComplete=function(){this.throttlingDone()},i}(e.OuterSubscriber);
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"v3FQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.throttleTime=s;var t=l(require("tslib")),i=require("../Subscriber"),e=require("../scheduler/async"),r=require("./throttle");function n(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return n=function(){return t},t}function l(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var i=n();if(i&&i.has(t))return i.get(t);var e={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(Object.prototype.hasOwnProperty.call(t,l)){var s=r?Object.getOwnPropertyDescriptor(t,l):null;s&&(s.get||s.set)?Object.defineProperty(e,l,s):e[l]=t[l]}return e.default=t,i&&i.set(t,e),e}function s(t,i,n){return void 0===i&&(i=e.async),void 0===n&&(n=r.defaultThrottleConfig),function(e){return e.lift(new a(t,i,n.leading,n.trailing))}}var a=function(){function t(t,i,e,r){this.duration=t,this.scheduler=i,this.leading=e,this.trailing=r}return t.prototype.call=function(t,i){return i.subscribe(new u(t,this.duration,this.scheduler,this.leading,this.trailing))},t}(),u=function(i){function e(t,e,r,n,l){var s=i.call(this,t)||this;return s.duration=e,s.scheduler=r,s.leading=n,s.trailing=l,s._hasTrailingValue=!1,s._trailingValue=null,s}return t.__extends(e,i),e.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(o,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))},e.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},e.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},e}(i.Subscriber);function o(t){t.subscriber.clearThrottle()}
},{"tslib":"vCxL","../Subscriber":"RaFB","../scheduler/async":"jun6","./throttle":"Yoo8"}],"n6SK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.timeInterval=u,exports.TimeInterval=void 0;var e=require("../scheduler/async"),r=require("./scan"),n=require("../observable/defer"),t=require("./map");function u(u){return void 0===u&&(u=e.async),function(e){return(0,n.defer)(function(){return e.pipe((0,r.scan)(function(e,r){var n=e.current;return{value:r,current:u.now(),last:n}},{current:u.now(),value:void 0,last:void 0}),(0,t.map)(function(e){var r=e.current,n=e.last,t=e.value;return new i(t,r-n)}))})}}var i=function(){return function(e,r){this.value=e,this.interval=r}}();exports.TimeInterval=i;
},{"../scheduler/async":"jun6","./scan":"U785","../observable/defer":"w9G6","./map":"dNh5"}],"L72b":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.timeoutWith=o;var t=n(require("tslib")),e=require("../scheduler/async"),i=require("../util/isDate"),r=require("../OuterSubscriber"),u=require("../util/subscribeToResult");function s(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return s=function(){return t},t}function n(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=s();if(e&&e.has(t))return e.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var n=r?Object.getOwnPropertyDescriptor(t,u):null;n&&(n.get||n.set)?Object.defineProperty(i,u,n):i[u]=t[u]}return i.default=t,e&&e.set(t,i),i}function o(t,r,u){return void 0===u&&(u=e.async),function(e){var s=(0,i.isDate)(t),n=s?+t-u.now():Math.abs(t);return e.lift(new c(n,s,r,u))}}var c=function(){function t(t,e,i,r){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=i,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new l(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t}(),l=function(e){function i(t,i,r,u,s){var n=e.call(this,t)||this;return n.absoluteTimeout=i,n.waitFor=r,n.withObservable=u,n.scheduler=s,n.action=null,n.scheduleTimeout(),n}return t.__extends(i,e),i.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add((0,u.subscribeToResult)(t,e))},i.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(i.dispatchTimeout,this.waitFor,this))},i.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},i.prototype._unsubscribe=function(){this.action=null,this.scheduler=null,this.withObservable=null},i}(r.OuterSubscriber);
},{"tslib":"vCxL","../scheduler/async":"jun6","../util/isDate":"rxSS","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"Cp8V":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.timeout=i;var r=require("../scheduler/async"),e=require("../util/TimeoutError"),t=require("./timeoutWith"),o=require("../observable/throwError");function i(i,u){return void 0===u&&(u=r.async),(0,t.timeoutWith)(i,(0,o.throwError)(new e.TimeoutError),u)}
},{"../scheduler/async":"jun6","../util/TimeoutError":"SZK7","./timeoutWith":"L72b","../observable/throwError":"FdIu"}],"pXuq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.timestamp=r,exports.Timestamp=void 0;var e=require("../scheduler/async"),t=require("./map");function r(r){return void 0===r&&(r=e.async),(0,t.map)(function(e){return new i(e,r.now())})}var i=function(){return function(e,t){this.value=e,this.timestamp=t}}();exports.Timestamp=i;
},{"../scheduler/async":"jun6","./map":"dNh5"}],"LA40":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.toArray=t;var e=require("./reduce");function r(e,r,t){return 0===t?[r]:(e.push(r),e)}function t(){return(0,e.reduce)(r,[])}
},{"./reduce":"BORG"}],"Iygx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.window=u;var t=i(require("tslib")),e=require("../Subject"),r=require("../OuterSubscriber"),n=require("../util/subscribeToResult");function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function i(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var u=n?Object.getOwnPropertyDescriptor(t,i):null;u&&(u.get||u.set)?Object.defineProperty(r,i,u):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}function u(t){return function(e){return e.lift(new c(t))}}var c=function(){function t(t){this.windowBoundaries=t}return t.prototype.call=function(t,e){var r=new s(t),o=e.subscribe(r);return o.closed||r.add((0,n.subscribeToResult)(r,this.windowBoundaries)),o},t}(),s=function(r){function n(t){var n=r.call(this,t)||this;return n.window=new e.Subject,t.next(n.window),n}return t.__extends(n,r),n.prototype.notifyNext=function(t,e,r,n,o){this.openWindow()},n.prototype.notifyError=function(t,e){this._error(t)},n.prototype.notifyComplete=function(t){this._complete()},n.prototype._next=function(t){this.window.next(t)},n.prototype._error=function(t){this.window.error(t),this.destination.error(t)},n.prototype._complete=function(){this.window.complete(),this.destination.complete()},n.prototype._unsubscribe=function(){this.window=null},n.prototype.openWindow=function(){var t=this.window;t&&t.complete();var r=this.destination,n=this.window=new e.Subject;r.next(n)},n}(r.OuterSubscriber);
},{"tslib":"vCxL","../Subject":"r9t1","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"GYT2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.windowCount=o;var t=r(require("tslib")),e=require("../Subscriber"),n=require("../Subject");function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function r(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var s=r?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=t[o]}return n.default=t,e&&e.set(t,n),n}function o(t,e){return void 0===e&&(e=0),function(n){return n.lift(new s(t,e))}}var s=function(){function t(t,e){this.windowSize=t,this.startWindowEvery=e}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.windowSize,this.startWindowEvery))},t}(),u=function(e){function i(t,i,r){var o=e.call(this,t)||this;return o.destination=t,o.windowSize=i,o.startWindowEvery=r,o.windows=[new n.Subject],o.count=0,t.next(o.windows[0]),o}return t.__extends(i,e),i.prototype._next=function(t){for(var e=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,i=this.destination,r=this.windowSize,o=this.windows,s=o.length,u=0;u<s&&!this.closed;u++)o[u].next(t);var c=this.count-r+1;if(c>=0&&c%e==0&&!this.closed&&o.shift().complete(),++this.count%e==0&&!this.closed){var f=new n.Subject;o.push(f),i.next(f)}},i.prototype._error=function(t){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().error(t);this.destination.error(t)},i.prototype._complete=function(){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().complete();this.destination.complete()},i.prototype._unsubscribe=function(){this.count=0,this.windows=null},i}(e.Subscriber);
},{"tslib":"vCxL","../Subscriber":"RaFB","../Subject":"r9t1"}],"Okss":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.windowTime=c;var e=u(require("tslib")),n=require("../Subject"),t=require("../scheduler/async"),i=require("../Subscriber"),r=require("../util/isNumeric"),o=require("../util/isScheduler");function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=s();if(n&&n.has(e))return n.get(e);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(t,r,o):t[r]=e[r]}return t.default=e,n&&n.set(e,t),t}function c(e){var n=t.async,i=null,s=Number.POSITIVE_INFINITY;return(0,o.isScheduler)(arguments[3])&&(n=arguments[3]),(0,o.isScheduler)(arguments[2])?n=arguments[2]:(0,r.isNumeric)(arguments[2])&&(s=arguments[2]),(0,o.isScheduler)(arguments[1])?n=arguments[1]:(0,r.isNumeric)(arguments[1])&&(i=arguments[1]),function(t){return t.lift(new d(e,i,s,n))}}var d=function(){function e(e,n,t,i){this.windowTimeSpan=e,this.windowCreationInterval=n,this.maxWindowSize=t,this.scheduler=i}return e.prototype.call=function(e,n){return n.subscribe(new l(e,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},e}(),a=function(n){function t(){var e=null!==n&&n.apply(this,arguments)||this;return e._numberOfNextedValues=0,e}return e.__extends(t,n),t.prototype.next=function(e){this._numberOfNextedValues++,n.prototype.next.call(this,e)},Object.defineProperty(t.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),t}(n.Subject),l=function(n){function t(e,t,i,r,o){var s=n.call(this,e)||this;s.destination=e,s.windowTimeSpan=t,s.windowCreationInterval=i,s.maxWindowSize=r,s.scheduler=o,s.windows=[];var u=s.openWindow();if(null!==i&&i>=0){var c={subscriber:s,window:u,context:null},d={windowTimeSpan:t,windowCreationInterval:i,subscriber:s,scheduler:o};s.add(o.schedule(f,t,c)),s.add(o.schedule(p,i,d))}else{var a={subscriber:s,window:u,windowTimeSpan:t};s.add(o.schedule(w,t,a))}return s}return e.__extends(t,n),t.prototype._next=function(e){for(var n=this.windows,t=n.length,i=0;i<t;i++){var r=n[i];r.closed||(r.next(e),r.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(r))}},t.prototype._error=function(e){for(var n=this.windows;n.length>0;)n.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){for(var e=this.windows;e.length>0;){var n=e.shift();n.closed||n.complete()}this.destination.complete()},t.prototype.openWindow=function(){var e=new a;return this.windows.push(e),this.destination.next(e),e},t.prototype.closeWindow=function(e){e.complete();var n=this.windows;n.splice(n.indexOf(e),1)},t}(i.Subscriber);function w(e){var n=e.subscriber,t=e.windowTimeSpan,i=e.window;i&&n.closeWindow(i),e.window=n.openWindow(),this.schedule(e,t)}function p(e){var n=e.windowTimeSpan,t=e.subscriber,i=e.scheduler,r=e.windowCreationInterval,o=t.openWindow(),s={action:this,subscription:null},u={subscriber:t,window:o,context:s};s.subscription=i.schedule(f,n,u),this.add(s.subscription),this.schedule(e,r)}function f(e){var n=e.subscriber,t=e.window,i=e.context;i&&i.action&&i.subscription&&i.action.remove(i.subscription),n.closeWindow(t)}
},{"tslib":"vCxL","../Subject":"r9t1","../scheduler/async":"jun6","../Subscriber":"RaFB","../util/isNumeric":"wBpm","../util/isScheduler":"VqoH"}],"JiQj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.windowToggle=c;var t=s(require("tslib")),e=require("../Subject"),r=require("../Subscription"),n=require("../OuterSubscriber"),o=require("../util/subscribeToResult");function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function s(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,e&&e.set(t,r),r}function c(t,e){return function(r){return r.lift(new u(t,e))}}var u=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new p(t,this.openings,this.closingSelector))},t}(),p=function(n){function i(t,e,r){var i=n.call(this,t)||this;return i.openings=e,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=(0,o.subscribeToResult)(i,e,e)),i}return t.__extends(i,n),i.prototype._next=function(t){var e=this.contexts;if(e)for(var r=e.length,n=0;n<r;n++)e[n].window.next(t)},i.prototype._error=function(t){var e=this.contexts;if(this.contexts=null,e)for(var r=e.length,o=-1;++o<r;){var i=e[o];i.window.error(t),i.subscription.unsubscribe()}n.prototype._error.call(this,t)},i.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,r=-1;++r<e;){var o=t[r];o.window.complete(),o.subscription.unsubscribe()}n.prototype._complete.call(this)},i.prototype._unsubscribe=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,r=-1;++r<e;){var n=t[r];n.window.unsubscribe(),n.subscription.unsubscribe()}},i.prototype.notifyNext=function(t,n,i,s,c){if(t===this.openings){var u=void 0;try{u=(0,this.closingSelector)(n)}catch(a){return this.error(a)}var p=new e.Subject,l=new r.Subscription,f={window:p,subscription:l};this.contexts.push(f);var b=(0,o.subscribeToResult)(this,u,f);b.closed?this.closeWindow(this.contexts.length-1):(b.context=f,l.add(b)),this.destination.next(p)}else this.closeWindow(this.contexts.indexOf(t))},i.prototype.notifyError=function(t){this.error(t)},i.prototype.notifyComplete=function(t){t!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(t.context))},i.prototype.closeWindow=function(t){if(-1!==t){var e=this.contexts,r=e[t],n=r.window,o=r.subscription;e.splice(t,1),n.complete(),o.unsubscribe()}},i}(n.OuterSubscriber);
},{"tslib":"vCxL","../Subject":"r9t1","../Subscription":"I8KM","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"YaG1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.windowWhen=s;var t=r(require("tslib")),e=require("../Subject"),i=require("../OuterSubscriber"),n=require("../util/subscribeToResult");function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function r(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var s=n?Object.getOwnPropertyDescriptor(t,r):null;s&&(s.get||s.set)?Object.defineProperty(i,r,s):i[r]=t[r]}return i.default=t,e&&e.set(t,i),i}function s(t){return function(e){return e.lift(new u(t))}}var u=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.closingSelector))},t}(),c=function(i){function o(t,e){var n=i.call(this,t)||this;return n.destination=t,n.closingSelector=e,n.openWindow(),n}return t.__extends(o,i),o.prototype.notifyNext=function(t,e,i,n,o){this.openWindow(o)},o.prototype.notifyError=function(t,e){this._error(t)},o.prototype.notifyComplete=function(t){this.openWindow(t)},o.prototype._next=function(t){this.window.next(t)},o.prototype._error=function(t){this.window.error(t),this.destination.error(t),this.unsubscribeClosingNotification()},o.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},o.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},o.prototype.openWindow=function(t){void 0===t&&(t=null),t&&(this.remove(t),t.unsubscribe());var i=this.window;i&&i.complete();var o,r=this.window=new e.Subject;this.destination.next(r);try{o=(0,this.closingSelector)()}catch(s){return this.destination.error(s),void this.window.error(s)}this.add(this.closingNotification=(0,n.subscribeToResult)(this,o))},o}(i.OuterSubscriber);
},{"tslib":"vCxL","../Subject":"r9t1","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"JDwQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.withLatestFrom=i;var t=o(require("tslib")),e=require("../OuterSubscriber"),r=require("../util/subscribeToResult");function n(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return n=function(){return t},t}function o(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=n();if(e&&e.has(t))return e.get(t);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var s=o?Object.getOwnPropertyDescriptor(t,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var r;"function"==typeof t[t.length-1]&&(r=t.pop());var n=t;return e.lift(new s(n,r))}}var s=function(){function t(t,e){this.observables=t,this.project=e}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.observables,this.project))},t}(),u=function(e){function n(t,n,o){var i=e.call(this,t)||this;i.observables=n,i.project=o,i.toRespond=[];var s=n.length;i.values=new Array(s);for(var u=0;u<s;u++)i.toRespond.push(u);for(u=0;u<s;u++){var c=n[u];i.add((0,r.subscribeToResult)(i,c,c,u))}return i}return t.__extends(n,e),n.prototype.notifyNext=function(t,e,r,n,o){this.values[r]=e;var i=this.toRespond;if(i.length>0){var s=i.indexOf(r);-1!==s&&i.splice(s,1)}},n.prototype.notifyComplete=function(){},n.prototype._next=function(t){if(0===this.toRespond.length){var e=[t].concat(this.values);this.project?this._tryProject(e):this.destination.next(e)}},n.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(r){return void this.destination.error(r)}this.destination.next(e)},n}(e.OuterSubscriber);
},{"tslib":"vCxL","../OuterSubscriber":"hZYI","../util/subscribeToResult":"JM7e"}],"UwLD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.zip=r;var e=require("../observable/zip");function r(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return function(t){return t.lift.call(e.zip.apply(void 0,[t].concat(r)))}}
},{"../observable/zip":"ff2A"}],"DmwP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.zipAll=r;var e=require("../observable/zip");function r(r){return function(t){return t.lift(new e.ZipOperator(r))}}
},{"../observable/zip":"ff2A"}],"cVrl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"audit",{enumerable:!0,get:function(){return e.audit}}),Object.defineProperty(exports,"auditTime",{enumerable:!0,get:function(){return r.auditTime}}),Object.defineProperty(exports,"buffer",{enumerable:!0,get:function(){return t.buffer}}),Object.defineProperty(exports,"bufferCount",{enumerable:!0,get:function(){return n.bufferCount}}),Object.defineProperty(exports,"bufferTime",{enumerable:!0,get:function(){return o.bufferTime}}),Object.defineProperty(exports,"bufferToggle",{enumerable:!0,get:function(){return i.bufferToggle}}),Object.defineProperty(exports,"bufferWhen",{enumerable:!0,get:function(){return u.bufferWhen}}),Object.defineProperty(exports,"catchError",{enumerable:!0,get:function(){return a.catchError}}),Object.defineProperty(exports,"combineAll",{enumerable:!0,get:function(){return p.combineAll}}),Object.defineProperty(exports,"combineLatest",{enumerable:!0,get:function(){return l.combineLatest}}),Object.defineProperty(exports,"concat",{enumerable:!0,get:function(){return s.concat}}),Object.defineProperty(exports,"concatAll",{enumerable:!0,get:function(){return c.concatAll}}),Object.defineProperty(exports,"concatMap",{enumerable:!0,get:function(){return f.concatMap}}),Object.defineProperty(exports,"concatMapTo",{enumerable:!0,get:function(){return b.concatMapTo}}),Object.defineProperty(exports,"count",{enumerable:!0,get:function(){return m.count}}),Object.defineProperty(exports,"debounce",{enumerable:!0,get:function(){return d.debounce}}),Object.defineProperty(exports,"debounceTime",{enumerable:!0,get:function(){return g.debounceTime}}),Object.defineProperty(exports,"defaultIfEmpty",{enumerable:!0,get:function(){return y.defaultIfEmpty}}),Object.defineProperty(exports,"delay",{enumerable:!0,get:function(){return x.delay}}),Object.defineProperty(exports,"delayWhen",{enumerable:!0,get:function(){return O.delayWhen}}),Object.defineProperty(exports,"dematerialize",{enumerable:!0,get:function(){return q.dematerialize}}),Object.defineProperty(exports,"distinct",{enumerable:!0,get:function(){return j.distinct}}),Object.defineProperty(exports,"distinctUntilChanged",{enumerable:!0,get:function(){return P.distinctUntilChanged}}),Object.defineProperty(exports,"distinctUntilKeyChanged",{enumerable:!0,get:function(){return h.distinctUntilKeyChanged}}),Object.defineProperty(exports,"elementAt",{enumerable:!0,get:function(){return w.elementAt}}),Object.defineProperty(exports,"endWith",{enumerable:!0,get:function(){return T.endWith}}),Object.defineProperty(exports,"every",{enumerable:!0,get:function(){return W.every}}),Object.defineProperty(exports,"exhaust",{enumerable:!0,get:function(){return k.exhaust}}),Object.defineProperty(exports,"exhaustMap",{enumerable:!0,get:function(){return M.exhaustMap}}),Object.defineProperty(exports,"expand",{enumerable:!0,get:function(){return A.expand}}),Object.defineProperty(exports,"filter",{enumerable:!0,get:function(){return E.filter}}),Object.defineProperty(exports,"finalize",{enumerable:!0,get:function(){return z.finalize}}),Object.defineProperty(exports,"find",{enumerable:!0,get:function(){return C.find}}),Object.defineProperty(exports,"findIndex",{enumerable:!0,get:function(){return L.findIndex}}),Object.defineProperty(exports,"first",{enumerable:!0,get:function(){return v.first}}),Object.defineProperty(exports,"groupBy",{enumerable:!0,get:function(){return I.groupBy}}),Object.defineProperty(exports,"ignoreElements",{enumerable:!0,get:function(){return U.ignoreElements}}),Object.defineProperty(exports,"isEmpty",{enumerable:!0,get:function(){return R.isEmpty}}),Object.defineProperty(exports,"last",{enumerable:!0,get:function(){return B.last}}),Object.defineProperty(exports,"map",{enumerable:!0,get:function(){return F.map}}),Object.defineProperty(exports,"mapTo",{enumerable:!0,get:function(){return K.mapTo}}),Object.defineProperty(exports,"materialize",{enumerable:!0,get:function(){return N.materialize}}),Object.defineProperty(exports,"max",{enumerable:!0,get:function(){return S.max}}),Object.defineProperty(exports,"merge",{enumerable:!0,get:function(){return _.merge}}),Object.defineProperty(exports,"mergeAll",{enumerable:!0,get:function(){return D.mergeAll}}),Object.defineProperty(exports,"mergeMap",{enumerable:!0,get:function(){return G.mergeMap}}),Object.defineProperty(exports,"flatMap",{enumerable:!0,get:function(){return G.mergeMap}}),Object.defineProperty(exports,"mergeMapTo",{enumerable:!0,get:function(){return H.mergeMapTo}}),Object.defineProperty(exports,"mergeScan",{enumerable:!0,get:function(){return J.mergeScan}}),Object.defineProperty(exports,"min",{enumerable:!0,get:function(){return Q.min}}),Object.defineProperty(exports,"multicast",{enumerable:!0,get:function(){return V.multicast}}),Object.defineProperty(exports,"observeOn",{enumerable:!0,get:function(){return X.observeOn}}),Object.defineProperty(exports,"onErrorResumeNext",{enumerable:!0,get:function(){return Y.onErrorResumeNext}}),Object.defineProperty(exports,"pairwise",{enumerable:!0,get:function(){return Z.pairwise}}),Object.defineProperty(exports,"partition",{enumerable:!0,get:function(){return $.partition}}),Object.defineProperty(exports,"pluck",{enumerable:!0,get:function(){return ee.pluck}}),Object.defineProperty(exports,"publish",{enumerable:!0,get:function(){return re.publish}}),Object.defineProperty(exports,"publishBehavior",{enumerable:!0,get:function(){return te.publishBehavior}}),Object.defineProperty(exports,"publishLast",{enumerable:!0,get:function(){return ne.publishLast}}),Object.defineProperty(exports,"publishReplay",{enumerable:!0,get:function(){return oe.publishReplay}}),Object.defineProperty(exports,"race",{enumerable:!0,get:function(){return ie.race}}),Object.defineProperty(exports,"reduce",{enumerable:!0,get:function(){return ue.reduce}}),Object.defineProperty(exports,"repeat",{enumerable:!0,get:function(){return ae.repeat}}),Object.defineProperty(exports,"repeatWhen",{enumerable:!0,get:function(){return pe.repeatWhen}}),Object.defineProperty(exports,"retry",{enumerable:!0,get:function(){return le.retry}}),Object.defineProperty(exports,"retryWhen",{enumerable:!0,get:function(){return se.retryWhen}}),Object.defineProperty(exports,"refCount",{enumerable:!0,get:function(){return ce.refCount}}),Object.defineProperty(exports,"sample",{enumerable:!0,get:function(){return fe.sample}}),Object.defineProperty(exports,"sampleTime",{enumerable:!0,get:function(){return be.sampleTime}}),Object.defineProperty(exports,"scan",{enumerable:!0,get:function(){return me.scan}}),Object.defineProperty(exports,"sequenceEqual",{enumerable:!0,get:function(){return de.sequenceEqual}}),Object.defineProperty(exports,"share",{enumerable:!0,get:function(){return ge.share}}),Object.defineProperty(exports,"shareReplay",{enumerable:!0,get:function(){return ye.shareReplay}}),Object.defineProperty(exports,"single",{enumerable:!0,get:function(){return xe.single}}),Object.defineProperty(exports,"skip",{enumerable:!0,get:function(){return Oe.skip}}),Object.defineProperty(exports,"skipLast",{enumerable:!0,get:function(){return qe.skipLast}}),Object.defineProperty(exports,"skipUntil",{enumerable:!0,get:function(){return je.skipUntil}}),Object.defineProperty(exports,"skipWhile",{enumerable:!0,get:function(){return Pe.skipWhile}}),Object.defineProperty(exports,"startWith",{enumerable:!0,get:function(){return he.startWith}}),Object.defineProperty(exports,"subscribeOn",{enumerable:!0,get:function(){return we.subscribeOn}}),Object.defineProperty(exports,"switchAll",{enumerable:!0,get:function(){return Te.switchAll}}),Object.defineProperty(exports,"switchMap",{enumerable:!0,get:function(){return We.switchMap}}),Object.defineProperty(exports,"switchMapTo",{enumerable:!0,get:function(){return ke.switchMapTo}}),Object.defineProperty(exports,"take",{enumerable:!0,get:function(){return Me.take}}),Object.defineProperty(exports,"takeLast",{enumerable:!0,get:function(){return Ae.takeLast}}),Object.defineProperty(exports,"takeUntil",{enumerable:!0,get:function(){return Ee.takeUntil}}),Object.defineProperty(exports,"takeWhile",{enumerable:!0,get:function(){return ze.takeWhile}}),Object.defineProperty(exports,"tap",{enumerable:!0,get:function(){return Ce.tap}}),Object.defineProperty(exports,"throttle",{enumerable:!0,get:function(){return Le.throttle}}),Object.defineProperty(exports,"throttleTime",{enumerable:!0,get:function(){return ve.throttleTime}}),Object.defineProperty(exports,"throwIfEmpty",{enumerable:!0,get:function(){return Ie.throwIfEmpty}}),Object.defineProperty(exports,"timeInterval",{enumerable:!0,get:function(){return Ue.timeInterval}}),Object.defineProperty(exports,"timeout",{enumerable:!0,get:function(){return Re.timeout}}),Object.defineProperty(exports,"timeoutWith",{enumerable:!0,get:function(){return Be.timeoutWith}}),Object.defineProperty(exports,"timestamp",{enumerable:!0,get:function(){return Fe.timestamp}}),Object.defineProperty(exports,"toArray",{enumerable:!0,get:function(){return Ke.toArray}}),Object.defineProperty(exports,"window",{enumerable:!0,get:function(){return Ne.window}}),Object.defineProperty(exports,"windowCount",{enumerable:!0,get:function(){return Se.windowCount}}),Object.defineProperty(exports,"windowTime",{enumerable:!0,get:function(){return _e.windowTime}}),Object.defineProperty(exports,"windowToggle",{enumerable:!0,get:function(){return De.windowToggle}}),Object.defineProperty(exports,"windowWhen",{enumerable:!0,get:function(){return Ge.windowWhen}}),Object.defineProperty(exports,"withLatestFrom",{enumerable:!0,get:function(){return He.withLatestFrom}}),Object.defineProperty(exports,"zip",{enumerable:!0,get:function(){return Je.zip}}),Object.defineProperty(exports,"zipAll",{enumerable:!0,get:function(){return Qe.zipAll}});var e=require("../internal/operators/audit"),r=require("../internal/operators/auditTime"),t=require("../internal/operators/buffer"),n=require("../internal/operators/bufferCount"),o=require("../internal/operators/bufferTime"),i=require("../internal/operators/bufferToggle"),u=require("../internal/operators/bufferWhen"),a=require("../internal/operators/catchError"),p=require("../internal/operators/combineAll"),l=require("../internal/operators/combineLatest"),s=require("../internal/operators/concat"),c=require("../internal/operators/concatAll"),f=require("../internal/operators/concatMap"),b=require("../internal/operators/concatMapTo"),m=require("../internal/operators/count"),d=require("../internal/operators/debounce"),g=require("../internal/operators/debounceTime"),y=require("../internal/operators/defaultIfEmpty"),x=require("../internal/operators/delay"),O=require("../internal/operators/delayWhen"),q=require("../internal/operators/dematerialize"),j=require("../internal/operators/distinct"),P=require("../internal/operators/distinctUntilChanged"),h=require("../internal/operators/distinctUntilKeyChanged"),w=require("../internal/operators/elementAt"),T=require("../internal/operators/endWith"),W=require("../internal/operators/every"),k=require("../internal/operators/exhaust"),M=require("../internal/operators/exhaustMap"),A=require("../internal/operators/expand"),E=require("../internal/operators/filter"),z=require("../internal/operators/finalize"),C=require("../internal/operators/find"),L=require("../internal/operators/findIndex"),v=require("../internal/operators/first"),I=require("../internal/operators/groupBy"),U=require("../internal/operators/ignoreElements"),R=require("../internal/operators/isEmpty"),B=require("../internal/operators/last"),F=require("../internal/operators/map"),K=require("../internal/operators/mapTo"),N=require("../internal/operators/materialize"),S=require("../internal/operators/max"),_=require("../internal/operators/merge"),D=require("../internal/operators/mergeAll"),G=require("../internal/operators/mergeMap"),H=require("../internal/operators/mergeMapTo"),J=require("../internal/operators/mergeScan"),Q=require("../internal/operators/min"),V=require("../internal/operators/multicast"),X=require("../internal/operators/observeOn"),Y=require("../internal/operators/onErrorResumeNext"),Z=require("../internal/operators/pairwise"),$=require("../internal/operators/partition"),ee=require("../internal/operators/pluck"),re=require("../internal/operators/publish"),te=require("../internal/operators/publishBehavior"),ne=require("../internal/operators/publishLast"),oe=require("../internal/operators/publishReplay"),ie=require("../internal/operators/race"),ue=require("../internal/operators/reduce"),ae=require("../internal/operators/repeat"),pe=require("../internal/operators/repeatWhen"),le=require("../internal/operators/retry"),se=require("../internal/operators/retryWhen"),ce=require("../internal/operators/refCount"),fe=require("../internal/operators/sample"),be=require("../internal/operators/sampleTime"),me=require("../internal/operators/scan"),de=require("../internal/operators/sequenceEqual"),ge=require("../internal/operators/share"),ye=require("../internal/operators/shareReplay"),xe=require("../internal/operators/single"),Oe=require("../internal/operators/skip"),qe=require("../internal/operators/skipLast"),je=require("../internal/operators/skipUntil"),Pe=require("../internal/operators/skipWhile"),he=require("../internal/operators/startWith"),we=require("../internal/operators/subscribeOn"),Te=require("../internal/operators/switchAll"),We=require("../internal/operators/switchMap"),ke=require("../internal/operators/switchMapTo"),Me=require("../internal/operators/take"),Ae=require("../internal/operators/takeLast"),Ee=require("../internal/operators/takeUntil"),ze=require("../internal/operators/takeWhile"),Ce=require("../internal/operators/tap"),Le=require("../internal/operators/throttle"),ve=require("../internal/operators/throttleTime"),Ie=require("../internal/operators/throwIfEmpty"),Ue=require("../internal/operators/timeInterval"),Re=require("../internal/operators/timeout"),Be=require("../internal/operators/timeoutWith"),Fe=require("../internal/operators/timestamp"),Ke=require("../internal/operators/toArray"),Ne=require("../internal/operators/window"),Se=require("../internal/operators/windowCount"),_e=require("../internal/operators/windowTime"),De=require("../internal/operators/windowToggle"),Ge=require("../internal/operators/windowWhen"),He=require("../internal/operators/withLatestFrom"),Je=require("../internal/operators/zip"),Qe=require("../internal/operators/zipAll");
},{"../internal/operators/audit":"Pdg2","../internal/operators/auditTime":"jcYn","../internal/operators/buffer":"mG6b","../internal/operators/bufferCount":"f9IP","../internal/operators/bufferTime":"Axj2","../internal/operators/bufferToggle":"ZTTP","../internal/operators/bufferWhen":"Ul3A","../internal/operators/catchError":"THoY","../internal/operators/combineAll":"TMFF","../internal/operators/combineLatest":"DJQm","../internal/operators/concat":"ZHmI","../internal/operators/concatAll":"Yxey","../internal/operators/concatMap":"DoUK","../internal/operators/concatMapTo":"APQq","../internal/operators/count":"U1Ln","../internal/operators/debounce":"y9EZ","../internal/operators/debounceTime":"KBFO","../internal/operators/defaultIfEmpty":"YBdz","../internal/operators/delay":"zkgx","../internal/operators/delayWhen":"iVuv","../internal/operators/dematerialize":"v6b5","../internal/operators/distinct":"H608","../internal/operators/distinctUntilChanged":"hFX7","../internal/operators/distinctUntilKeyChanged":"Egbr","../internal/operators/elementAt":"TbZV","../internal/operators/endWith":"loee","../internal/operators/every":"eEZZ","../internal/operators/exhaust":"ifNj","../internal/operators/exhaustMap":"DGWU","../internal/operators/expand":"iYcS","../internal/operators/filter":"HKzi","../internal/operators/finalize":"x5qu","../internal/operators/find":"t6rP","../internal/operators/findIndex":"GIlo","../internal/operators/first":"f9sd","../internal/operators/groupBy":"dNgG","../internal/operators/ignoreElements":"P82l","../internal/operators/isEmpty":"LqVv","../internal/operators/last":"xu0X","../internal/operators/map":"dNh5","../internal/operators/mapTo":"yJbZ","../internal/operators/materialize":"ZwCH","../internal/operators/max":"BgD2","../internal/operators/merge":"sbfV","../internal/operators/mergeAll":"Nkv4","../internal/operators/mergeMap":"nFsM","../internal/operators/mergeMapTo":"S3q6","../internal/operators/mergeScan":"wQne","../internal/operators/min":"bAWd","../internal/operators/multicast":"M6Em","../internal/operators/observeOn":"ezNs","../internal/operators/onErrorResumeNext":"S4UH","../internal/operators/pairwise":"u6OS","../internal/operators/partition":"jvG2","../internal/operators/pluck":"TdE4","../internal/operators/publish":"TQAB","../internal/operators/publishBehavior":"fUyM","../internal/operators/publishLast":"fQ7S","../internal/operators/publishReplay":"aqWk","../internal/operators/race":"EAaA","../internal/operators/reduce":"BORG","../internal/operators/repeat":"Fbxf","../internal/operators/repeatWhen":"CT9q","../internal/operators/retry":"ZHEI","../internal/operators/retryWhen":"GHe2","../internal/operators/refCount":"vT9o","../internal/operators/sample":"Rd9o","../internal/operators/sampleTime":"nb45","../internal/operators/scan":"U785","../internal/operators/sequenceEqual":"PMGC","../internal/operators/share":"KBGh","../internal/operators/shareReplay":"xsrM","../internal/operators/single":"angX","../internal/operators/skip":"vMIz","../internal/operators/skipLast":"iB53","../internal/operators/skipUntil":"xmsT","../internal/operators/skipWhile":"qjDA","../internal/operators/startWith":"doo6","../internal/operators/subscribeOn":"Et1l","../internal/operators/switchAll":"CBg8","../internal/operators/switchMap":"g5Rk","../internal/operators/switchMapTo":"Hs9S","../internal/operators/take":"JVEz","../internal/operators/takeLast":"FbHg","../internal/operators/takeUntil":"qGSv","../internal/operators/takeWhile":"EYJX","../internal/operators/tap":"okAI","../internal/operators/throttle":"Yoo8","../internal/operators/throttleTime":"v3FQ","../internal/operators/throwIfEmpty":"D7Ma","../internal/operators/timeInterval":"n6SK","../internal/operators/timeout":"Cp8V","../internal/operators/timeoutWith":"L72b","../internal/operators/timestamp":"pXuq","../internal/operators/toArray":"LA40","../internal/operators/window":"Iygx","../internal/operators/windowCount":"GYT2","../internal/operators/windowTime":"Okss","../internal/operators/windowToggle":"JiQj","../internal/operators/windowWhen":"YaG1","../internal/operators/withLatestFrom":"JDwQ","../internal/operators/zip":"UwLD","../internal/operators/zipAll":"DmwP"}],"f2sD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__extends=e,exports.__rest=n,exports.__decorate=o,exports.__param=a,exports.__metadata=i,exports.__awaiter=u,exports.__generator=c,exports.__createBinding=f,exports.__exportStar=l,exports.__values=s,exports.__read=p,exports.__spread=y,exports.__spreadArrays=_,exports.__await=h,exports.__asyncGenerator=v,exports.__asyncDelegator=d,exports.__asyncValues=b,exports.__makeTemplateObject=w,exports.__importStar=x,exports.__importDefault=m,exports.__classPrivateFieldGet=O,exports.__classPrivateFieldSet=g,exports.__assign=void 0;var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return exports.__assign=r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)};function n(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}function o(t,e,r,n){var o,a=arguments.length,i=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(i=(a<3?o(i):a>3?o(e,r,i):o(e,r))||i);return a>3&&i&&Object.defineProperty(e,r,i),i}function a(t,e){return function(r,n){e(r,n,t)}}function i(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function u(t,e,r,n){return new(r||(r=Promise))(function(o,a){function i(t){try{c(n.next(t))}catch(e){a(e)}}function u(t){try{c(n.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(i,u)}c((n=n.apply(t,e||[])).next())})}function c(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(u){a=[6,u],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function f(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}function l(t,e){for(var r in t)"default"===r||e.hasOwnProperty(r)||(e[r]=t[r])}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}function _(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var a=arguments[e],i=0,u=a.length;i<u;i++,o++)n[o]=a[i];return n}function h(t){return this instanceof h?(this.v=t,this):new h(t)}function v(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(t,e||[]),a=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(t){o[t]&&(n[t]=function(e){return new Promise(function(r,n){a.push([t,e,r,n])>1||u(t,e)})})}function u(t,e){try{(r=o[t](e)).value instanceof h?Promise.resolve(r.value.v).then(c,f):l(a[0][2],r)}catch(n){l(a[0][3],n)}var r}function c(t){u("next",t)}function f(t){u("throw",t)}function l(t,e){t(e),a.shift(),a.length&&u(a[0][0],a[0][1])}}function d(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,o){e[n]=t[n]?function(e){return(r=!r)?{value:h(t[n](e)),done:"return"===n}:o?o(e):e}:o}}function b(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof s?s(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,o){(function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)})(n,o,(e=t[r](e)).done,e.value)})}}}function w(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function x(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function m(t){return t&&t.__esModule?t:{default:t}}function O(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function g(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}exports.__assign=r;
},{}],"xA6u":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),r={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},o=function(t,e){if(!t)throw n(e)},n=function(t){return new Error("Firebase Database ("+r.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},i=function(t){for(var e=[],r=0,o=0;o<t.length;o++){var n=t.charCodeAt(o);n<128?e[r++]=n:n<2048?(e[r++]=n>>6|192,e[r++]=63&n|128):55296==(64512&n)&&o+1<t.length&&56320==(64512&t.charCodeAt(o+1))?(n=65536+((1023&n)<<10)+(1023&t.charCodeAt(++o)),e[r++]=n>>18|240,e[r++]=n>>12&63|128,e[r++]=n>>6&63|128,e[r++]=63&n|128):(e[r++]=n>>12|224,e[r++]=n>>6&63|128,e[r++]=63&n|128)}return e},s=function(t){for(var e=[],r=0,o=0;r<t.length;){var n=t[r++];if(n<128)e[o++]=String.fromCharCode(n);else if(n>191&&n<224){var i=t[r++];e[o++]=String.fromCharCode((31&n)<<6|63&i)}else if(n>239&&n<365){var s=((7&n)<<18|(63&(i=t[r++]))<<12|(63&(a=t[r++]))<<6|63&t[r++])-65536;e[o++]=String.fromCharCode(55296+(s>>10)),e[o++]=String.fromCharCode(56320+(1023&s))}else{i=t[r++];var a=t[r++];e[o++]=String.fromCharCode((15&n)<<12|(63&i)<<6|63&a)}}return e.join("")},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[],n=0;n<t.length;n+=3){var i=t[n],s=n+1<t.length,a=s?t[n+1]:0,c=n+2<t.length,h=c?t[n+2]:0,u=i>>2,f=(3&i)<<4|a>>4,p=(15&a)<<2|h>>6,l=63&h;c||(l=64,s||(p=64)),o.push(r[u],r[f],r[p],r[l])}return o.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(i(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):s(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var r=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[],n=0;n<t.length;){var i=r[t.charAt(n++)],s=n<t.length?r[t.charAt(n)]:0,a=++n<t.length?r[t.charAt(n)]:64,c=++n<t.length?r[t.charAt(n)]:64;if(++n,null==i||null==s||null==a||null==c)throw Error();var h=i<<2|s>>4;if(o.push(h),64!==a){var u=s<<4&240|a>>2;if(o.push(u),64!==c){var f=a<<6&192|c;o.push(f)}}}return o},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},c=function(t){var e=i(t);return a.encodeByteArray(e,!0)},h=function(t){try{return a.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(t){return f(void 0,t)}function f(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var r in e)e.hasOwnProperty(r)&&(t[r]=f(t[r],e[r]));return t}var p=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,r){t.resolve=e,t.reject=r})}return t.prototype.wrapCallback=function(t){var e=this;return function(r,o){r?e.reject(r):e.resolve(o),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(r):t(r,o))}},t}();function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function d(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())}function v(){try{return"[object process]"===Object.prototype.toString.call(t.process)}catch(e){return!1}}function b(){return"object"==typeof self&&self.self===self}function y(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function _(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function E(){return l().indexOf("Electron/")>=0}function g(){var t=l();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function x(){return l().indexOf("MSAppHost/")>=0}function S(){return!0===r.NODE_CLIENT||!0===r.NODE_ADMIN}function A(){return!v()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function m(){return"indexedDB"in self&&null!=indexedDB}function O(){return new Promise(function(t,e){try{var r=!0,o="validate-browser-context-for-indexeddb-analytics-module",n=window.indexedDB.open(o);n.onsuccess=function(){n.result.close(),r||window.indexedDB.deleteDatabase(o),t(!0)},n.onupgradeneeded=function(){r=!1},n.onerror=function(){var t;e((null===(t=n.error)||void 0===t?void 0:t.message)||"")}}catch(i){e(i)}})}function C(){return!(!navigator||!navigator.cookieEnabled)}var w="FirebaseError",D=function(t){function r(e,o){var n=t.call(this,o)||this;return n.code=e,n.name=w,Object.setPrototypeOf(n,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,N.prototype.create),n}return e.__extends(r,t),r}(Error),N=function(){function t(t,e,r){this.service=t,this.serviceName=e,this.errors=r}return t.prototype.create=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var o=e[0]||{},n=this.service+"/"+t,i=this.errors[t],s=i?T(i,o):"Error",a=this.serviceName+": "+s+" ("+n+").",c=new D(n,a),h=0,u=Object.keys(o);h<u.length;h++){var f=u[h];"_"!==f.slice(-1)&&(f in c&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),c[f]=o[f])}return c},t}();function T(t,e){return t.replace(M,function(t,r){var o=e[r];return null!=o?String(o):"<"+r+"?>"})}var M=/\{\$([^}]+)}/g;function B(t){return JSON.parse(t)}function j(t){return JSON.stringify(t)}var k=function(t){var e={},r={},o={},n="";try{var i=t.split(".");e=B(h(i[0])||""),r=B(h(i[1])||""),n=i[2],o=r.d||{},delete r.d}catch(s){}return{header:e,claims:r,data:o,signature:n}},P=function(t){var e=k(t).claims,r=Math.floor((new Date).getTime()/1e3),o=0,n=0;return"object"==typeof e&&(e.hasOwnProperty("nbf")?o=e.nbf:e.hasOwnProperty("iat")&&(o=e.iat),n=e.hasOwnProperty("exp")?e.exp:o+86400),!!r&&!!o&&!!n&&r>=o&&r<=n},I=function(t){var e=k(t).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null},V=function(t){var e=k(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")},L=function(t){var e=k(t).claims;return"object"==typeof e&&!0===e.admin};function R(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function W(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function z(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function F(t,e,r){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(o[n]=e.call(r,t[n],n,t));return o}function U(t){for(var e=[],r=function(t,r){Array.isArray(r)?r.forEach(function(r){e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))},o=0,n=Object.entries(t);o<n.length;o++){var i=n[o];r(i[0],i[1])}return e.length?"&"+e.join("&"):""}function H(t){var e={};return t.replace(/^\?/,"").split("&").forEach(function(t){if(t){var r=t.split("=");e[r[0]]=r[1]}}),e}var q=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var r=this.W_;if("string"==typeof t)for(var o=0;o<16;o++)r[o]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(o=0;o<16;o++)r[o]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(o=16;o<80;o++){var n=r[o-3]^r[o-8]^r[o-14]^r[o-16];r[o]=4294967295&(n<<1|n>>>31)}var i,s,a=this.chain_[0],c=this.chain_[1],h=this.chain_[2],u=this.chain_[3],f=this.chain_[4];for(o=0;o<80;o++){o<40?o<20?(i=u^c&(h^u),s=1518500249):(i=c^h^u,s=1859775393):o<60?(i=c&h|u&(c|h),s=2400959708):(i=c^h^u,s=3395469782);n=(a<<5|a>>>27)+i+f+s+r[o]&4294967295;f=u,u=h,h=4294967295&(c<<30|c>>>2),c=a,a=n}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+h&4294967295,this.chain_[3]=this.chain_[3]+u&4294967295,this.chain_[4]=this.chain_[4]+f&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var r=e-this.blockSize,o=0,n=this.buf_,i=this.inbuf_;o<e;){if(0===i)for(;o<=r;)this.compress_(t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(n[i]=t.charCodeAt(o),++o,++i===this.blockSize){this.compress_(n),i=0;break}}else for(;o<e;)if(n[i]=t[o],++o,++i===this.blockSize){this.compress_(n),i=0;break}}this.inbuf_=i,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&e,e/=256;this.compress_(this.buf_);var o=0;for(r=0;r<5;r++)for(var n=24;n>=0;n-=8)t[o]=this.chain_[r]>>n&255,++o;return t},t}();function J(t,e){var r=new G(t,e);return r.subscribe.bind(r)}var G=function(){function t(t,e){var r=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(r)}).catch(function(t){r.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,r){var o,n=this;if(void 0===t&&void 0===e&&void 0===r)throw new Error("Missing Observer.");void 0===(o=X(t,["next","error","complete"])?t:{next:t,error:e,complete:r}).next&&(o.next=$),void 0===o.error&&(o.error=$),void 0===o.complete&&(o.complete=$);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{n.finalError?o.error(n.finalError):o.complete()}catch(t){}}),this.observers.push(o),i},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var r=this;this.task.then(function(){if(void 0!==r.observers&&void 0!==r.observers[t])try{e(r.observers[t])}catch(o){"undefined"!=typeof console&&console.error&&console.error(o)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function K(t,e){return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];Promise.resolve(!0).then(function(){t.apply(void 0,r)}).catch(function(t){e&&e(t)})}}function X(t,e){if("object"!=typeof t||null===t)return!1;for(var r=0,o=e;r<o.length;r++){var n=o[r];if(n in t&&"function"==typeof t[n])return!0}return!1}function $(){}var Q=function(t,e,r,o){var n;if(o<e?n="at least "+e:o>r&&(n=0===r?"none":"no more than "+r),n)throw new Error(t+" failed: Was called with "+o+(1===o?" argument.":" arguments.")+" Expects "+n+".")};function Y(t,e,r){var o="";switch(e){case 1:o=r?"first":"First";break;case 2:o=r?"second":"Second";break;case 3:o=r?"third":"Third";break;case 4:o=r?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var n=t+" failed: ";return n+=o+" argument "}function Z(t,e,r,o){if((!o||r)&&"string"!=typeof r)throw new Error(Y(t,e,o)+"must be a valid firebase namespace.")}function tt(t,e,r,o){if((!o||r)&&"function"!=typeof r)throw new Error(Y(t,e,o)+"must be a valid function.")}function et(t,e,r,o){if((!o||r)&&("object"!=typeof r||null===r))throw new Error(Y(t,e,o)+"must be a valid context object.")}var rt=function(t){for(var e=[],r=0,n=0;n<t.length;n++){var i=t.charCodeAt(n);if(i>=55296&&i<=56319){var s=i-55296;o(++n<t.length,"Surrogate pair missing trail surrogate."),i=65536+(s<<10)+(t.charCodeAt(n)-56320)}i<128?e[r++]=i:i<2048?(e[r++]=i>>6|192,e[r++]=63&i|128):i<65536?(e[r++]=i>>12|224,e[r++]=i>>6&63|128,e[r++]=63&i|128):(e[r++]=i>>18|240,e[r++]=i>>12&63|128,e[r++]=i>>6&63|128,e[r++]=63&i|128)}return e},ot=function(t){for(var e=0,r=0;r<t.length;r++){var o=t.charCodeAt(r);o<128?e++:o<2048?e+=2:o>=55296&&o<=56319?(e+=4,r++):e+=3}return e},nt=1e3,it=2,st=144e5,at=.5;function ct(t,e,r){void 0===e&&(e=nt),void 0===r&&(r=it);var o=e*Math.pow(r,t),n=Math.round(at*o*(Math.random()-.5)*2);return Math.min(st,o+n)}exports.CONSTANTS=r,exports.Deferred=p,exports.ErrorFactory=N,exports.FirebaseError=D,exports.MAX_VALUE_MILLIS=st,exports.RANDOM_FACTOR=at,exports.Sha1=q,exports.areCookiesEnabled=C,exports.assert=o,exports.assertionError=n,exports.async=K,exports.base64=a,exports.base64Decode=h,exports.base64Encode=c,exports.calculateBackoffMillis=ct,exports.contains=R,exports.createSubscribe=J,exports.decode=k,exports.deepCopy=u,exports.deepExtend=f,exports.errorPrefix=Y,exports.getUA=l,exports.isAdmin=L,exports.isBrowser=b,exports.isBrowserExtension=y,exports.isElectron=E,exports.isEmpty=z,exports.isIE=g,exports.isIndexedDBAvailable=m,exports.isMobileCordova=d,exports.isNode=v,exports.isNodeSdk=S,exports.isReactNative=_,exports.isSafari=A,exports.isUWP=x,exports.isValidFormat=V,exports.isValidTimestamp=P,exports.issuedAtTime=I,exports.jsonEval=B,exports.map=F,exports.querystring=U,exports.querystringDecode=H,exports.safeGet=W,exports.stringLength=ot,exports.stringToByteArray=rt,exports.stringify=j,exports.validateArgCount=Q,exports.validateCallback=tt,exports.validateContextObject=et,exports.validateIndexedDBOpenable=O,exports.validateNamespace=Z;
},{"tslib":"f2sD"}],"nzQs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("tslib"),e=require("@firebase/util"),n=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),r="[DEFAULT]",i=function(){function n(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return n.prototype.get=function(t){void 0===t&&(t=r);var n=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(n)){var i=new e.Deferred;this.instancesDeferred.set(n,i);try{var o=this.getOrInitializeService(n);o&&i.resolve(o)}catch(s){}}return this.instancesDeferred.get(n).promise},n.prototype.getImmediate=function(e){var n=t.__assign({identifier:r,optional:!1},e),i=n.identifier,o=n.optional,s=this.normalizeInstanceIdentifier(i);try{var a=this.getOrInitializeService(s);if(!a){if(o)return null;throw Error("Service "+this.name+" is not available")}return a}catch(c){if(o)return null;throw c}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(e){var n,i;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,s(e))try{this.getOrInitializeService(r)}catch(l){}try{for(var o=t.__values(this.instancesDeferred.entries()),a=o.next();!a.done;a=o.next()){var c=t.__read(a.value,2),p=c[0],h=c[1],u=this.normalizeInstanceIdentifier(p);try{var f=this.getOrInitializeService(u);h.resolve(f)}catch(l){}}}catch(d){n={error:d}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},n.prototype.clearInstance=function(t){void 0===t&&(t=r),this.instancesDeferred.delete(t),this.instances.delete(t)},n.prototype.delete=function(){return t.__awaiter(this,void 0,void 0,function(){var e;return t.__generator(this,function(n){switch(n.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all(t.__spread(e.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}),e.filter(function(t){return"_delete"in t}).map(function(t){return t._delete()})))];case 1:return n.sent(),[2]}})})},n.prototype.isComponentSet=function(){return null!=this.component},n.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,o(t)),this.instances.set(t,e)),e||null},n.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:r:t},n}();function o(t){return t===r?void 0:t}function s(t){return"EAGER"===t.instantiationMode}var a=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new i(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();exports.Component=n,exports.ComponentContainer=a,exports.Provider=i;
},{"tslib":"f2sD","@firebase/util":"xA6u"}],"TUpU":[function(require,module,exports) {
"use strict";function e(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),n=0;for(t=0;t<r;t++)for(var l=arguments[t],i=0,s=l.length;i<s;i++,n++)o[n]=l[i];return o}var t;Object.defineProperty(exports,"__esModule",{value:!0}),exports.setLogLevel=g,exports.setUserLogHandler=u,exports.Logger=exports.LogLevel=void 0;var r,o=[];exports.LogLevel=r,function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(exports.LogLevel=r={}));var n={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},l=r.INFO,i=((t={})[r.DEBUG]="log",t[r.VERBOSE]="log",t[r.INFO]="info",t[r.WARN]="warn",t[r.ERROR]="error",t),s=function(t,r){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];if(!(r<t.logLevel)){var l=(new Date).toISOString(),s=i[r];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+r+")");console[s].apply(console,e(["["+l+"]  "+t.name+":"],o))}},a=function(){function t(e){this.name=e,this._logLevel=l,this._logHandler=s,this._userLogHandler=null,o.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in r))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?n[e]:e},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.DEBUG],t)),this._logHandler.apply(this,e([this,r.DEBUG],t))},t.prototype.log=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.VERBOSE],t)),this._logHandler.apply(this,e([this,r.VERBOSE],t))},t.prototype.info=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.INFO],t)),this._logHandler.apply(this,e([this,r.INFO],t))},t.prototype.warn=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.WARN],t)),this._logHandler.apply(this,e([this,r.WARN],t))},t.prototype.error=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.ERROR],t)),this._logHandler.apply(this,e([this,r.ERROR],t))},t}();function g(e){o.forEach(function(t){t.setLogLevel(e)})}function u(e,t){for(var l=function(o){var l=null;t&&t.level&&(l=n[t.level]),o.userLogHandler=null===e?null:function(t,o){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var s=n.map(function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}}).filter(function(e){return e}).join(" ");o>=(null!=l?l:t.logLevel)&&e({level:r[o].toLowerCase(),message:s,args:n,type:t.name})}},i=0,s=o;i<s.length;i++){l(s[i])}}exports.Logger=a;
},{}],"dP58":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,n,r=require("tslib"),t=require("@firebase/util"),i=require("@firebase/component"),a=require("@firebase/logger"),o=((e={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),s=new t.ErrorFactory("app","Firebase",o),p="@firebase/app",l="0.6.11",c="@firebase/analytics",u="@firebase/auth",f="@firebase/database",d="@firebase/functions",m="@firebase/installations",b="@firebase/messaging",h="@firebase/performance",g="@firebase/remote-config",v="@firebase/storage",y="@firebase/firestore",_="firebase-wrapper",w="[DEFAULT]",N=((n={})[p]="fire-core",n[c]="fire-analytics",n[u]="fire-auth",n[f]="fire-rtdb",n[d]="fire-fn",n[m]="fire-iid",n[b]="fire-fcm",n[h]="fire-perf",n[g]="fire-rc",n[v]="fire-gcs",n[y]="fire-fst",n["fire-js"]="fire-js",n[_]="fire-js-all",n),C=new a.Logger("@firebase/app"),I=function(){function e(e,n,a){var o,s,p=this;this.firebase_=a,this.isDeleted_=!1,this.name_=n.name,this.automaticDataCollectionEnabled_=n.automaticDataCollectionEnabled||!1,this.options_=t.deepCopy(e),this.container=new i.ComponentContainer(n.name),this._addComponent(new i.Component("app",function(){return p},"PUBLIC"));try{for(var l=r.__values(this.firebase_.INTERNAL.components.values()),c=l.next();!c.done;c=l.next()){var u=c.value;this._addComponent(u)}}catch(f){o={error:f}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(o)throw o.error}}}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise(function(n){e.checkDestroyed_(),n()}).then(function(){return e.firebase_.INTERNAL.removeApp(e.name_),Promise.all(e.container.getProviders().map(function(e){return e.delete()}))}).then(function(){e.isDeleted_=!0})},e.prototype._getService=function(e,n){return void 0===n&&(n=w),this.checkDestroyed_(),this.container.getProvider(e).getImmediate({identifier:n})},e.prototype._removeServiceInstance=function(e,n){void 0===n&&(n=w),this.container.getProvider(e).clearInstance(n)},e.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(n){C.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,n)}},e.prototype._addOrOverwriteComponent=function(e){this.container.addOrOverwriteComponent(e)},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw s.create("app-deleted",{appName:this.name_})},e}();I.prototype.name&&I.prototype.options||I.prototype.delete||console.log("dc");var E="7.20.0";function A(e){var n={},o=new Map,p={__esModule:!0,initializeApp:function(r,i){void 0===i&&(i={});if("object"!=typeof i||null===i){var a=i;i={name:a}}var o=i;void 0===o.name&&(o.name=w);var l=o.name;if("string"!=typeof l||!l)throw s.create("bad-app-name",{appName:String(l)});if(t.contains(n,l))throw s.create("duplicate-app",{appName:l});var c=new e(r,o,p);return n[l]=c,c},app:l,registerVersion:function(e,n,r){var t,a=null!==(t=N[e])&&void 0!==t?t:e;r&&(a+="-"+r);var o=a.match(/\s|\//),s=n.match(/\s|\//);if(o||s){var p=['Unable to register library "'+a+'" with version "'+n+'":'];return o&&p.push('library name "'+a+'" contains illegal characters (whitespace or "/")'),o&&s&&p.push("and"),s&&p.push('version name "'+n+'" contains illegal characters (whitespace or "/")'),void C.warn(p.join(" "))}c(new i.Component(a+"-version",function(){return{library:a,version:n}},"VERSION"))},setLogLevel:a.setLogLevel,onLog:function(e,n){if(null!==e&&"function"!=typeof e)throw s.create("invalid-log-argument",{appName:name});a.setUserLogHandler(e,n)},apps:null,SDK_VERSION:E,INTERNAL:{registerComponent:c,removeApp:function(e){delete n[e]},components:o,useAsService:function(e,n){if("serverAuth"===n)return null;return n}}};function l(e){if(e=e||w,!t.contains(n,e))throw s.create("no-app",{appName:e});return n[e]}function c(i){var a,c,u=i.name;if(o.has(u))return C.debug("There were multiple attempts to register component "+u+"."),"PUBLIC"===i.type?p[u]:null;if(o.set(u,i),"PUBLIC"===i.type){var f=function(e){if(void 0===e&&(e=l()),"function"!=typeof e[u])throw s.create("invalid-app-argument",{appName:u});return e[u]()};void 0!==i.serviceProps&&t.deepExtend(f,i.serviceProps),p[u]=f,e.prototype[u]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this._getService.bind(this,u).apply(this,i.multipleInstances?e:[])}}try{for(var d=r.__values(Object.keys(n)),m=d.next();!m.done;m=d.next()){var b=m.value;n[b]._addComponent(i)}}catch(h){a={error:h}}finally{try{m&&!m.done&&(c=d.return)&&c.call(d)}finally{if(a)throw a.error}}return"PUBLIC"===i.type?p[u]:null}return p.default=p,Object.defineProperty(p,"apps",{get:function(){return Object.keys(n).map(function(e){return n[e]})}}),l.App=e,p}function F(){var e=A(I);return e.INTERNAL=r.__assign(r.__assign({},e.INTERNAL),{createFirebaseNamespace:F,extendNamespace:function(n){t.deepExtend(e,n)},createSubscribe:t.createSubscribe,ErrorFactory:t.ErrorFactory,deepExtend:t.deepExtend}),e}var P=F(),L=function(){function e(e){this.container=e}return e.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(e){if(D(e)){var n=e.getImmediate();return n.library+"/"+n.version}return null}).filter(function(e){return e}).join(" ")},e}();function D(e){var n=e.getComponent();return"VERSION"===(null==n?void 0:n.type)}function j(e,n){e.INTERNAL.registerComponent(new i.Component("platform-logger",function(e){return new L(e)},"PRIVATE")),e.registerVersion(p,l,n),e.registerVersion("fire-js","")}if(t.isBrowser()&&void 0!==self.firebase){C.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var O=self.firebase.SDK_VERSION;O&&O.indexOf("LITE")>=0&&C.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var k=P.initializeApp;P.initializeApp=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.isNode()&&C.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),k.apply(void 0,e)};var x=P;j(x),exports.default=x,exports.firebase=x;
},{"tslib":"f2sD","@firebase/util":"xA6u","@firebase/component":"nzQs","@firebase/logger":"TUpU"}],"ZUoI":[function(require,module,exports) {
"use strict";var e=require("@firebase/app");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=r(e),a="firebase",u="7.24.0";t.default.registerVersion(a,u,"app"),module.exports=t.default;
},{"@firebase/app":"dP58"}],"pBGv":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"vmMz":[function(require,module,exports) {
var process = require("process");
var e=require("process");Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@firebase/app"),n=require("tslib"),r=require("@firebase/util"),i=require("@firebase/logger"),o=require("@firebase/component");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=s(t),h=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),r.stringify(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:r.jsonEval(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),u=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return r.contains(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),l=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new h(t)}}catch(n){}return new u},c=l("localStorage"),p=l("sessionStorage"),d=new i.Logger("@firebase/database"),f=function(){var e=1;return function(){return e++}}(),_=function(e){var t=r.stringToByteArray(e),n=new r.Sha1;n.update(t);var i=n.digest();return r.base64.encodeByteArray(i)},y=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",i=0;i<e.length;i++){var o=e[i];Array.isArray(o)||o&&"object"==typeof o&&"number"==typeof o.length?n+=y.apply(null,o):n+="object"==typeof o?r.stringify(o):o,n+=" "}return n},v=null,g=!0,m=function(e,t){r.assert(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(d.logLevel=i.LogLevel.VERBOSE,v=d.log.bind(d),t&&p.set("logging_enabled",!0)):"function"==typeof e?v=e:(v=null,p.remove("logging_enabled"))},C=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===g&&(g=!1,null===v&&!0===p.get("logging_enabled")&&m(!0)),v){var n=y.apply(null,e);v(n)}},E=function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];C.apply(void 0,n.__spread([e],t))}},w=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="FIREBASE INTERNAL ERROR: "+y.apply(void 0,n.__spread(e));d.error(r)},T=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="FIREBASE FATAL ERROR: "+y.apply(void 0,n.__spread(e));throw d.error(r),new Error(r)},b=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="FIREBASE WARNING: "+y.apply(void 0,n.__spread(e));d.warn(r)},S=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&b("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},I=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},N=function(e){if(r.isNodeSdk()||"complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},P="[MIN_NAME]",R="[MAX_NAME]",x=function(e,t){if(e===t)return 0;if(e===P||t===R)return-1;if(t===P||e===R)return 1;var n=U(e),r=U(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},D=function(e,t){return e===t?0:e<t?-1:1},k=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+r.stringify(t))},O=function(e){if("object"!=typeof e||null===e)return r.stringify(e);var t=[];for(var n in e)t.push(n);t.sort();for(var i="{",o=0;o<t.length;o++)0!==o&&(i+=","),i+=r.stringify(t[o]),i+=":",i+=O(e[t[o]]);return i+="}"},F=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function A(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var L=function(e){r.assert(!I(e),"Invalid JSON number");var t,n,i,o,s;0===e?(n=0,i=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(o=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(n=0,i=Math.round(e/Math.pow(2,-1074))));var a=[];for(s=52;s;s-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();var h=a.join(""),u="";for(s=0;s<64;s+=8){var l=parseInt(h.substr(s,8),2).toString(16);1===l.length&&(l="0"+l),u+=l}return u.toLowerCase()},M=function(){return!("object"!=typeof window||!window.chrome||!window.chrome.extension||/^chrome/.test(window.location.href))},W=function(){return"object"==typeof Windows&&"object"==typeof Windows.UI},q=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t.path.toString()+": "+n);return r.code=e.toUpperCase(),r},Q=new RegExp("^-?(0*)\\d{1,10}$"),U=function(e){if(Q.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},V=function(e){try{e()}catch(t){setTimeout(function(){var e=t.stack||"";throw b("Exception was thrown by user callback.",e),t},Math.floor(0))}},H=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},j=function(e,t){var n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n},B=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return Object.defineProperty(e,"Empty",{get:function(){return new e("")},enumerable:!1,configurable:!0}),e.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},e.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},e.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new e(this.pieces_,t)},e.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e.prototype.toUrlEncodedString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+encodeURIComponent(String(this.pieces_[t])));return e||"/"},e.prototype.slice=function(e){return void 0===e&&(e=0),this.pieces_.slice(this.pieceNum_+e)},e.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)t.push(this.pieces_[n]);return new e(t,0)},e.prototype.child=function(t){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(t instanceof e)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new e(n,0)},e.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},e.relativePath=function(t,n){var r=t.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return e.relativePath(t.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+t+")")},e.comparePaths=function(e,t){for(var n=e.slice(),r=t.slice(),i=0;i<n.length&&i<r.length;i++){var o=x(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},e.prototype.equals=function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,n=e.pieceNum_;t<=this.pieces_.length;t++,n++)if(this.pieces_[t]!==e.pieces_[n])return!1;return!0},e.prototype.contains=function(e){var t=this.pieceNum_,n=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0},e}(),K=function(){function e(e,t){this.errorPrefix_=t,this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=r.stringLength(this.parts_[n]);this.checkValid_()}return Object.defineProperty(e,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!1,configurable:!0}),Object.defineProperty(e,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!1,configurable:!0}),e.prototype.push=function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=r.stringLength(e),this.checkValid_()},e.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=r.stringLength(e),this.parts_.length>0&&(this.byteLength_-=1)},e.prototype.checkValid_=function(){if(this.byteLength_>e.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+e.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>e.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+e.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},e.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},e}(),Y="5",z="v",G="s",X="r",$="f",J="firebaseio.com",Z="ls",ee="p",te="websocket",ne="long_polling",re=function(){function e(e,t,n,r,i,o,s){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===s&&(s=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=c.get("host:"+e)||this.host}return e.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},e.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&c.set("host:"+this.host,this.internalHost))},e.prototype.connectionURL=function(e,t){var n;if(r.assert("string"==typeof e,"typeof type must == string"),r.assert("object"==typeof t,"typeof params must == object"),e===te)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(e!==ne)throw new Error("Unknown connection type: "+e);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var i=[];return A(t,function(e,t){i.push(e+"="+t)}),n+i.join("&")},e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},e}();function ie(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(o){}t+="/"+i}return t}function oe(e){var t,r,i={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var o=n.__values(e.split("&")),s=o.next();!s.done;s=o.next()){var a=s.value;if(0!==a.length){var h=a.split("=");2===h.length?i[decodeURIComponent(h[0])]=decodeURIComponent(h[1]):b("Invalid query segment '"+a+"' in query '"+e+"'")}}}catch(u){t={error:u}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i}var se,ae,he=function(e,t){var n=ue(e),r=n.namespace;"firebase.com"===n.domain&&T(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||T("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||S();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new re(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new B(n.pathString)}},ue=function(e){var t="",n="",r="",i="",o="",s=!0,a="https",h=443;if("string"==typeof e){var u=e.indexOf("//");u>=0&&(a=e.substring(0,u-1),e=e.substring(u+2));var l=e.indexOf("/");-1===l&&(l=e.length);var c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(l,c)),l<c&&(i=ie(e.substring(l,c)));var p=oe(e.substring(Math.min(e.length,c)));(u=t.indexOf(":"))>=0?(s="https"===a||"wss"===a,h=parseInt(t.substring(u+1),10)):u=t.length;var d=t.slice(0,u);if("localhost"===d.toLowerCase())n="localhost";else if(d.split(".").length<=2)n=d;else{var f=t.indexOf(".");r=t.substring(0,f).toLowerCase(),n=t.substring(f+1),o=r}"ns"in p&&(o=p.ns)}return{host:t,port:h,domain:n,subdomain:r,secure:s,scheme:a,pathString:i,namespace:o}},le=/[\[\].#$\/\u0000-\u001F\u007F]/,ce=/[\[\].#$\u0000-\u001F\u007F]/,pe=10485760,de=function(e){return"string"==typeof e&&0!==e.length&&!le.test(e)},fe=function(e){return"string"==typeof e&&0!==e.length&&!ce.test(e)},_e=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),fe(e)},ye=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!I(e)||e&&"object"==typeof e&&r.contains(e,".sv")},ve=function(e,t,n,i,o){o&&void 0===n||ge(r.errorPrefix(e,t,o),n,i)},ge=function(e,t,n){var i=n instanceof B?new K(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+i.toErrorString());if("function"==typeof t)throw new Error(e+"contains a function "+i.toErrorString()+" with contents = "+t.toString());if(I(t))throw new Error(e+"contains "+t.toString()+" "+i.toErrorString());if("string"==typeof t&&t.length>pe/3&&r.stringLength(t)>pe)throw new Error(e+"contains a string greater than "+pe+" utf8 bytes "+i.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var o=!1,s=!1;if(A(t,function(t,n){if(".value"===t)o=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!de(t)))throw new Error(e+" contains an invalid key ("+t+") "+i.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.push(t),ge(e,n,i),i.pop()}),o&&s)throw new Error(e+' contains ".value" child '+i.toErrorString()+" in addition to actual children.")}},me=function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=(r=t[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!de(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(B.comparePaths);var s=null;for(n=0;n<t.length;n++){if(r=t[n],null!==s&&s.contains(r))throw new Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},Ce=function(e,t,n,i,o){if(!o||void 0!==n){var s=r.errorPrefix(e,t,o);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(s+" must be an object containing the children to replace.");var a=[];A(n,function(e,t){var n=new B(e);if(ge(s,t,i.child(n)),".priority"===n.getBack()&&!ye(t))throw new Error(s+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),me(s,a)}},Ee=function(e,t,n,i){if(!i||void 0!==n){if(I(n))throw new Error(r.errorPrefix(e,t,i)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!ye(n))throw new Error(r.errorPrefix(e,t,i)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},we=function(e,t,n,i){if(!i||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(r.errorPrefix(e,t,i)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Te=function(e,t,n,i){if(!(i&&void 0===n||de(n)))throw new Error(r.errorPrefix(e,t,i)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},be=function(e,t,n,i){if(!(i&&void 0===n||fe(n)))throw new Error(r.errorPrefix(e,t,i)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Se=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),be(e,t,n,r)},Ie=function(e,t){if(".info"===t.getFront())throw new Error(e+" failed = Can't modify data under /.info/")},Ne=function(e,t,n){var i=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!de(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==i.length&&!_e(i))throw new Error(r.errorPrefix(e,t,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},Pe=function(e,t,n,i){if((!i||void 0!==n)&&"boolean"!=typeof n)throw new Error(r.errorPrefix(e,t,i)+"must be a boolean.")},Re=function(){function e(e,t){this.repo_=e,this.path_=t}return e.prototype.cancel=function(e){r.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),r.validateCallback("OnDisconnect.cancel",1,e,!0);var t=new r.Deferred;return this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e)),t.promise},e.prototype.remove=function(e){r.validateArgCount("OnDisconnect.remove",0,1,arguments.length),Ie("OnDisconnect.remove",this.path_),r.validateCallback("OnDisconnect.remove",1,e,!0);var t=new r.Deferred;return this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e)),t.promise},e.prototype.set=function(e,t){r.validateArgCount("OnDisconnect.set",1,2,arguments.length),Ie("OnDisconnect.set",this.path_),ve("OnDisconnect.set",1,e,this.path_,!1),r.validateCallback("OnDisconnect.set",2,t,!0);var n=new r.Deferred;return this.repo_.onDisconnectSet(this.path_,e,n.wrapCallback(t)),n.promise},e.prototype.setWithPriority=function(e,t,n){r.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),Ie("OnDisconnect.setWithPriority",this.path_),ve("OnDisconnect.setWithPriority",1,e,this.path_,!1),Ee("OnDisconnect.setWithPriority",2,t,!1),r.validateCallback("OnDisconnect.setWithPriority",3,n,!0);var i=new r.Deferred;return this.repo_.onDisconnectSetWithPriority(this.path_,e,t,i.wrapCallback(n)),i.promise},e.prototype.update=function(e,t){if(r.validateArgCount("OnDisconnect.update",1,2,arguments.length),Ie("OnDisconnect.update",this.path_),Array.isArray(e)){for(var n={},i=0;i<e.length;++i)n[""+i]=e[i];e=n,b("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ce("OnDisconnect.update",1,e,this.path_,!1),r.validateCallback("OnDisconnect.update",2,t,!0);var o=new r.Deferred;return this.repo_.onDisconnectUpdate(this.path_,e,o.wrapCallback(t)),o.promise},e}(),xe=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return r.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),De=function(){var e="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",t=0,n=[];return function(i){var o,s=i===t;t=i;var a=new Array(8);for(o=7;o>=0;o--)a[o]=e.charAt(i%64),i=Math.floor(i/64);r.assert(0===i,"Cannot push at time == 0");var h=a.join("");if(s){for(o=11;o>=0&&63===n[o];o--)n[o]=0;n[o]++}else for(o=0;o<12;o++)n[o]=Math.floor(64*Math.random());for(o=0;o<12;o++)h+=e.charAt(n[o]);return r.assert(20===h.length,"nextPushId: Length should be 20."),h}}(),ke=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),Oe=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new ke(P,e),r=new ke(P,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return ke.MIN},e}(),Fe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return se},set:function(e){se=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(e,t){return x(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw r.assertionError("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return ke.MIN},t.prototype.maxPost=function(){return new ke(R,se)},t.prototype.makePost=function(e,t){return r.assert("string"==typeof e,"KeyIndex indexValue must always be a string."),new ke(e,se)},t.prototype.toString=function(){return".key"},t}(Oe),Ae=new Fe;function Le(e){ae=e}var Me,We,qe,Qe=function(e){return"number"==typeof e?"number:"+L(e):"string:"+e},Ue=function(e){if(e.isLeafNode()){var t=e.val();r.assert("string"==typeof t||"number"==typeof t||"object"==typeof t&&r.contains(t,".sv"),"Priority must be a string or number.")}else r.assert(e===ae||e.isEmpty(),"priority of unexpected type.");r.assert(e===ae||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Ve=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,r.assert(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ue(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return Me},set:function(e){Me=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var i=t.getFront();return null===i?n:n.isEmpty()&&".priority"!==i?this:(r.assert(".priority"!==i||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(i,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+Qe(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?L(this.value_):this.value_,this.lazyHash_=_(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(r.assert(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,i=typeof this.value_,o=e.VALUE_TYPE_ORDER.indexOf(n),s=e.VALUE_TYPE_ORDER.indexOf(i);return r.assert(o>=0,"Unknown leaf type: "+n),r.assert(s>=0,"Unknown leaf type: "+i),o===s?"object"===i?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-o},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();function He(e){We=e}function je(e){qe=e}var Be,Ke,Ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?x(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return ke.MIN},t.prototype.maxPost=function(){return new ke(R,new Ve("[PRIORITY-POST]",qe))},t.prototype.makePost=function(e,t){var n=We(e);return new ke(t,new Ve("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(Oe),ze=new Ye,Ge=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),Xe=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:Je.EMPTY_NODE,this.right=null!=o?o:Je.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,o){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return Je.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Je.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),$e=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new Xe(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),Je=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,Xe.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Xe.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new Ge(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new Ge(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new Ge(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new Ge(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new $e,e}(),Ze=Math.log(2),et=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Ze,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),tt=function(e,t,n,r){e.sort(t);var i=function(t,r){var o,s,a=r-t;if(0===a)return null;if(1===a)return o=e[t],s=n?n(o):o,new Xe(s,o.node,Xe.BLACK,null,null);var h=parseInt(a/2,10)+t,u=i(t,h),l=i(h+1,r);return o=e[h],s=n?n(o):o,new Xe(s,o.node,Xe.BLACK,u,l)},o=function(t){for(var r=null,o=null,s=e.length,a=function(t,r){var o=s-t,a=s;s-=t;var u=i(o+1,a),l=e[o],c=n?n(l):l;h(new Xe(c,l.node,r,null,u))},h=function(e){r?(r.left=e,r=e):(o=e,r=e)},u=0;u<t.count;++u){var l=t.nextBitIsOne(),c=Math.pow(2,t.count-(u+1));l?a(c,Xe.BLACK):(a(c,Xe.BLACK),a(c,Xe.RED))}return o}(new et(e.length));return new Je(r||t,o)},nt={},rt=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return r.assert(nt&&ze,"ChildrenNode.ts has not been loaded"),Be=Be||new e({".priority":nt},{".priority":ze})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=r.safeGet(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Je?t:null},e.prototype.hasIndex=function(e){return r.contains(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,i){r.assert(t!==Ae,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var o,s=[],a=!1,h=i.getIterator(ke.Wrap),u=h.getNext();u;)a=a||t.isDefinedOn(u.node),s.push(u),u=h.getNext();o=a?tt(s,t.getCompare()):nt;var l=t.toString(),c=n.__assign({},this.indexSet_);c[l]=t;var p=n.__assign({},this.indexes_);return p[l]=o,new e(p,c)},e.prototype.addToIndexes=function(t,n){var i=this;return new e(r.map(this.indexes_,function(e,o){var s=r.safeGet(i.indexSet_,o);if(r.assert(s,"Missing index implementation for "+o),e===nt){if(s.isDefinedOn(t.node)){for(var a=[],h=n.getIterator(ke.Wrap),u=h.getNext();u;)u.name!==t.name&&a.push(u),u=h.getNext();return a.push(t),tt(a,s.getCompare())}return nt}var l=n.get(t.name),c=e;return l&&(c=c.remove(new ke(t.name,l))),c.insert(t,t.node)}),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e(r.map(this.indexes_,function(e){if(e===nt)return e;var r=n.get(t.name);return r?e.remove(new ke(t.name,r)):e}),this.indexSet_)},e}();function it(e,t){return x(e.name,t.name)}function ot(e,t){return x(e,t)}var st=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ue(this.priorityNode_),this.children_.isEmpty()&&r.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return Ke||(Ke=new e(new Je(ot),null,rt.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||Ke},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Ke:t},e.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if(r.assert(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var i=new ke(t,n),o=void 0,s=void 0;n.isEmpty()?(o=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(i,this.children_));var a=o.isEmpty()?Ke:this.priorityNode_;return new e(o,a,s)},e.prototype.updateChild=function(e,t){var n=e.getFront();if(null===n)return t;r.assert(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var i=this.getImmediateChild(n).updateChild(e.popFront(),t);return this.updateImmediateChild(n,i)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(ze,function(s,a){n[s]=a.val(t),r++,o&&e.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1}),!t&&o&&i<2*r){var s=[];for(var a in n)s[a]=n[a];return s}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+Qe(this.getPriority().val())+":"),this.forEachChild(ze,function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":_(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new ke(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new ke(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new ke(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal(function(e){return t(e.name,e.node)}):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,function(e){return e});for(var r=this.children_.getIteratorFrom(e.name,ke.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,function(e){return e});for(var r=this.children_.getReverseIteratorFrom(e.name,ke.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ht?-1:0},e.prototype.withIndex=function(t){if(t===Ae||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===Ae||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(ze),r=t.getIterator(ze),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===Ae?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),at=function(e){function t(){return e.call(this,new Je(ot),st.EMPTY_NODE,rt.Default)||this}return n.__extends(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return st.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(st),ht=new at;Object.defineProperties(ke,{MIN:{value:new ke(P,st.EMPTY_NODE)},MAX:{value:new ke(R,ht)}}),Fe.__EMPTY_NODE=st.EMPTY_NODE,Ve.__childrenNodeConstructor=st,Le(ht),je(ht);var ut=!0;function lt(e,t){if(void 0===t&&(t=null),null===e)return st.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),r.assert(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Ve(e,lt(t));if(e instanceof Array||!ut){var n=st.EMPTY_NODE;return A(e,function(t,i){if(r.contains(e,t)&&"."!==t.substring(0,1)){var o=lt(i);!o.isLeafNode()&&o.isEmpty()||(n=n.updateImmediateChild(t,o))}}),n.updatePriority(lt(t))}var i=[],o=!1;if(A(e,function(e,t){if("."!==e.substring(0,1)){var n=lt(t);n.isEmpty()||(o=o||!n.getPriority().isEmpty(),i.push(new ke(e,n)))}}),0===i.length)return st.EMPTY_NODE;var s=tt(i,it,function(e){return e.name},ot);if(o){var a=tt(i,ze.getCompare());return new st(s,lt(t),new rt({".priority":a},{".priority":ze}))}return new st(s,lt(t),rt.Default)}He(lt);var ct,pt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?x(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return ke.MIN},t.prototype.maxPost=function(){return ke.MAX},t.prototype.makePost=function(e,t){var n=lt(e);return new ke(t,n)},t.prototype.toString=function(){return".value"},t}(Oe),dt=new pt,ft=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,r.assert(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return n.__extends(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?x(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=lt(e),r=st.EMPTY_NODE.updateChild(this.indexPath_,n);return new ke(t,r)},t.prototype.maxPost=function(){var e=st.EMPTY_NODE.updateChild(this.indexPath_,ht);return new ke(R,e)},t.prototype.toString=function(){return this.indexPath_.slice().join("/")},t}(Oe),_t=function(){function e(e,t,n){this.node_=e,this.ref_=t,this.index_=n}return e.prototype.val=function(){return r.validateArgCount("DataSnapshot.val",0,0,arguments.length),this.node_.val()},e.prototype.exportVal=function(){return r.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},e.prototype.toJSON=function(){return r.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},e.prototype.exists=function(){return r.validateArgCount("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},e.prototype.child=function(t){r.validateArgCount("DataSnapshot.child",0,1,arguments.length),t=String(t),be("DataSnapshot.child",1,t,!1);var n=new B(t),i=this.ref_.child(n);return new e(this.node_.getChild(n),i,ze)},e.prototype.hasChild=function(e){r.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),be("DataSnapshot.hasChild",1,e,!1);var t=new B(e);return!this.node_.getChild(t).isEmpty()},e.prototype.getPriority=function(){return r.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},e.prototype.forEach=function(t){var n=this;return r.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),r.validateCallback("DataSnapshot.forEach",1,t,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(r,i){return t(new e(i,n.ref_.child(r),ze))})},e.prototype.hasChildren=function(){return r.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(e.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return r.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},e.prototype.getRef=function(){return r.validateArgCount("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),yt=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+r.stringify(this.snapshot.exportVal())},e}(),vt=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),gt=function(){function e(e,t,n){this.callback_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t.getQueryParams().getIndex();return new yt("value",this,new _t(e.snapshotNode,t.getRef(),n))},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){r.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var i=this.callback_;return function(){i.call(t,e.snapshot)}},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new vt(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},e.prototype.hasAnyCallback=function(){return null!==this.callback_},e}(),mt=function(){function e(e,t,n){this.callbacks_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,r.contains(this.callbacks_,t)},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new vt(this,e,t):null},e.prototype.createEvent=function(e,t){r.assert(null!=e.childName,"Child events should have a childName.");var n=t.getRef().child(e.childName),i=t.getQueryParams().getIndex();return new yt(e.type,this,new _t(e.snapshotNode,n,i),e.prevName)},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){r.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var i=this.callbacks_[e.eventType];return function(){i.call(t,e.snapshot,e.prevName)}},e.prototype.matches=function(t){var n=this;if(t instanceof e){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var r=Object.keys(t.callbacks_),i=Object.keys(this.callbacks_),o=r.length;if(o===i.length){if(1===o){var s=r[0],a=i[0];return!(a!==s||t.callbacks_[s]&&this.callbacks_[a]&&t.callbacks_[s]!==this.callbacks_[a])}return i.every(function(e){return t.callbacks_[e]===n.callbacks_[e]})}}}return!1},e.prototype.hasAnyCallback=function(){return null!==this.callbacks_},e}(),Ct=function(){function e(e,t,n,r){this.repo=e,this.path=t,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return r.assert(ct,"Reference.ts has not been loaded"),ct},set:function(e){ct=e},enumerable:!1,configurable:!0}),e.validateQueryEndpoints_=function(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===Ae){var i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==P)throw new Error(i);if("string"!=typeof t)throw new Error(o)}if(e.hasEnd()){if(e.getIndexEndName()!==R)throw new Error(i);if("string"!=typeof n)throw new Error(o)}}else if(e.getIndex()===ze){if(null!=t&&!ye(t)||null!=n&&!ye(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(r.assert(e.getIndex()instanceof ft||e.getIndex()===dt,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},e.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},e.prototype.validateNoPreviousOrderByCall_=function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},e.prototype.getQueryParams=function(){return this.queryParams_},e.prototype.getRef=function(){return r.validateArgCount("Query.ref",0,0,arguments.length),new e.__referenceConstructor(this.repo,this.path)},e.prototype.on=function(t,n,i,o){r.validateArgCount("Query.on",2,4,arguments.length),we("Query.on",1,t,!1),r.validateCallback("Query.on",2,n,!1);var s=e.getCancelAndContextArgs_("Query.on",i,o);if("value"===t)this.onValueEvent(n,s.cancel,s.context);else{var a={};a[t]=n,this.onChildEvent(a,s.cancel,s.context)}return n},e.prototype.onValueEvent=function(e,t,n){var r=new gt(e,t||null,n||null);this.repo.addEventCallbackForQuery(this,r)},e.prototype.onChildEvent=function(e,t,n){var r=new mt(e,t,n);this.repo.addEventCallbackForQuery(this,r)},e.prototype.off=function(e,t,n){r.validateArgCount("Query.off",0,3,arguments.length),we("Query.off",1,e,!0),r.validateCallback("Query.off",2,t,!0),r.validateContextObject("Query.off",3,n,!0);var i=null,o=null;"value"===e?i=new gt(t||null,null,n||null):e&&(t&&((o={})[e]=t),i=new mt(o,null,n||null));this.repo.removeEventCallbackForQuery(this,i)},e.prototype.once=function(t,n,i,o){var s=this;r.validateArgCount("Query.once",1,4,arguments.length),we("Query.once",1,t,!1),r.validateCallback("Query.once",2,n,!0);var a=e.getCancelAndContextArgs_("Query.once",i,o),h=!0,u=new r.Deferred;u.promise.catch(function(){});var l=function(e){h&&(h=!1,s.off(t,l),n&&n.bind(a.context)(e),u.resolve(e))};return this.on(t,l,function(e){s.off(t,l),a.cancel&&a.cancel.bind(a.context)(e),u.reject(e)}),u.promise},e.prototype.limitToFirst=function(t){if(r.validateArgCount("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},e.prototype.limitToLast=function(t){if(r.validateArgCount("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},e.prototype.orderByChild=function(t){if(r.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');be("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new B(t);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var i=new ft(n),o=this.queryParams_.orderBy(i);return e.validateQueryEndpoints_(o),new e(this.repo,this.path,o,!0)},e.prototype.orderByKey=function(){r.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(Ae);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByPriority=function(){r.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(ze);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByValue=function(){r.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(dt);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.startAt=function(t,n){void 0===t&&(t=null),r.validateArgCount("Query.startAt",0,2,arguments.length),ve("Query.startAt",1,t,this.path,!0),Te("Query.startAt",2,n,!0);var i=this.queryParams_.startAt(t,n);if(e.validateLimit_(i),e.validateQueryEndpoints_(i),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(t=null,n=null),new e(this.repo,this.path,i,this.orderByCalled_)},e.prototype.endAt=function(t,n){void 0===t&&(t=null),r.validateArgCount("Query.endAt",0,2,arguments.length),ve("Query.endAt",1,t,this.path,!0),Te("Query.endAt",2,n,!0);var i=this.queryParams_.endAt(t,n);if(e.validateLimit_(i),e.validateQueryEndpoints_(i),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new e(this.repo,this.path,i,this.orderByCalled_)},e.prototype.equalTo=function(e,t){if(r.validateArgCount("Query.equalTo",1,2,arguments.length),ve("Query.equalTo",1,e,this.path,!1),Te("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},e.prototype.toString=function(){return r.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},e.prototype.toJSON=function(){return r.validateArgCount("Query.toJSON",0,1,arguments.length),this.toString()},e.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},e.prototype.queryIdentifier=function(){var e=this.queryObject(),t=O(e);return"{}"===t?"default":t},e.prototype.isEqual=function(t){if(r.validateArgCount("Query.isEqual",1,1,arguments.length),!(t instanceof e)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}var n=this.repo===t.repo,i=this.path.equals(t.path),o=this.queryIdentifier()===t.queryIdentifier();return n&&i&&o},e.getCancelAndContextArgs_=function(e,t,n){var i={cancel:null,context:null};if(t&&n)i.cancel=t,r.validateCallback(e,3,i.cancel,!0),i.context=n,r.validateContextObject(e,4,i.context,!0);else if(t)if("object"==typeof t&&null!==t)i.context=t;else{if("function"!=typeof t)throw new Error(r.errorPrefix(e,3,!0)+" must either be a cancel callback or a context object.");i.cancel=t}return i},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Et=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),wt=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=this.path_.child(t);return new e(this.syncTree_,n)},e.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},e}(),Tt=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},bt=function(e,t,n){return e&&"object"==typeof e?(r.assert(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?St(e[".sv"],t,n):"object"==typeof e[".sv"]?It(e[".sv"],t):void r.assert(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},St=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:r.assert(!1,"Unexpected server value: "+e)}},It=function(e,t,n){e.hasOwnProperty("increment")||r.assert(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var i=e.increment;"number"!=typeof i&&r.assert(!1,"Unexpected increment value: "+i);var o=t.node();if(r.assert(null!=o,"Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return i;var s=o.getValue();return"number"!=typeof s?i:s+i},Nt=function(e,t,n,r){return Rt(t,new wt(n,e),r)},Pt=function(e,t,n){return Rt(e,new Et(t),n)};function Rt(e,t,n){var r,i=e.getPriority().val(),o=bt(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var s=e,a=bt(s.getValue(),t,n);return a!==s.getValue()||o!==s.getPriority().val()?new Ve(a,lt(o)):e}var h=e;return r=h,o!==h.getPriority().val()&&(r=r.updatePriority(new Ve(o))),h.forEachChild(ze,function(e,i){var o=Rt(i,t.getImmediateChild(e),n);o!==i&&(r=r.updateImmediateChild(e,o))}),r}var xt,Dt=function(){function e(){this.value=null,this.children=new Map}return e.prototype.find=function(e){if(null!=this.value)return this.value.getChild(e);if(!e.isEmpty()&&this.children.size>0){var t=e.getFront();return e=e.popFront(),this.children.has(t)?this.children.get(t).find(e):null}return null},e.prototype.remember=function(t,n){if(t.isEmpty())this.value=n,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,n);else{var r=t.getFront();this.children.has(r)||this.children.set(r,new e);var i=this.children.get(r);t=t.popFront(),i.remember(t,n)}},e.prototype.forget=function(e){if(e.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var t=this.value;this.value=null;var n=this;return t.forEachChild(ze,function(e,t){n.remember(new B(e),t)}),this.forget(e)}if(this.children.size>0){var r=e.getFront();if(e=e.popFront(),this.children.has(r))this.children.get(r).forget(e)&&this.children.delete(r);return 0===this.children.size}return!0},e.prototype.forEachTree=function(e,t){null!==this.value?t(e,this.value):this.forEachChild(function(n,r){var i=new B(e.toString()+"/"+n);r.forEachTree(i,t)})},e.prototype.forEachChild=function(e){this.children.forEach(function(t,n){e(n,t)})},e}();!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(xt||(xt={}));var kt,Ot,Ft=function(){function e(e,t,n,i){this.fromUser=e,this.fromServer=t,this.queryId=n,this.tagged=i,r.assert(!i||t,"Tagged queries must be from server.")}return e.User=new e(!0,!1,null,!1),e.Server=new e(!1,!0,null,!1),e.forServerTaggedQuery=function(t){return new e(!1,!0,t,!0)},e}(),At=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=xt.ACK_USER_WRITE,this.source=Ft.User}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return r.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new B(t));return new e(B.Empty,n,this.revert)}return r.assert(this.path.getFront()===t,"operationForChild called for unrelated child."),new e(this.path.popFront(),this.affectedTree,this.revert)},e}(),Lt=function(){return kt||(kt=new Je(D)),kt},Mt=function(){function e(e,t){void 0===t&&(t=Lt()),this.value=e,this.children=t}return e.fromObject=function(t){var n=e.Empty;return A(t,function(e,t){n=n.set(new B(e),t)}),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:B.Empty,value:this.value};if(e.isEmpty())return null;var n=e.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(e.popFront(),t);return null!=i?{path:new B(n).child(i.path),value:i.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},e.prototype.subtree=function(t){if(t.isEmpty())return this;var n=t.getFront(),r=this.children.get(n);return null!==r?r.subtree(t.popFront()):e.Empty},e.prototype.set=function(t,n){if(t.isEmpty())return new e(n,this.children);var r=t.getFront(),i=(this.children.get(r)||e.Empty).set(t.popFront(),n),o=this.children.insert(r,i);return new e(this.value,o)},e.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?e.Empty:new e(null,this.children);var n=t.getFront(),r=this.children.get(n);if(r){var i=r.remove(t.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?e.Empty:new e(this.value,o)}return this},e.prototype.get=function(e){if(e.isEmpty())return this.value;var t=e.getFront(),n=this.children.get(t);return n?n.get(e.popFront()):null},e.prototype.setTree=function(t,n){if(t.isEmpty())return n;var r=t.getFront(),i=(this.children.get(r)||e.Empty).setTree(t.popFront(),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,o)},e.prototype.fold=function(e){return this.fold_(B.Empty,e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(e.child(r),t)}),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,B.Empty,t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(e.isEmpty())return null;var i=e.getFront(),o=this.children.get(i);return o?o.findOnPath_(e.popFront(),t.child(i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,B.Empty,t)},e.prototype.foreachOnPath_=function(t,n,r){if(t.isEmpty())return this;this.value&&r(n,this.value);var i=t.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(t.popFront(),n.child(i),r):e.Empty},e.prototype.foreach=function(e){this.foreach_(B.Empty,e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal(function(n,r){r.foreach_(e.child(n),t)}),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal(function(t,n){n.value&&e(t,n.value)})},e.Empty=new e(null),e}(),Wt=function(){function e(e,t){this.source=e,this.path=t,this.type=xt.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,B.Empty):new e(this.source,this.path.popFront())},e}(),qt=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=xt.OVERWRITE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,B.Empty,this.snap.getImmediateChild(t)):new e(this.source,this.path.popFront(),this.snap)},e}(),Qt=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=xt.MERGE}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){var n=this.children.subtree(new B(t));return n.isEmpty()?null:n.value?new qt(this.source,B.Empty,n.value):new e(this.source,B.Empty,n)}return r.assert(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,this.path.popFront(),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),Ut=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),Vt=function(){function e(e,t){this.eventCache_=e,this.serverCache_=t}return e.prototype.updateEventSnap=function(t,n,r){return new e(new Ut(t,n,r),this.serverCache_)},e.prototype.updateServerSnap=function(t,n,r){return new e(this.eventCache_,new Ut(t,n,r))},e.prototype.getEventCache=function(){return this.eventCache_},e.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},e.prototype.getServerCache=function(){return this.serverCache_},e.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},e.Empty=new e(new Ut(st.EMPTY_NODE,!1,!1),new Ut(st.EMPTY_NODE,!1,!1)),e}(),Ht=function(){function e(e,t,n,r,i){this.type=e,this.snapshotNode=t,this.childName=n,this.oldSnap=r,this.prevName=i}return e.valueChange=function(t){return new e(e.VALUE,t)},e.childAddedChange=function(t,n){return new e(e.CHILD_ADDED,n,t)},e.childRemovedChange=function(t,n){return new e(e.CHILD_REMOVED,n,t)},e.childChangedChange=function(t,n,r){return new e(e.CHILD_CHANGED,n,t,r)},e.childMovedChange=function(t,n){return new e(e.CHILD_MOVED,n,t)},e.CHILD_ADDED="child_added",e.CHILD_REMOVED="child_removed",e.CHILD_CHANGED="child_changed",e.CHILD_MOVED="child_moved",e.VALUE="value",e}(),jt=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,i,o,s){r.assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.getChild(i).equals(n.getChild(i))&&a.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(Ht.childRemovedChange(t,a)):r.assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(Ht.childAddedChange(t,n)):s.trackChildChange(Ht.childChangedChange(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(ze,function(e,r){t.hasChild(e)||n.trackChildChange(Ht.childRemovedChange(e,r))}),t.isLeafNode()||t.forEachChild(ze,function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(Ht.childChangedChange(t,r,i))}else n.trackChildChange(Ht.childAddedChange(t,r))})),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?st.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),Bt=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;r.assert(t===Ht.CHILD_ADDED||t===Ht.CHILD_CHANGED||t===Ht.CHILD_REMOVED,"Only child changes supported for tracking"),r.assert(".priority"!==n,"Only non-priority child changes can be tracked.");var i=this.changeMap.get(n);if(i){var o=i.type;if(t===Ht.CHILD_ADDED&&o===Ht.CHILD_REMOVED)this.changeMap.set(n,Ht.childChangedChange(n,e.snapshotNode,i.snapshotNode));else if(t===Ht.CHILD_REMOVED&&o===Ht.CHILD_ADDED)this.changeMap.delete(n);else if(t===Ht.CHILD_REMOVED&&o===Ht.CHILD_CHANGED)this.changeMap.set(n,Ht.childRemovedChange(n,i.oldSnap));else if(t===Ht.CHILD_CHANGED&&o===Ht.CHILD_ADDED)this.changeMap.set(n,Ht.childAddedChange(n,e.snapshotNode));else{if(t!==Ht.CHILD_CHANGED||o!==Ht.CHILD_CHANGED)throw r.assertionError("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(n,Ht.childChangedChange(n,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),Kt=function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}(),Yt=new Kt,zt=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new Ut(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,t,1,n,e);return 0===i.length?null:i[0]},e}(),Gt=function(){return function(e,t){this.viewCache=e,this.changes=t}}(),Xt=function(){function e(e){this.filter_=e}return e.prototype.assertIndexed=function(e){r.assert(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),r.assert(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},e.prototype.applyOperation=function(t,n,i,o){var s,a,h=new Bt;if(n.type===xt.OVERWRITE){var u=n;u.source.fromUser?s=this.applyUserOverwrite_(t,u.path,u.snap,i,o,h):(r.assert(u.source.fromServer,"Unknown source."),a=u.source.tagged||t.getServerCache().isFiltered()&&!u.path.isEmpty(),s=this.applyServerOverwrite_(t,u.path,u.snap,i,o,a,h))}else if(n.type===xt.MERGE){var l=n;l.source.fromUser?s=this.applyUserMerge_(t,l.path,l.children,i,o,h):(r.assert(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.getServerCache().isFiltered(),s=this.applyServerMerge_(t,l.path,l.children,i,o,a,h))}else if(n.type===xt.ACK_USER_WRITE){var c=n;s=c.revert?this.revertUserWrite_(t,c.path,i,o,h):this.ackUserWrite_(t,c.path,c.affectedTree,i,o,h)}else{if(n.type!==xt.LISTEN_COMPLETE)throw r.assertionError("Unknown operation type: "+n.type);s=this.listenComplete_(t,n.path,i,h)}var p=h.getChanges();return e.maybeAddValueEvent_(t,s,p),new Gt(s,p)},e.maybeAddValueEvent_=function(e,t,n){var r=t.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=e.getCompleteEventSnap();(n.length>0||!e.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(Ht.valueChange(t.getCompleteEventSnap()))}},e.prototype.generateEventCacheAfterServerEvent_=function(e,t,n,i,o){var s=e.getEventCache();if(null!=n.shadowingWrite(t))return e;var a=void 0,h=void 0;if(t.isEmpty())if(r.assert(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var u=e.getCompleteServerSnap(),l=u instanceof st?u:st.EMPTY_NODE,c=n.calcCompleteEventChildren(l);a=this.filter_.updateFullNode(e.getEventCache().getNode(),c,o)}else{var p=n.calcCompleteEventCache(e.getCompleteServerSnap());a=this.filter_.updateFullNode(e.getEventCache().getNode(),p,o)}else{var d=t.getFront();if(".priority"===d){r.assert(1===t.getLength(),"Can't have a priority with additional path components");var f=s.getNode();h=e.getServerCache().getNode();var _=n.calcEventCacheAfterServerOverwrite(t,f,h);a=null!=_?this.filter_.updatePriority(f,_):s.getNode()}else{var y=t.popFront(),v=void 0;if(s.isCompleteForChild(d)){h=e.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(t,s.getNode(),h);v=null!=g?s.getNode().getImmediateChild(d).updateChild(y,g):s.getNode().getImmediateChild(d)}else v=n.calcCompleteChild(d,e.getServerCache());a=null!=v?this.filter_.updateChild(s.getNode(),d,v,y,i,o):s.getNode()}}return e.updateEventSnap(a,s.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())},e.prototype.applyServerOverwrite_=function(e,t,n,r,i,o,s){var a,h=e.getServerCache(),u=o?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())a=u.updateFullNode(h.getNode(),n,null);else if(u.filtersNodes()&&!h.isFiltered()){var l=h.getNode().updateChild(t,n);a=u.updateFullNode(h.getNode(),l,null)}else{var c=t.getFront();if(!h.isCompleteForPath(t)&&t.getLength()>1)return e;var p=t.popFront(),d=h.getNode().getImmediateChild(c).updateChild(p,n);a=".priority"===c?u.updatePriority(h.getNode(),d):u.updateChild(h.getNode(),c,d,p,Yt,null)}var f=e.updateServerSnap(a,h.isFullyInitialized()||t.isEmpty(),u.filtersNodes()),_=new zt(r,f,i);return this.generateEventCacheAfterServerEvent_(f,t,r,_,s)},e.prototype.applyUserOverwrite_=function(e,t,n,r,i,o){var s,a,h=e.getEventCache(),u=new zt(r,e,i);if(t.isEmpty())a=this.filter_.updateFullNode(e.getEventCache().getNode(),n,o),s=e.updateEventSnap(a,!0,this.filter_.filtersNodes());else{var l=t.getFront();if(".priority"===l)a=this.filter_.updatePriority(e.getEventCache().getNode(),n),s=e.updateEventSnap(a,h.isFullyInitialized(),h.isFiltered());else{var c=t.popFront(),p=h.getNode().getImmediateChild(l),d=void 0;if(c.isEmpty())d=n;else{var f=u.getCompleteChild(l);d=null!=f?".priority"===c.getBack()&&f.getChild(c.parent()).isEmpty()?f:f.updateChild(c,n):st.EMPTY_NODE}if(p.equals(d))s=e;else{var _=this.filter_.updateChild(h.getNode(),l,d,c,u,o);s=e.updateEventSnap(_,h.isFullyInitialized(),this.filter_.filtersNodes())}}}return s},e.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},e.prototype.applyUserMerge_=function(t,n,r,i,o,s){var a=this,h=t;return r.foreach(function(r,u){var l=n.child(r);e.cacheHasChild_(t,l.getFront())&&(h=a.applyUserOverwrite_(h,l,u,i,o,s))}),r.foreach(function(r,u){var l=n.child(r);e.cacheHasChild_(t,l.getFront())||(h=a.applyUserOverwrite_(h,l,u,i,o,s))}),h},e.prototype.applyMerge_=function(e,t){return t.foreach(function(t,n){e=e.updateChild(t,n)}),e},e.prototype.applyServerMerge_=function(e,t,n,r,i,o,s){var a=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var h,u=e;h=t.isEmpty()?n:Mt.Empty.setTree(t,n);var l=e.getServerCache().getNode();return h.children.inorderTraversal(function(t,n){if(l.hasChild(t)){var h=e.getServerCache().getNode().getImmediateChild(t),c=a.applyMerge_(h,n);u=a.applyServerOverwrite_(u,new B(t),c,r,i,o,s)}}),h.children.inorderTraversal(function(t,n){var h=!e.getServerCache().isCompleteForChild(t)&&null==n.value;if(!l.hasChild(t)&&!h){var c=e.getServerCache().getNode().getImmediateChild(t),p=a.applyMerge_(c,n);u=a.applyServerOverwrite_(u,new B(t),p,r,i,o,s)}}),u},e.prototype.ackUserWrite_=function(e,t,n,r,i,o){if(null!=r.shadowingWrite(t))return e;var s=e.getServerCache().isFiltered(),a=e.getServerCache();if(null!=n.value){if(t.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,a.getNode().getChild(t),r,i,s,o);if(t.isEmpty()){var h=Mt.Empty;return a.getNode().forEachChild(Ae,function(e,t){h=h.set(new B(e),t)}),this.applyServerMerge_(e,t,h,r,i,s,o)}return e}var u=Mt.Empty;return n.foreach(function(e,n){var r=t.child(e);a.isCompleteForPath(r)&&(u=u.set(e,a.getNode().getChild(r)))}),this.applyServerMerge_(e,t,u,r,i,s,o)},e.prototype.listenComplete_=function(e,t,n,r){var i=e.getServerCache(),o=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,t,n,Yt,r)},e.prototype.revertUserWrite_=function(e,t,n,i,o){var s;if(null!=n.shadowingWrite(t))return e;var a=new zt(n,e,i),h=e.getEventCache().getNode(),u=void 0;if(t.isEmpty()||".priority"===t.getFront()){var l=void 0;if(e.getServerCache().isFullyInitialized())l=n.calcCompleteEventCache(e.getCompleteServerSnap());else{var c=e.getServerCache().getNode();r.assert(c instanceof st,"serverChildren would be complete if leaf node"),l=n.calcCompleteEventChildren(c)}l=l,u=this.filter_.updateFullNode(h,l,o)}else{var p=t.getFront(),d=n.calcCompleteChild(p,e.getServerCache());null==d&&e.getServerCache().isCompleteForChild(p)&&(d=h.getImmediateChild(p)),(u=null!=d?this.filter_.updateChild(h,p,d,t.popFront(),a,o):e.getEventCache().getNode().hasChild(p)?this.filter_.updateChild(h,p,st.EMPTY_NODE,t.popFront(),a,o):h).isEmpty()&&e.getServerCache().isFullyInitialized()&&(s=n.calcCompleteEventCache(e.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,s,o))}return s=e.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(B.Empty),e.updateEventSnap(u,s,this.filter_.filtersNodes())},e}(),$t=function(){function e(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()}return e.prototype.generateEventsForChanges=function(e,t,n){var r=this,i=[],o=[];return e.forEach(function(e){e.type===Ht.CHILD_CHANGED&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push(Ht.childMovedChange(e.childName,e.snapshotNode))}),this.generateEventsForType_(i,Ht.CHILD_REMOVED,e,n,t),this.generateEventsForType_(i,Ht.CHILD_ADDED,e,n,t),this.generateEventsForType_(i,Ht.CHILD_MOVED,o,n,t),this.generateEventsForType_(i,Ht.CHILD_CHANGED,e,n,t),this.generateEventsForType_(i,Ht.VALUE,e,n,t),i},e.prototype.generateEventsForType_=function(e,t,n,r,i){var o=this,s=n.filter(function(e){return e.type===t});s.sort(this.compareChanges_.bind(this)),s.forEach(function(t){var n=o.materializeSingleChange_(t,i);r.forEach(function(r){r.respondsTo(t.type)&&e.push(r.createEvent(n,o.query_))})})},e.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type?e:(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_),e)},e.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw r.assertionError("Should only compare child_ events.");var n=new ke(e.childName,e.snapshotNode),i=new ke(t.childName,t.snapshotNode);return this.index_.compare(n,i)},e}(),Jt=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new jt(n.getIndex()),i=n.getNodeFilter();this.processor_=new Xt(i);var o=t.getServerCache(),s=t.getEventCache(),a=r.updateFullNode(st.EMPTY_NODE,o.getNode(),null),h=i.updateFullNode(st.EMPTY_NODE,s.getNode(),null),u=new Ut(a,o.isFullyInitialized(),r.filtersNodes()),l=new Ut(h,s.isFullyInitialized(),i.filtersNodes());this.viewCache_=new Vt(l,u),this.eventGenerator_=new $t(this.query_)}return e.prototype.getQuery=function(){return this.query_},e.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},e.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},e.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},e.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},e.prototype.removeEventRegistration=function(e,t){var n=[];if(t){r.assert(null==e,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(e){t=t;var r=e.createCancelEvent(t,i);r&&n.push(r)})}if(e){for(var o=[],s=0;s<this.eventRegistrations_.length;++s){var a=this.eventRegistrations_[s];if(a.matches(e)){if(e.hasAnyCallback()){o=o.concat(this.eventRegistrations_.slice(s+1));break}}else o.push(a)}this.eventRegistrations_=o}else this.eventRegistrations_=[];return n},e.prototype.applyOperation=function(e,t,n){e.type===xt.MERGE&&null!==e.source.queryId&&(r.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),r.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var i=this.viewCache_,o=this.processor_.applyOperation(i,e,t,n);return this.processor_.assertIndexed(o.viewCache),r.assert(o.viewCache.getServerCache().isFullyInitialized()||!i.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=o.viewCache,this.generateEventsForChanges_(o.changes,o.viewCache.getEventCache().getNode(),null)},e.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),n=[];t.getNode().isLeafNode()||t.getNode().forEachChild(ze,function(e,t){n.push(Ht.childAddedChange(e,t))});return t.isFullyInitialized()&&n.push(Ht.valueChange(t.getNode())),this.generateEventsForChanges_(n,t.getNode(),e)},e.prototype.generateEventsForChanges_=function(e,t,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,r)},e}(),Zt=function(){function e(){this.views=new Map}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return r.assert(Ot,"Reference.ts has not been loaded"),Ot},set:function(e){r.assert(!Ot,"__referenceConstructor has already been defined"),Ot=e},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this.views.size},e.prototype.applyOperation=function(e,t,i){var o,s,a=e.source.queryId;if(null!==a){var h=this.views.get(a);return r.assert(null!=h,"SyncTree gave us an op for an invalid query."),h.applyOperation(e,t,i)}var u=[];try{for(var l=n.__values(this.views.values()),c=l.next();!c.done;c=l.next()){h=c.value;u=u.concat(h.applyOperation(e,t,i))}}catch(p){o={error:p}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(o)throw o.error}}return u},e.prototype.addEventRegistration=function(e,t,n,r,i){var o=e.queryIdentifier(),s=this.views.get(o);if(!s){var a=n.calcCompleteEventCache(i?r:null),h=!1;a?h=!0:r instanceof st?(a=n.calcCompleteEventChildren(r),h=!1):(a=st.EMPTY_NODE,h=!1);var u=new Vt(new Ut(a,h,!1),new Ut(r,i,!1));s=new Jt(e,u),this.views.set(o,s)}return s.addEventRegistration(t),s.getInitialEvents(t)},e.prototype.removeEventRegistration=function(t,r,i){var o,s,a=t.queryIdentifier(),h=[],u=[],l=this.hasCompleteView();if("default"===a)try{for(var c=n.__values(this.views.entries()),p=c.next();!p.done;p=c.next()){var d=n.__read(p.value,2),f=d[0],_=d[1];u=u.concat(_.removeEventRegistration(r,i)),_.isEmpty()&&(this.views.delete(f),_.getQuery().getQueryParams().loadsAllData()||h.push(_.getQuery()))}}catch(y){o={error:y}}finally{try{p&&!p.done&&(s=c.return)&&s.call(c)}finally{if(o)throw o.error}}else(_=this.views.get(a))&&(u=u.concat(_.removeEventRegistration(r,i)),_.isEmpty()&&(this.views.delete(a),_.getQuery().getQueryParams().loadsAllData()||h.push(_.getQuery())));return l&&!this.hasCompleteView()&&h.push(new e.__referenceConstructor(t.repo,t.path)),{removed:h,events:u}},e.prototype.getQueryViews=function(){var e,t,r=[];try{for(var i=n.__values(this.views.values()),o=i.next();!o.done;o=i.next()){var s=o.value;s.getQuery().getQueryParams().loadsAllData()||r.push(s)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},e.prototype.getCompleteServerCache=function(e){var t,r,i=null;try{for(var o=n.__values(this.views.values()),s=o.next();!s.done;s=o.next()){var a=s.value;i=i||a.getCompleteServerCache(e)}}catch(h){t={error:h}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i},e.prototype.viewForQuery=function(e){if(e.getQueryParams().loadsAllData())return this.getCompleteView();var t=e.queryIdentifier();return this.views.get(t)},e.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},e.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},e.prototype.getCompleteView=function(){var e,t;try{for(var r=n.__values(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.getQuery().getQueryParams().loadsAllData())return o}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return null},e}(),en=function(){function e(e){this.writeTree_=e}return e.prototype.addWrite=function(t,n){if(t.isEmpty())return new e(new Mt(n));var r=this.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,o=r.value,s=B.relativePath(i,t);return o=o.updateChild(s,n),new e(this.writeTree_.set(i,o))}var a=new Mt(n);return new e(this.writeTree_.setTree(t,a))},e.prototype.addWrites=function(e,t){var n=this;return A(t,function(t,r){n=n.addWrite(e.child(t),r)}),n},e.prototype.removeWrite=function(t){return t.isEmpty()?e.Empty:new e(this.writeTree_.setTree(t,Mt.Empty))},e.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},e.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(B.relativePath(t.path,e)):null},e.prototype.getCompleteChildren=function(){var e=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(ze,function(t,n){e.push(new ke(t,n))}):this.writeTree_.children.inorderTraversal(function(t,n){null!=n.value&&e.push(new ke(t,n.value))}),e},e.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var n=this.getCompleteNode(t);return new e(null!=n?new Mt(n):this.writeTree_.subtree(t))},e.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},e.prototype.apply=function(e){return tn(B.Empty,this.writeTree_,e)},e.Empty=new e(new Mt(null)),e}();function tn(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var i=null;return t.children.inorderTraversal(function(t,o){".priority"===t?(r.assert(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):n=tn(e.child(t),o,n)}),n.getChild(e).isEmpty()||null===i||(n=n.updateChild(e.child(".priority"),i)),n}var nn=function(){function e(){this.visibleWrites_=en.Empty,this.allWrites_=[],this.lastWriteId_=-1}return e.prototype.childWrites=function(e){return new rn(e,this)},e.prototype.addOverwrite=function(e,t,n,i){r.assert(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),this.allWrites_.push({path:e,snap:t,writeId:n,visible:i}),i&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=n},e.prototype.addMerge=function(e,t,n){r.assert(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=n},e.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var n=this.allWrites_[t];if(n.writeId===e)return n}return null},e.prototype.removeWrite=function(e){var t=this,n=this.allWrites_.findIndex(function(t){return t.writeId===e});r.assert(n>=0,"removeWrite called with nonexistent writeId.");var i=this.allWrites_[n];this.allWrites_.splice(n,1);for(var o=i.visible,s=!1,a=this.allWrites_.length-1;o&&a>=0;){var h=this.allWrites_[a];h.visible&&(a>=n&&this.recordContainsPath_(h,i.path)?o=!1:i.path.contains(h.path)&&(s=!0)),a--}if(o){if(s)return this.resetTree_(),!0;i.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(i.path):A(i.children,function(e){t.visibleWrites_=t.visibleWrites_.removeWrite(i.path.child(e))});return!0}return!1},e.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcCompleteEventCache=function(t,n,r,i){if(r||i){var o=this.visibleWrites_.childCompoundWrite(t);if(!i&&o.isEmpty())return n;if(i||null!=n||o.hasCompleteWrite(B.Empty)){var s=e.layerTree_(this.allWrites_,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))},t);u=n||st.EMPTY_NODE;return s.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(t);if(null!=a)return a;var h=this.visibleWrites_.childCompoundWrite(t);if(h.isEmpty())return n;if(null!=n||h.hasCompleteWrite(B.Empty)){var u=n||st.EMPTY_NODE;return h.apply(u)}return null},e.prototype.calcCompleteEventChildren=function(e,t){var n=st.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(e);if(r)return r.isLeafNode()||r.forEachChild(ze,function(e,t){n=n.updateImmediateChild(e,t)}),n;if(t){var i=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(ze,function(e,t){var r=i.childCompoundWrite(new B(e)).apply(t);n=n.updateImmediateChild(e,r)}),i.getCompleteChildren().forEach(function(e){n=n.updateImmediateChild(e.name,e.node)}),n}return this.visibleWrites_.childCompoundWrite(e).getCompleteChildren().forEach(function(e){n=n.updateImmediateChild(e.name,e.node)}),n},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n,i){r.assert(n||i,"Either existingEventSnap or existingServerSnap must exist");var o=e.child(t);if(this.visibleWrites_.hasCompleteWrite(o))return null;var s=this.visibleWrites_.childCompoundWrite(o);return s.isEmpty()?i.getChild(t):s.apply(i.getChild(t))},e.prototype.calcCompleteChild=function(e,t,n){var r=e.child(t),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(t)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(t)):null},e.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcIndexedSlice=function(e,t,n,r,i,o){var s,a=this.visibleWrites_.childCompoundWrite(e),h=a.getCompleteNode(B.Empty);if(null!=h)s=h;else{if(null==t)return[];s=a.apply(t)}if((s=s.withIndex(o)).isEmpty()||s.isLeafNode())return[];for(var u=[],l=o.getCompare(),c=i?s.getReverseIteratorFrom(n,o):s.getIteratorFrom(n,o),p=c.getNext();p&&u.length<r;)0!==l(p,n)&&u.push(p),p=c.getNext();return u},e.prototype.recordContainsPath_=function(e,t){if(e.snap)return e.path.contains(t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&e.path.child(n).contains(t))return!0;return!1},e.prototype.resetTree_=function(){this.visibleWrites_=e.layerTree_(this.allWrites_,e.DefaultFilter_,B.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},e.DefaultFilter_=function(e){return e.visible},e.layerTree_=function(e,t,n){for(var i=en.Empty,o=0;o<e.length;++o){var s=e[o];if(t(s)){var a=s.path,h=void 0;if(s.snap)n.contains(a)?(h=B.relativePath(n,a),i=i.addWrite(h,s.snap)):a.contains(n)&&(h=B.relativePath(a,n),i=i.addWrite(B.Empty,s.snap.getChild(h)));else{if(!s.children)throw r.assertionError("WriteRecord should have .snap or .children");if(n.contains(a))h=B.relativePath(n,a),i=i.addWrites(h,s.children);else if(a.contains(n))if((h=B.relativePath(a,n)).isEmpty())i=i.addWrites(B.Empty,s.children);else{var u=r.safeGet(s.children,h.getFront());if(u){var l=u.getChild(h.popFront());i=i.addWrite(B.Empty,l)}}}}}return i},e}(),rn=function(){function e(e,t){this.treePath_=e,this.writeTree_=t}return e.prototype.calcCompleteEventCache=function(e,t,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,n)},e.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,n)},e.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},e.prototype.calcIndexedSlice=function(e,t,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,n,r,i)},e.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)},e}(),on=function(){function e(e){this.listenProvider_=e,this.syncPointTree_=Mt.Empty,this.pendingWriteTree_=new nn,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return e.prototype.applyUserOverwrite=function(e,t,n,r){return this.pendingWriteTree_.addOverwrite(e,t,n,r),r?this.applyOperationToSyncPoints_(new qt(Ft.User,e,t)):[]},e.prototype.applyUserMerge=function(e,t,n){this.pendingWriteTree_.addMerge(e,t,n);var r=Mt.fromObject(t);return this.applyOperationToSyncPoints_(new Qt(Ft.User,e,r))},e.prototype.ackUserWrite=function(e,t){void 0===t&&(t=!1);var n=this.pendingWriteTree_.getWrite(e);if(this.pendingWriteTree_.removeWrite(e)){var r=Mt.Empty;return null!=n.snap?r=r.set(B.Empty,!0):A(n.children,function(e,t){r=r.set(new B(e),t)}),this.applyOperationToSyncPoints_(new At(n.path,r,t))}return[]},e.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new qt(Ft.Server,e,t))},e.prototype.applyServerMerge=function(e,t){var n=Mt.fromObject(t);return this.applyOperationToSyncPoints_(new Qt(Ft.Server,e,n))},e.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new Wt(Ft.Server,e))},e.prototype.applyTaggedQueryOverwrite=function(t,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var o=e.parseQueryKey_(i),s=o.path,a=o.queryId,h=B.relativePath(s,t),u=new qt(Ft.forServerTaggedQuery(a),h,n);return this.applyTaggedOperation_(s,u)}return[]},e.prototype.applyTaggedQueryMerge=function(t,n,r){var i=this.queryKeyForTag_(r);if(i){var o=e.parseQueryKey_(i),s=o.path,a=o.queryId,h=B.relativePath(s,t),u=Mt.fromObject(n),l=new Qt(Ft.forServerTaggedQuery(a),h,u);return this.applyTaggedOperation_(s,l)}return[]},e.prototype.applyTaggedListenComplete=function(t,n){var r=this.queryKeyForTag_(n);if(r){var i=e.parseQueryKey_(r),o=i.path,s=i.queryId,a=B.relativePath(o,t),h=new Wt(Ft.forServerTaggedQuery(s),a);return this.applyTaggedOperation_(o,h)}return[]},e.prototype.addEventRegistration=function(t,n){var i=t.path,o=null,s=!1;this.syncPointTree_.foreachOnPath(i,function(e,t){var n=B.relativePath(e,i);o=o||t.getCompleteServerCache(n),s=s||t.hasCompleteView()});var a,h=this.syncPointTree_.get(i);(h?(s=s||h.hasCompleteView(),o=o||h.getCompleteServerCache(B.Empty)):(h=new Zt,this.syncPointTree_=this.syncPointTree_.set(i,h)),null!=o)?a=!0:(a=!1,o=st.EMPTY_NODE,this.syncPointTree_.subtree(i).foreachChild(function(e,t){var n=t.getCompleteServerCache(B.Empty);n&&(o=o.updateImmediateChild(e,n))}));var u=h.viewExistsForQuery(t);if(!u&&!t.getQueryParams().loadsAllData()){var l=e.makeQueryKey_(t);r.assert(!this.queryToTagMap.has(l),"View does not exist, but we have a tag");var c=e.getNextQueryTag_();this.queryToTagMap.set(l,c),this.tagToQueryMap.set(c,l)}var p=this.pendingWriteTree_.childWrites(i),d=h.addEventRegistration(t,n,p,o,a);if(!u&&!s){var f=h.viewForQuery(t);d=d.concat(this.setupListener_(t,f))}return d},e.prototype.removeEventRegistration=function(t,n,r){var i=this,o=t.path,s=this.syncPointTree_.get(o),a=[];if(s&&("default"===t.queryIdentifier()||s.viewExistsForQuery(t))){var h=s.removeEventRegistration(t,n,r);s.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var u=h.removed;a=h.events;var l=-1!==u.findIndex(function(e){return e.getQueryParams().loadsAllData()}),c=this.syncPointTree_.findOnPath(o,function(e,t){return t.hasCompleteView()});if(l&&!c){var p=this.syncPointTree_.subtree(o);if(!p.isEmpty())for(var d=this.collectDistinctViewsForSubTree_(p),f=0;f<d.length;++f){var _=d[f],y=_.getQuery(),v=this.createListenerForView_(_);this.listenProvider_.startListening(e.queryForListening_(y),this.tagForQuery_(y),v.hashFn,v.onComplete)}}if(!c&&u.length>0&&!r)if(l){this.listenProvider_.stopListening(e.queryForListening_(t),null)}else u.forEach(function(t){var n=i.queryToTagMap.get(e.makeQueryKey_(t));i.listenProvider_.stopListening(e.queryForListening_(t),n)});this.removeTags_(u)}return a},e.prototype.calcCompleteEventCache=function(e,t){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(e,function(t,n){var r=B.relativePath(t,e),i=n.getCompleteServerCache(r);if(i)return i});return n.calcCompleteEventCache(e,r,t,!0)},e.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold(function(e,t,n){if(t&&t.hasCompleteView())return[t.getCompleteView()];var r=[];return t&&(r=t.getQueryViews()),A(n,function(e,t){r=r.concat(t)}),r})},e.prototype.removeTags_=function(t){for(var n=0;n<t.length;++n){var r=t[n];if(!r.getQueryParams().loadsAllData()){var i=e.makeQueryKey_(r),o=this.queryToTagMap.get(i);this.queryToTagMap.delete(i),this.tagToQueryMap.delete(o)}}},e.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e},e.prototype.setupListener_=function(t,n){var i=t.path,o=this.tagForQuery_(t),s=this.createListenerForView_(n),a=this.listenProvider_.startListening(e.queryForListening_(t),o,s.hashFn,s.onComplete),h=this.syncPointTree_.subtree(i);if(o)r.assert(!h.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var u=h.fold(function(e,t,n){if(!e.isEmpty()&&t&&t.hasCompleteView())return[t.getCompleteView().getQuery()];var r=[];return t&&(r=r.concat(t.getQueryViews().map(function(e){return e.getQuery()}))),A(n,function(e,t){r=r.concat(t)}),r}),l=0;l<u.length;++l){var c=u[l];this.listenProvider_.stopListening(e.queryForListening_(c),this.tagForQuery_(c))}return a},e.prototype.createListenerForView_=function(e){var t=this,n=e.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(e.getServerCache()||st.EMPTY_NODE).hash()},onComplete:function(e){if("ok"===e)return r?t.applyTaggedListenComplete(n.path,r):t.applyListenComplete(n.path);var i=q(e,n);return t.removeEventRegistration(n,null,i)}}},e.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},e.parseQueryKey_=function(e){var t=e.indexOf("$");return r.assert(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new B(e.substr(0,t))}},e.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap.get(e)},e.prototype.tagForQuery_=function(t){var n=e.makeQueryKey_(t);return this.queryToTagMap.get(n)},e.getNextQueryTag_=function(){return e.nextQueryTag_++},e.prototype.applyTaggedOperation_=function(e,t){var n=this.syncPointTree_.get(e);r.assert(n,"Missing sync point for query tag that we're tracking");var i=this.pendingWriteTree_.childWrites(e);return n.applyOperation(t,i,null)},e.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(B.Empty))},e.prototype.applyOperationHelper_=function(e,t,n,r){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,n,r);var i=t.get(B.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(B.Empty));var o=[],s=e.path.getFront(),a=e.operationForChild(s),h=t.children.get(s);if(h&&a){var u=n?n.getImmediateChild(s):null,l=r.child(s);o=o.concat(this.applyOperationHelper_(a,h,u,l))}return i&&(o=o.concat(i.applyOperation(e,r,n))),o},e.prototype.applyOperationDescendantsHelper_=function(e,t,n,r){var i=this,o=t.get(B.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(B.Empty));var s=[];return t.children.inorderTraversal(function(t,o){var a=n?n.getImmediateChild(t):null,h=r.child(t),u=e.operationForChild(t);u&&(s=s.concat(i.applyOperationDescendantsHelper_(u,o,a,h)))}),o&&(s=s.concat(o.applyOperation(e,r,n))),s},e.nextQueryTag_=1,e}(),sn=function(){function e(){this.rootNode_=st.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}(),an=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),r.contains(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return r.deepCopy(this.counters_)},e}(),hn=function(){function e(){}return e.getCollection=function(e){var t=e.toString();return this.collections_[t]||(this.collections_[t]=new an),this.collections_[t]},e.getOrCreateReporter=function(e,t){var n=e.toString();return this.reporters_[n]||(this.reporters_[n]=t()),this.reporters_[n]},e.collections_={},e.reporters_={},e}(),un=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=n.__assign({},e);return this.last_&&A(this.last_,function(e,n){t[e]=t[e]-n}),this.last_=e,t},e}(),ln=1e4,cn=3e4,pn=3e5,dn=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new un(e);var n=ln+(cn-ln)*Math.random();j(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.includeStat=function(e){this.statsToReport_[e]=!0},e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},i=!1;A(t,function(t,o){o>0&&r.contains(e.statsToReport_,t)&&(n[t]=o,i=!0)}),i&&this.server_.reportStats(n),j(this.reportStats_.bind(this),Math.floor(2*Math.random()*pn))},e}(),fn=function(){function e(){this.eventLists_=[],this.recursionDepth_=0}return e.prototype.queueEvents=function(e){for(var t=null,n=0;n<e.length;n++){var r=e[n],i=r.getPath();null===t||i.equals(t.getPath())||(this.eventLists_.push(t),t=null),null===t&&(t=new _n(i)),t.add(r)}t&&this.eventLists_.push(t)},e.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},e.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},e.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)e(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):t=!1}t&&(this.eventLists_=[]),this.recursionDepth_--},e}(),_n=function(){function e(e){this.path_=e,this.events_=[]}return e.prototype.add=function(e){this.events_.push(e)},e.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var n=t.getEventRunner();v&&C("event: "+t.toString()),V(n)}}},e.prototype.getPath=function(){return this.path_},e}(),yn=function(){function e(e){this.allowedEvents_=e,this.listeners_={},r.assert(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(Array.isArray(this.listeners_[e]))for(var i=n.__spread(this.listeners_[e]),o=0;o<i.length;o++)i[o].callback.apply(i[o].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){r.assert(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},e}(),vn=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))},!1),r}return n.__extends(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return r.assert("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(yn),gn=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||r.isMobileCordova()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}return n.__extends(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return r.assert("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(yn),mn=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&V(function(){n.onMessage_(e[t])})},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},e}(),Cn="start",En="close",wn="pLPCommand",Tn="pRTLPCB",bn="id",Sn="pw",In="ser",Nn="cb",Pn="seg",Rn="ts",xn="d",Dn="dframe",kn=1870,On=30,Fn=kn-On,An=25e3,Ln=3e4,Mn=function(){function e(e,t,n,r,i){this.connId=e,this.repoInfo=t,this.applicationId=n,this.transportSessionId=r,this.lastSessionId=i,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=E(e),this.stats_=hn.getCollection(t),this.urlFn=function(e){return t.connectionURL(ne,e)}}return e.prototype.open=function(e,t){var r=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new mn(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){r.log_("Timed out trying to connect."),r.onClosed_(),r.connectTimeoutTimer_=null},Math.floor(Ln)),N(function(){if(!r.isClosed_){r.scriptTagHolder=new Wn(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=n.__read(e,5),o=i[0],s=i[1],a=i[2];i[3],i[4];if(r.incrementIncomingBytes_(e),r.scriptTagHolder)if(r.connectTimeoutTimer_&&(clearTimeout(r.connectTimeoutTimer_),r.connectTimeoutTimer_=null),r.everConnected_=!0,o===Cn)r.id=s,r.password=a;else{if(o!==En)throw new Error("Unrecognized command received: "+o);s?(r.scriptTagHolder.sendNewPolls=!1,r.myPacketOrderer.closeAfter(s,function(){r.onClosed_()})):r.onClosed_()}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=n.__read(e,2),o=i[0],s=i[1];r.incrementIncomingBytes_(e),r.myPacketOrderer.handleResponse(o,s)},function(){r.onClosed_()},r.urlFn);var e={};e[Cn]="t",e[In]=Math.floor(1e8*Math.random()),r.scriptTagHolder.uniqueCallbackIdentifier&&(e[Nn]=r.scriptTagHolder.uniqueCallbackIdentifier),e[z]=Y,r.transportSessionId&&(e[G]=r.transportSessionId),r.lastSessionId&&(e[Z]=r.lastSessionId),r.applicationId&&(e[ee]=r.applicationId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(J)&&(e[X]=$);var t=r.urlFn(e);r.log_("Connecting via long-poll to "+t),r.scriptTagHolder.addTag(t,function(){})}})},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!r.isNodeSdk()&&(!!e.forceAllow_||!e.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!M()&&!W())},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=r.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=r.base64Encode(t),i=F(n,Fn),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!r.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe");var n={};n[Dn]="t",n[bn]=e,n[Sn]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=r.stringify(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),Wn=function(){function e(t,n,i,o){if(this.onDisconnect=i,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,r.isNodeSdk())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=f(),window[wn+this.uniqueCallbackIdentifier]=t,window[Tn+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var s="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))s='<script>document.domain="'+document.domain+'";<\/script>';var a="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(h){C("frame writing exception"),h.stack&&C(h.stack),C(h)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||C("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e[bn]=this.myID,e[Sn]=this.myPW,e[In]=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+On+n.length<=kn))break;var i=this.pendingSegs.shift();n=n+"&"+Pn+r+"="+i.seg+"&"+Rn+r+"="+i.ts+"&"+xn+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(An));this.addTag(e,function(){clearTimeout(i),r()})},e.prototype.addTag=function(e,t){var n=this;r.isNodeSdk()?this.doNodeLongPoll(e,t):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){C("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}},Math.floor(1))},e}(),qn="";function Qn(e){qn=e}var Un=16384,Vn=45e3,Hn=null;"undefined"!=typeof MozWebSocket?Hn=MozWebSocket:"undefined"!=typeof WebSocket&&(Hn=WebSocket);var jn=function(){function t(e,n,r,i,o){this.connId=e,this.applicationId=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=E(this.connId),this.stats_=hn.getCollection(n),this.connURL=t.connectionURL_(n,i,o),this.nodeAdmin=n.nodeAdmin}return t.connectionURL_=function(e,t,n){var i={};return i[z]=Y,!r.isNodeSdk()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(J)&&(i[X]=$),t&&(i[G]=t),n&&(i[Z]=n),e.connectionURL(te,i)},t.prototype.open=function(t,n){var i=this;this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,c.set("previous_websocket_failure",!0);try{if(r.isNodeSdk()){var o=this.nodeAdmin?"AdminNode":"Node",s={headers:{"User-Agent":"Firebase/"+Y+"/"+qn+"/"+e.platform+"/"+o,"X-Firebase-GMPID":this.applicationId||""}},a=e.env,h=0===this.connURL.indexOf("wss://")?a.HTTPS_PROXY||a.https_proxy:a.HTTP_PROXY||a.http_proxy;h&&(s.proxy={origin:h}),this.mySock=new Hn(this.connURL,[],s)}else{s={headers:{"X-Firebase-GMPID":this.applicationId||""}};this.mySock=new Hn(this.connURL,[],s)}}catch(l){this.log_("Error instantiating WebSocket.");var u=l.message||l.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=function(){i.log_("Websocket connected."),i.everConnected_=!0},this.mySock.onclose=function(){i.log_("Websocket connection was disconnected."),i.mySock=null,i.onClosed_()},this.mySock.onmessage=function(e){i.handleIncomingFrame(e)},this.mySock.onerror=function(e){i.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&i.log_(t),i.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Hn&&!t.forceDisallow_},t.previouslyFailed=function(){return c.isInMemoryStorage||!0===c.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){c.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=r.jsonEval(t);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},t.prototype.extractFrameCount_=function(e){if(r.assert(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},t.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(e){this.resetKeepAlive();var t=r.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=F(t,Un);n.length>1&&this.sendString_(String(n.length));for(var i=0;i<n.length;i++)this.sendString_(n[i])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()},Math.floor(Vn))},t.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),Bn=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[Mn,jn]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var r,i,o=jn&&jn.isAvailable(),s=o&&!jn.previouslyFailed();if(t.webSocketOnly&&(o||b("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[jn];else{var a=this.transports_=[];try{for(var h=n.__values(e.ALL_TRANSPORTS),u=h.next();!u.done;u=h.next()){var l=u.value;l&&l.isAvailable()&&a.push(l)}}catch(c){r={error:c}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),Kn=6e4,Yn=5e3,zn=10240,Gn=102400,Xn="t",$n="d",Jn="s",Zn="r",er="e",tr="o",nr="a",rr="n",ir="p",or="h",sr=function(){function e(e,t,n,r,i,o,s,a){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.onMessage_=r,this.onReady_=i,this.onDisconnect_=o,this.onKill_=s,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=E("c:"+this.id+":"),this.transportManager_=new Bn(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){e.conn_&&e.conn_.open(n,r)},Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=j(function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>Gn?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>zn?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))},Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if(Xn in e){var t=e[Xn];t===nr?this.upgradeIfSecondaryHealthy_():t===Zn?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):t===tr&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=k("t",e),n=k("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:ir,d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:nr,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:rr,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=k("t",e),n=k("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=k(Xn,e);if($n in e){var n=e[$n];if(t===or)this.onHandshake_(n);else if(t===rr){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Jn?this.onConnectionShutdown_(n):t===Zn?this.onReset_(n):t===er?w("Server Error: "+n):t===tr?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):w("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Y!==n&&b("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),j(function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())},Math.floor(Kn))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):j(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(Yn))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:ir,d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(c.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),ar=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),hr=1e3,ur=3e5,lr=3e4,cr=1.3,pr=3e4,dr="server_kill",fr=3,_r=function(e){function t(n,i,o,s,a,h,u){var l=e.call(this)||this;if(l.repoInfo_=n,l.applicationId_=i,l.onDataUpdate_=o,l.onConnectStatus_=s,l.onServerInfoUpdate_=a,l.authTokenProvider_=h,l.authOverride_=u,l.id=t.nextPersistentConnectionId_++,l.log_=E("p:"+l.id+":"),l.interruptReasons_={},l.listens=new Map,l.outstandingPuts_=[],l.outstandingPutCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=hr,l.maxReconnectDelay_=ur,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,u&&!r.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return l.scheduleConnect_(0),vn.getInstance().on("visible",l.onVisible_,l),-1===n.host.indexOf("fblocal")&&gn.getInstance().on("online",l.onOnline_,l),l}return n.__extends(t,e),t.prototype.sendRequest=function(e,t,n){var i=++this.requestNumber_,o={r:i,a:e,b:t};this.log_(r.stringify(o)),r.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),n&&(this.requestCBHash_[i]=n)},t.prototype.listen=function(e,t,n,i){var o=e.queryIdentifier(),s=e.path.toString();this.log_("Listen called for "+s+" "+o),this.listens.has(s)||this.listens.set(s,new Map),r.assert(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),r.assert(!this.listens.get(s).has(o),"listen() called twice for same path/queryId.");var a={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(o,a),this.connected_&&this.sendListen_(a)},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r.path.toString(),o=r.queryIdentifier();this.log_("Listen on "+i+" for "+o);var s={p:i};e.tag&&(s.q=r.queryObject(),s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,function(s){var a=s.d,h=s.s;t.warnOnListenWarnings_(a,r),(n.listens.get(i)&&n.listens.get(i).get(o))===e&&(n.log_("listen response",s),"ok"!==h&&n.removeListen_(i,o),e.onComplete&&e.onComplete(h,a))})},t.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&r.contains(e,"w")){var n=r.safeGet(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var i='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"',o=t.path.toString();b("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+i+" at "+o+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||r.isAdmin(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=lr)},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=r.isValidFormat(t)?"auth":"gauth",i={cred:t};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(n,i,function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))})}},t.prototype.unlisten=function(e,t){var n=e.path.toString(),i=e.queryIdentifier();this.log_("Unlisten called for "+n+" "+i),r.assert(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e.queryObject(),t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,function(e){r&&setTimeout(function(){r(e.s,e.d)},Math.floor(0))})},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){var o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)})},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}})}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+r.stringify(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):w("Unrecognized action received from server: "+r.stringify(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;r.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){t.establishConnectionTimer_=null,t.establishConnection_()},Math.floor(e))},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=hr,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=hr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>pr&&(this.reconnectDelay_=hr),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*cr)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){var e=this;if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var n=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),o=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+t.nextConnectionId_++,a=this,h=this.lastSessionId,u=!1,l=null,c=function(){l?l.close():(u=!0,o())};this.realtime_={close:c,sendRequest:function(e){r.assert(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(e)}};var p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(p).then(function(e){u?C("getToken() completed but was canceled"):(C("getToken() completed. Creating connection."),a.authToken_=e&&e.accessToken,l=new sr(s,a.repoInfo_,a.applicationId_,n,i,o,function(e){b(e+" ("+a.repoInfo_.toString()+")"),a.interrupt(dr)},h))}).then(null,function(t){a.log_("Failed to get token: "+t),u||(e.repoInfo_.nodeAdmin&&b(t),c())})}},t.prototype.interrupt=function(e){C("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){C("Resuming connection for reason: "+e),delete this.interruptReasons_[e],r.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=hr,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map(function(e){return O(e)}).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new B(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){C("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=fr&&(this.reconnectDelay_=lr,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,r,i;this.tryAuth();try{for(var o=n.__values(this.listens.values()),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var h=(r=void 0,n.__values(a.values())),u=h.next();!u.done;u=h.next()){var l=u.value;this.sendListen_(l)}}catch(d){r={error:d}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var c=0;c<this.outstandingPuts_.length;c++)this.outstandingPuts_[c]&&this.sendPut_(c);for(;this.onDisconnectRequestQueue_.length;){var p=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(p.action,p.pathString,p.data,p.onComplete)}},t.prototype.sendConnectStats_=function(){var e={},t="js";r.isNodeSdk()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+qn.replace(/\./g,"-")]=1,r.isMobileCordova()?e["framework.cordova"]=1:r.isReactNative()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=gn.getInstance().currentlyOnline();return r.isEmpty(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(ar),yr=function(e){function t(t,n,r){var i=e.call(this)||this;return i.repoInfo_=t,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=E("p:rest:"),i.listens_={},i}return n.__extends(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(r.assert(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())},t.prototype.listen=function(e,n,i,o){var s=this,a=e.path.toString();this.log_("Listen called for "+a+" "+e.queryIdentifier());var h=t.getListenId_(e,i),u={};this.listens_[h]=u;var l=e.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",l,function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&s.onDataUpdate_(a,n,!1,i),r.safeGet(s.listens_,h)===u)&&o(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var i=this;void 0===t&&(t={}),t.format="export",this.authTokenProvider_.getToken(!1).then(function(o){var s=o&&o.accessToken;s&&(t.auth=s);var a=(i.repoInfo_.secure?"https://":"http://")+i.repoInfo_.host+e+"?ns="+i.repoInfo_.namespace+r.querystring(t);i.log_("Sending REST request for "+a);var h=new XMLHttpRequest;h.onreadystatechange=function(){if(n&&4===h.readyState){i.log_("REST Response for "+a+" received. status:",h.status,"response:",h.responseText);var e=null;if(h.status>=200&&h.status<300){try{e=r.jsonEval(h.responseText)}catch(t){b("Failed to parse JSON response for "+a+": "+h.responseText)}n(null,e)}else 401!==h.status&&404!==h.status&&b("Got unsuccessful REST response for "+a+" Status: "+h.status),n(h.status);n=null}},h.open("GET",a,!0),h.send()})},t}(ar),vr="repo_interrupt",gr=function(){function e(e,t,n,i){var o=this;if(this.repoInfo_=e,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new fn,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Dt,this.persistentConnection_=null,this.stats_=hn.getCollection(e),t||H())this.server_=new yr(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var s=n.options.databaseAuthVariableOverride;if(null!=s){if("object"!=typeof s)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{r.stringify(s)}catch(a){throw new Error("Invalid authOverride provided: "+a)}}this.persistentConnection_=new _r(this.repoInfo_,n.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,s),this.server_=this.persistentConnection_}i.addTokenChangeListener(function(e){o.server_.refreshAuthToken(e)}),this.statsReporter_=hn.getOrCreateReporter(e,function(){return new dn(o.stats_,o.server_)}),this.transactionsInit_(),this.infoData_=new sn,this.infoSyncTree_=new on({startListening:function(e,t,n,r){var i=[],s=o.infoData_.getNode(e.path);return s.isEmpty()||(i=o.infoSyncTree_.applyServerOverwrite(e.path,s),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new on({startListening:function(e,t,n,r){return o.server_.listen(e,n,t,function(t,n){var i=r(t,n);o.eventQueue_.raiseEventsForChangedPath(e.path,i)}),[]},stopListening:function(e,t){o.server_.unlisten(e,t)}})}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e.prototype.name=function(){return this.repoInfo_.namespace},e.prototype.serverTime=function(){var e=this.infoData_.getNode(new B(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e},e.prototype.generateServerValues=function(){return Tt({timestamp:this.serverTime()})},e.prototype.onDataUpdate_=function(e,t,n,i){this.dataUpdateCount++;var o=new B(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var s=[];if(i)if(n){var a=r.map(t,function(e){return lt(e)});s=this.serverSyncTree_.applyTaggedQueryMerge(o,a,i)}else{var h=lt(t);s=this.serverSyncTree_.applyTaggedQueryOverwrite(o,h,i)}else if(n){var u=r.map(t,function(e){return lt(e)});s=this.serverSyncTree_.applyServerMerge(o,u)}else{var l=lt(t);s=this.serverSyncTree_.applyServerOverwrite(o,l)}var c=o;s.length>0&&(c=this.rerunTransactions_(o)),this.eventQueue_.raiseEventsForChangedPath(c,s)},e.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e},e.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e),!1===e&&this.runOnDisconnectEvents_()},e.prototype.onServerInfoUpdate_=function(e){var t=this;A(e,function(e,n){t.updateInfo_(e,n)})},e.prototype.updateInfo_=function(e,t){var n=new B("/.info/"+e),r=lt(t);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},e.prototype.getNextWriteId_=function(){return this.nextWriteId_++},e.prototype.setWithPriority=function(e,t,n,r){var i=this;this.log_("set",{path:e.toString(),value:t,priority:n});var o=this.generateServerValues(),s=lt(t,n),a=this.serverSyncTree_.calcCompleteEventCache(e),h=Pt(s,a,o),u=this.getNextWriteId_(),l=this.serverSyncTree_.applyUserOverwrite(e,h,u,!0);this.eventQueue_.queueEvents(l),this.server_.put(e.toString(),s.val(!0),function(t,n){var o="ok"===t;o||b("set at "+e+" failed: "+t);var s=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(e,s),i.callOnCompleteCallback(r,t,n)});var c=this.abortTransactions_(e);this.rerunTransactions_(c),this.eventQueue_.raiseEventsForChangedPath(c,[])},e.prototype.update=function(e,t,n){var r=this;this.log_("update",{path:e.toString(),value:t});var i=!0,o=this.generateServerValues(),s={};if(A(t,function(t,n){i=!1,s[t]=Nt(e.child(t),lt(n),r.serverSyncTree_,o)}),i)C("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var a=this.getNextWriteId_(),h=this.serverSyncTree_.applyUserMerge(e,s,a);this.eventQueue_.queueEvents(h),this.server_.merge(e.toString(),t,function(t,i){var o="ok"===t;o||b("update at "+e+" failed: "+t);var s=r.serverSyncTree_.ackUserWrite(a,!o),h=s.length>0?r.rerunTransactions_(e):e;r.eventQueue_.raiseEventsForChangedPath(h,s),r.callOnCompleteCallback(n,t,i)}),A(t,function(t){var n=r.abortTransactions_(e.child(t));r.rerunTransactions_(n)}),this.eventQueue_.raiseEventsForChangedPath(e,[])}},e.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),n=new Dt;this.onDisconnect_.forEachTree(B.Empty,function(r,i){var o=Nt(r,i,e.serverSyncTree_,t);n.remember(r,o)});var r=[];n.forEachTree(B.Empty,function(t,n){r=r.concat(e.serverSyncTree_.applyServerOverwrite(t,n));var i=e.abortTransactions_(t);e.rerunTransactions_(i)}),this.onDisconnect_=new Dt,this.eventQueue_.raiseEventsForChangedPath(B.Empty,r)},e.prototype.onDisconnectCancel=function(e,t){var n=this;this.server_.onDisconnectCancel(e.toString(),function(r,i){"ok"===r&&n.onDisconnect_.forget(e),n.callOnCompleteCallback(t,r,i)})},e.prototype.onDisconnectSet=function(e,t,n){var r=this,i=lt(t);this.server_.onDisconnectPut(e.toString(),i.val(!0),function(t,o){"ok"===t&&r.onDisconnect_.remember(e,i),r.callOnCompleteCallback(n,t,o)})},e.prototype.onDisconnectSetWithPriority=function(e,t,n,r){var i=this,o=lt(t,n);this.server_.onDisconnectPut(e.toString(),o.val(!0),function(t,n){"ok"===t&&i.onDisconnect_.remember(e,o),i.callOnCompleteCallback(r,t,n)})},e.prototype.onDisconnectUpdate=function(e,t,n){var i=this;if(r.isEmpty(t))return C("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(e.toString(),t,function(r,o){"ok"===r&&A(t,function(t,n){var r=lt(n);i.onDisconnect_.remember(e.child(t),r)}),i.callOnCompleteCallback(n,r,o)})},e.prototype.addEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.removeEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(vr)},e.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(vr)},e.prototype.stats=function(e){if(void 0===e&&(e=!1),"undefined"!=typeof console){var t;e?(this.statsListener_||(this.statsListener_=new un(this.stats_)),t=this.statsListener_.get()):t=this.stats_.get();var n=Object.keys(t).reduce(function(e,t){return Math.max(t.length,e)},0);A(t,function(e,t){for(var r=e,i=e.length;i<n+2;i++)r+=" ";console.log(r+t)})}},e.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},e.prototype.log_=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="";this.persistentConnection_&&(r=this.persistentConnection_.id+":"),C.apply(void 0,n.__spread([r],e))},e.prototype.callOnCompleteCallback=function(e,t,n){e&&V(function(){if("ok"===t)e(null);else{var r=(t||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,e(o)}})},Object.defineProperty(e.prototype,"database",{get:function(){return this.__database||(this.__database=new Dr(this))},enumerable:!1,configurable:!0}),e}(),mr=function(){function e(t){this.indexedFilter_=new jt(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new ke(t,n))||(n=st.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=st.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(st.EMPTY_NODE);var i=this;return t.forEachChild(ze,function(e,t){i.matches(new ke(e,t))||(r=r.updateImmediateChild(e,st.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),Cr=function(){function e(e){this.rangedFilter_=new mr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,o){return this.rangedFilter_.matches(new ke(t,n))||(n=st.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=st.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=st.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=t.withIndex(this.index_)).updatePriority(st.EMPTY_NODE);var a=void 0,h=void 0,u=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),h=this.rangedFilter_.getStartPost();var l=this.index_.getCompare();u=function(e,t){return l(t,e)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),h=this.rangedFilter_.getEndPost(),u=this.index_.getCompare();o=0;for(var c=!1;i.hasNext();){s=i.getNext();!c&&u(a,s)<=0&&(c=!0),c&&o<this.limit_&&u(s,h)<=0?o++:r=r.updateImmediateChild(s.name,st.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,i,o){var s;if(this.reverse_){var a=this.index_.getCompare();s=function(e,t){return a(t,e)}}else s=this.index_.getCompare();var h=e;r.assert(h.numChildren()===this.limit_,"");var u=new ke(t,n),l=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),c=this.rangedFilter_.matches(u);if(h.hasChild(t)){for(var p=h.getImmediateChild(t),d=i.getChildAfterChild(this.index_,l,this.reverse_);null!=d&&(d.name===t||h.hasChild(d.name));)d=i.getChildAfterChild(this.index_,d,this.reverse_);var f=null==d?1:s(d,u);if(c&&!n.isEmpty()&&f>=0)return null!=o&&o.trackChildChange(Ht.childChangedChange(t,n,p)),h.updateImmediateChild(t,n);null!=o&&o.trackChildChange(Ht.childRemovedChange(t,p));var _=h.updateImmediateChild(t,st.EMPTY_NODE);return null!=d&&this.rangedFilter_.matches(d)?(null!=o&&o.trackChildChange(Ht.childAddedChange(d.name,d.node)),_.updateImmediateChild(d.name,d.node)):_}return n.isEmpty()?e:c&&s(l,u)>=0?(null!=o&&(o.trackChildChange(Ht.childRemovedChange(l.name,l.node)),o.trackChildChange(Ht.childAddedChange(t,n))),h.updateImmediateChild(t,n).updateImmediateChild(l.name,st.EMPTY_NODE)):e},e}(),Er=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ze}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},e.prototype.getIndexStartValue=function(){return r.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return r.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:P},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return r.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return r.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:R},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return r.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.copy_=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},e.prototype.limitToFirst=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},e.prototype.limitToLast=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},e.prototype.startAt=function(e,t){var n=this.copy_();return n.startSet_=!0,void 0===e&&(e=null),n.indexStartValue_=e,null!=t?(n.startNameSet_=!0,n.indexStartName_=t):(n.startNameSet_=!1,n.indexStartName_=""),n},e.prototype.endAt=function(e,t){var n=this.copy_();return n.endSet_=!0,void 0===e&&(e=null),n.indexEndValue_=e,void 0!==t?(n.endNameSet_=!0,n.indexEndName_=t):(n.endNameSet_=!1,n.indexEndName_=""),n},e.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},e.prototype.getQueryObject=function(){var t=e.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[t.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),n[t.VIEW_FROM]=r}return this.index_!==ze&&(n[t.INDEX]=this.index_.toString()),n},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===ze},e.prototype.getNodeFilter=function(){return this.loadsAllData()?new jt(this.getIndex()):this.hasLimit()?new Cr(this):new mr(this)},e.prototype.toRestQueryStringParameters=function(){var t,n=e.REST_QUERY_CONSTANTS_,i={};return this.isDefault()?i:(this.index_===ze?t=n.PRIORITY_INDEX:this.index_===dt?t=n.VALUE_INDEX:this.index_===Ae?t=n.KEY_INDEX:(r.assert(this.index_ instanceof ft,"Unrecognized index type!"),t=this.index_.toString()),i[n.ORDER_BY]=r.stringify(t),this.startSet_&&(i[n.START_AT]=r.stringify(this.indexStartValue_),this.startNameSet_&&(i[n.START_AT]+=","+r.stringify(this.indexStartName_))),this.endSet_&&(i[n.END_AT]=r.stringify(this.indexEndValue_),this.endNameSet_&&(i[n.END_AT]+=","+r.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?i[n.LIMIT_TO_FIRST]=this.limit_:i[n.LIMIT_TO_LAST]=this.limit_),i)},e.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},e.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},e.DEFAULT=new e,e}(),wr=function(e){function t(t,n){if(!(t instanceof gr))throw new Error("new Reference() no longer supported - use app.database().");return e.call(this,t,n,Er.DEFAULT,!1)||this}return n.__extends(t,e),t.prototype.getKey=function(){return r.validateArgCount("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},t.prototype.child=function(e){return r.validateArgCount("Reference.child",1,1,arguments.length),"number"==typeof e?e=String(e):e instanceof B||(null===this.path.getFront()?Se("Reference.child",1,e,!1):be("Reference.child",1,e,!1)),new t(this.repo,this.path.child(e))},t.prototype.getParent=function(){r.validateArgCount("Reference.parent",0,0,arguments.length);var e=this.path.parent();return null===e?null:new t(this.repo,e)},t.prototype.getRoot=function(){r.validateArgCount("Reference.root",0,0,arguments.length);for(var e=this;null!==e.getParent();)e=e.getParent();return e},t.prototype.databaseProp=function(){return this.repo.database},t.prototype.set=function(e,t){r.validateArgCount("Reference.set",1,2,arguments.length),Ie("Reference.set",this.path),ve("Reference.set",1,e,this.path,!1),r.validateCallback("Reference.set",2,t,!0);var n=new r.Deferred;return this.repo.setWithPriority(this.path,e,null,n.wrapCallback(t)),n.promise},t.prototype.update=function(e,t){if(r.validateArgCount("Reference.update",1,2,arguments.length),Ie("Reference.update",this.path),Array.isArray(e)){for(var n={},i=0;i<e.length;++i)n[""+i]=e[i];e=n,b("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ce("Reference.update",1,e,this.path,!1),r.validateCallback("Reference.update",2,t,!0);var o=new r.Deferred;return this.repo.update(this.path,e,o.wrapCallback(t)),o.promise},t.prototype.setWithPriority=function(e,t,n){if(r.validateArgCount("Reference.setWithPriority",2,3,arguments.length),Ie("Reference.setWithPriority",this.path),ve("Reference.setWithPriority",1,e,this.path,!1),Ee("Reference.setWithPriority",2,t,!1),r.validateCallback("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var i=new r.Deferred;return this.repo.setWithPriority(this.path,e,t,i.wrapCallback(n)),i.promise},t.prototype.remove=function(e){return r.validateArgCount("Reference.remove",0,1,arguments.length),Ie("Reference.remove",this.path),r.validateCallback("Reference.remove",1,e,!0),this.set(null,e)},t.prototype.transaction=function(e,t,n){if(r.validateArgCount("Reference.transaction",1,3,arguments.length),Ie("Reference.transaction",this.path),r.validateCallback("Reference.transaction",1,e,!1),r.validateCallback("Reference.transaction",2,t,!0),Pe("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var i=new r.Deferred;"function"==typeof t&&i.promise.catch(function(){});return this.repo.startTransaction(this.path,e,function(e,n,r){e?i.reject(e):i.resolve(new xe(n,r)),"function"==typeof t&&t(e,n,r)},n),i.promise},t.prototype.setPriority=function(e,t){r.validateArgCount("Reference.setPriority",1,2,arguments.length),Ie("Reference.setPriority",this.path),Ee("Reference.setPriority",1,e,!1),r.validateCallback("Reference.setPriority",2,t,!0);var n=new r.Deferred;return this.repo.setWithPriority(this.path.child(".priority"),e,null,n.wrapCallback(t)),n.promise},t.prototype.push=function(e,t){r.validateArgCount("Reference.push",0,2,arguments.length),Ie("Reference.push",this.path),ve("Reference.push",1,e,this.path,!0),r.validateCallback("Reference.push",2,t,!0);var n,i=this.repo.serverTime(),o=De(i),s=this.child(o),a=this.child(o);return n=null!=e?s.set(e,t).then(function(){return a}):Promise.resolve(a),s.then=n.then.bind(n),s.catch=n.then.bind(n,void 0),"function"==typeof t&&n.catch(function(){}),s},t.prototype.onDisconnect=function(){return Ie("Reference.onDisconnect",this.path),new Re(this.repo,this.path)},Object.defineProperty(t.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}(Ct);Ct.__referenceConstructor=wr,Zt.__referenceConstructor=wr;var Tr,br=function(){return function(){this.children={},this.childCount=0,this.value=null}}(),Sr=function(){function e(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n=new br),this.name_=e,this.parent_=t,this.node_=n}return e.prototype.subTree=function(t){for(var n=t instanceof B?t:new B(t),i=this,o=n.getFront();null!==o;){i=new e(o,i,r.safeGet(i.node_.children,o)||new br),o=(n=n.popFront()).getFront()}return i},e.prototype.getValue=function(){return this.node_.value},e.prototype.setValue=function(e){r.assert(void 0!==e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},e.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},e.prototype.hasChildren=function(){return this.node_.childCount>0},e.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},e.prototype.forEachChild=function(t){var n=this;A(this.node_.children,function(r,i){t(new e(r,n,i))})},e.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},e.prototype.forEachAncestor=function(e,t){for(var n=t?this:this.parent();null!==n;){if(e(n))return!0;n=n.parent()}return!1},e.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},e.prototype.path=function(){return new B(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},e.prototype.name=function(){return this.name_},e.prototype.parent=function(){return this.parent_},e.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},e.prototype.updateChild_=function(e,t){var n=t.isEmpty(),i=r.contains(this.node_.children,e);n&&i?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):n||i||(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())},e}();!function(e){e[e.RUN=0]="RUN",e[e.SENT=1]="SENT",e[e.COMPLETED=2]="COMPLETED",e[e.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",e[e.NEEDS_ABORT=4]="NEEDS_ABORT"}(Tr||(Tr={})),gr.MAX_TRANSACTION_RETRIES_=25,gr.prototype.transactionsInit_=function(){this.transactionQueueTree_=new Sr},gr.prototype.startTransaction=function(e,t,n,i){this.log_("transaction on "+e);var o=function(){},s=new wr(this,e);s.on("value",o);var a={path:e,update:t,onComplete:n,status:null,order:f(),applyLocally:i,retryCount:0,unwatcher:function(){s.off("value",o)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=this.getLatestState_(e);a.currentInputSnapshot=h;var u=a.update(h.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var l=new _t(a.currentInputSnapshot,new wr(this,a.path),ze);a.onComplete(null,!1,l)}}else{ge("transaction failed: Data returned ",u,a.path),a.status=Tr.RUN;var c=this.transactionQueueTree_.subTree(e),p=c.getValue()||[];p.push(a),c.setValue(p);var d=void 0;if("object"==typeof u&&null!==u&&r.contains(u,".priority"))d=r.safeGet(u,".priority"),r.assert(ye(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else d=(this.serverSyncTree_.calcCompleteEventCache(e)||st.EMPTY_NODE).getPriority().val();d=d;var _=this.generateServerValues(),y=lt(u,d),v=Pt(y,h,_);a.currentOutputSnapshotRaw=y,a.currentOutputSnapshotResolved=v,a.currentWriteId=this.getNextWriteId_();var g=this.serverSyncTree_.applyUserOverwrite(e,v,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(e,g),this.sendReadyTransactions_()}},gr.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||st.EMPTY_NODE},gr.prototype.sendReadyTransactions_=function(e){var t=this;if(void 0===e&&(e=this.transactionQueueTree_),e||this.pruneCompletedTransactionsBelowNode_(e),null!==e.getValue()){var n=this.buildTransactionQueue_(e);r.assert(n.length>0,"Sending zero length transaction queue"),n.every(function(e){return e.status===Tr.RUN})&&this.sendTransactionQueue_(e.path(),n)}else e.hasChildren()&&e.forEachChild(function(e){t.sendReadyTransactions_(e)})},gr.prototype.sendTransactionQueue_=function(e,t){for(var n=this,i=t.map(function(e){return e.currentWriteId}),o=this.getLatestState_(e,i),s=o,a=o.hash(),h=0;h<t.length;h++){var u=t[h];r.assert(u.status===Tr.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=Tr.SENT,u.retryCount++;var l=B.relativePath(e,u.path);s=s.updateChild(l,u.currentOutputSnapshotRaw)}var c=s.val(!0),p=e;this.server_.put(p.toString(),c,function(r){n.log_("transaction put response",{path:p.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=0;s<t.length;s++){if(t[s].status=Tr.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(t[s].currentWriteId)),t[s].onComplete){var a=t[s].currentOutputSnapshotResolved,h=new wr(n,t[s].path),u=new _t(a,h,ze);o.push(t[s].onComplete.bind(null,null,!0,u))}t[s].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(e)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(e,i);for(s=0;s<o.length;s++)V(o[s])}else{if("datastale"===r)for(s=0;s<t.length;s++)t[s].status===Tr.SENT_NEEDS_ABORT?t[s].status=Tr.NEEDS_ABORT:t[s].status=Tr.RUN;else{b("transaction at "+p.toString()+" failed: "+r);for(s=0;s<t.length;s++)t[s].status=Tr.NEEDS_ABORT,t[s].abortReason=r}n.rerunTransactions_(e)}},a)},gr.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e),n=t.path(),r=this.buildTransactionQueue_(t);return this.rerunTransactionQueue_(r,n),n},gr.prototype.rerunTransactionQueue_=function(e,t){if(0!==e.length){for(var n,i=[],o=[],s=e.filter(function(e){return e.status===Tr.RUN}).map(function(e){return e.currentWriteId}),a=0;a<e.length;a++){var h=e[a],u=B.relativePath(t,h.path),l=!1,c=void 0;if(r.assert(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),h.status===Tr.NEEDS_ABORT)l=!0,c=h.abortReason,o=o.concat(this.serverSyncTree_.ackUserWrite(h.currentWriteId,!0));else if(h.status===Tr.RUN)if(h.retryCount>=gr.MAX_TRANSACTION_RETRIES_)l=!0,c="maxretry",o=o.concat(this.serverSyncTree_.ackUserWrite(h.currentWriteId,!0));else{var p=this.getLatestState_(h.path,s);h.currentInputSnapshot=p;var d=e[a].update(p.val());if(void 0!==d){ge("transaction failed: Data returned ",d,h.path);var f=lt(d);"object"==typeof d&&null!=d&&r.contains(d,".priority")||(f=f.updatePriority(p.getPriority()));var _=h.currentWriteId,y=this.generateServerValues(),v=Pt(f,p,y);h.currentOutputSnapshotRaw=f,h.currentOutputSnapshotResolved=v,h.currentWriteId=this.getNextWriteId_(),s.splice(s.indexOf(_),1),o=(o=o.concat(this.serverSyncTree_.applyUserOverwrite(h.path,v,h.currentWriteId,h.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(_,!0))}else l=!0,c="nodata",o=o.concat(this.serverSyncTree_.ackUserWrite(h.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(t,o),o=[],l&&(e[a].status=Tr.COMPLETED,n=e[a].unwatcher,setTimeout(n,Math.floor(0)),e[a].onComplete))if("nodata"===c){var g=new wr(this,e[a].path),m=e[a].currentInputSnapshot,C=new _t(m,g,ze);i.push(e[a].onComplete.bind(null,null,!1,C))}else i.push(e[a].onComplete.bind(null,new Error(c),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<i.length;a++)V(i[a]);this.sendReadyTransactions_()}},gr.prototype.getAncestorTransactionNode_=function(e){var t,n=this.transactionQueueTree_;for(t=e.getFront();null!==t&&null===n.getValue();)n=n.subTree(t),t=(e=e.popFront()).getFront();return n},gr.prototype.buildTransactionQueue_=function(e){var t=[];return this.aggregateTransactionQueuesForNode_(e,t),t.sort(function(e,t){return e.order-t.order}),t},gr.prototype.aggregateTransactionQueuesForNode_=function(e,t){var n=this,r=e.getValue();if(null!==r)for(var i=0;i<r.length;i++)t.push(r[i]);e.forEachChild(function(e){n.aggregateTransactionQueuesForNode_(e,t)})},gr.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=this,n=e.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Tr.COMPLETED&&(n[r]=n[i],r++);n.length=r,e.setValue(n.length>0?n:null)}e.forEachChild(function(e){t.pruneCompletedTransactionsBelowNode_(e)})},gr.prototype.abortTransactions_=function(e){var t=this,n=this.getAncestorTransactionNode_(e).path(),r=this.transactionQueueTree_.subTree(e);return r.forEachAncestor(function(e){t.abortTransactionsOnNode_(e)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(e){t.abortTransactionsOnNode_(e)}),n},gr.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){for(var n=[],i=[],o=-1,s=0;s<t.length;s++)if(t[s].status===Tr.SENT_NEEDS_ABORT);else if(t[s].status===Tr.SENT)r.assert(o===s-1,"All SENT items should be at beginning of queue."),o=s,t[s].status=Tr.SENT_NEEDS_ABORT,t[s].abortReason="set";else if(r.assert(t[s].status===Tr.RUN,"Unexpected transaction status in abort"),t[s].unwatcher(),i=i.concat(this.serverSyncTree_.ackUserWrite(t[s].currentWriteId,!0)),t[s].onComplete){n.push(t[s].onComplete.bind(null,new Error("set"),!1,null))}-1===o?e.setValue(null):t.length=o+1,this.eventQueue_.raiseEventsForChangedPath(e.path(),i);for(s=0;s<n.length;s++)V(n[s])}};var Ir,Nr=function(){function e(e,t){var n=this;this.app_=e,this.authProvider_=t,this.auth_=null,this.auth_=t.getImmediate({optional:!0}),this.auth_||t.get().then(function(e){return n.auth_=e})}return e.prototype.getToken=function(e){return this.auth_?this.auth_.getToken(e).catch(function(e){return e&&"auth/token-not-initialized"===e.code?(C("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)}):Promise.resolve(null)},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):(setTimeout(function(){return e(null)},0),this.authProvider_.get().then(function(t){return t.addAuthTokenListener(e)}))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then(function(t){return t.removeAuthTokenListener(e)})},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',b(e)},e}(),Pr=function(){function e(){}return e.prototype.getToken=function(t){return Promise.resolve({accessToken:e.EMULATOR_AUTH_TOKEN})},e.prototype.addTokenChangeListener=function(t){t(e.EMULATOR_AUTH_TOKEN)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.EMULATOR_AUTH_TOKEN="owner",e}(),Rr="FIREBASE_DATABASE_EMULATOR_HOST",xr=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return Ir||(Ir=new t),Ir},t.prototype.interrupt=function(){var e,t,r,i;try{for(var o=n.__values(Object.keys(this.repos_)),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var h=(r=void 0,n.__values(Object.keys(this.repos_[a]))),u=h.next();!u.done;u=h.next()){var l=u.value;this.repos_[a][l].interrupt()}}catch(c){r={error:c}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.prototype.resume=function(){var e,t,r,i;try{for(var o=n.__values(Object.keys(this.repos_)),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var h=(r=void 0,n.__values(Object.keys(this.repos_[a]))),u=h.next();!u.done;u=h.next()){var l=u.value;this.repos_[a][l].resume()}}catch(c){r={error:c}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.prototype.databaseFromApp=function(t,n,r,i){var o=r||t.options.databaseURL;void 0===o&&(t.options.projectId||T("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),C("Using default host for project ",t.options.projectId),o=t.options.projectId+"-default-rtdb.firebaseio.com");var s,a=he(o,i),h=a.repoInfo,u=void 0;void 0!==e&&(u=e.env[Rr]),u?(s=!0,o="http://"+u+"?ns="+h.namespace,h=(a=he(o,i)).repoInfo):s=!a.repoInfo.secure;var l=i&&s?new Pr:new Nr(t,n);return Ne("Invalid Firebase Database URL",1,a),a.path.isEmpty()||T("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(h,t,l).database},t.prototype.deleteRepo=function(e){var t=r.safeGet(this.repos_,e.app.name);t&&r.safeGet(t,e.repoInfo_.toURLString())===e||T("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted."),e.interrupt(),delete t[e.repoInfo_.toURLString()]},t.prototype.createRepo=function(e,t,n){var i=r.safeGet(this.repos_,t.name);i||(i={},this.repos_[t.name]=i);var o=r.safeGet(i,e.toURLString());return o&&T("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new gr(e,this.useRestClient_,t,n),i[e.toURLString()]=o,o},t.prototype.forceRestClient=function(e){this.useRestClient_=e},t}(),Dr=function(){function e(e){this.repo_=e,e instanceof gr||T("Don't call new Database() directly - please use firebase.database()."),this.root_=new wr(e,B.Empty),this.INTERNAL=new kr(this)}return Object.defineProperty(e.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),e.prototype.ref=function(e){return this.checkDeleted_("ref"),r.validateArgCount("database.ref",0,1,arguments.length),e instanceof wr?this.refFromURL(e.toString()):void 0!==e?this.root_.child(e):this.root_},e.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t),r.validateArgCount(t,1,1,arguments.length);var n=he(e,this.repo_.repoInfo_.nodeAdmin);Ne(t,1,n);var i=n.repoInfo;return i.host!==this.repo_.repoInfo_.host&&T(t+": Host name does not match the current database: (found "+i.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},e.prototype.checkDeleted_=function(e){null===this.repo_&&T("Cannot call "+e+" on a deleted database.")},e.prototype.goOffline=function(){r.validateArgCount("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},e.prototype.goOnline=function(){r.validateArgCount("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},e.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(e){return{".sv":{increment:e}}}},e}(),kr=function(){function e(e){this.database=e}return e.prototype.delete=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return this.database.checkDeleted_("delete"),xr.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},e}(),Or=function(){jn.forceDisallow(),Mn.forceAllow()},Fr=function(){Mn.forceDisallow()},Ar=function(){return jn.isAvailable()},Lr=function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},Mr=function(e,t){e.repo.stats(t)},Wr=function(e,t){e.repo.statsIncrementCounter(t)},qr=function(e){return e.repo.dataUpdateCount},Qr=function(e,t){return e.repo.interceptServerData_(t)},Ur=Object.freeze({__proto__:null,forceLongPolling:Or,forceWebSockets:Fr,isWebSocketsAvailable:Ar,setSecurityDebugCallback:Lr,stats:Mr,statsIncrementCounter:Wr,dataUpdateCount:qr,interceptServerData:Qr}),Vr=_r;_r.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},_r.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var Hr=sr,jr=function(e){var t=_r.prototype.put;return _r.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){_r.prototype.put=t}},Br=re,Kr=function(e){return e.queryIdentifier()},Yr=function(e){xr.getInstance().forceRestClient(e)},zr=Object.freeze({__proto__:null,DataConnection:Vr,RealTimeConnection:Hr,hijackHash:jr,ConnectionTarget:Br,queryIdentifier:Kr,forceRestClient:Yr}),Gr="@firebase/database",Xr="0.6.13",$r=Dr.ServerValue;function Jr(e){Qn(e.SDK_VERSION);var t=e.INTERNAL.registerComponent(new o.Component("database",function(e,t){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal");return xr.getInstance().databaseFromApp(n,r,t)},"PUBLIC").setServiceProps({Reference:wr,Query:Ct,Database:Dr,DataSnapshot:_t,enableLogging:m,INTERNAL:Ur,ServerValue:$r,TEST_ACCESS:zr}).setMultipleInstances(!0));e.registerVersion(Gr,Xr),r.isNodeSdk()&&(module.exports=t)}Jr(a.default),exports.DataSnapshot=_t,exports.Database=Dr,exports.OnDisconnect=Re,exports.Query=Ct,exports.Reference=wr,exports.ServerValue=$r,exports.enableLogging=m,exports.registerDatabase=Jr;
},{"@firebase/app":"dP58","tslib":"f2sD","@firebase/util":"xA6u","@firebase/logger":"TUpU","@firebase/component":"nzQs","process":"pBGv"}],"Uuoh":[function(require,module,exports) {
"use strict";require("@firebase/database");
},{"@firebase/database":"vmMz"}],"RJVP":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];(function(){var e,n=require("@firebase/app").default,i="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)};var r=function(e){e=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t,e];for(var n=0;n<e.length;++n){var i=e[n];if(i&&i.Math==Math)return i}return globalThis}(this);function o(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}function a(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:o(t)}}!function(t,e){if(e){var n=r;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in n||(n[a]={}),n=n[a]}(e=e(o=n[t=t[t.length-1]]))!=o&&null!=e&&i(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function e(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(n){e.reject(n)}}function n(){this.a=null}function i(t){return t instanceof e?t:new e(function(e){e(t)})}if(t)return t;n.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var o=r.setTimeout;n.prototype.c=function(t){o(t,0)},n.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(i){this.f(i)}}}this.a=null},n.prototype.f=function(t){this.c(function(){throw t})},e.prototype.f=function(){function t(t){return function(i){n||(n=!0,t.call(e,i))}}var e=this,n=!1;return{resolve:t(this.v),reject:t(this.g)}},e.prototype.v=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.o(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.m(t):this.h(t)}},e.prototype.m=function(t){var e=void 0;try{e=t.then}catch(n){return void this.g(n)}"function"==typeof e?this.u(e,t):this.h(t)},e.prototype.g=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},e.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)s.b(this.a[t]);this.a=null}};var s=new n;return e.prototype.o=function(t){var e=this.f();t.Pa(e.resolve,e.reject)},e.prototype.u=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(i){n.reject(i)}},e.prototype.then=function(t,n){function i(t,e){return"function"==typeof t?function(e){try{r(t(e))}catch(n){o(n)}}:e}var r,o,a=new e(function(t,e){r=t,o=e});return this.Pa(i(t,r),i(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.Pa=function(t,e){function n(){switch(i.b){case 1:t(i.c);break;case 2:e(i.c);break;default:throw Error("Unexpected state: "+i.b)}}var i=this;null==this.a?s.b(n):this.a.push(n)},e.resolve=i,e.reject=function(t){return new e(function(e,n){n(t)})},e.race=function(t){return new e(function(e,n){for(var r=a(t),o=r.next();!o.done;o=r.next())i(o.value).Pa(e,n)})},e.all=function(t){var n=a(t),r=n.next();return r.done?i([]):new e(function(t,e){function o(e){return function(n){a[e]=n,0==--s&&t(a)}}var a=[],s=0;do{a.push(void 0),s++,i(r.value).Pa(o(a.length-1),e),r=n.next()}while(!r.done)})},e});var s=s||{},u=this||self,c=/^[\w+/_-]+[=]{0,2}$/,h=null;function l(){}function f(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function d(t){var e=f(t);return"array"==e||"object"==e&&"number"==typeof t.length}function p(t){return"function"==f(t)}function v(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function m(t){return Object.prototype.hasOwnProperty.call(t,g)&&t[g]||(t[g]=++b)}var g="closure_uid_"+(1e9*Math.random()>>>0),b=0;function y(t,e,n){return t.call.apply(t.bind,arguments)}function w(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function I(t,e,n){return(I=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:w).apply(null,arguments)}function T(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var E=Date.now||function(){return+new Date};function A(t,e){function n(){}n.prototype=e.prototype,t.$a=e.prototype,t.prototype=new n,t.prototype.constructor=t}function k(t,e,n){this.code=_+t,this.message=e||O[t]||"",this.a=n||null}function S(t){var e=t&&t.code;return e?new k(e.substring(_.length),t.message,t.serverResponse):null}A(k,Error),k.prototype.w=function(){var t={code:this.code,message:this.message};return this.a&&(t.serverResponse=this.a),t},k.prototype.toJSON=function(){return this.w()};var N,_="auth/",O={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."},C={kd:{Sa:"https://staging-identitytoolkit.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",Ya:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Va:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"b"},rd:{Sa:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",Ya:"https://securetoken.googleapis.com/v1/token",Va:"https://identitytoolkit.googleapis.com/v2/",id:"p"},td:{Sa:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",Ya:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Va:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"s"},ud:{Sa:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",Ya:"https://test-securetoken.sandbox.googleapis.com/v1/token",Va:"https://test-identitytoolkit.sandbox.googleapis.com/v2/",id:"t"}};function R(t){for(var e in C)if(C[e].id===t)return{firebaseEndpoint:(t=C[e]).Sa,secureTokenEndpoint:t.Ya,identityPlatformEndpoint:t.Va};return null}function P(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(e){return!1}}function D(t){if(Error.captureStackTrace)Error.captureStackTrace(this,D);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function L(t,e){for(var n="",i=(t=t.split("%s")).length-1,r=0;r<i;r++)n+=t[r]+(r<e.length?e[r]:"%s");D.call(this,n+t[i])}function x(t,e){throw new L("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function M(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function j(t,e){t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}function U(){this.b=this.a=null}N=R("__EID__")?"__EID__":void 0,A(D,Error),D.prototype.name="CustomError",A(L,D),L.prototype.name="AssertionError",M.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var V=new M(function(){return new K},function(t){t.reset()});function F(){var t=be,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function K(){this.next=this.b=this.a=null}U.prototype.add=function(t,e){var n=V.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},K.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},K.prototype.reset=function(){this.next=this.b=this.a=null};var q=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},H=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var i=t.length,r="string"==typeof t?t.split(""):t,o=0;o<i;o++)o in r&&e.call(n,r[o],o,t)};var G=Array.prototype.filter?function(t,e){return Array.prototype.filter.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=[],r=0,o="string"==typeof t?t.split(""):t,a=0;a<n;a++)if(a in o){var s=o[a];e.call(void 0,s,a,t)&&(i[r++]=s)}return i},B=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=Array(n),r="string"==typeof t?t.split(""):t,o=0;o<n;o++)o in r&&(i[o]=e.call(void 0,r[o],o,t));return i},W=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,i="string"==typeof t?t.split(""):t,r=0;r<n;r++)if(r in i&&e.call(void 0,i[r],r,t))return!0;return!1};function X(t,e){return 0<=q(t,e)}function J(t,e){var n;return(n=0<=(e=q(t,e)))&&Array.prototype.splice.call(t,e,1),n}function Y(t,e){!function(t,e){for(var n="string"==typeof t?t.split(""):t,i=t.length-1;0<=i;--i)i in n&&e.call(void 0,n[i],i,t)}(t,function(n,i){e.call(void 0,n,i,t)&&1==Array.prototype.splice.call(t,i,1).length&&0})}function z(t){return Array.prototype.concat.apply([],arguments)}function $(t){var e=t.length;if(0<e){for(var n=Array(e),i=0;i<e;i++)n[i]=t[i];return n}return[]}var Z,Q=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},tt=/&/g,et=/</g,nt=/>/g,it=/"/g,rt=/'/g,ot=/\x00/g,at=/[\x00&<>"']/;function st(t,e){return-1!=t.indexOf(e)}function ut(t,e){return t<e?-1:t>e?1:0}t:{var ct=u.navigator;if(ct){var ht=ct.userAgent;if(ht){Z=ht;break t}}Z=""}function lt(t){return st(Z,t)}function ft(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function dt(t){for(var e in t)return!1;return!0}function pt(t){var e,n={};for(e in t)n[e]=t[e];return n}var vt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function mt(t,e){for(var n,i,r=1;r<arguments.length;r++){for(n in i=arguments[r])t[n]=i[n];for(var o=0;o<vt.length;o++)n=vt[o],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function gt(t,e){t:{try{var n=t&&t.ownerDocument,i=n&&(n.defaultView||n.parentWindow);if((i=i||u).Element&&i.Location){var r=i;break t}}catch(a){}r=null}if(r&&void 0!==r[e]&&(!t||!(t instanceof r[e])&&(t instanceof r.Location||t instanceof r.Element))){if(v(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(a){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;x("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}function bt(t,e){this.a=t===It&&e||"",this.b=wt}function yt(t){return t instanceof bt&&t.constructor===bt&&t.b===wt?t.a:(x("expected object of type Const, got '"+t+"'"),"type_error:Const")}bt.prototype.sa=!0,bt.prototype.ra=function(){return this.a},bt.prototype.toString=function(){return"Const{"+this.a+"}"};var wt={},It={},Tt=new bt(It,"");function Et(t,e){this.a=t===Ot&&e||"",this.b=_t}function At(t){return t instanceof Et&&t.constructor===Et&&t.b===_t?t.a:(x("expected object of type TrustedResourceUrl, got '"+t+"' of type "+f(t)),"type_error:TrustedResourceUrl")}function kt(t,e){var n=yt(t);if(!Nt.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return t=n.replace(St,function(t,i){if(!Object.prototype.hasOwnProperty.call(e,i))throw Error('Found marker, "'+i+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[i])instanceof bt?yt(t):encodeURIComponent(String(t))}),new Et(Ot,t)}Et.prototype.sa=!0,Et.prototype.ra=function(){return this.a.toString()},Et.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var St=/%{(\w+)}/g,Nt=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,_t={},Ot={};function Ct(t,e){this.a=t===xt&&e||"",this.b=Lt}function Rt(t){return t instanceof Ct&&t.constructor===Ct&&t.b===Lt?t.a:(x("expected object of type SafeUrl, got '"+t+"' of type "+f(t)),"type_error:SafeUrl")}Ct.prototype.sa=!0,Ct.prototype.ra=function(){return this.a.toString()},Ct.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Pt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function Dt(t){return t instanceof Ct?t:(t="object"==typeof t&&t.sa?t.ra():String(t),Pt.test(t)||(t="about:invalid#zClosurez"),new Ct(xt,t))}var Lt={},xt={};function Mt(){this.a="",this.b=Ut}function jt(t){return t instanceof Mt&&t.constructor===Mt&&t.b===Ut?t.a:(x("expected object of type SafeHtml, got '"+t+"' of type "+f(t)),"type_error:SafeHtml")}Mt.prototype.sa=!0,Mt.prototype.ra=function(){return this.a.toString()},Mt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Ut={};function Vt(t){var e=new Mt;return e.a=t,e}Vt("<!DOCTYPE html>");var Ft=Vt("");function Kt(t,e){for(var n=t.split("%s"),i="",r=Array.prototype.slice.call(arguments,1);r.length&&1<n.length;)i+=n.shift()+r.shift();return i+n.join("%s")}function qt(t){return at.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(tt,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(et,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(nt,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(it,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(rt,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(ot,"&#0;"))),t}function Ht(t){return Ht[" "](t),t}Vt("<br>"),Ht[" "]=l;var Gt,Bt,Wt=lt("Opera"),Xt=lt("Trident")||lt("MSIE"),Jt=lt("Edge"),Yt=Jt||Xt,zt=lt("Gecko")&&!(st(Z.toLowerCase(),"webkit")&&!lt("Edge"))&&!(lt("Trident")||lt("MSIE"))&&!lt("Edge"),$t=st(Z.toLowerCase(),"webkit")&&!lt("Edge");function Zt(){var t=u.document;return t?t.documentMode:void 0}t:{var Qt="",te=(Bt=Z,zt?/rv:([^\);]+)(\)|;)/.exec(Bt):Jt?/Edge\/([\d\.]+)/.exec(Bt):Xt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Bt):$t?/WebKit\/(\S+)/.exec(Bt):Wt?/(?:Version)[ \/]?(\S+)/.exec(Bt):void 0);if(te&&(Qt=te?te[1]:""),Xt){var ee=Zt();if(null!=ee&&ee>parseFloat(Qt)){Gt=String(ee);break t}}Gt=Qt}var ne,ie={};function re(t){return function(t,e){var n=ie;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=Q(String(Gt)).split("."),i=Q(String(t)).split("."),r=Math.max(n.length,i.length),o=0;0==e&&o<r;o++){var a=n[o]||"",s=i[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=ut(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||ut(0==a[2].length,0==s[2].length)||ut(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e})}ne=u.document&&Xt?Zt():void 0;try{new self.OffscreenCanvas(0,0).getContext("2d")}catch(Bt){}var oe=!Xt||9<=Number(ne);function ae(t){var e=document;return"string"==typeof t?e.getElementById(t):t}function se(t,e){ft(e,function(e,n){e&&"object"==typeof e&&e.sa&&(e=e.ra()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:he.hasOwnProperty(n)?t.setAttribute(he[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e})}var ue,ce,he={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function le(t,e,n){var i=arguments,r=document,o=String(i[0]),a=i[1];if(!oe&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',qt(a.name),'"'),a.type){o.push(' type="',qt(a.type),'"');var s={};mt(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=fe(r,o),a&&("string"==typeof a?o.className=a:Array.isArray(a)?o.className=a.join(" "):se(o,a)),2<i.length&&function(t,e,n){function i(n){n&&e.appendChild("string"==typeof n?t.createTextNode(n):n)}for(var r=2;r<n.length;r++){var o=n[r];!d(o)||v(o)&&0<o.nodeType?i(o):H(de(o)?$(o):o,i)}}(r,o,i),o}function fe(t,e){return e=String(e),"application/xhtml+xml"===t.contentType&&(e=e.toLowerCase()),t.createElement(e)}function de(t){if(t&&"number"==typeof t.length){if(v(t))return"function"==typeof t.item||"string"==typeof t.item;if(p(t))return"function"==typeof t.item}return!1}function pe(t){u.setTimeout(function(){throw t},0)}function ve(){var t=u.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!lt("Presto")&&(t=function(){var t,e,n=fe(document,"IFRAME");n.style.display="none",t=n,e=new Et(Ot,yt(Tt)),gt(t,"HTMLIFrameElement"),t.src=At(e).toString(),document.documentElement.appendChild(n);var i=n.contentWindow;(n=i.document).open(),n.write(jt(Ft)),n.close();var r="callImmediate"+Math.random(),o="file:"==i.location.protocol?"*":i.location.protocol+"//"+i.location.host;n=I(function(t){"*"!=o&&t.origin!=o||t.data!=r||this.port1.onmessage()},this),i.addEventListener("message",n,!1),this.port1={},this.port2={postMessage:function(){i.postMessage(r,o)}}}),void 0!==t&&!lt("Trident")&&!lt("MSIE")){var e=new t,n={},i=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).Fb;n.Fb=null,t()}},function(t){i.next={Fb:t},i=i.next,e.port2.postMessage(0)}}return function(t){u.setTimeout(t,0)}}function me(t,e){ce||function(){if(u.Promise&&u.Promise.resolve){var t=u.Promise.resolve(void 0);ce=function(){t.then(ye)}}else ce=function(){var t=ye;!p(u.setImmediate)||u.Window&&u.Window.prototype&&!lt("Edge")&&u.Window.prototype.setImmediate==u.setImmediate?(ue||(ue=ve()),ue(t)):u.setImmediate(t)}}(),ge||(ce(),ge=!0),be.add(t,e)}var ge=!1,be=new U;function ye(){for(var t;t=F();){try{t.a.call(t.b)}catch(e){pe(e)}j(V,t)}ge=!1}function we(t,e){if(this.a=Ie,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=l)try{var n=this;t.call(e,function(t){De(n,Te,t)},function(t){if(!(t instanceof Fe))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(e){}De(n,Ee,t)})}catch(i){De(this,Ee,i)}}var Ie=0,Te=2,Ee=3;function Ae(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ae.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var ke=new M(function(){return new Ae},function(t){t.reset()});function Se(t,e,n){var i=ke.get();return i.g=t,i.b=e,i.f=n,i}function Ne(t){if(t instanceof we)return t;var e=new we(l);return De(e,Te,t),e}function _e(t){return new we(function(e,n){n(t)})}function Oe(t,e,n){Le(t,e,n,null)||me(T(e,t))}function Ce(t){return new we(function(e){var n=t.length,i=[];if(n)for(var r=function(t,r,o){n--,i[t]=r?{Ob:!0,value:o}:{Ob:!1,reason:o},0==n&&e(i)},o=0;o<t.length;o++)Oe(t[o],T(r,o,!0),T(r,o,!1));else e(i)})}function Re(t,e){t.b||t.a!=Te&&t.a!=Ee||xe(t),t.f?t.f.next=e:t.b=e,t.f=e}function Pe(t,e,n,i){var r=Se(null,null,null);return r.a=new we(function(t,o){r.g=e?function(n){try{var r=e.call(i,n);t(r)}catch(a){o(a)}}:t,r.b=n?function(e){try{var r=n.call(i,e);void 0===r&&e instanceof Fe?o(e):t(r)}catch(a){o(a)}}:o}),r.a.c=t,Re(t,r),r.a}function De(t,e,n){t.a==Ie&&(t===n&&(e=Ee,n=new TypeError("Promise cannot resolve to itself")),t.a=1,Le(n,t.Zc,t.$c,t)||(t.i=n,t.a=e,t.c=null,xe(t),e!=Ee||n instanceof Fe||function(t,e){t.g=!0,me(function(){t.g&&Ve.call(null,e)})}(t,n)))}function Le(t,e,n,i){if(t instanceof we)return Re(t,Se(e||l,n||null,i)),!0;if(P(t))return t.then(e,n,i),!0;if(v(t))try{var r=t.then;if(p(r))return function(t,e,n,i,r){function o(t){a||(a=!0,i.call(r,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(r,t))},o)}catch(s){o(s)}}(t,r,e,n,i),!0}catch(o){return n.call(i,o),!0}return!1}function xe(t){t.h||(t.h=!0,me(t.fc,t))}function Me(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function je(t,e,n,i){if(n==Ee&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,Ue(e,n,i);else try{e.c?e.g.call(e.f):Ue(e,n,i)}catch(r){Ve.call(null,r)}j(ke,e)}function Ue(t,e,n){e==Te?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}we.prototype.then=function(t,e,n){return Pe(this,p(t)?t:null,p(e)?e:null,n)},we.prototype.$goog_Thenable=!0,(e=we.prototype).na=function(t,e){return(t=Se(t,t,e)).c=!0,Re(this,t),this},e.s=function(t,e){return Pe(this,null,t,e)},e.cancel=function(t){if(this.a==Ie){var e=new Fe(t);me(function(){!function t(e,n){if(e.a==Ie)if(e.c){var i=e.c;if(i.b){for(var r=0,o=null,a=null,s=i.b;s&&(s.c||(r++,s.a==e&&(o=s),!(o&&1<r)));s=s.next)o||(a=s);o&&(i.a==Ie&&1==r?t(i,n):(a?((r=a).next==i.f&&(i.f=r),r.next=r.next.next):Me(i),je(i,o,Ee,n)))}e.c=null}else De(e,Ee,n)}(this,e)},this)}},e.Zc=function(t){this.a=Ie,De(this,Te,t)},e.$c=function(t){this.a=Ie,De(this,Ee,t)},e.fc=function(){for(var t;t=Me(this);)je(this,t,this.a,this.i);this.h=!1};var Ve=pe;function Fe(t){D.call(this,t)}function Ke(){0!=qe&&(He[m(this)]=this),this.xa=this.xa,this.oa=this.oa}A(Fe,D),Fe.prototype.name="cancel";var qe=0,He={};function Ge(t){if(!t.xa&&(t.xa=!0,t.Da(),0!=qe)){var e=m(t);if(0!=qe&&t.oa&&0<t.oa.length)throw Error(t+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete He[e]}}Ke.prototype.xa=!1,Ke.prototype.Da=function(){if(this.oa)for(;this.oa.length;)this.oa.shift()()};var Be=Object.freeze||function(t){return t},We=!Xt||9<=Number(ne),Xe=Xt&&!re("9"),Je=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{u.addEventListener("test",l,e),u.removeEventListener("test",l,e)}catch(n){}return t}();function Ye(t,e){this.type=t,this.b=this.target=e,this.defaultPrevented=!1}function ze(t,e){if(Ye.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(zt){t:{try{Ht(e.nodeName);var r=!0;break t}catch(o){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:$e[t.pointerType]||"",this.a=t,t.defaultPrevented&&this.preventDefault()}}Ye.prototype.preventDefault=function(){this.defaultPrevented=!0},A(ze,Ye);var $e=Be({2:"touch",3:"pen",4:"mouse"});ze.prototype.preventDefault=function(){ze.$a.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Xe)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}},ze.prototype.g=function(){return this.a};var Ze="closure_listenable_"+(1e6*Math.random()|0),Qe=0;function tn(t,e,n,i,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.Ua=r,this.key=++Qe,this.va=this.Oa=!1}function en(t){t.va=!0,t.listener=null,t.proxy=null,t.src=null,t.Ua=null}function nn(t){this.src=t,this.a={},this.b=0}function rn(t,e){var n=e.type;n in t.a&&J(t.a[n],e)&&(en(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function on(t,e,n,i){for(var r=0;r<t.length;++r){var o=t[r];if(!o.va&&o.listener==e&&o.capture==!!n&&o.Ua==i)return r}return-1}nn.prototype.add=function(t,e,n,i,r){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=on(t,e,i,r);return-1<a?(e=t[a],n||(e.Oa=!1)):((e=new tn(e,this.src,o,!!i,r)).Oa=n,t.push(e)),e};var an="closure_lm_"+(1e6*Math.random()|0),sn={};function un(t,e,n,i,r){if(i&&i.once)hn(t,e,n,i,r);else if(Array.isArray(e))for(var o=0;o<e.length;o++)un(t,e[o],n,i,r);else n=yn(n),t&&t[Ze]?In(t,e,n,v(i)?!!i.capture:!!i,r):cn(t,e,n,!1,i,r)}function cn(t,e,n,i,r,o){if(!e)throw Error("Invalid event type");var a=v(r)?!!r.capture:!!r,s=gn(t);if(s||(t[an]=s=new nn(t)),!(n=s.add(e,n,i,a,o)).proxy){if(i=function(){var t=mn,e=We?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)Je||(r=a),void 0===r&&(r=!1),t.addEventListener(e.toString(),i,r);else if(t.attachEvent)t.attachEvent(dn(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}0}}function hn(t,e,n,i,r){if(Array.isArray(e))for(var o=0;o<e.length;o++)hn(t,e[o],n,i,r);else n=yn(n),t&&t[Ze]?Tn(t,e,n,v(i)?!!i.capture:!!i,r):cn(t,e,n,!0,i,r)}function ln(t,e,n,i,r){if(Array.isArray(e))for(var o=0;o<e.length;o++)ln(t,e[o],n,i,r);else i=v(i)?!!i.capture:!!i,n=yn(n),t&&t[Ze]?(t=t.v,(e=String(e).toString())in t.a&&(-1<(n=on(o=t.a[e],n,i,r))&&(en(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=gn(t))&&(e=t.a[e.toString()],t=-1,e&&(t=on(e,n,i,r)),(n=-1<t?e[t]:null)&&fn(n))}function fn(t){if("number"!=typeof t&&t&&!t.va){var e=t.src;if(e&&e[Ze])rn(e.v,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(dn(n),i):e.addListener&&e.removeListener&&e.removeListener(i),0,(n=gn(e))?(rn(n,t),0==n.b&&(n.src=null,e[an]=null)):en(t)}}}function dn(t){return t in sn?sn[t]:sn[t]="on"+t}function pn(t,e,n,i){var r=!0;if((t=gn(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.va&&(o=vn(o,i),r=r&&!1!==o)}return r}function vn(t,e){var n=t.listener,i=t.Ua||t.src;return t.Oa&&fn(t),n.call(i,e)}function mn(t,e){if(t.va)return!0;if(!We){if(!e)t:{e=["window","event"];for(var n=u,i=0;i<e.length;i++)if(null==(n=n[e[i]])){e=null;break t}e=n}if(e=new ze(i=e,this),n=!0,!(0>i.keyCode||null!=i.returnValue)){t:{var r=!1;if(0==i.keyCode)try{i.keyCode=-1;break t}catch(a){r=!0}(r||null==i.returnValue)&&(i.returnValue=!0)}for(i=[],r=e.b;r;r=r.parentNode)i.push(r);for(t=t.type,r=i.length-1;0<=r;r--){e.b=i[r];var o=pn(i[r],t,!0,e);n=n&&o}for(r=0;r<i.length;r++)e.b=i[r],o=pn(i[r],t,!1,e),n=n&&o}return n}return vn(t,new ze(e,this))}function gn(t){return(t=t[an])instanceof nn?t:null}var bn="__closure_events_fn_"+(1e9*Math.random()>>>0);function yn(t){return p(t)?t:(t[bn]||(t[bn]=function(e){return t.handleEvent(e)}),t[bn])}function wn(){Ke.call(this),this.v=new nn(this),this.$b=this,this.fb=null}function In(t,e,n,i,r){t.v.add(String(e),n,!1,i,r)}function Tn(t,e,n,i,r){t.v.add(String(e),n,!0,i,r)}function En(t,e,n,i){if(!(e=t.v.a[String(e)]))return!0;e=e.concat();for(var r=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.va&&a.capture==n){var s=a.listener,u=a.Ua||a.src;a.Oa&&rn(t.v,a),r=!1!==s.call(u,i)&&r}}return r&&!i.defaultPrevented}function An(t,e,n){if(p(t))n&&(t=I(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=I(t.handleEvent,t)}return 2147483647<Number(e)?-1:u.setTimeout(t,e||0)}function kn(t){var e=null;return new we(function(n,i){-1==(e=An(function(){n(void 0)},t))&&i(Error("Failed to schedule timer."))}).s(function(t){throw u.clearTimeout(e),t})}function Sn(t){if(t.V&&"function"==typeof t.V)return t.V();if("string"==typeof t)return t.split("");if(d(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}function Nn(t){if(t.Y&&"function"==typeof t.Y)return t.Y();if(!t.V||"function"!=typeof t.V){if(d(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var i in e=[],n=0,t)e[n++]=i;return e}}function _n(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(t)if(t instanceof _n)for(n=t.Y(),i=0;i<n.length;i++)this.set(n[i],t.get(n[i]));else for(i in t)this.set(i,t[i])}function On(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var i=t.a[e];Cn(t.b,i)&&(t.a[n++]=i),e++}t.a.length=n}if(t.c!=t.a.length){var r={};for(n=e=0;e<t.a.length;)Cn(r,i=t.a[e])||(t.a[n++]=i,r[i]=1),e++;t.a.length=n}}function Cn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}A(wn,Ke),wn.prototype[Ze]=!0,wn.prototype.addEventListener=function(t,e,n,i){un(this,t,e,n,i)},wn.prototype.removeEventListener=function(t,e,n,i){ln(this,t,e,n,i)},wn.prototype.dispatchEvent=function(t){var e,n=this.fb;if(n)for(e=[];n;n=n.fb)e.push(n);n=this.$b;var i=t.type||t;if("string"==typeof t)t=new Ye(t,n);else if(t instanceof Ye)t.target=t.target||n;else{var r=t;mt(t=new Ye(i,n),r)}if(r=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];r=En(a,i,!0,t)&&r}if(r=En(a=t.b=n,i,!0,t)&&r,r=En(a,i,!1,t)&&r,e)for(o=0;o<e.length;o++)r=En(a=t.b=e[o],i,!1,t)&&r;return r},wn.prototype.Da=function(){if(wn.$a.Da.call(this),this.v){var t,e=this.v;for(t in e.a){for(var n=e.a[t],i=0;i<n.length;i++)0,en(n[i]);delete e.a[t],e.b--}}this.fb=null},(e=_n.prototype).V=function(){On(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},e.Y=function(){return On(this),this.a.concat()},e.clear=function(){this.b={},this.c=this.a.length=0},e.get=function(t,e){return Cn(this.b,t)?this.b[t]:e},e.set=function(t,e){Cn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},e.forEach=function(t,e){for(var n=this.Y(),i=0;i<n.length;i++){var r=n[i],o=this.get(r);t.call(e,o,r,this)}};var Rn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/\\#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Pn(t,e){var n;this.a=this.l=this.f="",this.g=null,this.h=this.c="",this.i=!1,t instanceof Pn?(this.i=void 0!==e?e:t.i,Dn(this,t.f),this.l=t.l,this.a=t.a,Ln(this,t.g),this.c=t.c,xn(this,ti(t.b)),this.h=t.h):t&&(n=String(t).match(Rn))?(this.i=!!e,Dn(this,n[1]||"",!0),this.l=Fn(n[2]||""),this.a=Fn(n[3]||"",!0),Ln(this,n[4]),this.c=Fn(n[5]||"",!0),xn(this,n[6]||"",!0),this.h=Fn(n[7]||"")):(this.i=!!e,this.b=new Jn(null,this.i))}function Dn(t,e,n){t.f=n?Fn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Ln(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.g=e}else t.g=null}function xn(t,e,n){e instanceof Jn?(t.b=e,function(t,e){e&&!t.f&&(Yn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&($n(this,e),Qn(this,n,t))},t)),t.f=e}(t.b,t.i)):(n||(e=Kn(e,Wn)),t.b=new Jn(e,t.i))}function Mn(t,e,n){t.b.set(e,n)}function jn(t,e){return t.b.get(e)}function Un(t){return t instanceof Pn?new Pn(t):new Pn(t,void 0)}function Vn(t,e,n,i){var r=new Pn(null,void 0);return t&&Dn(r,t),e&&(r.a=e),n&&Ln(r,n),i&&(r.c=i),r}function Fn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Kn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,qn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function qn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Pn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Kn(e,Hn,!0),":");var n=this.a;return(n||"file"==e)&&(t.push("//"),(e=this.l)&&t.push(Kn(e,Hn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.g)&&t.push(":",String(n))),(n=this.c)&&(this.a&&"/"!=n.charAt(0)&&t.push("/"),t.push(Kn(n,"/"==n.charAt(0)?Bn:Gn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.h)&&t.push("#",Kn(n,Xn)),t.join("")},Pn.prototype.resolve=function(t){var e=new Pn(this),n=!!t.f;n?Dn(e,t.f):n=!!t.l,n?e.l=t.l:n=!!t.a,n?e.a=t.a:n=null!=t.g;var i=t.c;if(n)Ln(e,t.g);else if(n=!!t.c){if("/"!=i.charAt(0))if(this.a&&!this.c)i="/"+i;else{var r=e.c.lastIndexOf("/");-1!=r&&(i=e.c.substr(0,r+1)+i)}if(".."==(r=i)||"."==r)i="";else if(st(r,"./")||st(r,"/.")){i=0==r.lastIndexOf("/",0),r=r.split("/");for(var o=[],a=0;a<r.length;){var s=r[a++];"."==s?i&&a==r.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),i&&a==r.length&&o.push("")):(o.push(s),i=!0)}i=o.join("/")}else i=r}return n?e.c=i:n=""!==t.b.toString(),n?xn(e,ti(t.b)):n=!!t.h,n&&(e.h=t.h),e};var Hn=/[#\/\?@]/g,Gn=/[#\?:]/g,Bn=/[#\?]/g,Wn=/[#\?@]/g,Xn=/#/g;function Jn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Yn(t){t.a||(t.a=new _n,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),r=null;if(0<=i){var o=t[n].substring(0,i);r=t[n].substring(i+1)}else o=t[n];e(o,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function zn(t){var e=Nn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Jn(null,void 0);t=Sn(t);for(var i=0;i<e.length;i++){var r=e[i],o=t[i];Array.isArray(o)?Qn(n,r,o):n.add(r,o)}return n}function $n(t,e){Yn(t),e=ei(t,e),Cn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Cn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&On(t)))}function Zn(t,e){return Yn(t),e=ei(t,e),Cn(t.a.b,e)}function Qn(t,e,n){$n(t,e),0<n.length&&(t.c=null,t.a.set(ei(t,e),$(n)),t.b+=n.length)}function ti(t){var e=new Jn;return e.c=t.c,t.a&&(e.a=new _n(t.a),e.b=t.b),e}function ei(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function ni(t){var e=[];return function t(e,n,i){if(null==n)i.push("null");else{if("object"==typeof n){if(Array.isArray(n)){var r=n;n=r.length,i.push("[");for(var o="",a=0;a<n;a++)i.push(o),t(e,r[a],i),o=",";return void i.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(r in i.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,r)&&("function"!=typeof(a=n[r])&&(i.push(o),ai(r,i),i.push(":"),t(e,a,i),o=","));return void i.push("}")}n=n.valueOf()}switch(typeof n){case"string":ai(n,i);break;case"number":i.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":i.push(String(n));break;case"function":i.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new ii,t,e),e.join("")}function ii(){}(e=Jn.prototype).add=function(t,e){Yn(this),this.c=null,t=ei(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},e.clear=function(){this.a=this.c=null,this.b=0},e.forEach=function(t,e){Yn(this),this.a.forEach(function(n,i){H(n,function(n){t.call(e,n,i,this)},this)},this)},e.Y=function(){Yn(this);for(var t=this.a.V(),e=this.a.Y(),n=[],i=0;i<e.length;i++)for(var r=t[i],o=0;o<r.length;o++)n.push(e[i]);return n},e.V=function(t){Yn(this);var e=[];if("string"==typeof t)Zn(this,t)&&(e=z(e,this.a.get(ei(this,t))));else{t=this.a.V();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},e.set=function(t,e){return Yn(this),this.c=null,Zn(this,t=ei(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},e.get=function(t,e){return t&&0<(t=this.V(t)).length?String(t[0]):e},e.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.Y(),n=0;n<e.length;n++){var i=e[n],r=encodeURIComponent(String(i));i=this.V(i);for(var o=0;o<i.length;o++){var a=r;""!==i[o]&&(a+="="+encodeURIComponent(String(i[o]))),t.push(a)}}return this.c=t.join("&")};var ri={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},oi=/\uffff/.test("￿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function ai(t,e){e.push('"',t.replace(oi,function(t){var e=ri[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),ri[t]=e),e}),'"')}function si(){var t=Si();return Xt&&!!ne&&11==ne||/Edge\/\d+/.test(t)}function ui(){return u.window&&u.window.location.href||self&&self.location&&self.location.href||""}function ci(t,e){e=e||u.window;var n="about:blank";t&&(n=Rt(Dt(t))),e.location.href=n}function hi(t){return!!((t=(t||Si()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function li(t){t=t||u.window;try{t.close()}catch(e){}}function fi(t,e,n){var i=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var r=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<r?r:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=Si().toLowerCase(),i&&(e.target=i,st(n,"crios/")&&(e.target="_blank")),Ei(Si())==Ii&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),i=window,e=n instanceof Ct?n:Dt(void 0!==n.href?n.href:String(n)),n=t.target||n.target,r=[],t)switch(a){case"width":case"height":case"top":case"left":r.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:r.push(a+"="+(t[a]?1:0))}var a=r.join(",");if((lt("iPhone")&&!lt("iPod")&&!lt("iPad")||lt("iPad")||lt("iPod"))&&i.navigator&&i.navigator.standalone&&n&&"_self"!=n?(gt(a=fe(document,"A"),"HTMLAnchorElement"),e instanceof Ct||e instanceof Ct||(e="object"==typeof e&&e.sa?e.ra():String(e),Pt.test(e)||(e="about:invalid#zClosurez"),e=new Ct(xt,e)),a.href=Rt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,i,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=i.open("",n,a),t=Rt(e),a&&(Yt&&st(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Vt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+qt(t)+'">'),i=a.document)&&(i.write(jt(t)),i.close())):(a=i.open(Rt(e),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(s){}return a}var di=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,pi=/^[^@]+@[^@]+$/;function vi(){var t=null;return new we(function(e){"complete"==u.document.readyState?e():(t=function(){e()},hn(window,"load",t))}).s(function(e){throw ln(window,"load",t),e})}function mi(t){return t=t||Si(),!("file:"!==Ri()&&"ionic:"!==Ri()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function gi(){var t=u.window;try{return!(!t||t==t.top)}catch(e){return!1}}function bi(){return void 0!==u.WorkerGlobalScope&&"function"==typeof u.importScripts}function yi(){return n.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":n.INTERNAL.hasOwnProperty("node")?"Node":bi()?"Worker":"Browser"}function wi(){var t=yi();return"ReactNative"===t||"Node"===t}var Ii="Firefox",Ti="Chrome";function Ei(t){var e=t.toLowerCase();return st(e,"opera/")||st(e,"opr/")||st(e,"opios/")?"Opera":st(e,"iemobile")?"IEMobile":st(e,"msie")||st(e,"trident/")?"IE":st(e,"edge/")?"Edge":st(e,"firefox/")?Ii:st(e,"silk/")?"Silk":st(e,"blackberry")?"Blackberry":st(e,"webos")?"Webos":!st(e,"safari/")||st(e,"chrome/")||st(e,"crios/")||st(e,"android")?!st(e,"chrome/")&&!st(e,"crios/")||st(e,"edge/")?st(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":Ti:"Safari"}var Ai={ld:"FirebaseCore-web",nd:"FirebaseUI-web"};function ki(t,e){e=e||[];var n,i=[],r={};for(n in Ai)r[Ai[n]]=!0;for(n=0;n<e.length;n++)void 0!==r[e[n]]&&(delete r[e[n]],i.push(e[n]));return i.sort(),(e=i).length||(e=["FirebaseCore-web"]),"Browser"===(i=yi())?i=Ei(r=Si()):"Worker"===i&&(i=Ei(r=Si())+"-"+i),i+"/JsCore/"+t+"/"+e.join(",")}function Si(){return u.navigator&&u.navigator.userAgent||""}function Ni(t,e){t=t.split("."),e=e||u;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function _i(){try{var t=u.localStorage,e=Mi();if(t)return t.setItem(e,"1"),t.removeItem(e),!si()||!!u.indexedDB}catch(n){return bi()&&!!u.indexedDB}return!1}function Oi(){return(Ci()||"chrome-extension:"===Ri()||mi())&&!wi()&&_i()&&!bi()}function Ci(){return"http:"===Ri()||"https:"===Ri()}function Ri(){return u.location&&u.location.protocol||null}function Pi(t){return!hi(t=t||Si())&&Ei(t)!=Ii}function Di(t){return void 0===t?null:ni(t)}function Li(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function xi(t){if(null!==t)return JSON.parse(t)}function Mi(t){return t||Math.floor(1e9*Math.random()).toString()}function ji(t){return"Safari"!=Ei(t=t||Si())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Ui(){var t=u.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Vi(t,e){if(t>e)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=Si(),e=yi(),this.b=hi(t)||"ReactNative"===e}function Fi(){var t=u.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Ki(t){"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t)}function qi(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(n){}return null}function Hi(){return!(!Ni("fireauth.oauthhelper",u)&&!Ni("fireauth.iframe",u))}Vi.prototype.get=function(){var t=u.navigator;return!t||"boolean"!=typeof t.onLine||!Ci()&&"chrome-extension:"!==Ri()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Gi,Bi={};function Wi(t){Bi[t]||(Bi[t]=!0,Ki(t))}try{var Xi={};Object.defineProperty(Xi,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Xi,"abcd",{configurable:!0,enumerable:!0,value:2}),Gi=2==Xi.abcd}catch(Bt){Gi=!1}function Ji(t,e,n){Gi?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Yi(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Ji(t,n,e[n])}function zi(t){var e={};return Yi(e,t),e}function $i(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Ji(e,n,$i(t[n]));return e}function Zi(t){var e=t&&(t[ir]?"phone":null);if(!(e&&t&&t[nr]))throw new k("internal-error","Internal assert: invalid MultiFactorInfo object");Ji(this,"uid",t[nr]),Ji(this,"displayName",t[tr]||null);var n=null;t[er]&&(n=new Date(t[er]).toUTCString()),Ji(this,"enrollmentTime",n),Ji(this,"factorId",e)}function Qi(t){try{var e=new rr(t)}catch(n){e=null}return e}Zi.prototype.w=function(){return{uid:this.uid,displayName:this.displayName,factorId:this.factorId,enrollmentTime:this.enrollmentTime}};var tr="displayName",er="enrolledAt",nr="mfaEnrollmentId",ir="phoneInfo";function rr(t){Zi.call(this,t),Ji(this,"phoneNumber",t[ir])}function or(t){var e={},n=t[cr],i=t[lr],r=t[fr];if(t=Qi(t[hr]),!r||r!=sr&&r!=ur&&!n||r==ur&&!i||r==ar&&!t)throw Error("Invalid checkActionCode response!");r==ur?(e[pr]=n||null,e[mr]=n||null,e[dr]=i):(e[pr]=i||null,e[mr]=i||null,e[dr]=n||null),e[vr]=t||null,Ji(this,br,r),Ji(this,gr,$i(e))}A(rr,Zi),rr.prototype.w=function(){var t=rr.$a.w.call(this);return t.phoneNumber=this.phoneNumber,t};var ar="REVERT_SECOND_FACTOR_ADDITION",sr="EMAIL_SIGNIN",ur="VERIFY_AND_CHANGE_EMAIL",cr="email",hr="mfaInfo",lr="newEmail",fr="requestType",dr="email",pr="fromEmail",vr="multiFactorInfo",mr="previousEmail",gr="data",br="operation";function yr(t){var e=jn(t=Un(t),wr)||null,n=jn(t,Ir)||null,i=jn(t,Ar)||null;if(i=i&&Sr[i]||null,!e||!n||!i)throw new k("argument-error",wr+", "+Ir+"and "+Ar+" are required in a valid action code URL.");Yi(this,{apiKey:e,operation:i,code:n,continueUrl:jn(t,Tr)||null,languageCode:jn(t,Er)||null,tenantId:jn(t,kr)||null})}var wr="apiKey",Ir="oobCode",Tr="continueUrl",Er="languageCode",Ar="mode",kr="tenantId",Sr={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",revertSecondFactorAddition:ar,signIn:sr,verifyAndChangeEmail:ur,verifyEmail:"VERIFY_EMAIL"};function Nr(t){try{return new yr(t)}catch(e){return null}}function _r(t){var e=t[Dr];if(void 0===e)throw new k("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new k("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[Or];if(n&&"object"==typeof n){e=n[Mr];var i=n[Lr];if(n=n[xr],"string"==typeof e&&e.length){if(this.a=e,void 0!==i&&"boolean"!=typeof i)throw new k("argument-error",Lr+" property must be a boolean when specified.");if(this.g=!!i,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new k("argument-error",xr+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new k("argument-error",Mr+" property must be a non empty string when specified.");if(void 0!==i||void 0!==n)throw new k("missing-android-pkg-name")}}else if(void 0!==n)throw new k("argument-error",Or+" property must be a non null object when specified.");if(this.f=null,(e=t[Pr])&&"object"==typeof e){if("string"==typeof(e=e[jr])&&e.length)this.f=e;else if(void 0!==e)throw new k("argument-error",jr+" property must be a non empty string when specified.")}else if(void 0!==e)throw new k("argument-error",Pr+" property must be a non null object when specified.");if(void 0!==(e=t[Rr])&&"boolean"!=typeof e)throw new k("argument-error",Rr+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[Cr])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new k("argument-error",Cr+" property must be a non empty string when specified.");this.i=t||null}var Or="android",Cr="dynamicLinkDomain",Rr="handleCodeInApp",Pr="iOS",Dr="url",Lr="installApp",xr="minimumVersion",Mr="packageName",jr="bundleId";function Ur(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var Vr=null;function Fr(t){var e="";return function(t,e){function n(e){for(;i<t.length;){var n=t.charAt(i++),r=Vr[n];if(null!=r)return r;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!Vr){Vr={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++)for(var i=t.concat(e[n].split("")),r=0;r<i.length;r++){var o=i[r];void 0===Vr[o]&&(Vr[o]=r)}}}();for(var i=0;;){var r=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===r)break;e(r<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function Kr(t){var e=Hr(t);if(!(e&&e.sub&&e.iss&&e.aud&&e.exp))throw Error("Invalid JWT");this.g=t,this.c=e.exp,this.h=e.sub,E(),this.a=e.provider_id||e.firebase&&e.firebase.sign_in_provider||null,this.f=e.firebase&&e.firebase.tenant||null,this.b=!!e.is_anonymous||"anonymous"==this.a}function qr(t){try{return new Kr(t)}catch(e){return null}}function Hr(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(Fr(t))}catch(i){}return null}Kr.prototype.S=function(){return this.f},Kr.prototype.i=function(){return this.b},Kr.prototype.toString=function(){return this.g};var Gr="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Br=["client_id","response_type","scope","redirect_uri","state"],Wr={md:{Ja:"locale",ua:700,ta:600,fa:"facebook.com",Wa:Br},od:{Ja:null,ua:500,ta:750,fa:"github.com",Wa:Br},pd:{Ja:"hl",ua:515,ta:680,fa:"google.com",Wa:Br},vd:{Ja:"lang",ua:485,ta:705,fa:"twitter.com",Wa:Gr},jd:{Ja:"locale",ua:640,ta:600,fa:"apple.com",Wa:[]}};function Xr(t){for(var e in Wr)if(Wr[e].fa==t)return Wr[e];return null}function Jr(t){var e={};e["facebook.com"]=Qr,e["google.com"]=eo,e["github.com"]=to,e["twitter.com"]=no;var n=t&&t[zr];try{if(n)return e[n]?new e[n](t):new Zr(t);if(void 0!==t[Yr])return new $r(t)}catch(i){}return null}var Yr="idToken",zr="providerId";function $r(t){var e=t[zr];if(!e&&t[Yr]){var n=qr(t[Yr]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Ji(this,"providerId",e),Ji(this,"isNewUser",n)}function Zr(t){$r.call(this,t),Ji(this,"profile",$i((t=xi(t.rawUserInfo||"{}"))||{}))}function Qr(t){if(Zr.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function to(t){if(Zr.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Ji(this,"username",this.profile&&this.profile.login||null)}function eo(t){if(Zr.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function no(t){if(Zr.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Ji(this,"username",t.screenName||null)}function io(t){var e=Un(t),n=jn(e,"link"),i=jn(Un(n),"link");return e=jn(e,"deep_link_id"),jn(Un(e),"link")||e||i||n||t}function ro(t,e){if(!t&&!e)throw new k("internal-error","Internal assert: no raw session string available");if(t&&e)throw new k("internal-error","Internal assert: unable to determine the session type");this.a=t||null,this.b=e||null,this.type=this.a?oo:ao}A(Zr,$r),A(Qr,Zr),A(to,Zr),A(eo,Zr),A(no,Zr);var oo="enroll",ao="signin";function so(){}function uo(t,e){return t.then(function(t){if(t[za]){var n=qr(t[za]);if(!n||e!=n.h)throw new k("user-mismatch");return t}throw new k("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==_+"user-not-found"?new k("user-mismatch"):t})}function co(t,e){if(!e)throw new k("internal-error","failed to construct a credential");this.a=e,Ji(this,"providerId",t),Ji(this,"signInMethod",t)}function ho(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function lo(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new co(t.providerId,t.pendingToken)}catch(e){}return null}function fo(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Ji(this,"idToken",e.idToken),e.accessToken&&Ji(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Ji(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new k("internal-error","failed to construct a credential");Ji(this,"accessToken",e.oauthToken),Ji(this,"secret",e.oauthTokenSecret)}Ji(this,"providerId",t),Ji(this,"signInMethod",n)}function po(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:zn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function vo(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new fo(t.providerId,e,t.signInMethod)}catch(n){}}return null}function mo(t,e){this.Pc=e||[],Yi(this,{providerId:t,isOAuthProvider:!0}),this.Hb={},this.ob=(Xr(t)||{}).Ja||null,this.nb=null}function go(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new k("argument-error",'SAML provider IDs must be prefixed with "saml."');mo.call(this,t,[])}function bo(t){mo.call(this,t,Br),this.a=[]}function yo(){bo.call(this,"facebook.com")}function wo(t){if(!t)throw new k("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new yo).credential({accessToken:e})}function Io(){bo.call(this,"github.com")}function To(t){if(!t)throw new k("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Io).credential({accessToken:e})}function Eo(){bo.call(this,"google.com"),this.Ca("profile")}function Ao(t,e){var n=t;return v(t)&&(n=t.idToken,e=t.accessToken),(new Eo).credential({idToken:n,accessToken:e})}function ko(){mo.call(this,"twitter.com",Gr)}function So(t,e){var n=t;if(v(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new k("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new fo("twitter.com",n,"twitter.com")}function No(t,e,n){this.a=t,this.f=e,Ji(this,"providerId","password"),Ji(this,"signInMethod",n===Oo.EMAIL_LINK_SIGN_IN_METHOD?Oo.EMAIL_LINK_SIGN_IN_METHOD:Oo.EMAIL_PASSWORD_SIGN_IN_METHOD)}function _o(t){return t&&t.email&&t.password?new No(t.email,t.password,t.signInMethod):null}function Oo(){Yi(this,{providerId:"password",isOAuthProvider:!1})}function Co(t,e){if(!(e=Ro(e)))throw new k("argument-error","Invalid email link!");return new No(t,e.code,Oo.EMAIL_LINK_SIGN_IN_METHOD)}function Ro(t){return(t=Nr(t=io(t)))&&t.operation===sr?t:null}function Po(t){if(!(t.cb&&t.bb||t.La&&t.ea))throw new k("internal-error");this.a=t,Ji(this,"providerId","phone"),this.fa="phone",Ji(this,"signInMethod","phone")}function Do(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return H(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(n){t[n]&&(e[n]=t[n])}),new Po(e)}return null}function Lo(t){return t.a.La&&t.a.ea?{temporaryProof:t.a.La,phoneNumber:t.a.ea}:{sessionInfo:t.a.cb,code:t.a.bb}}function xo(t){try{this.a=t||n.auth()}catch(e){throw new k("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Yi(this,{providerId:"phone",isOAuthProvider:!1})}function Mo(t,e){if(!t)throw new k("missing-verification-id");if(!e)throw new k("missing-verification-code");return new Po({cb:t,bb:e})}function jo(t){if(t.temporaryProof&&t.phoneNumber)return new Po({La:t.temporaryProof,ea:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,i=t&&t.oauthTokenSecret,r=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return Ao(o,n);case"facebook.com":return wo(n);case"github.com":return To(n);case"twitter.com":return So(n,i);default:return n||i||o||a?a?0==e.indexOf("saml.")?new co(e,a):new fo(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new bo(e).credential({idToken:o,accessToken:n,rawNonce:r}):null}}catch(s){return null}}function Uo(t){if(!t.isOAuthProvider)throw new k("invalid-oauth-provider")}function Vo(t,e,n,i,r,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=i||null,this.i=o||null,this.h=a||null,this.a=r||null,!this.g&&!this.a)throw new k("invalid-auth-event");if(this.g&&this.a)throw new k("invalid-auth-event");if(this.g&&!this.f)throw new k("invalid-auth-event")}function Fo(t){return(t=t||{}).type?new Vo(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&S(t.error),t.postBody,t.tenantId):null}function Ko(){this.b=null,this.a=[]}ro.prototype.Ha=function(){return this.a?Ne(this.a):Ne(this.b)},ro.prototype.w=function(){return this.type==oo?{multiFactorSession:{idToken:this.a}}:{multiFactorSession:{pendingCredential:this.b}}},so.prototype.ja=function(){},so.prototype.b=function(){},so.prototype.c=function(){},so.prototype.w=function(){},co.prototype.ja=function(t){return bs(t,ho(this))},co.prototype.b=function(t,e){var n=ho(this);return n.idToken=e,ys(t,n)},co.prototype.c=function(t,e){return uo(ws(t,ho(this)),e)},co.prototype.w=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},fo.prototype.ja=function(t){return bs(t,po(this))},fo.prototype.b=function(t,e){var n=po(this);return n.idToken=e,ys(t,n)},fo.prototype.c=function(t,e){return uo(ws(t,po(this)),e)},fo.prototype.w=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},mo.prototype.Ka=function(t){return this.Hb=pt(t),this},A(go,mo),A(bo,mo),bo.prototype.Ca=function(t){return X(this.a,t)||this.a.push(t),this},bo.prototype.Pb=function(){return $(this.a)},bo.prototype.credential=function(t,e){var n;if(!(n=v(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new k("argument-error","credential failed: must provide the ID token and/or the access token.");return new fo(this.providerId,n,this.providerId)},A(yo,bo),Ji(yo,"PROVIDER_ID","facebook.com"),Ji(yo,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),A(Io,bo),Ji(Io,"PROVIDER_ID","github.com"),Ji(Io,"GITHUB_SIGN_IN_METHOD","github.com"),A(Eo,bo),Ji(Eo,"PROVIDER_ID","google.com"),Ji(Eo,"GOOGLE_SIGN_IN_METHOD","google.com"),A(ko,mo),Ji(ko,"PROVIDER_ID","twitter.com"),Ji(ko,"TWITTER_SIGN_IN_METHOD","twitter.com"),No.prototype.ja=function(t){return this.signInMethod==Oo.EMAIL_LINK_SIGN_IN_METHOD?eu(t,_s,{email:this.a,oobCode:this.f}):eu(t,zs,{email:this.a,password:this.f})},No.prototype.b=function(t,e){return this.signInMethod==Oo.EMAIL_LINK_SIGN_IN_METHOD?eu(t,Os,{idToken:e,email:this.a,oobCode:this.f}):eu(t,qs,{idToken:e,email:this.a,password:this.f})},No.prototype.c=function(t,e){return uo(this.ja(t),e)},No.prototype.w=function(){return{email:this.a,password:this.f,signInMethod:this.signInMethod}},Yi(Oo,{PROVIDER_ID:"password"}),Yi(Oo,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Yi(Oo,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),Po.prototype.ja=function(t){return t.eb(Lo(this))},Po.prototype.b=function(t,e){var n=Lo(this);return n.idToken=e,eu(t,Zs,n)},Po.prototype.c=function(t,e){var n=Lo(this);return n.operation="REAUTH",uo(t=eu(t,Qs,n),e)},Po.prototype.w=function(){var t={providerId:"phone"};return this.a.cb&&(t.verificationId=this.a.cb),this.a.bb&&(t.verificationCode=this.a.bb),this.a.La&&(t.temporaryProof=this.a.La),this.a.ea&&(t.phoneNumber=this.a.ea),t},xo.prototype.eb=function(t,e){var n=this.a.a;return Ne(e.verify()).then(function(i){if("string"!=typeof i)throw new k("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":var r=v(t)?t.session:null,o=v(t)?t.phoneNumber:t;return(r&&r.type==oo?r.Ha().then(function(t){return eu(n,Gs,{idToken:t,phoneEnrollmentInfo:{phoneNumber:o,recaptchaToken:i}}).then(function(t){return t.phoneSessionInfo.sessionInfo})}):r&&r.type==ao?r.Ha().then(function(e){return function(t,e){return eu(t,Bs,e).then(function(t){return t.phoneResponseInfo.sessionInfo})}(n,{mfaPendingCredential:e,mfaEnrollmentId:t.multiFactorHint&&t.multiFactorHint.uid||t.multiFactorUid,phoneSignInInfo:{recaptchaToken:i}})}):function(t,e){return eu(t,Fs,e)}(n,{phoneNumber:o,recaptchaToken:i})).then(function(t){return"function"==typeof e.reset&&e.reset(),t},function(t){throw"function"==typeof e.reset&&e.reset(),t});default:throw new k("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Yi(xo,{PROVIDER_ID:"phone"}),Yi(xo,{PHONE_SIGN_IN_METHOD:"phone"}),Vo.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},Vo.prototype.S=function(){return this.h},Vo.prototype.w=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.w()}};var qo,Ho=null;function Go(t){var e="unauthorized-domain",n=void 0,i=Un(t);t=i.a,"chrome-extension"==(i=i.f)?n=Kt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==i||"https"==i?n=Kt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",k.call(this,e,n)}function Bo(t,e,n){k.call(this,t,n),(t=e||{}).Ib&&Ji(this,"email",t.Ib),t.ea&&Ji(this,"phoneNumber",t.ea),t.credential&&Ji(this,"credential",t.credential),t.Yb&&Ji(this,"tenantId",t.Yb)}function Wo(t){if(t.code){var e=t.code||"";0==e.indexOf(_)&&(e=e.substring(_.length));var n={credential:jo(t),Yb:t.tenantId};if(t.email)n.Ib=t.email;else if(t.phoneNumber)n.ea=t.phoneNumber;else if(!n.credential)return new k(e,t.message||void 0);return new Bo(e,n,t.message)}return null}function Xo(){}function Jo(t){return t.c||(t.c=t.b())}function Yo(){}function zo(t){if(!t.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var i=e[n];try{return new ActiveXObject(i),t.f=i}catch(r){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.f}function $o(){}function Zo(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=I(this.pc,this),this.a.onerror=I(this.Rb,this),this.a.onprogress=I(this.qc,this),this.a.ontimeout=I(this.uc,this)}function Qo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function ta(t,e,n){this.reset(t,e,n,void 0,void 0)}A(Go,k),A(Bo,k),Bo.prototype.w=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.w();return e&&mt(t,e),t},Bo.prototype.toJSON=function(){return this.w()},Xo.prototype.c=null,A(Yo,Xo),Yo.prototype.a=function(){var t=zo(this);return t?new ActiveXObject(t):new XMLHttpRequest},Yo.prototype.b=function(){var t={};return zo(this)&&(t[0]=!0,t[1]=!0),t},qo=new Yo,A($o,Xo),$o.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Zo;throw Error("Unsupported browser")},$o.prototype.b=function(){return{}},(e=Zo.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},e.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},e.abort=function(){this.a.abort()},e.setRequestHeader=function(){},e.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},e.pc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Qo(this,4)},e.Rb=function(){this.status=500,this.response=this.responseText="",Qo(this,4)},e.uc=function(){this.Rb()},e.qc=function(){this.status=200,Qo(this,1)},e.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},ta.prototype.a=null;function ea(t){this.f=t,this.b=this.c=this.a=null}function na(t,e){this.name=t,this.value=e}ta.prototype.reset=function(t,e,n,i,r){"number"==typeof r||0,i||E(),delete this.a},na.prototype.toString=function(){return this.name};var ia=new na("SEVERE",1e3),ra=new na("WARNING",900),oa=new na("CONFIG",700),aa=new na("FINE",500);ea.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(x("Root logger has no level set."),null)}(this).value)for(p(e)&&(e=e()),t=new ta(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var sa={},ua=null;function ca(t){var e;if(ua||(ua=new ea(""),sa[""]=ua,ua.c=oa),!(e=sa[t])){e=new ea(t);var n=t.lastIndexOf("."),i=t.substr(n+1);(n=ca(t.substr(0,n))).b||(n.b={}),n.b[i]=e,e.a=n,sa[t]=e}return e}function ha(t,e){t&&t.log(aa,e,void 0)}function la(t){this.f=t}function fa(t){wn.call(this),this.o=t,this.readyState=da,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=ca("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}A(la,Xo),la.prototype.a=function(){return new fa(this.f)},la.prototype.b=function(t){return function(){return t}}({}),A(fa,wn);var da=0;function pa(t){t.c.read().then(t.oc.bind(t)).catch(t.Ta.bind(t))}function va(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,ma(t)}function ma(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function ga(t){wn.call(this),this.headers=new _n,this.O=t||null,this.c=!1,this.A=this.a=null,this.h=this.P=this.l="",this.f=this.N=this.i=this.G=!1,this.g=0,this.o=null,this.m=ba,this.u=this.R=!1}(e=fa.prototype).open=function(t,e){if(this.readyState!=da)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,ma(this)},e.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.tc.bind(this),this.Ta.bind(this))},e.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,va(this,!1)),this.readyState=da},e.tc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,ma(this)),this.a&&(this.readyState=3,ma(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.rc.bind(this),this.Ta.bind(this)):void 0!==u.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,pa(this)):t.text().then(this.sc.bind(this),this.Ta.bind(this)))))},e.oc=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?va(this,!0):ma(this),3==this.readyState&&pa(this)}},e.sc=function(t){this.a&&(this.response=this.responseText=t,va(this,!0))},e.rc=function(t){this.a&&(this.response=t,va(this,!0))},e.Ta=function(t){var e=this.h;e&&e.log(ra,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&va(this,!0)},e.setRequestHeader=function(t,e){this.i.append(t,e)},e.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(ra,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},e.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(ra,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},A(ga,wn);var ba="";ga.prototype.b=ca("goog.net.XhrIo");var ya=/^https?$/i,wa=["POST","PUT"];function Ia(t,e,n,i,r){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.P=n,t.G=!1,t.c=!0,t.a=t.O?t.O.a():qo.a(),t.A=t.O?Jo(t.O):Jo(qo),t.a.onreadystatechange=I(t.Ub,t);try{ha(t.b,Ca(t,"Opening Xhr")),t.N=!0,t.a.open(n,String(e),!0),t.N=!1}catch(a){return ha(t.b,Ca(t,"Error opening Xhr: "+a.message)),void Ea(t,a)}e=i||"";var o=new _n(t.headers);r&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(d(t)||"string"==typeof t)H(t,e,void 0);else for(var n=Nn(t),i=Sn(t),r=i.length,o=0;o<r;o++)e.call(void 0,i[o],n&&n[o],t)}(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Ta,n=t.length,i="string"==typeof t?t.split(""):t,r=0;r<n;r++)if(r in i&&e.call(void 0,i[r],r,t)){e=r;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(o.Y()),i=u.FormData&&e instanceof u.FormData,!X(wa,n)||r||i||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},t),t.m&&(t.a.responseType=t.m),"withCredentials"in t.a&&t.a.withCredentials!==t.R&&(t.a.withCredentials=t.R);try{Na(t),0<t.g&&(t.u=function(t){return Xt&&re(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),ha(t.b,Ca(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.u)),t.u?(t.a.timeout=t.g,t.a.ontimeout=I(t.Ma,t)):t.o=An(t.Ma,t.g,t)),ha(t.b,Ca(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(a){ha(t.b,Ca(t,"Send error: "+a.message)),Ea(t,a)}}function Ta(t){return"content-type"==t.toLowerCase()}function Ea(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,Aa(t),Sa(t)}function Aa(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function ka(t){if(t.c&&void 0!==s)if(t.A[1]&&4==_a(t)&&2==Oa(t))ha(t.b,Ca(t,"Local request error detected and ignored"));else if(t.i&&4==_a(t))An(t.Ub,0,t);else if(t.dispatchEvent("readystatechange"),4==_a(t)){ha(t.b,Ca(t,"Request complete")),t.c=!1;try{var e,n=Oa(t);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var i=!0;break t;default:i=!1}if(!(e=i)){var r;if(r=0===n){var o=String(t.l).match(Rn)[1]||null;if(!o&&u.self&&u.self.location){var a=u.self.location.protocol;o=a.substr(0,a.length-1)}r=!ya.test(o?o.toLowerCase():"")}e=r}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<_a(t)?t.a.statusText:""}catch(h){ha(t.b,"Can not get status: "+h.message),c=""}t.h=c+" ["+Oa(t)+"]",Aa(t)}}finally{Sa(t)}}}function Sa(t,e){if(t.a){Na(t);var n=t.a,i=t.A[0]?l:null;t.a=null,t.A=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=i}catch(r){(t=t.b)&&t.log(ia,"Problem encountered resetting onreadystatechange: "+r.message,void 0)}}}function Na(t){t.a&&t.u&&(t.a.ontimeout=null),t.o&&(u.clearTimeout(t.o),t.o=null)}function _a(t){return t.a?t.a.readyState:0}function Oa(t){try{return 2<_a(t)?t.a.status:-1}catch(e){return-1}}function Ca(t,e){return e+" ["+t.P+" "+t.l+" "+Oa(t)+"]"}function Ra(t){var e=qa;this.g=[],this.u=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.m=this.A=this.i=!1,this.h=0,this.b=null,this.l=0}function Pa(t,e,n){t.a=!0,t.c=n,t.f=!e,Ma(t)}function Da(t){if(t.a){if(!t.m)throw new ja(t);t.m=!1}}function La(t,e,n,i){t.g.push([e,n,i]),t.a&&Ma(t)}function xa(t){return W(t.g,function(t){return p(t[1])})}function Ma(t){if(t.h&&t.a&&xa(t)){var e=t.h,n=Fa[e];n&&(u.clearTimeout(n.a),delete Fa[e]),t.h=0}t.b&&(t.b.l--,delete t.b),e=t.c;for(var i=n=!1;t.g.length&&!t.i;){var r=t.g.shift(),o=r[0],a=r[1];if(r=r[2],o=t.f?a:o)try{var s=o.call(r||t.o,e);void 0!==s&&(t.f=t.f&&(s==e||s instanceof Error),t.c=e=s),(P(e)||"function"==typeof u.Promise&&e instanceof u.Promise)&&(i=!0,t.i=!0)}catch(c){e=c,t.f=!0,xa(t)||(n=!0)}}t.c=e,i&&(s=I(t.v,t,!0),i=I(t.v,t,!1),e instanceof Ra?(La(e,s,i),e.A=!0):e.then(s,i)),n&&(e=new Va(e),Fa[e.a]=e,t.h=e.a)}function ja(){D.call(this)}function Ua(){D.call(this)}function Va(t){this.a=u.setTimeout(I(this.c,this),0),this.b=t}(e=ga.prototype).Ma=function(){void 0!==s&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",ha(this.b,Ca(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},e.abort=function(){this.a&&this.c&&(ha(this.b,Ca(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Sa(this))},e.Da=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),Sa(this,!0)),ga.$a.Da.call(this)},e.Ub=function(){this.xa||(this.N||this.i||this.f?ka(this):this.Ic())},e.Ic=function(){ka(this)},e.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case ba:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(ia,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(e){return ha(this.b,"Can not get response: "+e.message),null}},Ra.prototype.cancel=function(t){if(this.a)this.c instanceof Ra&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,0>=e.l&&e.cancel())}this.u?this.u.call(this.o,this):this.m=!0,this.a||(t=new Ua(this),Da(this),Pa(this,!1,t))}},Ra.prototype.v=function(t,e){this.i=!1,Pa(this,t,e)},Ra.prototype.then=function(t,e,n){var i,r,o=new we(function(t,e){i=t,r=e});return La(this,i,function(t){t instanceof Ua?o.cancel():r(t)}),o.then(t,e,n)},Ra.prototype.$goog_Thenable=!0,A(ja,D),ja.prototype.message="Deferred has already fired",ja.prototype.name="AlreadyCalledError",A(Ua,D),Ua.prototype.message="Deferred was canceled",Ua.prototype.name="CanceledError",Va.prototype.c=function(){throw delete Fa[this.a],this.b};var Fa={};function Ka(t){var e={},n=e.document||document,i=At(t).toString(),r=fe(document,"SCRIPT"),o={Vb:r,Ma:void 0},a=new Ra(o),s=null,l=null!=e.timeout?e.timeout:5e3;return 0<l&&(s=window.setTimeout(function(){Ha(r,!0);var t=new Wa(Ba,"Timeout reached for loading script "+i);Da(a),Pa(a,!1,t)},l),o.Ma=s),r.onload=r.onreadystatechange=function(){r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(Ha(r,e.wd||!1,s),Da(a),Pa(a,!0,null))},r.onerror=function(){Ha(r,!0,s);var t=new Wa(Ga,"Error while loading script "+i);Da(a),Pa(a,!1,t)},mt(o=e.attributes||{},{type:"text/javascript",charset:"UTF-8"}),se(r,o),function(t,e){gt(t,"HTMLScriptElement"),t.src=At(e),null===h&&(h=(e=(e=u.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&c.test(e)?e:""),(e=h)&&t.setAttribute("nonce",e)}(r,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(r),a}function qa(){if(this&&this.Vb){var t=this.Vb;t&&"SCRIPT"==t.tagName&&Ha(t,!0,this.Ma)}}function Ha(t,e,n){null!=n&&u.clearTimeout(n),t.onload=l,t.onerror=l,t.onreadystatechange=l,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var Ga=0,Ba=1;function Wa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),D.call(this,n),this.code=t}function Xa(t){this.f=t}function Ja(t,e,i){if(this.c=t,t=e||{},this.l=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.v=t.secureTokenTimeout||$a,this.g=pt(t.secureTokenHeaders||Za),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.identityPlatformEndpoint||"https://identitytoolkit.googleapis.com/v2/",this.m=t.firebaseTimeout||Qa,this.a=pt(t.firebaseHeaders||ts),i&&(this.a["X-Client-Version"]=i,this.g["X-Client-Version"]=i),i="Node"==yi(),!(i=u.XMLHttpRequest||i&&n.INTERNAL.node&&n.INTERNAL.node.XMLHttpRequest)&&!bi())throw new k("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,bi()?this.f=new la(self):wi()?this.f=new Xa(i):this.f=new $o,this.b=null}A(Wa,D),A(Xa,Xo),Xa.prototype.a=function(){return new this.f},Xa.prototype.b=function(){return{}};var Ya,za="idToken",$a=new Vi(3e4,6e4),Za={"Content-Type":"application/x-www-form-urlencoded"},Qa=new Vi(3e4,6e4),ts={"Content-Type":"application/json"};function es(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function ns(t,e){e&&(t.l=is("https://securetoken.googleapis.com/v1/token",e),t.h=is("https://www.googleapis.com/identitytoolkit/v3/relyingparty/",e),t.i=is("https://identitytoolkit.googleapis.com/v2/",e))}function is(t,e){return t=Un(t),e=Un(e.url),t.c=t.a+t.c,Dn(t,e.f),t.a=e.a,Ln(t,e.g),t.toString()}function rs(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function os(t,e,n,i,r,o,a){(function(){var t=Si();return!((t=Ei(t)!=Ti?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&30>t||Xt&&ne&&!(9<ne))})()||bi()?t=I(t.u,t):(Ya||(Ya=new we(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{u[ss]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))};var n=kt(as,{onload:ss});!function(t,e){La(t,null,e,void 0)}(Ka(n),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)})),t=I(t.o,t)),t(e,n,i,r,o,a)}Ja.prototype.S=function(){return this.b},Ja.prototype.u=function(t,e,n,i,r,o){if(bi()&&(void 0===u.fetch||void 0===u.Headers||void 0===u.Request))throw new k("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new ga(this.f);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}In(a,"complete",function(){s&&clearTimeout(s);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return ha(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(n){t=null}e&&e(t)}),Tn(a,"ready",function(){s&&clearTimeout(s),Ge(this)}),Tn(a,"timeout",function(){s&&clearTimeout(s),Ge(this),e&&e(null)}),Ia(a,t,n,i,r)};var as=new bt(It,"https://apis.google.com/js/client.js?onload=%{onload}"),ss="__fcb"+Math.floor(1e6*Math.random()).toString();function us(t,e,n,i,r,o,a){var s=Un(e+n);Mn(s,"key",t.c),a&&Mn(s,"cb",E().toString());var u="GET"==i;if(u)for(var c in r)r.hasOwnProperty(c)&&Mn(s,c,r[c]);return new we(function(e,n){os(t,s.toString(),function(t){t?t.error?n(iu(t,o||{})):e(t):n(new k("network-request-failed"))},i,u?void 0:ni(Li(r)),t.a,t.m.get())})}function cs(t){if("string"!=typeof(t=t.email)||!pi.test(t))throw new k("invalid-email")}function hs(t){"email"in t&&cs(t)}function ls(t){if(!t[za]){if(t.mfaPendingCredential)throw new k("multi-factor-auth-required",null,pt(t));throw new k("internal-error")}}function fs(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new k("internal-error")}else{if(!t.sessionInfo)throw new k("missing-verification-id");if(!t.code)throw new k("missing-verification-code")}}Ja.prototype.o=function(t,e,n,i,r){var o=this;Ya.then(function(){window.gapi.client.setApiKey(o.c);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:i,headers:r,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})}).s(function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Ja.prototype.yb=function(){return eu(this,Hs,{})},Ja.prototype.Ab=function(t,e){return eu(this,Ks,{idToken:t,email:e})},Ja.prototype.Bb=function(t,e){return eu(this,qs,{idToken:t,password:e})};var ds={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function ps(t){if(!t.phoneVerificationInfo)throw new k("internal-error");if(!t.phoneVerificationInfo.sessionInfo)throw new k("missing-verification-id");if(!t.phoneVerificationInfo.code)throw new k("missing-verification-code")}function vs(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new k("internal-error")}function ms(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(Zn(t=new Jn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function gs(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=Wo(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=Wo(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=Wo(t)):t.errorMessage&&(e=nu(t.errorMessage)),e)throw e;ls(t)}function bs(t,e){return e.returnIdpCredential=!0,eu(t,Ws,e)}function ys(t,e){return e.returnIdpCredential=!0,eu(t,Js,e)}function ws(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,eu(t,Xs,e)}function Is(t){if(!t.oobCode)throw new k("invalid-action-code")}(e=Ja.prototype).Cb=function(t,e){var n={idToken:t},i=[];return ft(ds,function(t,r){var o=e[r];null===o?i.push(t):r in e&&(n[r]=o)}),i.length&&(n.deleteAttribute=i),eu(this,Ks,n)},e.ub=function(t,e){return mt(t={requestType:"PASSWORD_RESET",email:t},e),eu(this,Ms,t)},e.vb=function(t,e){return mt(t={requestType:"EMAIL_SIGNIN",email:t},e),eu(this,Ds,t)},e.tb=function(t,e){return mt(t={requestType:"VERIFY_EMAIL",idToken:t},e),eu(this,Ls,t)},e.Db=function(t,e,n){return mt(t={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:t,newEmail:e},n),eu(this,xs,t)},e.eb=function(t){return eu(this,$s,t)},e.mb=function(t,e){return eu(this,Vs,{oobCode:t,newPassword:e})},e.Qa=function(t){return eu(this,Es,{oobCode:t})},e.ib=function(t){return eu(this,Ts,{oobCode:t})};var Ts={endpoint:"setAccountInfo",B:Is,Z:"email",C:!0},Es={endpoint:"resetPassword",B:Is,F:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e&&"VERIFY_AND_CHANGE_EMAIL"!=e)throw new k("internal-error")},C:!0},As={endpoint:"signupNewUser",B:function(t){if(cs(t),!t.password)throw new k("weak-password")},F:ls,U:!0,C:!0},ks={endpoint:"createAuthUri",C:!0},Ss={endpoint:"deleteAccount",M:["idToken"]},Ns={endpoint:"setAccountInfo",M:["idToken","deleteProvider"],B:function(t){if("array"!=f(t.deleteProvider))throw new k("internal-error")}},_s={endpoint:"emailLinkSignin",M:["email","oobCode"],B:cs,F:ls,U:!0,C:!0},Os={endpoint:"emailLinkSignin",M:["idToken","email","oobCode"],B:cs,F:ls,U:!0},Cs={endpoint:"accounts/mfaEnrollment:finalize",M:["idToken","phoneVerificationInfo"],B:ps,F:ls,C:!0,Na:!0},Rs={endpoint:"accounts/mfaSignIn:finalize",M:["mfaPendingCredential","phoneVerificationInfo"],B:ps,F:ls,C:!0,Na:!0},Ps={endpoint:"getAccountInfo"},Ds={endpoint:"getOobConfirmationCode",M:["requestType"],B:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new k("internal-error");cs(t)},Z:"email",C:!0},Ls={endpoint:"getOobConfirmationCode",M:["idToken","requestType"],B:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new k("internal-error")},Z:"email",C:!0},xs={endpoint:"getOobConfirmationCode",M:["idToken","newEmail","requestType"],B:function(t){if("VERIFY_AND_CHANGE_EMAIL"!=t.requestType)throw new k("internal-error")},Z:"email",C:!0},Ms={endpoint:"getOobConfirmationCode",M:["requestType"],B:function(t){if("PASSWORD_RESET"!=t.requestType)throw new k("internal-error");cs(t)},Z:"email",C:!0},js={kb:!0,endpoint:"getProjectConfig",Tb:"GET"},Us={kb:!0,endpoint:"getRecaptchaParam",Tb:"GET",F:function(t){if(!t.recaptchaSiteKey)throw new k("internal-error")}},Vs={endpoint:"resetPassword",B:Is,Z:"email",C:!0},Fs={endpoint:"sendVerificationCode",M:["phoneNumber","recaptchaToken"],Z:"sessionInfo",C:!0},Ks={endpoint:"setAccountInfo",M:["idToken"],B:hs,U:!0},qs={endpoint:"setAccountInfo",M:["idToken"],B:function(t){if(hs(t),!t.password)throw new k("weak-password")},F:ls,U:!0},Hs={endpoint:"signupNewUser",F:ls,U:!0,C:!0},Gs={endpoint:"accounts/mfaEnrollment:start",M:["idToken","phoneEnrollmentInfo"],B:function(t){if(!t.phoneEnrollmentInfo)throw new k("internal-error");if(!t.phoneEnrollmentInfo.phoneNumber)throw new k("missing-phone-number");if(!t.phoneEnrollmentInfo.recaptchaToken)throw new k("missing-app-credential")},F:function(t){if(!t.phoneSessionInfo||!t.phoneSessionInfo.sessionInfo)throw new k("internal-error")},C:!0,Na:!0},Bs={endpoint:"accounts/mfaSignIn:start",M:["mfaPendingCredential","mfaEnrollmentId","phoneSignInInfo"],B:function(t){if(!t.phoneSignInInfo||!t.phoneSignInInfo.recaptchaToken)throw new k("missing-app-credential")},F:function(t){if(!t.phoneResponseInfo||!t.phoneResponseInfo.sessionInfo)throw new k("internal-error")},C:!0,Na:!0},Ws={endpoint:"verifyAssertion",B:vs,Xa:ms,F:gs,U:!0,C:!0},Xs={endpoint:"verifyAssertion",B:vs,Xa:ms,F:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new k("user-not-found");if(t.errorMessage)throw nu(t.errorMessage);ls(t)},U:!0,C:!0},Js={endpoint:"verifyAssertion",B:function(t){if(vs(t),!t.idToken)throw new k("internal-error")},Xa:ms,F:gs,U:!0},Ys={endpoint:"verifyCustomToken",B:function(t){if(!t.token)throw new k("invalid-custom-token")},F:ls,U:!0,C:!0},zs={endpoint:"verifyPassword",B:function(t){if(cs(t),!t.password)throw new k("wrong-password")},F:ls,U:!0,C:!0},$s={endpoint:"verifyPhoneNumber",B:fs,F:ls,C:!0},Zs={endpoint:"verifyPhoneNumber",B:function(t){if(!t.idToken)throw new k("internal-error");fs(t)},F:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",Wo(t);ls(t)}},Qs={Gb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",B:fs,F:ls,C:!0},tu={endpoint:"accounts/mfaEnrollment:withdraw",M:["idToken","mfaEnrollmentId"],F:function(t){if(!!t[za]^!!t.refreshToken)throw new k("internal-error")},C:!0,Na:!0};function eu(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var i=t[e[n]];if(null==i||""===i)return!1}return!0}(n,e.M))return _e(new k("internal-error"));var i,r=!!e.Na,o=e.Tb||"POST";return Ne(n).then(e.B).then(function(){return e.U&&(n.returnSecureToken=!0),e.C&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),us(t,r?t.i:t.h,e.endpoint,o,n,e.Gb,e.kb||!1)}).then(function(t){return i=t,e.Xa?e.Xa(n,i):i}).then(e.F).then(function(){if(!e.Z)return i;if(!(e.Z in i))throw new k("internal-error");return i[e.Z]})}function nu(t){return iu({error:{errors:[{message:t}],code:400,message:t}})}function iu(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",i={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=i[n]?new k(i[n]):null)return n;for(var r in n=t.error&&t.error.message||"",mt(i={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",EMAIL_CHANGE_NEEDS_VERIFICATION:"email-change-needs-verification",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",UNSUPPORTED_FIRST_FACTOR:"unsupported-first-factor",UNVERIFIED_EMAIL:"unverified-email"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<e.length?e[1]:void 0,i)if(0===n.indexOf(r))return new k(i[r],e);return!e&&t&&(e=Di(t)),new k("internal-error",e)}function ru(t){this.b=t,this.a=null,this.qb=function(t){return(uu||(uu=new we(function(t,e){function n(){Ui(),Ni("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Ui(),e(Error("Network Error"))},timeout:au.get()})}if(Ni("gapi.iframes.Iframe"))t();else if(Ni("gapi.load"))n();else{var i="__iframefcb"+Math.floor(1e6*Math.random()).toString();u[i]=function(){Ni("gapi.load")?n():e(Error("Network Error"))},Ne(Ka(i=kt(ou,{onload:i}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw uu=null,t}))).then(function(){return new we(function(e,n){Ni("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:Ni("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(i){function r(){clearTimeout(o),e()}t.a=i,t.a.restyle({setHideOnLeave:!1});var o=setTimeout(function(){n(Error("Network Error"))},su.get());i.ping(r).then(r,function(){n(Error("Network Error"))})})})})}(this)}var ou=new bt(It,"https://apis.google.com/js/api.js?onload=%{onload}"),au=new Vi(3e4,6e4),su=new Vi(5e3,15e3),uu=null;function cu(t,e,n,i){this.l=t,this.h=e,this.i=n,this.g=i,this.f=null,this.g?t=Vn((t=Un(this.g.url)).f,t.a,t.g,"/emulator/auth/iframe"):t=Vn("https",this.l,null,"/__/auth/iframe"),this.a=t,Mn(this.a,"apiKey",this.h),Mn(this.a,"appName",this.i),this.b=null,this.c=[]}function hu(t,e,n,i,r,o){this.u=t,this.o=e,this.c=n,this.v=i,this.m=o,this.i=this.g=this.l=null,this.a=r,this.h=this.f=null}function lu(t){try{return n.app(t).auth().Ga()}catch(e){return[]}}function fu(t,e,n,i,r,o){this.o=t,this.g=e,this.b=n,this.f=o,this.c=i||null,this.i=r||null,this.l=this.u=this.A=null,this.h=[],this.v=this.a=null}function du(t){var e=ui();return function(t){return eu(t,js,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var n=Un(e),i=n.f;n=n.a;for(var r=0;r<t.length;r++){var o=t[r],a=n,s=i;if(0==o.indexOf("chrome-extension://")?a=Un(o).a==a&&"chrome-extension"==s:"http"!=s&&"https"!=s?a=!1:di.test(o)?a=a==o:(o=o.split(".").join("\\."),a=new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)),a){t=!0;break t}}t=!1}if(!t)throw new Go(ui())})}function pu(t){return t.v?t.v:(t.v=vi().then(function(){if(!t.u){var e=t.c,n=t.i,i=lu(t.b),r=new cu(t.o,t.g,t.b,t.f);r.f=e,r.b=n,r.c=$(i||[]),t.u=r.toString()}t.m=new ru(t.u),function(t){if(!t.m)throw Error("IfcHandler must be initialized!");!function(t,e){t.qb.then(function(){t.a.register("authEvent",e,Ni("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(t.m,function(e){var n={};if(e&&e.authEvent){var i=!1;for(e=Fo(e.authEvent),n=0;n<t.h.length;n++)i=t.h[n](e)||i;return(n={}).status=i?"ACK":"ERROR",Ne(n)}return n.status="ERROR",Ne(n)})}(t)}),t.v)}function vu(t){return t.l||(t.A=t.c?ki(t.c,lu(t.b)):null,t.l=new Ja(t.g,R(t.i),t.A),t.f&&ns(t.l,t.f)),t.l}function mu(t,e,n,i,r,o,a,s,u,c,h,l){return(t=new hu(t,e,n,i,r,l)).l=o,t.g=a,t.i=s,t.b=pt(u||null),t.f=c,t.xb(h).toString()}function gu(t){if(this.a=t||n.INTERNAL.reactNative&&n.INTERNAL.reactNative.AsyncStorage,!this.a)throw new k("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function bu(t){this.b=t,this.a={},this.f=I(this.c,this)}cu.prototype.toString=function(){return this.f?Mn(this.a,"v",this.f):$n(this.a.b,"v"),this.b?Mn(this.a,"eid",this.b):$n(this.a.b,"eid"),this.c.length?Mn(this.a,"fw",this.c.join(",")):$n(this.a.b,"fw"),this.a.toString()},hu.prototype.xb=function(t){return this.h=t,this},hu.prototype.toString=function(){if(this.m){var t=Un(this.m.url);t=Vn(t.f,t.a,t.g,"/emulator/auth/handler")}else t=Vn("https",this.u,null,"/__/auth/handler");if(Mn(t,"apiKey",this.o),Mn(t,"appName",this.c),Mn(t,"authType",this.v),this.a.isOAuthProvider){var e=this.a;try{var i=n.app(this.c).auth().ka()}catch(u){i=null}for(var r in e.nb=i,Mn(t,"providerId",this.a.providerId),e=Li((i=this.a).Hb))e[r]=e[r].toString();r=i.Pc,e=pt(e);for(var o=0;o<r.length;o++){var a=r[o];a in e&&delete e[a]}i.ob&&i.nb&&!e[i.ob]&&(e[i.ob]=i.nb),dt(e)||Mn(t,"customParameters",Di(e))}if("function"==typeof this.a.Pb&&((i=this.a.Pb()).length&&Mn(t,"scopes",i.join(","))),this.l?Mn(t,"redirectUrl",this.l):$n(t.b,"redirectUrl"),this.g?Mn(t,"eventId",this.g):$n(t.b,"eventId"),this.i?Mn(t,"v",this.i):$n(t.b,"v"),this.b)for(var s in this.b)this.b.hasOwnProperty(s)&&!jn(t,s)&&Mn(t,s,this.b[s]);return this.h?Mn(t,"tid",this.h):$n(t.b,"tid"),this.f?Mn(t,"eid",this.f):$n(t.b,"eid"),(s=lu(this.c)).length&&Mn(t,"fw",s.join(",")),t.toString()},(e=fu.prototype).Nb=function(t,e,n){var i=new k("popup-closed-by-user"),r=new k("web-storage-unsupported"),o=this,a=!1;return this.la().then(function(){(function(t){var e={type:"webStorageSupport"};return pu(t).then(function(){return function(t,e){return t.qb.then(function(){return new we(function(n){t.a.send(e.type,e,n,Ni("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.m,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(n){n||(t&&li(t),e(r),a=!0)})}).s(function(){}).then(function(){if(!a)return function(t){return new we(function(e){return function n(){kn(2e3).then(function(){if(t&&!t.closed)return n();e()})}()})}(t)}).then(function(){if(!a)return kn(n).then(function(){e(i)})})},e.Wb=function(){var t=Si();return!Pi(t)&&!ji(t)},e.Sb=function(){return!1},e.Lb=function(t,e,n,i,r,o,a,s){if(!t)return _e(new k("popup-blocked"));if(a&&!Pi())return this.la().s(function(e){li(t),r(e)}),i(),Ne();this.a||(this.a=du(vu(this)));var u=this;return this.a.then(function(){var e=u.la().s(function(e){throw li(t),r(e),e});return i(),e}).then(function(){(Uo(n),a)||ci(mu(u.o,u.g,u.b,e,n,null,o,u.c,void 0,u.i,s,u.f),t)}).s(function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t})},e.Mb=function(t,e,n,i){this.a||(this.a=du(vu(this)));var r=this;return this.a.then(function(){Uo(e),ci(mu(r.o,r.g,r.b,t,e,ui(),n,r.c,void 0,r.i,i,r.f))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},e.la=function(){var t=this;return pu(this).then(function(){return t.m.qb}).s(function(){throw t.a=null,new k("network-request-failed")})},e.Zb=function(){return!0},e.Ea=function(t){this.h.push(t)},e.Ra=function(t){Y(this.h,function(e){return e==t})},(e=gu.prototype).get=function(t){return Ne(this.a.getItem(t)).then(function(t){return t&&xi(t)})},e.set=function(t,e){return Ne(this.a.setItem(t,Di(e)))},e.T=function(t){return Ne(this.a.removeItem(t))},e.ca=function(){},e.ia=function(){};var yu,wu=[];function Iu(t,e,n){dt(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function Tu(t){this.a=t}function Eu(t){this.c=t,this.b=!1,this.a=[]}function Au(t,e,n,i){var r,o,a,s,u=n||{},c=null;if(t.b)return _e(Error("connection_unavailable"));var h=i?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new we(function(n,i){l?(r=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){i(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===r&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){i(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):i(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),i(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:r,data:u},[l.port2])):i(Error("connection_unavailable"))}).then(function(e){return ku(t,c),e}).s(function(e){throw ku(t,c),e})}function ku(t,e){if(e){var n=e.messageChannel,i=e.onMessage;n&&(n.port1.removeEventListener("message",i),n.port1.close()),Y(t.a,function(t){return t==e})}}function Su(){if(!Ou())throw new k("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.m=u.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var t=this;bi()&&self?(this.l=function(){var t=bi()?self:null;if(H(wu,function(n){n.b==t&&(e=n)}),!e){var e=new bu(t);wu.push(e)}return e}(),Iu(this.l,"keyChanged",function(e,n){return Lu(t).then(function(e){return 0<e.length&&H(t.a,function(t){t(e)}),{keyProcessed:X(e,n.key)}})}),Iu(this.l,"ping",function(){return Ne(["keyChanged"])})):function(){var t=u.navigator;return t&&t.serviceWorker?Ne().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Ne(null)}().then(function(e){(t.h=e)&&(t.g=new Eu(new Tu(e)),Au(t.g,"ping",null,!0).then(function(e){e[0].fulfilled&&X(e[0].value,"keyChanged")&&(t.o=!0)}).s(function(){}))})}function Nu(t){return new we(function(e,n){var i=t.m.open("firebaseLocalStorageDb",1);i.onerror=function(t){try{t.preventDefault()}catch(e){}n(Error(t.target.error))},i.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(e){n(e)}},i.onsuccess=function(i){(i=i.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(i):function(t){return new we(function(e,n){var i=t.m.deleteDatabase("firebaseLocalStorageDb");i.onsuccess=function(){e()},i.onerror=function(t){n(Error(t.target.error))}})}(t).then(function(){return Nu(t)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function _u(t){return t.v||(t.v=Nu(t)),t.v}function Ou(){try{return!!u.indexedDB}catch(Bt){return!1}}function Cu(t){return t.objectStore("firebaseLocalStorage")}function Ru(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Pu(t){return new we(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function Du(t,e){return t.g&&t.h&&function(){var t=u.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Au(t.g,"keyChanged",{key:e},t.o).then(function(){}).s(function(){}):Ne()}function Lu(t){return _u(t).then(function(t){var e=Cu(Ru(t,!1));return e.getAll?Pu(e.getAll()):new we(function(t,n){var i=[],r=e.openCursor();r.onsuccess=function(e){(e=e.target.result)?(i.push(e.value),e.continue()):t(i)},r.onerror=function(t){n(t.target.error)}})}).then(function(e){var n={},i=[];if(0==t.b){for(i=0;i<e.length;i++)n[e[i].fbase_key]=e[i].value;i=function t(e,n){var i,r=[];for(i in e)i in n?typeof e[i]!=typeof n[i]?r.push(i):"object"==typeof e[i]&&null!=e[i]&&null!=n[i]?0<t(e[i],n[i]).length&&r.push(i):e[i]!==n[i]&&r.push(i):r.push(i);for(i in n)i in e||r.push(i);return r}(t.c,n),t.c=n}return i})}function xu(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function Mu(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Ne().then(function(){if(Ou()){var t=Mi(),i="__sak"+t;return yu||(yu=new Su),(n=yu).set(i,t).then(function(){return n.get(i)}).then(function(e){if(e!==t)throw Error("indexedDB not supported!");return n.T(i)}).then(function(){return n}).s(function(){return e.c})}return e.c}).then(function(t){return e.type=t.type,t.ca(function(t){H(e.a,function(e){e(t)})}),t})}function ju(){this.a={},this.type="inMemory"}function Uu(){if(!function(){var t="Node"==yi();if(!(t=Vu()||t&&n.INTERNAL.node&&n.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(e){return!1}}()){if("Node"==yi())throw new k("internal-error","The LocalStorage compatibility library was not found.");throw new k("web-storage-unsupported")}this.a=Vu()||n.INTERNAL.node.localStorage,this.type="localStorage"}function Vu(){try{var t=u.localStorage,e=Mi();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(n){return null}}function Fu(){this.type="nullStorage"}function Ku(){if(!function(){var t="Node"==yi();if(!(t=qu()||t&&n.INTERNAL.node&&n.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(e){return!1}}()){if("Node"==yi())throw new k("internal-error","The SessionStorage compatibility library was not found.");throw new k("web-storage-unsupported")}this.a=qu()||n.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function qu(){try{var t=u.sessionStorage,e=Mi();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(n){return null}}function Hu(){var t={};t.Browser=Wu,t.Node=Xu,t.ReactNative=Ju,t.Worker=Yu,this.a=t[yi()]}bu.prototype.c=function(t){var e=t.data.eventType,n=t.data.eventId,i=this.a[e];if(i&&0<i.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var r=[];H(i,function(e){r.push(Ne().then(function(){return e(t.origin,t.data.data)}))}),Ce(r).then(function(i){var r=[];H(i,function(t){r.push({fulfilled:t.Ob,value:t.value,reason:t.reason?t.reason.message:void 0})}),H(r,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:r})})}},Tu.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Eu.prototype.close=function(){for(;0<this.a.length;)ku(this,this.a[0]);this.b=!0},(e=Su.prototype).set=function(t,e){var n,i=!1,r=this;return _u(this).then(function(e){return Pu((e=Cu(Ru(n=e,!0))).get(t))}).then(function(o){var a=Cu(Ru(n,!0));return o?(o.value=e,Pu(a.put(o))):(r.b++,i=!0,(o={}).fbase_key=t,o.value=e,Pu(a.add(o)))}).then(function(){return r.c[t]=e,Du(r,t)}).na(function(){i&&r.b--})},e.get=function(t){return _u(this).then(function(e){return Pu(Cu(Ru(e,!1)).get(t))}).then(function(t){return t&&t.value})},e.T=function(t){var e=!1,n=this;return _u(this).then(function(i){return e=!0,n.b++,Pu(Cu(Ru(i,!0)).delete(t))}).then(function(){return delete n.c[t],Du(n,t)}).na(function(){e&&n.b--})},e.ca=function(t){0==this.a.length&&function(t){xu(t),function e(){t.f=setTimeout(function(){t.i=Lu(t).then(function(e){0<e.length&&H(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},e.ia=function(t){Y(this.a,function(e){return e==t}),0==this.a.length&&xu(this)},(e=Mu.prototype).get=function(t){return this.b.then(function(e){return e.get(t)})},e.set=function(t,e){return this.b.then(function(n){return n.set(t,e)})},e.T=function(t){return this.b.then(function(e){return e.T(t)})},e.ca=function(t){this.a.push(t)},e.ia=function(t){Y(this.a,function(e){return e==t})},(e=ju.prototype).get=function(t){return Ne(this.a[t])},e.set=function(t,e){return this.a[t]=e,Ne()},e.T=function(t){return delete this.a[t],Ne()},e.ca=function(){},e.ia=function(){},(e=Uu.prototype).get=function(t){var e=this;return Ne().then(function(){return xi(e.a.getItem(t))})},e.set=function(t,e){var n=this;return Ne().then(function(){var i=Di(e);null===i?n.T(t):n.a.setItem(t,i)})},e.T=function(t){var e=this;return Ne().then(function(){e.a.removeItem(t)})},e.ca=function(t){u.window&&un(u.window,"storage",t)},e.ia=function(t){u.window&&ln(u.window,"storage",t)},(e=Fu.prototype).get=function(){return Ne(null)},e.set=function(){return Ne()},e.T=function(){return Ne()},e.ca=function(){},e.ia=function(){},(e=Ku.prototype).get=function(t){var e=this;return Ne().then(function(){return xi(e.a.getItem(t))})},e.set=function(t,e){var n=this;return Ne().then(function(){var i=Di(e);null===i?n.T(t):n.a.setItem(t,i)})},e.T=function(t){var e=this;return Ne().then(function(){e.a.removeItem(t)})},e.ca=function(){},e.ia=function(){};var Gu,Bu,Wu={D:Uu,ab:Ku},Xu={D:Uu,ab:Ku},Ju={D:gu,ab:Fu},Yu={D:Uu,ab:Fu},zu={qd:"local",NONE:"none",sd:"session"};function $u(){var t=!(ji(Si())||!gi()),e=Pi(),n=_i();this.v=t,this.h=e,this.l=n,this.a={},Gu||(Gu=new Hu),t=Gu;try{this.g=!si()&&Hi()||!u.indexedDB?new t.a.D:new Mu(bi()?new ju:new t.a.D)}catch(i){this.g=new ju,this.h=!0}try{this.i=new t.a.ab}catch(i){this.i=new ju}this.m=new ju,this.f=I(this.Xb,this),this.b={}}function Zu(){return Bu||(Bu=new $u),Bu}function Qu(t,e){switch(e){case"session":return t.i;case"none":return t.m;default:return t.g}}function tc(t,e){return"firebase:"+t.name+(e?":"+e:"")}function ec(t,e,n){return n=tc(e,n),"local"==e.D&&(t.b[n]=null),Qu(t,e.D).T(n)}function nc(t){t.c&&(clearInterval(t.c),t.c=null)}function ic(t){this.a=t,this.b=Zu()}(e=$u.prototype).get=function(t,e){return Qu(this,t.D).get(tc(t,e))},e.set=function(t,e,n){var i=tc(t,n),r=this,o=Qu(this,t.D);return o.set(i,e).then(function(){return o.get(i)}).then(function(e){"local"==t.D&&(r.b[i]=e)})},e.addListener=function(t,e,n){t=tc(t,e),this.l&&(this.b[t]=u.localStorage.getItem(t)),dt(this.a)&&(Qu(this,"local").ca(this.f),this.h||(si()||!Hi())&&u.indexedDB||!this.l||function(t){nc(t),t.c=setInterval(function(){for(var e in t.a){var n=u.localStorage.getItem(e),i=t.b[e];n!=i&&(t.b[e]=n,n=new ze({type:"storage",key:e,target:window,oldValue:i,newValue:n,a:!0}),t.Xb(n))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},e.removeListener=function(t,e,n){t=tc(t,e),this.a[t]&&(Y(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),dt(this.a)&&(Qu(this,"local").ia(this.f),nc(this))},e.Xb=function(t){if(t&&t.g){var e=t.a.key;if(null==e)for(var n in this.a){var i=this.b[n];void 0===i&&(i=null);var r=u.localStorage.getItem(n);r!==i&&(this.b[n]=r,this.lb(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Qu(this,"local").ia(this.f):nc(this),this.v)if(n=u.localStorage.getItem(e),(i=t.a.newValue)!==n)null!==i?u.localStorage.setItem(e,i):u.localStorage.removeItem(e);else if(this.b[e]===i&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===u.localStorage.getItem(e)||(o.b[e]=u.localStorage.getItem(e),o.lb(e))},Xt&&ne&&10==ne&&u.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else H(t,I(this.lb,this))},e.lb=function(t){this.a[t]&&H(this.a[t],function(t){t()})};var rc,oc={name:"authEvent",D:"local"};function ac(){this.a=Zu()}function sc(t,e){this.b=uc,this.f=u.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=u.Int32Array?new Int32Array(64):Array(64),void 0===rc&&(rc=u.Int32Array?new Int32Array(vc):vc),this.reset()}A(sc,function(){this.b=-1});for(var uc=64,cc=uc-1,hc=[],lc=0;lc<cc;lc++)hc[lc]=0;var fc=z(128,hc);function dc(t){for(var e=t.f,n=t.l,i=0,r=0;r<e.length;)n[i++]=e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3],r=4*i;for(e=16;64>e;e++){r=0|n[e-15],i=0|n[e-2];var o=(0|n[e-16])+((r>>>7|r<<25)^(r>>>18|r<<14)^r>>>3)|0,a=(0|n[e-7])+((i>>>17|i<<15)^(i>>>19|i<<13)^i>>>10)|0;n[e]=o+a|0}i=0|t.a[0],r=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;64>e;e++){var f=((i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10))+(i&r^i&s^r&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|rc[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=r,r=i,i=a+f|0}t.a[0]=t.a[0]+i|0,t.a[1]=t.a[1]+r|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function pc(t,e,n){void 0===n&&(n=e.length);var i=0,r=t.c;if("string"==typeof e)for(;i<n;)t.f[r++]=e.charCodeAt(i++),r==t.b&&(dc(t),r=0);else{if(!d(e))throw Error("message must be string or array");for(;i<n;){var o=e[i++];if(!("number"==typeof o&&0<=o&&255>=o&&o==(0|o)))throw Error("message must be a byte array");t.f[r++]=o,r==t.b&&(dc(t),r=0)}}t.c=r,t.g+=n}sc.prototype.reset=function(){this.g=this.c=0,this.a=u.Int32Array?new Int32Array(this.h):$(this.h)};var vc=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function mc(){sc.call(this,8,gc)}A(mc,sc);var gc=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function bc(t,e,n,i,r,o){this.m=t,this.i=e,this.l=n,this.v=i||null,this.u=r||null,this.o=o,this.h=e+":"+n,this.A=new ac,this.g=new ic(this.h),this.f=null,this.b=[],this.a=this.c=null}function yc(t){return new k("invalid-cordova-configuration",t)}function wc(t){var e=new mc;pc(e,t),t=[];var n=8*e.g;56>e.c?pc(e,fc,56-e.c):pc(e,fc,e.b-(e.c-56));for(var i=63;56<=i;i--)e.f[i]=255&n,n/=256;for(dc(e),i=n=0;i<e.i;i++)for(var r=24;0<=r;r-=8)t[n++]=e.a[i]>>r&255;return function(t){return B(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function Ic(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(i){}}function Tc(t){return t.f||(t.f=t.la().then(function(){return new we(function(e){t.Ea(function n(i){return e(i),t.Ra(n),!1}),function(t){function e(e){i=!0,r&&r.cancel(),Ec(t).then(function(i){var r=n;if(i&&e&&e.url){var o=null;-1!=(r=io(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=xi(jn(o=Un(r),"firebaseError")||null))?S(o):null)?new Vo(i.c,i.b,null,null,o,null,i.S()):new Vo(i.c,i.b,r,i.f,null,null,i.S())),r=o||n}Ic(t,r)})}var n=new Vo("unknown",null,null,null,new k("no-auth-event")),i=!1,r=kn(500).then(function(){return Ec(t).then(function(){i||Ic(t,n)})}),o=u.handleOpenURL;u.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(Ni("BuildInfo.packageName",u).toLowerCase()+"://")&&e({url:t}),"function"==typeof o)try{o(t)}catch(n){console.error(n)}},Ho||(Ho=new Ko),function(t){var e=Ho;e.a.push(t),e.b||(e.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=Ni("universalLinks.subscribe",u))&&t(null,e.b))}(e)}(t)})})),t.f}function Ec(t){var e=null;return function(t){return t.b.get(oc,t.a).then(function(t){return Fo(t)})}(t.g).then(function(n){return e=n,ec((n=t.g).b,oc,n.a)}).then(function(){return e})}function Ac(t){this.a=t,this.b=Zu()}(e=bc.prototype).la=function(){return this.Ia?this.Ia:this.Ia=(mi(void 0)?vi().then(function(){return new we(function(t,e){var n=u.document,i=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(i),t()},!1)})}):_e(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof Ni("universalLinks.subscribe",u))throw yc("cordova-universal-links-plugin-fix is not installed");if(void 0===Ni("BuildInfo.packageName",u))throw yc("cordova-plugin-buildinfo is not installed");if("function"!=typeof Ni("cordova.plugins.browsertab.openUrl",u))throw yc("cordova-plugin-browsertab is not installed");if("function"!=typeof Ni("cordova.InAppBrowser.open",u))throw yc("cordova-plugin-inappbrowser is not installed")},function(){throw new k("cordova-not-ready")})},e.Nb=function(t,e){return e(new k("operation-not-supported-in-this-environment")),Ne()},e.Lb=function(){return _e(new k("operation-not-supported-in-this-environment"))},e.Zb=function(){return!1},e.Wb=function(){return!0},e.Sb=function(){return!0},e.Mb=function(t,e,n,i){if(this.c)return _e(new k("redirect-operation-pending"));var r=this,o=u.document,a=null,s=null,c=null,h=null;return this.c=Ne().then(function(){return Uo(e),Tc(r)}).then(function(){return function(t,e,n,i,r){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),a=new Vo(e,i,null,o,new k("no-auth-event"),null,r),s=Ni("BuildInfo.packageName",u);if("string"!=typeof s)throw new k("invalid-cordova-configuration");var c=Ni("BuildInfo.displayName",u),h={};if(Si().toLowerCase().match(/iphone|ipad|ipod/))h.ibi=s;else{if(!Si().toLowerCase().match(/android/))return _e(new k("operation-not-supported-in-this-environment"));h.apn=s}c&&(h.appDisplayName=c),o=wc(o),h.sessionId=o;var l=mu(t.m,t.i,t.l,e,n,null,i,t.v,h,t.u,r,t.o);return t.la().then(function(){var e=t.h;return t.A.a.set(oc,a.w(),e)}).then(function(){var e=Ni("cordova.plugins.browsertab.isAvailable",u);if("function"!=typeof e)throw new k("invalid-cordova-configuration");var n=null;e(function(e){if(e){if("function"!=typeof(n=Ni("cordova.plugins.browsertab.openUrl",u)))throw new k("invalid-cordova-configuration");n(l)}else{if("function"!=typeof(n=Ni("cordova.InAppBrowser.open",u)))throw new k("invalid-cordova-configuration");e=Si(),t.a=n(l,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(r,t,e,n,i)}).then(function(){return new we(function(t,e){s=function(){var e=Ni("cordova.plugins.browsertab.close",u);return t(),"function"==typeof e&&e(),r.a&&"function"==typeof r.a.close&&(r.a.close(),r.a=null),!1},r.Ea(s),c=function(){a||(a=kn(2e3).then(function(){e(new k("redirect-cancelled-by-user"))}))},h=function(){Fi()&&c()},o.addEventListener("resume",c,!1),Si().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",h,!1)}).s(function(t){return Ec(r).then(function(){throw t})})}).na(function(){c&&o.removeEventListener("resume",c,!1),h&&o.removeEventListener("visibilitychange",h,!1),a&&a.cancel(),s&&r.Ra(s),r.c=null})},e.Ea=function(t){this.b.push(t),Tc(this).s(function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new Vo("unknown",null,null,null,new k("no-auth-event")),t(e))})},e.Ra=function(t){Y(this.b,function(e){return e==t})};var kc={name:"pendingRedirect",D:"session"};function Sc(t){return ec(t.b,kc,t.a)}function Nc(t,e,n,i){this.i={},this.u=0,this.O=t,this.m=e,this.v=n,this.G=i,this.h=[],this.f=!1,this.l=I(this.o,this),this.b=new qc,this.A=new Xc,this.g=new Ac(Fc(this.m,this.v)),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.A,this.c.linkViaPopup=this.A,this.c.reauthViaPopup=this.A,this.a=_c(this.O,this.m,this.v,N,this.G)}function _c(t,e,i,r,o){var a=n.SDK_VERSION||null;return mi()?new bc(t,e,i,a,r,o):new fu(t,e,i,a,r,o)}function Oc(t){t.f||(t.f=!0,t.a.Ea(t.l));var e=t.a;return t.a.la().s(function(n){throw t.a==e&&t.reset(),n})}function Cc(t){t.a.Wb()&&Oc(t).s(function(e){var n=new Vo("unknown",null,null,null,new k("operation-not-supported-in-this-environment"));Mc(e)&&t.o(n)}),t.a.Sb()||Hc(t.b)}function Rc(t,e){X(t.h,e)||t.h.push(e),t.f||function(t){return t.b.get(kc,t.a).then(function(t){return"pending"==t})}(t.g).then(function(e){e?Sc(t.g).then(function(){Oc(t).s(function(e){var n=new Vo("unknown",null,null,null,new k("operation-not-supported-in-this-environment"));Mc(e)&&t.o(n)})}):Cc(t)}).s(function(){Cc(t)})}function Pc(t,e){Y(t.h,function(t){return t==e})}Nc.prototype.reset=function(){this.f=!1,this.a.Ra(this.l),this.a=_c(this.O,this.m,this.v,null,this.G),this.i={}},Nc.prototype.o=function(t){if(!t)throw new k("invalid-auth-event");if(6e5<=E()-this.u&&(this.i={},this.u=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var i=this.h[n];if(i.Eb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,i),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.u=E())),e=!0;break}}return Hc(this.b),e};var Dc=new Vi(2e3,1e4),Lc=new Vi(3e4,6e4);function xc(t,e,n,i,r,o,a){return t.a.Lb(e,n,i,function(){t.f||(t.f=!0,t.a.Ea(t.l))},function(){t.reset()},r,o,a)}function Mc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function jc(t,e,n,i,r){var o;return function(t){return t.b.set(kc,"pending",t.a)}(t.g).then(function(){return t.a.Mb(e,n,i,r).s(function(e){if(Mc(e))throw new k("operation-not-supported-in-this-environment");return o=e,Sc(t.g).then(function(){throw o})}).then(function(){return t.a.Zb()?new we(function(){}):Sc(t.g).then(function(){return t.qa()}).then(function(){}).s(function(){})})})}function Uc(t,e,n,i,r){return t.a.Nb(i,function(t){e.ma(n,null,t,r)},Dc.get())}Nc.prototype.qa=function(){return this.b.qa()};var Vc={};function Fc(t,e,n){return t=t+":"+e,n&&(t=t+":"+n.url),t}function Kc(t,e,n,i){var r=Fc(e,n,i);return Vc[r]||(Vc[r]=new Nc(t,e,n,i)),Vc[r]}function qc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function Hc(t){t.g||(t.g=!0,Wc(t,!1,null,null))}function Gc(t){t.g&&!t.i&&Wc(t,!1,null,null)}function Bc(t,e){if(t.b=function(){return Ne(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function Wc(t,e,n,i){e?i?function(t,e){if(t.b=function(){return _e(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,i):Bc(t,n):Bc(t,{user:null}),t.f=[],t.c=[]}function Xc(){}function Jc(){this.hb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.hb},set:function(t){this.hb=t},enumerable:!1})}function Yc(t,e){this.a=e,Ji(this,"verificationId",t)}function zc(t,e,n,i){return new xo(t).eb(e,n).then(function(t){return new Yc(t,i)})}function $c(t){var e=Hr(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new k("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Yi(this,{token:t,expirationTime:qi(1e3*e.exp),authTime:qi(1e3*e.auth_time),issuedAtTime:qi(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,signInSecondFactor:e.firebase&&e.firebase.sign_in_second_factor?e.firebase.sign_in_second_factor:null,claims:e})}function Zc(t,e,n){var i=e&&e[th];if(!i)throw new k("argument-error","Internal assert: Invalid MultiFactorResolver");this.a=t,this.f=pt(e),this.g=n,this.c=new ro(null,i),this.b=[];var r=this;H(e[Qc]||[],function(t){(t=Qi(t))&&r.b.push(t)}),Ji(this,"auth",this.a),Ji(this,"session",this.c),Ji(this,"hints",this.b)}qc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},qc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,i=t.b,r=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!r&&!o),"unknown"!=n||r||o?t.a?(Wc(this,!0,null,t.a),Ne()):e.Fa(n,i)?function(t,e,n){n=n.Fa(e.c,e.b);var i=e.g,r=e.f,o=e.i,a=e.S(),s=!!e.c.match(/Redirect$/);n(i,r,a,o).then(function(e){Wc(t,s,e,null)}).s(function(e){Wc(t,s,null,e)})}(this,t,e):_e(new k("invalid-auth-event")):(Wc(this,!1,null,null),Ne())}else _e(new k("invalid-auth-event"))},qc.prototype.qa=function(){var t=this;return new we(function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new k("timeout");t.a&&t.a.cancel(),t.a=kn(Lc.get()).then(function(){t.b||(t.g=!0,Wc(t,!0,null,e))})}(t))})},Xc.prototype.h=function(t,e){if(t){var n=t.c,i=t.b;t.a?(e.ma(t.c,null,t.a,t.b),Ne()):e.Fa(n,i)?function(t,e){var n=t.b,i=t.c;e.Fa(i,n)(t.g,t.f,t.S(),t.i).then(function(t){e.ma(i,t,null,n)}).s(function(t){e.ma(i,null,t,n)})}(t,e):_e(new k("invalid-auth-event"))}else _e(new k("invalid-auth-event"))},Yc.prototype.confirm=function(t){return t=Mo(this.verificationId,t),this.a(t)};var Qc="mfaInfo",th="mfaPendingCredential";function eh(t,e,n,i){k.call(this,"multi-factor-auth-required",i,e),this.b=new Zc(t,e,n),Ji(this,"resolver",this.b)}function nh(t,e,n){if(t&&v(t.serverResponse)&&"auth/multi-factor-auth-required"===t.code)try{return new eh(e,t.serverResponse,n,t.message)}catch(i){}return null}function ih(){}function rh(t){Ji(this,"factorId",t.fa),this.a=t}function oh(t){if(rh.call(this,t),this.a.fa!=xo.PROVIDER_ID)throw new k("argument-error","firebase.auth.PhoneMultiFactorAssertion requires a valid firebase.auth.PhoneAuthCredential")}function ah(t,e){for(var n in Ye.call(this,t),e)this[n]=e[n]}function sh(t,e){this.a=t,this.b=[],this.c=I(this.xc,this),un(this.a,"userReloaded",this.c);var n=[];e&&e.multiFactor&&e.multiFactor.enrolledFactors&&H(e.multiFactor.enrolledFactors,function(t){var e=null,i={};if(t){t.uid&&(i[nr]=t.uid),t.displayName&&(i[tr]=t.displayName),t.enrollmentTime&&(i[er]=new Date(t.enrollmentTime).toISOString()),t.phoneNumber&&(i[ir]=t.phoneNumber);try{e=new rr(i)}catch(r){}t=e}else t=null;t&&n.push(t)}),uh(this,n)}function uh(t,e){t.b=e,Ji(t,"enrolledFactors",e)}function ch(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function hh(t){this.c=t,this.b=this.a=null}function lh(t){return t.b&&1e3*t.b.c||0}function fh(t,e){var n=e.refreshToken;t.b=qr(e[za]||""),t.a=n}function dh(t,e){return function(t,e){return new we(function(n,i){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?os(t,t.l+"?key="+encodeURIComponent(t.c),function(t){t?t.error?i(iu(t)):t.access_token&&t.refresh_token?n(t):i(new k("internal-error")):i(new k("network-request-failed"))},"POST",zn(e).toString(),t.g,t.v.get()):i(new k("internal-error"))})}(t.c,e).then(function(e){return t.b=qr(e.access_token),t.a=e.refresh_token,{accessToken:t.b.toString(),refreshToken:t.a}}).s(function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e})}function ph(t,e){this.a=t||null,this.b=e||null,Yi(this,{lastSignInTime:qi(e||null),creationTime:qi(t||null)})}function vh(t,e,n,i,r,o){Yi(this,{uid:t,displayName:i||null,photoURL:r||null,email:n||null,phoneNumber:o||null,providerId:e})}function mh(t,e,i){this.G=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null;var r=n.SDK_VERSION?ki(n.SDK_VERSION):null;this.a=new Ja(this.l,R(N),r),t.emulatorConfig&&ns(this.a,t.emulatorConfig),this.b=new hh(this.a),Ah(this,e[za]),fh(this.b,e),Ji(this,"refreshToken",this.b.a),Nh(this,i||{}),wn.call(this),this.P=!1,this.o&&Oi()&&(this.i=Kc(this.o,this.l,this.m)),this.R=[],this.f=null,this.u=function(t){return new ch(function(){return t.I(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var e=lh(t.b)-E()-3e5;return 0<e?e:0})}(this),this.$=I(this.gb,this);var o=this;this.pa=null,this.Ba=function(t){o.wa(t.h)},this.ba=null,this.za=function(t){ns(o.a,t.c)},this.W=null,this.X=[],this.Aa=function(t){yh(o,t.f)},this.aa=null,this.N=new sh(this,i),Ji(this,"multiFactor",this.N)}function gh(t,e){t.ba&&ln(t.ba,"languageCodeChanged",t.Ba),(t.ba=e)&&un(e,"languageCodeChanged",t.Ba)}function bh(t,e){t.W&&ln(t.W,"emulatorConfigChanged",t.za),(t.W=e)&&un(e,"emulatorConfigChanged",t.za)}function yh(t,e){t.X=e,rs(t.a,n.SDK_VERSION?ki(n.SDK_VERSION,t.X):null)}function wh(t,e){t.aa&&ln(t.aa,"frameworkChanged",t.Aa),(t.aa=e)&&un(e,"frameworkChanged",t.Aa)}function Ih(t){try{return n.app(t.m).auth()}catch(e){throw new k("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.m+"'!")}}function Th(t){t.A||t.u.b||(t.u.start(),ln(t,"tokenChanged",t.$),un(t,"tokenChanged",t.$))}function Eh(t){ln(t,"tokenChanged",t.$),t.u.stop()}function Ah(t,e){t.ya=e,Ji(t,"_lat",e)}function kh(t){for(var e=[],n=0;n<t.R.length;n++)e.push(t.R[n](t));return Ce(e).then(function(){return t})}function Sh(t){t.i&&!t.P&&(t.P=!0,Rc(t.i,t))}function Nh(t,e){Yi(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new ph(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function _h(){}function Oh(t){return Ne().then(function(){if(t.A)throw new k("app-deleted")})}function Ch(t){return B(t.providerData,function(t){return t.providerId})}function Rh(t,e){e&&(Ph(t,e.providerId),t.providerData.push(e))}function Ph(t,e){Y(t.providerData,function(t){return t.providerId==e})}function Dh(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Ji(t,e,n)}function Lh(t,e){t!=e&&(Yi(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,tenantId:e.tenantId,providerData:[]}),e.metadata?Ji(t,"metadata",function(t){return new ph(t.a,t.b)}(e.metadata)):Ji(t,"metadata",new ph),H(e.providerData,function(e){Rh(t,e)}),function(t,e){t.b=e.b,t.a=e.a}(t.b,e.b),Ji(t,"refreshToken",t.b.a),uh(t.N,e.N.b))}function xh(t){return t.I().then(function(e){var n=t.isAnonymous;return function(t,e){return eu(t.a,Ps,{idToken:e}).then(I(t.Jc,t))}(t,e).then(function(){return n||Dh(t,"isAnonymous",!1),e})})}function Mh(t,e){e[za]&&t.ya!=e[za]&&(fh(t.b,e),t.dispatchEvent(new ah("tokenChanged")),Ah(t,e[za]),Dh(t,"refreshToken",t.b.a))}function jh(t,e){return xh(t).then(function(){if(X(Ch(t),e))return kh(t).then(function(){throw new k("provider-already-linked")})})}function Uh(t,e,n){return zi({user:t,credential:jo(e),additionalUserInfo:e=Jr(e),operationType:n})}function Vh(t,e){return Mh(t,e),t.reload().then(function(){return t})}function Fh(t,e,i,r,o){if(!Oi())return _e(new k("operation-not-supported-in-this-environment"));if(t.f&&!o)return _e(t.f);var a=Xr(i.providerId),s=Mi(t.uid+":::"),u=null;(!Pi()||gi())&&t.o&&i.isOAuthProvider&&(u=mu(t.o,t.l,t.m,e,i,null,s,n.SDK_VERSION||null,null,null,t.tenantId));var c=fi(u,a&&a.ua,a&&a.ta);return r=r().then(function(){if(qh(t),!o)return t.I().then(function(){})}).then(function(){return xc(t.i,c,e,i,s,!!u,t.tenantId)}).then(function(){return new we(function(n,i){t.ma(e,null,new k("cancelled-popup-request"),t.h||null),t.g=n,t.O=i,t.h=s,t.c=Uc(t.i,t,e,c,s)})}).then(function(t){return c&&li(c),t?zi(t):null}).s(function(t){throw c&&li(c),t}),Hh(t,r,o)}function Kh(t,e,n,i,r){if(!Oi())return _e(new k("operation-not-supported-in-this-environment"));if(t.f&&!r)return _e(t.f);var o=null,a=Mi(t.uid+":::");return i=i().then(function(){if(qh(t),!r)return t.I().then(function(){})}).then(function(){return t.ga=a,kh(t)}).then(function(e){return t.ha&&(e=(e=t.ha).b.set(Wh,t.w(),e.a)),e}).then(function(){return jc(t.i,e,n,a,t.tenantId)}).s(function(e){if(o=e,t.ha)return Xh(t.ha);throw o}).then(function(){if(o)throw o}),Hh(t,i,r)}function qh(t){if(!t.i||!t.P){if(t.i&&!t.P)throw new k("internal-error");throw new k("auth-domain-config-required")}}function Hh(t,e,n){var i=function(t,e,n){return t.f&&!n?(e.cancel(),_e(t.f)):e.s(function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.f||t.dispatchEvent(new ah("userInvalidated")),t.f=e),e})}(t,e,n);return t.G.push(i),i.na(function(){J(t.G,i)}),i.s(function(e){var n=null;throw e&&"auth/multi-factor-auth-required"===e.code&&(n=nh(e.w(),Ih(t),I(t.ic,t))),n||e})}function Gh(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName,emulatorConfig:t.emulatorConfig},n={};if(!t.stsTokenManager||!t.stsTokenManager.accessToken)return null;n[za]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null;var i=new mh(e,n,t);return t.providerData&&H(t.providerData,function(t){t&&Rh(i,zi(t))}),t.redirectEventId&&(i.ga=t.redirectEventId),i}function Bh(t){this.a=t,this.b=Zu()}Zc.prototype.Qc=function(t){var e=this;return t.rb(this.a.a,this.c).then(function(t){var n=pt(e.f);return delete n[Qc],delete n[th],mt(n,t),e.g(n)})},A(eh,k),ih.prototype.rb=function(t,e,n){return e.type==oo?function(t,e,n,i){return n.Ha().then(function(n){return n={idToken:n},void 0!==i&&(n.displayName=i),mt(n,{phoneVerificationInfo:Lo(t.a)}),eu(e,Cs,n)})}(this,t,e,n):function(t,e,n){return n.Ha().then(function(n){return mt(n={mfaPendingCredential:n},{phoneVerificationInfo:Lo(t.a)}),eu(e,Rs,n)})}(this,t,e)},A(rh,ih),A(oh,rh),A(ah,Ye),(e=sh.prototype).xc=function(t){uh(this,function(t){var e=[];return H(t.mfaInfo||[],function(t){(t=Qi(t))&&e.push(t)}),e}(t.gd))},e.Qb=function(){return this.a.I().then(function(t){return new ro(t,null)})},e.ec=function(t,e){var n=this,i=this.a.a;return this.Qb().then(function(n){return t.rb(i,n,e)}).then(function(t){return Mh(n.a,t),n.a.reload()})},e.ad=function(t){var e=this,n="string"==typeof t?t:t.uid,i=this.a.a;return this.a.I().then(function(t){return eu(i,tu,{idToken:t,mfaEnrollmentId:n})}).then(function(t){var i=G(e.b,function(t){return t.uid!=n});return uh(e,i),Mh(e.a,t),e.a.reload().s(function(t){if("auth/user-token-expired"!=t.code)throw t})})},e.w=function(){return{multiFactor:{enrolledFactors:B(this.b,function(t){return t.w()})}}},ch.prototype.start=function(){this.a=this.c,function t(e,n){e.stop();e.b=kn(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,n)).then(function(){return t=u.document,e=null,Fi()||!t?Ne():new we(function(n){e=function(){Fi()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)}).s(function(n){throw t.removeEventListener("visibilitychange",e,!1),n});var t,e}).then(function(){return e.h()}).then(function(){t(e,!0)}).s(function(n){e.i(n)&&t(e,!1)})}(this,!0)},ch.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},hh.prototype.w=function(){return{apiKey:this.c.c,refreshToken:this.a,accessToken:this.b&&this.b.toString(),expirationTime:lh(this)}},hh.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?_e(new k("user-token-expired")):t||!this.b||E()>lh(this)-3e4?this.a?dh(this,{grant_type:"refresh_token",refresh_token:this.a}):Ne(null):Ne({accessToken:this.b.toString(),refreshToken:this.a})},ph.prototype.w=function(){return{lastLoginAt:this.b,createdAt:this.a}},A(mh,wn),mh.prototype.wa=function(t){this.pa=t,es(this.a,t)},mh.prototype.ka=function(){return this.pa},mh.prototype.Ga=function(){return $(this.X)},mh.prototype.gb=function(){this.u.b&&(this.u.stop(),this.u.start())},Ji(mh.prototype,"providerId","firebase"),(e=mh.prototype).reload=function(){var t=this;return Hh(this,Oh(this).then(function(){return xh(t).then(function(){return kh(t)}).then(_h)}))},e.nc=function(t){return this.I(t).then(function(t){return new $c(t)})},e.I=function(t){var e=this;return Hh(this,Oh(this).then(function(){return e.b.getToken(t)}).then(function(t){if(!t)throw new k("internal-error");return t.accessToken!=e.ya&&(Ah(e,t.accessToken),e.dispatchEvent(new ah("tokenChanged"))),Dh(e,"refreshToken",t.refreshToken),t.accessToken}))},e.Jc=function(t){if(!(t=t.users)||!t.length)throw new k("internal-error");Nh(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?B(t,function(t){return new vh(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Rh(this,e[n]);Dh(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length)),this.dispatchEvent(new ah("userReloaded",{gd:t}))},e.Kc=function(t){return Wi("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.sb(t)},e.sb=function(t){var e=this,n=null;return Hh(this,t.c(this.a,this.uid).then(function(t){return Mh(e,t),n=Uh(e,t,"reauthenticate"),e.f=null,e.reload()}).then(function(){return n}),!0)},e.Bc=function(t){return Wi("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.pb(t)},e.pb=function(t){var e=this,n=null;return Hh(this,jh(this,t.providerId).then(function(){return e.I()}).then(function(n){return t.b(e.a,n)}).then(function(t){return n=Uh(e,t,"link"),Vh(e,t)}).then(function(){return n}))},e.Cc=function(t,e){var n=this;return Hh(this,jh(this,"phone").then(function(){return zc(Ih(n),t,e,I(n.pb,n))}))},e.Lc=function(t,e){var n=this;return Hh(this,Ne().then(function(){return zc(Ih(n),t,e,I(n.sb,n))}),!0)},e.Ab=function(t){var e=this;return Hh(this,this.I().then(function(n){return e.a.Ab(n,t)}).then(function(t){return Mh(e,t),e.reload()}))},e.dd=function(t){var e=this;return Hh(this,this.I().then(function(n){return t.b(e.a,n)}).then(function(t){return Mh(e,t),e.reload()}))},e.Bb=function(t){var e=this;return Hh(this,this.I().then(function(n){return e.a.Bb(n,t)}).then(function(t){return Mh(e,t),e.reload()}))},e.Cb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Oh(this);var e=this;return Hh(this,this.I().then(function(n){return e.a.Cb(n,{displayName:t.displayName,photoUrl:t.photoURL})}).then(function(t){return Mh(e,t),Dh(e,"displayName",t.displayName||null),Dh(e,"photoURL",t.photoUrl||null),H(e.providerData,function(t){"password"===t.providerId&&(Ji(t,"displayName",e.displayName),Ji(t,"photoURL",e.photoURL))}),kh(e)}).then(_h))},e.bd=function(t){var e=this;return Hh(this,xh(this).then(function(n){return X(Ch(e),t)?function(t,e,n){return eu(t,Ns,{idToken:e,deleteProvider:n})}(e.a,n,[t]).then(function(t){var n={};return H(t.providerUserInfo||[],function(t){n[t.providerId]=!0}),H(Ch(e),function(t){n[t]||Ph(e,t)}),n[xo.PROVIDER_ID]||Ji(e,"phoneNumber",null),kh(e)}):kh(e).then(function(){throw new k("no-such-provider")})}))},e.delete=function(){var t=this;return Hh(this,this.I().then(function(e){return eu(t.a,Ss,{idToken:e})}).then(function(){t.dispatchEvent(new ah("userDeleted"))})).then(function(){for(var e=0;e<t.G.length;e++)t.G[e].cancel("app-deleted");gh(t,null),bh(t,null),wh(t,null),t.G=[],t.A=!0,Eh(t),Ji(t,"refreshToken",null),t.i&&Pc(t.i,t)})},e.Eb=function(t,e){return!!("linkViaPopup"==t&&(this.h||null)==e&&this.g||"reauthViaPopup"==t&&(this.h||null)==e&&this.g||"linkViaRedirect"==t&&(this.ga||null)==e||"reauthViaRedirect"==t&&(this.ga||null)==e)},e.ma=function(t,e,n,i){"linkViaPopup"!=t&&"reauthViaPopup"!=t||i!=(this.h||null)||(n&&this.O?this.O(n):e&&!n&&this.g&&this.g(e),this.c&&(this.c.cancel(),this.c=null),delete this.g,delete this.O)},e.Fa=function(t,e){return"linkViaPopup"==t&&e==(this.h||null)?I(this.Jb,this):"reauthViaPopup"==t&&e==(this.h||null)?I(this.Kb,this):"linkViaRedirect"==t&&(this.ga||null)==e?I(this.Jb,this):"reauthViaRedirect"==t&&(this.ga||null)==e?I(this.Kb,this):null},e.Dc=function(t){var e=this;return Fh(this,"linkViaPopup",t,function(){return jh(e,t.providerId).then(function(){return kh(e)})},!1)},e.Mc=function(t){return Fh(this,"reauthViaPopup",t,function(){return Ne()},!0)},e.Ec=function(t){var e=this;return Kh(this,"linkViaRedirect",t,function(){return jh(e,t.providerId)},!1)},e.Nc=function(t){return Kh(this,"reauthViaRedirect",t,function(){return Ne()},!0)},e.Jb=function(t,e,n,i){var r=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return Hh(this,this.I().then(function(n){return ys(r.a,{requestUri:t,postBody:i,sessionId:e,idToken:n})}).then(function(t){return o=Uh(r,t,"link"),Vh(r,t)}).then(function(){return o}))},e.Kb=function(t,e,n,i){var r=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return Hh(this,Ne().then(function(){return uo(ws(r.a,{requestUri:t,sessionId:e,postBody:i,tenantId:n}),r.uid)}).then(function(t){return o=Uh(r,t,"reauthenticate"),Mh(r,t),r.f=null,r.reload()}).then(function(){return o}),!0)},e.tb=function(t){var e=this,n=null;return Hh(this,this.I().then(function(e){return n=e,void 0===t||dt(t)?{}:Ur(new _r(t))}).then(function(t){return e.a.tb(n,t)}).then(function(t){if(e.email!=t)return e.reload()}).then(function(){}))},e.Db=function(t,e){var n=this,i=null;return Hh(this,this.I().then(function(t){return i=t,void 0===e||dt(e)?{}:Ur(new _r(e))}).then(function(e){return n.a.Db(i,t,e)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},e.ic=function(t){var e=null,n=this;return Hh(this,t=uo(Ne(t),n.uid).then(function(t){return e=Uh(n,t,"reauthenticate"),Mh(n,t),n.f=null,n.reload()}).then(function(){return e}),!0)},e.toJSON=function(){return this.w()},e.w=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.w(),redirectEventId:this.ga||null};return this.metadata&&mt(t,this.metadata.w()),H(this.providerData,function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))}),mt(t,this.N.w()),t};var Wh={name:"redirectUser",D:"session"};function Xh(t){return ec(t.b,Wh,t.a)}function Jh(t){this.a=t,this.b=Zu(),this.c=null,this.f=function(t){var e=$h("local"),n=$h("session"),i=$h("none");return function(t,e,n){var i=tc(e,n),r=Qu(t,e.D);return t.get(e,n).then(function(o){var a=null;try{a=xi(u.localStorage.getItem(i))}catch(s){}if(a&&!o)return u.localStorage.removeItem(i),t.set(e,a,n);a&&o&&"localStorage"!=r.type&&u.localStorage.removeItem(i)})}(t.b,e,t.a).then(function(){return t.b.get(n,t.a)}).then(function(r){return r?n:t.b.get(i,t.a).then(function(n){return n?i:t.b.get(e,t.a).then(function(n){return n?e:t.b.get(zh,t.a).then(function(t){return t?$h(t):e})})})}).then(function(e){return t.c=e,Yh(t,e.D)}).s(function(){t.c||(t.c=e)})}(this),this.b.addListener($h("local"),this.a,I(this.g,this))}function Yh(t,e){var n,i=[];for(n in zu)zu[n]!==e&&i.push(ec(t.b,$h(zu[n]),t.a));return i.push(ec(t.b,zh,t.a)),function(t){return new we(function(e,n){var i=t.length,r=[];if(i)for(var o=function(t,n){i--,r[t]=n,0==i&&e(r)},a=function(t){n(t)},s=0;s<t.length;s++)Oe(t[s],T(o,s),a);else e(r)})}(i)}Jh.prototype.g=function(){var t=this,e=$h("local");el(this,function(){return Ne().then(function(){return t.c&&"local"!=t.c.D?t.b.get(e,t.a):null}).then(function(n){if(n)return Yh(t,"local").then(function(){t.c=e})})})};var zh={name:"persistence",D:"session"};function $h(t){return{name:"authUser",D:t}}function Zh(t,e){return el(t,function(){return t.b.set(t.c,e.w(),t.a)})}function Qh(t){return el(t,function(){return ec(t.b,t.c,t.a)})}function tl(t,e,n){return el(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),t&&n&&(t.emulatorConfig=n),Gh(t||{})})})}function el(t,e){return t.f=t.f.then(e,e),t.f}function nl(t){if(this.m=!1,Ji(this,"settings",new Jc),Ji(this,"app",t),!ll(this).options||!ll(this).options.apiKey)throw new k("invalid-api-key");t=n.SDK_VERSION?ki(n.SDK_VERSION):null,this.a=new Ja(ll(this).options&&ll(this).options.apiKey,R(N),t),this.R=[],this.u=[],this.P=[],this.ac=n.INTERNAL.createSubscribe(I(this.yc,this)),this.X=void 0,this.bc=n.INTERNAL.createSubscribe(I(this.zc,this)),cl(this,null),this.l=new Jh(ll(this).options.apiKey+":"+ll(this).name),this.G=new Bh(ll(this).options.apiKey+":"+ll(this).name),this.$=vl(this,function(t){var e=ll(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(Wh,t.a).then(function(t){return t&&e&&(t.authDomain=e),Gh(t||{})})}(t.G,ll(t).options.authDomain).then(function(e){return(t.o=e)&&(e.ha=t.G),Xh(t.G)});return vl(t,e)}(t).then(function(){return tl(t.l,e,t.f)}).then(function(e){return e?(e.ha=t.G,t.o&&(t.o.ga||null)==(e.ga||null)?e:e.reload().then(function(){return Zh(t.l,e).then(function(){return e})}).s(function(n){return"auth/network-request-failed"==n.code?e:Qh(t.l)})):null}).then(function(e){cl(t,e||null)});return vl(t,n)}(this)),this.i=vl(this,function(t){return t.$.then(function(){return sl(t)}).s(function(){}).then(function(){if(!t.m)return t.pa()}).s(function(){}).then(function(){if(!t.m){t.ba=!0;var e=t.l;e.b.addListener($h("local"),e.a,t.pa)}})}(this)),this.ba=!1,this.pa=I(this.Yc,this),this.Ba=I(this.da,this),this.ya=I(this.kc,this),this.za=I(this.vc,this),this.Aa=I(this.wc,this),this.b=null,function(t){var e=ll(t).options.authDomain,n=ll(t).options.apiKey;e&&Oi()&&(t.gb=t.$.then(function(){if(!t.m){if(t.b=Kc(e,n,ll(t).name,t.f),Rc(t.b,t),fl(t)&&Sh(fl(t)),t.o){Sh(t.o);var i=t.o;i.wa(t.ka()),gh(i,t),yh(i=t.o,t.N),wh(i,t),ns((i=t.o).a,t.f),bh(i,t),t.o=null}return t.b}}))}(this),this.INTERNAL={},this.INTERNAL.delete=I(this.delete,this),this.INTERNAL.logFramework=I(this.Fc,this),this.A=0,wn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ka()},set:function(t){this.wa(t)},enumerable:!1}),t.aa=null,Object.defineProperty(t,"ti",{get:function(){return this.S()},set:function(t){this.xb(t)},enumerable:!1}),t.W=null}(this),this.N=[],this.f=null}function il(t){Ye.call(this,"languageCodeChanged"),this.h=t}function rl(t){Ye.call(this,"emulatorConfigChanged"),this.c=t}function ol(t){Ye.call(this,"frameworkChanged"),this.f=t}function al(t){return t.gb||_e(new k("auth-domain-config-required"))}function sl(t){if(!Oi())return _e(new k("operation-not-supported-in-this-environment"));var e=al(t).then(function(){return t.b.qa()}).then(function(t){return t?zi(t):null});return vl(t,e)}function ul(t,e){var n={};return n.apiKey=ll(t).options.apiKey,n.authDomain=ll(t).options.authDomain,n.appName=ll(t).name,t.f&&(n.emulatorConfig=t.f),t.$.then(function(){return function(t,e,n,i){var r=new mh(t,e);return n&&(r.ha=n),i&&yh(r,i),r.reload().then(function(){return r})}(n,e,t.G,t.Ga())}).then(function(e){return fl(t)&&e.uid==fl(t).uid?(Lh(fl(t),e),t.da(e)):(cl(t,e),Sh(e),t.da(e))}).then(function(){pl(t)})}function cl(t,e){fl(t)&&(function(t,e){Y(t.R,function(t){return t==e})}(fl(t),t.Ba),ln(fl(t),"tokenChanged",t.ya),ln(fl(t),"userDeleted",t.za),ln(fl(t),"userInvalidated",t.Aa),Eh(fl(t))),e&&(e.R.push(t.Ba),un(e,"tokenChanged",t.ya),un(e,"userDeleted",t.za),un(e,"userInvalidated",t.Aa),0<t.A&&Th(e)),Ji(t,"currentUser",e),e&&(e.wa(t.ka()),gh(e,t),yh(e,t.N),wh(e,t),ns(e.a,t.f),bh(e,t))}function hl(t,e){var n=null,i=null;return vl(t,e.then(function(e){return n=jo(e),i=Jr(e),ul(t,e)},function(e){var n=null;throw e&&"auth/multi-factor-auth-required"===e.code&&(n=nh(e.w(),t,I(t.jc,t))),n||e}).then(function(){return zi({user:fl(t),credential:n,additionalUserInfo:i,operationType:"signIn"})}))}function ll(t){return t.app}function fl(t){return t.currentUser}function dl(t){return fl(t)&&fl(t)._lat||null}function pl(t){if(t.ba){for(var e=0;e<t.u.length;e++)t.u[e]&&t.u[e](dl(t));if(t.X!==t.getUid()&&t.P.length)for(t.X=t.getUid(),e=0;e<t.P.length;e++)t.P[e]&&t.P[e](dl(t))}}function vl(t,e){return t.R.push(e),e.na(function(){J(t.R,e)}),e}function ml(){}function gl(){this.a={},this.b=1e12}Jh.prototype.wb=function(t){var e=null,n=this;return function(t){var e=new k("invalid-persistence-type"),n=new k("unsupported-persistence-type");t:{for(i in zu)if(zu[i]==t){var i=!0;break t}i=!1}if(!i||"string"!=typeof t)throw e;switch(yi()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;case"Worker":if("session"===t||!Ou()&&"none"!==t)throw n;break;default:if(!_i()&&"none"!==t)throw n}}(t),el(this,function(){return t!=n.c.D?n.b.get(n.c,n.a).then(function(i){return e=i,Yh(n,t)}).then(function(){if(n.c=$h(t),e)return n.b.set(n.c,e,n.a)}):Ne()})},A(nl,wn),A(il,Ye),A(rl,Ye),A(ol,Ye),(e=nl.prototype).wb=function(t){return vl(this,t=this.l.wb(t))},e.wa=function(t){this.aa===t||this.m||(this.aa=t,es(this.a,this.aa),this.dispatchEvent(new il(this.ka())))},e.ka=function(){return this.aa},e.ed=function(){var t=u.navigator;this.wa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},e.fd=function(t){if(!this.f){if(!/^https?:\/\//.test(t))throw new k("argument-error","Emulator URL must start with a valid scheme (http:// or https://).");Ki("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),u.document&&vi().then(function(){var t=u.document.createElement("div");t.innerText="Running in emulator mode. Do not use with production credentials.",t.style.position="fixed",t.style.width="100%",t.style.backgroundColor="#ffffff",t.style.border=".1em solid #000000",t.style.color="#ff0000",t.style.bottom="0px",t.style.left="0px",t.style.margin="0px",t.style.zIndex=1e4,t.style.textAlign="center",t.classList.add("firebase-emulator-warning"),u.document.body.appendChild(t)}),this.f={url:t},this.settings.hb=!0,ns(this.a,this.f),this.dispatchEvent(new rl(this.f))}},e.Fc=function(t){this.N.push(t),rs(this.a,n.SDK_VERSION?ki(n.SDK_VERSION,this.N):null),this.dispatchEvent(new ol(this.N))},e.Ga=function(){return $(this.N)},e.xb=function(t){this.W===t||this.m||(this.W=t,this.a.b=this.W)},e.S=function(){return this.W},e.toJSON=function(){return{apiKey:ll(this).options.apiKey,authDomain:ll(this).options.authDomain,appName:ll(this).name,currentUser:fl(this)&&fl(this).w()}},e.Eb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.h==e&&!!this.g;default:return!1}},e.ma=function(t,e,n,i){"signInViaPopup"==t&&this.h==i&&(n&&this.O?this.O(n):e&&!n&&this.g&&this.g(e),this.c&&(this.c.cancel(),this.c=null),delete this.g,delete this.O)},e.Fa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.h==e&&this.g?I(this.hc,this):null},e.hc=function(t,e,n,i){var r=this,o={requestUri:t,postBody:i,sessionId:e,tenantId:n};return this.c&&(this.c.cancel(),this.c=null),r.$.then(function(){return hl(r,bs(r.a,o))})},e.Wc=function(t){if(!Oi())return _e(new k("operation-not-supported-in-this-environment"));var e=this,i=Xr(t.providerId),r=Mi(),o=null;(!Pi()||gi())&&ll(this).options.authDomain&&t.isOAuthProvider&&(o=mu(ll(this).options.authDomain,ll(this).options.apiKey,ll(this).name,"signInViaPopup",t,null,r,n.SDK_VERSION||null,null,null,this.S(),this.f));var a=fi(o,i&&i.ua,i&&i.ta);return vl(this,i=al(this).then(function(n){return xc(n,a,"signInViaPopup",t,r,!!o,e.S())}).then(function(){return new we(function(t,n){e.ma("signInViaPopup",null,new k("cancelled-popup-request"),e.h),e.g=t,e.O=n,e.h=r,e.c=Uc(e.b,e,"signInViaPopup",a,r)})}).then(function(t){return a&&li(a),t?zi(t):null}).s(function(t){throw a&&li(a),t}))},e.Xc=function(t){if(!Oi())return _e(new k("operation-not-supported-in-this-environment"));var e=this;return vl(this,al(this).then(function(){return el(t=e.l,function(){return t.b.set(zh,t.c.D,t.a)});var t}).then(function(){return jc(e.b,"signInViaRedirect",t,void 0,e.S())}))},e.qa=function(){var t=this;return sl(this).then(function(e){return t.b&&Gc(t.b.b),e}).s(function(e){throw t.b&&Gc(t.b.b),e})},e.cd=function(t){if(!t)return _e(new k("null-user"));if(this.W!=t.tenantId)return _e(new k("tenant-id-mismatch"));var e=this,n={};n.apiKey=ll(this).options.apiKey,n.authDomain=ll(this).options.authDomain,n.appName=ll(this).name;var i=function(t,e,n,i){var r=t.b,o={};return o[za]=r.b&&r.b.toString(),o.refreshToken=r.a,e=new mh(e||{apiKey:t.l,authDomain:t.o,appName:t.m},o),n&&(e.ha=n),i&&yh(e,i),Lh(e,t),e}(t,n,e.G,e.Ga());return vl(this,this.i.then(function(){if(ll(e).options.apiKey!=t.l)return i.reload()}).then(function(){return fl(e)&&t.uid==fl(e).uid?(Lh(fl(e),t),e.da(t)):(cl(e,i),Sh(i),e.da(i))}).then(function(){pl(e)}))},e.zb=function(){var t=this;return vl(this,this.i.then(function(){return t.b&&Gc(t.b.b),fl(t)?(cl(t,null),Qh(t.l).then(function(){pl(t)})):Ne()}))},e.Yc=function(){var t=this;return tl(this.l,ll(this).options.authDomain).then(function(e){if(!t.m){var n;if(n=fl(t)&&e){n=fl(t).uid;var i=e.uid;n=null!=n&&""!==n&&null!=i&&""!==i&&n==i}if(n)return Lh(fl(t),e),fl(t).I();(fl(t)||e)&&(cl(t,e),e&&(Sh(e),e.ha=t.G),t.b&&Rc(t.b,t),pl(t))}})},e.da=function(t){return Zh(this.l,t)},e.kc=function(){pl(this),this.da(fl(this))},e.vc=function(){this.zb()},e.wc=function(){this.zb()},e.jc=function(t){var e=this;return this.i.then(function(){return hl(e,Ne(t))})},e.yc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(fl(e))})},e.zc=function(t){var e=this;!function(t,e){t.P.push(e),vl(t,t.i.then(function(){!t.m&&X(t.P,e)&&t.X!==t.getUid()&&(t.X=t.getUid(),e(dl(t)))}))}(this,function(){t.next(fl(e))})},e.Hc=function(t,e,n){var i=this;return this.ba&&Promise.resolve().then(function(){"function"==typeof t?t(fl(i)):"function"==typeof t.next&&t.next(fl(i))}),this.ac(t,e,n)},e.Gc=function(t,e,n){var i=this;return this.ba&&Promise.resolve().then(function(){i.X=i.getUid(),"function"==typeof t?t(fl(i)):"function"==typeof t.next&&t.next(fl(i))}),this.bc(t,e,n)},e.mc=function(t){var e=this;return vl(this,this.i.then(function(){return fl(e)?fl(e).I(t).then(function(t){return{accessToken:t}}):null}))},e.Sc=function(t){var e=this;return this.i.then(function(){return hl(e,eu(e.a,Ys,{token:t}))}).then(function(t){var n=t.user;return Dh(n,"isAnonymous",!1),e.da(n),t})},e.Tc=function(t,e){var n=this;return this.i.then(function(){return hl(n,eu(n.a,zs,{email:t,password:e}))})},e.dc=function(t,e){var n=this;return this.i.then(function(){return hl(n,eu(n.a,As,{email:t,password:e}))})},e.Za=function(t){var e=this;return this.i.then(function(){return hl(e,t.ja(e.a))})},e.Rc=function(t){return Wi("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Za(t)},e.yb=function(){var t=this;return this.i.then(function(){var e=fl(t);if(e&&e.isAnonymous){var n=zi({providerId:null,isNewUser:!1});return zi({user:e,credential:null,additionalUserInfo:n,operationType:"signIn"})}return hl(t,t.a.yb()).then(function(e){var n=e.user;return Dh(n,"isAnonymous",!0),t.da(n),e})})},e.getUid=function(){return fl(this)&&fl(this).uid||null},e.cc=function(t){this.addAuthTokenListener(t),this.A++,0<this.A&&fl(this)&&Th(fl(this))},e.Oc=function(t){var e=this;H(this.u,function(n){n==t&&e.A--}),0>this.A&&(this.A=0),0==this.A&&fl(this)&&Eh(fl(this)),this.removeAuthTokenListener(t)},e.addAuthTokenListener=function(t){var e=this;this.u.push(t),vl(this,this.i.then(function(){e.m||X(e.u,t)&&t(dl(e))}))},e.removeAuthTokenListener=function(t){Y(this.u,function(e){return e==t})},e.delete=function(){this.m=!0;for(var t=0;t<this.R.length;t++)this.R[t].cancel("app-deleted");return this.R=[],this.l&&(t=this.l).b.removeListener($h("local"),t.a,this.pa),this.b&&(Pc(this.b,this),Gc(this.b.b)),Promise.resolve()},e.gc=function(t){return vl(this,function(t,e){return eu(t,ks,{identifier:e,continueUri:Ci()?ui():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.a,t))},e.Ac=function(t){return!!Ro(t)},e.vb=function(t,e){var n=this;return vl(this,Ne().then(function(){var t=new _r(e);if(!t.c)throw new k("argument-error",Rr+" must be true when sending sign in link to email");return Ur(t)}).then(function(e){return n.a.vb(t,e)}).then(function(){}))},e.hd=function(t){return this.Qa(t).then(function(t){return t.data.email})},e.mb=function(t,e){return vl(this,this.a.mb(t,e).then(function(){}))},e.Qa=function(t){return vl(this,this.a.Qa(t).then(function(t){return new or(t)}))},e.ib=function(t){return vl(this,this.a.ib(t).then(function(){}))},e.ub=function(t,e){var n=this;return vl(this,Ne().then(function(){return void 0===e||dt(e)?{}:Ur(new _r(e))}).then(function(e){return n.a.ub(t,e)}).then(function(){}))},e.Vc=function(t,e){return vl(this,zc(this,t,e,I(this.Za,this)))},e.Uc=function(t,e){var n=this;return vl(this,Ne().then(function(){var i=e||ui(),r=Co(t,i);if(!(i=Ro(i)))throw new k("argument-error","Invalid email link!");if(i.tenantId!==n.S())throw new k("tenant-id-mismatch");return n.Za(r)}))},ml.prototype.render=function(){},ml.prototype.reset=function(){},ml.prototype.getResponse=function(){},ml.prototype.execute=function(){};var bl=null;function yl(t,e){return(e=wl(e))&&t.a[e]||null}function wl(t){return(t=void 0===t?1e12:t)?t.toString():null}function Il(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=ae(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():un(this.f,"click",this.i)}function Tl(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function El(){}function Al(){}gl.prototype.render=function(t,e){return this.a[this.b.toString()]=new Il(t,e),this.b++},gl.prototype.reset=function(t){var e=yl(this,t);t=wl(t),e&&t&&(e.delete(),delete this.a[t])},gl.prototype.getResponse=function(t){return(t=yl(this,t))?t.getResponse():null},gl.prototype.execute=function(t){(t=yl(this,t))&&t.execute()},Il.prototype.getResponse=function(){return Tl(this),this.b},Il.prototype.execute=function(){Tl(this);var t=this;this.a||(this.a=setTimeout(function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(i){}t.a=setTimeout(function(){if(t.a=null,t.b=null,n)try{n()}catch(i){}t.h&&t.execute()},6e4)},500))},Il.prototype.delete=function(){Tl(this),this.g=!0,clearTimeout(this.a),this.a=null,ln(this.f,"click",this.i)},Ji(El,"FACTOR_ID","phone"),Al.prototype.g=function(){return bl||(bl=new gl),Ne(bl)},Al.prototype.c=function(){};var kl=null;function Sl(){this.b=u.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Nl=new bt(It,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),_l=new Vi(3e4,6e4);Sl.prototype.g=function(t){var e=this;return new we(function(n,i){var r=setTimeout(function(){i(new k("network-request-failed"))},_l.get());!u.grecaptcha||t!==e.f&&!e.b?(u[e.a]=function(){if(u.grecaptcha){e.f=t;var o=u.grecaptcha.render;u.grecaptcha.render=function(t,n){return t=o(t,n),e.b++,t},clearTimeout(r),n(u.grecaptcha)}else clearTimeout(r),i(new k("internal-error"));delete u[e.a]},Ne(Ka(kt(Nl,{onload:e.a,hl:t||""}))).s(function(){clearTimeout(r),i(new k("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(r),n(u.grecaptcha))})},Sl.prototype.c=function(){this.b--};var Ol=null;function Cl(t,e,n,i,r,o,a){if(Ji(this,"type","recaptcha"),this.c=this.f=null,this.A=!1,this.m=e,this.g=null,a?(kl||(kl=new Al),a=kl):(Ol||(Ol=new Sl),a=Ol),this.v=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Dl])throw new k("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Ll],!u.document)throw new k("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!ae(e)||!this.i&&ae(e).hasChildNodes())throw new k("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Ja(t,o||null,r||null),this.u=i||function(){return null};var s=this;this.l=[];var c=this.a[Rl];this.a[Rl]=function(t){if(xl(s,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=Ni(c,u);"function"==typeof e&&e(t)}};var h=this.a[Pl];this.a[Pl]=function(){if(xl(s,null),"function"==typeof h)h();else if("string"==typeof h){var t=Ni(h,u);"function"==typeof t&&t()}}}var Rl="callback",Pl="expired-callback",Dl="sitekey",Ll="size";function xl(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(i){}}function Ml(t,e){return t.h.push(e),e.na(function(){J(t.h,e)}),e}function jl(t){if(t.A)throw new k("internal-error","RecaptchaVerifier instance has been destroyed.")}function Ul(t,e,i){var r=!1;try{this.b=i||n.app()}catch(s){throw new k("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new k("invalid-api-key");i=this.b.options.apiKey;var o=this,a=null;try{a=this.b.auth().Ga()}catch(s){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(s){}a=n.SDK_VERSION?ki(n.SDK_VERSION,a):null,Cl.call(this,i,t,e,function(){try{var t=o.b.auth().ka()}catch(e){t=null}return t},a,R(N),r)}function Vl(t,e,n,i){t:{n=Array.prototype.slice.call(n);for(var r=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new k("internal-error","Argument validator encountered a required argument after an optional argument.");r++}if(o=e.length,n.length<r||o<n.length)i="Expected "+(r==o?1==r?"1 argument":r+" arguments":r+"-"+o+" arguments")+" but got "+n.length+".";else{for(r=0;r<n.length;r++)if(o=e[r].optional&&void 0===n[r],!e[r].K(n[r])&&!o){if(e=e[r],0>r||r>=Fl.length)throw new k("internal-error","Argument validator received an unsupported number of arguments.");n=Fl[r],i=(i?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.J+".";break t}i=null}}if(i)throw new k("argument-error",t+" failed: "+i)}(e=Cl.prototype).Ia=function(){var t=this;return this.f?this.f:this.f=Ml(this,Ne().then(function(){if(Ci()&&!bi())return vi();throw new k("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return t.v.g(t.u())}).then(function(e){return t.g=e,eu(t.o,Us,{})}).then(function(e){t.a[Dl]=e.recaptchaSiteKey}).s(function(e){throw t.f=null,e}))},e.render=function(){jl(this);var t=this;return Ml(this,this.Ia().then(function(){if(null===t.c){var e=t.m;if(!t.i){var n=ae(e);e=le("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c}))},e.verify=function(){jl(this);var t=this;return Ml(this,this.render().then(function(e){return new we(function(n){var i=t.g.getResponse(e);if(i)n(i);else{var r=function(e){e&&(function(t,e){Y(t.l,function(t){return t==e})}(t,r),n(e))};t.l.push(r),t.i&&t.g.execute(t.c)}})}))},e.reset=function(){jl(this),null!==this.c&&this.g.reset(this.c)},e.clear=function(){jl(this),this.A=!0,this.v.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=ae(this.m);for(var e;e=t.firstChild;)t.removeChild(e)}},A(Ul,Cl);var Fl="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Kl(t,e){return{name:t||"",J:"a valid string",optional:!!e,K:function(t){return"string"==typeof t}}}function ql(t,e){return{name:t||"",J:"a boolean",optional:!!e,K:function(t){return"boolean"==typeof t}}}function Hl(t,e){return{name:t||"",J:"a valid object",optional:!!e,K:v}}function Gl(t,e){return{name:t||"",J:"a function",optional:!!e,K:function(t){return"function"==typeof t}}}function Bl(t,e){return{name:t||"",J:"null",optional:!!e,K:function(t){return null===t}}}function Wl(t){return{name:t?t+"Credential":"credential",J:t?"a valid "+t+" credential":"a valid credential",optional:!1,K:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.ja||!n)}}}function Xl(t,e){return v(t)&&"string"==typeof t.type&&t.type===e&&"function"==typeof t.Ha}function Jl(t){return v(t)&&"string"==typeof t.uid}function Yl(t,e,n,i){return{name:n||"",J:t.J+" or "+e.J,optional:!!i,K:function(n){return t.K(n)||e.K(n)}}}function zl(t,e){for(var n in e){var i=e[n].name;t[i]=Ql(i,t[n],e[n].j)}}function $l(t,e){for(var n in e){var i=e[n].name;i!==n&&Object.defineProperty(t,i,{get:T(function(t){return this[t]},n),set:T(function(t,e,n,i){Vl(t,[n],[i],!0),this[e]=i},i,n,e[n].jb),enumerable:!0})}}function Zl(t,e,n,i){t[e]=Ql(e,n,i)}function Ql(t,e,n){function i(){var t=Array.prototype.slice.call(arguments);return Vl(o,n,t),e.apply(this,t)}if(!n)return e;var r,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(r in e)i[r]=e[r];for(r in e.prototype)i.prototype[r]=e.prototype[r];return i}zl(nl.prototype,{ib:{name:"applyActionCode",j:[Kl("code")]},Qa:{name:"checkActionCode",j:[Kl("code")]},mb:{name:"confirmPasswordReset",j:[Kl("code"),Kl("newPassword")]},dc:{name:"createUserWithEmailAndPassword",j:[Kl("email"),Kl("password")]},gc:{name:"fetchSignInMethodsForEmail",j:[Kl("email")]},qa:{name:"getRedirectResult",j:[]},Ac:{name:"isSignInWithEmailLink",j:[Kl("emailLink")]},Gc:{name:"onAuthStateChanged",j:[Yl(Hl(),Gl(),"nextOrObserver"),Gl("opt_error",!0),Gl("opt_completed",!0)]},Hc:{name:"onIdTokenChanged",j:[Yl(Hl(),Gl(),"nextOrObserver"),Gl("opt_error",!0),Gl("opt_completed",!0)]},ub:{name:"sendPasswordResetEmail",j:[Kl("email"),Yl(Hl("opt_actionCodeSettings",!0),Bl(null,!0),"opt_actionCodeSettings",!0)]},vb:{name:"sendSignInLinkToEmail",j:[Kl("email"),Hl("actionCodeSettings")]},wb:{name:"setPersistence",j:[Kl("persistence")]},Rc:{name:"signInAndRetrieveDataWithCredential",j:[Wl()]},yb:{name:"signInAnonymously",j:[]},Za:{name:"signInWithCredential",j:[Wl()]},Sc:{name:"signInWithCustomToken",j:[Kl("token")]},Tc:{name:"signInWithEmailAndPassword",j:[Kl("email"),Kl("password")]},Uc:{name:"signInWithEmailLink",j:[Kl("email"),Kl("emailLink",!0)]},Vc:{name:"signInWithPhoneNumber",j:[Kl("phoneNumber"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(t){return!(!t||"string"!=typeof t.type||"function"!=typeof t.verify)}}]},Wc:{name:"signInWithPopup",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Xc:{name:"signInWithRedirect",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},cd:{name:"updateCurrentUser",j:[Yl({name:"user",J:"an instance of Firebase User",optional:!1,K:function(t){return!!(t&&t instanceof mh)}},Bl(),"user")]},zb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Kl(null,!0)]},ed:{name:"useDeviceLanguage",j:[]},fd:{name:"useEmulator",j:[Kl("url")]},hd:{name:"verifyPasswordResetCode",j:[Kl("code")]}}),$l(nl.prototype,{lc:{name:"languageCode",jb:Yl(Kl(),Bl(),"languageCode")},ti:{name:"tenantId",jb:Yl(Kl(),Bl(),"tenantId")}}),nl.Persistence=zu,nl.Persistence.LOCAL="local",nl.Persistence.SESSION="session",nl.Persistence.NONE="none",zl(mh.prototype,{delete:{name:"delete",j:[]},nc:{name:"getIdTokenResult",j:[ql("opt_forceRefresh",!0)]},I:{name:"getIdToken",j:[ql("opt_forceRefresh",!0)]},Bc:{name:"linkAndRetrieveDataWithCredential",j:[Wl()]},pb:{name:"linkWithCredential",j:[Wl()]},Cc:{name:"linkWithPhoneNumber",j:[Kl("phoneNumber"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(t){return!(!t||"string"!=typeof t.type||"function"!=typeof t.verify)}}]},Dc:{name:"linkWithPopup",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ec:{name:"linkWithRedirect",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Kc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Wl()]},sb:{name:"reauthenticateWithCredential",j:[Wl()]},Lc:{name:"reauthenticateWithPhoneNumber",j:[Kl("phoneNumber"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(t){return!(!t||"string"!=typeof t.type||"function"!=typeof t.verify)}}]},Mc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Nc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},tb:{name:"sendEmailVerification",j:[Yl(Hl("opt_actionCodeSettings",!0),Bl(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Kl(null,!0)]},bd:{name:"unlink",j:[Kl("provider")]},Ab:{name:"updateEmail",j:[Kl("email")]},Bb:{name:"updatePassword",j:[Kl("password")]},dd:{name:"updatePhoneNumber",j:[Wl("phone")]},Cb:{name:"updateProfile",j:[Hl("profile")]},Db:{name:"verifyBeforeUpdateEmail",j:[Kl("email"),Yl(Hl("opt_actionCodeSettings",!0),Bl(null,!0),"opt_actionCodeSettings",!0)]}}),zl(gl.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),zl(ml.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),zl(we.prototype,{na:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),$l(Jc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",jb:ql("appVerificationDisabledForTesting")}}),zl(Yc.prototype,{confirm:{name:"confirm",j:[Kl("verificationCode")]}}),Zl(so,"fromJSON",function(t){t="string"==typeof t?JSON.parse(t):t;for(var e,n=[vo,_o,Do,lo],i=0;i<n.length;i++)if(e=n[i](t))return e;return null},[Yl(Kl(),Hl(),"json")]),Zl(Oo,"credential",function(t,e){return new No(t,e)},[Kl("email"),Kl("password")]),zl(No.prototype,{w:{name:"toJSON",j:[Kl(null,!0)]}}),zl(yo.prototype,{Ca:{name:"addScope",j:[Kl("scope")]},Ka:{name:"setCustomParameters",j:[Hl("customOAuthParameters")]}}),Zl(yo,"credential",wo,[Yl(Kl(),Hl(),"token")]),Zl(Oo,"credentialWithLink",Co,[Kl("email"),Kl("emailLink")]),zl(Io.prototype,{Ca:{name:"addScope",j:[Kl("scope")]},Ka:{name:"setCustomParameters",j:[Hl("customOAuthParameters")]}}),Zl(Io,"credential",To,[Yl(Kl(),Hl(),"token")]),zl(Eo.prototype,{Ca:{name:"addScope",j:[Kl("scope")]},Ka:{name:"setCustomParameters",j:[Hl("customOAuthParameters")]}}),Zl(Eo,"credential",Ao,[Yl(Kl(),Yl(Hl(),Bl()),"idToken"),Yl(Kl(),Bl(),"accessToken",!0)]),zl(ko.prototype,{Ka:{name:"setCustomParameters",j:[Hl("customOAuthParameters")]}}),Zl(ko,"credential",So,[Yl(Kl(),Hl(),"token"),Kl("secret",!0)]),zl(bo.prototype,{Ca:{name:"addScope",j:[Kl("scope")]},credential:{name:"credential",j:[Yl(Kl(),Yl(Hl(),Bl()),"optionsOrIdToken"),Yl(Kl(),Bl(),"accessToken",!0)]},Ka:{name:"setCustomParameters",j:[Hl("customOAuthParameters")]}}),zl(fo.prototype,{w:{name:"toJSON",j:[Kl(null,!0)]}}),zl(co.prototype,{w:{name:"toJSON",j:[Kl(null,!0)]}}),Zl(xo,"credential",Mo,[Kl("verificationId"),Kl("verificationCode")]),zl(xo.prototype,{eb:{name:"verifyPhoneNumber",j:[Yl(Kl(),{name:"phoneInfoOptions",J:"valid phone info options",optional:!1,K:function(t){return!!t&&(t.session&&t.phoneNumber?Xl(t.session,oo)&&"string"==typeof t.phoneNumber:t.session&&t.multiFactorHint?Xl(t.session,ao)&&Jl(t.multiFactorHint):t.session&&t.multiFactorUid?Xl(t.session,ao)&&"string"==typeof t.multiFactorUid:!!t.phoneNumber&&"string"==typeof t.phoneNumber)}},"phoneInfoOptions"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(t){return!(!t||"string"!=typeof t.type||"function"!=typeof t.verify)}}]}}),zl(Po.prototype,{w:{name:"toJSON",j:[Kl(null,!0)]}}),zl(k.prototype,{toJSON:{name:"toJSON",j:[Kl(null,!0)]}}),zl(Bo.prototype,{toJSON:{name:"toJSON",j:[Kl(null,!0)]}}),zl(Go.prototype,{toJSON:{name:"toJSON",j:[Kl(null,!0)]}}),zl(eh.prototype,{toJSON:{name:"toJSON",j:[Kl(null,!0)]}}),zl(Zc.prototype,{Qc:{name:"resolveSignIn",j:[{name:"multiFactorAssertion",J:"a valid multiFactorAssertion",optional:!1,K:function(t){return!!t&&!!t.rb}}]}}),zl(sh.prototype,{Qb:{name:"getSession",j:[]},ec:{name:"enroll",j:[{name:"multiFactorAssertion",J:"a valid multiFactorAssertion",optional:!1,K:function(t){return!!t&&!!t.rb}},Kl("displayName",!0)]},ad:{name:"unenroll",j:[Yl({name:"multiFactorInfo",J:"a valid multiFactorInfo",optional:!1,K:Jl},Kl(),"multiFactorInfoIdentifier")]}}),zl(Ul.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),Zl(yr,"parseLink",Nr,[Kl("link")]),Zl(El,"assertion",function(t){return new oh(t)},[Wl("phone")]),function(){if(void 0===n||!n.INTERNAL||!n.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:sr,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:ar,VERIFY_AND_CHANGE_EMAIL:ur,VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:nl,AuthCredential:so,Error:k};Zl(t,"EmailAuthProvider",Oo,[]),Zl(t,"FacebookAuthProvider",yo,[]),Zl(t,"GithubAuthProvider",Io,[]),Zl(t,"GoogleAuthProvider",Eo,[]),Zl(t,"TwitterAuthProvider",ko,[]),Zl(t,"OAuthProvider",bo,[Kl("providerId")]),Zl(t,"SAMLAuthProvider",go,[Kl("providerId")]),Zl(t,"PhoneAuthProvider",xo,[{name:"auth",J:"an instance of Firebase Auth",optional:!0,K:function(t){return!!(t&&t instanceof nl)}}]),Zl(t,"RecaptchaVerifier",Ul,[Yl(Kl(),{name:"",J:"an HTML element",optional:!1,K:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),Hl("recaptchaParameters",!0),{name:"app",J:"an instance of Firebase App",optional:!0,K:function(t){return!!(t&&t instanceof n.app.App)}}]),Zl(t,"ActionCodeURL",yr,[]),Zl(t,"PhoneMultiFactorGenerator",El,[]),n.INTERNAL.registerComponent({name:"auth",instanceFactory:function(t){return new nl(t=t.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:t,instantiationMode:"LAZY",type:"PUBLIC"}),n.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(t){return{getUid:I((t=t.getProvider("auth").getImmediate()).getUid,t),getToken:I(t.mc,t),addAuthTokenListener:I(t.cc,t),removeAuthTokenListener:I(t.Oc,t)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),n.registerVersion("@firebase/auth","0.15.0"),n.INTERNAL.extendNamespace({User:mh})}()}).apply(void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});
},{"@firebase/app":"dP58"}],"zKjx":[function(require,module,exports) {
"use strict";require("@firebase/auth");
},{"@firebase/auth":"RJVP"}],"Xc75":[function(require,module,exports) {
"use strict";var e=require("@firebase/app"),t=require("tslib"),n=require("@firebase/component");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=r(e),o={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},a=function(e){function n(t,r,i){var o=e.call(this,r)||this;return Object.setPrototypeOf(o,n.prototype),o.code=t,o.details=i,o}return t.__extends(n,e),n}(Error);function s(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function u(e,t,n){var r=s(e),i=r,u=void 0;try{var c=t&&t.error;if(c){var l=c.status;if("string"==typeof l){if(!o[l])return new a("internal","internal");r=o[l],i=l}var d=c.message;"string"==typeof d&&(i=d),void 0!==(u=c.details)&&(u=n.decode(u))}}catch(f){}return"ok"===r?null:new a(r,i,u)}var c=function(){function e(e,t){var n=this;this.auth=null,this.messaging=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(function(e){return n.auth=e},function(){}),this.messaging||t.get().then(function(e){return n.messaging=e},function(){})}return e.prototype.getAuthToken=function(){return t.__awaiter(this,void 0,void 0,function(){var e;return t.__generator(this,function(t){switch(t.label){case 0:if(!this.auth)return[2,void 0];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 3:return t.sent(),[2,void 0];case 4:return[2]}})})},e.prototype.getInstanceIdToken=function(){return t.__awaiter(this,void 0,void 0,function(){return t.__generator(this,function(e){if(!(this.messaging&&"Notification"in self&&"granted"===Notification.permission))return[2,void 0];try{return[2,this.messaging.getToken()]}catch(t){return[2,void 0]}return[2]})})},e.prototype.getContext=function(){return t.__awaiter(this,void 0,void 0,function(){var e,n;return t.__generator(this,function(t){switch(t.label){case 0:return[4,this.getAuthToken()];case 1:return e=t.sent(),[4,this.getInstanceIdToken()];case 2:return n=t.sent(),[2,{authToken:e,instanceIdToken:n}]}})})},e}(),l="type.googleapis.com/google.protobuf.Int64Value",d="type.googleapis.com/google.protobuf.UInt64Value";function f(e,t){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}var h=function(){function e(){}return e.prototype.encode=function(e){var t=this;if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(Array.isArray(e))return e.map(function(e){return t.encode(e)});if("function"==typeof e||"object"==typeof e)return f(e,function(e){return t.encode(e)});throw new Error("Data cannot be encoded in JSON: "+e)},e.prototype.decode=function(e){var t=this;if(null==e)return e;if(e["@type"])switch(e["@type"]){case l:case d:var n=Number(e.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+e);return n;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(function(e){return t.decode(e)}):"function"==typeof e||"object"==typeof e?f(e,function(e){return t.decode(e)}):e},e}();function p(e){var t,n=new Promise(function(n,r){t=setTimeout(function(){r(new a("deadline-exceeded","deadline-exceeded"))},e)});return{timer:t,promise:n}}var g=function(){function e(e,t,n,r,i){var o=this;void 0===r&&(r="us-central1"),this.app_=e,this.fetchImpl=i,this.serializer=new h,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return Promise.resolve(o.deleteService())}},this.contextProvider=new c(t,n),this.cancelAllRequests=new Promise(function(e){o.deleteService=function(){return e()}});try{var a=new URL(r);this.customDomain=a.origin,this.region="us-central1"}catch(s){this.customDomain=null,this.region=r}}return Object.defineProperty(e.prototype,"app",{get:function(){return this.app_},enumerable:!1,configurable:!0}),e.prototype._url=function(e){var t=this.app_.options.projectId;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+t+"/"+this.region+"/"+e:null!==this.customDomain?this.customDomain+"/"+e:"https://"+this.region+"-"+t+".cloudfunctions.net/"+e},e.prototype.useFunctionsEmulator=function(e){this.emulatorOrigin=e},e.prototype.httpsCallable=function(e,t){var n=this;return function(r){return n.call(e,r,t||{})}},e.prototype.postJSON=function(e,n,r){return t.__awaiter(this,void 0,void 0,function(){var i,o;return t.__generator(this,function(t){switch(t.label){case 0:r["Content-Type"]="application/json",t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.fetchImpl(e,{method:"POST",body:JSON.stringify(n),headers:r})];case 2:return i=t.sent(),[3,4];case 3:return t.sent(),[2,{status:0,json:null}];case 4:o=null,t.label=5;case 5:return t.trys.push([5,7,,8]),[4,i.json()];case 6:return o=t.sent(),[3,8];case 7:return t.sent(),[3,8];case 8:return[2,{status:i.status,json:o}]}})})},e.prototype.call=function(e,n,r){return t.__awaiter(this,void 0,void 0,function(){var i,o,s,c,l,d,f,h,g,m,y;return t.__generator(this,function(t){switch(t.label){case 0:return i=this._url(e),n=this.serializer.encode(n),o={data:n},s={},[4,this.contextProvider.getContext()];case 1:return(c=t.sent()).authToken&&(s.Authorization="Bearer "+c.authToken),c.instanceIdToken&&(s["Firebase-Instance-ID-Token"]=c.instanceIdToken),l=r.timeout||7e4,d=p(l),f=d.timer,h=d.promise,[4,Promise.race([v(f,this.postJSON(i,o,s)),h,v(f,this.cancelAllRequests)])];case 2:if(!(g=t.sent()))throw new a("cancelled","Firebase Functions instance was deleted.");if(m=u(g.status,g.json,this.serializer))throw m;if(!g.json)throw new a("internal","Response is not valid JSON object.");if(void 0===(y=g.json.data)&&(y=g.json.result),void 0===y)throw new a("internal","Response is missing data field.");return[2,{data:this.serializer.decode(y)}]}})})},e}();function v(e,n){return t.__awaiter(this,void 0,void 0,function(){var r;return t.__generator(this,function(t){switch(t.label){case 0:return[4,n];case 1:return r=t.sent(),clearTimeout(e),[2,r]}})})}var m="functions";function y(e,t){var r={Functions:g};e.INTERNAL.registerComponent(new n.Component(m,function(e,n){var r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),o=e.getProvider("messaging");return new g(r,i,o,n,t)},"PUBLIC").setServiceProps(r).setMultipleInstances(!0))}var _="@firebase/functions",w="0.5.1";y(i.default,fetch.bind(self)),i.default.registerVersion(_,w);
},{"@firebase/app":"dP58","tslib":"f2sD","@firebase/component":"nzQs"}],"a7Bh":[function(require,module,exports) {
"use strict";require("@firebase/functions");
},{"@firebase/functions":"Xc75"}],"ueHA":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.createWebChannelTransport=exports.XhrIo=exports.WebChannel=exports.EventType=exports.ErrorCode=exports.default=void 0;var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])})(t,i)};function i(t,i){function e(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}function e(t){var n="function"==typeof Symbol&&Symbol.iterator,i=n&&t[n],e=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}var r,a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},s=s||{},o=a||self;function h(){}function l(t){var n=typeof t;return"object"!=n?n:t?Array.isArray(t)?"array":n:"null"}function c(t){var n=l(t);return"array"==n||"object"==n&&"number"==typeof t.length}function u(t){var n=typeof t;return"object"==n&&null!=t||"function"==n}function f(t){return Object.prototype.hasOwnProperty.call(t,p)&&t[p]||(t[p]=++v)}var p="closure_uid_"+(1e9*Math.random()>>>0),v=0;function d(t,n,i){return t.call.apply(t.bind,arguments)}function g(t,n,i){if(!t)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,e),t.apply(n,i)}}return function(){return t.apply(n,arguments)}}function y(t,n,i){return(y=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?d:g).apply(null,arguments)}function b(t,n){var i=Array.prototype.slice.call(arguments,1);return function(){var n=i.slice();return n.push.apply(n,arguments),t.apply(this,n)}}var m=Date.now;function w(t,n){function i(){}i.prototype=n.prototype,t.S=n.prototype,t.prototype=new i,t.prototype.constructor=t}function E(){this.j=this.j,this.i=this.i}var T=0;E.prototype.j=!1,E.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0!=T))f(this)},E.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var S=Array.prototype.indexOf?function(t,n){return Array.prototype.indexOf.call(t,n,void 0)}:function(t,n){if("string"==typeof t)return"string"!=typeof n||1!=n.length?-1:t.indexOf(n,0);for(var i=0;i<t.length;i++)if(i in t&&t[i]===n)return i;return-1},C=Array.prototype.forEach?function(t,n,i){Array.prototype.forEach.call(t,n,i)}:function(t,n,i){for(var e=t.length,r="string"==typeof t?t.split(""):t,a=0;a<e;a++)a in r&&n.call(i,r[a],a,t)};function I(t){t:{for(var n=Xi,i=t.length,e="string"==typeof t?t.split(""):t,r=0;r<i;r++)if(r in e&&n.call(void 0,e[r],r,t)){n=r;break t}n=-1}return 0>n?null:"string"==typeof t?t.charAt(n):t[n]}function x(t){return Array.prototype.concat.apply([],arguments)}function O(t){var n=t.length;if(0<n){for(var i=Array(n),e=0;e<n;e++)i[e]=t[e];return i}return[]}function P(t){return/^[\s\xa0]*$/.test(t)}var R,A=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function L(t,n){return-1!=t.indexOf(n)}function j(t,n){return t<n?-1:t>n?1:0}t:{var M=o.navigator;if(M){var _=M.userAgent;if(_){R=_;break t}}R=""}function k(t,n,i){for(var e in t)n.call(i,t[e],e,t)}function X(t){var n={};for(var i in t)n[i]=t[i];return n}var D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function H(t,n){for(var i,e,r=1;r<arguments.length;r++){for(i in e=arguments[r])t[i]=e[i];for(var a=0;a<D.length;a++)i=D[a],Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}}function N(t){return N[" "](t),t}function U(t,n){var i=Q;return Object.prototype.hasOwnProperty.call(i,t)?i[t]:i[t]=n(t)}N[" "]=h;var B,K=L(R,"Opera"),F=L(R,"Trident")||L(R,"MSIE"),Y=L(R,"Edge"),W=Y||F,G=L(R,"Gecko")&&!(L(R.toLowerCase(),"webkit")&&!L(R,"Edge"))&&!(L(R,"Trident")||L(R,"MSIE"))&&!L(R,"Edge"),J=L(R.toLowerCase(),"webkit")&&!L(R,"Edge");function q(){var t=o.document;return t?t.documentMode:void 0}t:{var V="",$=function(){var t=R;return G?/rv:([^\);]+)(\)|;)/.exec(t):Y?/Edge\/([\d\.]+)/.exec(t):F?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t):J?/WebKit\/(\S+)/.exec(t):K?/(?:Version)[ \/]?(\S+)/.exec(t):void 0}();if($&&(V=$?$[1]:""),F){var z=q();if(null!=z&&z>parseFloat(V)){B=String(z);break t}}B=V}var Z,Q={};function tt(t){return U(t,function(){for(var n=0,i=A(String(B)).split("."),e=A(String(t)).split("."),r=Math.max(i.length,e.length),a=0;0==n&&a<r;a++){var s=i[a]||"",o=e[a]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==s[0].length&&0==o[0].length)break;n=j(0==s[1].length?0:parseInt(s[1],10),0==o[1].length?0:parseInt(o[1],10))||j(0==s[2].length,0==o[2].length)||j(s[2],o[2]),s=s[3],o=o[3]}while(0==n)}return 0<=n})}if(o.document&&F){var nt=q();Z=nt||(parseInt(B,10)||void 0)}else Z=void 0;var it=Z,et=!F||9<=Number(it),rt=F&&!tt("9"),at=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var t=!1,n=Object.defineProperty({},"passive",{get:function(){t=!0}});try{o.addEventListener("test",h,n),o.removeEventListener("test",h,n)}catch(i){}return t}();function st(t,n){this.type=t,this.a=this.target=n,this.defaultPrevented=!1}function ot(t,n){if(st.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var i=this.type=t.type,e=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=n,n=t.relatedTarget){if(G){t:{try{N(n.nodeName);var r=!0;break t}catch(a){}r=!1}r||(n=null)}}else"mouseover"==i?n=t.fromElement:"mouseout"==i&&(n=t.toElement);this.relatedTarget=n,e?(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:ht[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}st.prototype.b=function(){this.defaultPrevented=!0},w(ot,st);var ht={2:"touch",3:"pen",4:"mouse"};ot.prototype.b=function(){ot.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,rt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(n){}};var lt="closure_listenable_"+(1e6*Math.random()|0),ct=0;function ut(t,n,i,e,r){this.listener=t,this.proxy=null,this.src=n,this.type=i,this.capture=!!e,this.ca=r,this.key=++ct,this.Y=this.Z=!1}function ft(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function pt(t){this.src=t,this.a={},this.b=0}function vt(t,n){var i=n.type;if(i in t.a){var e,r=t.a[i],a=S(r,n);(e=0<=a)&&Array.prototype.splice.call(r,a,1),e&&(ft(n),0==t.a[i].length&&(delete t.a[i],t.b--))}}function dt(t,n,i,e){for(var r=0;r<t.length;++r){var a=t[r];if(!a.Y&&a.listener==n&&a.capture==!!i&&a.ca==e)return r}return-1}pt.prototype.add=function(t,n,i,e,r){var a=t.toString();(t=this.a[a])||(t=this.a[a]=[],this.b++);var s=dt(t,n,e,r);return-1<s?(n=t[s],i||(n.Z=!1)):((n=new ut(n,this.src,a,!!e,r)).Z=i,t.push(n)),n};var gt="closure_lm_"+(1e6*Math.random()|0),yt={};function bt(t,n,i,e,r){if(e&&e.once)return Et(t,n,i,e,r);if(Array.isArray(n)){for(var a=0;a<n.length;a++)bt(t,n[a],i,e,r);return null}return i=Rt(i),t&&t[lt]?t.va(n,i,u(e)?!!e.capture:!!e,r):mt(t,n,i,!1,e,r)}function mt(t,n,i,e,r,a){if(!n)throw Error("Invalid event type");var s=u(r)?!!r.capture:!!r;if(s&&!et)return null;var o=Ot(t);if(o||(t[gt]=o=new pt(t)),(i=o.add(n,i,e,s,a)).proxy)return i;if(e=wt(),i.proxy=e,e.src=t,e.listener=i,t.addEventListener)at||(r=s),void 0===r&&(r=!1),t.addEventListener(n.toString(),e,r);else if(t.attachEvent)t.attachEvent(Ct(n.toString()),e);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(e)}return i}function wt(){var t=xt,n=et?function(i){return t.call(n.src,n.listener,i)}:function(i){if(!(i=t.call(n.src,n.listener,i)))return i};return n}function Et(t,n,i,e,r){if(Array.isArray(n)){for(var a=0;a<n.length;a++)Et(t,n[a],i,e,r);return null}return i=Rt(i),t&&t[lt]?t.wa(n,i,u(e)?!!e.capture:!!e,r):mt(t,n,i,!0,e,r)}function Tt(t,n,i,e,r){if(Array.isArray(n))for(var a=0;a<n.length;a++)Tt(t,n[a],i,e,r);else e=u(e)?!!e.capture:!!e,i=Rt(i),t&&t[lt]?(t=t.c,(n=String(n).toString())in t.a&&(-1<(i=dt(a=t.a[n],i,e,r))&&(ft(a[i]),Array.prototype.splice.call(a,i,1),0==a.length&&(delete t.a[n],t.b--)))):t&&(t=Ot(t))&&(n=t.a[n.toString()],t=-1,n&&(t=dt(n,i,e,r)),(i=-1<t?n[t]:null)&&St(i))}function St(t){if("number"!=typeof t&&t&&!t.Y){var n=t.src;if(n&&n[lt])vt(n.c,t);else{var i=t.type,e=t.proxy;n.removeEventListener?n.removeEventListener(i,e,t.capture):n.detachEvent?n.detachEvent(Ct(i),e):n.addListener&&n.removeListener&&n.removeListener(e),(i=Ot(n))?(vt(i,t),0==i.b&&(i.src=null,n[gt]=null)):ft(t)}}}function Ct(t){return t in yt?yt[t]:yt[t]="on"+t}function It(t,n){var i=t.listener,e=t.ca||t.src;return t.Z&&St(t),i.call(e,n)}function xt(t,n){if(t.Y)return!0;if(!et){if(!n)t:{n=["window","event"];for(var i=o,e=0;e<n.length;e++)if(null==(i=i[n[e]])){n=null;break t}n=i}return It(t,n=new ot(n,this))}return It(t,new ot(n,this))}function Ot(t){return(t=t[gt])instanceof pt?t:null}var Pt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Rt(t){return"function"==l(t)?t:(t[Pt]||(t[Pt]=function(n){return t.handleEvent(n)}),t[Pt])}function At(){E.call(this),this.c=new pt(this),this.J=this,this.C=null}function Lt(t,n,i,e){if(!(n=t.c.a[String(n)]))return!0;n=n.concat();for(var r=!0,a=0;a<n.length;++a){var s=n[a];if(s&&!s.Y&&s.capture==i){var o=s.listener,h=s.ca||s.src;s.Z&&vt(t.c,s),r=!1!==o.call(h,e)&&r}}return r&&!e.defaultPrevented}w(At,E),At.prototype[lt]=!0,(r=At.prototype).addEventListener=function(t,n,i,e){bt(this,t,n,i,e)},r.removeEventListener=function(t,n,i,e){Tt(this,t,n,i,e)},r.dispatchEvent=function(t){var n,i=this.C;if(i)for(n=[];i;i=i.C)n.push(i);i=this.J;var e=t.type||t;if("string"==typeof t)t=new st(t,i);else if(t instanceof st)t.target=t.target||i;else{var r=t;H(t=new st(e,i),r)}if(r=!0,n)for(var a=n.length-1;0<=a;a--){var s=t.a=n[a];r=Lt(s,e,!0,t)&&r}if(r=Lt(s=t.a=i,e,!0,t)&&r,r=Lt(s,e,!1,t)&&r,n)for(a=0;a<n.length;a++)r=Lt(s=t.a=n[a],e,!1,t)&&r;return r},r.G=function(){if(At.S.G.call(this),this.c){var t,n=this.c;for(t in n.a){for(var i=n.a[t],e=0;e<i.length;e++)ft(i[e]);delete n.a[t],n.b--}}this.C=null},r.va=function(t,n,i,e){return this.c.add(String(t),n,!1,i,e)},r.wa=function(t,n,i,e){return this.c.add(String(t),n,!0,i,e)};var jt=o.JSON.stringify;function Mt(){this.b=this.a=null}var _t,kt=new(function(){function t(t,n,i){this.f=i,this.c=t,this.g=n,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())(function(){return new Dt},function(t){t.reset()},100);function Xt(){var t=Kt,n=null;return t.a&&(n=t.a,t.a=t.a.next,t.a||(t.b=null),n.next=null),n}function Dt(){this.next=this.b=this.a=null}function Ht(t){o.setTimeout(function(){throw t},0)}function Nt(t,n){_t||Ut(),Bt||(_t(),Bt=!0),Kt.add(t,n)}function Ut(){var t=o.Promise.resolve(void 0);_t=function(){t.then(Ft)}}Mt.prototype.add=function(t,n){var i=kt.get();i.set(t,n),this.b?this.b.next=i:this.a=i,this.b=i},Dt.prototype.set=function(t,n){this.a=t,this.b=n,this.next=null},Dt.prototype.reset=function(){this.next=this.b=this.a=null};var Bt=!1,Kt=new Mt;function Ft(){for(var t;t=Xt();){try{t.a.call(t.b)}catch(i){Ht(i)}var n=kt;n.g(t),n.b<n.f&&(n.b++,t.next=n.a,n.a=t)}Bt=!1}function Yt(t,n){At.call(this),this.b=t||1,this.a=n||o,this.f=y(this.Ya,this),this.g=m()}function Wt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Gt(t,n,i){if("function"==l(t))i&&(t=y(t,i));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=y(t.handleEvent,t)}return 2147483647<Number(n)?-1:o.setTimeout(t,n||0)}function Jt(t){t.a=Gt(function(){t.a=null,t.c&&(t.c=!1,Jt(t))},t.h);var n=t.b;t.b=null,t.g.apply(null,n)}w(Yt,At),(r=Yt.prototype).aa=!1,r.M=null,r.Ya=function(){if(this.aa){var t=m()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(Wt(this),this.start()))}},r.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=m())},r.G=function(){Yt.S.G.call(this),Wt(this),delete this.a};var qt=function(t){function n(n,i,e){var r=t.call(this)||this;return r.g=null!=e?n.bind(e):n,r.h=i,r.b=null,r.c=!1,r.a=null,r}return i(n,t),n.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:Jt(this)},n.prototype.G=function(){t.prototype.G.call(this),this.a&&(o.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},n}(E);function Vt(t){E.call(this),this.b=t,this.a={}}w(Vt,E);var $t=[];function zt(t,n,i,e){Array.isArray(i)||(i&&($t[0]=i.toString()),i=$t);for(var r=0;r<i.length;r++){var a=bt(n,i[r],e||t.handleEvent,!1,t.b||t);if(!a)break;t.a[a.key]=a}}function Zt(t){k(t.a,function(t,n){this.a.hasOwnProperty(n)&&St(t)},t),t.a={}}function Qt(){this.a=!0}function tn(t,n,i,e,r,a){t.info(function(){if(t.a)if(a)for(var s="",o=a.split("&"),h=0;h<o.length;h++){var l=o[h].split("=");if(1<l.length){var c=l[0];l=l[1];var u=c.split("_");s=2<=u.length&&"type"==u[1]?s+(c+"=")+l+"&":s+(c+"=redacted&")}}else s=null;else s=a;return"XMLHTTP REQ ("+e+") [attempt "+r+"]: "+n+"\n"+i+"\n"+s})}function nn(t,n,i,e,r,a,s){t.info(function(){return"XMLHTTP RESP ("+e+") [ attempt "+r+"]: "+n+"\n"+i+"\n"+a+" "+s})}function en(t,n,i,e){t.info(function(){return"XMLHTTP TEXT ("+n+"): "+an(t,i)+(e?" "+e:"")})}function rn(t,n){t.info(function(){return"TIMEOUT: "+n})}function an(t,n){if(!t.a)return n;if(!n)return null;try{var i=JSON.parse(n);if(i)for(t=0;t<i.length;t++)if(Array.isArray(i[t])){var e=i[t];if(!(2>e.length)){var r=e[1];if(Array.isArray(r)&&!(1>r.length)){var a=r[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var s=1;s<r.length;s++)r[s]=""}}}return jt(i)}catch(o){return n}}Vt.prototype.G=function(){Vt.S.G.call(this),Zt(this)},Vt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Qt.prototype.info=function(){};var sn=null;function on(){return sn=sn||new At}function hn(t){st.call(this,"serverreachability",t)}function ln(t){var n=on();n.dispatchEvent(new hn(n,t))}function cn(t){st.call(this,"statevent",t)}function un(t){var n=on();n.dispatchEvent(new cn(n,t))}function fn(t){st.call(this,"timingevent",t)}function pn(t,n){if("function"!=l(t))throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){t()},n)}w(hn,st),w(cn,st),w(fn,st);var vn={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},dn={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function gn(){}function yn(t){var n;return(n=t.a)||(n=t.a={}),n}function bn(){}gn.prototype.a=null;var mn,wn={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function En(){st.call(this,"d")}function Tn(){st.call(this,"c")}function Sn(){}function Cn(t,n,i,e){this.g=t,this.c=n,this.f=i,this.T=e||1,this.J=new Vt(this),this.P=In,t=W?125:void 0,this.R=new Yt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}w(En,st),w(Tn,st),w(Sn,gn),mn=new Sn;var In=45e3,xn={},On={};function Pn(t,n,i){t.H=1,t.i=Zn(Gn(n)),t.j=i,t.I=!0,Rn(t,null)}function Rn(t,n){t.u=m(),jn(t),t.l=Gn(t.i);var i=t.l,e=t.T;Array.isArray(e)||(e=[String(e)]),pi(i.b,"t",e),t.D=0,t.a=fe(t.g,t.g.C?n:null),0<t.O&&(t.F=new qt(y(t.Ca,t,t.a),t.O)),zt(t.J,t.a,"readystatechange",t.Wa),n=t.B?X(t.B):{},t.j?(t.m||(t.m="POST"),n["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,n)):(t.m="GET",t.a.ba(t.l,t.m,null,n)),ln(1),tn(t.c,t.m,t.l,t.f,t.T,t.j)}function An(t,n,i){for(var e=!0;!t.A&&t.D<i.length;){var r=Ln(t,i);if(r==On){4==n&&(t.h=4,un(14),e=!1),en(t.c,t.f,null,"[Incomplete Response]");break}if(r==xn){t.h=4,un(15),en(t.c,t.f,i,"[Invalid Chunk]"),e=!1;break}en(t.c,t.f,r,null),Dn(t,r)}4==n&&0==i.length&&(t.h=1,un(16),e=!1),t.b=t.b&&e,e?0<i.length&&!t.W&&(t.W=!0,(n=t.g).a==t&&n.V&&!n.F&&(n.c.info("Great, no buffering proxy detected. Bytes received: "+i.length),re(n),n.F=!0)):(en(t.c,t.f,i,"[Invalid Chunked Response]"),Xn(t),kn(t))}function Ln(t,n){var i=t.D,e=n.indexOf("\n",i);return-1==e?On:(i=Number(n.substring(i,e)),isNaN(i)?xn:(e+=1)+i>n.length?On:(n=n.substr(e,i),t.D=e+i,n))}function jn(t){t.U=m()+t.P,Mn(t,t.P)}function Mn(t,n){if(null!=t.o)throw Error("WatchDog timer not null");t.o=pn(y(t.Ua,t),n)}function _n(t){t.o&&(o.clearTimeout(t.o),t.o=null)}function kn(t){0==t.g.v||t.A||oe(t.g,t)}function Xn(t){_n(t);var n=t.F;n&&"function"==typeof n.ja&&n.ja(),t.F=null,Wt(t.R),Zt(t.J),t.a&&(n=t.a,t.a=null,n.abort(),n.ja())}function Dn(t,n){try{var i=t.g;if(0!=i.v&&(i.a==t||Ei(i.b,t)))if(i.I=t.N,!t.C&&Ei(i.b,t)&&3==i.v){try{var e=i.ka.a.parse(n)}catch(g){e=null}if(Array.isArray(e)&&3==e.length){var r=e;if(0==r[0]){t:if(!i.j){if(i.a){if(!(i.a.u+3e3<t.u))break t;se(i),qi(i)}ee(i),un(18)}}else i.oa=r[1],0<i.oa-i.P&&37500>r[2]&&i.H&&0==i.o&&!i.m&&(i.m=pn(y(i.Ra,i),6e3));if(1>=wi(i.b)&&i.ea){try{i.ea()}catch(g){}i.ea=void 0}}else le(i,11)}else if((t.C||i.a==t)&&se(i),!P(n))for(n=e=i.ka.a.parse(n),e=0;e<n.length;e++)if(r=n[e],i.P=r[0],r=r[1],2==i.v)if("c"==r[0]){i.J=r[1],i.ga=r[2];var a=r[3];null!=a&&(i.ha=a,i.c.info("VER="+i.ha));var s=r[4];null!=s&&(i.pa=s,i.c.info("SVER="+i.pa));var o=r[5];if(null!=o&&"number"==typeof o&&0<o){var h=1.5*o;i.D=h,i.c.info("backChannelRequestTimeoutMs_="+h)}h=i;var l=t.a;if(l){var c=l.a?l.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(c){var u=h.b;!u.a&&(L(c,"spdy")||L(c,"quic")||L(c,"h2"))&&(u.f=u.g,u.a=new Set,u.b&&(Ti(u,u.b),u.b=null))}if(h.A){var f=l.a?l.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(h.na=f,zn(h.B,h.A,f))}}i.v=3,i.f&&i.f.ta(),i.V&&(i.N=m()-t.u,i.c.info("Handshake RTT: "+i.N+"ms"));var p=t;if((h=i).la=ue(h,h.C?h.ga:null,h.fa),p.C){Si(h.b,p);var v=p,d=h.D;d&&v.setTimeout(d),v.o&&(_n(v),jn(v)),h.a=p}else ie(h);0<i.g.length&&zi(i)}else"stop"!=r[0]&&"close"!=r[0]||le(i,7);else 3==i.v&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?le(i,7):Ji(i):"noop"!=r[0]&&i.f&&i.f.sa(r),i.o=0);ln(4)}catch(g){}}function Hn(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(c(t)){for(var n=[],i=t.length,e=0;e<i;e++)n.push(t[e]);return n}for(e in n=[],i=0,t)n[i++]=t[e];return n}function Nn(t,n){if(t.forEach&&"function"==typeof t.forEach)t.forEach(n,void 0);else if(c(t)||"string"==typeof t)C(t,n,void 0);else{if(t.L&&"function"==typeof t.L)var i=t.L();else if(t.K&&"function"==typeof t.K)i=void 0;else if(c(t)||"string"==typeof t){i=[];for(var e=t.length,r=0;r<e;r++)i.push(r)}else for(r in i=[],e=0,t)i[e++]=r;r=(e=Hn(t)).length;for(var a=0;a<r;a++)n.call(void 0,e[a],i&&i[a],t)}}function Un(t,n){this.b={},this.a=[],this.c=0;var i=arguments.length;if(1<i){if(i%2)throw Error("Uneven number of arguments");for(var e=0;e<i;e+=2)this.set(arguments[e],arguments[e+1])}else if(t)if(t instanceof Un)for(i=t.L(),e=0;e<i.length;e++)this.set(i[e],t.get(i[e]));else for(e in t)this.set(e,t[e])}function Bn(t){if(t.c!=t.a.length){for(var n=0,i=0;n<t.a.length;){var e=t.a[n];Kn(t.b,e)&&(t.a[i++]=e),n++}t.a.length=i}if(t.c!=t.a.length){var r={};for(i=n=0;n<t.a.length;)Kn(r,e=t.a[n])||(t.a[i++]=e,r[e]=1),n++;t.a.length=i}}function Kn(t,n){return Object.prototype.hasOwnProperty.call(t,n)}(r=Cn.prototype).setTimeout=function(t){this.P=t},r.Wa=function(t){t=t.target;var n=this.F;n&&3==Ki(t)?n.f():this.Ca(t)},r.Ca=function(t){try{if(t==this.a)t:{var n=Ki(this.a),i=this.a.ua(),e=this.a.X();if(!(3>n||3==n&&!W&&!this.a.$())){this.A||4!=n||7==i||ln(8==i||0>=e?3:2),_n(this);var r=this.a.X();this.N=r;var a=this.a.$();if(this.b=200==r,nn(this.c,this.m,this.l,this.f,this.T,n,r),this.b){if(this.V&&!this.C){n:{if(this.a){var s,o=this.a;if((s=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(s)){var h=s;break n}}h=null}if(!h){this.b=!1,this.h=3,un(12),Xn(this),kn(this);break t}en(this.c,this.f,h,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Dn(this,h)}this.I?(An(this,n,a),W&&this.b&&3==n&&(zt(this.J,this.R,"tick",this.Va),this.R.start())):(en(this.c,this.f,a,null),Dn(this,a)),4==n&&Xn(this),this.b&&!this.A&&(4==n?oe(this.g,this):(this.b=!1,jn(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.h=3,un(12)):(this.h=0,un(13)),Xn(this),kn(this)}}}catch(l){}},r.Va=function(){if(this.a){var t=Ki(this.a),n=this.a.$();this.D<n.length&&(_n(this),An(this,t,n),this.b&&4!=t&&jn(this))}},r.cancel=function(){this.A=!0,Xn(this)},r.Ua=function(){this.o=null;var t=m();0<=t-this.U?(rn(this.c,this.l),2!=this.H&&(ln(3),un(17)),Xn(this),this.h=2,kn(this)):Mn(this,this.U-t)},(r=Un.prototype).K=function(){Bn(this);for(var t=[],n=0;n<this.a.length;n++)t.push(this.b[this.a[n]]);return t},r.L=function(){return Bn(this),this.a.concat()},r.get=function(t,n){return Kn(this.b,t)?this.b[t]:n},r.set=function(t,n){Kn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=n},r.forEach=function(t,n){for(var i=this.L(),e=0;e<i.length;e++){var r=i[e],a=this.get(r);t.call(n,a,r,this)}};var Fn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Yn(t,n){if(t){t=t.split("&");for(var i=0;i<t.length;i++){var e=t[i].indexOf("="),r=null;if(0<=e){var a=t[i].substring(0,e);r=t[i].substring(e+1)}else a=t[i];n(a,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function Wn(t,n){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Wn){this.a=void 0!==n?n:t.a,Jn(this,t.f),this.j=t.j,qn(this,t.c),Vn(this,t.h),this.g=t.g,n=t.b;var i=new li;i.c=n.c,n.a&&(i.a=new Un(n.a),i.b=n.b),$n(this,i),this.i=t.i}else t&&(i=String(t).match(Fn))?(this.a=!!n,Jn(this,i[1]||"",!0),this.j=ni(i[2]||""),qn(this,i[3]||"",!0),Vn(this,i[4]),this.g=ni(i[5]||"",!0),$n(this,i[6]||"",!0),this.i=ni(i[7]||"")):(this.a=!!n,this.b=new li(null,this.a))}function Gn(t){return new Wn(t)}function Jn(t,n,i){t.f=i?ni(n,!0):n,t.f&&(t.f=t.f.replace(/:$/,""))}function qn(t,n,i){t.c=i?ni(n,!0):n}function Vn(t,n){if(n){if(n=Number(n),isNaN(n)||0>n)throw Error("Bad port number "+n);t.h=n}else t.h=null}function $n(t,n,i){n instanceof li?(t.b=n,di(t.b,t.a)):(i||(n=ii(n,oi)),t.b=new li(n,t.a))}function zn(t,n,i){t.b.set(n,i)}function Zn(t){return zn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^m()).toString(36)),t}function Qn(t){return t instanceof Wn?Gn(t):new Wn(t,void 0)}function ti(t,n,i,e){var r=new Wn(null,void 0);return t&&Jn(r,t),n&&qn(r,n),i&&Vn(r,i),e&&(r.g=e),r}function ni(t,n){return t?n?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ii(t,n,i){return"string"==typeof t?(t=encodeURI(t).replace(n,ei),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ei(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Wn.prototype.toString=function(){var t=[],n=this.f;n&&t.push(ii(n,ri,!0),":");var i=this.c;return(i||"file"==n)&&(t.push("//"),(n=this.j)&&t.push(ii(n,ri,!0),"@"),t.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.h)&&t.push(":",String(i))),(i=this.g)&&(this.c&&"/"!=i.charAt(0)&&t.push("/"),t.push(ii(i,"/"==i.charAt(0)?si:ai,!0))),(i=this.b.toString())&&t.push("?",i),(i=this.i)&&t.push("#",ii(i,hi)),t.join("")};var ri=/[#\/\?@]/g,ai=/[#\?:]/g,si=/[#\?]/g,oi=/[#\?@]/g,hi=/#/g;function li(t,n){this.b=this.a=null,this.c=t||null,this.f=!!n}function ci(t){t.a||(t.a=new Un,t.b=0,t.c&&Yn(t.c,function(n,i){t.add(decodeURIComponent(n.replace(/\+/g," ")),i)}))}function ui(t,n){ci(t),n=vi(t,n),Kn(t.a.b,n)&&(t.c=null,t.b-=t.a.get(n).length,Kn((t=t.a).b,n)&&(delete t.b[n],t.c--,t.a.length>2*t.c&&Bn(t)))}function fi(t,n){return ci(t),n=vi(t,n),Kn(t.a.b,n)}function pi(t,n,i){ui(t,n),0<i.length&&(t.c=null,t.a.set(vi(t,n),O(i)),t.b+=i.length)}function vi(t,n){return n=String(n),t.f&&(n=n.toLowerCase()),n}function di(t,n){n&&!t.f&&(ci(t),t.c=null,t.a.forEach(function(t,n){var i=n.toLowerCase();n!=i&&(ui(this,n),pi(this,i,t))},t)),t.f=n}function gi(t,n){this.b=t,this.a=n}function yi(t){this.g=t||bi,o.PerformanceNavigationTiming?t=0<(t=o.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(o.ia&&o.ia.ya&&o.ia.ya()&&o.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(r=li.prototype).add=function(t,n){ci(this),this.c=null,t=vi(this,t);var i=this.a.get(t);return i||this.a.set(t,i=[]),i.push(n),this.b+=1,this},r.forEach=function(t,n){ci(this),this.a.forEach(function(i,e){C(i,function(i){t.call(n,i,e,this)},this)},this)},r.L=function(){ci(this);for(var t=this.a.K(),n=this.a.L(),i=[],e=0;e<n.length;e++)for(var r=t[e],a=0;a<r.length;a++)i.push(n[e]);return i},r.K=function(t){ci(this);var n=[];if("string"==typeof t)fi(this,t)&&(n=x(n,this.a.get(vi(this,t))));else{t=this.a.K();for(var i=0;i<t.length;i++)n=x(n,t[i])}return n},r.set=function(t,n){return ci(this),this.c=null,fi(this,t=vi(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[n]),this.b+=1,this},r.get=function(t,n){return t&&0<(t=this.K(t)).length?String(t[0]):n},r.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],n=this.a.L(),i=0;i<n.length;i++){var e=n[i],r=encodeURIComponent(String(e));e=this.K(e);for(var a=0;a<e.length;a++){var s=r;""!==e[a]&&(s+="="+encodeURIComponent(String(e[a]))),t.push(s)}}return this.c=t.join("&")};var bi=10;function mi(t){return!!t.b||!!t.a&&t.a.size>=t.f}function wi(t){return t.b?1:t.a?t.a.size:0}function Ei(t,n){return t.b?t.b==n:!!t.a&&t.a.has(n)}function Ti(t,n){t.a?t.a.add(n):t.b=n}function Si(t,n){t.b&&t.b==n?t.b=null:t.a&&t.a.has(n)&&t.a.delete(n)}function Ci(t){var n,i;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var a=e(t.a.values()),s=a.next();!s.done;s=a.next()){var o=s.value;r=r.concat(o.s)}}catch(h){n={error:h}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return r}return O(t.c)}function Ii(){}function xi(){this.a=new Ii}function Oi(t,n,i){var e=i||"";try{Nn(t,function(t,i){var r=t;u(t)&&(r=jt(t)),n.push(e+i+"="+encodeURIComponent(r))})}catch(r){throw n.push(e+"type="+encodeURIComponent("_badmap")),r}}function Pi(t,n){var i=new Qt;if(o.Image){var e=new Image;e.onload=b(Ri,i,e,"TestLoadImage: loaded",!0,n),e.onerror=b(Ri,i,e,"TestLoadImage: error",!1,n),e.onabort=b(Ri,i,e,"TestLoadImage: abort",!1,n),e.ontimeout=b(Ri,i,e,"TestLoadImage: timeout",!1,n),o.setTimeout(function(){e.ontimeout&&e.ontimeout()},1e4),e.src=t}else n(!1)}function Ri(t,n,i,e,r){try{n.onload=null,n.onerror=null,n.onabort=null,n.ontimeout=null,r(e)}catch(a){}}yi.prototype.cancel=function(){var t,n;if(this.c=Ci(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var i=e(this.a.values()),r=i.next();!r.done;r=i.next()){r.value.cancel()}}catch(a){t={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}this.a.clear()}},Ii.prototype.stringify=function(t){return o.JSON.stringify(t,void 0)},Ii.prototype.parse=function(t){return o.JSON.parse(t,void 0)};var Ai=o.JSON.parse;function Li(t){At.call(this),this.headers=new Un,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=ji,this.D=this.F=!1}w(Li,At);var ji="",Mi=/^https?$/i,_i=["POST","PUT"];function ki(t){return F&&tt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}function Xi(t){return"content-type"==t.toLowerCase()}function Di(t,n){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=n,t.h=5,Hi(t),Ui(t)}function Hi(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Ni(t){if(t.b&&void 0!==s&&(!t.s[1]||4!=Ki(t)||2!=t.X()))if(t.l&&4==Ki(t))Gt(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Ki(t)){t.b=!1;try{var n,i=t.X();t:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}if(!(n=e)){var r;if(r=0===i){var a=String(t.B).match(Fn)[1]||null;if(!a&&o.self&&o.self.location){var h=o.self.location.protocol;a=h.substr(0,h.length-1)}r=!Mi.test(a?a.toLowerCase():"")}n=r}if(n)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var l=2<Ki(t)?t.a.statusText:""}catch(c){l=""}t.f=l+" ["+t.X()+"]",Hi(t)}}finally{Ui(t)}}}function Ui(t,n){if(t.a){Bi(t);var i=t.a,e=t.s[0]?h:null;t.a=null,t.s=null,n||t.dispatchEvent("ready");try{i.onreadystatechange=e}catch(r){}}}function Bi(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(o.clearTimeout(t.m),t.m=null)}function Ki(t){return t.a?t.a.readyState:0}function Fi(t){var n="";return k(t,function(t,i){n+=i,n+=":",n+=t,n+="\r\n"}),n}function Yi(t,n,i){t:{for(e in i){var e=!1;break t}e=!0}e||(i=Fi(i),"string"==typeof t?null!=i&&encodeURIComponent(String(i)):zn(t,n,i))}function Wi(t,n,i){return i&&i.internalChannelParams&&i.internalChannelParams[t]||n}function Gi(t){this.pa=0,this.g=[],this.c=new Qt,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Wi("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Wi("baseRetryDelayMs",5e3,t),this.Ma=Wi("retryDelaySeedMs",1e4,t),this.Ja=Wi("forwardChannelMaxRetries",2,t),this.ma=Wi("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new yi(t&&t.concurrentRequestLimit),this.ka=new xi,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Ji(t){if(Vi(t),3==t.v){var n=t.R++,i=Gn(t.B);zn(i,"SID",t.J),zn(i,"RID",n),zn(i,"TYPE","terminate"),te(t,i),(n=new Cn(t,t.c,n,void 0)).H=2,n.i=Zn(Gn(i)),i=!1,o.navigator&&o.navigator.sendBeacon&&(i=o.navigator.sendBeacon(n.i.toString(),"")),!i&&o.Image&&((new Image).src=n.i,i=!0),i||(n.a=fe(n.g,null),n.a.ba(n.i)),n.u=m(),jn(n)}ce(t)}function qi(t){t.a&&(re(t),t.a.cancel(),t.a=null)}function Vi(t){qi(t),t.j&&(o.clearTimeout(t.j),t.j=null),se(t),t.b.cancel(),t.h&&("number"==typeof t.h&&o.clearTimeout(t.h),t.h=null)}function $i(t,n){t.g.push(new gi(t.La++,n)),3==t.v&&zi(t)}function zi(t){mi(t.b)||t.h||(t.h=!0,Nt(t.Ba,t),t.u=0)}function Zi(t,n){return!(wi(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.g=n.s.concat(t.g),!0):!(1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja))&&(t.h=pn(y(t.Ba,t,n),he(t,t.u)),t.u++,!0))}function Qi(t,n){var i;i=n?n.f:t.R++;var e=Gn(t.B);zn(e,"SID",t.J),zn(e,"RID",i),zn(e,"AID",t.P),te(t,e),t.i&&t.l&&Yi(e,t.i,t.l),i=new Cn(t,t.c,i,t.u+1),null===t.i&&(i.B=t.l),n&&(t.g=n.s.concat(t.g)),n=ne(t,i,1e3),i.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),Ti(t.b,i),Pn(i,e,n)}function te(t,n){t.f&&Nn({},function(t,i){zn(n,i,t)})}function ne(t,n,i){i=Math.min(t.g.length,i);var e=t.f?y(t.f.Ha,t.f,t):null;t:for(var r=t.g,a=-1;;){var s=["count="+i];-1==a?0<i?(a=r[0].b,s.push("ofs="+a)):a=0:s.push("ofs="+a);for(var o=!0,h=0;h<i;h++){var l=r[h].b,c=r[h].a;if(0>(l-=a))a=Math.max(0,r[h].b-100),o=!1;else try{Oi(c,s,"req"+l+"_")}catch(u){e&&e(c)}}if(o){e=s.join("&");break t}}return t=t.g.splice(0,i),n.s=t,e}function ie(t){t.a||t.j||(t.U=1,Nt(t.Aa,t),t.o=0)}function ee(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=pn(y(t.Aa,t),he(t,t.o)),t.o++,!0)}function re(t){null!=t.s&&(o.clearTimeout(t.s),t.s=null)}function ae(t){t.a=new Cn(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var n=Gn(t.la);zn(n,"RID","rpc"),zn(n,"SID",t.J),zn(n,"CI",t.H?"0":"1"),zn(n,"AID",t.P),te(t,n),zn(n,"TYPE","xmlhttp"),t.i&&t.l&&Yi(n,t.i,t.l),t.D&&t.a.setTimeout(t.D);var i=t.a;t=t.ga,i.H=1,i.i=Zn(Gn(n)),i.j=null,i.I=!0,Rn(i,t)}function se(t){null!=t.m&&(o.clearTimeout(t.m),t.m=null)}function oe(t,n){var i=null;if(t.a==n){se(t),re(t),t.a=null;var e=2}else{if(!Ei(t.b,n))return;i=n.s,Si(t.b,n),e=1}if(t.I=n.N,0!=t.v)if(n.b)if(1==e){i=n.j?n.j.length:0,n=m()-n.u;var r=t.u;(e=on()).dispatchEvent(new fn(e,i,n,r)),zi(t)}else ie(t);else if(3==(r=n.h)||0==r&&0<t.I||!(1==e&&Zi(t,n)||2==e&&ee(t)))switch(i&&0<i.length&&(n=t.b,n.c=n.c.concat(i)),r){case 1:le(t,5);break;case 4:le(t,10);break;case 3:le(t,6);break;default:le(t,2)}}function he(t,n){var i=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(i*=2),i*n}function le(t,n){if(t.c.info("Error code "+n),2==n){var i=null;t.f&&(i=null);var e=y(t.Xa,t);i||(i=new Wn("//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||Jn(i,"https"),Zn(i)),Pi(i.toString(),e)}else un(2);t.v=0,t.f&&t.f.ra(n),ce(t),Vi(t)}function ce(t){t.v=0,t.I=-1,t.f&&(0==Ci(t.b).length&&0==t.g.length||(t.b.c.length=0,O(t.g),t.g.length=0),t.f.qa())}function ue(t,n,i){var e=Qn(i);if(""!=e.c)n&&qn(e,n+"."+e.c),Vn(e,e.h);else{var r=o.location;e=ti(r.protocol,n?n+"."+r.hostname:r.hostname,+r.port,i)}return t.W&&k(t.W,function(t,n){zn(e,n,t)}),n=t.A,i=t.na,n&&i&&zn(e,n,i),zn(e,"VER",t.ha),te(t,e),e}function fe(t,n){if(n&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(n=new Li(t.Ka)).F=t.C,n}function pe(){}function ve(){if(F&&!(10<=Number(it)))throw Error("Environmental error: no available transport.")}function de(t,n){At.call(this),this.a=new Gi(n),this.l=t,this.b=n&&n.messageUrlParams||null,t=n&&n.messageHeaders||null,n&&n.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=n&&n.initMessageHeaders||null,n&&n.messageContentType&&(t?t["X-WebChannel-Content-Type"]=n.messageContentType:t={"X-WebChannel-Content-Type":n.messageContentType}),n&&n.a&&(t?t["X-WebChannel-Client-Profile"]=n.a:t={"X-WebChannel-Client-Profile":n.a}),this.a.O=t,(t=n&&n.httpHeadersOverwriteParam)&&!P(t)&&(this.a.i=t),this.h=n&&n.supportsCrossDomainXhr||!1,this.g=n&&n.sendRawJson||!1,(n=n&&n.httpSessionIdParam)&&!P(n)&&(this.a.A=n,null!==(t=this.b)&&n in t&&(n in(t=this.b)&&delete t[n])),this.f=new be(this)}function ge(t){En.call(this);var n=t.__sm__;if(n){t:{for(var i in n){t=i;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==n&&t in n?n[t]:void 0):this.data=n}else this.data=t}function ye(){Tn.call(this),this.status=1}function be(t){this.a=t}(r=Li.prototype).ba=function(t,n,i,e){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);n=n?n.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?yn(this.H):yn(mn),this.a.onreadystatechange=y(this.za,this);try{this.A=!0,this.a.open(n,String(t),!0),this.A=!1}catch(a){return void Di(this,a)}t=i||"";var r=new Un(this.headers);e&&Nn(e,function(t,n){r.set(n,t)}),e=I(r.L()),i=o.FormData&&t instanceof o.FormData,!(0<=S(_i,n))||e||i||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.forEach(function(t,n){this.a.setRequestHeader(n,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Bi(this),0<this.o&&((this.D=ki(this.a))?(this.a.timeout=this.o,this.a.ontimeout=y(this.xa,this)):this.m=Gt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(a){Di(this,a)}},r.xa=function(){void 0!==s&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},r.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Ui(this))},r.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Ui(this,!0)),Li.S.G.call(this)},r.za=function(){this.j||(this.A||this.l||this.g?Ni(this):this.Ta())},r.Ta=function(){Ni(this)},r.X=function(){try{return 2<Ki(this)?this.a.status:-1}catch(t){return-1}},r.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},r.Na=function(t){if(this.a){var n=this.a.responseText;return t&&0==n.indexOf(t)&&(n=n.substring(t.length)),Ai(n)}},r.ua=function(){return this.h},r.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(r=Gi.prototype).ha=8,r.v=1,r.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var n,i=new Cn(this,this.c,t,void 0),e=this.l;if(this.O&&(e?H(e=X(e),this.O):e=this.O),null===this.i&&(i.B=e),this.da)t:{for(var r=n=0;r<this.g.length;r++){var a=this.g[r];if(void 0===(a="__data__"in a.a&&"string"==typeof(a=a.a.__data__)?a.length:void 0))break;if(4096<(n+=a)){n=r;break t}if(4096===n||r===this.g.length-1){n=r+1;break t}}n=1e3}else n=1e3;n=ne(this,i,n),zn(r=Gn(this.B),"RID",t),zn(r,"CVER",22),this.A&&zn(r,"X-HTTP-Session-Id",this.A),te(this,r),this.i&&e&&Yi(r,this.i,e),Ti(this.b,i),this.Ga&&zn(r,"TYPE","init"),this.da?(zn(r,"$req",n),zn(r,"SID","null"),i.V=!0,Pn(i,r,null)):Pn(i,r,n),this.v=2}}else 3==this.v&&(t?Qi(this,t):0==this.g.length||mi(this.b)||Qi(this))},r.Aa=function(){if(this.j=null,ae(this),this.V&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=pn(y(this.Sa,this),t)}},r.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,qi(this),ae(this))},r.Ra=function(){null!=this.m&&(this.m=null,qi(this),ee(this),un(19))},r.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),un(2)):(this.c.info("Failed to ping google.com"),un(1))},(r=pe.prototype).ta=function(){},r.sa=function(){},r.ra=function(){},r.qa=function(){},r.Ha=function(){},ve.prototype.a=function(t,n){return new de(t,n)},w(de,At),(r=de.prototype).addEventListener=function(t,n,i,e){de.S.addEventListener.call(this,t,n,i,e)},r.removeEventListener=function(t,n,i,e){de.S.removeEventListener.call(this,t,n,i,e)},r.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,n=this.l,i=this.b||void 0;un(0),t.fa=n,t.W=i||{},t.H=t.T,t.B=ue(t,null,t.fa),zi(t)},r.close=function(){Ji(this.a)},r.Pa=function(t){if("string"==typeof t){var n={};n.__data__=t,$i(this.a,n)}else this.g?((n={}).__data__=jt(t),$i(this.a,n)):$i(this.a,t)},r.G=function(){this.a.f=null,delete this.f,Ji(this.a),delete this.a,de.S.G.call(this)},w(ge,En),w(ye,Tn),w(be,pe),be.prototype.ta=function(){this.a.dispatchEvent("a")},be.prototype.sa=function(t){this.a.dispatchEvent(new ge(t))},be.prototype.ra=function(t){this.a.dispatchEvent(new ye(t))},be.prototype.qa=function(){this.a.dispatchEvent("b")},ve.prototype.createWebChannel=ve.prototype.a,de.prototype.send=de.prototype.Pa,de.prototype.open=de.prototype.Oa,de.prototype.close=de.prototype.close,vn.NO_ERROR=0,vn.TIMEOUT=8,vn.HTTP_ERROR=6,dn.COMPLETE="complete",bn.EventType=wn,wn.OPEN="a",wn.CLOSE="b",wn.ERROR="c",wn.MESSAGE="d",At.prototype.listen=At.prototype.va,Li.prototype.listenOnce=Li.prototype.wa,Li.prototype.getLastError=Li.prototype.Qa,Li.prototype.getLastErrorCode=Li.prototype.ua,Li.prototype.getStatus=Li.prototype.X,Li.prototype.getResponseJson=Li.prototype.Na,Li.prototype.getResponseText=Li.prototype.$,Li.prototype.send=Li.prototype.ba;var me=function(){return new ve};exports.createWebChannelTransport=me;var we=vn;exports.ErrorCode=we;var Ee=dn;exports.EventType=Ee;var Te=bn;exports.WebChannel=Te;var Se=Li;exports.XhrIo=Se;var Ce={createWebChannelTransport:me,ErrorCode:we,EventType:Ee,WebChannel:Te,XhrIo:Se},Ie=Ce;exports.default=Ie;
},{}],"eA7g":[function(require,module,exports) {
var process = require("process");
var t=require("process");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(exports,"__esModule",{value:!0});var n=require("tslib"),r=require("@firebase/app"),i=require("@firebase/logger"),o=require("@firebase/util"),s=require("@firebase/webchannel-wrapper"),u=require("@firebase/component");function a(t){return t&&"object"==e(t)&&"default"in t?t:{default:t}}var c=a(r),h={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},f=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return n.__extends(e,t),e}(Error),l=new i.Logger("@firebase/firestore");function p(){return l.logLevel}function d(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(l.logLevel<=i.LogLevel.DEBUG){var o=e.map(g);l.debug.apply(l,n.__spreadArrays(["Firestore (7.24.0): "+t],o))}}function v(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(l.logLevel<=i.LogLevel.ERROR){var o=e.map(g);l.error.apply(l,n.__spreadArrays(["Firestore (7.24.0): "+t],o))}}function y(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(l.logLevel<=i.LogLevel.WARN){var o=e.map(g);l.warn.apply(l,n.__spreadArrays(["Firestore (7.24.0): "+t],o))}}function g(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function m(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (7.24.0) INTERNAL ASSERTION FAILED: "+t;throw v(e),new Error(e)}function w(t,e){t||m()}function _(t,e){return t}function b(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function I(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function E(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var T=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&m(),void 0===n?n=t.length-e:n>t.length-e&&m(),this.segments=t,this.offset=e,this.t=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.t},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.i(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.o(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.u=function(t){return t=void 0===t?1:t,this.o(this.segments,this.offset+t,this.length-t)},t.prototype.h=function(){return this.o(this.segments,this.offset,this.length-1)},t.prototype.l=function(){return this.segments[this.offset]},t.prototype._=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.m=function(){return 0===this.length},t.prototype.T=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.I=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.A=function(){return this.segments.slice(this.offset,this.limit())},t.i=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.o=function(t,n,r){return new e(t,n,r)},e.prototype.R=function(){return this.A().join("/")},e.prototype.toString=function(){return this.R()},e.g=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new f(h.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.P=function(){return new e([])},e}(T),A=/^[_a-zA-Z][_a-zA-Z0-9]*$/,S=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.o=function(t,n,r){return new e(t,n,r)},e.V=function(t){return A.test(t)},e.prototype.R=function(){return this.A().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.V(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.R()},e.prototype.p=function(){return 1===this.length&&"__name__"===this.get(0)},e.v=function(){return new e(["__name__"])},e.S=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new f(h.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new f(h.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new f(h.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===u?(s=!s,i++):"."!==u||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new f(h.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.P=function(){return new e([])},e}(T),D=function(){function t(t){this.path=t}return t.D=function(e){return new t(N.g(e))},t.C=function(e){return new t(N.g(e).u(5))},t.prototype.N=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===N.i(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.i=function(t,e){return N.i(t.path,e.path)},t.F=function(t){return t.length%2==0},t.$=function(e){return new t(new N(e.slice()))},t}();function x(t,e){if(0!==e.length)throw new f(h.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Q(e.length,"argument")+".")}function L(t,e,n){if(e.length!==n)throw new f(h.INVALID_ARGUMENT,"Function "+t+"() requires "+Q(n,"argument")+", but was called with "+Q(e.length,"argument")+".")}function k(t,e,n){if(e.length<n)throw new f(h.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Q(n,"argument")+", but was called with "+Q(e.length,"argument")+".")}function R(t,e,n,r){if(e.length<n||e.length>r)throw new f(h.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Q(e.length,"argument")+".")}function O(t,e,n,r){M(t,e,K(n)+" argument",r)}function P(t,e,n,r){void 0!==r&&O(t,e,n,r)}function V(t,e,n,r){M(t,e,n+" option",r)}function U(t,e,n,r){void 0!==r&&V(t,e,n,r)}function C(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],s=0,u=i;s<u.length;s++){var a=u[s];if(a===r)return;o.push(j(a))}var c=j(r);throw new f(h.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function F(t,e,n,r){if(!e.some(function(t){return t===r}))throw new f(h.INVALID_ARGUMENT,"Invalid value "+j(r)+" provided to function "+t+"() for its "+K(n)+" argument. Acceptable values: "+e.join(", "));return r}function M(t,n,r,i){if(!("object"===n?q(i):"non-empty string"===n?"string"==typeof i&&""!==i:e(i)===n)){var o=j(i);throw new f(h.INVALID_ARGUMENT,"Function "+t+"() requires its "+r+" to be of type "+n+", but it was: "+o)}}function q(t){return"object"==e(t)&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function j(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==e(t)){if(t instanceof Array)return"an array";var n=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return n?"a custom "+n+" object":"an object"}return"function"==typeof t?"a function":m()}function G(t,e,n){if(void 0===n)throw new f(h.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+K(e)+" argument, but it was undefined.")}function z(t,e,n){I(e,function(e,r){if(n.indexOf(e)<0)throw new f(h.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))})}function B(t,e,n,r){var i=j(r);return new f(h.INVALID_ARGUMENT,"Function "+t+"() requires its "+K(n)+" argument to be a "+e+", but it was: "+i)}function W(t,e,n){if(n<=0)throw new f(h.INVALID_ARGUMENT,"Function "+t+"() requires its "+K(e)+" argument to be a positive number, but it was: "+n+".")}function K(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Q(t,e){return t+" "+e+(1===t?"":"s")}function H(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Y=function(){function t(){}return t.k=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=H(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function $(t,e){return t<e?-1:t>e?1:0}function X(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function J(t){return t+"\0"}var Z=function(){function t(t){this.M=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.M,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.M)},t.prototype.O=function(){return 2*this.M.length},t.prototype.L=function(t){return $(this.M,t.M)},t.prototype.isEqual=function(t){return this.M===t.M},t}();Z.B=new Z("");var tt=function(){function t(t){this.q=t}return t.fromBase64String=function(e){try{return new t(Z.fromBase64String(e))}catch(e){throw new f(h.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Z.fromUint8Array(e))},t.prototype.toBase64=function(){return this.q.toBase64()},t.prototype.toUint8Array=function(){return this.q.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.q.isEqual(t.q)},t}();function et(){if("undefined"==typeof Uint8Array)throw new f(h.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function nt(){if("undefined"==typeof atob)throw new f(h.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.fromBase64String=function(t){L("Blob.fromBase64String",arguments,1),O("Blob.fromBase64String","string",1,t),nt();try{return new e(Z.fromBase64String(t))}catch(t){throw new f(h.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},e.fromUint8Array=function(t){if(L("Blob.fromUint8Array",arguments,1),et(),!(t instanceof Uint8Array))throw B("Blob.fromUint8Array","Uint8Array",1,t);return new e(Z.fromUint8Array(t))},e.prototype.toBase64=function(){return L("Blob.toBase64",arguments,0),nt(),t.prototype.toBase64.call(this)},e.prototype.toUint8Array=function(){return L("Blob.toUint8Array",arguments,0),et(),t.prototype.toUint8Array.call(this)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(tt),it=function(t,e,n,r,i,o){this.U=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.W=o},ot=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"j",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.L=function(t){return $(this.projectId,t.projectId)||$(this.database,t.database)},t}(),st=function(){function t(t,e){this.K=t,this.G=e,this.H={}}return t.prototype.get=function(t){var e=this.K(t),n=this.H[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.G(s,t))return u}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.K(t),r=this.H[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.G(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.H[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.K(t),n=this.H[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.G(n[r][0],t))return 1===n.length?delete this.H[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){I(this.H,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}})},t.prototype.m=function(){return E(this.H)},t}(),ut=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new f(h.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new f(h.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new f(h.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new f(h.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.Y=function(t){return this.seconds===t.seconds?$(this.nanoseconds,t.nanoseconds):$(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),at=function(){function t(t){this.timestamp=t}return t.J=function(e){return new t(e)},t.min=function(){return new t(new ut(0,0))},t.prototype.L=function(t){return this.timestamp.Y(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.X=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.Z=function(){return this.timestamp},t}();function ct(t){return null==t}function ht(t){return 0===t&&1/t==-1/0}function ft(t){return"number"==typeof t&&Number.isInteger(t)&&!ht(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var lt=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.tt=null};function pt(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new lt(t,e,n,r,i,o,s)}function dt(t){var e=_(t);if(null===e.tt){var n=e.path.R();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.R()+t.op.toString()+oe(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return(e=t).field.R()+e.dir;var e}).join(","),ct(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=hr(e.startAt)),e.endAt&&(n+="|ub:",n+=hr(e.endAt)),e.tt=n}return e.tt}function vt(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!vr(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!ee(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!lr(t.startAt,e.startAt)&&lr(t.endAt,e.endAt)}function yt(t){return D.F(t.path)&&null===t.collectionGroup&&0===t.filters.length}var gt,mt,wt=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=at.min()),void 0===o&&(o=at.min()),void 0===s&&(s=Z.B),this.target=t,this.targetId=e,this.et=n,this.sequenceNumber=r,this.nt=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.st=function(e){return new t(this.target,this.targetId,this.et,e,this.nt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.it=function(e,n){return new t(this.target,this.targetId,this.et,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.rt=function(e){return new t(this.target,this.targetId,this.et,this.sequenceNumber,this.nt,e,this.resumeToken)},t}(),_t=function(t){this.count=t};function bt(t){switch(t){case h.OK:return m();case h.CANCELLED:case h.UNKNOWN:case h.DEADLINE_EXCEEDED:case h.RESOURCE_EXHAUSTED:case h.INTERNAL:case h.UNAVAILABLE:case h.UNAUTHENTICATED:return!1;case h.INVALID_ARGUMENT:case h.NOT_FOUND:case h.ALREADY_EXISTS:case h.PERMISSION_DENIED:case h.FAILED_PRECONDITION:case h.ABORTED:case h.OUT_OF_RANGE:case h.UNIMPLEMENTED:case h.DATA_LOSS:return!0;default:return m()}}function It(t){if(void 0===t)return v("GRPC error has no .code"),h.UNKNOWN;switch(t){case gt.OK:return h.OK;case gt.CANCELLED:return h.CANCELLED;case gt.UNKNOWN:return h.UNKNOWN;case gt.DEADLINE_EXCEEDED:return h.DEADLINE_EXCEEDED;case gt.RESOURCE_EXHAUSTED:return h.RESOURCE_EXHAUSTED;case gt.INTERNAL:return h.INTERNAL;case gt.UNAVAILABLE:return h.UNAVAILABLE;case gt.UNAUTHENTICATED:return h.UNAUTHENTICATED;case gt.INVALID_ARGUMENT:return h.INVALID_ARGUMENT;case gt.NOT_FOUND:return h.NOT_FOUND;case gt.ALREADY_EXISTS:return h.ALREADY_EXISTS;case gt.PERMISSION_DENIED:return h.PERMISSION_DENIED;case gt.FAILED_PRECONDITION:return h.FAILED_PRECONDITION;case gt.ABORTED:return h.ABORTED;case gt.OUT_OF_RANGE:return h.OUT_OF_RANGE;case gt.UNIMPLEMENTED:return h.UNIMPLEMENTED;case gt.DATA_LOSS:return h.DATA_LOSS;default:return m()}}(mt=gt||(gt={}))[mt.OK=0]="OK",mt[mt.CANCELLED=1]="CANCELLED",mt[mt.UNKNOWN=2]="UNKNOWN",mt[mt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",mt[mt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",mt[mt.NOT_FOUND=5]="NOT_FOUND",mt[mt.ALREADY_EXISTS=6]="ALREADY_EXISTS",mt[mt.PERMISSION_DENIED=7]="PERMISSION_DENIED",mt[mt.UNAUTHENTICATED=16]="UNAUTHENTICATED",mt[mt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",mt[mt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",mt[mt.ABORTED=10]="ABORTED",mt[mt.OUT_OF_RANGE=11]="OUT_OF_RANGE",mt[mt.UNIMPLEMENTED=12]="UNIMPLEMENTED",mt[mt.INTERNAL=13]="INTERNAL",mt[mt.UNAVAILABLE=14]="UNAVAILABLE",mt[mt.DATA_LOSS=15]="DATA_LOSS";var Et=function(){function t(t,e){this.i=t,this.root=e||Nt.EMPTY}return t.prototype.ot=function(e,n){return new t(this.i,this.root.ot(e,n,this.i).copy(null,null,Nt.at,null,null))},t.prototype.remove=function(e){return new t(this.i,this.root.remove(e,this.i).copy(null,null,Nt.at,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.m();){var n=this.i(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.m();){var r=this.i(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.m=function(){return this.root.m()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.ct=function(){return this.root.ct()},t.prototype.ut=function(){return this.root.ut()},t.prototype.ht=function(t){return this.root.ht(t)},t.prototype.forEach=function(t){this.ht(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.ht(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.lt=function(t){return this.root.lt(t)},t.prototype._t=function(){return new Tt(this.root,null,this.i,!1)},t.prototype.ft=function(t){return new Tt(this.root,t,this.i,!1)},t.prototype.dt=function(){return new Tt(this.root,null,this.i,!0)},t.prototype.wt=function(t){return new Tt(this.root,t,this.i,!0)},t}(),Tt=function(){function t(t,e,n,r){this.Tt=r,this.Et=[];for(var i=1;!t.m();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Tt?t.left:t.right;else{if(0===i){this.Et.push(t);break}this.Et.push(t),t=this.Tt?t.right:t.left}}return t.prototype.It=function(){var t=this.Et.pop(),e={key:t.key,value:t.value};if(this.Tt)for(t=t.left;!t.m();)this.Et.push(t),t=t.right;else for(t=t.right;!t.m();)this.Et.push(t),t=t.left;return e},t.prototype.At=function(){return this.Et.length>0},t.prototype.Rt=function(){if(0===this.Et.length)return null;var t=this.Et[this.Et.length-1];return{key:t.key,value:t.value}},t}(),Nt=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.m=function(){return!1},t.prototype.ht=function(t){return this.left.ht(t)||t(this.key,this.value)||this.right.ht(t)},t.prototype.lt=function(t){return this.right.lt(t)||t(this.key,this.value)||this.left.lt(t)},t.prototype.min=function(){return this.left.m()?this:this.left.min()},t.prototype.ct=function(){return this.min().key},t.prototype.ut=function(){return this.right.m()?this.key:this.right.ut()},t.prototype.ot=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.ot(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.ot(t,e,n))).gt()},t.prototype.Pt=function(){if(this.left.m())return t.EMPTY;var e=this;return e.left.yt()||e.left.left.yt()||(e=e.Vt()),(e=e.copy(null,null,null,e.left.Pt(),null)).gt()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.m()||i.left.yt()||i.left.left.yt()||(i=i.Vt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.yt()&&(i=i.bt()),i.right.m()||i.right.yt()||i.right.left.yt()||(i=i.vt()),0===n(e,i.key)){if(i.right.m())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.Pt())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.gt()},t.prototype.yt=function(){return this.color},t.prototype.gt=function(){var t=this;return t.right.yt()&&!t.left.yt()&&(t=t.St()),t.left.yt()&&t.left.left.yt()&&(t=t.bt()),t.left.yt()&&t.right.yt()&&(t=t.Dt()),t},t.prototype.Vt=function(){var t=this.Dt();return t.right.left.yt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.bt())).St()).Dt()),t},t.prototype.vt=function(){var t=this.Dt();return t.left.left.yt()&&(t=(t=t.bt()).Dt()),t},t.prototype.St=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.bt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.Dt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Ct=function(){var t=this.Nt();return Math.pow(2,t)<=this.size+1},t.prototype.Nt=function(){if(this.yt()&&this.left.yt())throw m();if(this.right.yt())throw m();var t=this.left.Nt();if(t!==this.right.Nt())throw m();return t+(this.yt()?0:1)},t}();Nt.EMPTY=null,Nt.RED=!0,Nt.at=!1,Nt.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw m()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw m()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw m()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw m()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw m()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.ot=function(t,e,n){return new Nt(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.m=function(){return!0},t.prototype.ht=function(t){return!1},t.prototype.lt=function(t){return!1},t.prototype.ct=function(){return null},t.prototype.ut=function(){return null},t.prototype.yt=function(){return!1},t.prototype.Ct=function(){return!0},t.prototype.Nt=function(){return 0},t}());var At=function(){function t(t){this.i=t,this.data=new Et(this.i)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.ct()},t.prototype.last=function(){return this.data.ut()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.ht(function(e,n){return t(e),!1})},t.prototype.Ft=function(t,e){for(var n=this.data.ft(t[0]);n.At();){var r=n.It();if(this.i(r.key,t[1])>=0)return;e(r.key)}},t.prototype.xt=function(t,e){var n;for(n=void 0!==e?this.data.ft(e):this.data._t();n.At();)if(!t(n.It().key))return},t.prototype.$t=function(t){var e=this.data.ft(t);return e.At()?e.It().key:null},t.prototype._t=function(){return new St(this.data._t())},t.prototype.ft=function(t){return new St(this.data.ft(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).ot(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.m=function(){return this.data.m()},t.prototype.kt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data._t(),r=e.data._t();n.At();){var i=n.It().key,o=r.It().key;if(0!==this.i(i,o))return!1}return!0},t.prototype.A=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.i);return n.data=e,n},t}(),St=function(){function t(t){this.Mt=t}return t.prototype.It=function(){return this.Mt.It().key},t.prototype.At=function(){return this.Mt.At()},t}(),Dt=new Et(D.i);function xt(){return Dt}function Lt(){return xt()}var kt=new Et(D.i);function Rt(){return kt}var Ot=new Et(D.i),Pt=new At(D.i);function Vt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Pt,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ut=new At($);function Ct(){return Ut}var Ft=function(){function t(t){this.i=t?function(e,n){return t(e,n)||D.i(e.key,n.key)}:function(t,e){return D.i(t.key,e.key)},this.Ot=Rt(),this.Lt=new Et(this.i)}return t.Bt=function(e){return new t(e.i)},t.prototype.has=function(t){return null!=this.Ot.get(t)},t.prototype.get=function(t){return this.Ot.get(t)},t.prototype.first=function(){return this.Lt.ct()},t.prototype.last=function(){return this.Lt.ut()},t.prototype.m=function(){return this.Lt.m()},t.prototype.indexOf=function(t){var e=this.Ot.get(t);return e?this.Lt.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.Lt.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.Lt.ht(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Ot.ot(t.key,t),e.Lt.ot(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Ot.remove(t),this.Lt.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.Lt._t(),r=e.Lt._t();n.At();){var i=n.It().key,o=r.It().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.i=this.i,r.Ot=e,r.Lt=n,r},t}(),Mt=function(){function t(){this.qt=new Et(D.i)}return t.prototype.track=function(t){var e=t.doc.key,n=this.qt.get(e);n?0!==t.type&&3===n.type?this.qt=this.qt.ot(e,t):3===t.type&&1!==n.type?this.qt=this.qt.ot(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.qt=this.qt.ot(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.qt=this.qt.remove(e):1===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):m():this.qt=this.qt.ot(e,t)},t.prototype.Ut=function(){var t=[];return this.qt.ht(function(e,n){t.push(n)}),t},t}(),qt=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Qt=n,this.docChanges=r,this.Wt=i,this.fromCache=o,this.jt=s,this.Kt=u}return t.Gt=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,Ft.Bt(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.Wt.m()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.jt===t.jt&&this.Wt.isEqual(t.Wt)&&Yn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Qt.isEqual(t.Qt)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),jt=function(){function t(t,e,n,r,i){this.nt=t,this.zt=e,this.Ht=n,this.Yt=r,this.Jt=i}return t.Xt=function(e,n){var r=new Map;return r.set(e,Gt.Zt(e,n)),new t(at.min(),r,Ct(),xt(),Vt())},t}(),Gt=function(){function t(t,e,n,r,i){this.resumeToken=t,this.te=e,this.ee=n,this.ne=r,this.se=i}return t.Zt=function(e,n){return new t(Z.B,n,Vt(),Vt(),Vt())},t}(),zt=function(t,e,n,r){this.ie=t,this.removedTargetIds=e,this.key=n,this.re=r},Bt=function(t,e){this.targetId=t,this.oe=e},Wt=function(t,e,n,r){void 0===n&&(n=Z.B),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Kt=function(){function t(){this.ae=0,this.ce=Yt(),this.ue=Z.B,this.he=!1,this.le=!0}return Object.defineProperty(t.prototype,"te",{get:function(){return this.he},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_e",{get:function(){return 0!==this.ae},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fe",{get:function(){return this.le},enumerable:!1,configurable:!0}),t.prototype.de=function(t){t.O()>0&&(this.le=!0,this.ue=t)},t.prototype.we=function(){var t=Vt(),e=Vt(),n=Vt();return this.ce.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:m()}}),new Gt(this.ue,this.he,t,e,n)},t.prototype.me=function(){this.le=!1,this.ce=Yt()},t.prototype.Te=function(t,e){this.le=!0,this.ce=this.ce.ot(t,e)},t.prototype.Ee=function(t){this.le=!0,this.ce=this.ce.remove(t)},t.prototype.Ie=function(){this.ae+=1},t.prototype.Ae=function(){this.ae-=1},t.prototype.Re=function(){this.le=!0,this.he=!0},t}(),Qt=function(){function t(t){this.ge=t,this.Pe=new Map,this.ye=xt(),this.Ve=Ht(),this.pe=new At($)}return t.prototype.be=function(t){for(var e=0,n=t.ie;e<n.length;e++){var r=n[e];t.re instanceof On?this.ve(r,t.re):t.re instanceof Pn&&this.Se(r,t.key,t.re)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Se(s,t.key,t.re)}},t.prototype.De=function(t){var e=this;this.Ce(t,function(n){var r=e.Ne(n);switch(t.state){case 0:e.Fe(n)&&r.de(t.resumeToken);break;case 1:r.Ae(),r._e||r.me(),r.de(t.resumeToken);break;case 2:r.Ae(),r._e||e.removeTarget(n);break;case 3:e.Fe(n)&&(r.Re(),r.de(t.resumeToken));break;case 4:e.Fe(n)&&(e.xe(n),r.de(t.resumeToken));break;default:m()}})},t.prototype.Ce=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Pe.forEach(function(t,r){n.Fe(r)&&e(r)})},t.prototype.$e=function(t){var e=t.targetId,n=t.oe.count,r=this.ke(e);if(r){var i=r.target;if(yt(i))if(0===n){var o=new D(i.path);this.Se(e,o,new Pn(o,at.min()))}else w(1===n);else this.Me(e)!==n&&(this.xe(e),this.pe=this.pe.add(e))}},t.prototype.Oe=function(t){var e=this,n=new Map;this.Pe.forEach(function(r,i){var o=e.ke(i);if(o){if(r.te&&yt(o.target)){var s=new D(o.target.path);null!==e.ye.get(s)||e.Le(i,s)||e.Se(i,s,new Pn(s,t))}r.fe&&(n.set(i,r.we()),r.me())}});var r=Vt();this.Ve.forEach(function(t,n){var i=!0;n.xt(function(t){var n=e.ke(t);return!n||2===n.et||(i=!1,!1)}),i&&(r=r.add(t))});var i=new jt(t,n,this.pe,this.ye,r);return this.ye=xt(),this.Ve=Ht(),this.pe=new At($),i},t.prototype.ve=function(t,e){if(this.Fe(t)){var n=this.Le(t,e.key)?2:0;this.Ne(t).Te(e.key,n),this.ye=this.ye.ot(e.key,e),this.Ve=this.Ve.ot(e.key,this.Be(e.key).add(t))}},t.prototype.Se=function(t,e,n){if(this.Fe(t)){var r=this.Ne(t);this.Le(t,e)?r.Te(e,1):r.Ee(e),this.Ve=this.Ve.ot(e,this.Be(e).delete(t)),n&&(this.ye=this.ye.ot(e,n))}},t.prototype.removeTarget=function(t){this.Pe.delete(t)},t.prototype.Me=function(t){var e=this.Ne(t).we();return this.ge.qe(t).size+e.ee.size-e.se.size},t.prototype.Ie=function(t){this.Ne(t).Ie()},t.prototype.Ne=function(t){var e=this.Pe.get(t);return e||(e=new Kt,this.Pe.set(t,e)),e},t.prototype.Be=function(t){var e=this.Ve.get(t);return e||(e=new At($),this.Ve=this.Ve.ot(t,e)),e},t.prototype.Fe=function(t){var e=null!==this.ke(t);return e||d("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ke=function(t){var e=this.Pe.get(t);return e&&e._e?null:this.ge.Ue(t)},t.prototype.xe=function(t){var e=this;this.Pe.set(t,new Kt),this.ge.qe(t).forEach(function(n){e.Se(t,n,null)})},t.prototype.Le=function(t,e){return this.ge.qe(t).has(e)},t}();function Ht(){return new Et(D.i)}function Yt(){return new Et(D.i)}function $t(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Xt(t){var e=t.mapValue.fields.__previous_value__;return $t(e)?Xt(e):e}function Jt(t){var e=ue(t.mapValue.fields.__local_write_time__.timestampValue);return new ut(e.seconds,e.nanos)}var Zt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function te(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?$t(t)?4:10:m()}function ee(t,e){var n=te(t);if(n!==te(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Jt(t).isEqual(Jt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=ue(t.timestampValue),r=ue(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ce(t.bytesValue).isEqual(ce(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ae(t.geoPointValue.latitude)===ae(e.geoPointValue.latitude)&&ae(t.geoPointValue.longitude)===ae(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ae(t.integerValue)===ae(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=ae(t.doubleValue),r=ae(e.doubleValue);return n===r?ht(n)===ht(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return X(t.arrayValue.values||[],e.arrayValue.values||[],ee);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(b(n)!==b(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ee(n[i],r[i])))return!1;return!0}(t,e);default:return m()}}function ne(t,e){return void 0!==(t.values||[]).find(function(t){return ee(t,e)})}function re(t,e){var n=te(t),r=te(e);if(n!==r)return $(n,r);switch(n){case 0:return 0;case 1:return $(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=ae(t.integerValue||t.doubleValue),r=ae(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ie(t.timestampValue,e.timestampValue);case 4:return ie(Jt(t),Jt(e));case 5:return $(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ce(t),r=ce(e);return n.L(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=$(n[i],r[i]);if(0!==o)return o}return $(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=$(ae(t.latitude),ae(e.latitude));return 0!==n?n:$(ae(t.longitude),ae(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=re(n[i],r[i]);if(o)return o}return $(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=$(r[s],o[s]);if(0!==u)return u;var a=re(n[r[s]],i[o[s]]);if(0!==a)return a}return $(r.length,o.length)}(t.mapValue,e.mapValue);default:throw m()}}function ie(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return $(t,e);var n=ue(t),r=ue(e),i=$(n.seconds,r.seconds);return 0!==i?i:$(n.nanos,r.nanos)}function oe(t){return se(t)}function se(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=ue(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ce(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,D.C(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=se(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+se(t.fields[o])}return e+"}"}(t.mapValue):m();var e,n}function ue(t){if(w(!!t),"string"==typeof t){var e=0,n=Zt.exec(t);if(w(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ae(t.seconds),nanos:ae(t.nanos)}}function ae(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ce(t){return"string"==typeof t?Z.fromBase64String(t):Z.fromUint8Array(t)}function he(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.R()}}function fe(t){return!!t&&"integerValue"in t}function le(t){return!!t&&"arrayValue"in t}function pe(t){return!!t&&"nullValue"in t}function de(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ve(t){return!!t&&"mapValue"in t}var ye={asc:"ASCENDING",desc:"DESCENDING"},ge={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},me=function(t,e){this.U=t,this.Qe=e};function we(t){return{integerValue:""+t}}function _e(t,e){if(t.Qe){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ht(e)?"-0":e}}function be(t,e){return ft(e)?we(e):_e(t,e)}function Ie(t,e){return t.Qe?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ee(t,e){return t.Qe?e.toBase64():e.toUint8Array()}function Te(t,e){return Ie(t,e.Z())}function Ne(t){return w(!!t),at.J(function(t){var e=ue(t);return new ut(e.seconds,e.nanos)}(t))}function Ae(t,e){return function(t){return new N(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).R()}function Se(t){var e=N.g(t);return w($e(e)),e}function De(t,e){return Ae(t.U,e.path)}function xe(t,e){var n=Se(e);return w(n.get(1)===t.U.projectId),w(!n.get(3)&&!t.U.database||n.get(3)===t.U.database),new D(Oe(n))}function Le(t,e){return Ae(t.U,e)}function ke(t){var e=Se(t);return 4===e.length?N.P():Oe(e)}function Re(t){return new N(["projects",t.U.projectId,"databases",t.U.database]).R()}function Oe(t){return w(t.length>4&&"documents"===t.get(4)),t.u(5)}function Pe(t,e,n){return{name:De(t,e),fields:n.proto.mapValue.fields}}function Ve(t,e){var n;if(e instanceof bn)n={update:Pe(t,e.key,e.value)};else if(e instanceof Sn)n={delete:De(t,e.key)};else if(e instanceof In)n={update:Pe(t,e.key,e.data),updateMask:Ye(e.We)};else if(e instanceof Tn)n={transform:{document:De(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof en)return{fieldPath:e.field.R(),setToServerValue:"REQUEST_TIME"};if(n instanceof nn)return{fieldPath:e.field.R(),appendMissingElements:{values:n.elements}};if(n instanceof on)return{fieldPath:e.field.R(),removeAllFromArray:{values:n.elements}};if(n instanceof un)return{fieldPath:e.field.R(),increment:n.je};throw m()}(0,t)})}};else{if(!(e instanceof Dn))return m();n={verify:De(t,e.key)}}return e.Ge.Ke||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Te(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:m()}(t,e.Ge)),n}function Ue(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?pn.updateTime(Ne(t.updateTime)):void 0!==t.exists?pn.exists(t.exists):pn.ze()}(e.currentDocument):pn.ze();if(e.update){e.update.name;var r=xe(t,e.update.name),i=new xn({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){var e=t.fieldPaths||[];return new hn(e.map(function(t){return S.S(t)}))}(e.updateMask);return new In(r,i,o,n)}return new bn(r,i,n)}if(e.delete){var s=xe(t,e.delete);return new Sn(s,n)}if(e.transform){var u=xe(t,e.transform.document),a=e.transform.fieldTransforms.map(function(e){return function(t,e){var n=null;if("setToServerValue"in e)w("REQUEST_TIME"===e.setToServerValue),n=new en;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new nn(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new on(i)}else"increment"in e?n=new un(t,e.increment):m();var o=S.S(e.fieldPath);return new fn(o,n)}(t,e)});return w(!0===n.exists),new Tn(u,a)}if(e.verify){var c=xe(t,e.verify);return new Dn(c,n)}return m()}function Ce(t,e){return{documents:[Le(t,e.path)]}}function Fe(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Le(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Le(t,r.h()),n.structuredQuery.from=[{collectionId:r._()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(de(t.value))return{unaryFilter:{field:We(t.field),op:"IS_NAN"}};if(pe(t.value))return{unaryFilter:{field:We(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(de(t.value))return{unaryFilter:{field:We(t.field),op:"IS_NOT_NAN"}};if(pe(t.value))return{unaryFilter:{field:We(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:We(t.field),op:Be(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:We(t.field),direction:ze(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.Qe||ct(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=je(e.startAt)),e.endAt&&(n.structuredQuery.endAt=je(e.endAt)),n}function Me(t){var n=ke(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;if(i>0){w(1===i);var s=r.from[0];s.allDescendants?o=s.collectionId:n=n.child(s.collectionId)}var u=[];r.where&&(u=qe(r.where));var a=[];r.orderBy&&(a=r.orderBy.map(function(t){return function(t){return new pr(Ke(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var c=null;r.limit&&(c=function(t){var n;return ct(n="object"==e(t)?t.value:t)?null:n}(r.limit));var h=null;r.startAt&&(h=Ge(r.startAt));var f=null;return r.endAt&&(f=Ge(r.endAt)),Wn(Cn(n,o,a,u,c,"F",h,f))}function qe(t){return t?void 0!==t.unaryFilter?[He(t)]:void 0!==t.fieldFilter?[Qe(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return qe(t)}).reduce(function(t,e){return t.concat(e)}):m():[]}function je(t){return{before:t.before,values:t.position}}function Ge(t){var e=!!t.before,n=t.values||[];return new cr(n,e)}function ze(t){return ye[t]}function Be(t){return ge[t]}function We(t){return{fieldPath:t.R()}}function Ke(t){return S.S(t.fieldPath)}function Qe(t){return tr.create(Ke(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return m()}}(t.fieldFilter.op),t.fieldFilter.value)}function He(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ke(t.unaryFilter.field);return tr.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Ke(t.unaryFilter.field);return tr.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Ke(t.unaryFilter.field);return tr.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Ke(t.unaryFilter.field);return tr.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return m()}}function Ye(t){var e=[];return t.fields.forEach(function(t){return e.push(t.R())}),{fieldPaths:e}}function $e(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}var Xe=function(){this.He=void 0};function Je(t,e,n){return t instanceof en?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof nn?rn(t,e):t instanceof on?sn(t,e):function(t,e){var n=tn(t,e),r=an(n)+an(t.je);return fe(n)&&fe(t.je)?we(r):_e(t.serializer,r)}(t,e)}function Ze(t,e,n){return t instanceof nn?rn(t,e):t instanceof on?sn(t,e):n}function tn(t,e){return t instanceof un?fe(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var en=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e}(Xe),nn=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return n.__extends(e,t),e}(Xe);function rn(t,e){for(var n=cn(e),r=function(t){n.some(function(e){return ee(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var on=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return n.__extends(e,t),e}(Xe);function sn(t,e){for(var n=cn(e),r=function(t){n=n.filter(function(e){return!ee(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var un=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).serializer=e,r.je=n,r}return n.__extends(e,t),e}(Xe);function an(t){return ae(t.integerValue||t.doubleValue)}function cn(t){return le(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var hn=function(){function t(t){this.fields=t,t.sort(S.i)}return t.prototype.Ye=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].T(t))return!0;return!1},t.prototype.isEqual=function(t){return X(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),fn=function(t,e){this.field=t,this.transform=e},ln=function(t,e){this.version=t,this.transformResults=e},pn=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.ze=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"Ke",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function dn(t,e){return void 0!==t.updateTime?e instanceof On&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof On}var vn=function(){};function yn(t,e,n){return t instanceof bn?function(t,e,n){return new On(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof In?function(t,e,n){if(!dn(t.Ge,e))return new Vn(t.key,n.version);var r=En(t,e);return new On(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Tn?function(t,e,n){if(w(null!=n.transformResults),!dn(t.Ge,e))return new Vn(t.key,n.version);var r=Nn(t,e),i=function(t,e,n){var r=[];w(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof On&&(u=e.field(o.field)),r.push(Ze(s,u,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=An(t,r.data(),i);return new On(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new Pn(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function gn(t,e,n,r){return t instanceof bn?function(t,e){if(!dn(t.Ge,e))return e;var n=_n(e);return new On(t.key,n,t.value,{Je:!0})}(t,e):t instanceof In?function(t,e){if(!dn(t.Ge,e))return e;var n=_n(e),r=En(t,e);return new On(t.key,n,r,{Je:!0})}(t,e):t instanceof Tn?function(t,e,n,r){if(!dn(t.Ge,e))return e;var i=Nn(t,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof On&&(c=n.field(u.field)),null===c&&r instanceof On&&(c=r.field(u.field)),i.push(Je(a,c,e))}return i}(t.fieldTransforms,n,e,r),s=An(t,i.data(),o);return new On(t.key,i.version,s,{Je:!0})}(t,e,r,n):function(t,e){return dn(t.Ge,e)?new Pn(t.key,at.min()):e}(t,e)}function mn(t,e){return t instanceof Tn?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e instanceof On?e.field(o.field):void 0,u=tn(o.transform,s||null);null!=u&&(n=null==n?(new Ln).set(o.field,u):n.set(o.field,u))}return n?n.Xe():null}(t,e):null}function wn(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ge.isEqual(e.Ge)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.We.isEqual(e.We):2!==t.type||X(t.fieldTransforms,t.fieldTransforms,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof nn&&e instanceof nn||t instanceof on&&e instanceof on?X(t.elements,e.elements,ee):t instanceof un&&e instanceof un?ee(t.je,e.je):t instanceof en&&e instanceof en}(t.transform,e.transform)}(t,e)}))}function _n(t){return t instanceof On?t.version:at.min()}var bn=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).key=e,i.value=n,i.Ge=r,i.type=0,i}return n.__extends(e,t),e}(vn),In=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.We=r,o.Ge=i,o.type=1,o}return n.__extends(e,t),e}(vn);function En(t,e){return function(t,e){var n=new Ln(e);return t.We.fields.forEach(function(e){if(!e.m()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}}),n.Xe()}(t,e instanceof On?e.data():xn.empty())}var Tn=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.fieldTransforms=n,r.type=2,r.Ge=pn.exists(!0),r}return n.__extends(e,t),e}(vn);function Nn(t,e){return e}function An(t,e,n){for(var r=new Ln(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Xe()}var Sn=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ge=n,r.type=3,r}return n.__extends(e,t),e}(vn),Dn=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ge=n,r.type=4,r}return n.__extends(e,t),e}(vn),xn=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.m())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!ve(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t._()])||null},t.prototype.isEqual=function(t){return ee(this.proto,t.proto)},t}(),Ln=function(){function t(t){void 0===t&&(t=xn.empty()),this.Ze=t,this.tn=new Map}return t.prototype.set=function(t,e){return this.en(t,e),this},t.prototype.delete=function(t){return this.en(t,null),this},t.prototype.en=function(t,e){for(var n=this.tn,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===te(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t._(),e)},t.prototype.Xe=function(){var t=this.nn(S.P(),this.tn);return null!=t?new xn(t):this.Ze},t.prototype.nn=function(t,e){var n=this,r=!1,i=this.Ze.field(t),o=ve(i)?Object.assign({},i.mapValue.fields):{};return e.forEach(function(e,i){if(e instanceof Map){var s=n.nn(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)}),r?{mapValue:{fields:o}}:null},t}();function kn(t){var e=[];return I(t.fields||{},function(t,n){var r=new S([t]);if(ve(n)){var i=kn(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var u=s[o];e.push(r.child(u))}}else e.push(r)}),new hn(e)}var Rn=function(t,e){this.key=t,this.version=e},On=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).sn=r,o.Je=!!i.Je,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return n.__extends(e,t),e.prototype.field=function(t){return this.sn.field(t)},e.prototype.data=function(){return this.sn},e.prototype.rn=function(){return this.sn.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Je===t.Je&&this.hasCommittedMutations===t.hasCommittedMutations&&this.sn.isEqual(t.sn)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.sn.toString()+", {hasLocalMutations: "+this.Je+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.Je||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(Rn),Pn=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return n.__extends(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Rn),Vn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Rn),Un=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.on=n,this.filters=r,this.limit=i,this.an=o,this.startAt=s,this.endAt=u,this.cn=null,this.un=null,this.startAt,this.endAt};function Cn(t,e,n,r,i,o,s,u){return new Un(t,e,n,r,i,o,s,u)}function Fn(t){return new Un(t)}function Mn(t){return!ct(t.limit)&&"F"===t.an}function qn(t){return!ct(t.limit)&&"L"===t.an}function jn(t){return t.on.length>0?t.on[0].field:null}function Gn(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.hn())return r.field}return null}function zn(t){return null!==t.collectionGroup}function Bn(t){var e=_(t);if(null===e.cn){e.cn=[];var n=Gn(e),r=jn(e);if(null!==n&&null===r)n.p()||e.cn.push(new pr(n)),e.cn.push(new pr(S.v(),"asc"));else{for(var i=!1,o=0,s=e.on;o<s.length;o++){var u=s[o];e.cn.push(u),u.field.p()&&(i=!0)}if(!i){var a=e.on.length>0?e.on[e.on.length-1].dir:"asc";e.cn.push(new pr(S.v(),a))}}}return e.cn}function Wn(t){var e=_(t);if(!e.un)if("F"===e.an)e.un=pt(e.path,e.collectionGroup,Bn(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Bn(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new pr(o.field,s))}var u=e.endAt?new cr(e.endAt.position,!e.endAt.before):null,a=e.startAt?new cr(e.startAt.position,!e.startAt.before):null;e.un=pt(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.un}function Kn(t,e,n){return new Un(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Qn(t,e){return new Un(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,e,t.endAt)}function Hn(t,e){return new Un(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,t.startAt,e)}function Yn(t,e){return vt(Wn(t),Wn(e))&&t.an===e.an}function $n(t){return dt(Wn(t))+"|lt:"+t.an}function Xn(t){return"Query(target="+function(t){var e=t.path.R();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.R()+" "+e.op+" "+oe(e.value);var e}).join(", ")+"]"),ct(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return(e=t).field.R()+" ("+e.dir+")";var e}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+hr(t.startAt)),t.endAt&&(e+=", endAt: "+hr(t.endAt)),"Target("+e+")"}(Wn(t))+"; limitType="+t.an+")"}function Jn(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.N(t.collectionGroup)&&t.path.T(n):D.F(t.path)?t.path.isEqual(n):t.path.I(n)}(t,e)&&function(t,e){for(var n=0,r=t.on;n<r.length;n++){var i=r[n];if(!i.field.p()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!fr(t.startAt,Bn(t),e)||t.endAt&&fr(t.endAt,Bn(t),e))}(t,e)}function Zn(t){return function(e,n){for(var r=!1,i=0,o=Bn(t);i<o.length;i++){var s=o[i],u=dr(s,e,n);if(0!==u)return u;r=r||s.field.p()}return 0}}var tr=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return n.__extends(e,t),e.create=function(t,n,r){if(t.p())return"in"===n||"not-in"===n?this.ln(t,n,r):new er(t,n,r);if(pe(r)){if("=="!==n&&"!="!==n)throw new f(h.INVALID_ARGUMENT,"Invalid query. Null only supports '==' and '!=' comparisons.");return new e(t,n,r)}if(de(r)){if("=="!==n&&"!="!==n)throw new f(h.INVALID_ARGUMENT,"Invalid query. NaN only supports '==' and '!=' comparisons.");return new e(t,n,r)}return"array-contains"===n?new or(t,r):"in"===n?new sr(t,r):"not-in"===n?new ur(t,r):"array-contains-any"===n?new ar(t,r):new e(t,n,r)},e.ln=function(t,e,n){return"in"===e?new nr(t,n):new rr(t,n)},e.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this._n(re(e,this.value)):null!==e&&te(this.value)===te(e)&&this._n(re(e,this.value))},e.prototype._n=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return m()}},e.prototype.hn=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),er=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=D.C(r.referenceValue),i}return n.__extends(e,t),e.prototype.matches=function(t){var e=D.i(t.key,this.key);return this._n(e)},e}(tr),nr=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=ir("in",n),r}return n.__extends(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(tr),rr=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=ir("not-in",n),r}return n.__extends(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(tr);function ir(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return D.C(t.referenceValue)})}var or=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return n.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return le(e)&&ne(e.arrayValue,this.value)},e}(tr),sr=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return n.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&ne(this.value.arrayValue,e)},e}(tr),ur=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return n.__extends(e,t),e.prototype.matches=function(t){if(ne(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!ne(this.value.arrayValue,e)},e}(tr),ar=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return n.__extends(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!le(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return ne(e.value.arrayValue,t)})},e}(tr),cr=function(t,e){this.position=t,this.before=e};function hr(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return oe(t)}).join(",")}function fr(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.p()?D.i(D.C(s.referenceValue),n.key):re(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function lr(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!ee(t.position[n],e.position[n]))return!1;return!0}var pr=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function dr(t,e,n){var r=t.field.p()?D.i(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?re(r,i):m()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return m()}}function vr(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var yr=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},gr=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.fn=t,this.dn=e,this.wn=n,this.mn=r,this.Tn=i,this.En=0,this.In=null,this.An=Date.now(),this.reset()}return t.prototype.reset=function(){this.En=0},t.prototype.Rn=function(){this.En=this.Tn},t.prototype.gn=function(t){var e=this;this.cancel();var n=Math.floor(this.En+this.Pn()),r=Math.max(0,Date.now()-this.An),i=Math.max(0,n-r);i>0&&d("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.En+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.In=this.fn.yn(this.dn,i,function(){return e.An=Date.now(),t()}),this.En*=this.mn,this.En<this.wn&&(this.En=this.wn),this.En>this.Tn&&(this.En=this.Tn)},t.prototype.Vn=function(){null!==this.In&&(this.In.pn(),this.In=null)},t.prototype.cancel=function(){null!==this.In&&(this.In.cancel(),this.In=null)},t.prototype.Pn=function(){return(Math.random()-.5)*this.En},t}(),mr=function(){function t(t){var e=this;this.bn=null,this.vn=null,this.result=void 0,this.error=void 0,this.Sn=!1,this.Dn=!1,t(function(t){e.Sn=!0,e.result=t,e.bn&&e.bn(t)},function(t){e.Sn=!0,e.error=t,e.vn&&e.vn(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Dn&&m(),this.Dn=!0,this.Sn?this.error?this.Cn(n,this.error):this.Nn(e,this.result):new t(function(t,i){r.bn=function(n){r.Nn(e,n).next(t,i)},r.vn=function(e){r.Cn(n,e).next(t,i)}})},t.prototype.Fn=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.xn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.Nn=function(e,n){return e?this.xn(function(){return e(n)}):t.resolve(n)},t.prototype.Cn=function(e,n){return e?this.xn(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.$n=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.kn=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.$n(r)},t}(),wr=function(){function r(t,e,n){this.name=t,this.version=e,this.Mn=n,12.2===r.On(o.getUA())&&v("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return r.delete=function(t){return d("SimpleDb","Removing database:",t),Nr(window.indexedDB.deleteDatabase(t)).Fn()},r.Ln=function(){if("undefined"==typeof indexedDB)return!1;if(r.Bn())return!0;var t=o.getUA(),e=r.On(t),n=0<e&&e<10,i=r.qn(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)},r.Bn=function(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.Un)},r.Qn=function(t,e){return t.store(e)},r.On=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},r.qn=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},r.prototype.Wn=function(t){return n.__awaiter(this,void 0,void 0,function(){var e,r=this;return n.__generator(this,function(n){switch(n.label){case 0:return this.db?[3,2]:(d("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var i=indexedDB.open(r.name,r.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){n(new br(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var r=e.target.error;"VersionError"===r.name?n(new f(h.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new br(t,r))},i.onupgradeneeded=function(t){d("SimpleDb",'Database "'+r.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;r.Mn.createOrUpgrade(e,i.transaction,t.oldVersion,r.version).next(function(){d("SimpleDb","Database upgrade to version "+r.version+" complete")})}})]);case 1:e.db=n.sent(),n.label=2;case 2:return[2,(this.jn&&(this.db.onversionchange=function(t){return r.jn(t)}),this.db)]}})})},r.prototype.Kn=function(t){this.jn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},r.prototype.runTransaction=function(t,r,i,o){return n.__awaiter(this,void 0,void 0,function(){var s,u,a,c,h;return n.__generator(this,function(f){switch(f.label){case 0:s="readonly"===r,u=0,a=function(){var e,r,a,h,f;return n.__generator(this,function(n){switch(n.label){case 0:++u,n.label=1;case 1:return n.trys.push([1,4,,5]),[4,c.Wn(t)];case 2:return c.db=n.sent(),e=Er.open(c.db,t,s?"readonly":"readwrite",i),r=o(e).catch(function(t){return e.abort(t),mr.reject(t)}).Fn(),a={},r.catch(function(){}),[4,e.Gn];case 3:return[2,(a.value=(n.sent(),r),a)];case 4:return h=n.sent(),f="FirebaseError"!==h.name&&u<3,d("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),c.close(),f?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}})},c=this,f.label=1;case 1:return[5,a()];case 2:if("object"==e(h=f.sent()))return[2,h.value];f.label=3;case 3:return[3,1];case 4:return[2]}})})},r.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},r}(),_r=function(){function t(t){this.zn=t,this.Hn=!1,this.Yn=null}return Object.defineProperty(t.prototype,"Sn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Jn",{get:function(){return this.Yn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.zn=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Hn=!0},t.prototype.Xn=function(t){this.Yn=t},t.prototype.delete=function(){return Nr(this.zn.delete())},t}(),br=function(t){function e(e,n){var r=this;return(r=t.call(this,h.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return n.__extends(e,t),e}(f);function Ir(t){return"IndexedDbTransactionError"===t.name}var Er=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.Zn=new yr,this.transaction.oncomplete=function(){n.Zn.resolve()},this.transaction.onabort=function(){e.error?n.Zn.reject(new br(t,e.error)):n.Zn.resolve()},this.transaction.onerror=function(e){var r=Sr(e.target.error);n.Zn.reject(new br(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new br(n,e)}},Object.defineProperty(t.prototype,"Gn",{get:function(){return this.Zn.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.Zn.reject(t),this.aborted||(d("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Tr(e)},t}(),Tr=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(d("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(d("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Nr(n)},t.prototype.add=function(t){return d("SimpleDb","ADD",this.store.name,t,t),Nr(this.store.add(t))},t.prototype.get=function(t){var e=this;return Nr(this.store.get(t)).next(function(n){return void 0===n&&(n=null),d("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return d("SimpleDb","DELETE",this.store.name,t),Nr(this.store.delete(t))},t.prototype.count=function(){return d("SimpleDb","COUNT",this.store.name),Nr(this.store.count())},t.prototype.ts=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.es(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.ns=function(t,e){d("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.ss=!1;var r=this.cursor(n);return this.es(r,function(t,e,n){return n.delete()})},t.prototype.rs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.es(r,e)},t.prototype.os=function(t){var e=this.cursor({});return new mr(function(n,r){e.onerror=function(t){var e=Sr(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.es=function(t,e){var n=[];return new mr(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new _r(i),s=e(i.primaryKey,i.value,o);if(s instanceof mr){var u=s.catch(function(t){return o.done(),mr.reject(t)});n.push(u)}o.Sn?r():null===o.Jn?i.continue():i.continue(o.Jn)}else r()}}).next(function(){return mr.$n(n)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ss?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Nr(t){return new mr(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Sr(t.target.error);n(e)}})}var Ar=!1;function Sr(t){var e=wr.On(o.getUA());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new f("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ar||(Ar=!0,setTimeout(function(){throw r},0)),r}}return t}function Dr(){return"undefined"!=typeof window?window:null}function xr(){return"undefined"!=typeof document?document:null}var Lr=function(){function t(t,e,n,r,i){this.cs=t,this.dn=e,this.us=n,this.op=r,this.hs=i,this.ls=new yr,this.then=this.ls.promise.then.bind(this.ls.promise),this.ls.promise.catch(function(t){})}return t._s=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.fs=setTimeout(function(){return e.ds()},t)},t.prototype.pn=function(){return this.ds()},t.prototype.cancel=function(t){null!==this.fs&&(this.clearTimeout(),this.ls.reject(new f(h.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.ds=function(){var t=this;this.cs.ws(function(){return null!==t.fs?(t.clearTimeout(),t.op().then(function(e){return t.ls.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.fs&&(this.hs(this),clearTimeout(this.fs),this.fs=null)},t}(),kr=function(){function t(){var t=this;this.Ts=Promise.resolve(),this.Es=[],this.Is=!1,this.As=[],this.Rs=null,this.gs=!1,this.Ps=[],this.ys=new gr(this,"async_queue_retry"),this.Vs=function(){var e=xr();e&&d("AsyncQueue","Visibility state changed to  ",e.visibilityState),t.ys.Vn()};var e=xr();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Vs)}return Object.defineProperty(t.prototype,"ps",{get:function(){return this.Is},enumerable:!1,configurable:!0}),t.prototype.ws=function(t){this.enqueue(t)},t.prototype.bs=function(t){this.vs(),this.Ss(t)},t.prototype.Ds=function(){if(!this.Is){this.Is=!0;var t=xr();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vs)}},t.prototype.enqueue=function(t){return this.vs(),this.Is?new Promise(function(t){}):this.Ss(t)},t.prototype.Cs=function(t){var e=this;this.ws(function(){return e.Es.push(t),e.Ns()})},t.prototype.Ns=function(){return n.__awaiter(this,void 0,void 0,function(){var t,e=this;return n.__generator(this,function(n){switch(n.label){case 0:if(0===this.Es.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.Es[0]()];case 2:return n.sent(),this.Es.shift(),this.ys.reset(),[3,4];case 3:if(!Ir(t=n.sent()))throw t;return d("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.Es.length>0&&this.ys.gn(function(){return e.Ns()}),n.label=5;case 5:return[2]}})})},t.prototype.Ss=function(t){var e=this,n=this.Ts.then(function(){return e.gs=!0,t().catch(function(t){throw e.Rs=t,e.gs=!1,v("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gs=!1,t})});return this.Ts=n,n},t.prototype.yn=function(t,e,n){var r=this;this.vs(),this.Ps.indexOf(t)>-1&&(e=0);var i=Lr._s(this,t,e,n,function(t){return r.Fs(t)});return this.As.push(i),i},t.prototype.vs=function(){this.Rs&&m()},t.prototype.xs=function(){},t.prototype.$s=function(){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(e){switch(e.label){case 0:return[4,t=this.Ts];case 1:e.sent(),e.label=2;case 2:if(t!==this.Ts)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.ks=function(t){for(var e=0,n=this.As;e<n.length;e++)if(n[e].dn===t)return!0;return!1},t.prototype.Ms=function(t){var e=this;return this.$s().then(function(){e.As.sort(function(t,e){return t.us-e.us});for(var n=0,r=e.As;n<r.length;n++){var i=r[n];if(i.pn(),"all"!==t&&i.dn===t)break}return e.$s()})},t.prototype.Os=function(t){this.Ps.push(t)},t.prototype.Fs=function(t){var e=this.As.indexOf(t);this.As.splice(e,1)},t}();function Rr(t,e){if(v("AsyncQueue",e+": "+t),Ir(t))return new f(h.UNAVAILABLE,e+": "+t);throw t}var Or=function(){this.Ls=void 0,this.listeners=[]},Pr=function(){this.Bs=new st(function(t){return $n(t)},Yn),this.onlineState="Unknown",this.qs=new Set};function Vr(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s,u,a,c;return n.__generator(this,function(n){switch(n.label){case 0:if(r=_(t),i=e.query,o=!1,(s=r.Bs.get(i))||(o=!0,s=new Or),!o)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),u=s,[4,r.Us(i)];case 2:return u.Ls=n.sent(),[3,4];case 3:return a=n.sent(),c=Rr(a,"Initialization of query '"+Xn(e.query)+"' failed"),[2,void e.onError(c)];case 4:return r.Bs.set(i,s),s.listeners.push(e),e.Qs(r.onlineState),s.Ls&&e.Ws(s.Ls)&&Mr(r),[2]}})})}function Ur(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s,u;return n.__generator(this,function(n){return r=_(t),i=e.query,o=!1,(s=r.Bs.get(i))&&(u=s.listeners.indexOf(e))>=0&&(s.listeners.splice(u,1),o=0===s.listeners.length),o?[2,(r.Bs.delete(i),r.js(i))]:[2]})})}function Cr(t,e){for(var n=_(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,a=n.Bs.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Ws(s)&&(r=!0);a.Ls=s}}r&&Mr(n)}function Fr(t,e,n){var r=_(t),i=r.Bs.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.Bs.delete(e)}function Mr(t){t.qs.forEach(function(t){t.next()})}var qr=function(){function t(t,e,n){this.query=t,this.Ks=e,this.Gs=!1,this.zs=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Ws=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new qt(t.query,t.docs,t.Qt,e,t.Wt,t.fromCache,t.jt,!0)}var o=!1;return this.Gs?this.Hs(t)&&(this.Ks.next(t),o=!0):this.Ys(t,this.onlineState)&&(this.Js(t),o=!0),this.zs=t,o},t.prototype.onError=function(t){this.Ks.error(t)},t.prototype.Qs=function(t){this.onlineState=t;var e=!1;return this.zs&&!this.Gs&&this.Ys(this.zs,t)&&(this.Js(this.zs),e=!0),e},t.prototype.Ys=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Xs&&n||t.docs.m()&&"Offline"!==e)},t.prototype.Hs=function(t){if(t.docChanges.length>0)return!0;var e=this.zs&&this.zs.hasPendingWrites!==t.hasPendingWrites;return!(!t.jt&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.Js=function(t){t=qt.Gt(t.query,t.docs,t.Wt,t.fromCache),this.Gs=!0,this.Ks.next(t)},t}(),jr=function(){function t(t){this.uid=t}return t.prototype.Zs=function(){return null!=this.uid},t.prototype.ti=function(){return this.Zs()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();jr.UNAUTHENTICATED=new jr(null),jr.ei=new jr("google-credentials-uid"),jr.ni=new jr("first-party-uid");var Gr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.si=function(t){return n.ii(t)},this.ri=function(t){return e.oi(t)})}return t.prototype.ii=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.ri&&this.ri(t),t},t}();function zr(t,e){return"firestore_clients_"+t+"_"+e}function Br(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Zs()&&(r+="_"+e.uid),r}function Wr(t,e){return"firestore_targets_"+t+"_"+e}Gr.ai=-1;var Kr=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.ci=function(n,r,i){var o=JSON.parse(i),s="object"==e(o)&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==e(o.error)),u=void 0;return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(u=new f(o.error.code,o.error.message)),s?new t(n,r,o.state,u):(v("SharedClientState","Failed to parse mutation state for ID '"+r+"': "+i),null)},t.prototype.ui=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Qr=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.ci=function(n,r){var i=JSON.parse(r),o="object"==e(i)&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==e(i.error)),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new f(i.error.code,i.error.message)),o?new t(n,i.state,s):(v("SharedClientState","Failed to parse target state for ID '"+n+"': "+r),null)},t.prototype.ui=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Hr=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.ci=function(n,r){for(var i=JSON.parse(r),o="object"==e(i)&&i.activeTargetIds instanceof Array,s=Ct(),u=0;o&&u<i.activeTargetIds.length;++u)o=ft(i.activeTargetIds[u]),s=s.add(i.activeTargetIds[u]);return o?new t(n,s):(v("SharedClientState","Failed to parse client data for instance '"+n+"': "+r),null)},t}(),Yr=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.ci=function(n){var r=JSON.parse(n);return"object"==e(r)&&-1!==["Unknown","Online","Offline"].indexOf(r.onlineState)&&"string"==typeof r.clientId?new t(r.clientId,r.onlineState):(v("SharedClientState","Failed to parse online state: "+n),null)},t}(),$r=function(){function t(){this.activeTargetIds=Ct()}return t.prototype.hi=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.li=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.ui=function(){var t={activeTargetIds:this.activeTargetIds.A(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Xr=function(){function t(t,e,n,r,i){this.window=t,this.fn=e,this.persistenceKey=n,this._i=r,this.fi=null,this.di=null,this.si=null,this.wi=this.mi.bind(this),this.Ti=new Et($),this.Ei=!1,this.Ii=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ai=zr(this.persistenceKey,this._i),this.Ri=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Ti=this.Ti.ot(this._i,new $r),this.gi=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Pi=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.yi=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Vi=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.wi)}return t.Ln=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return n.__awaiter(this,void 0,void 0,function(){var t,e,r,i,o,s,u,a,c,h,f,l=this;return n.__generator(this,function(n){switch(n.label){case 0:return[4,this.fi.pi()];case 1:for(t=n.sent(),e=0,r=t;e<r.length;e++)(i=r[e])!==this._i&&(o=this.getItem(zr(this.persistenceKey,i)))&&(s=Hr.ci(i,o))&&(this.Ti=this.Ti.ot(s.clientId,s));for(this.bi(),(u=this.storage.getItem(this.Vi))&&(a=this.vi(u))&&this.Si(a),c=0,h=this.Ii;c<h.length;c++)f=h[c],this.mi(f);return this.Ii=[],this.window.addEventListener("unload",function(){return l.Di()}),this.Ei=!0,[2]}})})},t.prototype.oi=function(t){this.setItem(this.Ri,JSON.stringify(t))},t.prototype.Ci=function(){return this.Ni(this.Ti)},t.prototype.Fi=function(t){var e=!1;return this.Ti.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.xi=function(t){this.$i(t,"pending")},t.prototype.ki=function(t,e,n){this.$i(t,e,n),this.Mi(t)},t.prototype.Oi=function(t){var e="not-current";if(this.Fi(t)){var n=this.storage.getItem(Wr(this.persistenceKey,t));if(n){var r=Qr.ci(t,n);r&&(e=r.state)}}return this.Li.hi(t),this.bi(),e},t.prototype.Bi=function(t){this.Li.li(t),this.bi()},t.prototype.qi=function(t){return this.Li.activeTargetIds.has(t)},t.prototype.Ui=function(t){this.removeItem(Wr(this.persistenceKey,t))},t.prototype.Qi=function(t,e,n){this.Wi(t,e,n)},t.prototype.ji=function(t,e,n){var r=this;e.forEach(function(t){r.Mi(t)}),this.currentUser=t,n.forEach(function(t){r.xi(t)})},t.prototype.Ki=function(t){this.Gi(t)},t.prototype.Di=function(){this.Ei&&(this.window.removeEventListener("storage",this.wi),this.removeItem(this.Ai),this.Ei=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return d("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){d("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){d("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.mi=function(t){var e=this,r=t;if(r.storageArea===this.storage){if(d("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Ai)return void v("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.fn.Cs(function(){return n.__awaiter(e,void 0,void 0,function(){var t,e,i,o,s,u;return n.__generator(this,function(n){if(this.Ei){if(null!==r.key)if(this.gi.test(r.key)){if(null==r.newValue)return t=this.zi(r.key),[2,this.Hi(t,null)];if(e=this.Yi(r.key,r.newValue))return[2,this.Hi(e.clientId,e)]}else if(this.Pi.test(r.key)){if(null!==r.newValue&&(i=this.Ji(r.key,r.newValue)))return[2,this.Xi(i)]}else if(this.yi.test(r.key)){if(null!==r.newValue&&(o=this.Zi(r.key,r.newValue)))return[2,this.tr(o)]}else if(r.key===this.Vi){if(null!==r.newValue&&(s=this.vi(r.newValue)))return[2,this.Si(s)]}else r.key===this.Ri&&(u=function(t){var e=Gr.ai;if(null!=t)try{var n=JSON.parse(t);w("number"==typeof n),e=n}catch(t){v("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(r.newValue))!==Gr.ai&&this.si(u)}else this.Ii.push(r);return[2]})})})}},Object.defineProperty(t.prototype,"Li",{get:function(){return this.Ti.get(this._i)},enumerable:!1,configurable:!0}),t.prototype.bi=function(){this.setItem(this.Ai,this.Li.ui())},t.prototype.$i=function(t,e,n){var r=new Kr(this.currentUser,t,e,n),i=Br(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ui())},t.prototype.Mi=function(t){var e=Br(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Gi=function(t){var e={clientId:this._i,onlineState:t};this.storage.setItem(this.Vi,JSON.stringify(e))},t.prototype.Wi=function(t,e,n){var r=Wr(this.persistenceKey,t),i=new Qr(t,e,n);this.setItem(r,i.ui())},t.prototype.zi=function(t){var e=this.gi.exec(t);return e?e[1]:null},t.prototype.Yi=function(t,e){var n=this.zi(t);return Hr.ci(n,e)},t.prototype.Ji=function(t,e){var n=this.Pi.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Kr.ci(new jr(i),r,e)},t.prototype.Zi=function(t,e){var n=this.yi.exec(t),r=Number(n[1]);return Qr.ci(r,e)},t.prototype.vi=function(t){return Yr.ci(t)},t.prototype.Xi=function(t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.fi.er(t.batchId,t.state,t.error)]:(d("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.tr=function(t){return this.fi.nr(t.targetId,t.state,t.error)},t.prototype.Hi=function(t,e){var n=this,r=e?this.Ti.ot(t,e):this.Ti.remove(t),i=this.Ni(this.Ti),o=this.Ni(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.fi.sr(s,u).then(function(){n.Ti=r})},t.prototype.Si=function(t){this.Ti.get(t.clientId)&&this.di(t.onlineState)},t.prototype.Ni=function(t){var e=Ct();return t.forEach(function(t,n){e=e.kt(n.activeTargetIds)}),e},t}(),Jr=function(){function t(){this.ir=new $r,this.rr={},this.di=null,this.si=null}return t.prototype.xi=function(t){},t.prototype.ki=function(t,e,n){},t.prototype.Oi=function(t){return this.ir.hi(t),this.rr[t]||"not-current"},t.prototype.Qi=function(t,e,n){this.rr[t]=e},t.prototype.Bi=function(t){this.ir.li(t)},t.prototype.qi=function(t){return this.ir.activeTargetIds.has(t)},t.prototype.Ui=function(t){delete this.rr[t]},t.prototype.Ci=function(){return this.ir.activeTargetIds},t.prototype.Fi=function(t){return this.ir.activeTargetIds.has(t)},t.prototype.start=function(){return this.ir=new $r,Promise.resolve()},t.prototype.ji=function(t,e,n){},t.prototype.Ki=function(t){},t.prototype.Di=function(){},t.prototype.oi=function(t){},t}(),Zr=function(){function t(t,e,n,r){this.batchId=t,this.ar=e,this.baseMutations=n,this.mutations=r}return t.prototype.cr=function(t,e,n){for(var r=n.ur,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=yn(o,e,r[i]))}return e},t.prototype.hr=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=gn(i,e,e,this.ar))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=gn(a,e,o,this.ar))}return e},t.prototype.lr=function(t){var e=this,n=t;return this.mutations.forEach(function(r){var i=e.hr(r.key,t.get(r.key));i&&(n=n.ot(r.key,i))}),n},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Vt())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&X(this.mutations,t.mutations,function(t,e){return wn(t,e)})&&X(this.baseMutations,t.baseMutations,function(t,e){return wn(t,e)})},t}(),ti=function(){function t(t,e,n,r){this.batch=t,this._r=e,this.ur=n,this.dr=r}return t.from=function(e,n,r){w(e.mutations.length===r.length);for(var i=Ot,o=e.mutations,s=0;s<o.length;s++)i=i.ot(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),ei=function(){function t(){this.wr=new st(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.mr=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return this.Tr},set:function(t){this.Tr=t},enumerable:!1,configurable:!0}),t.prototype.Er=function(t,e){this.Ir(),this.readTime=e,this.wr.set(t.key,t)},t.prototype.Ar=function(t,e){this.Ir(),e&&(this.readTime=e),this.wr.set(t,null)},t.prototype.Rr=function(t,e){this.Ir();var n=this.wr.get(e);return void 0!==n?mr.resolve(n):this.gr(t,e)},t.prototype.getEntries=function(t,e){return this.Pr(t,e)},t.prototype.apply=function(t){return this.Ir(),this.mr=!0,this.yr(t)},t.prototype.Ir=function(){},t}(),ni="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ri=function(){function t(){this.Vr=[]}return t.prototype.pr=function(t){this.Vr.push(t)},t.prototype.br=function(){this.Vr.forEach(function(t){return t()})},t}(),ii=function(){function t(t,e,n){this.vr=t,this.Sr=e,this.Dr=n}return t.prototype.Cr=function(t,e){var n=this;return this.Sr.Nr(t,e).next(function(r){return n.Fr(t,e,r)})},t.prototype.Fr=function(t,e,n){return this.vr.Rr(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].hr(e,t);return t})},t.prototype.$r=function(t,e,n){var r=Lt();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].hr(t,e);r=r.ot(t,e)}),r},t.prototype.kr=function(t,e){var n=this;return this.vr.getEntries(t,e).next(function(e){return n.Mr(t,e)})},t.prototype.Mr=function(t,e){var n=this;return this.Sr.Or(t,e).next(function(r){var i=n.$r(t,e,r),o=xt();return i.forEach(function(t,e){e||(e=new Pn(t,at.min())),o=o.ot(t,e)}),o})},t.prototype.Lr=function(t,e,n){return function(t){return D.F(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Br(t,e.path):zn(e)?this.qr(t,e,n):this.Ur(t,e,n)},t.prototype.Br=function(t,e){return this.Cr(t,new D(e)).next(function(t){var e=Rt();return t instanceof On&&(e=e.ot(t.key,t)),e})},t.prototype.qr=function(t,e,n){var r=this,i=e.collectionGroup,o=Rt();return this.Dr.Qr(t,i).next(function(s){return mr.forEach(s,function(s){var u=function(t,e){return new Un(e,null,t.on.slice(),t.filters.slice(),t.limit,t.an,t.startAt,t.endAt)}(e,s.child(i));return r.Ur(t,u,n).next(function(t){t.forEach(function(t,e){o=o.ot(t,e)})})}).next(function(){return o})})},t.prototype.Ur=function(t,e,n){var r,i,o=this;return this.vr.Lr(t,e,n).next(function(n){return r=n,o.Sr.Wr(t,e)}).next(function(e){return i=e,o.jr(t,i,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=r.get(c),f=gn(a,h,h,o.ar);r=f instanceof On?r.ot(c,f):r.remove(c)}})}).next(function(){return r.forEach(function(t,n){Jn(e,n)||(r=r.remove(t))}),r})},t.prototype.jr=function(t,e,n){for(var r=Vt(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof In&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.vr.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof On&&(c=c.ot(t,e))}),c})},t}(),oi=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.Kr=n,this.Gr=r}return t.zr=function(e,n){for(var r=Vt(),i=Vt(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}();function si(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=$(n,i);return 0===s?$(r,o):s}var ui=function(){function t(t){this.Hr=t,this.buffer=new At(si),this.Yr=0}return t.prototype.Jr=function(){return++this.Yr},t.prototype.Xr=function(t){var e=[t,this.Jr()];if(this.buffer.size<this.Hr)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();si(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),ai={Zr:!1,eo:0,no:0,so:0},ci=function(){function t(t,e,n){this.io=t,this.ro=e,this.oo=n}return t.ao=function(e){return new t(e,t.co,t.uo)},t}();ci.ho=-1,ci.lo=1048576,ci._o=41943040,ci.co=10,ci.uo=1e3,ci.fo=new ci(ci._o,ci.co,ci.uo),ci.do=new ci(ci.ho,0,0);var hi=function(){function t(t,e){this.wo=t,this.cs=e,this.mo=!1,this.To=null}return t.prototype.start=function(t){this.wo.params.io!==ci.ho&&this.Eo(t)},t.prototype.stop=function(){this.To&&(this.To.cancel(),this.To=null)},Object.defineProperty(t.prototype,"Ei",{get:function(){return null!==this.To},enumerable:!1,configurable:!0}),t.prototype.Eo=function(t){var e=this,r=this.mo?3e5:6e4;d("LruGarbageCollector","Garbage collection scheduled in "+r+"ms"),this.To=this.cs.yn("lru_garbage_collection",r,function(){return n.__awaiter(e,void 0,void 0,function(){var e;return n.__generator(this,function(n){switch(n.label){case 0:this.To=null,this.mo=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.Io(this.wo)];case 2:return n.sent(),[3,7];case 3:return Ir(e=n.sent())?(d("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Lo(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.Eo(t)];case 8:return n.sent(),[2]}})})})},t}(),fi=function(){function t(t,e){this.Ao=t,this.params=e}return t.prototype.Ro=function(t,e){return this.Ao.Po(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.yo=function(t,e){var n=this;if(0===e)return mr.resolve(Gr.ai);var r=new ui(e);return this.Ao.Ce(t,function(t){return r.Xr(t.sequenceNumber)}).next(function(){return n.Ao.Vo(t,function(t){return r.Xr(t)})}).next(function(){return r.maxValue})},t.prototype.po=function(t,e,n){return this.Ao.po(t,e,n)},t.prototype.bo=function(t,e){return this.Ao.bo(t,e)},t.prototype.vo=function(t,e){var n=this;return this.params.io===ci.ho?(d("LruGarbageCollector","Garbage collection skipped; disabled"),mr.resolve(ai)):this.So(t).next(function(r){return r<n.params.io?(d("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.io),ai):n.Do(t,e)})},t.prototype.So=function(t){return this.Ao.So(t)},t.prototype.Do=function(t,e){var n,r,o,s,u,a,c,h=this,f=Date.now();return this.Ro(t,this.params.ro).next(function(e){return e>h.params.oo?(d("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.oo+" from "+e),r=h.params.oo):r=e,s=Date.now(),h.yo(t,r)}).next(function(r){return n=r,u=Date.now(),h.po(t,n,e)}).next(function(e){return o=e,a=Date.now(),h.bo(t,n)}).next(function(t){return c=Date.now(),p()<=i.LogLevel.DEBUG&&d("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+r+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),mr.resolve({Zr:!0,eo:r,no:o,so:t})})},t}();function li(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=di(e)),e=pi(t.get(n),e);return di(e)}function pi(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function di(t){return t+""}function vi(t){var e=t.length;if(w(e>=2),2===e)return w(""===t.charAt(0)&&""===t.charAt(1)),N.P();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&m(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:m()}o=s+2}return new N(r)}var yi=function(t){this.Co=t};function gi(t,e){if(e.document)return function(t,e,n){var r=xe(t,e.name),i=Ne(e.updateTime),o=new xn({mapValue:{fields:e.fields}});return new On(r,i,o,{hasCommittedMutations:!!n})}(t.Co,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=D.$(e.noDocument.path),r=Ii(e.noDocument.readTime);return new Pn(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=D.$(e.unknownDocument.path),o=Ii(e.unknownDocument.version);return new Vn(i,o)}return m()}function mi(t,e,n){var r=wi(n),i=e.key.path.h().A();if(e instanceof On){var o=function(t,e){return{name:De(t,e.key),fields:e.rn().mapValue.fields,updateTime:Ie(t,e.version.Z())}}(t.Co,e),s=e.hasCommittedMutations;return new Hi(null,null,o,s,r,i)}if(e instanceof Pn){var u=e.key.path.A(),a=bi(e.version),c=e.hasCommittedMutations;return new Hi(null,new Ki(u,a),null,c,r,i)}if(e instanceof Vn){var h=e.key.path.A(),f=bi(e.version);return new Hi(new Qi(h,f),null,null,!0,r,i)}return m()}function wi(t){var e=t.Z();return[e.seconds,e.nanoseconds]}function _i(t){var e=new ut(t[0],t[1]);return at.J(e)}function bi(t){var e=t.Z();return new ji(e.seconds,e.nanoseconds)}function Ii(t){var e=new ut(t.seconds,t.nanoseconds);return at.J(e)}function Ei(t,e){var n=(e.baseMutations||[]).map(function(e){return Ue(t.Co,e)}),r=e.mutations.map(function(e){return Ue(t.Co,e)}),i=ut.fromMillis(e.localWriteTimeMs);return new Zr(e.batchId,i,n,r)}function Ti(t){var e,n,r=Ii(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Ii(t.lastLimboFreeSnapshotVersion):at.min();return void 0!==t.query.documents?(w(1===(n=t.query).documents.length),e=Wn(Fn(ke(n.documents[0])))):e=Me(t.query),new wt(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Z.fromBase64String(t.resumeToken))}function Ni(t,e){var n,r=bi(e.nt),i=bi(e.lastLimboFreeSnapshotVersion);n=yt(e.target)?Ce(t.Co,e.target):Fe(t.Co,e.target);var o=e.resumeToken.toBase64();return new $i(e.targetId,dt(e.target),r,o,e.sequenceNumber,i,n)}var Ai=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.Dr=n,this.No=r,this.Fo={}}return t.xo=function(e,n,r,i){return w(""!==e.uid),new t(e.Zs()?e.uid:"",n,r,i)},t.prototype.$o=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return xi(t).rs({index:Bi.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.ko=function(t,e,n,r){var i=this,o=Li(t),s=xi(t);return s.add({}).next(function(u){w("number"==typeof u);for(var a=new Zr(u,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return Ve(t.Co,e)}),i=n.mutations.map(function(e){return Ve(t.Co,e)});return new Bi(e,n.batchId,n.ar.toMillis(),r,i)}(i.serializer,i.userId,a),h=[],f=new At(function(t,e){return $(t.R(),e.R())}),l=0,p=r;l<p.length;l++){var d=p[l],v=Wi.key(i.userId,d.key.path,u);f=f.add(d.key.path.h()),h.push(s.put(c)),h.push(o.put(v,Wi.PLACEHOLDER))}return f.forEach(function(e){h.push(i.Dr.Mo(t,e))}),t.pr(function(){i.Fo[u]=a.keys()}),mr.$n(h).next(function(){return a})})},t.prototype.Oo=function(t,e){var n=this;return xi(t).get(e).next(function(t){return t?(w(t.userId===n.userId),Ei(n.serializer,t)):null})},t.prototype.Lo=function(t,e){var n=this;return this.Fo[e]?mr.resolve(this.Fo[e]):this.Oo(t,e).next(function(t){if(t){var r=t.keys();return n.Fo[e]=r,r}return null})},t.prototype.Bo=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return xi(t).rs({index:Bi.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(w(e.batchId>=r),o=Ei(n.serializer,e)),i.done()}).next(function(){return o})},t.prototype.qo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return xi(t).rs({index:Bi.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.Uo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return xi(t).ts(Bi.userMutationsIndex,n).next(function(t){return t.map(function(t){return Ei(e.serializer,t)})})},t.prototype.Nr=function(t,e){var n=this,r=Wi.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Li(t).rs({range:i},function(r,i,s){var u=r[0],a=r[1],c=r[2],h=vi(a);if(u===n.userId&&e.path.isEqual(h))return xi(t).get(c).next(function(t){if(!t)throw m();w(t.userId===n.userId),o.push(Ei(n.serializer,t))});s.done()}).next(function(){return o})},t.prototype.Or=function(t,e){var n=this,r=new At($),i=[];return e.forEach(function(e){var o=Wi.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=Li(t).rs({range:s},function(t,i,o){var s=t[0],u=t[1],a=t[2],c=vi(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()});i.push(u)}),mr.$n(i).next(function(){return n.Qo(t,r)})},t.prototype.Wr=function(t,e){var n=this,r=e.path,i=r.length+1,o=Wi.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new At($);return Li(t).rs({range:s},function(t,e,o){var s=t[0],a=t[1],c=t[2],h=vi(a);s===n.userId&&r.T(h)?h.length===i&&(u=u.add(c)):o.done()}).next(function(){return n.Qo(t,u)})},t.prototype.Qo=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(xi(t).get(e).next(function(t){if(null===t)throw m();w(t.userId===n.userId),r.push(Ei(n.serializer,t))}))}),mr.$n(i).next(function(){return r})},t.prototype.Wo=function(t,e){var n=this;return Di(t.jo,this.userId,e).next(function(r){return t.pr(function(){n.Ko(e.batchId)}),mr.forEach(r,function(e){return n.No.Go(t,e)})})},t.prototype.Ko=function(t){delete this.Fo[t]},t.prototype.zo=function(t){var e=this;return this.$o(t).next(function(n){if(!n)return mr.resolve();var r=IDBKeyRange.lowerBound(Wi.prefixForUser(e.userId)),i=[];return Li(t).rs({range:r},function(t,n,r){if(t[0]===e.userId){var o=vi(t[1]);i.push(o)}else r.done()}).next(function(){w(0===i.length)})})},t.prototype.Ho=function(t,e){return Si(t,this.userId,e)},t.prototype.Yo=function(t){var e=this;return ki(t).get(this.userId).next(function(t){return t||new zi(e.userId,-1,"")})},t}();function Si(t,e,n){var r=Wi.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Li(t).rs({range:o,ss:!0},function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()}).next(function(){return s})}function Di(t,e,n){var r=t.store(Bi.store),i=t.store(Wi.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.rs({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){w(1===u)}));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Wi.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return mr.$n(o).next(function(){return c})}function xi(t){return lo.Qn(t,Bi.store)}function Li(t){return lo.Qn(t,Wi.store)}function ki(t){return lo.Qn(t,zi.store)}var Ri=function(){function t(t,e){this.serializer=t,this.Dr=e}return t.prototype.Er=function(t,e,n){return Vi(t).put(Ui(e),n)},t.prototype.Ar=function(t,e){var n=Vi(t),r=Ui(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.Jo(t,r)})},t.prototype.Rr=function(t,e){var n=this;return Vi(t).get(Ui(e)).next(function(t){return n.Xo(t)})},t.prototype.Zo=function(t,e){var n=this;return Vi(t).get(Ui(e)).next(function(t){var e=n.Xo(t);return e?{ta:e,size:Ci(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=Lt();return this.ea(t,e,function(t,e){var i=n.Xo(e);r=r.ot(t,i)}).next(function(){return r})},t.prototype.na=function(t,e){var n=this,r=Lt(),i=new Et(D.i);return this.ea(t,e,function(t,e){var o=n.Xo(e);o?(r=r.ot(t,o),i=i.ot(t,Ci(e))):(r=r.ot(t,null),i=i.ot(t,0))}).next(function(){return{sa:r,ia:i}})},t.prototype.ea=function(t,e,n){if(e.m())return mr.resolve();var r=IDBKeyRange.bound(e.first().path.A(),e.last().path.A()),i=e._t(),o=i.It();return Vi(t).rs({range:r},function(t,e,r){for(var s=D.$(t);o&&D.i(o,s)<0;)n(o,null),o=i.It();o&&o.isEqual(s)&&(n(o,e),o=i.At()?i.It():null),o?r.Xn(o.path.A()):r.done()}).next(function(){for(;o;)n(o,null),o=i.At()?i.It():null})},t.prototype.Lr=function(t,e,n){var r=this,i=Rt(),o=e.path.length+1,s={};if(n.isEqual(at.min())){var u=e.path.A();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.A(),c=wi(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=Hi.collectionReadTimeIndex}return Vi(t).rs(s,function(t,n,s){if(t.length===o){var u=gi(r.serializer,n);e.path.T(u.key.path)?u instanceof On&&Jn(e,u)&&(i=i.ot(u.key,u)):s.done()}}).next(function(){return i})},t.prototype.ra=function(t){return new Oi(this,!!t&&t.oa)},t.prototype.aa=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Pi(t).get(Yi.key).next(function(t){return w(!!t),t})},t.prototype.Jo=function(t,e){return Pi(t).put(Yi.key,e)},t.prototype.Xo=function(t){if(t){var e=gi(this.serializer,t);return e instanceof Pn&&e.version.isEqual(at.min())?null:e}return null},t}(),Oi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).ca=e,r.oa=n,r.ua=new st(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return n.__extends(e,t),e.prototype.yr=function(t){var e=this,n=[],r=0,i=new At(function(t,e){return $(t.R(),e.R())});return this.wr.forEach(function(o,s){var u=e.ua.get(o);if(s){var a=mi(e.ca.serializer,s,e.readTime);i=i.add(o.path.h());var c=Ci(a);r+=c-u,n.push(e.ca.Er(t,o,a))}else if(r-=u,e.oa){var h=mi(e.ca.serializer,new Pn(o,at.min()),e.readTime);n.push(e.ca.Er(t,o,h))}else n.push(e.ca.Ar(t,o))}),i.forEach(function(r){n.push(e.ca.Dr.Mo(t,r))}),n.push(this.ca.updateMetadata(t,r)),mr.$n(n)},e.prototype.gr=function(t,e){var n=this;return this.ca.Zo(t,e).next(function(t){return null===t?(n.ua.set(e,0),null):(n.ua.set(e,t.size),t.ta)})},e.prototype.Pr=function(t,e){var n=this;return this.ca.na(t,e).next(function(t){var e=t.sa;return t.ia.forEach(function(t,e){n.ua.set(t,e)}),e})},e}(ei);function Pi(t){return lo.Qn(t,Yi.store)}function Vi(t){return lo.Qn(t,Hi.store)}function Ui(t){return t.path.A()}function Ci(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw m();e=t.noDocument}return JSON.stringify(e).length}var Fi=function(){function t(){this.ha=new Mi}return t.prototype.Mo=function(t,e){return this.ha.add(e),mr.resolve()},t.prototype.Qr=function(t,e){return mr.resolve(this.ha.getEntries(e))},t}(),Mi=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t._(),n=t.h(),r=this.index[e]||new At(N.i),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t._(),n=t.h(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new At(N.i)).A()},t}(),qi=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;w(n<r&&n>=0&&r<=10);var o=new Er("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Gi.store)}(t),function(t){t.createObjectStore(zi.store,{keyPath:zi.keyPath}),t.createObjectStore(Bi.store,{keyPath:Bi.keyPath,autoIncrement:!0}).createIndex(Bi.userMutationsIndex,Bi.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Wi.store)}(t),to(t),function(t){t.createObjectStore(Hi.store)}(t));var s=mr.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Xi.store),t.deleteObjectStore($i.store),t.deleteObjectStore(Ji.store)}(t),to(t)),s=s.next(function(){return t=o.store(Ji.store),e=new Ji(0,0,at.min().Z(),0),t.put(Ji.key,e);var t,e})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(Bi.store).ts().next(function(n){t.deleteObjectStore(Bi.store),t.createObjectStore(Bi.store,{keyPath:Bi.keyPath,autoIncrement:!0}).createIndex(Bi.userMutationsIndex,Bi.userMutationsKeyPath,{unique:!0});var r=e.store(Bi.store),i=n.map(function(t){return r.put(t)});return mr.$n(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(eo.store,{keyPath:eo.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.removeAcknowledgedMutations(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(Yi.store)}(t),i.addDocumentGlobal(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ensureSequenceNumbers(o)})),n<8&&r>=8&&(s=s.next(function(){return i.createCollectionParentIndex(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Hi.store);e.createIndex(Hi.readTimeIndex,Hi.readTimeIndexPath,{unique:!1}),e.createIndex(Hi.collectionReadTimeIndex,Hi.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.rewriteCanonicalIds(o)})),s},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Hi.store).rs(function(t,n){e+=Ci(n)}).next(function(){var n=new Yi(e);return t.store(Yi.store).put(Yi.key,n)})},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(zi.store),r=t.store(Bi.store);return n.ts().next(function(n){return mr.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.ts(Bi.userMutationsIndex,i).next(function(r){return mr.forEach(r,function(r){w(r.userId===n.userId);var i=Ei(e.serializer,r);return Di(t,n.userId,i).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Xi.store),n=t.store(Hi.store);return t.store(Ji.store).get(Ji.key).next(function(t){var r=[];return n.rs(function(n,i){var o=new N(n),s=[0,li(o)];r.push(e.get(s).next(function(n){return n?mr.resolve():function(n){return e.put(new Xi(0,li(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return mr.$n(r)})})},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Zi.store,{keyPath:Zi.keyPath});var n=e.store(Zi.store),r=new Mi,i=function(t){if(r.add(t)){var e=t._(),i=t.h();return n.put({collectionId:e,parent:li(i)})}};return e.store(Hi.store).rs({ss:!0},function(t,e){var n=new N(t);return i(n.h())}).next(function(){return e.store(Wi.store).rs({ss:!0},function(t,e){t[0];var n=t[1],r=(t[2],vi(n));return i(r.h())})})},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store($i.store);return n.rs(function(t,r){var i=Ti(r),o=Ni(e.serializer,i);return n.put(o)})},t}(),ji=function(t,e){this.seconds=t,this.nanoseconds=e},Gi=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Gi.store="owner",Gi.key="owner";var zi=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};zi.store="mutationQueues",zi.keyPath="userId";var Bi=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Bi.store="mutations",Bi.keyPath="batchId",Bi.userMutationsIndex="userMutationsIndex",Bi.userMutationsKeyPath=["userId","batchId"];var Wi=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,li(e)]},t.key=function(t,e,n){return[t,li(e),n]},t}();Wi.store="documentMutations",Wi.PLACEHOLDER=new Wi;var Ki=function(t,e){this.path=t,this.readTime=e},Qi=function(t,e){this.path=t,this.version=e},Hi=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Hi.store="remoteDocuments",Hi.readTimeIndex="readTimeIndex",Hi.readTimeIndexPath="readTime",Hi.collectionReadTimeIndex="collectionReadTimeIndex",Hi.collectionReadTimeIndexPath=["parentPath","readTime"];var Yi=function(t){this.byteSize=t};Yi.store="remoteDocumentGlobal",Yi.key="remoteDocumentGlobalKey";var $i=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};$i.store="targets",$i.keyPath="targetId",$i.queryTargetsIndexName="queryTargetsIndex",$i.queryTargetsKeyPath=["canonicalId","targetId"];var Xi=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Xi.store="targetDocuments",Xi.keyPath=["targetId","path"],Xi.documentTargetsIndex="documentTargetsIndex",Xi.documentTargetsKeyPath=["path","targetId"];var Ji=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ji.key="targetGlobalKey",Ji.store="targetGlobal";var Zi=function(t,e){this.collectionId=t,this.parent=e};function to(t){t.createObjectStore(Xi.store,{keyPath:Xi.keyPath}).createIndex(Xi.documentTargetsIndex,Xi.documentTargetsKeyPath,{unique:!0}),t.createObjectStore($i.store,{keyPath:$i.keyPath}).createIndex($i.queryTargetsIndexName,$i.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ji.store)}Zi.store="collectionParents",Zi.keyPath=["collectionId","parent"];var eo=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};eo.store="clientMetadata",eo.keyPath="clientId";var no=n.__spreadArrays(n.__spreadArrays(n.__spreadArrays([zi.store,Bi.store,Wi.store,Hi.store,$i.store,Gi.store,Ji.store,Xi.store],[eo.store]),[Yi.store]),[Zi.store]),ro=function(){function t(){this.la=new Mi}return t.prototype.Mo=function(t,e){var n=this;if(!this.la.has(e)){var r=e._(),i=e.h();t.pr(function(){n.la.add(e)});var o={collectionId:r,parent:li(i)};return io(t).put(o)}return mr.resolve()},t.prototype.Qr=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[J(e),""],!1,!0);return io(t).ts(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(vi(o.parent))}return n})},t}();function io(t){return lo.Qn(t,Zi.store)}var oo=function(){function t(t){this._a=t}return t.prototype.next=function(){return this._a+=2,this._a},t.fa=function(){return new t(0)},t.da=function(){return new t(-1)},t}(),so=function(){function t(t,e){this.No=t,this.serializer=e}return t.prototype.wa=function(t){var e=this;return this.ma(t).next(function(n){var r=new oo(n.highestTargetId);return n.highestTargetId=r.next(),e.Ta(t,n).next(function(){return n.highestTargetId})})},t.prototype.Ea=function(t){return this.ma(t).next(function(t){return at.J(new ut(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.Ia=function(t){return this.ma(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.Aa=function(t,e,n){var r=this;return this.ma(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.Z()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Ta(t,i)})},t.prototype.Ra=function(t,e){var n=this;return this.ga(t,e).next(function(){return n.ma(t).next(function(r){return r.targetCount+=1,n.Pa(e,r),n.Ta(t,r)})})},t.prototype.ya=function(t,e){return this.ga(t,e)},t.prototype.Va=function(t,e){var n=this;return this.pa(t,e.targetId).next(function(){return uo(t).delete(e.targetId)}).next(function(){return n.ma(t)}).next(function(e){return w(e.targetCount>0),e.targetCount-=1,n.Ta(t,e)})},t.prototype.po=function(t,e,n){var r=this,i=0,o=[];return uo(t).rs(function(s,u){var a=Ti(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.Va(t,a)))}).next(function(){return mr.$n(o)}).next(function(){return i})},t.prototype.Ce=function(t,e){return uo(t).rs(function(t,n){var r=Ti(n);e(r)})},t.prototype.ma=function(t){return ao(t).get(Ji.key).next(function(t){return w(null!==t),t})},t.prototype.Ta=function(t,e){return ao(t).put(Ji.key,e)},t.prototype.ga=function(t,e){return uo(t).put(Ni(this.serializer,e))},t.prototype.Pa=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.ba=function(t){return this.ma(t).next(function(t){return t.targetCount})},t.prototype.va=function(t,e){var n=dt(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return uo(t).rs({range:r,index:$i.queryTargetsIndexName},function(t,n,r){var o=Ti(n);vt(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.Sa=function(t,e,n){var r=this,i=[],o=co(t);return e.forEach(function(e){var s=li(e.path);i.push(o.put(new Xi(n,s))),i.push(r.No.Da(t,n,e))}),mr.$n(i)},t.prototype.Ca=function(t,e,n){var r=this,i=co(t);return mr.forEach(e,function(e){var o=li(e.path);return mr.$n([i.delete([n,o]),r.No.Na(t,n,e)])})},t.prototype.pa=function(t,e){var n=co(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.Fa=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=co(t),i=Vt();return r.rs({range:n,ss:!0},function(t,e,n){var r=vi(t[1]),o=new D(r);i=i.add(o)}).next(function(){return i})},t.prototype.Ho=function(t,e){var n=li(e.path),r=IDBKeyRange.bound([n],[J(n)],!1,!0),i=0;return co(t).rs({index:Xi.documentTargetsIndex,ss:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return i>0})},t.prototype.Ue=function(t,e){return uo(t).get(e).next(function(t){return t?Ti(t):null})},t}();function uo(t){return lo.Qn(t,$i.store)}function ao(t){return lo.Qn(t,Ji.store)}function co(t){return lo.Qn(t,Xi.store)}var ho="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",fo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jo=e,r.xa=n,r}return n.__extends(e,t),e}(ri),lo=function(){function t(e,n,r,i,o,s,u,a,c,l){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.fn=o,this.window=s,this.document=u,this.$a=c,this.ka=l,this.Ma=null,this.Oa=!1,this.isPrimary=!1,this.networkEnabled=!0,this.La=null,this.inForeground=!1,this.Ba=null,this.qa=null,this.Ua=Number.NEGATIVE_INFINITY,this.Qa=function(t){return Promise.resolve()},!t.Ln())throw new f(h.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.No=new yo(this,i),this.Wa=n+"main",this.serializer=new yi(a),this.ja=new wr(this.Wa,10,new qi(this.serializer)),this.Ka=new so(this.No,this.serializer),this.Dr=new ro,this.vr=function(t,e){return new Ri(t,e)}(this.serializer,this.Dr),this.window&&this.window.localStorage?this.Ga=this.window.localStorage:(this.Ga=null,!1===l&&v("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.Qn=function(t,e){if(t instanceof fo)return wr.Qn(t.jo,e);throw m()},t.prototype.start=function(){var t=this;return this.za().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new f(h.FAILED_PRECONDITION,ho);return t.Ha(),t.Ya(),t.Ja(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.Ka.Ia(e)})}).then(function(e){t.Ma=new Gr(e,t.$a)}).then(function(){t.Oa=!0}).catch(function(e){return t.ja&&t.ja.close(),Promise.reject(e)})},t.prototype.Xa=function(t){var e=this;return this.Qa=function(r){return n.__awaiter(e,void 0,void 0,function(){return n.__generator(this,function(e){return this.Ei?[2,t(r)]:[2]})})},t(this.isPrimary)},t.prototype.Za=function(t){var e=this;this.ja.Kn(function(r){return n.__awaiter(e,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return null===r.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.tc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.fn.ws(function(){return n.__awaiter(e,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return this.Ei?[4,this.za()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.za=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return vo(e).put(new eo(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.ec(e).next(function(e){e||(t.isPrimary=!1,t.fn.Cs(function(){return t.Qa(!1)}))})}).next(function(){return t.nc(e)}).next(function(n){return t.isPrimary&&!n?t.sc(e).next(function(){return!1}):!!n&&t.ic(e).next(function(){return!0})})}).catch(function(e){if(Ir(e))return d("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return d("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.fn.Cs(function(){return t.Qa(e)}),t.isPrimary=e})},t.prototype.ec=function(t){var e=this;return po(t).get(Gi.key).next(function(t){return mr.resolve(e.rc(t))})},t.prototype.oc=function(t){return vo(t).delete(this.clientId)},t.prototype.ac=function(){return n.__awaiter(this,void 0,void 0,function(){var e,r,i,o,s=this;return n.__generator(this,function(n){switch(n.label){case 0:return!this.isPrimary||this.cc(this.Ua,18e5)?[3,2]:(this.Ua=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(e){var n=t.Qn(e,eo.store);return n.ts().next(function(t){var e=s.uc(t,18e5),r=t.filter(function(t){return-1===e.indexOf(t)});return mr.forEach(r,function(t){return n.delete(t.clientId)}).next(function(){return r})})}).catch(function(){return[]})]);case 1:if(e=n.sent(),this.Ga)for(r=0,i=e;r<i.length;r++)o=i[r],this.Ga.removeItem(this.hc(o.clientId));n.label=2;case 2:return[2]}})})},t.prototype.Ja=function(){var t=this;this.qa=this.fn.yn("client_metadata_refresh",4e3,function(){return t.za().then(function(){return t.ac()}).then(function(){return t.Ja()})})},t.prototype.rc=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.nc=function(t){var e=this;return this.ka?mr.resolve(!0):po(t).get(Gi.key).next(function(n){if(null!==n&&e.cc(n.leaseTimestampMs,5e3)&&!e.lc(n.ownerId)){if(e.rc(n)&&e.networkEnabled)return!0;if(!e.rc(n)){if(!n.allowTabSynchronization)throw new f(h.FAILED_PRECONDITION,ho);return!1}}return!(!e.networkEnabled||!e.inForeground)||vo(t).ts().next(function(t){return void 0===e.uc(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&d("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.Di=function(){return n.__awaiter(this,void 0,void 0,function(){var t=this;return n.__generator(this,function(e){switch(e.label){case 0:return this.Oa=!1,this._c(),this.qa&&(this.qa.cancel(),this.qa=null),this.fc(),this.dc(),[4,this.ja.runTransaction("shutdown","readwrite",[Gi.store,eo.store],function(e){var n=new fo(e,Gr.ai);return t.sc(n).next(function(){return t.oc(n)})})];case 1:return e.sent(),this.ja.close(),this.wc(),[2]}})})},t.prototype.uc=function(t,e){var n=this;return t.filter(function(t){return n.cc(t.updateTimeMs,e)&&!n.lc(t.clientId)})},t.prototype.pi=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return vo(e).ts().next(function(e){return t.uc(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"Ei",{get:function(){return this.Oa},enumerable:!1,configurable:!0}),t.prototype.mc=function(t){return Ai.xo(t,this.serializer,this.Dr,this.No)},t.prototype.Tc=function(){return this.Ka},t.prototype.Ec=function(){return this.vr},t.prototype.Ic=function(){return this.Dr},t.prototype.runTransaction=function(t,e,n){var r=this;d("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.ja.runTransaction(t,o,no,function(o){return i=new fo(o,r.Ma?r.Ma.next():Gr.ai),"readwrite-primary"===e?r.ec(i).next(function(t){return!!t||r.nc(i)}).next(function(e){if(!e)throw v("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.fn.Cs(function(){return r.Qa(!1)}),new f(h.FAILED_PRECONDITION,ni);return n(i)}).next(function(t){return r.ic(i).next(function(){return t})}):r.Ac(i).next(function(){return n(i)})}).then(function(t){return i.br(),t})},t.prototype.Ac=function(t){var e=this;return po(t).get(Gi.key).next(function(t){if(null!==t&&e.cc(t.leaseTimestampMs,5e3)&&!e.lc(t.ownerId)&&!e.rc(t)&&!(e.ka||e.allowTabSynchronization&&t.allowTabSynchronization))throw new f(h.FAILED_PRECONDITION,ho)})},t.prototype.ic=function(t){var e=new Gi(this.clientId,this.allowTabSynchronization,Date.now());return po(t).put(Gi.key,e)},t.Ln=function(){return wr.Ln()},t.prototype.sc=function(t){var e=this,n=po(t);return n.get(Gi.key).next(function(t){return e.rc(t)?(d("IndexedDbPersistence","Releasing primary lease."),n.delete(Gi.key)):mr.resolve()})},t.prototype.cc=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(v("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.Ha=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ba=function(){t.fn.ws(function(){return t.inForeground="visible"===t.document.visibilityState,t.za()})},this.document.addEventListener("visibilitychange",this.Ba),this.inForeground="visible"===this.document.visibilityState)},t.prototype.fc=function(){this.Ba&&(this.document.removeEventListener("visibilitychange",this.Ba),this.Ba=null)},t.prototype.Ya=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.La=function(){e._c(),e.fn.ws(function(){return e.Di()})},this.window.addEventListener("unload",this.La))},t.prototype.dc=function(){this.La&&(this.window.removeEventListener("unload",this.La),this.La=null)},t.prototype.lc=function(t){var e;try{var n=null!==(null===(e=this.Ga)||void 0===e?void 0:e.getItem(this.hc(t)));return d("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return v("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype._c=function(){if(this.Ga)try{this.Ga.setItem(this.hc(this.clientId),String(Date.now()))}catch(n){v("Failed to set zombie client id.",n)}},t.prototype.wc=function(){if(this.Ga)try{this.Ga.removeItem(this.hc(this.clientId))}catch(n){}},t.prototype.hc=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function po(t){return lo.Qn(t,Gi.store)}function vo(t){return lo.Qn(t,eo.store)}var yo=function(){function t(t,e){this.db=t,this.wo=new fi(this,e)}return t.prototype.Po=function(t){var e=this.Rc(t);return this.db.Tc().ba(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.Rc=function(t){var e=0;return this.Vo(t,function(t){e++}).next(function(){return e})},t.prototype.Ce=function(t,e){return this.db.Tc().Ce(t,e)},t.prototype.Vo=function(t,e){return this.gc(t,function(t,n){return e(n)})},t.prototype.Da=function(t,e,n){return go(t,n)},t.prototype.Na=function(t,e,n){return go(t,n)},t.prototype.po=function(t,e,n){return this.db.Tc().po(t,e,n)},t.prototype.Go=function(t,e){return go(t,e)},t.prototype.Pc=function(t,e){return function(t,e){var n=!1;return ki(t).os(function(r){return Si(t,r,e).next(function(t){return t&&(n=!0),mr.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.bo=function(t,e){var n=this,r=this.db.Ec().ra(),i=[],o=0;return this.gc(t,function(s,u){if(u<=e){var a=n.Pc(t,s).next(function(e){if(!e)return o++,r.Rr(t,s).next(function(){return r.Ar(s),co(t).delete([0,li(s.path)])})});i.push(a)}}).next(function(){return mr.$n(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.st(t.xa);return this.db.Tc().ya(t,n)},t.prototype.yc=function(t,e){return go(t,e)},t.prototype.gc=function(t,e){var n,r=co(t),i=Gr.ai;return r.rs({index:Xi.documentTargetsIndex},function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==Gr.ai&&e(new D(vi(n)),i),i=u,n=s):i=Gr.ai}).next(function(){i!==Gr.ai&&e(new D(vi(n)),i)})},t.prototype.So=function(t){return this.db.Ec().aa(t)},t}();function go(t,e){return co(t).put(function(t,e){return new Xi(0,li(t.path),e)}(e,t.xa))}function mo(t,e){var n=t.projectId;return t.j||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var wo=function(){function t(t,e,n){this.persistence=t,this.Vc=e,this.bc=new Et($),this.vc=new st(function(t){return dt(t)},vt),this.Sc=at.min(),this.Sr=t.mc(n),this.Dc=t.Ec(),this.Ka=t.Tc(),this.Cc=new ii(this.Dc,this.Sr,this.persistence.Ic()),this.Vc.Nc(this.Cc)}return t.prototype.Io=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.vo(n,e.bc)})},t}();function _o(t,e){var n=_(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.Dc.ra({oa:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=mr.resolve();return o.forEach(function(t){s=s.next(function(){return r.Rr(e,t)}).next(function(e){var o=e,s=n.dr.get(t);w(null!==s),(!o||o.version.L(s)<0)&&(o=i.cr(t,o,n))&&r.Er(o,n._r)})}),s.next(function(){return t.Sr.Wo(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n.Sr.zo(t)}).next(function(){return n.Cc.kr(t,r)})})}function bo(t){var e=_(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Ka.Ea(t)})}function Io(t,e){var n=_(t),r=e.nt,i=n.bc;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.Dc.ra({oa:!0});i=n.bc;var s=[];e.zt.forEach(function(e,o){var u=i.get(o);if(u){s.push(n.Ka.Ca(t,e.se,o).next(function(){return n.Ka.Sa(t,e.ee,o)}));var a=e.resumeToken;if(a.O()>0){var c=u.it(a,r).st(t.xa);i=i.ot(o,c),function(t,e,n){return w(e.resumeToken.O()>0),0===t.resumeToken.O()||e.nt.X()-t.nt.X()>=3e8||n.ee.size+n.ne.size+n.se.size>0}(u,c,e)&&s.push(n.Ka.ya(t,c))}}});var u=xt(),a=Vt();if(e.Yt.forEach(function(t,e){a=a.add(t)}),s.push(o.getEntries(t,a).next(function(i){e.Yt.forEach(function(a,c){var h=i.get(a);c instanceof Pn&&c.version.isEqual(at.min())?(o.Ar(a,r),u=u.ot(a,c)):null==h||c.version.L(h.version)>0||0===c.version.L(h.version)&&h.hasPendingWrites?(o.Er(c,r),u=u.ot(a,c)):d("LocalStore","Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",c.version),e.Jt.has(a)&&s.push(n.persistence.No.yc(t,a))})})),!r.isEqual(at.min())){var c=n.Ka.Ea(t).next(function(e){return n.Ka.Aa(t,t.xa,r)});s.push(c)}return mr.$n(s).next(function(){return o.apply(t)}).next(function(){return n.Cc.Mr(t,u)})}).then(function(t){return n.bc=i,t})}function Eo(t,e){var n=_(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.Sr.Bo(t,e)})}function To(t,e){var n=_(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.Ka.va(t,e).next(function(i){return i?(r=i,mr.resolve(r)):n.Ka.wa(t).next(function(i){return r=new wt(e,i,0,t.xa),n.Ka.Ra(t,r).next(function(){return r})})})}).then(function(t){var r=n.bc.get(t.targetId);return(null===r||t.nt.L(r.nt)>0)&&(n.bc=n.bc.ot(t.targetId,t),n.vc.set(e,t.targetId)),t})}function No(t,e,r){return n.__awaiter(this,void 0,void 0,function(){var i,o,s,u;return n.__generator(this,function(n){switch(n.label){case 0:i=_(t),o=i.bc.get(e),s=r?"readwrite":"readwrite-primary",n.label=1;case 1:return n.trys.push([1,4,,5]),r?[3,3]:[4,i.persistence.runTransaction("Release target",s,function(t){return i.persistence.No.removeTarget(t,o)})];case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:if(!Ir(u=n.sent()))throw u;return d("LocalStore","Failed to update sequence numbers for target "+e+": "+u),[3,5];case 5:return i.bc=i.bc.remove(e),i.vc.delete(o.target),[2]}})})}function Ao(t,e,n){var r=_(t),i=at.min(),o=Vt();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=_(t),i=r.vc.get(n);return void 0!==i?mr.resolve(r.bc.get(i)):r.Ka.va(e,n)}(r,t,Wn(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.Ka.Fa(t,e.targetId).next(function(t){o=t})}).next(function(){return r.Vc.Lr(t,e,n?i:at.min(),n?o:Vt())}).next(function(t){return{documents:t,Fc:o}})})}function So(t,e){var n=_(t),r=_(n.Ka),i=n.bc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Ue(t,e).next(function(t){return t?t.target:null})})}function Do(t){var e=_(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=_(t),i=xt(),o=wi(n),s=Vi(e),u=IDBKeyRange.lowerBound(o,!0);return s.rs({index:Hi.readTimeIndex,range:u},function(t,e){var n=gi(r.serializer,e);i=i.ot(n.key,n),o=e.readTime}).next(function(){return{xc:i,readTime:_i(o)}})}(e.Dc,t,e.Sc)}).then(function(t){var n=t.xc,r=t.readTime;return e.Sc=r,n})}function xo(t){return n.__awaiter(this,void 0,void 0,function(){var e;return n.__generator(this,function(n){return[2,(e=_(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=Vi(t),n=at.min();return e.rs({index:Hi.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=_i(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.Sc=t})]})})}function Lo(t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){if(t.code!==h.FAILED_PRECONDITION||t.message!==ni)throw t;return d("LocalStore","Unexpectedly lost primary lease"),[2]})})}var ko=function(){function t(){this.$c=new At(Ro.kc),this.Mc=new At(Ro.Oc)}return t.prototype.m=function(){return this.$c.m()},t.prototype.Da=function(t,e){var n=new Ro(t,e);this.$c=this.$c.add(n),this.Mc=this.Mc.add(n)},t.prototype.Lc=function(t,e){var n=this;t.forEach(function(t){return n.Da(t,e)})},t.prototype.Na=function(t,e){this.Bc(new Ro(t,e))},t.prototype.qc=function(t,e){var n=this;t.forEach(function(t){return n.Na(t,e)})},t.prototype.Uc=function(t){var e=this,n=new D(new N([])),r=new Ro(n,t),i=new Ro(n,t+1),o=[];return this.Mc.Ft([r,i],function(t){e.Bc(t),o.push(t.key)}),o},t.prototype.Qc=function(){var t=this;this.$c.forEach(function(e){return t.Bc(e)})},t.prototype.Bc=function(t){this.$c=this.$c.delete(t),this.Mc=this.Mc.delete(t)},t.prototype.Wc=function(t){var e=new D(new N([])),n=new Ro(e,t),r=new Ro(e,t+1),i=Vt();return this.Mc.Ft([n,r],function(t){i=i.add(t.key)}),i},t.prototype.Ho=function(t){var e=new Ro(t,0),n=this.$c.$t(e);return null!==n&&t.isEqual(n.key)},t}(),Ro=function(){function t(t,e){this.key=t,this.jc=e}return t.kc=function(t,e){return D.i(t.key,e.key)||$(t.jc,e.jc)},t.Oc=function(t,e){return $(t.jc,e.jc)||D.i(t.key,e.key)},t}(),Oo=function(t,e){this.user=e,this.type="OAuth",this.Kc={},this.Kc.Authorization="Bearer "+t},Po=function(){function t(){this.Gc=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.zc=function(){},t.prototype.Hc=function(t){this.Gc=t,t(jr.UNAUTHENTICATED)},t.prototype.Yc=function(){this.Gc=null},t}(),Vo=function(){function t(t){var e=this;this.Jc=null,this.currentUser=jr.UNAUTHENTICATED,this.Xc=!1,this.Zc=0,this.Gc=null,this.forceRefresh=!1,this.Jc=function(){e.Zc++,e.currentUser=e.tu(),e.Xc=!0,e.Gc&&e.Gc(e.currentUser)},this.Zc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Jc):(this.Jc(null),t.get().then(function(t){e.auth=t,e.Jc&&e.auth.addAuthTokenListener(e.Jc)},function(){}))}return t.prototype.getToken=function(){var t=this,e=this.Zc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.Zc!==e?(d("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(w("string"==typeof n.accessToken),new Oo(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.zc=function(){this.forceRefresh=!0},t.prototype.Hc=function(t){this.Gc=t,this.Xc&&t(this.currentUser)},t.prototype.Yc=function(){this.auth&&this.auth.removeAuthTokenListener(this.Jc),this.Jc=null,this.Gc=null},t.prototype.tu=function(){var t=this.auth&&this.auth.getUid();return w(null===t||"string"==typeof t),new jr(t)},t}(),Uo=function(){function t(t,e){this.eu=t,this.nu=e,this.type="FirstParty",this.user=jr.ni}return Object.defineProperty(t.prototype,"Kc",{get:function(){var t={"X-Goog-AuthUser":this.nu},e=this.eu.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),Co=function(){function t(t,e){this.eu=t,this.nu=e}return t.prototype.getToken=function(){return Promise.resolve(new Uo(this.eu,this.nu))},t.prototype.Hc=function(t){t(jr.ni)},t.prototype.Yc=function(){},t.prototype.zc=function(){},t}(),Fo=function(){function t(t,e,n,r,i,o){this.fn=t,this.su=n,this.iu=r,this.ru=i,this.listener=o,this.state=0,this.ou=0,this.au=null,this.stream=null,this.ys=new gr(t,e)}return t.prototype.cu=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.uu=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.hu()},t.prototype.stop=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return this.cu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.lu=function(){this.state=0,this.ys.reset()},t.prototype._u=function(){var t=this;this.uu()&&null===this.au&&(this.au=this.fn.yn(this.su,6e4,function(){return t.fu()}))},t.prototype.du=function(t){this.wu(),this.stream.send(t)},t.prototype.fu=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){return this.uu()?[2,this.close(0)]:[2]})})},t.prototype.wu=function(){this.au&&(this.au.cancel(),this.au=null)},t.prototype.close=function(t,e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return this.wu(),this.ys.cancel(),this.ou++,3!==t?this.ys.reset():e&&e.code===h.RESOURCE_EXHAUSTED?(v(e.toString()),v("Using maximum backoff delay to prevent overloading the backend."),this.ys.Rn()):e&&e.code===h.UNAUTHENTICATED&&this.ru.zc(),null!==this.stream&&(this.mu(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Tu(e)];case 1:return n.sent(),[2]}})})},t.prototype.mu=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.Eu(this.ou),n=this.ou;this.ru.getToken().then(function(e){t.ou===n&&t.Iu(e)},function(n){e(function(){var e=new f(h.UNKNOWN,"Fetching auth token failed: "+n.message);return t.Au(e)})})},t.prototype.Iu=function(t){var e=this,n=this.Eu(this.ou);this.stream=this.Ru(t),this.stream.gu(function(){n(function(){return e.state=2,e.listener.gu()})}),this.stream.Tu(function(t){n(function(){return e.Au(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.hu=function(){var t=this;this.state=4,this.ys.gn(function(){return n.__awaiter(t,void 0,void 0,function(){return n.__generator(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.Au=function(t){return d("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.Eu=function(t){var e=this;return function(n){e.fn.ws(function(){return e.ou===t?n():(d("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Mo=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).serializer=i,s}return n.__extends(e,t),e.prototype.Ru=function(t){return this.iu.Pu("Listen",t)},e.prototype.onMessage=function(t){this.ys.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:m()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Qe?(w(void 0===e||"string"==typeof e),Z.fromBase64String(e||"")):(w(void 0===e||e instanceof Uint8Array),Z.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,u=s&&function(t){var e=void 0===t.code?h.UNKNOWN:It(t.code);return new f(e,t.message||"")}(s);n=new Wt(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;var a=e.documentChange;a.document,a.document.name,a.document.updateTime;var c=xe(t,a.document.name),l=Ne(a.document.updateTime),p=new xn({mapValue:{fields:a.document.fields}}),d=new On(c,l,p,{}),v=a.targetIds||[],y=a.removedTargetIds||[];n=new zt(v,y,d.key,d)}else if("documentDelete"in e){e.documentDelete;var g=e.documentDelete;g.document;var _=xe(t,g.document),b=g.readTime?Ne(g.readTime):at.min(),I=new Pn(_,b),E=g.removedTargetIds||[];n=new zt([],E,I.key,I)}else if("documentRemove"in e){e.documentRemove;var T=e.documentRemove;T.document;var N=xe(t,T.document),A=T.removedTargetIds||[];n=new zt([],A,N,null)}else{if(!("filter"in e))return m();e.filter;var S=e.filter;S.targetId;var D=S.count||0,x=new _t(D),L=S.targetId;n=new Bt(L,x)}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return at.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?at.min():e.readTime?Ne(e.readTime):at.min()}(t);return this.listener.yu(e,n)},e.prototype.Vu=function(t){var e={};e.database=Re(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=yt(r)?{documents:Ce(t,r)}:{query:Fe(t,r)}).targetId=e.targetId,e.resumeToken.O()>0&&(n.resumeToken=Ee(t,e.resumeToken)),n}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return m()}}(0,e.et);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.du(e)},e.prototype.pu=function(t){var e={};e.database=Re(this.serializer),e.removeTarget=t,this.du(e)},e}(Fo),qo=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).serializer=i,s.bu=!1,s}return n.__extends(e,t),Object.defineProperty(e.prototype,"vu",{get:function(){return this.bu},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.bu=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.mu=function(){this.bu&&this.Su([])},e.prototype.Ru=function(t){return this.iu.Pu("Write",t)},e.prototype.onMessage=function(t){if(w(!!t.streamToken),this.lastStreamToken=t.streamToken,this.bu){this.ys.reset();var e=function(t,e){return t&&t.length>0?(w(void 0!==e),t.map(function(t){return function(t,e){var n=t.updateTime?Ne(t.updateTime):Ne(e);n.isEqual(at.min())&&(n=Ne(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new ln(n,r)}(t,e)})):[]}(t.writeResults,t.commitTime),n=Ne(t.commitTime);return this.listener.Du(n,e)}return w(!t.writeResults||0===t.writeResults.length),this.bu=!0,this.listener.Cu()},e.prototype.Nu=function(){var t={};t.database=Re(this.serializer),this.du(t)},e.prototype.Su=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Ve(e.serializer,t)})};this.du(n)},e}(Fo),jo=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.iu=n,i.serializer=r,i.Fu=!1,i}return n.__extends(e,t),e.prototype.xu=function(){if(this.Fu)throw new f(h.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.$u=function(t,e,n){var r=this;return this.xu(),this.credentials.getToken().then(function(i){return r.iu.$u(t,e,n,i)}).catch(function(t){throw t.code===h.UNAUTHENTICATED&&r.credentials.zc(),t})},e.prototype.ku=function(t,e,n){var r=this;return this.xu(),this.credentials.getToken().then(function(i){return r.iu.ku(t,e,n,i)}).catch(function(t){throw t.code===h.UNAUTHENTICATED&&r.credentials.zc(),t})},e.prototype.terminate=function(){this.Fu=!1},e}(function(){}),Go=function(){function t(t,e){this.cs=t,this.di=e,this.state="Unknown",this.Mu=0,this.Ou=null,this.Lu=!0}return t.prototype.Bu=function(){var t=this;0===this.Mu&&(this.qu("Unknown"),this.Ou=this.cs.yn("online_state_timeout",1e4,function(){return t.Ou=null,t.Uu("Backend didn't respond within 10 seconds."),t.qu("Offline"),Promise.resolve()}))},t.prototype.Qu=function(t){"Online"===this.state?this.qu("Unknown"):(this.Mu++,this.Mu>=1&&(this.Wu(),this.Uu("Connection failed 1 times. Most recent error: "+t.toString()),this.qu("Offline")))},t.prototype.set=function(t){this.Wu(),this.Mu=0,"Online"===t&&(this.Lu=!1),this.qu(t)},t.prototype.qu=function(t){t!==this.state&&(this.state=t,this.di(t))},t.prototype.Uu=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Lu?(v(e),this.Lu=!1):d("OnlineStateTracker",e)},t.prototype.Wu=function(){null!==this.Ou&&(this.Ou.cancel(),this.Ou=null)},t}(),zo=function(t,e,r,i,o){var s=this;this.ju=t,this.Ku=e,this.cs=r,this.Gu={},this.zu=[],this.Hu=new Map,this.Yu=new Set,this.Ju=[],this.Xu=o,this.Xu.Zu(function(t){r.ws(function(){return n.__awaiter(s,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return Zo(this)?(d("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var e;return n.__generator(this,function(n){switch(n.label){case 0:return(e=_(t)).Yu.add(4),[4,Wo(e)];case 1:return n.sent(),e.th.set("Unknown"),e.Yu.delete(4),[4,Bo(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.th=new Go(r,i)};function Bo(t){return n.__awaiter(this,void 0,void 0,function(){var e,r;return n.__generator(this,function(n){switch(n.label){case 0:if(!Zo(t))return[3,4];e=0,r=t.Ju,n.label=1;case 1:return e<r.length?[4,(0,r[e])(!0)]:[3,4];case 2:n.sent(),n.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Wo(t){return n.__awaiter(this,void 0,void 0,function(){var e,r;return n.__generator(this,function(n){switch(n.label){case 0:e=0,r=t.Ju,n.label=1;case 1:return e<r.length?[4,(0,r[e])(!1)]:[3,4];case 2:n.sent(),n.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Ko(t){return n.__awaiter(this,void 0,void 0,function(){var e;return n.__generator(this,function(n){switch(n.label){case 0:return e=_(t),d("RemoteStore","RemoteStore shutting down."),e.Yu.add(5),[4,Wo(e)];case 1:return n.sent(),e.Xu.Di(),e.th.set("Unknown"),[2]}})})}function Qo(t,e){var n=_(t);n.Hu.has(e.targetId)||(n.Hu.set(e.targetId,e),Jo(n)?Xo(n):ds(n).uu()&&Yo(n,e))}function Ho(t,e){var n=_(t),r=ds(n);n.Hu.delete(e),r.uu()&&$o(n,e),0===n.Hu.size&&(r.uu()?r._u():Zo(n)&&n.th.set("Unknown"))}function Yo(t,e){t.eh.Ie(e.targetId),ds(t).Vu(e)}function $o(t,e){t.eh.Ie(e),ds(t).pu(e)}function Xo(t){t.eh=new Qt({qe:function(e){return t.Gu.qe(e)},Ue:function(e){return t.Hu.get(e)||null}}),ds(t).start(),t.th.Bu()}function Jo(t){return Zo(t)&&!ds(t).cu()&&t.Hu.size>0}function Zo(t){return 0===_(t).Yu.size}function ts(t){t.eh=void 0}function es(t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return t.Hu.forEach(function(e,n){Yo(t,e)}),[2]})})}function ns(t,e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){return ts(t),Jo(t)?(t.th.Qu(e),Xo(t)):t.th.set("Unknown"),[2]})})}function rs(t,e,r){return n.__awaiter(this,void 0,void 0,function(){var i,o,s;return n.__generator(this,function(u){switch(u.label){case 0:if(t.th.set("Online"),!(e instanceof Wt&&2===e.state&&e.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s;return n.__generator(this,function(n){switch(n.label){case 0:r=e.cause,i=0,o=e.targetIds,n.label=1;case 1:return i<o.length?(s=o[i],t.Hu.has(s)?[4,t.Gu.nh(s,r)]:[3,3]):[3,5];case 2:n.sent(),t.Hu.delete(s),t.eh.removeTarget(s),n.label=3;case 3:n.label=4;case 4:return i++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return u.sent(),[3,5];case 3:return i=u.sent(),d("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),[4,is(t,i)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof zt?t.eh.be(e):e instanceof Bt?t.eh.$e(e):t.eh.De(e),r.isEqual(at.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,bo(t.ju)];case 8:return o=u.sent(),r.L(o)>=0?[4,function(t,e){var n=t.eh.Oe(e);return n.zt.forEach(function(n,r){if(n.resumeToken.O()>0){var i=t.Hu.get(r);i&&t.Hu.set(r,i.it(n.resumeToken,e))}}),n.Ht.forEach(function(e){var n=t.Hu.get(e);if(n){t.Hu.set(e,n.it(Z.B,n.nt)),$o(t,e);var r=new wt(n.target,e,1,n.sequenceNumber);Yo(t,r)}}),t.Gu.sh(n)}(t,r)]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return d("RemoteStore","Failed to raise snapshot:",s=u.sent()),[4,is(t,s)];case 12:return u.sent(),[3,13];case 13:return[2]}})})}function is(t,e,r){return n.__awaiter(this,void 0,void 0,function(){var i=this;return n.__generator(this,function(o){switch(o.label){case 0:if(!Ir(e))throw e;return t.Yu.add(1),[4,Wo(t)];case 1:return o.sent(),t.th.set("Offline"),r||(r=function(){return bo(t.ju)}),t.cs.Cs(function(){return n.__awaiter(i,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return d("RemoteStore","Retrying IndexedDB access"),[4,r()];case 1:return e.sent(),t.Yu.delete(1),[4,Bo(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function os(t,e){return e().catch(function(n){return is(t,n,e)})}function ss(t){return n.__awaiter(this,void 0,void 0,function(){var e,r,i,o,s;return n.__generator(this,function(n){switch(n.label){case 0:e=_(t),r=vs(e),i=e.zu.length>0?e.zu[e.zu.length-1].batchId:-1,n.label=1;case 1:if(!function(t){return Zo(t)&&t.zu.length<10}(e))return[3,7];n.label=2;case 2:return n.trys.push([2,4,,6]),[4,Eo(e.ju,i)];case 3:return null===(o=n.sent())?(0===e.zu.length&&r._u(),[3,7]):(i=o.batchId,function(t,e){t.zu.push(e);var n=vs(t);n.uu()&&n.vu&&n.Su(e.mutations)}(e,o),[3,6]);case 4:return s=n.sent(),[4,is(e,s)];case 5:return n.sent(),[3,6];case 6:return[3,1];case 7:return us(e)&&as(e),[2]}})})}function us(t){return Zo(t)&&!vs(t).cu()&&t.zu.length>0}function as(t){vs(t).start()}function cs(t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return vs(t).Nu(),[2]})})}function hs(t){return n.__awaiter(this,void 0,void 0,function(){var e,r,i,o;return n.__generator(this,function(n){for(e=vs(t),r=0,i=t.zu;r<i.length;r++)o=i[r],e.Su(o.mutations);return[2]})})}function fs(t,e,r){return n.__awaiter(this,void 0,void 0,function(){var i,o;return n.__generator(this,function(n){switch(n.label){case 0:return i=t.zu.shift(),o=ti.from(i,e,r),[4,os(t,function(){return t.Gu.ih(o)})];case 1:return n.sent(),[4,ss(t)];case 2:return n.sent(),[2]}})})}function ls(t,e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(r){switch(r.label){case 0:return e&&vs(t).vu?[4,function(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(n){switch(n.label){case 0:return bt(i=e.code)&&i!==h.ABORTED?(r=t.zu.shift(),vs(t).lu(),[4,os(t,function(){return t.Gu.rh(r.batchId,e)})]):[3,3];case 1:return n.sent(),[4,ss(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:r.sent(),r.label=2;case 2:return us(t)&&as(t),[2]}})})}function ps(t,e){return n.__awaiter(this,void 0,void 0,function(){var r;return n.__generator(this,function(n){switch(n.label){case 0:return r=_(t),e?(r.Yu.delete(2),[4,Bo(r)]):[3,2];case 1:return n.sent(),[3,5];case 2:return e?[3,4]:(r.Yu.add(2),[4,Wo(r)]);case 3:n.sent(),r.th.set("Unknown"),n.label=4;case 4:n.label=5;case 5:return[2]}})})}function ds(t){var e=this;return t.oh||(t.oh=function(t,e,n){var r=_(t);return r.xu(),new Mo(e,r.iu,r.credentials,r.serializer,n)}(t.Ku,t.cs,{gu:es.bind(null,t),Tu:ns.bind(null,t),yu:rs.bind(null,t)}),t.Ju.push(function(r){return n.__awaiter(e,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return r?(t.oh.lu(),Jo(t)?Xo(t):t.th.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.oh.stop()];case 2:e.sent(),ts(t),e.label=3;case 3:return[2]}})})})),t.oh}function vs(t){var e=this;return t.ah||(t.ah=function(t,e,n){var r=_(t);return r.xu(),new qo(e,r.iu,r.credentials,r.serializer,n)}(t.Ku,t.cs,{gu:cs.bind(null,t),Tu:ls.bind(null,t),Cu:hs.bind(null,t),Du:fs.bind(null,t)}),t.Ju.push(function(r){return n.__awaiter(e,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return r?(t.ah.lu(),[4,ss(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.ah.stop()];case 3:e.sent(),t.zu.length>0&&(d("RemoteStore","Stopping write stream with "+t.zu.length+" pending writes"),t.zu=[]),e.label=4;case 4:return[2]}})})})),t.ah}var ys=function(t){this.key=t},gs=function(t){this.key=t},ms=function(){function t(t,e){this.query=t,this.uh=e,this.hh=null,this.te=!1,this.lh=Vt(),this.Wt=Vt(),this._h=Zn(t),this.fh=new Ft(this._h)}return Object.defineProperty(t.prototype,"dh",{get:function(){return this.uh},enumerable:!1,configurable:!0}),t.prototype.wh=function(t,e){var n=this,r=e?e.mh:new Mt,i=e?e.fh:this.fh,o=e?e.Wt:this.Wt,s=i,u=!1,a=Mn(this.query)&&i.size===this.query.limit?i.last():null,c=qn(this.query)&&i.size===this.query.limit?i.first():null;if(t.ht(function(t,e){var h=i.get(t),f=e instanceof On?e:null;f&&(f=Jn(n.query,f)?f:null);var l=!!h&&n.Wt.has(h.key),p=!!f&&(f.Je||n.Wt.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.Th(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n._h(f,a)>0||c&&n._h(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(u=!0)),d&&(f?(s=s.add(f),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),Mn(this.query)||qn(this.query))for(;s.size>this.query.limit;){var h=Mn(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fh:s,mh:r,Eh:u,Wt:o}},t.prototype.Th=function(t,e){return t.Je&&e.hasCommittedMutations&&!e.Je},t.prototype.yr=function(t,e,n){var r=this,i=this.fh;this.fh=t.fh,this.Wt=t.Wt;var o=t.mh.Ut();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return m()}};return n(t)-n(e)}(t.type,e.type)||r._h(t.doc,e.doc)}),this.Ih(n);var s=e?this.Ah():[],u=0===this.lh.size&&this.te?1:0,a=u!==this.hh;return this.hh=u,0!==o.length||a?{snapshot:new qt(this.query,t.fh,i,o,t.Wt,0===u,a,!1),Rh:s}:{Rh:s}},t.prototype.Qs=function(t){return this.te&&"Offline"===t?(this.te=!1,this.yr({fh:this.fh,mh:new Mt,Wt:this.Wt,Eh:!1},!1)):{Rh:[]}},t.prototype.gh=function(t){return!this.uh.has(t)&&!!this.fh.has(t)&&!this.fh.get(t).Je},t.prototype.Ih=function(t){var e=this;t&&(t.ee.forEach(function(t){return e.uh=e.uh.add(t)}),t.ne.forEach(function(t){}),t.se.forEach(function(t){return e.uh=e.uh.delete(t)}),this.te=t.te)},t.prototype.Ah=function(){var t=this;if(!this.te)return[];var e=this.lh;this.lh=Vt(),this.fh.forEach(function(e){t.gh(e.key)&&(t.lh=t.lh.add(e.key))});var n=[];return e.forEach(function(e){t.lh.has(e)||n.push(new gs(e))}),this.lh.forEach(function(t){e.has(t)||n.push(new ys(t))}),n},t.prototype.Ph=function(t){this.uh=t.Fc,this.lh=Vt();var e=this.wh(t.documents);return this.yr(e,!0)},t.prototype.yh=function(){return qt.Gt(this.query,this.fh,this.Wt,0===this.hh)},t}(),ws=function(t,e,n){this.query=t,this.targetId=e,this.view=n},_s=function(t){this.key=t,this.Vh=!1},bs=function(){function t(t,e,n,r,i,o){this.ju=t,this.ph=e,this.bh=n,this.Sh=r,this.currentUser=i,this.Dh=o,this.Ch={},this.Nh=new st(function(t){return $n(t)},Yn),this.Fh=new Map,this.xh=[],this.$h=new Et(D.i),this.kh=new Map,this.Mh=new ko,this.Oh={},this.Lh=new Map,this.Bh=oo.da(),this.onlineState="Unknown",this.qh=void 0}return Object.defineProperty(t.prototype,"Uh",{get:function(){return!0===this.qh},enumerable:!1,configurable:!0}),t}();function Is(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s,u,a;return n.__generator(this,function(n){switch(n.label){case 0:return r=Hs(t),(s=r.Nh.get(e))?(i=s.targetId,r.Sh.Oi(i),o=s.view.yh(),[3,4]):[3,1];case 1:return[4,To(r.ju,Wn(e))];case 2:return u=n.sent(),a=r.Sh.Oi(u.targetId),i=u.targetId,[4,Es(r,e,i,"current"===a)];case 3:o=n.sent(),r.Uh&&Qo(r.ph,u),n.label=4;case 4:return[2,o]}})})}function Es(t,e,r,i){return n.__awaiter(this,void 0,void 0,function(){var o,s,u,a,c,h;return n.__generator(this,function(f){switch(f.label){case 0:return t.Qh=function(e,r,i){return function(t,e,r,i){return n.__awaiter(this,void 0,void 0,function(){var o,s,u;return n.__generator(this,function(n){switch(n.label){case 0:return(o=e.view.wh(r)).Eh?[4,Ao(t.ju,e.query,!1).then(function(t){var n=t.documents;return e.view.wh(n,o)})]:[3,2];case 1:o=n.sent(),n.label=2;case 2:return s=i&&i.zt.get(e.targetId),u=e.view.yr(o,t.Uh,s),[2,(Ps(t,e.targetId,u.Rh),u.snapshot)]}})})}(t,e,r,i)},[4,Ao(t.ju,e,!0)];case 1:return o=f.sent(),s=new ms(e,o.Fc),u=s.wh(o.documents),a=Gt.Zt(r,i&&"Offline"!==t.onlineState),c=s.yr(u,t.Uh,a),Ps(t,r,c.Rh),h=new ws(e,r,s),[2,(t.Nh.set(e,h),t.Fh.has(r)?t.Fh.get(r).push(e):t.Fh.set(r,[e]),c.snapshot)]}})})}function Ts(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o;return n.__generator(this,function(n){switch(n.label){case 0:return r=_(t),i=r.Nh.get(e),(o=r.Fh.get(i.targetId)).length>1?[2,(r.Fh.set(i.targetId,o.filter(function(t){return!Yn(t,e)})),void r.Nh.delete(e))]:r.Uh?(r.Sh.Bi(i.targetId),r.Sh.Fi(i.targetId)?[3,2]:[4,No(r.ju,i.targetId,!1).then(function(){r.Sh.Ui(i.targetId),Ho(r.ph,i.targetId),Rs(r,i.targetId)}).catch(Lo)]):[3,3];case 1:n.sent(),n.label=2;case 2:return[3,5];case 3:return Rs(r,i.targetId),[4,No(r.ju,i.targetId,!0)];case 4:n.sent(),n.label=5;case 5:return[2]}})})}function Ns(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(n){switch(n.label){case 0:r=_(t),n.label=1;case 1:return n.trys.push([1,4,,6]),[4,Io(r.ju,e)];case 2:return i=n.sent(),e.zt.forEach(function(t,e){var n=r.kh.get(e);n&&(w(t.ee.size+t.ne.size+t.se.size<=1),t.ee.size>0?n.Vh=!0:t.ne.size>0?w(n.Vh):t.se.size>0&&(w(n.Vh),n.Vh=!1))}),[4,Cs(r,i,e)];case 3:return n.sent(),[3,6];case 4:return[4,Lo(n.sent())];case 5:return n.sent(),[3,6];case 6:return[2]}})})}function As(t,e,n){var r=_(t);if(r.Uh&&0===n||!r.Uh&&1===n){var i=[];r.Nh.forEach(function(t,n){var r=n.view.Qs(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=_(t);n.onlineState=e;var r=!1;n.Bs.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].Qs(e)&&(r=!0)}),r&&Mr(n)}(r.bh,e),i.length&&r.Ch.yu(i),r.onlineState=e,r.Uh&&r.Sh.Ki(e)}}function Ss(t,e,r){return n.__awaiter(this,void 0,void 0,function(){var i,o,s,u,a,c;return n.__generator(this,function(n){switch(n.label){case 0:return(i=_(t)).Sh.Qi(e,"rejected",r),o=i.kh.get(e),(s=o&&o.key)?(u=(u=new Et(D.i)).ot(s,new Pn(s,at.min())),a=Vt().add(s),c=new jt(at.min(),new Map,new At($),u,a),[4,Ns(i,c)]):[3,2];case 1:return n.sent(),i.$h=i.$h.remove(s),i.kh.delete(e),Us(i),[3,4];case 2:return[4,No(i.ju,e,!1).then(function(){return Rs(i,e,r)}).catch(Lo)];case 3:n.sent(),n.label=4;case 4:return[2]}})})}function Ds(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o;return n.__generator(this,function(n){switch(n.label){case 0:r=_(t),i=e.batch.batchId,n.label=1;case 1:return n.trys.push([1,4,,6]),[4,_o(r.ju,e)];case 2:return o=n.sent(),ks(r,i,null),Ls(r,i),r.Sh.ki(i,"acknowledged"),[4,Cs(r,o)];case 3:return n.sent(),[3,6];case 4:return[4,Lo(n.sent())];case 5:return n.sent(),[3,6];case 6:return[2]}})})}function xs(t,e,r){return n.__awaiter(this,void 0,void 0,function(){var i,o;return n.__generator(this,function(n){switch(n.label){case 0:i=_(t),n.label=1;case 1:return n.trys.push([1,4,,6]),[4,function(t,e){var n=_(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n.Sr.Oo(t,e).next(function(e){return w(null!==e),r=e.keys(),n.Sr.Wo(t,e)}).next(function(){return n.Sr.zo(t)}).next(function(){return n.Cc.kr(t,r)})})}(i.ju,e)];case 2:return o=n.sent(),ks(i,e,r),Ls(i,e),i.Sh.ki(e,"rejected",r),[4,Cs(i,o)];case 3:return n.sent(),[3,6];case 4:return[4,Lo(n.sent())];case 5:return n.sent(),[3,6];case 6:return[2]}})})}function Ls(t,e){(t.Lh.get(e)||[]).forEach(function(t){t.resolve()}),t.Lh.delete(e)}function ks(t,e,n){var r=_(t),i=r.Oh[r.currentUser.ti()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Oh[r.currentUser.ti()]=i}}function Rs(t,e,n){void 0===n&&(n=null),t.Sh.Bi(e);for(var r=0,i=t.Fh.get(e);r<i.length;r++){var o=i[r];t.Nh.delete(o),n&&t.Ch.Wh(o,n)}t.Fh.delete(e),t.Uh&&t.Mh.Uc(e).forEach(function(e){t.Mh.Ho(e)||Os(t,e)})}function Os(t,e){var n=t.$h.get(e);null!==n&&(Ho(t.ph,n),t.$h=t.$h.remove(e),t.kh.delete(n),Us(t))}function Ps(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof ys?(t.Mh.Da(o.key,e),Vs(t,o)):o instanceof gs?(d("SyncEngine","Document no longer in limbo: "+o.key),t.Mh.Na(o.key,e),t.Mh.Ho(o.key)||Os(t,o.key)):m()}}function Vs(t,e){var n=e.key;t.$h.get(n)||(d("SyncEngine","New document in limbo: "+n),t.xh.push(n),Us(t))}function Us(t){for(;t.xh.length>0&&t.$h.size<t.Dh;){var e=t.xh.shift(),n=t.Bh.next();t.kh.set(n,new _s(e)),t.$h=t.$h.ot(e,n),Qo(t.ph,new wt(Wn(Fn(e.path)),n,2,Gr.ai))}}function Cs(t,e,r){return n.__awaiter(this,void 0,void 0,function(){var i,o,s,u;return n.__generator(this,function(a){switch(a.label){case 0:return i=_(t),o=[],s=[],u=[],i.Nh.m()?[3,3]:(i.Nh.forEach(function(t,n){u.push(i.Qh(n,e,r).then(function(t){if(t){i.Uh&&i.Sh.Qi(n.targetId,t.fromCache?"not-current":"current"),o.push(t);var e=oi.zr(n.targetId,t);s.push(e)}}))}),[4,Promise.all(u)]);case 1:return a.sent(),i.Ch.yu(o),[4,function(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s,u,a,c,h,f;return n.__generator(this,function(n){switch(n.label){case 0:r=_(t),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return mr.forEach(e,function(e){return mr.forEach(e.Kr,function(n){return r.persistence.No.Da(t,e.targetId,n)}).next(function(){return mr.forEach(e.Gr,function(n){return r.persistence.No.Na(t,e.targetId,n)})})})})];case 2:return n.sent(),[3,4];case 3:if(!Ir(i=n.sent()))throw i;return d("LocalStore","Failed to update sequence numbers: "+i),[3,4];case 4:for(o=0,s=e;o<s.length;o++)u=s[o],a=u.targetId,u.fromCache||(c=r.bc.get(a),h=c.nt,f=c.rt(h),r.bc=r.bc.ot(a,f));return[2]}})})}(i.ju,s)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function Fs(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(o){switch(o.label){case 0:return(r=_(t)).currentUser.isEqual(e)?[3,3]:(d("SyncEngine","User change. New user:",e.ti()),[4,function(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s;return n.__generator(this,function(n){switch(n.label){case 0:return r=_(t),i=r.Sr,o=r.Cc,[4,r.persistence.runTransaction("Handle user change","readonly",function(t){var n;return r.Sr.Uo(t).next(function(s){return n=s,i=r.persistence.mc(e),o=new ii(r.Dc,i,r.persistence.Ic()),i.Uo(t)}).next(function(e){for(var r=[],i=[],s=Vt(),u=0,a=n;u<a.length;u++){var c=a[u];r.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var p=0,d=e;p<d.length;p++){var v=d[p];i.push(v.batchId);for(var y=0,g=v.mutations;y<g.length;y++){var m=g[y];s=s.add(m.key)}}return o.kr(t,s).next(function(t){return{jh:t,Kh:r,Gh:i}})})})];case 1:return s=n.sent(),[2,(r.Sr=i,r.Cc=o,r.Vc.Nc(r.Cc),s)]}})})}(r.ju,e)]);case 1:return i=o.sent(),r.currentUser=e,function(t,e){t.Lh.forEach(function(t){t.forEach(function(t){t.reject(new f(h.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Lh.clear()}(r),r.Sh.ji(e,i.Kh,i.Gh),[4,Cs(r,i.jh)];case 2:o.sent(),o.label=3;case 3:return[2]}})})}function Ms(t,e){var n=_(t),r=n.kh.get(e);if(r&&r.Vh)return Vt().add(r.key);var i=Vt(),o=n.Fh.get(e);if(!o)return i;for(var s=0,u=o;s<u.length;s++){var a=u[s],c=n.Nh.get(a);i=i.kt(c.view.dh)}return i}function qs(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o;return n.__generator(this,function(n){switch(n.label){case 0:return[4,Ao((r=_(t)).ju,e.query,!0)];case 1:return i=n.sent(),o=e.view.Ph(i),[2,(r.Uh&&Ps(r,e.targetId,o.Rh),o)]}})})}function js(t,e,r,i){return n.__awaiter(this,void 0,void 0,function(){var o,s;return n.__generator(this,function(n){switch(n.label){case 0:return[4,function(t,e){var n=_(t),r=_(n.Sr);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.Lo(t,e).next(function(e){return e?n.Cc.kr(t,e):mr.resolve(null)})})}((o=_(t)).ju,e)];case 1:return null===(s=n.sent())?[3,6]:"pending"!==r?[3,3]:[4,ss(o.ph)];case 2:return n.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(ks(o,e,i||null),Ls(o,e),function(t,e){_(_(t).Sr).Ko(e)}(o.ju,e)):m(),n.label=4;case 4:return[4,Cs(o,s)];case 5:return n.sent(),[3,7];case 6:d("SyncEngine","Cannot apply mutation batch with id: "+e),n.label=7;case 7:return[2]}})})}function Gs(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s,u,a,c,h;return n.__generator(this,function(n){switch(n.label){case 0:return Hs(r=_(t)),Ys(r),!0!==e||!0===r.qh?[3,3]:(i=r.Sh.Ci(),[4,zs(r,i.A())]);case 1:return o=n.sent(),r.qh=!0,[4,ps(r.ph,!0)];case 2:for(n.sent(),s=0,u=o;s<u.length;s++)a=u[s],Qo(r.ph,a);return[3,7];case 3:return!1!==e||!1===r.qh?[3,7]:(c=[],h=Promise.resolve(),r.Fh.forEach(function(t,e){r.Sh.qi(e)?c.push(e):h=h.then(function(){return Rs(r,e),No(r.ju,e,!0)}),Ho(r.ph,e)}),[4,h]);case 4:return n.sent(),[4,zs(r,c)];case 5:return n.sent(),function(t){var e=_(r);e.kh.forEach(function(t,n){Ho(e.ph,n)}),e.Mh.Qc(),e.kh=new Map,e.$h=new Et(D.i)}(),r.qh=!1,[4,ps(r.ph,!1)];case 6:n.sent(),n.label=7;case 7:return[2]}})})}function zs(t,e,r){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s,u,a,c,h,f,l,p,d,v,y;return n.__generator(this,function(n){switch(n.label){case 0:r=_(t),i=[],o=[],s=0,u=e,n.label=1;case 1:return s<u.length?(a=u[s],c=void 0,(h=r.Fh.get(a))&&0!==h.length?[4,To(r.ju,Wn(h[0]))]:[3,7]):[3,13];case 2:c=n.sent(),f=0,l=h,n.label=3;case 3:return f<l.length?(p=l[f],d=r.Nh.get(p),[4,qs(r,d)]):[3,6];case 4:(v=n.sent()).snapshot&&o.push(v.snapshot),n.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,So(r.ju,a)];case 8:return y=n.sent(),[4,To(r.ju,y)];case 9:return c=n.sent(),[4,Es(r,Bs(y),a,!1)];case 10:n.sent(),n.label=11;case 11:i.push(c),n.label=12;case 12:return s++,[3,1];case 13:return[2,(r.Ch.yu(o),i)]}})})}function Bs(t){return Cn(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Ws(t){var e=_(t);return _(_(e.ju).persistence).pi()}function Ks(t,e,r,i){return n.__awaiter(this,void 0,void 0,function(){var o,s,u;return n.__generator(this,function(n){switch(n.label){case 0:return(o=_(t)).qh?(d("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!o.Fh.has(e))return[3,8];switch(r){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Do(o.ju)];case 3:return s=n.sent(),u=jt.Xt(e,"current"===r),[4,Cs(o,s,u)];case 4:return n.sent(),[3,8];case 5:return[4,No(o.ju,e,!0)];case 6:return n.sent(),Rs(o,e,i),[3,8];case 7:m(),n.label=8;case 8:return[2]}})})}function Qs(t,e,r){return n.__awaiter(this,void 0,void 0,function(){var i,o,s,u,a,c,h,f,l,p;return n.__generator(this,function(v){switch(v.label){case 0:if(!(i=Hs(t)).qh)return[3,10];o=0,s=e,v.label=1;case 1:return o<s.length?(u=s[o],i.Fh.has(u)?(d("SyncEngine","Adding an already active target "+u),[3,5]):[4,So(i.ju,u)]):[3,6];case 2:return a=v.sent(),[4,To(i.ju,a)];case 3:return c=v.sent(),[4,Es(i,Bs(a),c.targetId,!1)];case 4:v.sent(),Qo(i.ph,c),v.label=5;case 5:return o++,[3,1];case 6:h=function(t){return n.__generator(this,function(e){switch(e.label){case 0:return i.Fh.has(t)?[4,No(i.ju,t,!1).then(function(){Ho(i.ph,t),Rs(i,t)}).catch(Lo)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},f=0,l=r,v.label=7;case 7:return f<l.length?(p=l[f],[5,h(p)]):[3,10];case 8:v.sent(),v.label=9;case 9:return f++,[3,7];case 10:return[2]}})})}function Hs(t){var e=_(t);return e.ph.Gu.sh=Ns.bind(null,e),e.ph.Gu.qe=Ms.bind(null,e),e.ph.Gu.nh=Ss.bind(null,e),e.Ch.yu=Cr.bind(null,e.bh),e.Ch.Wh=Fr.bind(null,e.bh),e}function Ys(t){var e=_(t);return e.ph.Gu.ih=Ds.bind(null,e),e.ph.Gu.rh=xs.bind(null,e),e}var $s=function(){function t(){}return t.prototype.Nc=function(t){this.zh=t},t.prototype.Lr=function(t,e,n,r){var o=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.on.length||1===t.on.length&&t.on[0].field.p())}(e)||n.isEqual(at.min())?this.Hh(t,e):this.zh.kr(t,r).next(function(s){var u=o.Yh(e,s);return(Mn(e)||qn(e))&&o.Eh(e.an,u,r,n)?o.Hh(t,e):(p()<=i.LogLevel.DEBUG&&d("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Xn(e)),o.zh.Lr(t,e,n).next(function(t){return u.forEach(function(e){t=t.ot(e.key,e)}),t}))})},t.prototype.Yh=function(t,e){var n=new At(Zn(t));return e.forEach(function(e,r){r instanceof On&&Jn(t,r)&&(n=n.add(r))}),n},t.prototype.Eh=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.L(r)>0)},t.prototype.Hh=function(t,e){return p()<=i.LogLevel.DEBUG&&d("IndexFreeQueryEngine","Using full collection scan to execute query:",Xn(e)),this.zh.Lr(t,e,at.min())},t}(),Xs=function(){function t(t,e){this.Dr=t,this.No=e,this.Sr=[],this.Jh=1,this.Xh=new At(Ro.kc)}return t.prototype.$o=function(t){return mr.resolve(0===this.Sr.length)},t.prototype.ko=function(t,e,n,r){var i=this.Jh;this.Jh++,this.Sr.length>0&&this.Sr[this.Sr.length-1];var o=new Zr(i,e,n,r);this.Sr.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.Xh=this.Xh.add(new Ro(a.key,i)),this.Dr.Mo(t,a.key.path.h())}return mr.resolve(o)},t.prototype.Oo=function(t,e){return mr.resolve(this.Zh(e))},t.prototype.Bo=function(t,e){var n=e+1,r=this.tl(n),i=r<0?0:r;return mr.resolve(this.Sr.length>i?this.Sr[i]:null)},t.prototype.qo=function(){return mr.resolve(0===this.Sr.length?-1:this.Jh-1)},t.prototype.Uo=function(t){return mr.resolve(this.Sr.slice())},t.prototype.Nr=function(t,e){var n=this,r=new Ro(e,0),i=new Ro(e,Number.POSITIVE_INFINITY),o=[];return this.Xh.Ft([r,i],function(t){var e=n.Zh(t.jc);o.push(e)}),mr.resolve(o)},t.prototype.Or=function(t,e){var n=this,r=new At($);return e.forEach(function(t){var e=new Ro(t,0),i=new Ro(t,Number.POSITIVE_INFINITY);n.Xh.Ft([e,i],function(t){r=r.add(t.jc)})}),mr.resolve(this.el(r))},t.prototype.Wr=function(t,e){var n=e.path,r=n.length+1,i=n;D.F(i)||(i=i.child(""));var o=new Ro(new D(i),0),s=new At($);return this.Xh.xt(function(t){var e=t.key.path;return!!n.T(e)&&(e.length===r&&(s=s.add(t.jc)),!0)},o),mr.resolve(this.el(s))},t.prototype.el=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.Zh(t);null!==r&&n.push(r)}),n},t.prototype.Wo=function(t,e){var n=this;w(0===this.nl(e.batchId,"removed")),this.Sr.shift();var r=this.Xh;return mr.forEach(e.mutations,function(i){var o=new Ro(i.key,e.batchId);return r=r.delete(o),n.No.Go(t,i.key)}).next(function(){n.Xh=r})},t.prototype.Ko=function(t){},t.prototype.Ho=function(t,e){var n=new Ro(e,0),r=this.Xh.$t(n);return mr.resolve(e.isEqual(r&&r.key))},t.prototype.zo=function(t){return this.Sr.length,mr.resolve()},t.prototype.nl=function(t,e){return this.tl(t)},t.prototype.tl=function(t){return 0===this.Sr.length?0:t-this.Sr[0].batchId},t.prototype.Zh=function(t){var e=this.tl(t);return e<0||e>=this.Sr.length?null:this.Sr[e]},t}(),Js=function(){function t(t,e){this.Dr=t,this.sl=e,this.docs=new Et(D.i),this.size=0}return t.prototype.Er=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.sl(e);return this.docs=this.docs.ot(r,{ta:e,size:s,readTime:n}),this.size+=s-o,this.Dr.Mo(t,r.path.h())},t.prototype.Ar=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.Rr=function(t,e){var n=this.docs.get(e);return mr.resolve(n?n.ta:null)},t.prototype.getEntries=function(t,e){var n=this,r=Lt();return e.forEach(function(t){var e=n.docs.get(t);r=r.ot(t,e?e.ta:null)}),mr.resolve(r)},t.prototype.Lr=function(t,e,n){for(var r=Rt(),i=new D(e.path.child("")),o=this.docs.ft(i);o.At();){var s=o.It(),u=s.key,a=s.value,c=a.ta,h=a.readTime;if(!e.path.T(u.path))break;h.L(n)<=0||c instanceof On&&Jn(e,c)&&(r=r.ot(c.key,c))}return mr.resolve(r)},t.prototype.il=function(t,e){return mr.forEach(this.docs,function(t){return e(t)})},t.prototype.ra=function(t){return new Zs(this)},t.prototype.aa=function(t){return mr.resolve(this.size)},t}(),Zs=function(t){function e(e){var n=this;return(n=t.call(this)||this).ca=e,n}return n.__extends(e,t),e.prototype.yr=function(t){var e=this,n=[];return this.wr.forEach(function(r,i){i?n.push(e.ca.Er(t,i,e.readTime)):e.ca.Ar(r)}),mr.$n(n)},e.prototype.gr=function(t,e){return this.ca.Rr(t,e)},e.prototype.Pr=function(t,e){return this.ca.getEntries(t,e)},e}(ei),tu=function(){function t(t){this.persistence=t,this.rl=new st(function(t){return dt(t)},vt),this.lastRemoteSnapshotVersion=at.min(),this.highestTargetId=0,this.ol=0,this.al=new ko,this.targetCount=0,this.cl=oo.fa()}return t.prototype.Ce=function(t,e){return this.rl.forEach(function(t,n){return e(n)}),mr.resolve()},t.prototype.Ea=function(t){return mr.resolve(this.lastRemoteSnapshotVersion)},t.prototype.Ia=function(t){return mr.resolve(this.ol)},t.prototype.wa=function(t){return this.highestTargetId=this.cl.next(),mr.resolve(this.highestTargetId)},t.prototype.Aa=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ol&&(this.ol=e),mr.resolve()},t.prototype.ga=function(t){this.rl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.cl=new oo(e),this.highestTargetId=e),t.sequenceNumber>this.ol&&(this.ol=t.sequenceNumber)},t.prototype.Ra=function(t,e){return this.ga(e),this.targetCount+=1,mr.resolve()},t.prototype.ya=function(t,e){return this.ga(e),mr.resolve()},t.prototype.Va=function(t,e){return this.rl.delete(e.target),this.al.Uc(e.targetId),this.targetCount-=1,mr.resolve()},t.prototype.po=function(t,e,n){var r=this,i=0,o=[];return this.rl.forEach(function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.rl.delete(s),o.push(r.pa(t,u.targetId)),i++)}),mr.$n(o).next(function(){return i})},t.prototype.ba=function(t){return mr.resolve(this.targetCount)},t.prototype.va=function(t,e){var n=this.rl.get(e)||null;return mr.resolve(n)},t.prototype.Sa=function(t,e,n){return this.al.Lc(e,n),mr.resolve()},t.prototype.Ca=function(t,e,n){this.al.qc(e,n);var r=this.persistence.No,i=[];return r&&e.forEach(function(e){i.push(r.Go(t,e))}),mr.$n(i)},t.prototype.pa=function(t,e){return this.al.Uc(e),mr.resolve()},t.prototype.Fa=function(t,e){var n=this.al.Wc(e);return mr.resolve(n)},t.prototype.Ho=function(t,e){return mr.resolve(this.al.Ho(e))},t}(),eu=function(){function t(t){var e=this;this.ul={},this.Ma=new Gr(0),this.Oa=!1,this.Oa=!0,this.No=t(this),this.Ka=new tu(this),this.Dr=new Fi,this.vr=function(t,n){return new Js(t,function(t){return e.No.hl(t)})}(this.Dr)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.Di=function(){return this.Oa=!1,Promise.resolve()},Object.defineProperty(t.prototype,"Ei",{get:function(){return this.Oa},enumerable:!1,configurable:!0}),t.prototype.Za=function(){},t.prototype.tc=function(){},t.prototype.Ic=function(){return this.Dr},t.prototype.mc=function(t){var e=this.ul[t.ti()];return e||(e=new Xs(this.Dr,this.No),this.ul[t.ti()]=e),e},t.prototype.Tc=function(){return this.Ka},t.prototype.Ec=function(){return this.vr},t.prototype.runTransaction=function(t,e,n){var r=this;d("MemoryPersistence","Starting transaction:",t);var i=new nu(this.Ma.next());return this.No.ll(),n(i).next(function(t){return r.No._l(i).next(function(){return t})}).Fn().then(function(t){return i.br(),t})},t.prototype.fl=function(t,e){return mr.kn(Object.values(this.ul).map(function(n){return function(){return n.Ho(t,e)}}))},t}(),nu=function(t){function e(e){var n=this;return(n=t.call(this)||this).xa=e,n}return n.__extends(e,t),e}(ri),ru=function(){function t(t){this.persistence=t,this.dl=new ko,this.wl=null}return t.ml=function(e){return new t(e)},Object.defineProperty(t.prototype,"Tl",{get:function(){if(this.wl)return this.wl;throw m()},enumerable:!1,configurable:!0}),t.prototype.Da=function(t,e,n){return this.dl.Da(n,e),this.Tl.delete(n.toString()),mr.resolve()},t.prototype.Na=function(t,e,n){return this.dl.Na(n,e),this.Tl.add(n.toString()),mr.resolve()},t.prototype.Go=function(t,e){return this.Tl.add(e.toString()),mr.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.dl.Uc(e.targetId).forEach(function(t){return n.Tl.add(t.toString())});var r=this.persistence.Tc();return r.Fa(t,e.targetId).next(function(t){t.forEach(function(t){return n.Tl.add(t.toString())})}).next(function(){return r.Va(t,e)})},t.prototype.ll=function(){this.wl=new Set},t.prototype._l=function(t){var e=this,n=this.persistence.Ec().ra();return mr.forEach(this.Tl,function(r){var i=D.D(r);return e.El(t,i).next(function(t){t||n.Ar(i)})}).next(function(){return e.wl=null,n.apply(t)})},t.prototype.yc=function(t,e){var n=this;return this.El(t,e).next(function(t){t?n.Tl.delete(e.toString()):n.Tl.add(e.toString())})},t.prototype.hl=function(t){return 0},t.prototype.El=function(t,e){var n=this;return mr.kn([function(){return mr.resolve(n.dl.Ho(e))},function(){return n.persistence.Tc().Ho(t,e)},function(){return n.persistence.fl(t,e)}])},t}(),iu=function(){function t(t){this.Il=t.Il,this.Al=t.Al}return t.prototype.gu=function(t){this.Rl=t},t.prototype.Tu=function(t){this.gl=t},t.prototype.onMessage=function(t){this.Pl=t},t.prototype.close=function(){this.Al()},t.prototype.send=function(t){this.Il(t)},t.prototype.yl=function(){this.Rl()},t.prototype.Vl=function(t){this.gl(t)},t.prototype.pl=function(t){this.Pl(t)},t}(),ou={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},su=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.W=e.W,n}return n.__extends(e,t),e.prototype.Nl=function(t,e,n,r){return new Promise(function(i,o){var u=new s.XhrIo;u.listenOnce(s.EventType.COMPLETE,function(){try{switch(u.getLastErrorCode()){case s.ErrorCode.NO_ERROR:var e=u.getResponseJson();d("Connection","XHR received:",JSON.stringify(e)),i(e);break;case s.ErrorCode.TIMEOUT:d("Connection",'RPC "'+t+'" timed out'),o(new f(h.DEADLINE_EXCEEDED,"Request time out"));break;case s.ErrorCode.HTTP_ERROR:var n=u.getStatus();if(d("Connection",'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=r.status.toLowerCase().replace("_","-");return Object.values(h).indexOf(e)>=0?e:h.UNKNOWN}();o(new f(a,r.message))}else o(new f(h.UNKNOWN,"Server responded with status "+u.getStatus()))}else o(new f(h.UNAVAILABLE,"Connection failed."));break;default:m()}}finally{d("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);u.send(e,"POST",a,n,15)})},e.prototype.Pu=function(t,e){var n=[this.vl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=s.createWebChannelTransport(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.U.projectId+"/databases/"+this.U.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.W};this.Cl(i.initMessageHeaders,e),o.isMobileCordova()||o.isReactNative()||o.isElectron()||o.isIE()||o.isUWP()||o.isBrowserExtension()||(i.httpHeadersOverwriteParam="$httpHeaders");var u=n.join("");d("Connection","Creating WebChannel: "+u,i);var a=r.createWebChannel(u,i),c=!1,l=!1,p=new iu({Il:function(t){l?d("Connection","Not sending because WebChannel is closed:",t):(c||(d("Connection","Opening WebChannel transport."),a.open(),c=!0),d("Connection","WebChannel sending:",t),a.send(t))},Al:function(){return a.close()}}),v=function(t,e){a.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return v(s.WebChannel.EventType.OPEN,function(){l||d("Connection","WebChannel transport opened.")}),v(s.WebChannel.EventType.CLOSE,function(){l||(l=!0,d("Connection","WebChannel transport closed"),p.Vl())}),v(s.WebChannel.EventType.ERROR,function(t){l||(l=!0,y("Connection","WebChannel transport errored:",t),p.Vl(new f(h.UNAVAILABLE,"The operation could not be completed")))}),v(s.WebChannel.EventType.MESSAGE,function(t){var e;if(!l){var n=t.data[0];w(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){d("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=gt[o];if(void 0!==e)return It(e)}(),u=i.message;void 0===s&&(s=h.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),l=!0,p.Vl(new f(s,u)),a.close()}else d("Connection","WebChannel received:",n),p.pl(n)}}),setTimeout(function(){p.yl()},0),p},e}(function(){function t(t){this.bl=t,this.U=t.U;var e=t.ssl?"https":"http";this.vl=e+"://"+t.host,this.Sl="projects/"+this.U.projectId+"/databases/"+this.U.database+"/documents"}return t.prototype.$u=function(t,e,n,r){var i=this.Dl(t,e);d("RestConnection","Sending: ",i,n);var o={};return this.Cl(o,r),this.Nl(t,i,o,n).then(function(t){return d("RestConnection","Received: ",t),t},function(e){throw y("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.ku=function(t,e,n,r){return this.$u(t,e,n,r)},t.prototype.Cl=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.24.0",t["Content-Type"]="text/plain",e)for(var n in e.Kc)e.Kc.hasOwnProperty(n)&&(t[n]=e.Kc[n])},t.prototype.Dl=function(t,e){var n=ou[t];return this.vl+"/v1/"+e+":"+n},t}()),uu=function(){function t(){var t=this;this.Fl=function(){return t.xl()},this.$l=function(){return t.kl()},this.Ml=[],this.Ol()}return t.prototype.Zu=function(t){this.Ml.push(t)},t.prototype.Di=function(){window.removeEventListener("online",this.Fl),window.removeEventListener("offline",this.$l)},t.prototype.Ol=function(){window.addEventListener("online",this.Fl),window.addEventListener("offline",this.$l)},t.prototype.xl=function(){d("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Ml;t<e.length;t++)(0,e[t])(0)},t.prototype.kl=function(){d("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Ml;t<e.length;t++)(0,e[t])(1)},t.Ln=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),au=function(){function t(){}return t.prototype.Zu=function(t){},t.prototype.Di=function(){},t}();function cu(t){return new me(t,!0)}var hu="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",fu=function(){function t(){}return t.prototype.initialize=function(t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return this.Sh=this.Ll(t),this.persistence=this.Bl(t),[4,this.persistence.start()];case 1:return e.sent(),this.ql=this.Ul(t),this.ju=this.Ql(t),[2]}})})},t.prototype.Ul=function(t){return null},t.prototype.Ql=function(t){return e=this.persistence,n=new $s,r=t.Wl,new wo(e,n,r);var e,n,r},t.prototype.Bl=function(t){if(t.persistenceSettings.jl)throw new f(h.FAILED_PRECONDITION,hu);return new eu(ru.ml)},t.prototype.Ll=function(t){return new Jr},t.prototype.terminate=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return this.ql&&this.ql.stop(),[4,this.Sh.Di()];case 1:return t.sent(),[4,this.persistence.Di()];case 2:return t.sent(),[2]}})})},t.prototype.clearPersistence=function(t,e){throw new f(h.FAILED_PRECONDITION,hu)},t}(),lu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.initialize=function(e){return n.__awaiter(this,void 0,void 0,function(){var r,i=this;return n.__generator(this,function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return o.sent(),r=this.Kl.fi,this.Sh instanceof Xr?(this.Sh.fi={er:js.bind(null,r),nr:Ks.bind(null,r),sr:Qs.bind(null,r),pi:Ws.bind(null,r)},[4,this.Sh.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.Xa(function(t){return n.__awaiter(i,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return[4,Gs(this.Kl.fi,t)];case 1:return e.sent(),this.ql&&(t&&!this.ql.Ei?this.ql.start(this.ju):t||this.ql.stop()),[2]}})})})];case 4:return o.sent(),[2]}})})},e.prototype.Ll=function(t){if(t.persistenceSettings.jl&&t.persistenceSettings.synchronizeTabs){var e=Dr();if(!Xr.Ln(e))throw new f(h.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=mo(t.bl.U,t.bl.persistenceKey);return new Xr(e,t.cs,n,t.clientId,t.Wl)}return new Jr},e}(function(t){function e(e){var n=this;return(n=t.call(this)||this).Kl=e,n}return n.__extends(e,t),e.prototype.initialize=function(e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,xo(this.ju)];case 2:return n.sent(),[4,this.Kl.initialize(this,e)];case 3:return n.sent(),[4,Ys(this.Kl.fi)];case 4:return n.sent(),[4,ss(this.Kl.ph)];case 5:return n.sent(),[2]}})})},e.prototype.Ul=function(t){var e=this.persistence.No.wo;return new hi(e,t.cs)},e.prototype.Bl=function(t){var e=mo(t.bl.U,t.bl.persistenceKey),n=cu(t.bl.U);return new lo(t.persistenceSettings.synchronizeTabs,e,t.clientId,ci.ao(t.persistenceSettings.cacheSizeBytes),t.cs,Dr(),xr(),n,this.Sh,t.persistenceSettings.ka)},e.prototype.Ll=function(t){return new Jr},e.prototype.clearPersistence=function(t,e){return function(t){return n.__awaiter(this,void 0,void 0,function(){var e;return n.__generator(this,function(n){switch(n.label){case 0:return wr.Ln()?(e=t+"main",[4,wr.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}})})}(mo(t,e))},e}(fu)),pu=function(){function t(){}return t.prototype.initialize=function(t,e){return n.__awaiter(this,void 0,void 0,function(){var r=this;return n.__generator(this,function(n){switch(n.label){case 0:return this.ju?[3,2]:(this.ju=t.ju,this.Sh=t.Sh,this.Ku=this.Gl(e),this.ph=this.zl(e),this.bh=this.Hl(e),this.fi=this.Yl(e),this.Sh.di=function(t){return As(r.fi,t,1)},this.ph.Gu.Jl=Fs.bind(null,this.fi),[4,ps(this.ph,this.fi.Uh)]);case 1:n.sent(),n.label=2;case 2:return[2]}})})},t.prototype.Hl=function(t){return new Pr},t.prototype.Gl=function(t){var e,n=cu(t.bl.U),r=(e=t.bl,new su(e));return function(t,e,n){return new jo(t,r,n)}(t.credentials,0,n)},t.prototype.zl=function(t){var e,n,r,i,o,s=this;return e=this.ju,n=this.Ku,r=t.cs,i=function(t){return As(s.fi,t,0)},o=uu.Ln()?new uu:new au,new zo(e,n,r,i,o)},t.prototype.Yl=function(t){return function(t,e,n,r,i,o,s){var u=new bs(t,e,n,r,i,o);return s&&(u.qh=!0),u}(this.ju,this.ph,this.bh,this.Sh,t.Wl,t.Dh,!t.persistenceSettings.jl||!t.persistenceSettings.synchronizeTabs)},t.prototype.terminate=function(){return Ko(this.ph)},t}(),du=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.Xl(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.Xl(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Zl=function(){this.muted=!0},t.prototype.Xl=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),vu=function(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new f(h.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Q(1,"element")+".")}(0,t);for(var e=0;e<t.length;++e)if(O("FieldPath","string",e,t[e]),0===t[e].length)throw new f(h.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.t_=new S(t)},yu=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,e)||this}return n.__extends(e,t),e.documentId=function(){return new e(S.v().R())},e.prototype.isEqual=function(t){if(!(t instanceof e))throw B("isEqual","FieldPath",1,t);return this.t_.isEqual(t.t_)},e}(vu),gu=new RegExp("[~\\*/\\[\\]]"),mu=function(t){this.e_=t},wu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.n_=function(t){if(2!==t.s_)throw 1===t.s_?t.i_(this.e_+"() can only appear at the top level of your update data"):t.i_(this.e_+"() cannot be used with set() unless you pass {merge:true}");return t.We.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(mu);function _u(t,e,n){return new Ru({s_:3,r_:e.settings.r_,methodName:t.e_,o_:n},e.U,e.serializer,e.ignoreUndefinedProperties)}var bu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.n_=function(t){return new fn(t.path,new en)},e.prototype.isEqual=function(t){return t instanceof e},e}(mu),Iu=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).a_=n,r}return n.__extends(e,t),e.prototype.n_=function(t){var e=_u(this,t,!0),n=this.a_.map(function(t){return Fu(t,e)}),r=new nn(n);return new fn(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(mu),Eu=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).a_=n,r}return n.__extends(e,t),e.prototype.n_=function(t){var e=_u(this,t,!0),n=this.a_.map(function(t){return Fu(t,e)}),r=new on(n);return new fn(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(mu),Tu=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).c_=n,r}return n.__extends(e,t),e.prototype.n_=function(t){var e=new un(t.serializer,be(t.serializer,this.c_));return new fn(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(mu),Nu=function(){function t(t,e){if(L("GeoPoint",arguments,2),O("GeoPoint","number",1,t),O("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new f(h.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new f(h.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.u_=t,this.h_=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.u_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.h_},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.u_===t.u_&&this.h_===t.h_},t.prototype.toJSON=function(){return{latitude:this.u_,longitude:this.h_}},t.prototype.Y=function(t){return $(this.u_,t.u_)||$(this.h_,t.h_)},t}(),Au=function(t){this.l_=t},Su=/^__.*__$/,Du=function(t,e,n){this.__=t,this.f_=e,this.d_=n},xu=function(){function t(t,e,n){this.data=t,this.We=e,this.fieldTransforms=n}return t.prototype.w_=function(t,e){var n=[];return null!==this.We?n.push(new In(t,this.data,this.We,e)):n.push(new bn(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Tn(t,this.fieldTransforms)),n},t}(),Lu=function(){function t(t,e,n){this.data=t,this.We=e,this.fieldTransforms=n}return t.prototype.w_=function(t,e){var n=[new In(t,this.data,this.We,e)];return this.fieldTransforms.length>0&&n.push(new Tn(t,this.fieldTransforms)),n},t}();function ku(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw m()}}var Ru=function(){function t(t,e,n,r,i,o){this.settings=t,this.U=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.m_(),this.fieldTransforms=i||[],this.We=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"s_",{get:function(){return this.settings.s_},enumerable:!1,configurable:!0}),t.prototype.T_=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.U,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.We)},t.prototype.E_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.T_({path:n,o_:!1});return r.I_(t),r},t.prototype.A_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.T_({path:n,o_:!1});return r.m_(),r},t.prototype.R_=function(t){return this.T_({path:void 0,o_:!0})},t.prototype.i_=function(t){return Bu(t,this.settings.methodName,this.settings.g_||!1,this.path,this.settings.r_)},t.prototype.contains=function(t){return void 0!==this.We.find(function(e){return t.T(e)})||void 0!==this.fieldTransforms.find(function(e){return t.T(e.field)})},t.prototype.m_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.I_(this.path.get(t))},t.prototype.I_=function(t){if(0===t.length)throw this.i_("Document fields must not be empty");if(ku(this.s_)&&Su.test(t))throw this.i_('Document fields cannot begin and end with "__"')},t}(),Ou=function(){function t(t,e,n){this.U=t,this.ignoreUndefinedProperties=e,this.serializer=n||cu(t)}return t.prototype.P_=function(t,e,n,r){return void 0===r&&(r=!1),new Ru({s_:t,methodName:e,r_:n,path:S.P(),o_:!1,g_:r},this.U,this.serializer,this.ignoreUndefinedProperties)},t}();function Pu(t,e,n,r,i,o){void 0===o&&(o={});var s=t.P_(o.merge||o.mergeFields?2:0,e,n,i);ju("Data must be an object, but it was:",s,r);var u,a,c=Mu(r,s);if(o.merge)u=new hn(s.We),a=s.fieldTransforms;else if(o.mergeFields){for(var l=[],p=0,d=o.mergeFields;p<d.length;p++){var v=d[p],y=void 0;if(v instanceof vu)y=v.t_;else{if("string"!=typeof v)throw m();y=zu(e,v,n)}if(!s.contains(y))throw new f(h.INVALID_ARGUMENT,"Field '"+y+"' is specified in your field mask but missing from your input data.");Wu(l,y)||l.push(y)}u=new hn(l),a=s.fieldTransforms.filter(function(t){return u.Ye(t.field)})}else u=null,a=s.fieldTransforms;return new xu(new xn(c),u,a)}function Vu(t,e,n,r){var i=t.P_(1,e,n);ju("Data must be an object, but it was:",i,r);var o=[],s=new Ln;I(r,function(t,r){var u=zu(e,t,n),a=i.A_(u);if(r instanceof wu||r instanceof Au&&r.l_ instanceof wu)o.push(u);else{var c=Fu(r,a);null!=c&&(o.push(u),s.set(u,c))}});var u=new hn(o);return new Lu(s.Xe(),u,i.fieldTransforms)}function Uu(t,e,n,r,i,o){var s=t.P_(1,e,n),u=[Gu(e,r,n)],a=[i];if(o.length%2!=0)throw new f(h.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(Gu(e,o[c])),a.push(o[c+1]);for(var l=[],p=new Ln,d=u.length-1;d>=0;--d)if(!Wu(l,u[d])){var v=u[d],y=a[d],g=s.A_(v);if(y instanceof wu||y instanceof Au&&y.l_ instanceof wu)l.push(v);else{var m=Fu(y,g);null!=m&&(l.push(v),p.set(v,m))}}var w=new hn(l);return new Lu(p.Xe(),w,s.fieldTransforms)}function Cu(t,e,n,r){return void 0===r&&(r=!1),Fu(n,t.P_(r?4:3,e))}function Fu(t,e){if(t instanceof Au&&(t=t.l_),qu(t))return ju("Unsupported field value:",e,t),Mu(t,e);if(t instanceof mu)return function(t,e){if(!ku(e.s_))throw e.i_(t.e_+"() can only be used with update() and set()");if(!e.path)throw e.i_(t.e_+"() is not currently supported inside arrays");var n=t.n_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.We.push(e.path),t instanceof Array){if(e.settings.o_&&4!==e.s_)throw e.i_("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Fu(o[i],e.R_(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return be(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ut.fromDate(t);return{timestampValue:Ie(e.serializer,n)}}if(t instanceof ut){var r=new ut(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Ie(e.serializer,r)}}if(t instanceof Nu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof tt)return{bytesValue:Ee(e.serializer,t.q)};if(t instanceof Du){var i=e.U,o=t.__;if(!o.isEqual(i))throw e.i_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:Ae(t.__||e.U,t.f_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.i_("Unsupported field value: "+j(t))}(t,e)}function Mu(t,e){var n={};return E(t)?e.path&&e.path.length>0&&e.We.push(e.path):I(t,function(t,r){var i=Fu(r,e.E_(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function qu(t){return!("object"!=e(t)||null===t||t instanceof Array||t instanceof Date||t instanceof ut||t instanceof Nu||t instanceof tt||t instanceof Du||t instanceof mu)}function ju(t,e,n){if(!qu(n)||!q(n)){var r=j(n);throw"an object"===r?e.i_(t+" a custom object"):e.i_(t+" "+r)}}function Gu(t,e,n){if(e instanceof vu)return e.t_;if("string"==typeof e)return zu(t,e);throw Bu("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function zu(t,e,r){try{return function(t){if(t.search(gu)>=0)throw new f(h.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(yu.bind.apply(yu,n.__spreadArrays([void 0],t.split("."))))}catch(n){throw new f(h.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).t_}catch(e){throw Bu((i=e)instanceof Error?i.message:i.toString(),t,!1,void 0,r)}var i}function Bu(t,e,n,r,i){var o=r&&!r.m(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new f(h.INVALID_ARGUMENT,(u+=". ")+t+a)}function Wu(t,e){return t.some(function(t){return t.isEqual(e)})}var Ku=function(){function t(t){this.Ku=t,this.y_=new Map,this.mutations=[],this.V_=!1,this.p_=null,this.b_=new Set}return t.prototype.v_=function(t){return n.__awaiter(this,void 0,void 0,function(){var e,r=this;return n.__generator(this,function(i){switch(i.label){case 0:if(this.S_(),this.mutations.length>0)throw new f(h.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s,u,a;return n.__generator(this,function(n){switch(n.label){case 0:return r=_(t),i=Re(r.serializer)+"/documents",o={documents:e.map(function(t){return De(r.serializer,t)})},[4,r.ku("BatchGetDocuments",i,o)];case 1:return s=n.sent(),u=new Map,s.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){w(!!e.found),e.found.name,e.found.updateTime;var n=xe(t,e.found.name),r=Ne(e.found.updateTime),i=new xn({mapValue:{fields:e.found.fields}});return new On(n,r,i,{})}(t,e):"missing"in e?function(t,e){w(!!e.missing),w(!!e.readTime);var n=xe(t,e.missing),r=Ne(e.readTime);return new Pn(n,r)}(t,e):m()}(r.serializer,t);u.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=u.get(t.toString());w(!!e),a.push(e)}),a)]}})})}(this.Ku,t)];case 1:return[2,((e=i.sent()).forEach(function(t){t instanceof Pn||t instanceof On?r.D_(t):m()}),e)]}})})},t.prototype.set=function(t,e){this.write(e.w_(t,this.Ge(t))),this.b_.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.w_(t,this.C_(t)))}catch(t){this.p_=t}this.b_.add(t.toString())},t.prototype.delete=function(t){this.write([new Sn(t,this.Ge(t))]),this.b_.add(t.toString())},t.prototype.commit=function(){return n.__awaiter(this,void 0,void 0,function(){var t,e=this;return n.__generator(this,function(r){switch(r.label){case 0:if(this.S_(),this.p_)throw this.p_;return t=this.y_,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=D.D(n);e.mutations.push(new Dn(r,e.Ge(r)))}),[4,function(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o;return n.__generator(this,function(n){switch(n.label){case 0:return r=_(t),i=Re(r.serializer)+"/documents",o={writes:e.map(function(t){return Ve(r.serializer,t)})},[4,r.$u("Commit",i,o)];case 1:return n.sent(),[2]}})})}(this.Ku,this.mutations)];case 1:return r.sent(),this.V_=!0,[2]}})})},t.prototype.D_=function(t){var e;if(t instanceof On)e=t.version;else{if(!(t instanceof Pn))throw m();e=at.min()}var n=this.y_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new f(h.ABORTED,"Document version changed between two reads.")}else this.y_.set(t.key.toString(),e)},t.prototype.Ge=function(t){var e=this.y_.get(t.toString());return!this.b_.has(t.toString())&&e?pn.updateTime(e):pn.ze()},t.prototype.C_=function(t){var e=this.y_.get(t.toString());if(!this.b_.has(t.toString())&&e){if(e.isEqual(at.min()))throw new f(h.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return pn.updateTime(e)}return pn.exists(!0)},t.prototype.write=function(t){this.S_(),this.mutations=this.mutations.concat(t)},t.prototype.S_=function(){},t}(),Qu=function(){function t(t,e,n,r){this.cs=t,this.Ku=e,this.updateFunction=n,this.ls=r,this.N_=5,this.ys=new gr(this.cs,"transaction_retry")}return t.prototype.run=function(){this.F_()},t.prototype.F_=function(){var t=this;this.ys.gn(function(){return n.__awaiter(t,void 0,void 0,function(){var t,e,r=this;return n.__generator(this,function(n){return t=new Ku(this.Ku),(e=this.x_(t))&&e.then(function(e){r.cs.ws(function(){return t.commit().then(function(){r.ls.resolve(e)}).catch(function(t){r.k_(t)})})}).catch(function(t){r.k_(t)}),[2]})})})},t.prototype.x_=function(t){try{var e=this.updateFunction(t);return!ct(e)&&e.catch&&e.then?e:(this.ls.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ls.reject(t),null}},t.prototype.k_=function(t){var e=this;this.N_>0&&this.M_(t)?(this.N_-=1,this.cs.ws(function(){return e.F_(),Promise.resolve()})):this.ls.reject(t)},t.prototype.M_=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!bt(e)}return!1},t}(),Hu=function(){function t(t,e){this.credentials=t,this.cs=e,this.clientId=Y.k(),this.O_=new yr}return t.prototype.start=function(t,e,r,i){var o=this;this.L_(),this.bl=t;var s=new yr,u=!1;return this.credentials.Hc(function(t){if(!u)return u=!0,d("FirestoreClient","Initializing. user=",t.uid),o.B_(e,r,i,t,s).then(o.O_.resolve,o.O_.reject);o.cs.Cs(function(){return function(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(n){switch(n.label){case 0:return(r=_(t)).cs.xs(),d("RemoteStore","RemoteStore received new credentials"),i=Zo(r),r.Yu.add(3),[4,Wo(r)];case 1:return n.sent(),i&&r.th.set("Unknown"),[4,r.Gu.Jl(e)];case 2:return n.sent(),r.Yu.delete(3),[4,Bo(r)];case 3:return n.sent(),[2]}})})}(o.ph,t)})}),this.cs.ws(function(){return o.O_.promise}),s.promise},t.prototype.enableNetwork=function(){var t=this;return this.L_(),this.cs.enqueue(function(){return t.persistence.tc(!0),function(t){var e=_(t);return e.Yu.delete(0),Bo(e)}(t.ph)})},t.prototype.B_=function(t,e,r,i,o){return n.__awaiter(this,void 0,void 0,function(){var s,u,a=this;return n.__generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),s={cs:this.cs,bl:this.bl,clientId:this.clientId,credentials:this.credentials,Wl:i,Dh:100,persistenceSettings:r},[4,t.initialize(s)];case 1:return c.sent(),[4,e.initialize(t,s)];case 2:return c.sent(),this.persistence=t.persistence,this.Sh=t.Sh,this.ju=t.ju,this.ql=t.ql,this.Ku=e.Ku,this.ph=e.ph,this.fi=e.fi,this.q_=e.bh,this.q_.Us=Is.bind(null,this.fi),this.q_.js=Ts.bind(null,this.fi),this.persistence.Za(function(){return n.__awaiter(a,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),o.resolve(),[3,4];case 3:if(u=c.sent(),o.reject(u),!this.U_(u))throw u;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+u),this.B_(new fu,new pu,{jl:!1},i,o))];case 4:return[2]}})})},t.prototype.U_=function(t){return"FirebaseError"===t.name?t.code===h.FAILED_PRECONDITION||t.code===h.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},t.prototype.L_=function(){if(this.cs.ps)throw new f(h.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.disableNetwork=function(){var t=this;return this.L_(),this.cs.enqueue(function(){return t.persistence.tc(!1),function(t){return n.__awaiter(this,void 0,void 0,function(){var e;return n.__generator(this,function(n){switch(n.label){case 0:return(e=_(t)).Yu.add(0),[4,Wo(e)];case 1:return n.sent(),e.th.set("Offline"),[2]}})})}(t.ph)})},t.prototype.terminate=function(){var t=this;this.cs.Ds();var e=new yr;return this.cs.bs(function(){return n.__awaiter(t,void 0,void 0,function(){var t,r;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),this.ql&&this.ql.stop(),[4,Ko(this.ph)];case 1:return n.sent(),[4,this.Sh.Di()];case 2:return n.sent(),[4,this.persistence.Di()];case 3:return n.sent(),this.credentials.Yc(),e.resolve(),[3,5];case 4:return t=n.sent(),r=Rr(t,"Failed to shutdown persistence"),e.reject(r),[3,5];case 5:return[2]}})})}),e.promise},t.prototype.waitForPendingWrites=function(){var t=this;this.L_();var e=new yr;return this.cs.ws(function(){return function(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s,u;return n.__generator(this,function(n){switch(n.label){case 0:Zo((r=_(t)).ph)||d("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,function(t){var e=_(r.ju);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Sr.qo(t)})}()];case 2:return-1===(i=n.sent())?[2,void e.resolve()]:((o=r.Lh.get(i)||[]).push(e),r.Lh.set(i,o),[3,4]);case 3:return s=n.sent(),u=Rr(s,"Initialization of waitForPendingWrites() operation failed"),e.reject(u),[3,4];case 4:return[2]}})})}(t.fi,e)}),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.L_();var i=new du(n),o=new qr(t,i,e);return this.cs.ws(function(){return Vr(r.q_,o)}),function(){i.Zl(),r.cs.ws(function(){return Ur(r.q_,o)})}},t.prototype.Q_=function(t){return n.__awaiter(this,void 0,void 0,function(){var e,r=this;return n.__generator(this,function(i){switch(i.label){case 0:return this.L_(),[4,this.O_.promise];case 1:return i.sent(),e=new yr,[2,(this.cs.ws(function(){return function(t,e,r){return n.__awaiter(this,void 0,void 0,function(){var i,o,s;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,function(t,e){var n=_(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Cc.Cr(t,e)})}(t,e)];case 1:return(i=n.sent())instanceof On?r.resolve(i):i instanceof Pn?r.resolve(null):r.reject(new f(h.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return o=n.sent(),s=Rr(o,"Failed to get document '"+e+" from cache"),r.reject(s),[3,3];case 3:return[2]}})})}(r.ju,t,e)}),e.promise)]}})})},t.prototype.W_=function(t,e){return void 0===e&&(e={}),n.__awaiter(this,void 0,void 0,function(){var r,i=this;return n.__generator(this,function(n){switch(n.label){case 0:return this.L_(),[4,this.O_.promise];case 1:return n.sent(),r=new yr,[2,(this.cs.ws(function(){return function(t,e,n,r,i){var o=new du({next:function(o){e.ws(function(){return Ur(t,s)});var u=o.docs.has(n);!u&&o.fromCache?i.reject(new f(h.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&o.fromCache&&r&&"server"===r.source?i.reject(new f(h.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new qr(Fn(n.path),o,{includeMetadataChanges:!0,Xs:!0});return Vr(t,s)}(i.q_,i.cs,t,e,r)}),r.promise)]}})})},t.prototype.j_=function(t){return n.__awaiter(this,void 0,void 0,function(){var e,r=this;return n.__generator(this,function(i){switch(i.label){case 0:return this.L_(),[4,this.O_.promise];case 1:return i.sent(),e=new yr,[2,(this.cs.ws(function(){return function(t,e,r){return n.__awaiter(this,void 0,void 0,function(){var i,o,s,u,a,c;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Ao(t,e,!0)];case 1:return i=n.sent(),o=new ms(e,i.Fc),s=o.wh(i.documents),u=o.yr(s,!1),r.resolve(u.snapshot),[3,3];case 2:return a=n.sent(),c=Rr(a,"Failed to execute query '"+e+" against cache"),r.reject(c),[3,3];case 3:return[2]}})})}(r.ju,t,e)}),e.promise)]}})})},t.prototype.K_=function(t,e){return void 0===e&&(e={}),n.__awaiter(this,void 0,void 0,function(){var r,i=this;return n.__generator(this,function(n){switch(n.label){case 0:return this.L_(),[4,this.O_.promise];case 1:return n.sent(),r=new yr,[2,(this.cs.ws(function(){return function(t,e,n,r,i){var o=new du({next:function(n){e.ws(function(){return Ur(t,s)}),n.fromCache&&"server"===r.source?i.reject(new f(h.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new qr(n,o,{includeMetadataChanges:!0,Xs:!0});return Vr(t,s)}(i.q_,i.cs,t,e,r)}),r.promise)]}})})},t.prototype.write=function(t){var e=this;this.L_();var r=new yr;return this.cs.ws(function(){return function(t,e,r){return n.__awaiter(this,void 0,void 0,function(){var i,o,s,u;return n.__generator(this,function(n){switch(n.label){case 0:i=Ys(t),n.label=1;case 1:return n.trys.push([1,5,,6]),[4,function(t,e){var n,r=_(t),i=ut.now(),o=e.reduce(function(t,e){return t.add(e.key)},Vt());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Cc.kr(t,o).next(function(o){n=o;for(var s=[],u=0,a=e;u<a.length;u++){var c=a[u],h=mn(c,n.get(c.key));null!=h&&s.push(new In(c.key,h,kn(h.proto.mapValue),pn.exists(!0)))}return r.Sr.ko(t,i,s,e)})}).then(function(t){var e=t.lr(n);return{batchId:t.batchId,wr:e}})}(i.ju,e)];case 2:return o=n.sent(),i.Sh.xi(o.batchId),function(t,e,n){var r=t.Oh[t.currentUser.ti()];r||(r=new Et($)),r=r.ot(e,n),t.Oh[t.currentUser.ti()]=r}(i,o.batchId,r),[4,Cs(i,o.wr)];case 3:return n.sent(),[4,ss(i.ph)];case 4:return n.sent(),[3,6];case 5:return s=n.sent(),u=Rr(s,"Failed to persist write"),r.reject(u),[3,6];case 6:return[2]}})})}(e.fi,t,r)}),r.promise},t.prototype.U=function(){return this.bl.U},t.prototype.G_=function(t){var e=this;this.L_();var r=new du(t);return this.cs.ws(function(){return n.__awaiter(e,void 0,void 0,function(){return n.__generator(this,function(t){return[2,function(t,e){_(t).qs.add(e),e.next()}(this.q_,r)]})})}),function(){r.Zl(),e.cs.ws(function(){return n.__awaiter(e,void 0,void 0,function(){return n.__generator(this,function(t){return[2,function(t,e){_(t).qs.delete(e)}(this.q_,r)]})})})}},Object.defineProperty(t.prototype,"z_",{get:function(){return this.cs.ps},enumerable:!1,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.L_();var n=new yr;return this.cs.ws(function(){return new Qu(e.cs,e.Ku,t,n).run(),Promise.resolve()}),n.promise},t}();function Yu(t){return function(t,n){if("object"!=e(t)||null===t)return!1;for(var r=t,i=0,o=["next","error","complete"];i<o.length;i++){var s=o[i];if(s in r&&"function"==typeof r[s])return!0}return!1}(t)}var $u=function(){function t(t,e,n,r,i){this.U=t,this.timestampsInSnapshots=e,this.H_=n,this.Y_=r,this.J_=i}return t.prototype.X_=function(t){switch(te(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ae(t.integerValue||t.doubleValue);case 3:return this.Z_(t.timestampValue);case 4:return this.tf(t);case 5:return t.stringValue;case 6:return this.J_(ce(t.bytesValue));case 7:return this.ef(t.referenceValue);case 8:return this.nf(t.geoPointValue);case 9:return this.sf(t.arrayValue);case 10:return this.if(t.mapValue);default:throw m()}},t.prototype.if=function(t){var e=this,n={};return I(t.fields||{},function(t,r){n[t]=e.X_(r)}),n},t.prototype.nf=function(t){return new Nu(ae(t.latitude),ae(t.longitude))},t.prototype.sf=function(t){var e=this;return(t.values||[]).map(function(t){return e.X_(t)})},t.prototype.tf=function(t){switch(this.H_){case"previous":var e=Xt(t);return null==e?null:this.X_(e);case"estimate":return this.Z_(Jt(t));default:return null}},t.prototype.Z_=function(t){var e=ue(t),n=new ut(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},t.prototype.ef=function(t){var e=N.g(t);w($e(e));var n=new ot(e.get(1),e.get(3)),r=new D(e.u(5));return n.isEqual(this.U)||v("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.U.projectId+"/"+this.U.database+") instead."),this.Y_(r)},t}(),Xu=ci.ho,Ju=function(){function t(t){var e,n,r,i,o;if(void 0===t.host){if(void 0!==t.ssl)throw new f(h.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else V("settings","non-empty string","host",t.host),this.host=t.host,U("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(z("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","experimentalAutoDetectLongPolling","ignoreUndefinedProperties"]),U("settings","object","credentials",t.credentials),this.credentials=t.credentials,U("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),U("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?v("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&v("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,U("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=ci._o;else{if(t.cacheSizeBytes!==Xu&&t.cacheSizeBytes<ci.lo)throw new f(h.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+ci.lo);this.cacheSizeBytes=t.cacheSizeBytes}U("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.experimentalForceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i,U("settings","boolean","experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalAutoDetectLongPolling=null!==(o=t.experimentalAutoDetectLongPolling)&&void 0!==o&&o,function(t,e,n,r){if(!0===e&&!0===r)throw new f(h.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Zu=function(){function t(r,i,o,s){var u=this;if(void 0===o&&(o=new fu),void 0===s&&(s=new pu),this.rf=o,this.af=s,this.cf=null,this.uf=new kr,this.INTERNAL={delete:function(){return n.__awaiter(u,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return this.hf(),[4,this.lf.terminate()];case 1:return t.sent(),[2]}})})}},"object"==e(r.options)){var a=r;this.cf=a,this.__=t._f(a),this.ff=a.name,this.df=new Vo(i)}else{var c=r;if(!c.projectId)throw new f(h.INVALID_ARGUMENT,"Must provide projectId");this.__=new ot(c.projectId,c.database),this.ff="[DEFAULT]",this.df=new Po}this.wf=new Ju({})}return Object.defineProperty(t.prototype,"mf",{get:function(){return this.Tf||(this.Tf=new Ou(this.__,this.wf.ignoreUndefinedProperties)),this.Tf},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){L("Firestore.settings",arguments,1),O("Firestore.settings","object",1,t),t.merge&&delete(t=Object.assign(Object.assign({},this.wf),t)).merge;var n=new Ju(t);if(this.lf&&!this.wf.isEqual(n))throw new f(h.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this.wf=n,void 0!==n.credentials&&(this.df=function(t){if(!t)return new Po;switch(t.type){case"gapi":var n=t.client;return w(!("object"!=e(n)||null===n||!n.auth||!n.auth.getAuthHeaderValueForFirstParty)),new Co(n,t.sessionIndex||"0");case"provider":return t.client;default:throw new f(h.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(n.credentials))},t.prototype.enableNetwork=function(){return this.hf(),this.lf.enableNetwork()},t.prototype.disableNetwork=function(){return this.hf(),this.lf.disableNetwork()},t.prototype.enablePersistence=function(t){var e,n;if(this.lf)throw new f(h.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&v("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new f(h.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Ef(this.rf,this.af,{jl:!0,cacheSizeBytes:this.wf.cacheSizeBytes,synchronizeTabs:r,ka:i})},t.prototype.clearPersistence=function(){return n.__awaiter(this,void 0,void 0,function(){var t,e=this;return n.__generator(this,function(r){if(void 0!==this.lf&&!this.lf.z_)throw new f(h.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return t=new yr,[2,(this.uf.bs(function(){return n.__awaiter(e,void 0,void 0,function(){var e;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.rf.clearPersistence(this.__,this.ff)];case 1:return n.sent(),t.resolve(),[3,3];case 2:return e=n.sent(),t.reject(e),[3,3];case 3:return[2]}})})}),t.promise)]})})},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"If",{get:function(){return this.hf(),this.lf.z_},enumerable:!1,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.hf(),this.lf.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.hf(),Yu(t))return this.lf.G_(t);O("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.lf.G_(e)},t.prototype.hf=function(){return this.lf||this.Ef(new fu,new pu,{jl:!1}),this.lf},t.prototype.Af=function(){return new it(this.__,this.ff,this.wf.host,this.wf.ssl,this.wf.experimentalForceLongPolling,this.wf.experimentalAutoDetectLongPolling)},t.prototype.Ef=function(t,e,n){var r=this.Af();return this.lf=new Hu(this.df,this.uf),this.lf.start(r,t,e,n)},t._f=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new f(h.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new f(h.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new ot(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.cf)throw new f(h.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.cf},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){return L("Firestore.collection",arguments,1),O("Firestore.collection","non-empty string",1,t),this.hf(),new da(N.g(t),this,null)},t.prototype.doc=function(t){return L("Firestore.doc",arguments,1),O("Firestore.doc","non-empty string",1,t),this.hf(),na.Rf(N.g(t),this,null)},t.prototype.collectionGroup=function(t){if(L("Firestore.collectionGroup",arguments,1),O("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new f(h.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.hf(),new la(function(t){return new Un(N.P(),t)}(t),this,null)},t.prototype.runTransaction=function(t){var e=this;return L("Firestore.runTransaction",arguments,1),O("Firestore.runTransaction","function",1,t),this.hf().transaction(function(n){return t(new ta(e,n))})},t.prototype.batch=function(){return this.hf(),new ea(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(p()){case i.LogLevel.DEBUG:return"debug";case i.LogLevel.ERROR:return"error";case i.LogLevel.SILENT:return"silent";case i.LogLevel.WARN:return"warn";case i.LogLevel.INFO:return"info";case i.LogLevel.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),t.setLogLevel=function(t){var e;L("Firestore.setLogLevel",arguments,1),F("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),e=t,l.setLogLevel(e)},t.prototype.gf=function(){return this.wf.timestampsInSnapshots},t.prototype.Pf=function(){return this.wf},t}(),ta=function(){function t(t,e){this.yf=t,this.Vf=e}return t.prototype.get=function(t){var e=this;L("Transaction.get",arguments,1);var n=ma("Transaction.get",t,this.yf);return this.Vf.v_([n.f_]).then(function(t){if(!t||1!==t.length)return m();var r=t[0];if(r instanceof Pn)return new ia(e.yf,n.f_,null,!1,!1,n.d_);if(r instanceof On)return new ia(e.yf,n.f_,r,!1,!1,n.d_);throw m()})},t.prototype.set=function(t,e,n){R("Transaction.set",arguments,2,3);var r=ma("Transaction.set",t,this.yf);n=va("Transaction.set",n);var i=_a(r.d_,e,n),o=Pu(this.yf.mf,"Transaction.set",r.f_,i,null!==r.d_,n);return this.Vf.set(r.f_,o),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return"string"==typeof e||e instanceof yu?(k("Transaction.update",arguments,3),r=ma("Transaction.update",t,this.yf),i=Uu(this.yf.mf,"Transaction.update",r.f_,e,n,o)):(L("Transaction.update",arguments,2),r=ma("Transaction.update",t,this.yf),i=Vu(this.yf.mf,"Transaction.update",r.f_,e)),this.Vf.update(r.f_,i),this},t.prototype.delete=function(t){L("Transaction.delete",arguments,1);var e=ma("Transaction.delete",t,this.yf);return this.Vf.delete(e.f_),this},t}(),ea=function(){function t(t){this.yf=t,this.pf=[],this.bf=!1}return t.prototype.set=function(t,e,n){R("WriteBatch.set",arguments,2,3),this.vf();var r=ma("WriteBatch.set",t,this.yf);n=va("WriteBatch.set",n);var i=_a(r.d_,e,n),o=Pu(this.yf.mf,"WriteBatch.set",r.f_,i,null!==r.d_,n);return this.pf=this.pf.concat(o.w_(r.f_,pn.ze())),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.vf(),"string"==typeof e||e instanceof yu?(k("WriteBatch.update",arguments,3),r=ma("WriteBatch.update",t,this.yf),i=Uu(this.yf.mf,"WriteBatch.update",r.f_,e,n,o)):(L("WriteBatch.update",arguments,2),r=ma("WriteBatch.update",t,this.yf),i=Vu(this.yf.mf,"WriteBatch.update",r.f_,e)),this.pf=this.pf.concat(i.w_(r.f_,pn.exists(!0))),this},t.prototype.delete=function(t){L("WriteBatch.delete",arguments,1),this.vf();var e=ma("WriteBatch.delete",t,this.yf);return this.pf=this.pf.concat(new Sn(e.f_,pn.ze())),this},t.prototype.commit=function(){return this.vf(),this.bf=!0,this.pf.length>0?this.yf.hf().write(this.pf):Promise.resolve()},t.prototype.vf=function(){if(this.bf)throw new f(h.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),na=function(t){function r(e,n,r){var i=this;return(i=t.call(this,n.__,e,r)||this).f_=e,i.firestore=n,i.d_=r,i.lf=i.firestore.hf(),i}return n.__extends(r,t),r.Rf=function(t,e,n){if(t.length%2!=0)throw new f(h.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.R()+" has "+t.length);return new r(new D(t),e,n)},Object.defineProperty(r.prototype,"id",{get:function(){return this.f_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"parent",{get:function(){return new da(this.f_.path.h(),this.firestore,this.d_)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"path",{get:function(){return this.f_.path.R()},enumerable:!1,configurable:!0}),r.prototype.collection=function(t){if(L("DocumentReference.collection",arguments,1),O("DocumentReference.collection","non-empty string",1,t),!t)throw new f(h.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=N.g(t);return new da(this.f_.path.child(e),this.firestore,null)},r.prototype.isEqual=function(t){if(!(t instanceof r))throw B("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.f_.isEqual(t.f_)&&this.d_===t.d_},r.prototype.set=function(t,e){R("DocumentReference.set",arguments,1,2),e=va("DocumentReference.set",e);var n=_a(this.d_,t,e),r=Pu(this.firestore.mf,"DocumentReference.set",this.f_,n,null!==this.d_,e);return this.lf.write(r.w_(this.f_,pn.ze()))},r.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof yu?(k("DocumentReference.update",arguments,2),n=Uu(this.firestore.mf,"DocumentReference.update",this.f_,t,e,r)):(L("DocumentReference.update",arguments,1),n=Vu(this.firestore.mf,"DocumentReference.update",this.f_,t)),this.lf.write(n.w_(this.f_,pn.exists(!0)))},r.prototype.delete=function(){return L("DocumentReference.delete",arguments,0),this.lf.write([new Sn(this.f_,pn.ze())])},r.prototype.onSnapshot=function(){for(var t,n,r,i=this,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];R("DocumentReference.onSnapshot",arguments,1,4);var u={includeMetadataChanges:!1},a=0;"object"!=e(o[a])||Yu(o[a])||(z("DocumentReference.onSnapshot",u=o[a],["includeMetadataChanges"]),U("DocumentReference.onSnapshot","boolean","includeMetadataChanges",u.includeMetadataChanges),a++);var c={includeMetadataChanges:u.includeMetadataChanges};if(Yu(o[a])){var h=o[a];o[a]=null===(t=h.next)||void 0===t?void 0:t.bind(h),o[a+1]=null===(n=h.error)||void 0===n?void 0:n.bind(h),o[a+2]=null===(r=h.complete)||void 0===r?void 0:r.bind(h)}else O("DocumentReference.onSnapshot","function",a,o[a]),P("DocumentReference.onSnapshot","function",a+1,o[a+1]),P("DocumentReference.onSnapshot","function",a+2,o[a+2]);var f={next:function(t){o[a]&&o[a](i.Sf(t))},error:o[a+1],complete:o[a+2]};return this.lf.listen(Fn(this.f_.path),c,f)},r.prototype.get=function(t){var e=this;R("DocumentReference.get",arguments,0,1),ga("DocumentReference.get",t);var n=this.firestore.hf();return t&&"cache"===t.source?n.Q_(this.f_).then(function(t){return new ia(e.firestore,e.f_,t,!0,t instanceof On&&t.Je,e.d_)}):n.W_(this.f_,t).then(function(t){return e.Sf(t)})},r.prototype.withConverter=function(t){return new r(this.f_,this.firestore,t)},r.prototype.Sf=function(t){var e=t.docs.get(this.f_);return new ia(this.firestore,this.f_,e,t.fromCache,t.hasPendingWrites,this.d_)},r}(Du),ra=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),ia=function(){function t(t,e,n,r,i,o){this.yf=t,this.f_=e,this.Df=n,this.Cf=r,this.Nf=i,this.d_=o}return t.prototype.data=function(t){var e=this;if(R("DocumentSnapshot.data",arguments,0,1),t=ya("DocumentSnapshot.data",t),this.Df){if(this.d_){var n=new oa(this.yf,this.f_,this.Df,this.Cf,this.Nf,null);return this.d_.fromFirestore(n,t)}return new $u(this.yf.__,this.yf.gf(),t.serverTimestamps||"none",function(t){return new na(t,e.yf,null)},function(t){return new rt(t)}).X_(this.Df.rn())}},t.prototype.get=function(t,e){var n=this;if(R("DocumentSnapshot.get",arguments,1,2),e=ya("DocumentSnapshot.get",e),this.Df){var r=this.Df.data().field(Gu("DocumentSnapshot.get",t,this.f_));if(null!==r)return new $u(this.yf.__,this.yf.gf(),e.serverTimestamps||"none",function(t){return new na(t,n.yf,n.d_)},function(t){return new rt(t)}).X_(r)}},Object.defineProperty(t.prototype,"id",{get:function(){return this.f_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new na(this.f_,this.yf,this.d_)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this.Df},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new ra(this.Nf,this.Cf)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw B("isEqual","DocumentSnapshot",1,e);return this.yf===e.yf&&this.Cf===e.Cf&&this.f_.isEqual(e.f_)&&(null===this.Df?null===e.Df:this.Df.isEqual(e.Df))&&this.d_===e.d_},t}(),oa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.data=function(e){return t.prototype.data.call(this,e)},e}(ia);function sa(t,e,n,r,i,o,s){var u;if(i.p()){if("array-contains"===o||"array-contains-any"===o)throw new f(h.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){ca(s,o);for(var a=[],c=0,l=s;c<l.length;c++){var p=l[c];a.push(aa(r,t,p))}u={arrayValue:{values:a}}}else u=aa(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||ca(s,o),u=Cu(n,e,s,"in"===o||"not-in"===o);var d=tr.create(i,o,u);return function(t,e){if(e.hn()){var n=Gn(t);if(null!==n&&!n.isEqual(e.field))throw new f(h.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=jn(t);null!==r&&ha(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==i)throw i===e.op?new f(h.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new f(h.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,d),d}function ua(t,e,n){if(null!==t.startAt)throw new f(h.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new f(h.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new pr(e,n);return function(t,e){if(null===jn(t)){var n=Gn(t);null!==n&&ha(t,n,e.field)}}(t,r),r}function aa(t,e,n){if("string"==typeof n){if(""===n)throw new f(h.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!zn(e)&&-1!==n.indexOf("/"))throw new f(h.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(N.g(n));if(!D.F(r))throw new f(h.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return he(t,new D(r))}if(n instanceof Du)return he(t,n.f_);throw new f(h.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+j(n)+".")}function ca(t,e){if(!Array.isArray(t)||0===t.length)throw new f(h.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new f(h.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new f(h.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter(function(t){return Number.isNaN(t)}).length>0)throw new f(h.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}}function ha(t,e,n){if(!n.isEqual(e))throw new f(h.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function fa(t){if(qn(t)&&0===t.on.length)throw new f(h.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var la=function(){function t(t,e,n){this.Ff=t,this.firestore=e,this.d_=n}return t.prototype.where=function(e,n,r){L("Query.where",arguments,3),G("Query.where",3,r);var i=F("Query.where",["<","<=","==","!=",">=",">","array-contains","in","array-contains-any","not-in"],2,n),o=Gu("Query.where",e),s=sa(this.Ff,"Query.where",this.firestore.mf,this.firestore.__,o,i,r);return new t(function(t,e){var n=t.filters.concat([e]);return new Un(t.path,t.collectionGroup,t.on.slice(),n,t.limit,t.an,t.startAt,t.endAt)}(this.Ff,s),this.firestore,this.d_)},t.prototype.orderBy=function(e,n){var r;if(R("Query.orderBy",arguments,1,2),P("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r="asc";else{if("desc"!==n)throw new f(h.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r="desc"}var i=Gu("Query.orderBy",e),o=ua(this.Ff,i,r);return new t(function(t,e){var n=t.on.concat([e]);return new Un(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.an,t.startAt,t.endAt)}(this.Ff,o),this.firestore,this.d_)},t.prototype.limit=function(e){return L("Query.limit",arguments,1),O("Query.limit","number",1,e),W("Query.limit",1,e),new t(Kn(this.Ff,e,"F"),this.firestore,this.d_)},t.prototype.limitToLast=function(e){return L("Query.limitToLast",arguments,1),O("Query.limitToLast","number",1,e),W("Query.limitToLast",1,e),new t(Kn(this.Ff,e,"L"),this.firestore,this.d_)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];k("Query.startAt",arguments,1);var i=this.xf("Query.startAt",e,n,!0);return new t(Qn(this.Ff,i),this.firestore,this.d_)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];k("Query.startAfter",arguments,1);var i=this.xf("Query.startAfter",e,n,!1);return new t(Qn(this.Ff,i),this.firestore,this.d_)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];k("Query.endBefore",arguments,1);var i=this.xf("Query.endBefore",e,n,!0);return new t(Hn(this.Ff,i),this.firestore,this.d_)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];k("Query.endAt",arguments,1);var i=this.xf("Query.endAt",e,n,!1);return new t(Hn(this.Ff,i),this.firestore,this.d_)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw B("isEqual","Query",1,e);return this.firestore===e.firestore&&Yn(this.Ff,e.Ff)&&this.d_===e.d_},t.prototype.withConverter=function(e){return new t(this.Ff,this.firestore,e)},t.prototype.xf=function(t,r,i,o){if(G(t,1,r),r instanceof ia)return L(t,n.__spreadArrays([r],i),1),function(t,e,n,r,i){if(!r)throw new f(h.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,u=Bn(t);s<u.length;s++){var a=u[s];if(a.field.p())o.push(he(e,r.key));else{var c=r.field(a.field);if($t(c))throw new f(h.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var l=a.field.R();throw new f(h.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+l+"' (used as the orderBy) does not exist.")}o.push(c)}}return new cr(o,i)}(this.Ff,this.firestore.__,t,r.Df,o);var s=[r].concat(i);return function(t,n,r,i,o,s){var u=t.on;if(o.length>u.length)throw new f(h.INVALID_ARGUMENT,"Too many arguments provided to "+i+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],c=0;c<o.length;c++){var l=o[c];if(u[c].field.p()){if("string"!=typeof l)throw new f(h.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+i+"(), but got a "+e(l));if(!zn(t)&&-1!==l.indexOf("/"))throw new f(h.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+i+"() must be a plain document ID, but '"+l+"' contains a slash.");var p=t.path.child(N.g(l));if(!D.F(p))throw new f(h.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+i+"() must result in a valid document path, but '"+p+"' is not because it contains an odd number of segments.");var d=new D(p);a.push(he(n,d))}else{var v=Cu(r,i,l);a.push(v)}}return new cr(a,s)}(this.Ff,this.firestore.__,this.firestore.mf,t,s,o)},t.prototype.onSnapshot=function(){for(var t,n,r,i=this,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];R("Query.onSnapshot",arguments,1,4);var u={},a=0;if("object"!=e(o[a])||Yu(o[a])||(z("Query.onSnapshot",u=o[a],["includeMetadataChanges"]),U("Query.onSnapshot","boolean","includeMetadataChanges",u.includeMetadataChanges),a++),Yu(o[a])){var c=o[a];o[a]=null===(t=c.next)||void 0===t?void 0:t.bind(c),o[a+1]=null===(n=c.error)||void 0===n?void 0:n.bind(c),o[a+2]=null===(r=c.complete)||void 0===r?void 0:r.bind(c)}else O("Query.onSnapshot","function",a,o[a]),P("Query.onSnapshot","function",a+1,o[a+1]),P("Query.onSnapshot","function",a+2,o[a+2]);var h={next:function(t){o[a]&&o[a](new pa(i.firestore,i.Ff,t,i.d_))},error:o[a+1],complete:o[a+2]};return fa(this.Ff),this.firestore.hf().listen(this.Ff,u,h)},t.prototype.get=function(t){var e=this;R("Query.get",arguments,0,1),ga("Query.get",t),fa(this.Ff);var n=this.firestore.hf();return(t&&"cache"===t.source?n.j_(this.Ff):n.K_(this.Ff,t)).then(function(t){return new pa(e.firestore,e.Ff,t,e.d_)})},t}(),pa=function(){function t(t,e,n,r){this.yf=t,this.$f=e,this.kf=n,this.d_=r,this.Mf=null,this.Of=null,this.metadata=new ra(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.kf.docs.m()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.kf.docs.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;R("QuerySnapshot.forEach",arguments,1,2),O("QuerySnapshot.forEach","function",1,t),this.kf.docs.forEach(function(r){t.call(e,n.Lf(r,n.metadata.fromCache,n.kf.Wt.has(r.key)))})},Object.defineProperty(t.prototype,"query",{get:function(){return new la(this.$f,this.yf,this.d_)},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){t&&(z("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),U("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.kf.Kt)throw new f(h.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Mf&&this.Of===e||(this.Mf=function(t,e,n){if(t.Qt.m()){var r=0;return t.docChanges.map(function(e){var i=n(e.doc,t.fromCache,t.Wt.has(e.doc.key));return e.doc,{type:"added",doc:i,oldIndex:-1,newIndex:r++}})}var i=t.Qt;return t.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var r=n(e.doc,t.fromCache,t.Wt.has(e.doc.key)),o=-1,s=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(s=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:wa(e.type),doc:r,oldIndex:o,newIndex:s}})}(this.kf,e,this.Lf.bind(this)),this.Of=e),this.Mf},t.prototype.isEqual=function(e){if(!(e instanceof t))throw B("isEqual","QuerySnapshot",1,e);return this.yf===e.yf&&Yn(this.$f,e.$f)&&this.kf.isEqual(e.kf)&&this.d_===e.d_},t.prototype.Lf=function(t,e,n){return new oa(this.yf,t.key,t,e,n,this.d_)},t}(),da=function(t){function e(e,n,r){var i=this;if((i=t.call(this,Fn(e),n,r)||this).Bf=e,e.length%2!=1)throw new f(h.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.R()+" has "+e.length);return i}return n.__extends(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.Ff.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.Ff.path.h();return t.m()?null:new na(new D(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.Ff.path.R()},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){R("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Y.k()),O("CollectionReference.doc","non-empty string",1,t);var e=N.g(t);return na.Rf(this.Ff.path.child(e),this.firestore,this.d_)},e.prototype.add=function(t){L("CollectionReference.add",arguments,1);var e=this.d_?this.d_.toFirestore(t):t;O("CollectionReference.add","object",1,e);var n=this.doc();return new na(n.f_,this.firestore,null).set(e).then(function(){return n})},e.prototype.withConverter=function(t){return new e(this.Bf,this.firestore,t)},e}(la);function va(t,e){if(void 0===e)return{merge:!1};if(z(t,e,["merge","mergeFields"]),U(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new f(h.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+j(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new f(h.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+o+" was: "+j(r[o]))}(t,"mergeFields",0,r,function(t){return"string"==typeof t||t instanceof yu})}(t,0,0,e.mergeFields),void 0!==e.mergeFields&&void 0!==e.merge)throw new f(h.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function ya(t,e){return void 0===e?{}:(z(t,e,["serverTimestamps"]),C(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function ga(t,e){P(t,"object",1,e),e&&(z(t,e,["source"]),C(t,0,"source",e.source,["default","server","cache"]))}function ma(t,e,n){if(e instanceof Du){if(e.firestore!==n)throw new f(h.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw B(t,"DocumentReference",1,e)}function wa(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return m()}}function _a(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var ba=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.serverTimestamp=function(){x("FieldValue.serverTimestamp",arguments);var t=new bu("serverTimestamp");return t.e_="FieldValue.serverTimestamp",new e(t)},e.delete=function(){x("FieldValue.delete",arguments);var t=new wu("deleteField");return t.e_="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];k("FieldValue.arrayUnion",arguments,1);var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return k("arrayUnion()",arguments,1),new Iu("arrayUnion",t)}.apply(void 0,t);return r.e_="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];k("FieldValue.arrayRemove",arguments,1);var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return k("arrayRemove()",arguments,1),new Eu("arrayRemove",t)}.apply(void 0,t);return r.e_="FieldValue.arrayRemove",new e(r)},e.increment=function(t){O("FieldValue.increment","number",1,t),L("FieldValue.increment",arguments,1);var n=function(t){return new Tu("increment",t)}(t);return n.e_="FieldValue.increment",new e(n)},e.prototype.isEqual=function(t){return this.l_.isEqual(t.l_)},e}(Au),Ia={Firestore:Zu,GeoPoint:Nu,Timestamp:ut,Blob:rt,Transaction:ta,WriteBatch:ea,DocumentReference:na,DocumentSnapshot:ia,Query:la,QueryDocumentSnapshot:oa,QuerySnapshot:pa,CollectionReference:da,FieldPath:yu,FieldValue:ba,setLogLevel:Zu.setLogLevel,CACHE_SIZE_UNLIMITED:Xu};function Ea(t){!function(t,e){t.INTERNAL.registerComponent(new u.Component("firestore",function(t){return function(t,e){var n=new pu,r=new lu(n);return new Zu(t,e,r,n)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Ia)))}(t),t.registerVersion("@firebase/firestore","1.18.0")}Ea(c.default),exports.__PRIVATE_registerFirestore=Ea;
},{"tslib":"f2sD","@firebase/app":"dP58","@firebase/logger":"TUpU","@firebase/util":"xA6u","@firebase/webchannel-wrapper":"ueHA","@firebase/component":"nzQs","process":"pBGv"}],"vHL5":[function(require,module,exports) {
"use strict";require("@firebase/firestore");
},{"@firebase/firestore":"eA7g"}],"TX5A":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.config={apiKey:"AIzaSyB0TkZ83Fj0CIzn8AAmE-Osc92s3ER8hy8",authDomain:"neurosity-device.firebaseapp.com",databaseURL:"https://neurosity-device.firebaseio.com",projectId:"neurosity-device",storageBucket:"neurosity-device.appspot.com",messagingSenderId:"212595049674"};
},{}],"OERo":[function(require,module,exports) {
"use strict";function e(e){return r(e)||t(e)||n()}function n(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function t(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function r(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function a(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,n,t){return n&&a(e.prototype,n),t&&a(e,t),e}var u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var f=u(require("firebase/app"));require("firebase/database"),require("firebase/auth"),require("firebase/functions"),require("firebase/firestore");var s=require("./config");exports.SERVER_TIMESTAMP=f.default.database.ServerValue.TIMESTAMP;var p=function(){function n(e){i(this,n),this.app=this.getApp(e.deviceId),this.standalone=this.app.name===e.deviceId}return o(n,[{key:"getApp",value:function(n){var t=f.default.apps,r="undefined"!=typeof window&&"firebase"in window&&"apps"in window.firebase?window.firebase.apps:[],i=[].concat(e(t),e(r)).find(function(e){return"[DEFAULT]"===e.name&&e.options.databaseURL===s.config.databaseURL});if(i)return i;if(n){var a=n,o=t.find(function(e){return e.name===a});return o||f.default.initializeApp(s.config,a)}return f.default.initializeApp(s.config)}},{key:"goOnline",value:function(){this.app.database().goOnline()}},{key:"goOffline",value:function(){this.app.database().goOffline()}},{key:"disconnect",value:function(){return this.standalone?this.app.delete():Promise.resolve()}}]),n}();exports.FirebaseApp=p;
},{"firebase/app":"ZUoI","firebase/database":"Uuoh","firebase/auth":"zKjx","firebase/functions":"a7Bh","firebase/firestore":"vHL5","./config":"TX5A"}],"Cc51":[function(require,module,exports) {
"use strict";function e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(e,t){return i(e)||n(e,t)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function n(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],n=!0,i=!1,a=void 0;try{for(var u,o=e[Symbol.iterator]();!(n=(u=o.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(c){i=!0,a=c}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}return r}}function i(e){if(Array.isArray(e))return e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function s(e,t,r){return(s=c()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&f(i,r.prototype),i}).apply(null,arguments)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function u(e){try{c(n.next(e))}catch(t){a(t)}}function o(e){try{c(n.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(u,o)}c((n=n.apply(e,t||[])).next())})},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var h=require("rxjs"),p=require("rxjs/operators"),d=l(require("firebase/app")),m=d.default.database.ServerValue.TIMESTAMP;function b(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return s(d.default.User,t)}exports.credentialWithLink=d.default.auth.EmailAuthProvider.credentialWithLink,exports.createUser=b;var y=function(){function r(e){var t=this;a(this,r),this.app=e.app,this.app.auth().onAuthStateChanged(function(e){t.user=e})}return o(r,[{key:"auth",value:function(){return this.app.auth()}},{key:"onAuthStateChanged",value:function(){var e=this;return new h.Observable(function(t){e.app.auth().onAuthStateChanged(function(e){t.next(e)})})}},{key:"onLogin",value:function(){var e=this;return new h.Observable(function(t){var r=e.app.auth().onAuthStateChanged(function(e){e&&(t.next(e),t.complete())});return function(){return r()}})}},{key:"login",value:function(e){if("idToken"in e&&"providerId"in e){var t=new d.default.auth.OAuthProvider(e.providerId).credential(e.idToken);return this.app.auth().signInWithCredential(t)}if("email"in e&&"password"in e){var r=e.email,n=e.password;return this.app.auth().signInWithEmailAndPassword(r,n)}throw new Error("Either email/password or an idToken/providerId is required")}},{key:"logout",value:function(){return this.app.auth().signOut()}},{key:"getDevices",value:function(){var e;return v(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(e=this.user)||void 0===e?void 0:e.uid){t.next=3;break}return t.abrupt("return",Promise.reject("Please login."));case 3:return t.next=5,this.app.database().ref(this.getUserDevicesPath()).once("value");case 5:return r=t.sent,n=r.val(),t.abrupt("return",this.userDevicesToDeviceInfoList(n));case 8:case"end":return t.stop()}},t,this)}))}},{key:"addDevice",value:function(r){var n;return v(this,void 0,void 0,regeneratorRuntime.mark(function i(){var a,u,o,c,s,f,v,l,h,p,d,b;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(u=null===(n=this.user)||void 0===n?void 0:n.uid){i.next=3;break}return i.abrupt("return",Promise.reject("Please login."));case 3:return i.next=5,this.isDeviceIdValid(r).then(function(e){return[e]}).catch(function(e){return[!1,e]});case 5:if(o=i.sent,c=t(o,2),s=c[0],f=c[1],s){i.next=11;break}return i.abrupt("return",Promise.reject(f));case 11:return v=this.getDeviceClaimedByPath(r),l=this.getUserClaimedDevicePath(r),i.next=15,this.app.database().ref().update((a={},e(a,v,u),e(a,l,{claimedOn:m}),a)).then(function(){return[!1]}).catch(function(e){return[!0,e]});case 15:if(h=i.sent,p=t(h,2),d=p[0],b=p[1],!d){i.next=21;break}return i.abrupt("return",Promise.reject(b));case 21:case"end":return i.stop()}},i,this)}))}},{key:"removeDevice",value:function(e){var r;return v(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i,a,u,o,c,s,f,v;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(null===(r=this.user)||void 0===r?void 0:r.uid){n.next=3;break}return n.abrupt("return",Promise.reject("Please login."));case 3:return i=this.getDeviceClaimedByPath(e),a=this.getUserClaimedDevicePath(e),u=this.app.database().ref(i),o=this.app.database().ref(a),n.next=9,Promise.all([u.remove(),o.remove()]).then(function(){return[!1]}).catch(function(e){return[!0,e]});case 9:if(c=n.sent,s=t(c,2),f=s[0],v=s[1],!f){n.next=15;break}return n.abrupt("return",Promise.reject(v));case 15:case"end":return n.stop()}},n,this)}))}},{key:"isDeviceIdValid",value:function(e){return v(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=/[0-9A-Fa-f]{32}/g,e&&32===e.length&&r.test(e)){t.next=3;break}return t.abrupt("return",Promise.reject("The device id is incorrectly formatted."));case 3:return n=this.getDeviceClaimedByPath(e),i=this.app.database().ref(n),t.next=7,i.once("value").catch(function(){return null});case 7:if((a=t.sent)&&!a.exists()){t.next=10;break}return t.abrupt("return",Promise.reject("The device has already been claimed."));case 10:return t.abrupt("return",!0);case 11:case"end":return t.stop()}},t,this)}))}},{key:"onUserDevicesChange",value:function(){var e=this;return this.onAuthStateChanged().pipe(p.switchMap(function(t){if(!t)return h.empty();var r=e.getUserDevicesPath(),n=e.app.database().ref(r);return h.fromEventPattern(function(e){return n.on("value",e)},function(e){return n.off("value",e)}).pipe(p.map(function(e){return e.val()}),p.switchMap(function(t){return h.from(e.userDevicesToDeviceInfoList(t))}))}))}},{key:"userDevicesToDeviceInfoList",value:function(e){return v(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n,i,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.keys(null!=e?e:{}).map(function(e){return a.app.database().ref(a.getDeviceInfoPath(e)).once("value")}),t.next=3,Promise.all(r).then(function(e){return e.map(function(e){return e.val()})});case 3:return n=t.sent,(i=n.filter(function(e){return!!e})).sort(function(t,r){return e[t.deviceId].claimedOn-e[r.deviceId].claimedOn}),t.abrupt("return",i);case 7:case"end":return t.stop()}},t)}))}},{key:"hasDevicePermission",value:function(e){return v(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.getDeviceInfoPath(e),t.next=3,this.app.database().ref(r).once("value").then(function(){return!0}).catch(function(){return!1});case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}},t,this)}))}},{key:"getDeviceClaimedByPath",value:function(e){return"devices/".concat(e,"/status/claimedBy")}},{key:"getUserClaimedDevicePath",value:function(e){var t=this.user.uid;return"users/".concat(t,"/devices/").concat(e)}},{key:"getUserDevicesPath",value:function(){var e=this.user.uid;return"users/".concat(e,"/devices")}},{key:"getDeviceInfoPath",value:function(e){return"devices/".concat(e,"/info")}}]),r}();exports.FirebaseUser=y;
},{"rxjs":"iRqj","rxjs/operators":"cVrl","firebase/app":"ZUoI"}],"mSvX":[function(require,module,exports) {
"use strict";function e(e,c){return r(e)||t(e,c)||n()}function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function t(e,n){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var t=[],r=!0,c=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(t.push(i.value),!n||t.length!==n);r=!0);}catch(a){c=!0,o=a}finally{try{r||null==u.return||u.return()}finally{if(c)throw o}}return t}}function r(e){if(Array.isArray(e))return e}var c=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(c,o){function i(e){try{a(r.next(e))}catch(n){o(n)}}function u(e){try{a(r.throw(e))}catch(n){o(n)}}function a(e){var n;e.done?c(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(i,u)}a((r=r.apply(e,n||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var i=o(require("firebase/app")),u=i.default.database.ServerValue.TIMESTAMP;exports.createDeviceStore=function(n,t,r){var o=n.database().ref("devices/".concat(t)),i=o.child("subscriptions").push().key,a=o.child("clients/".concat(i)),s=[],f=function(e,n){return o.child(e).set(n)},l=function(e,n){return o.child(e).update(n)},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"value",n=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,r=o.child(n).on(e,function(e){t(e.val(),e)});return s.push(function(){o.child(n).off(e,r)}),r},d=function(e,n,t){t?o.child(e).off(n,t):o.child(e).off(n)},h=n.database().ref(".info/connected").on("value",function(e){e.val()&&a.onDisconnect().remove().then(function(){a.set(u),l("subscriptions",r.get()).then(function(){r.toList().forEach(function(e){var n="subscriptions/".concat(e.id);o.child(n).onDisconnect().remove()})})})});return s.push(function(){n.database().ref(".info/connected").off("value",h)}),{set:f,once:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"value";return c(void 0,void 0,void 0,regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.child(e).once(n);case 2:return r=t.sent,t.abrupt("return",r.val());case 4:case"end":return t.stop()}},t)}))},update:l,lastOfChildValue:function(n,t,r){return c(void 0,void 0,void 0,regeneratorRuntime.mark(function c(){var i,u,a,s,f;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,o.child(n).orderByChild(t).equalTo(r).limitToLast(1).once("value");case 2:return i=c.sent,u=i.val(),a=Object.values(u||{}),s=e(a,1),f=s[0],c.abrupt("return",f||null);case 6:case"end":return c.stop()}},c)}))},onNamespace:function(e,n){return v("value",e,function(e){n(e)})},offNamespace:function(e,n){d(e,"value",n)},dispatchAction:function(e){return c(void 0,void 0,void 0,regeneratorRuntime.mark(function n(){var t,r,c,i,u,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s="actions",f=e,o.child(s).push(f);case 2:if(t=n.sent,r=t.key,c="actions/".concat(r),t.onDisconnect().remove(),!e.responseRequired){n.next=11;break}return i=e.responseTimeout||6e5,u=new Promise(function(e,n){var r=setTimeout(function(){clearTimeout(r),t.remove(),n("Action response timed out in ".concat(i,"ms."))},i)}),a=new Promise(function(e){var n,t,r,o;n="value",t="".concat(c,"/response"),r=e,v(n,t,function(e){null!==e&&(d(t,n),r(o||e))})}),n.abrupt("return",Promise.race([a,u]));case 11:return n.abrupt("return",r);case 12:case"end":return n.stop()}var s,f},n)}))},nextMetric:function(e,n){return c(void 0,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:f("metrics/".concat(e),n);case 1:case"end":return t.stop()}},t)}))},onMetric:function(e,n){var t=e.atomic,r=e.metric,c=e.labels,o=t?"metrics/".concat(r):"metrics/".concat(r,"/").concat(c[0]);return v("value",o,function(e){null!==e&&n(e)})},subscribeToMetric:function(e){var n=o.child("subscriptions").push().key,t="subscriptions/".concat(n),r=Object.assign({id:n,clientId:i},e);return f(t,r),o.child(t).onDisconnect().remove(),r},unsubscribeFromMetric:function(e){var n;n="subscriptions/".concat(e.id),o.child(n).remove()},removeMetricListener:function(e,n){var t=e.atomic,r=e.metric,c=e.labels,o=t?"metrics/".concat(r):"metrics/".concat(r,"/").concat(c[0]);d(o,"value",n)},disconnect:function(){a.remove(),s.forEach(function(e){e()}),r.toList().filter(function(e){return e.clientId===i}).forEach(function(e){var n="subscriptions/".concat(e.id);o.child(n).remove()})}}};
},{"firebase/app":"ZUoI"}],"KzOJ":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,u){function c(e){try{a(n.next(e))}catch(t){u(t)}}function o(e){try{a(n.throw(e))}catch(t){u(t)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(c,o)}a((n=n.apply(e,t||[])).next())})},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var u=i(require("firebase/app")),c=require("./deviceStore"),o=u.default.database.ServerValue.TIMESTAMP,a=function(){function t(r){var n=r.deviceId,i=r.firebaseApp,u=r.dependencies;e(this,t),this.app=i.app,this.deviceStore=c.createDeviceStore(this.app,n,u.subscriptionManager)}return r(t,[{key:"dispatchAction",value:function(e){return this.deviceStore.dispatchAction(e)}},{key:"getInfo",value:function(){return n(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deviceStore.once("info");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"onNamespace",value:function(e,t){return this.deviceStore.onNamespace(e,t)}},{key:"onceNamespace",value:function(e){return n(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.deviceStore.once(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"offNamespace",value:function(e,t){this.deviceStore.offNamespace(e,t)}},{key:"getTimesync",value:function(){return n(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dispatchAction({command:"timesync",action:"get",responseRequired:!0,responseTimeout:250});case 2:return t=e.sent,e.abrupt("return",t.timestamp);case 4:case"end":return e.stop()}},e,this)}))}},{key:"nextMetric",value:function(e,t){this.deviceStore.nextMetric(e,t)}},{key:"onMetric",value:function(e,t){return this.deviceStore.onMetric(e,t)}},{key:"subscribeToMetric",value:function(e){return this.deviceStore.subscribeToMetric(e)}},{key:"unsubscribeFromMetric",value:function(e){this.deviceStore.unsubscribeFromMetric(e)}},{key:"removeMetricListener",value:function(e,t){this.deviceStore.removeMetricListener(e,t)}},{key:"changeSettings",value:function(e){return n(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.deviceStore.update("settings",e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"getSkill",value:function(e){return n(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.deviceStore.lastOfChildValue("skills","bundleId",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"disconnect",value:function(){this.deviceStore.disconnect()}},{key:"timestamp",get:function(){return o}}]),t}();exports.FirebaseDevice=a,a.serverType="firebase";
},{"firebase/app":"ZUoI","./deviceStore":"mSvX"}],"kM30":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./FirebaseApp")),e(require("./FirebaseUser")),e(require("./FirebaseDevice"));
},{"./FirebaseApp":"OERo","./FirebaseUser":"Cc51","./FirebaseDevice":"KzOJ"}],"imeZ":[function(require,module,exports) {
var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function(t){var s=t,o=t.indexOf("["),a=t.indexOf("]");-1!=o&&-1!=a&&(t=t.substring(0,o)+t.substring(o,a).replace(/:/g,";")+t.substring(a,t.length));for(var u=r.exec(t||""),i={},h=14;h--;)i[e[h]]=u[h]||"";return-1!=o&&-1!=a&&(i.source=s,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i};
},{}],"IAgR":[function(require,module,exports) {
var s=1e3,e=60*s,r=60*e,a=24*r,n=365.25*a;function c(c){if(!((c=String(c)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(c);if(t){var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return i*n;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"hrs":case"hr":case"h":return i*r;case"minutes":case"minute":case"mins":case"min":case"m":return i*e;case"seconds":case"second":case"secs":case"sec":case"s":return i*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}function t(n){return n>=a?Math.round(n/a)+"d":n>=r?Math.round(n/r)+"h":n>=e?Math.round(n/e)+"m":n>=s?Math.round(n/s)+"s":n+"ms"}function i(n){return o(n,a,"day")||o(n,r,"hour")||o(n,e,"minute")||o(n,s,"second")||n+" ms"}function o(s,e,r){if(!(s<e))return s<1.5*e?Math.floor(s/e)+" "+r:Math.ceil(s/e)+" "+r+"s"}module.exports=function(s,e){e=e||{};var r=typeof s;if("string"===r&&s.length>0)return c(s);if("number"===r&&!1===isNaN(s))return e.long?i(s):t(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};
},{}],"y5CM":[function(require,module,exports) {
function e(e){var r,s=0;for(r in e)s=(s<<5)-s+e.charCodeAt(r),s|=0;return exports.colors[Math.abs(s)%exports.colors.length]}function r(r){var t;function o(){if(o.enabled){var e=o,r=+new Date,s=r-(t||r);e.diff=s,e.prev=t,e.curr=r,t=r;for(var n=new Array(arguments.length),p=0;p<n.length;p++)n[p]=arguments[p];n[0]=exports.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var a=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,function(r,s){if("%%"===r)return r;a++;var t=exports.formatters[s];if("function"==typeof t){var o=n[a];r=t.call(e,o),n.splice(a,1),a--}return r}),exports.formatArgs.call(e,n),(o.log||exports.log||console.log.bind(console)).apply(e,n)}}return o.namespace=r,o.enabled=exports.enabled(r),o.useColors=exports.useColors(),o.color=e(r),o.destroy=s,"function"==typeof exports.init&&exports.init(o),exports.instances.push(o),o}function s(){var e=exports.instances.indexOf(this);return-1!==e&&(exports.instances.splice(e,1),!0)}function t(e){var r;exports.save(e),exports.names=[],exports.skips=[];var s=("string"==typeof e?e:"").split(/[\s,]+/),t=s.length;for(r=0;r<t;r++)s[r]&&("-"===(e=s[r].replace(/\*/g,".*?"))[0]?exports.skips.push(new RegExp("^"+e.substr(1)+"$")):exports.names.push(new RegExp("^"+e+"$")));for(r=0;r<exports.instances.length;r++){var o=exports.instances[r];o.enabled=exports.enabled(o.namespace)}}function o(){exports.enable("")}function n(e){if("*"===e[e.length-1])return!0;var r,s;for(r=0,s=exports.skips.length;r<s;r++)if(exports.skips[r].test(e))return!1;for(r=0,s=exports.names.length;r<s;r++)if(exports.names[r].test(e))return!0;return!1}function p(e){return e instanceof Error?e.stack||e.message:e}exports=module.exports=r.debug=r.default=r,exports.coerce=p,exports.disable=o,exports.enable=t,exports.enabled=n,exports.humanize=require("ms"),exports.instances=[],exports.names=[],exports.skips=[],exports.formatters={};
},{"ms":"IAgR"}],"jcLW":[function(require,module,exports) {
var process = require("process");
var e=require("process");function o(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function C(e){var o=this.useColors;if(e[0]=(o?"%c":"")+this.namespace+(o?" %c":" ")+e[0]+(o?"%c ":" ")+"+"+exports.humanize(this.diff),o){var C="color: "+this.color;e.splice(1,0,C,"color: inherit");var t=0,r=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(t++,"%c"===e&&(r=t))}),e.splice(r,0,C)}}function t(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function r(e){try{null==e?exports.storage.removeItem("debug"):exports.storage.debug=e}catch(o){}}function n(){var o;try{o=exports.storage.debug}catch(C){}return!o&&void 0!==e&&"env"in e&&(o=void 0),o}function F(){try{return window.localStorage}catch(e){}}exports=module.exports=require("./debug"),exports.log=t,exports.formatArgs=C,exports.save=r,exports.load=n,exports.useColors=o,exports.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:F(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(o){return"[UnexpectedJSONParseError]: "+o.message}},exports.enable(n());
},{"./debug":"y5CM","process":"pBGv"}],"ECAZ":[function(require,module,exports) {
var o=require("parseuri"),t=require("debug")("socket.io-client:url");function r(r,p){var s=r;p=p||"undefined"!=typeof location&&location,null==r&&(r=p.protocol+"//"+p.host),"string"==typeof r&&("/"===r.charAt(0)&&(r="/"===r.charAt(1)?p.protocol+r:p.host+r),/^(https?|wss?):\/\//.test(r)||(t("protocol-less url %s",r),r=void 0!==p?p.protocol+"//"+r:"https://"+r),t("parse %s",r),s=o(r)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";var e=-1!==s.host.indexOf(":")?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+e+":"+s.port,s.href=s.protocol+"://"+e+(p&&p.port===s.port?"":":"+s.port),s}module.exports=r;
},{"parseuri":"imeZ","debug":"jcLW"}],"Wr69":[function(require,module,exports) {
function t(t){if(t)return e(t)}function e(e){for(var s in t.prototype)e[s]=t.prototype[s];return e}"undefined"!=typeof module&&(module.exports=t),t.prototype.on=t.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},t.prototype.once=function(t,e){function s(){this.off(t,s),e.apply(this,arguments)}return s.fn=e,this.on(t,s),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,i=this._callbacks["$"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r=0;r<i.length;r++)if((s=i[r])===e||s.fn===e){i.splice(r,1);break}return this},t.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),s=this._callbacks["$"+t];if(s)for(var i=0,r=(s=s.slice(0)).length;i<r;++i)s[i].apply(this,e);return this},t.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},t.prototype.hasListeners=function(t){return!!this.listeners(t).length};
},{}],"REa7":[function(require,module,exports) {
var r={}.toString;module.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)};
},{}],"yh9p":[function(require,module,exports) {
"use strict";exports.byteLength=u,exports.toByteArray=i,exports.fromByteArray=d;for(var r=[],t=[],e="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=n.length;o<a;++o)r[o]=n[o],t[n.charCodeAt(o)]=o;function h(r){var t=r.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=r.indexOf("=");return-1===e&&(e=t),[e,e===t?0:4-e%4]}function u(r){var t=h(r),e=t[0],n=t[1];return 3*(e+n)/4-n}function c(r,t,e){return 3*(t+e)/4-e}function i(r){var n,o,a=h(r),u=a[0],i=a[1],f=new e(c(r,u,i)),A=0,d=i>0?u-4:u;for(o=0;o<d;o+=4)n=t[r.charCodeAt(o)]<<18|t[r.charCodeAt(o+1)]<<12|t[r.charCodeAt(o+2)]<<6|t[r.charCodeAt(o+3)],f[A++]=n>>16&255,f[A++]=n>>8&255,f[A++]=255&n;return 2===i&&(n=t[r.charCodeAt(o)]<<2|t[r.charCodeAt(o+1)]>>4,f[A++]=255&n),1===i&&(n=t[r.charCodeAt(o)]<<10|t[r.charCodeAt(o+1)]<<4|t[r.charCodeAt(o+2)]>>2,f[A++]=n>>8&255,f[A++]=255&n),f}function f(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function A(r,t,e){for(var n,o=[],a=t;a<e;a+=3)n=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(255&r[a+2]),o.push(f(n));return o.join("")}function d(t){for(var e,n=t.length,o=n%3,a=[],h=0,u=n-o;h<u;h+=16383)a.push(A(t,h,h+16383>u?u:h+16383));return 1===o?(e=t[n-1],a.push(r[e>>2]+r[e<<4&63]+"==")):2===o&&(e=(t[n-2]<<8)+t[n-1],a.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),a.join("")}t["-".charCodeAt(0)]=62,t["_".charCodeAt(0)]=63;
},{}],"JgNJ":[function(require,module,exports) {
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:1/0*(s?-1:1);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),(o+=p+N>=1?n/f:n*Math.pow(2,1-N))*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};
},{}],"dskh":[function(require,module,exports) {

var global = arguments[3];
var t=arguments[3],r=require("base64-js"),e=require("ieee754"),n=require("isarray");function i(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(r){return!1}}function o(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function u(t,r){if(o()<r)throw new RangeError("Invalid typed array length");return f.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(r)).__proto__=f.prototype:(null===t&&(t=new f(r)),t.length=r),t}function f(t,r,e){if(!(f.TYPED_ARRAY_SUPPORT||this instanceof f))return new f(t,r,e);if("number"==typeof t){if("string"==typeof r)throw new Error("If encoding is specified then the first argument must be a string");return c(this,t)}return s(this,t,r,e)}function s(t,r,e,n){if("number"==typeof r)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&r instanceof ArrayBuffer?g(t,r,e,n):"string"==typeof r?l(t,r,e):y(t,r)}function h(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function a(t,r,e,n){return h(r),r<=0?u(t,r):void 0!==e?"string"==typeof n?u(t,r).fill(e,n):u(t,r).fill(e):u(t,r)}function c(t,r){if(h(r),t=u(t,r<0?0:0|w(r)),!f.TYPED_ARRAY_SUPPORT)for(var e=0;e<r;++e)t[e]=0;return t}function l(t,r,e){if("string"==typeof e&&""!==e||(e="utf8"),!f.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');var n=0|v(r,e),i=(t=u(t,n)).write(r,e);return i!==n&&(t=t.slice(0,i)),t}function p(t,r){var e=r.length<0?0:0|w(r.length);t=u(t,e);for(var n=0;n<e;n+=1)t[n]=255&r[n];return t}function g(t,r,e,n){if(r.byteLength,e<0||r.byteLength<e)throw new RangeError("'offset' is out of bounds");if(r.byteLength<e+(n||0))throw new RangeError("'length' is out of bounds");return r=void 0===e&&void 0===n?new Uint8Array(r):void 0===n?new Uint8Array(r,e):new Uint8Array(r,e,n),f.TYPED_ARRAY_SUPPORT?(t=r).__proto__=f.prototype:t=p(t,r),t}function y(t,r){if(f.isBuffer(r)){var e=0|w(r.length);return 0===(t=u(t,e)).length?t:(r.copy(t,0,0,e),t)}if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||W(r.length)?u(t,0):p(t,r);if("Buffer"===r.type&&n(r.data))return p(t,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function w(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function d(t){return+t!=t&&(t=0),f.alloc(+t)}function v(t,r){if(f.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var e=t.length;if(0===e)return 0;for(var n=!1;;)switch(r){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":case void 0:return $(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e;case"hex":return e>>>1;case"base64":return K(t).length;default:if(n)return $(t).length;r=(""+r).toLowerCase(),n=!0}}function E(t,r,e){var n=!1;if((void 0===r||r<0)&&(r=0),r>this.length)return"";if((void 0===e||e>this.length)&&(e=this.length),e<=0)return"";if((e>>>=0)<=(r>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return x(this,r,e);case"utf8":case"utf-8":return Y(this,r,e);case"ascii":return L(this,r,e);case"latin1":case"binary":return D(this,r,e);case"base64":return S(this,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,r,e);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function b(t,r,e){var n=t[r];t[r]=t[e],t[e]=n}function R(t,r,e,n,i){if(0===t.length)return-1;if("string"==typeof e?(n=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,isNaN(e)&&(e=i?0:t.length-1),e<0&&(e=t.length+e),e>=t.length){if(i)return-1;e=t.length-1}else if(e<0){if(!i)return-1;e=0}if("string"==typeof r&&(r=f.from(r,n)),f.isBuffer(r))return 0===r.length?-1:_(t,r,e,n,i);if("number"==typeof r)return r&=255,f.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,r,e):Uint8Array.prototype.lastIndexOf.call(t,r,e):_(t,[r],e,n,i);throw new TypeError("val must be string, number or Buffer")}function _(t,r,e,n,i){var o,u=1,f=t.length,s=r.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||r.length<2)return-1;u=2,f/=2,s/=2,e/=2}function h(t,r){return 1===u?t[r]:t.readUInt16BE(r*u)}if(i){var a=-1;for(o=e;o<f;o++)if(h(t,o)===h(r,-1===a?0:o-a)){if(-1===a&&(a=o),o-a+1===s)return a*u}else-1!==a&&(o-=o-a),a=-1}else for(e+s>f&&(e=f-s),o=e;o>=0;o--){for(var c=!0,l=0;l<s;l++)if(h(t,o+l)!==h(r,l)){c=!1;break}if(c)return o}return-1}function A(t,r,e,n){e=Number(e)||0;var i=t.length-e;n?(n=Number(n))>i&&(n=i):n=i;var o=r.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var u=0;u<n;++u){var f=parseInt(r.substr(2*u,2),16);if(isNaN(f))return u;t[e+u]=f}return u}function m(t,r,e,n){return Q($(r,t.length-e),t,e,n)}function P(t,r,e,n){return Q(G(r),t,e,n)}function T(t,r,e,n){return P(t,r,e,n)}function B(t,r,e,n){return Q(K(r),t,e,n)}function U(t,r,e,n){return Q(H(r,t.length-e),t,e,n)}function S(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function Y(t,r,e){e=Math.min(t.length,e);for(var n=[],i=r;i<e;){var o,u,f,s,h=t[i],a=null,c=h>239?4:h>223?3:h>191?2:1;if(i+c<=e)switch(c){case 1:h<128&&(a=h);break;case 2:128==(192&(o=t[i+1]))&&(s=(31&h)<<6|63&o)>127&&(a=s);break;case 3:o=t[i+1],u=t[i+2],128==(192&o)&&128==(192&u)&&(s=(15&h)<<12|(63&o)<<6|63&u)>2047&&(s<55296||s>57343)&&(a=s);break;case 4:o=t[i+1],u=t[i+2],f=t[i+3],128==(192&o)&&128==(192&u)&&128==(192&f)&&(s=(15&h)<<18|(63&o)<<12|(63&u)<<6|63&f)>65535&&s<1114112&&(a=s)}null===a?(a=65533,c=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=c}return O(n)}exports.Buffer=f,exports.SlowBuffer=d,exports.INSPECT_MAX_BYTES=50,f.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:i(),exports.kMaxLength=o(),f.poolSize=8192,f._augment=function(t){return t.__proto__=f.prototype,t},f.from=function(t,r,e){return s(null,t,r,e)},f.TYPED_ARRAY_SUPPORT&&(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&f[Symbol.species]===f&&Object.defineProperty(f,Symbol.species,{value:null,configurable:!0})),f.alloc=function(t,r,e){return a(null,t,r,e)},f.allocUnsafe=function(t){return c(null,t)},f.allocUnsafeSlow=function(t){return c(null,t)},f.isBuffer=function(t){return!(null==t||!t._isBuffer)},f.compare=function(t,r){if(!f.isBuffer(t)||!f.isBuffer(r))throw new TypeError("Arguments must be Buffers");if(t===r)return 0;for(var e=t.length,n=r.length,i=0,o=Math.min(e,n);i<o;++i)if(t[i]!==r[i]){e=t[i],n=r[i];break}return e<n?-1:n<e?1:0},f.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(t,r){if(!n(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return f.alloc(0);var e;if(void 0===r)for(r=0,e=0;e<t.length;++e)r+=t[e].length;var i=f.allocUnsafe(r),o=0;for(e=0;e<t.length;++e){var u=t[e];if(!f.isBuffer(u))throw new TypeError('"list" argument must be an Array of Buffers');u.copy(i,o),o+=u.length}return i},f.byteLength=v,f.prototype._isBuffer=!0,f.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<t;r+=2)b(this,r,r+1);return this},f.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<t;r+=4)b(this,r,r+3),b(this,r+1,r+2);return this},f.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<t;r+=8)b(this,r,r+7),b(this,r+1,r+6),b(this,r+2,r+5),b(this,r+3,r+4);return this},f.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?Y(this,0,t):E.apply(this,arguments)},f.prototype.equals=function(t){if(!f.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===f.compare(this,t)},f.prototype.inspect=function(){var t="",r=exports.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},f.prototype.compare=function(t,r,e,n,i){if(!f.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===r&&(r=0),void 0===e&&(e=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),r<0||e>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&r>=e)return 0;if(n>=i)return-1;if(r>=e)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),u=(e>>>=0)-(r>>>=0),s=Math.min(o,u),h=this.slice(n,i),a=t.slice(r,e),c=0;c<s;++c)if(h[c]!==a[c]){o=h[c],u=a[c];break}return o<u?-1:u<o?1:0},f.prototype.includes=function(t,r,e){return-1!==this.indexOf(t,r,e)},f.prototype.indexOf=function(t,r,e){return R(this,t,r,e,!0)},f.prototype.lastIndexOf=function(t,r,e){return R(this,t,r,e,!1)},f.prototype.write=function(t,r,e,n){if(void 0===r)n="utf8",e=this.length,r=0;else if(void 0===e&&"string"==typeof r)n=r,e=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r|=0,isFinite(e)?(e|=0,void 0===n&&(n="utf8")):(n=e,e=void 0)}var i=this.length-r;if((void 0===e||e>i)&&(e=i),t.length>0&&(e<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return A(this,t,r,e);case"utf8":case"utf-8":return m(this,t,r,e);case"ascii":return P(this,t,r,e);case"latin1":case"binary":return T(this,t,r,e);case"base64":return B(this,t,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,t,r,e);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function O(t){var r=t.length;if(r<=I)return String.fromCharCode.apply(String,t);for(var e="",n=0;n<r;)e+=String.fromCharCode.apply(String,t.slice(n,n+=I));return e}function L(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i)n+=String.fromCharCode(127&t[i]);return n}function D(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i)n+=String.fromCharCode(t[i]);return n}function x(t,r,e){var n=t.length;(!r||r<0)&&(r=0),(!e||e<0||e>n)&&(e=n);for(var i="",o=r;o<e;++o)i+=Z(t[o]);return i}function C(t,r,e){for(var n=t.slice(r,e),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function M(t,r,e){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+r>e)throw new RangeError("Trying to access beyond buffer length")}function k(t,r,e,n,i,o){if(!f.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>i||r<o)throw new RangeError('"value" argument is out of bounds');if(e+n>t.length)throw new RangeError("Index out of range")}function N(t,r,e,n){r<0&&(r=65535+r+1);for(var i=0,o=Math.min(t.length-e,2);i<o;++i)t[e+i]=(r&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function z(t,r,e,n){r<0&&(r=4294967295+r+1);for(var i=0,o=Math.min(t.length-e,4);i<o;++i)t[e+i]=r>>>8*(n?i:3-i)&255}function F(t,r,e,n,i,o){if(e+n>t.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function j(t,r,n,i,o){return o||F(t,r,n,4,3.4028234663852886e38,-3.4028234663852886e38),e.write(t,r,n,i,23,4),n+4}function q(t,r,n,i,o){return o||F(t,r,n,8,1.7976931348623157e308,-1.7976931348623157e308),e.write(t,r,n,i,52,8),n+8}f.prototype.slice=function(t,r){var e,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<t&&(r=t),f.TYPED_ARRAY_SUPPORT)(e=this.subarray(t,r)).__proto__=f.prototype;else{var i=r-t;e=new f(i,void 0);for(var o=0;o<i;++o)e[o]=this[o+t]}return e},f.prototype.readUIntLE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);)n+=this[t+o]*i;return n},f.prototype.readUIntBE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=this[t+--r],i=1;r>0&&(i*=256);)n+=this[t+--r]*i;return n},f.prototype.readUInt8=function(t,r){return r||M(t,1,this.length),this[t]},f.prototype.readUInt16LE=function(t,r){return r||M(t,2,this.length),this[t]|this[t+1]<<8},f.prototype.readUInt16BE=function(t,r){return r||M(t,2,this.length),this[t]<<8|this[t+1]},f.prototype.readUInt32LE=function(t,r){return r||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},f.prototype.readUInt32BE=function(t,r){return r||M(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},f.prototype.readIntLE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*r)),n},f.prototype.readIntBE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=r,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*r)),o},f.prototype.readInt8=function(t,r){return r||M(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},f.prototype.readInt16LE=function(t,r){r||M(t,2,this.length);var e=this[t]|this[t+1]<<8;return 32768&e?4294901760|e:e},f.prototype.readInt16BE=function(t,r){r||M(t,2,this.length);var e=this[t+1]|this[t]<<8;return 32768&e?4294901760|e:e},f.prototype.readInt32LE=function(t,r){return r||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},f.prototype.readInt32BE=function(t,r){return r||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},f.prototype.readFloatLE=function(t,r){return r||M(t,4,this.length),e.read(this,t,!0,23,4)},f.prototype.readFloatBE=function(t,r){return r||M(t,4,this.length),e.read(this,t,!1,23,4)},f.prototype.readDoubleLE=function(t,r){return r||M(t,8,this.length),e.read(this,t,!0,52,8)},f.prototype.readDoubleBE=function(t,r){return r||M(t,8,this.length),e.read(this,t,!1,52,8)},f.prototype.writeUIntLE=function(t,r,e,n){(t=+t,r|=0,e|=0,n)||k(this,t,r,e,Math.pow(2,8*e)-1,0);var i=1,o=0;for(this[r]=255&t;++o<e&&(i*=256);)this[r+o]=t/i&255;return r+e},f.prototype.writeUIntBE=function(t,r,e,n){(t=+t,r|=0,e|=0,n)||k(this,t,r,e,Math.pow(2,8*e)-1,0);var i=e-1,o=1;for(this[r+i]=255&t;--i>=0&&(o*=256);)this[r+i]=t/o&255;return r+e},f.prototype.writeUInt8=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,1,255,0),f.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[r]=255&t,r+1},f.prototype.writeUInt16LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):N(this,t,r,!0),r+2},f.prototype.writeUInt16BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):N(this,t,r,!1),r+2},f.prototype.writeUInt32LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=255&t):z(this,t,r,!0),r+4},f.prototype.writeUInt32BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):z(this,t,r,!1),r+4},f.prototype.writeIntLE=function(t,r,e,n){if(t=+t,r|=0,!n){var i=Math.pow(2,8*e-1);k(this,t,r,e,i-1,-i)}var o=0,u=1,f=0;for(this[r]=255&t;++o<e&&(u*=256);)t<0&&0===f&&0!==this[r+o-1]&&(f=1),this[r+o]=(t/u>>0)-f&255;return r+e},f.prototype.writeIntBE=function(t,r,e,n){if(t=+t,r|=0,!n){var i=Math.pow(2,8*e-1);k(this,t,r,e,i-1,-i)}var o=e-1,u=1,f=0;for(this[r+o]=255&t;--o>=0&&(u*=256);)t<0&&0===f&&0!==this[r+o+1]&&(f=1),this[r+o]=(t/u>>0)-f&255;return r+e},f.prototype.writeInt8=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,1,127,-128),f.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[r]=255&t,r+1},f.prototype.writeInt16LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):N(this,t,r,!0),r+2},f.prototype.writeInt16BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):N(this,t,r,!1),r+2},f.prototype.writeInt32LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24):z(this,t,r,!0),r+4},f.prototype.writeInt32BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):z(this,t,r,!1),r+4},f.prototype.writeFloatLE=function(t,r,e){return j(this,t,r,!0,e)},f.prototype.writeFloatBE=function(t,r,e){return j(this,t,r,!1,e)},f.prototype.writeDoubleLE=function(t,r,e){return q(this,t,r,!0,e)},f.prototype.writeDoubleBE=function(t,r,e){return q(this,t,r,!1,e)},f.prototype.copy=function(t,r,e,n){if(e||(e=0),n||0===n||(n=this.length),r>=t.length&&(r=t.length),r||(r=0),n>0&&n<e&&(n=e),n===e)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(e<0||e>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-r<n-e&&(n=t.length-r+e);var i,o=n-e;if(this===t&&e<r&&r<n)for(i=o-1;i>=0;--i)t[i+r]=this[i+e];else if(o<1e3||!f.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+r]=this[i+e];else Uint8Array.prototype.set.call(t,this.subarray(e,e+o),r);return o},f.prototype.fill=function(t,r,e,n){if("string"==typeof t){if("string"==typeof r?(n=r,r=0,e=this.length):"string"==typeof e&&(n=e,e=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!f.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(r<0||this.length<r||this.length<e)throw new RangeError("Out of range index");if(e<=r)return this;var o;if(r>>>=0,e=void 0===e?this.length:e>>>0,t||(t=0),"number"==typeof t)for(o=r;o<e;++o)this[o]=t;else{var u=f.isBuffer(t)?t:$(new f(t,n).toString()),s=u.length;for(o=0;o<e-r;++o)this[o+r]=u[o%s]}return this};var V=/[^+\/0-9A-Za-z-_]/g;function X(t){if((t=J(t).replace(V,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function J(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Z(t){return t<16?"0"+t.toString(16):t.toString(16)}function $(t,r){var e;r=r||1/0;for(var n=t.length,i=null,o=[],u=0;u<n;++u){if((e=t.charCodeAt(u))>55295&&e<57344){if(!i){if(e>56319){(r-=3)>-1&&o.push(239,191,189);continue}if(u+1===n){(r-=3)>-1&&o.push(239,191,189);continue}i=e;continue}if(e<56320){(r-=3)>-1&&o.push(239,191,189),i=e;continue}e=65536+(i-55296<<10|e-56320)}else i&&(r-=3)>-1&&o.push(239,191,189);if(i=null,e<128){if((r-=1)<0)break;o.push(e)}else if(e<2048){if((r-=2)<0)break;o.push(e>>6|192,63&e|128)}else if(e<65536){if((r-=3)<0)break;o.push(e>>12|224,e>>6&63|128,63&e|128)}else{if(!(e<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}}return o}function G(t){for(var r=[],e=0;e<t.length;++e)r.push(255&t.charCodeAt(e));return r}function H(t,r){for(var e,n,i,o=[],u=0;u<t.length&&!((r-=2)<0);++u)n=(e=t.charCodeAt(u))>>8,i=e%256,o.push(i),o.push(n);return o}function K(t){return r.toByteArray(X(t))}function Q(t,r,e,n){for(var i=0;i<n&&!(i+e>=r.length||i>=t.length);++i)r[i+e]=t[i];return i}function W(t){return t!=t}
},{"base64-js":"yh9p","ieee754":"JgNJ","isarray":"REa7","buffer":"dskh"}],"VOQX":[function(require,module,exports) {
var Buffer = require("buffer").Buffer;
var f=require("buffer").Buffer;module.exports=n;var r="function"==typeof f&&"function"==typeof f.isBuffer,e="function"==typeof ArrayBuffer,u=function(f){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(f):f.buffer instanceof ArrayBuffer};function n(n){return r&&f.isBuffer(n)||e&&(n instanceof ArrayBuffer||u(n))}
},{"buffer":"dskh"}],"DJEA":[function(require,module,exports) {
var e=require("isarray"),t=require("./is-buffer"),r=Object.prototype.toString,n="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===r.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===r.call(File);function f(r,n){if(!r)return r;if(t(r)){var o={_placeholder:!0,num:n.length};return n.push(r),o}if(e(r)){for(var i=new Array(r.length),a=0;a<r.length;a++)i[a]=f(r[a],n);return i}if("object"==typeof r&&!(r instanceof Date)){i={};for(var u in r)i[u]=f(r[u],n);return i}return r}function i(t,r){if(!t)return t;if(t&&t._placeholder)return r[t.num];if(e(t))for(var n=0;n<t.length;n++)t[n]=i(t[n],r);else if("object"==typeof t)for(var o in t)t[o]=i(t[o],r);return t}exports.deconstructPacket=function(e){var t=[],r=e.data,n=e;return n.data=f(r,t),n.attachments=t.length,{packet:n,buffers:t}},exports.reconstructPacket=function(e,t){return e.data=i(e.data,t),e.attachments=void 0,e},exports.removeBlobs=function(r,f){var i=0,a=r;!function r(u,c,l){if(!u)return u;if(n&&u instanceof Blob||o&&u instanceof File){i++;var s=new FileReader;s.onload=function(){l?l[c]=this.result:a=this.result,--i||f(a)},s.readAsArrayBuffer(u)}else if(e(u))for(var p=0;p<u.length;p++)r(u[p],p,u);else if("object"==typeof u&&!t(u))for(var d in u)r(u[d],d,u)}(a),i||f(a)};
},{"isarray":"REa7","./is-buffer":"VOQX"}],"EDhw":[function(require,module,exports) {
var t=require("debug")("socket.io-parser"),r=require("component-emitter"),e=require("./binary"),n=require("isarray"),o=require("./is-buffer");function s(){}exports.protocol=4,exports.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],exports.CONNECT=0,exports.DISCONNECT=1,exports.EVENT=2,exports.ACK=3,exports.ERROR=4,exports.BINARY_EVENT=5,exports.BINARY_ACK=6,exports.Encoder=s,exports.Decoder=p;var i=exports.ERROR+'"encode error"';function c(r){var e=""+r.type;if(exports.BINARY_EVENT!==r.type&&exports.BINARY_ACK!==r.type||(e+=r.attachments+"-"),r.nsp&&"/"!==r.nsp&&(e+=r.nsp+","),null!=r.id&&(e+=r.id),null!=r.data){var n=a(r.data);if(!1===n)return i;e+=n}return t("encoded %j as %s",r,e),e}function a(t){try{return JSON.stringify(t)}catch(r){return!1}}function u(t,r){e.removeBlobs(t,function(t){var n=e.deconstructPacket(t),o=c(n.packet),s=n.buffers;s.unshift(o),r(s)})}function p(){this.reconstructor=null}function f(r){var e=0,o={type:Number(r.charAt(0))};if(null==exports.types[o.type])return N("unknown packet type "+o.type);if(exports.BINARY_EVENT===o.type||exports.BINARY_ACK===o.type){for(var s="";"-"!==r.charAt(++e)&&(s+=r.charAt(e),e!=r.length););if(s!=Number(s)||"-"!==r.charAt(e))throw new Error("Illegal attachments");o.attachments=Number(s)}if("/"===r.charAt(e+1))for(o.nsp="";++e;){if(","===(c=r.charAt(e)))break;if(o.nsp+=c,e===r.length)break}else o.nsp="/";var i=r.charAt(e+1);if(""!==i&&Number(i)==i){for(o.id="";++e;){var c;if(null==(c=r.charAt(e))||Number(c)!=c){--e;break}if(o.id+=r.charAt(e),e===r.length)break}o.id=Number(o.id)}if(r.charAt(++e)){var a=h(r.substr(e));if(!(!1!==a&&(o.type===exports.ERROR||n(a))))return N("invalid payload");o.data=a}return t("decoded %s as %j",r,o),o}function h(t){try{return JSON.parse(t)}catch(r){return!1}}function d(t){this.reconPack=t,this.buffers=[]}function N(t){return{type:exports.ERROR,data:"parser error: "+t}}s.prototype.encode=function(r,e){(t("encoding packet %j",r),exports.BINARY_EVENT===r.type||exports.BINARY_ACK===r.type)?u(r,e):e([c(r)])},r(p.prototype),p.prototype.add=function(t){var r;if("string"==typeof t)r=f(t),exports.BINARY_EVENT===r.type||exports.BINARY_ACK===r.type?(this.reconstructor=new d(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!o(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",r))}},p.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var r=e.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),r}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]};
},{"debug":"jcLW","component-emitter":"Wr69","./binary":"DJEA","isarray":"REa7","./is-buffer":"VOQX"}],"mYnU":[function(require,module,exports) {
try{module.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){module.exports=!1}
},{}],"cVUh":[function(require,module,exports) {
var e=require("has-cors");module.exports=function(t){var n=t.xdomain,r=t.xscheme,c=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!n||e))return new XMLHttpRequest}catch(i){}try{if("undefined"!=typeof XDomainRequest&&!r&&c)return new XDomainRequest}catch(i){}if(!n)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(i){}};
},{"has-cors":"mYnU"}],"Tn4q":[function(require,module,exports) {
module.exports=Object.keys||function(r){var e=[],t=Object.prototype.hasOwnProperty;for(var o in r)t.call(r,o)&&e.push(o);return e};
},{}],"E6Ed":[function(require,module,exports) {
var Buffer = require("buffer").Buffer;
var e=require("buffer").Buffer,t=require("isarray"),r=Object.prototype.toString,o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===r.call(Blob),f="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===r.call(File);function n(r){if(!r||"object"!=typeof r)return!1;if(t(r)){for(var i=0,u=r.length;i<u;i++)if(n(r[i]))return!0;return!1}if("function"==typeof e&&e.isBuffer&&e.isBuffer(r)||"function"==typeof ArrayBuffer&&r instanceof ArrayBuffer||o&&r instanceof Blob||f&&r instanceof File)return!0;if(r.toJSON&&"function"==typeof r.toJSON&&1===arguments.length)return n(r.toJSON(),!0);for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)&&n(r[c]))return!0;return!1}module.exports=n;
},{"isarray":"REa7","buffer":"dskh"}],"iRcD":[function(require,module,exports) {
module.exports=function(r,e,n){var t=r.byteLength;if(e=e||0,n=n||t,r.slice)return r.slice(e,n);if(e<0&&(e+=t),n<0&&(n+=t),n>t&&(n=t),e>=t||e>=n||0===t)return new ArrayBuffer(0);for(var f=new Uint8Array(r),i=new Uint8Array(n-e),u=e,a=0;u<n;u++,a++)i[a]=f[u];return i.buffer};
},{}],"ibc9":[function(require,module,exports) {
function n(n,t,u){var r=!1;return u=u||o,c.count=n,0===n?t():c;function c(n,o){if(c.count<=0)throw new Error("after called too many times");--c.count,n?(r=!0,t(n),t=u):0!==c.count||r||t(null,o)}}function o(){}module.exports=n;
},{}],"s6hm":[function(require,module,exports) {
var r,t,n,o=String.fromCharCode;function e(r){for(var t,n,o=[],e=0,i=r.length;e<i;)(t=r.charCodeAt(e++))>=55296&&t<=56319&&e<i?56320==(64512&(n=r.charCodeAt(e++)))?o.push(((1023&t)<<10)+(1023&n)+65536):(o.push(t),e--):o.push(t);return o}function i(r){for(var t,n=r.length,e=-1,i="";++e<n;)(t=r[e])>65535&&(i+=o((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=o(t);return i}function u(r,t){if(r>=55296&&r<=57343){if(t)throw Error("Lone surrogate U+"+r.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function a(r,t){return o(r>>t&63|128)}function f(r,t){if(0==(4294967168&r))return o(r);var n="";return 0==(4294965248&r)?n=o(r>>6&31|192):0==(4294901760&r)?(u(r,t)||(r=65533),n=o(r>>12&15|224),n+=a(r,6)):0==(4292870144&r)&&(n=o(r>>18&7|240),n+=a(r,12),n+=a(r,6)),n+=o(63&r|128)}function c(r,t){for(var n=!1!==(t=t||{}).strict,o=e(r),i=o.length,u=-1,a="";++u<i;)a+=f(o[u],n);return a}function h(){if(n>=t)throw Error("Invalid byte index");var o=255&r[n];if(n++,128==(192&o))return 63&o;throw Error("Invalid continuation byte")}function d(o){var e,i;if(n>t)throw Error("Invalid byte index");if(n==t)return!1;if(e=255&r[n],n++,0==(128&e))return e;if(192==(224&e)){if((i=(31&e)<<6|h())>=128)return i;throw Error("Invalid continuation byte")}if(224==(240&e)){if((i=(15&e)<<12|h()<<6|h())>=2048)return u(i,o)?i:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(i=(7&e)<<18|h()<<12|h()<<6|h())>=65536&&i<=1114111)return i;throw Error("Invalid UTF-8 detected")}function v(o,u){var a=!1!==(u=u||{}).strict;r=e(o),t=r.length,n=0;for(var f,c=[];!1!==(f=d(a));)c.push(f);return i(c)}module.exports={version:"2.1.2",encode:c,decode:v};
},{}],"vLJO":[function(require,module,exports) {
!function(){"use strict";for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=new Uint8Array(256),t=0;t<r.length;t++)e[r.charCodeAt(t)]=t;exports.encode=function(e){var t,n=new Uint8Array(e),o=n.length,a="";for(t=0;t<o;t+=3)a+=r[n[t]>>2],a+=r[(3&n[t])<<4|n[t+1]>>4],a+=r[(15&n[t+1])<<2|n[t+2]>>6],a+=r[63&n[t+2]];return o%3==2?a=a.substring(0,a.length-1)+"=":o%3==1&&(a=a.substring(0,a.length-2)+"=="),a},exports.decode=function(r){var t,n,o,a,h,c=.75*r.length,g=r.length,i=0;"="===r[r.length-1]&&(c--,"="===r[r.length-2]&&c--);var u=new ArrayBuffer(c),A=new Uint8Array(u);for(t=0;t<g;t+=4)n=e[r.charCodeAt(t)],o=e[r.charCodeAt(t+1)],a=e[r.charCodeAt(t+2)],h=e[r.charCodeAt(t+3)],A[i++]=n<<2|o>>4,A[i++]=(15&o)<<4|a>>2,A[i++]=(3&a)<<6|63&h;return u}}();
},{}],"LDmX":[function(require,module,exports) {
var e=void 0!==e?e:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,t=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),r=t&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),n=e&&e.prototype.append&&e.prototype.getBlob;function o(e){return e.map(function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var r=new Uint8Array(e.byteLength);r.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=r.buffer}return t}return e})}function u(t,r){r=r||{};var n=new e;return o(t).forEach(function(e){n.append(e)}),r.type?n.getBlob(r.type):n.getBlob()}function i(e,t){return new Blob(o(e),t||{})}"undefined"!=typeof Blob&&(u.prototype=Blob.prototype,i.prototype=Blob.prototype),module.exports=t?r?Blob:i:n?u:void 0;
},{}],"HSgu":[function(require,module,exports) {
var e,r=require("./keys"),t=require("has-binary2"),n=require("arraybuffer.slice"),a=require("after"),o=require("./utf8");"undefined"!=typeof ArrayBuffer&&(e=require("base64-arraybuffer"));var f="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),i="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),u=f||i;exports.protocol=3;var c=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},d=r(c),s={type:"error",data:"parser error"},y=require("blob");function p(e,r){return r("b"+exports.packets[e.type]+e.data.data)}function l(e,r,t){if(!r)return exports.encodeBase64Packet(e,t);var n=e.data,a=new Uint8Array(n),o=new Uint8Array(1+n.byteLength);o[0]=c[e.type];for(var f=0;f<a.length;f++)o[f+1]=a[f];return t(o.buffer)}function g(e,r,t){if(!r)return exports.encodeBase64Packet(e,t);var n=new FileReader;return n.onload=function(){exports.encodePacket({type:e.type,data:n.result},r,!0,t)},n.readAsArrayBuffer(e.data)}function h(e,r,t){if(!r)return exports.encodeBase64Packet(e,t);if(u)return g(e,r,t);var n=new Uint8Array(1);return n[0]=c[e.type],t(new y([n.buffer,e.data]))}function v(e){try{e=o.decode(e,{strict:!1})}catch(r){return!1}return e}function A(e,r,t){for(var n=new Array(e.length),o=a(e.length,t),f=function(e,t,a){r(t,function(r,t){n[e]=t,a(r,n)})},i=0;i<e.length;i++)f(i,e[i],o)}exports.encodePacket=function(e,r,t,n){"function"==typeof r&&(n=r,r=!1),"function"==typeof t&&(n=t,t=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer)return l(e,r,n);if(void 0!==y&&a instanceof y)return h(e,r,n);if(a&&a.base64)return p(e,n);var f=c[e.type];return void 0!==e.data&&(f+=t?o.encode(String(e.data),{strict:!1}):String(e.data)),n(""+f)},exports.encodeBase64Packet=function(e,r){var t,n="b"+exports.packets[e.type];if(void 0!==y&&e.data instanceof y){var a=new FileReader;return a.onload=function(){var e=a.result.split(",")[1];r(n+e)},a.readAsDataURL(e.data)}try{t=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(u){for(var o=new Uint8Array(e.data),f=new Array(o.length),i=0;i<o.length;i++)f[i]=o[i];t=String.fromCharCode.apply(null,f)}return n+=btoa(t),r(n)},exports.decodePacket=function(e,r,t){if(void 0===e)return s;if("string"==typeof e){if("b"===e.charAt(0))return exports.decodeBase64Packet(e.substr(1),r);if(t&&!1===(e=v(e)))return s;var a=e.charAt(0);return Number(a)==a&&d[a]?e.length>1?{type:d[a],data:e.substring(1)}:{type:d[a]}:s}a=new Uint8Array(e)[0];var o=n(e,1);return y&&"blob"===r&&(o=new y([o])),{type:d[a],data:o}},exports.decodeBase64Packet=function(r,t){var n=d[r.charAt(0)];if(!e)return{type:n,data:{base64:!0,data:r.substr(1)}};var a=e.decode(r.substr(1));return"blob"===t&&y&&(a=new y([a])),{type:n,data:a}},exports.encodePayload=function(e,r,n){"function"==typeof r&&(n=r,r=null);var a=t(e);if(r&&a)return y&&!u?exports.encodePayloadAsBlob(e,n):exports.encodePayloadAsArrayBuffer(e,n);if(!e.length)return n("0:");A(e,function(e,t){exports.encodePacket(e,!!a&&r,!1,function(e){t(null,function(e){return e.length+":"+e}(e))})},function(e,r){return n(r.join(""))})},exports.decodePayload=function(e,r,t){if("string"!=typeof e)return exports.decodePayloadAsBinary(e,r,t);var n;if("function"==typeof r&&(t=r,r=null),""===e)return t(s,0,1);for(var a,o,f="",i=0,u=e.length;i<u;i++){var c=e.charAt(i);if(":"===c){if(""===f||f!=(a=Number(f)))return t(s,0,1);if(f!=(o=e.substr(i+1,a)).length)return t(s,0,1);if(o.length){if(n=exports.decodePacket(o,r,!1),s.type===n.type&&s.data===n.data)return t(s,0,1);if(!1===t(n,i+a,u))return}i+=a,f=""}else f+=c}return""!==f?t(s,0,1):void 0},exports.encodePayloadAsArrayBuffer=function(e,r){if(!e.length)return r(new ArrayBuffer(0));A(e,function(e,r){exports.encodePacket(e,!0,!0,function(e){return r(null,e)})},function(e,t){var n=t.reduce(function(e,r){var t;return e+(t="string"==typeof r?r.length:r.byteLength).toString().length+t+2},0),a=new Uint8Array(n),o=0;return t.forEach(function(e){var r="string"==typeof e,t=e;if(r){for(var n=new Uint8Array(e.length),f=0;f<e.length;f++)n[f]=e.charCodeAt(f);t=n.buffer}a[o++]=r?0:1;var i=t.byteLength.toString();for(f=0;f<i.length;f++)a[o++]=parseInt(i[f]);a[o++]=255;for(n=new Uint8Array(t),f=0;f<n.length;f++)a[o++]=n[f]}),r(a.buffer)})},exports.encodePayloadAsBlob=function(e,r){A(e,function(e,r){exports.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),a=0;a<e.length;a++)n[a]=e.charCodeAt(a);e=n.buffer,t[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),f=new Uint8Array(o.length+1);for(a=0;a<o.length;a++)f[a]=parseInt(o[a]);if(f[o.length]=255,y){var i=new y([t.buffer,f.buffer,e]);r(null,i)}})},function(e,t){return r(new y(t))})},exports.decodePayloadAsBinary=function(e,r,t){"function"==typeof r&&(t=r,r=null);for(var a=e,o=[];a.byteLength>0;){for(var f=new Uint8Array(a),i=0===f[0],u="",c=1;255!==f[c];c++){if(u.length>310)return t(s,0,1);u+=f[c]}a=n(a,2+u.length),u=parseInt(u);var d=n(a,0,u);if(i)try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(l){var y=new Uint8Array(d);d="";for(c=0;c<y.length;c++)d+=String.fromCharCode(y[c])}o.push(d),a=n(a,u)}var p=o.length;o.forEach(function(e,n){t(exports.decodePacket(e,r,!0),n,p)})};
},{"./keys":"Tn4q","has-binary2":"E6Ed","arraybuffer.slice":"iRcD","after":"ibc9","./utf8":"s6hm","base64-arraybuffer":"vLJO","blob":"LDmX"}],"HBl9":[function(require,module,exports) {
var t=require("engine.io-parser"),e=require("component-emitter");function s(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}module.exports=s,e(s.prototype),s.prototype.onError=function(t,e){var s=new Error(t);return s.type="TransportError",s.description=e,this.emit("error",s),this},s.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},s.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},s.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},s.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},s.prototype.onData=function(e){var s=t.decodePacket(e,this.socket.binaryType);this.onPacket(s)},s.prototype.onPacket=function(t){this.emit("packet",t)},s.prototype.onClose=function(){this.readyState="closed",this.emit("close")};
},{"engine.io-parser":"HSgu","component-emitter":"Wr69"}],"vs2a":[function(require,module,exports) {
exports.encode=function(e){var n="";for(var o in e)e.hasOwnProperty(o)&&(n.length&&(n+="&"),n+=encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return n},exports.decode=function(e){for(var n={},o=e.split("&"),t=0,r=o.length;t<r;t++){var d=o[t].split("=");n[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return n};
},{}],"X1xq":[function(require,module,exports) {
module.exports=function(o,t){var p=function(){};p.prototype=t.prototype,o.prototype=new p,o.prototype.constructor=o};
},{}],"t9Jt":[function(require,module,exports) {
"use strict";var r,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),t=64,n={},o=0,u=0;function a(r){var n="";do{n=e[r%t]+n,r=Math.floor(r/t)}while(r>0);return n}function c(r){var e=0;for(u=0;u<r.length;u++)e=e*t+n[r.charAt(u)];return e}function f(){var e=a(+new Date);return e!==r?(o=0,r=e):e+"."+a(o++)}for(;u<t;u++)n[e[u]]=u;f.encode=a,f.decode=c,module.exports=f;
},{}],"hsm0":[function(require,module,exports) {
var t=require("../transport"),e=require("parseqs"),i=require("engine.io-parser"),o=require("component-inherit"),n=require("yeast"),r=require("debug")("engine.io-client:polling");module.exports=p;var s=null!=new(require("xmlhttprequest-ssl"))({xdomain:!1}).responseType;function p(e){var i=e&&e.forceBase64;s&&!i||(this.supportsBinary=!1),t.call(this,e)}o(p,t),p.prototype.name="polling",p.prototype.doOpen=function(){this.poll()},p.prototype.pause=function(t){var e=this;function i(){r("paused"),e.readyState="paused",t()}if(this.readyState="pausing",this.polling||!this.writable){var o=0;this.polling&&(r("we are currently polling - waiting to pause"),o++,this.once("pollComplete",function(){r("pre-pause polling complete"),--o||i()})),this.writable||(r("we are currently writing - waiting to pause"),o++,this.once("drain",function(){r("pre-pause writing complete"),--o||i()}))}else i()},p.prototype.poll=function(){r("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},p.prototype.onData=function(t){var e=this;r("polling got data %s",t);i.decodePayload(t,this.socket.binaryType,function(t,i,o){if("opening"===e.readyState&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():r('ignoring poll - transport state "%s"',this.readyState))},p.prototype.doClose=function(){var t=this;function e(){r("writing close packet"),t.write([{type:"close"}])}"open"===this.readyState?(r("transport open - closing"),e()):(r("transport not open - deferring close"),this.once("open",e))},p.prototype.write=function(t){var e=this;this.writable=!1;var o=function(){e.writable=!0,e.emit("drain")};i.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,o)})},p.prototype.uri=function(){var t=this.query||{},i=this.secure?"https":"http",o="";return!1!==this.timestampRequests&&(t[this.timestampParam]=n()),this.supportsBinary||t.sid||(t.b64=1),t=e.encode(t),this.port&&("https"===i&&443!==Number(this.port)||"http"===i&&80!==Number(this.port))&&(o=":"+this.port),t.length&&(t="?"+t),i+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+o+this.path+t};
},{"../transport":"HBl9","parseqs":"vs2a","engine.io-parser":"HSgu","component-inherit":"X1xq","yeast":"t9Jt","debug":"jcLW","xmlhttprequest-ssl":"cVUh"}],"tzUF":[function(require,module,exports) {
var t=require("xmlhttprequest-ssl"),e=require("./polling"),s=require("component-emitter"),r=require("component-inherit"),i=require("debug")("engine.io-client:polling-xhr");function o(){}function n(t){if(e.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,"undefined"!=typeof location){var s="https:"===location.protocol,r=location.port;r||(r=s?443:80),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||r!==t.port,this.xs=t.secure!==s}}function a(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}if(module.exports=n,module.exports.Request=a,r(n,e),n.prototype.supportsBinary=!0,n.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new a(t)},n.prototype.doWrite=function(t,e){var s="string"!=typeof t&&void 0!==t,r=this.request({method:"POST",data:t,isBinary:s}),i=this;r.on("success",e),r.on("error",function(t){i.onError("xhr post error",t)}),this.sendXhr=r},n.prototype.doPoll=function(){i("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},s(a.prototype),a.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var s=this.xhr=new t(e),r=this;try{i("xhr open %s: %s",this.method,this.uri),s.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&s.setRequestHeader(o,this.extraHeaders[o])}catch(n){}if("POST"===this.method)try{this.isBinary?s.setRequestHeader("Content-type","application/octet-stream"):s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{s.setRequestHeader("Accept","*/*")}catch(n){}"withCredentials"in s&&(s.withCredentials=!0),this.requestTimeout&&(s.timeout=this.requestTimeout),this.hasXDR()?(s.onload=function(){r.onLoad()},s.onerror=function(){r.onError(s.responseText)}):s.onreadystatechange=function(){if(2===s.readyState)try{var t=s.getResponseHeader("Content-Type");r.supportsBinary&&"application/octet-stream"===t&&(s.responseType="arraybuffer")}catch(n){}4===s.readyState&&(200===s.status||1223===s.status?r.onLoad():setTimeout(function(){r.onError(s.status)},0))},i("xhr data %s",this.data),s.send(this.data)}catch(n){return void setTimeout(function(){r.onError(n)},0)}"undefined"!=typeof document&&(this.index=a.requestsCount++,a.requests[this.index]=this)},a.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},a.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},a.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},a.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=o:this.xhr.onreadystatechange=o,t)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete a.requests[this.index],this.xhr=null}},a.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(s){}t="application/octet-stream"===e&&this.xhr.response||this.xhr.responseText}catch(s){this.onError(s)}null!=t&&this.onData(t)},a.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},a.prototype.abort=function(){this.cleanup()},a.requestsCount=0,a.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",u);else if("function"==typeof addEventListener){var h="onpagehide"in self?"pagehide":"unload";addEventListener(h,u,!1)}function u(){for(var t in a.requests)a.requests.hasOwnProperty(t)&&a.requests[t].abort()}
},{"xmlhttprequest-ssl":"cVUh","./polling":"hsm0","component-emitter":"Wr69","component-inherit":"X1xq","debug":"jcLW"}],"ruO5":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3],t=require("./polling"),r=require("component-inherit");module.exports=c;var i,o=/\n/g,n=/\\n/g;function a(){}function s(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{}}function c(e){if(t.call(this,e),this.query=this.query||{},!i){var r=s();i=r.___eio=r.___eio||[]}this.index=i.length;var o=this;i.push(function(e){o.onData(e)}),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",function(){o.script&&(o.script.onerror=a)},!1)}r(c,t),c.prototype.supportsBinary=!1,c.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),t.prototype.doClose.call(this)},c.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},c.prototype.doWrite=function(e,t){var r=this;if(!this.form){var i,a=document.createElement("form"),s=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=c,a.method="POST",a.setAttribute("accept-charset","utf-8"),s.name="d",a.appendChild(s),document.body.appendChild(a),this.form=a,this.area=s}function d(){m(),t()}function m(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(t){r.onError("jsonp polling iframe removal error",t)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';i=document.createElement(e)}catch(t){(i=document.createElement("iframe")).name=r.iframeId,i.src="javascript:0"}i.id=r.iframeId,r.form.appendChild(i),r.iframe=i}this.form.action=this.uri(),m(),e=e.replace(n,"\\\n"),this.area.value=e.replace(o,"\\n");try{this.form.submit()}catch(p){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&d()}:this.iframe.onload=d};
},{"./polling":"hsm0","component-inherit":"X1xq"}],"rDCW":[function(require,module,exports) {

},{}],"ExHC":[function(require,module,exports) {
var Buffer = require("buffer").Buffer;
var e,t,s=require("buffer").Buffer,r=require("../transport"),i=require("engine.io-parser"),o=require("parseqs"),n=require("component-inherit"),a=require("yeast"),h=require("debug")("engine.io-client:websocket");if("undefined"!=typeof WebSocket)e=WebSocket;else if("undefined"!=typeof self)e=self.WebSocket||self.MozWebSocket;else try{t=require("ws")}catch(u){}var p=e||t;function c(s){s&&s.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=s.perMessageDeflate,this.usingBrowserWebSocket=e&&!s.forceNode,this.protocols=s.protocols,this.usingBrowserWebSocket||(p=t),r.call(this,s)}module.exports=c,n(c,r),c.prototype.name="websocket",c.prototype.supportsBinary=!0,c.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,s={agent:this.agent,perMessageDeflate:this.perMessageDeflate};s.pfx=this.pfx,s.key=this.key,s.passphrase=this.passphrase,s.cert=this.cert,s.ca=this.ca,s.ciphers=this.ciphers,s.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(s.headers=this.extraHeaders),this.localAddress&&(s.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new p(e,t):new p(e):new p(e,t,s)}catch(r){return this.emit("error",r)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},c.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},c.prototype.write=function(e){var t=this;this.writable=!1;for(var r=e.length,o=0,n=r;o<n;o++)!function(e){i.encodePacket(e,t.supportsBinary,function(i){if(!t.usingBrowserWebSocket){var o={};if(e.options&&(o.compress=e.options.compress),t.perMessageDeflate)("string"==typeof i?s.byteLength(i):i.length)<t.perMessageDeflate.threshold&&(o.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(i):t.ws.send(i,o)}catch(u){h("websocket closed before onclose event")}--r||a()})}(e[o]);function a(){t.emit("flush"),setTimeout(function(){t.writable=!0,t.emit("drain")},0)}},c.prototype.onClose=function(){r.prototype.onClose.call(this)},c.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},c.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",s="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(s=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||(e.b64=1),(e=o.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+s+this.path+e},c.prototype.check=function(){return!(!p||"__initialize"in p&&this.name===c.prototype.name)};
},{"../transport":"HBl9","engine.io-parser":"HSgu","parseqs":"vs2a","component-inherit":"X1xq","yeast":"t9Jt","debug":"jcLW","ws":"rDCW","buffer":"dskh"}],"xQDS":[function(require,module,exports) {
var e=require("xmlhttprequest-ssl"),o=require("./polling-xhr"),r=require("./polling-jsonp"),n=require("./websocket");function t(n){var t=!1,i=!1,s=!1!==n.jsonp;if("undefined"!=typeof location){var l="https:"===location.protocol,p=location.port;p||(p=l?443:80),t=n.hostname!==location.hostname||p!==n.port,i=n.secure!==l}if(n.xdomain=t,n.xscheme=i,"open"in new e(n)&&!n.forceJSONP)return new o(n);if(!s)throw new Error("JSONP disabled");return new r(n)}exports.polling=t,exports.websocket=n;
},{"xmlhttprequest-ssl":"cVUh","./polling-xhr":"tzUF","./polling-jsonp":"ruO5","./websocket":"ExHC"}],"rcym":[function(require,module,exports) {
var r=[].indexOf;module.exports=function(e,n){if(r)return e.indexOf(n);for(var f=0;f<e.length;++f)if(e[f]===n)return f;return-1};
},{}],"APvO":[function(require,module,exports) {
var e=require("./transports/index"),t=require("component-emitter"),r=require("debug")("engine.io-client:socket"),s=require("indexof"),i=require("engine.io-parser"),o=require("parseuri"),n=require("parseqs");function a(e,t){if(!(this instanceof a))return new a(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=o(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=o(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=n.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}function p(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}module.exports=a,a.priorWebsocketSuccess=!1,t(a.prototype),a.protocol=i.protocol,a.Socket=a,a.Transport=require("./transport"),a.transports=require("./transports/index"),a.parser=require("engine.io-parser"),a.prototype.createTransport=function(t){r('creating transport "%s"',t);var s=p(this.query);s.EIO=i.protocol,s.transport=t;var o=this.transportOptions[t]||{};return this.id&&(s.sid=this.id),new e[t]({query:s,socket:this,agent:o.agent||this.agent,hostname:o.hostname||this.hostname,port:o.port||this.port,secure:o.secure||this.secure,path:o.path||this.path,forceJSONP:o.forceJSONP||this.forceJSONP,jsonp:o.jsonp||this.jsonp,forceBase64:o.forceBase64||this.forceBase64,enablesXDR:o.enablesXDR||this.enablesXDR,timestampRequests:o.timestampRequests||this.timestampRequests,timestampParam:o.timestampParam||this.timestampParam,policyPort:o.policyPort||this.policyPort,pfx:o.pfx||this.pfx,key:o.key||this.key,passphrase:o.passphrase||this.passphrase,cert:o.cert||this.cert,ca:o.ca||this.ca,ciphers:o.ciphers||this.ciphers,rejectUnauthorized:o.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:o.perMessageDeflate||this.perMessageDeflate,extraHeaders:o.extraHeaders||this.extraHeaders,forceNode:o.forceNode||this.forceNode,localAddress:o.localAddress||this.localAddress,requestTimeout:o.requestTimeout||this.requestTimeout,protocols:o.protocols||void 0,isReactNative:this.isReactNative})},a.prototype.open=function(){var e;if(this.rememberUpgrade&&a.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(r){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},a.prototype.setTransport=function(e){r("setting transport %s",e.name);var t=this;this.transport&&(r("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},a.prototype.probe=function(e){r('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),s=!1,i=this;function o(){if(i.onlyBinaryUpgrades){var o=!this.supportsBinary&&i.transport.supportsBinary;s=s||o}s||(r('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(o){if(!s)if("pong"===o.type&&"probe"===o.data){if(r('probe transport "%s" pong',e),i.upgrading=!0,i.emit("upgrading",t),!t)return;a.priorWebsocketSuccess="websocket"===t.name,r('pausing current transport "%s"',i.transport.name),i.transport.pause(function(){s||"closed"!==i.readyState&&(r("changing transport and sending upgrade packet"),l(),i.setTransport(t),t.send([{type:"upgrade"}]),i.emit("upgrade",t),t=null,i.upgrading=!1,i.flush())})}else{r('probe transport "%s" failed',e);var n=new Error("probe error");n.transport=t.name,i.emit("upgradeError",n)}}))}function n(){s||(s=!0,l(),t.close(),t=null)}function p(s){var o=new Error("probe error: "+s);o.transport=t.name,n(),r('probe transport "%s" failed because of error: %s',e,s),i.emit("upgradeError",o)}function h(){p("transport closed")}function c(){p("socket closed")}function u(e){t&&e.name!==t.name&&(r('"%s" works - aborting "%s"',e.name,t.name),n())}function l(){t.removeListener("open",o),t.removeListener("error",p),t.removeListener("close",h),i.removeListener("close",c),i.removeListener("upgrading",u)}a.priorWebsocketSuccess=!1,t.once("open",o),t.once("error",p),t.once("close",h),this.once("close",c),this.once("upgrading",u),t.open()},a.prototype.onOpen=function(){if(r("socket open"),this.readyState="open",a.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){r("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},a.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(r('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else r('packet received with socket readyState "%s"',this.readyState)},a.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},a.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},a.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){r("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},a.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},a.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},a.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(r("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},a.prototype.write=a.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},a.prototype.sendPacket=function(e,t,r,s){if("function"==typeof t&&(s=t,t=void 0),"function"==typeof r&&(s=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:e,data:t,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),s&&this.once("flush",s),this.flush()}},a.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?i():t()}):this.upgrading?i():t()}function t(){e.onClose("forced close"),r("socket closing - telling transport to close"),e.transport.close()}function s(){e.removeListener("upgrade",s),e.removeListener("upgradeError",s),t()}function i(){e.once("upgrade",s),e.once("upgradeError",s)}return this},a.prototype.onError=function(e){r("socket error %j",e),a.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},a.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){r('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},a.prototype.filterUpgrades=function(e){for(var t=[],r=0,i=e.length;r<i;r++)~s(this.transports,e[r])&&t.push(e[r]);return t};
},{"./transports/index":"xQDS","component-emitter":"Wr69","debug":"jcLW","indexof":"rcym","engine.io-parser":"HSgu","parseuri":"imeZ","parseqs":"vs2a","./transport":"HBl9"}],"h0uD":[function(require,module,exports) {
module.exports=require("./socket"),module.exports.parser=require("engine.io-parser");
},{"./socket":"APvO","engine.io-parser":"HSgu"}],"PFWQ":[function(require,module,exports) {
function r(r,e){for(var n=[],o=(e=e||0)||0;o<r.length;o++)n[o-e]=r[o];return n}module.exports=r;
},{}],"BM2E":[function(require,module,exports) {
function e(e,n,o){return e.on(n,o),{destroy:function(){e.removeListener(n,o)}}}module.exports=e;
},{}],"NpfF":[function(require,module,exports) {
var n=[].slice;module.exports=function(r,t){if("string"==typeof t&&(t=r[t]),"function"!=typeof t)throw new Error("bind() requires a function");var o=n.call(arguments,2);return function(){return t.apply(r,o.concat(n.call(arguments)))}};
},{}],"wT76":[function(require,module,exports) {
var t=require("socket.io-parser"),e=require("component-emitter"),i=require("to-array"),s=require("./on"),n=require("component-bind"),o=require("debug")("socket.io-client:socket"),c=require("parseqs"),r=require("has-binary2");module.exports=exports=a;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},p=e.prototype.emit;function a(t,e,i){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},i&&i.query&&(this.query=i.query),this.io.autoConnect&&this.open()}e(a.prototype),a.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[s(t,"open",n(this,"onopen")),s(t,"packet",n(this,"onpacket")),s(t,"close",n(this,"onclose"))]}},a.prototype.open=a.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},a.prototype.send=function(){var t=i(arguments);return t.unshift("message"),this.emit.apply(this,t),this},a.prototype.emit=function(e){if(h.hasOwnProperty(e))return p.apply(this,arguments),this;var s=i(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:r(s))?t.BINARY_EVENT:t.EVENT,data:s,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof s[s.length-1]&&(o("emitting packet with ack id %d",this.ids),this.acks[this.ids]=s.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},a.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},a.prototype.onopen=function(){if(o("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?c.encode(this.query):this.query;o("sending connect packet with query %s",e),this.packet({type:t.CONNECT,query:e})}else this.packet({type:t.CONNECT})},a.prototype.onclose=function(t){o("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},a.prototype.onpacket=function(e){var i=e.nsp===this.nsp,s=e.type===t.ERROR&&"/"===e.nsp;if(i||s)switch(e.type){case t.CONNECT:this.onconnect();break;case t.EVENT:case t.BINARY_EVENT:this.onevent(e);break;case t.ACK:case t.BINARY_ACK:this.onack(e);break;case t.DISCONNECT:this.ondisconnect();break;case t.ERROR:this.emit("error",e.data)}},a.prototype.onevent=function(t){var e=t.data||[];o("emitting event %j",e),null!=t.id&&(o("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?p.apply(this,e):this.receiveBuffer.push(e)},a.prototype.ack=function(e){var s=this,n=!1;return function(){if(!n){n=!0;var c=i(arguments);o("sending ack %j",c),s.packet({type:r(c)?t.BINARY_ACK:t.ACK,id:e,data:c})}}},a.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(o("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):o("bad ack %s",t.id)},a.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},a.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)p.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},a.prototype.ondisconnect=function(){o("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},a.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},a.prototype.close=a.prototype.disconnect=function(){return this.connected&&(o("performing disconnect (%s)",this.nsp),this.packet({type:t.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},a.prototype.compress=function(t){return this.flags.compress=t,this},a.prototype.binary=function(t){return this.flags.binary=t,this};
},{"socket.io-parser":"EDhw","component-emitter":"Wr69","to-array":"PFWQ","./on":"BM2E","component-bind":"NpfF","debug":"jcLW","parseqs":"vs2a","has-binary2":"E6Ed"}],"pAuI":[function(require,module,exports) {
function t(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}module.exports=t,t.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var i=Math.random(),o=Math.floor(i*this.jitter*t);t=0==(1&Math.floor(10*i))?t-o:t+o}return 0|Math.min(t,this.max)},t.prototype.reset=function(){this.attempts=0},t.prototype.setMin=function(t){this.ms=t},t.prototype.setMax=function(t){this.max=t},t.prototype.setJitter=function(t){this.jitter=t};
},{}],"Di21":[function(require,module,exports) {
var t=require("engine.io-client"),e=require("./socket"),n=require("component-emitter"),o=require("socket.io-parser"),i=require("./on"),s=require("component-bind"),c=require("debug")("socket.io-client:manager"),r=require("indexof"),h=require("backo2"),a=Object.prototype.hasOwnProperty;function p(t,e){if(!(this instanceof p))return new p(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=e.parser||o;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}module.exports=p,p.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)a.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},p.prototype.updateSocketIds=function(){for(var t in this.nsps)a.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},p.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},n(p.prototype),p.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},p.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},p.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},p.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},p.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},p.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},p.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},p.prototype.open=p.prototype.connect=function(e,n){if(c("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;c("opening %s",this.uri),this.engine=t(this.uri,this.opts);var o=this.engine,s=this;this.readyState="opening",this.skipReconnect=!1;var r=i(o,"open",function(){s.onopen(),e&&e()}),h=i(o,"error",function(t){if(c("connect_error"),s.cleanup(),s.readyState="closed",s.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else s.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;c("connect attempt will timeout after %d",a);var p=setTimeout(function(){c("connect attempt timed out after %d",a),r.destroy(),o.close(),o.emit("error","timeout"),s.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(p)}})}return this.subs.push(r),this.subs.push(h),this},p.prototype.onopen=function(){c("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(i(t,"data",s(this,"ondata"))),this.subs.push(i(t,"ping",s(this,"onping"))),this.subs.push(i(t,"pong",s(this,"onpong"))),this.subs.push(i(t,"error",s(this,"onerror"))),this.subs.push(i(t,"close",s(this,"onclose"))),this.subs.push(i(this.decoder,"decoded",s(this,"ondecoded")))},p.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},p.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},p.prototype.ondata=function(t){this.decoder.add(t)},p.prototype.ondecoded=function(t){this.emit("packet",t)},p.prototype.onerror=function(t){c("error",t),this.emitAll("error",t)},p.prototype.socket=function(t,n){var o=this.nsps[t];if(!o){o=new e(this,t,n),this.nsps[t]=o;var i=this;o.on("connecting",s),o.on("connect",function(){o.id=i.generateId(t)}),this.autoConnect&&s()}function s(){~r(i.connecting,o)||i.connecting.push(o)}return o},p.prototype.destroy=function(t){var e=r(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},p.prototype.packet=function(t){c("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(n){for(var o=0;o<n.length;o++)e.engine.write(n[o],t.options);e.encoding=!1,e.processPacketQueue()}))},p.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},p.prototype.cleanup=function(){c("cleanup");for(var t=this.subs.length,e=0;e<t;e++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},p.prototype.close=p.prototype.disconnect=function(){c("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},p.prototype.onclose=function(t){c("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},p.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)c("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();c("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout(function(){t.skipReconnect||(c("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(c("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(c("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(n)}})}},p.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)};
},{"engine.io-client":"h0uD","./socket":"wT76","component-emitter":"Wr69","socket.io-parser":"EDhw","./on":"BM2E","component-bind":"NpfF","debug":"jcLW","indexof":"rcym","backo2":"pAuI"}],"gT2G":[function(require,module,exports) {
var e=require("./url"),r=require("socket.io-parser"),o=require("./manager"),t=require("debug")("socket.io-client");module.exports=exports=n;var c=exports.managers={};function n(r,n){"object"==typeof r&&(n=r,r=void 0),n=n||{};var s,i=e(r),u=i.source,a=i.id,p=i.path,q=c[a]&&p in c[a].nsps;return n.forceNew||n["force new connection"]||!1===n.multiplex||q?(t("ignoring socket cache for %s",u),s=o(u,n)):(c[a]||(t("new io instance for %s",u),c[a]=o(u,n)),s=c[a]),i.query&&!n.query&&(n.query=i.query),s.socket(i.path,n)}exports.protocol=r.protocol,exports.connect=n,exports.Manager=require("./manager"),exports.Socket=require("./socket");
},{"./url":"ECAZ","socket.io-parser":"EDhw","./manager":"Di21","debug":"jcLW","./socket":"wT76"}],"nVpT":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function n(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var i=o(require("socket.io-client")),c={secure:!0},s=function(){function t(n){e(this,t),this.options=Object.freeze(Object.assign(Object.assign({},c),n)),this.socket=i.default(this.options.socketUrl,{path:"/".concat(this.options.deviceId)})}return n(t,[{key:"onMetric",value:function(e,t){return this.socket.on("metrics/".concat(e.id),t)}},{key:"removeMetricListener",value:function(e,t){this.socket.off("metrics/".concat(e.id),t)}},{key:"disconnect",value:function(){this.socket.removeAllListeners(),this.socket.connected&&this.socket.disconnect()}}]),t}();exports.WebsocketClient=s,s.serverType="websocket";
},{"socket.io-client":"gT2G"}],"c6Wx":[function(require,module,exports) {
var r=Array.isArray;function n(n){if(r(n))return t(n);var e=null,u="string"==typeof n&&n;return function(r,n,i){return e||(e=t(i,u)),r=u?r[u]:r,!~e.indexOf(r)}}function t(r,n){r=r.slice(0),n&&(r=r.map(function(r){return r[n]}));for(var t=(r=r.sort(function(r,n){return r-n})).length,i=e(r),o=u(r),a=[],c=0;c<t;c++)Math.abs(r[c]-i)>o&&a.push(r[c]);return a}function e(r){var n=r.length,t=~~(n/2);return n%2?r[t]:(r[t-1]+r[t])/2}function u(r){var n=r.length,t=e(r.slice(0,~~(n/2)));return 1.5*(e(r.slice(Math.ceil(n/2)))-t)}module.exports=n;
},{}],"s7Vt":[function(require,module,exports) {
"use strict";function t(t,o){return n(t)||e(t,o)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function e(t,r){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var e=[],n=!0,o=!1,i=void 0;try{for(var u,a=t[Symbol.iterator]();!(n=(u=a.next()).done)&&(e.push(u.value),!r||e.length!==r);n=!0);}catch(l){o=!0,i=l}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return e}}function n(t){if(Array.isArray(t))return t}Object.defineProperty(exports,"__esModule",{value:!0});var o=require("rxjs"),i=require("rxjs/operators");function u(r){var e=r.status$,n=r.allowWhileOnSleepMode;return o.pipe(i.withLatestFrom(e),i.flatMap(function(r){var e=t(r,2),i=e[0];return a(e[1],n)?o.of(i):o.empty()}))}function a(t,r){return!("online"!==t.state||!r&&t.sleepMode)}exports.whileOnline=u;
},{"rxjs":"iRqj","rxjs/operators":"cVrl"}],"iVIU":[function(require,module,exports) {
"use strict";function t(t,i){return r(t)||n(t,i)||e()}function e(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function n(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],r=!0,i=!1,u=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(f){i=!0,u=f}finally{try{r||null==a.return||a.return()}finally{if(i)throw u}}return n}}function r(t){if(Array.isArray(t))return t}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}var a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,u){function o(t){try{f(r.next(t))}catch(e){u(e)}}function a(t){try{f(r.throw(t))}catch(e){u(e)}}function f(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}f((r=r.apply(t,e||[])).next())})},f=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});var s=require("rxjs"),c=require("rxjs/operators"),l=require("rxjs/operators"),p=f(require("outliers")),h=require("../utils/whileOnline"),v={bufferSize:100,updateInterval:6e4},y=function(){function e(t){i(this,e),this._offset=0,this.options=Object.assign(Object.assign({},v),t),this.start()}return o(e,[{key:"start",value:function(){var t=this,e=this.options,n=e.bufferSize,r=e.updateInterval,i=e.status$,u=s.range(0,n),o=s.timer(r,r).pipe(c.map(function(t){return n+t}),h.whileOnline({status$:i,allowWhileOnSleepMode:!0}));i.pipe(c.filter(function(t){return"online"===t.state}),c.take(1)).pipe(l.switchMap(function(){return u.pipe(c.concat(o),t.toOffset(),l.bufferCount(n,1),t.filterOutliers(),c.map(function(e){return t.average(e)}))})).subscribe(function(e){t._offset=e})}},{key:"filterOutliers",value:function(){return s.pipe(c.map(function(t){return t.filter(p.default())}))}},{key:"toOffset",value:function(){var e=this,n=this.options.getTimesync;return s.pipe(l.concatMap(function(){return a(e,void 0,void 0,regeneratorRuntime.mark(function e(){var r,i,u,o,a,f,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),e.next=3,n().then(function(t){return[null,t]}).catch(function(t){return[t]});case 3:if(i=e.sent,u=t(i,2),o=u[0],a=u[1],!o){e.next=9;break}return e.abrupt("return",0);case 9:return f=Date.now(),s=f-(f-r)/2-a,e.abrupt("return",s);case 13:case"end":return e.stop()}},e)}))}))}},{key:"average",value:function(t){return Math.round(t.reduce(function(t,e){return t+e})/t.length)}},{key:"offset",get:function(){return this._offset}},{key:"timestamp",get:function(){return Date.now()+this._offset}}]),e}();exports.Timesync=y;
},{"rxjs":"iRqj","rxjs/operators":"cVrl","outliers":"c6Wx","../utils/whileOnline":"s7Vt"}],"CXqr":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./Timesync"));
},{"./Timesync":"iVIU"}],"BX8M":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function t(){e(this,t),this._subscriptions={}}return n(t,[{key:"get",value:function(){return this._subscriptions}},{key:"toList",value:function(){return Object.values(this._subscriptions)}},{key:"add",value:function(e){this._subscriptions[e.id]=e}},{key:"remove",value:function(e){e.id in this._subscriptions&&Reflect.deleteProperty(this._subscriptions,e.id)}}]),t}();exports.SubscriptionManager=i;
},{}],"LXvB":[function(require,module,exports) {
"use strict";function e(e,i){return n(e)||r(e,i)||t()}function t(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function r(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],n=!0,i=!1,s=void 0;try{for(var c,u=e[Symbol.iterator]();!(n=(c=u.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(a){i=!0,s=a}finally{try{n||null==u.return||u.return()}finally{if(i)throw s}}return r}}function n(e){if(Array.isArray(e))return e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}var u=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function c(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(c,u)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("rxjs"),o=require("./firebase"),f=require("./websocket"),v=require("../timesync"),p=require("../subscriptions/SubscriptionManager"),h=require("rxjs/operators"),d=require("./firebase");exports.credentialWithLink=d.credentialWithLink,exports.createUser=d.createUser,exports.SERVER_TIMESTAMP=d.SERVER_TIMESTAMP;var b=function(){function t(e){var r=this;i(this,t),this.defaultServerType=o.FirebaseDevice.serverType,this.localServerType=f.WebsocketClient.serverType,this._selectedDevice=new a.BehaviorSubject(void 0),this.options=e,this.subscriptionManager=new p.SubscriptionManager,this.firebaseApp=new o.FirebaseApp(e),this.firebaseUser=new o.FirebaseUser(this.firebaseApp),this.firebaseUser.onAuthStateChanged().subscribe(function(e){r.user=e}),this.onDeviceChange().subscribe(function(e){r.firebaseDevice&&r.firebaseDevice.disconnect(),e&&(r.firebaseDevice=new o.FirebaseDevice({deviceId:e.deviceId,firebaseApp:r.firebaseApp,dependencies:{subscriptionManager:r.subscriptionManager}}),r.options.timesync&&(r.timesync=new v.Timesync({status$:r.status(),getTimesync:r.firebaseDevice.getTimesync.bind(r.firebaseDevice)})))})}return c(t,[{key:"onDeviceChange",value:function(){return this._selectedDevice.asObservable().pipe(h.shareReplay(1),h.filter(function(e){return void 0!==e}))}},{key:"setAutoSelectedDevice",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.options.deviceId){e.next=4;break}return e.next=3,this.selectDevice(function(e){return e.find(function(e){return e.deviceId===t.options.deviceId})});case 3:return e.abrupt("return",e.sent);case 4:if(this.options.deviceId||!this.options.autoSelectDevice){e.next=8;break}return e.next=7,this.selectDevice(function(e){return e[0]});case 7:return e.abrupt("return",e.sent);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}},e,this)}))}},{key:"setWebsocket",value:function(e,t){return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:this.websocket=new f.WebsocketClient({socketUrl:e,deviceId:t});case 1:case"end":return r.stop()}},r,this)}))}},{key:"unsetWebsocket",value:function(){this.websocket&&(this.websocket.disconnect(),this.websocket=null)}},{key:"disconnect",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.websocket&&this.websocket.disconnect(),e.abrupt("return",this.firebaseApp.disconnect());case 2:case"end":return e.stop()}},e,this)}))}},{key:"getInfo",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.firebaseDevice.getInfo();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"login",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.user){t.next=2;break}return t.abrupt("return",Promise.reject("Already logged in."));case 2:return t.next=4,this.firebaseUser.login(e);case 4:return r=t.sent,t.next=7,this.setAutoSelectedDevice();case 7:return n=t.sent,t.abrupt("return",Object.assign(Object.assign({},r),{selectedDevice:n}));case 9:case"end":return t.stop()}},t,this)}))}},{key:"logout",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.firebaseDevice&&this.firebaseDevice.disconnect(),e.next=3,this.firebaseUser.logout();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}))}},{key:"onAuthStateChanged",value:function(){var e=this;return this.firebaseUser.onAuthStateChanged().pipe(h.switchMap(function(t){return u(e,void 0,void 0,regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(!this.didSelectDevice()){e.next=8;break}return e.next=5,this.getSelectedDevice();case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,this.setAutoSelectedDevice();case 10:e.t0=e.sent;case 11:return r=e.t0,e.abrupt("return",Object.assign(Object.assign({},t),{selectedDevice:r}));case 13:case"end":return e.stop()}},e,this)}))}))}},{key:"getDevices",value:function(){return this.firebaseUser.getDevices()}},{key:"addDevice",value:function(e){return this.firebaseUser.addDevice(e)}},{key:"removeDevice",value:function(t){return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,i,s,c,u;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.firebaseUser.removeDevice(t).then(function(){return[!1]}).catch(function(e){return[!0,e]});case 2:if(n=r.sent,i=e(n,2),s=i[0],c=i[1],!s){r.next=8;break}return r.abrupt("return",Promise.reject(c));case 8:(null==(u=this._selectedDevice.getValue())?void 0:u.deviceId)===t&&this._selectedDevice.next(null);case 10:case"end":return r.stop()}},r,this)}))}},{key:"onUserDevicesChange",value:function(){return this.firebaseUser.onUserDevicesChange()}},{key:"didSelectDevice",value:function(){return!!this._selectedDevice.getValue()}},{key:"selectDevice",value:function(t){return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,i,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.getDevices();case 2:if(n=r.sent){r.next=5;break}return r.abrupt("return",Promise.reject("Did not find any devices for this user. Make sure your device is claimed by your Neurosity account."));case 5:if(i=function(r){return r.find(function(r){if(!Array.isArray(t))return!1;var n=e(t,2),i=n[0],s=n[1];return JSON.stringify(null==r?void 0:r[i])===JSON.stringify(s)})},s="function"==typeof t?t(n):i(n)){r.next=9;break}return r.abrupt("return",Promise.reject("A device was not provided. Try returning a device from the devicesList provided in the callback."));case 9:return r.next=11,this.firebaseUser.hasDevicePermission(s.deviceId);case 11:if(r.sent){r.next=14;break}return r.abrupt("return",Promise.reject("Rejected device access due to permissions."));case 14:return this._selectedDevice.next(s),r.abrupt("return",s);case 16:case"end":return r.stop()}},r,this)}))}},{key:"getSelectedDevice",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._selectedDevice.getValue()){e.next=3;break}return e.abrupt("return",Promise.reject("There is no device currently selected."));case 3:return e.next=5,this.getDevices();case 5:if(r=e.sent){e.next=8;break}return e.abrupt("return",Promise.reject("Did not find any devices for this user. Make sure your device is claimed by your Neurosity account."));case 8:return e.abrupt("return",r.find(function(e){return e.deviceId===t.deviceId}));case 9:case"end":return e.stop()}},e,this)}))}},{key:"status",value:function(){return this.observeNamespace("status").pipe(h.map(function(t){return t?Object.entries(t).reduce(function(t,r){var n=e(r,2),i=n[0],s=n[1];return i.startsWith("__")||(t[i]=s),t},{}):t}))}},{key:"observeNamespace",value:function(e){var t=this,r=a.fromEventPattern(function(r){return t.firebaseDevice.onNamespace(e,r)},function(r){return t.firebaseDevice.offNamespace(e,r)});return this.onDeviceChange().pipe(h.switchMap(function(e){return e?r:a.empty()}))}},{key:"onceNamespace",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.firebaseDevice.onceNamespace(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"changeSettings",value:function(e){return this.firebaseDevice.changeSettings(e)}},{key:"goOffline",value:function(){this.firebaseApp.goOffline()}},{key:"goOnline",value:function(){this.firebaseApp.goOnline()}},{key:"__getApp",value:function(){return this.firebaseApp.app}},{key:"actions",get:function(){var e=this;return{dispatch:function(t){return e.firebaseDevice.dispatchAction(t)}}}},{key:"metrics",get:function(){var e=this,t=function(e){return e.serverType===f.WebsocketClient.serverType};return{next:function(t,r){e.firebaseDevice.nextMetric(t,r)},on:function(r,n){return t(r)?e.websocket.onMetric(r,n):e.firebaseDevice.onMetric(r,n)},subscribe:function(t){var r=e.firebaseDevice.subscribeToMetric(t);return e.subscriptionManager.add(r),r},unsubscribe:function(r,n){e.subscriptionManager.remove(r),e.firebaseDevice.unsubscribeFromMetric(r),t(r)?e.websocket&&e.websocket.removeMetricListener(r,n):e.firebaseDevice.removeMetricListener(r,n)}}}},{key:"skills",get:function(){var e=this;return{get:function(t){return u(e,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.firebaseDevice.getSkill(t));case 1:case"end":return e.stop()}},e,this)}))}}}},{key:"timestamp",get:function(){return this.options.timesync?this.timesync.timestamp:Date.now()}}]),t}();exports.ApiClient=b;
},{"rxjs":"iRqj","./firebase":"kM30","./websocket":"nVpT","../timesync":"CXqr","../subscriptions/SubscriptionManager":"BX8M","rxjs/operators":"cVrl"}],"ZOGh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.metrics=void 0;const e={rest:{},artifactDetector:{},leftArm:{},rightArm:{},leftHandPinch:{},rightHandPinch:{},tongue:{},jumpingJacks:{},leftFoot:{},rightFoot:{},leftThumbFinger:{},leftIndexFinger:{},leftMiddleFinger:{},leftRingFinger:{},leftPinkyFinger:{},rightThumbFinger:{},rightIndexFinger:{},rightMiddleFinger:{},rightRingFinger:{},rightPinkyFinger:{},mentalMath:{},bitingALemon:{},push:{},pull:{},lift:{},drop:{},moveLeft:{},moveRight:{},moveForward:{},moveBackward:{},rotateLeft:{},rotateRight:{},rotateClockwise:{},rotateCounterClockwise:{},disappear:{}},t={CP6:{},F6:{},C4:{},CP4:{},CP3:{},F5:{},C3:{},CP5:{}},i={kinesis:e,predictions:e,channelAnalysis:t,signalQuality:t,status:{state:{},battery:{},charging:{},connected:{},connectedSince:{},connectedLast:{},updatingProgress:{},simulate:{},ssid:{}},accelerometer:{acceleration:{},inclination:{},orientation:{},pitch:{},roll:{},x:{},y:{},z:{}},awareness:{creativity:{},comprehension:{},focus:{},meditation:{},calm:{}},brainwaves:{raw:{},frequency:{},powerByBand:{},psd:{}},emotion:{joy:{},sadness:{},anger:{},surprise:{},excitement:{},disappointment:{},fear:{},love:{},stress:{},interest:{}},facialExpression:{smile:{},laugh:{},frown:{},blink:{},winkLeft:{},winkRight:{}}};exports.metrics=i;var r={metrics:i};exports.default=r;
},{}],"yLLB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@neurosity/ipk");exports.isNotionMetric=function(r){return Object.keys(e.metrics).includes(r)},exports.getLabels=function(r){return Object.keys(e.metrics[r])},exports.hasInvalidLabels=function(e,r){var t=exports.getLabels(e);return!r.every(function(e){return t.includes(e)})},exports.isMetricDisallowed=function(e,r){return"skill"in r&&"metrics"in r.skill&&!r.skill.metrics.includes(e)},exports.validate=function(e,r,t){var s=exports.getLabels(e).join(", ");return r.length?exports.isMetricDisallowed(e,t)?new Error("No permission to access the ".concat(e," metric. To access this metric, edit the skill's permissions")):!!exports.hasInvalidLabels(e,r)&&new Error("One ore more labels provided to ".concat(e," are invalid. The valid labels for ").concat(e," are ").concat(s)):new Error("At least one label is required for ".concat(e," metric. Please add one of the following labels: ").concat(s))};
},{"@neurosity/ipk":"ZOGh"}],"WDyG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mustSelectDevice=new Error('A device must be selected. Make sure to call "notion.selectDevice()"');
},{}],"KQ4u":[function(require,module,exports) {
"use strict";function e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(e,t){return i(e)||n(e,t)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function n(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],n=!0,i=!1,a=void 0;try{for(var c,o=e[Symbol.iterator]();!(n=(c=o.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(u){i=!0,a=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}return r}}function i(e){if(Array.isArray(e))return e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&c(e.prototype,t),r&&c(e,r),e}var u=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function c(e){try{u(n.next(e))}catch(t){a(t)}}function o(e){try{u(n.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(c,o)}u((n=n.apply(e,t||[])).next())})},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});var l=require("rxjs"),p=require("rxjs/operators"),f=require("./api/index"),v=require("./utils/whileOnline"),h=require("./utils/subscription"),m=s(require("./utils/errors")),d={timesync:!1,autoSelectDevice:!0},b=function(){function r(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,r),this._localModeSubject=new l.BehaviorSubject(!1),this.getMetric=function(t){var r=t.metric,n=t.labels,i=t.atomic,a=h.validate(r,n,e.options);if(a)return l.throwError(a);var c=function(t){return new l.Observable(function(a){var c=(i?[e.api.metrics.subscribe({metric:r,labels:n,atomic:i,serverType:t})]:n.map(function(n){return e.api.metrics.subscribe({metric:r,labels:[n],atomic:i,serverType:t})})).map(function(t){return{subscription:t,listener:e.api.metrics.on(t,function(){a.next.apply(a,arguments)})}});return function(){c.forEach(function(t){var r=t.subscription,n=t.listener;e.api.metrics.unsubscribe(r,n)})}})};return e.onDeviceChange().pipe(p.switchMap(function(t){if(!t)return l.empty();var n=t.deviceId;return e.isLocalMode().pipe(p.switchMap(function(t){return t&&h.isNotionMetric(r)?e.socketUrl().pipe(p.switchMap(function(t){return e.api.setWebsocket(t,n)}),p.switchMap(function(){return c(e.api.localServerType)})):(e.api.unsetWebsocket(),c(e.api.defaultServerType))}))}),v.whileOnline({status$:e.status(),allowWhileOnSleepMode:!1}))},this.options=Object.freeze(Object.assign(Object.assign({},d),t)),this.api=new f.ApiClient(this.options)}return o(r,[{key:"login",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.api.login(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"logout",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.logout();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"__getApp",value:function(){return this.api.__getApp()}},{key:"onAuthStateChanged",value:function(){return this.api.onAuthStateChanged()}},{key:"addDevice",value:function(e){return this.api.addDevice(e)}},{key:"removeDevice",value:function(e){return this.api.removeDevice(e)}},{key:"onUserDevicesChange",value:function(){return this.api.onUserDevicesChange()}},{key:"getDevices",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.getDevices();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"selectDevice",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.api.selectDevice(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"getSelectedDevice",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.getSelectedDevice();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"getInfo",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.api.didSelectDevice()){e.next=2;break}return e.abrupt("return",Promise.reject(m.mustSelectDevice));case 2:return e.next=4,this.api.getInfo();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}))}},{key:"isLocalMode",value:function(){return this._localModeSubject.asObservable().pipe(p.share())}},{key:"onDeviceChange",value:function(){return this.api.onDeviceChange()}},{key:"enableLocalMode",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,i,a,c;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("boolean"==typeof e){r.next=2;break}return r.abrupt("return",Promise.reject(new TypeError("enableLocalMode can only accept a boolean")));case 2:if(e){r.next=5;break}return this._localModeSubject.next(e),r.abrupt("return",e);case 5:return r.next=7,this.api.onceNamespace("context/socketUrl").then(function(e){if(!e){return[!1,new Error("Your device's OS does not support localMode. Try updating to the latest OS.")]}return[!0,null]}).catch(function(e){return[!1,e]});case 7:if(n=r.sent,i=t(n,2),a=i[0],c=i[1],a){r.next=13;break}return r.abrupt("return",Promise.reject(c));case 13:return this._localModeSubject.next(e),r.abrupt("return",e);case 15:case"end":return r.stop()}},r,this)}))}},{key:"disconnect",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.disconnect();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"socketUrl",value:function(){var e=this.options.onDeviceSocketUrl;return e?l.of(e):this.api.observeNamespace("context/socketUrl")}},{key:"dispatchAction",value:function(e){return this.api.didSelectDevice()?this.api.actions.dispatch(e):Promise.reject(m.mustSelectDevice)}},{key:"addMarker",value:function(e){if(!this.api.didSelectDevice())throw m.mustSelectDevice;if(!e)throw new Error("Notion: a label is required for addMarker");this.dispatchAction({command:"marker",action:"add",message:{label:e,timestamp:this.api.timestamp}})}},{key:"accelerometer",value:function(){var e=this,t="accelerometer";return l.from(this.getSelectedDevice()).pipe(p.switchMap(function(r){return Number(null==r?void 0:r.modelVersion)>=2?e.getMetric({metric:t,labels:h.getLabels(t),atomic:!0}):l.throwError(new Error("The ".concat(t," metric is not supported by this device. Model version ").concat(2," or greater required.")))}))}},{key:"awareness",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.getMetric({metric:"awareness",labels:e?[e].concat(r):[],atomic:!1})}},{key:"brainwaves",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.getMetric({metric:"brainwaves",labels:e?[e].concat(r):[],atomic:!1})}},{key:"calm",value:function(){return this.awareness("calm")}},{key:"signalQuality",value:function(){return this.getMetric({metric:"signalQuality",labels:h.getLabels("signalQuality"),atomic:!0})}},{key:"emotion",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.getMetric({metric:"emotion",labels:e?[e].concat(r):[],atomic:!1})}},{key:"settings",value:function(){return this.api.observeNamespace("settings")}},{key:"focus",value:function(){return this.awareness("focus")}},{key:"kinesis",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.getMetric({metric:"kinesis",labels:e?[e].concat(r):[],atomic:!1})}},{key:"predictions",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.getMetric({metric:"predictions",labels:e?[e].concat(r):[],atomic:!1})}},{key:"status",value:function(){return this.api.status()}},{key:"changeSettings",value:function(e){return this.api.didSelectDevice()?this.api.changeSettings(e):Promise.reject(m.mustSelectDevice)}},{key:"goOffline",value:function(){this.api.goOffline()}},{key:"goOnline",value:function(){this.api.goOnline()}},{key:"skill",value:function(t){return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,i=this;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(this.api.didSelectDevice()){r.next=2;break}return r.abrupt("return",Promise.reject(m.mustSelectDevice));case 2:return r.next=4,this.api.skills.get(t);case 4:if(null!==(n=r.sent)){r.next=7;break}return r.abrupt("return",Promise.reject(new Error("Access denied for: ".concat(t,". Make sure the skill is installed."))));case 7:return r.abrupt("return",{metric:function(t){var r="skill~".concat(n.id,"~").concat(t),a=new l.Observable(function(e){var n=i.api.metrics.subscribe({metric:r,labels:[t],atomic:!0}),a=i.api.metrics.on(n,function(){e.next.apply(e,arguments)});return function(){i.api.metrics.unsubscribe(n,a)}}).pipe(p.map(function(e){return e[t]}));return Object.defineProperty(a,"next",{value:function(n){i.api.metrics.next(r,e({},t,n))}}),a}});case 8:case"end":return r.stop()}},r,this)}))}},{key:"training",get:function(){var e=this;return{record:function(t){if(!e.api.didSelectDevice())throw m.mustSelectDevice;var r=e.api.user&&"uid"in e.api.user?e.api.user.uid:null,n=Object.assign(Object.assign({fit:!1,baseline:!1,timestamp:e.api.timestamp},t),{userId:r});e.api.actions.dispatch({command:"training",action:"record",message:n})},stop:function(t){if(!e.api.didSelectDevice())throw m.mustSelectDevice;e.api.actions.dispatch({command:"training",action:"stop",message:Object.assign({},t)})},stopAll:function(){if(!e.api.didSelectDevice())throw m.mustSelectDevice;e.api.actions.dispatch({command:"training",action:"stopAll",message:{}})}}}}]),r}();exports.Notion=b,b.credentialWithLink=f.credentialWithLink,b.createUser=f.createUser,b.SERVER_TIMESTAMP=f.SERVER_TIMESTAMP;
},{"rxjs":"iRqj","rxjs/operators":"cVrl","./api/index":"LXvB","./utils/whileOnline":"s7Vt","./utils/subscription":"yLLB","./utils/errors":"WDyG"}],"DCNc":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{c(r.next(t))}catch(e){o(e)}}function a(t){try{c(r.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}c((r=r.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../Notion");function n(n){return t(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new e.Notion(n),t.t0=Object,t.t1=Object,t.t2={},t.next=6,r.skill(n.skill.bundleId);case 6:return t.t3=t.sent,t.t4=t.t1.assign.call(t.t1,t.t2,t.t3),t.t5={props:"props"in n.skill?n.skill.props:{}},i=t.t0.assign.call(t.t0,t.t4,t.t5),delete r.skill,t.abrupt("return",[r,i]);case 12:case"end":return t.stop()}},t)}))}exports.createNotionOnDevice=n;
},{"../Notion":"KQ4u"}],"T9Vd":[function(require,module,exports) {
"use strict";function e(e,u){return r(e)||n(e,u)||t()}function t(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function n(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,u=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(c){u=!0,o=c}finally{try{r||null==a.return||a.return()}finally{if(u)throw o}}return n}}function r(e){if(Array.isArray(e))return e}var u=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(u,o){function i(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?u(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});var o=require("./NotionOnDevice");function i(t){var n=this;return{subscribe:function(r){return u(n,void 0,void 0,regeneratorRuntime.mark(function n(){var i,a,c,s,f,l=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.createNotionOnDevice(Object.assign({},r));case 2:return i=n.sent,a=e(i,2),c=a[0],s=a[1],n.next=8,c.enableLocalMode(!0).catch(function(e){return console.error(e.message)});case 8:return f=t(c,s),n.abrupt("return",{unsubscribe:function(){return u(l,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.disconnect();case 2:if(!(f&&"then"in f)){e.next=7;break}return e.next=5,f;case 5:"function"==typeof(t=e.sent)&&t();case 7:if(!("function"==typeof f&&"then"in f())){e.next=11;break}return e.next=10,f();case 10:return e.abrupt("return",e.sent);case 11:if("function"!=typeof f){e.next=13;break}return e.abrupt("return",f());case 13:return e.abrupt("return",f);case 14:case"end":return e.stop()}},e)}))}});case 10:case"end":return n.stop()}},n)}))}}}exports.createSkill=i;
},{"./NotionOnDevice":"DCNc"}],"d8ek":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./createSkill")),e(require("./NotionOnDevice"));
},{"./createSkill":"T9Vd","./NotionOnDevice":"DCNc"}],"QCba":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./Notion")),e(require("./skills"));
},{"./Notion":"KQ4u","./skills":"d8ek"}]},{},["QCba"], null)
//# sourceMappingURL=/notion.js.map

/***/ }),

/***/ 1308:
/***/ ((module) => {

function webpackEmptyContext(req) {
	var e = new Error("Cannot find module '" + req + "'");
	e.code = 'MODULE_NOT_FOUND';
	throw e;
}
webpackEmptyContext.keys = () => ([]);
webpackEmptyContext.resolve = webpackEmptyContext;
webpackEmptyContext.id = 1308;
module.exports = webpackEmptyContext;

/***/ }),

/***/ 9742:
/***/ ((__unused_webpack_module, exports) => {

"use strict";


exports.byteLength = byteLength
exports.toByteArray = toByteArray
exports.fromByteArray = fromByteArray

var lookup = []
var revLookup = []
var Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array

var code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
for (var i = 0, len = code.length; i < len; ++i) {
  lookup[i] = code[i]
  revLookup[code.charCodeAt(i)] = i
}

// Support decoding URL-safe base64 strings, as Node.js does.
// See: https://en.wikipedia.org/wiki/Base64#URL_applications
revLookup['-'.charCodeAt(0)] = 62
revLookup['_'.charCodeAt(0)] = 63

function getLens (b64) {
  var len = b64.length

  if (len % 4 > 0) {
    throw new Error('Invalid string. Length must be a multiple of 4')
  }

  // Trim off extra bytes after placeholder bytes are found
  // See: https://github.com/beatgammit/base64-js/issues/42
  var validLen = b64.indexOf('=')
  if (validLen === -1) validLen = len

  var placeHoldersLen = validLen === len
    ? 0
    : 4 - (validLen % 4)

  return [validLen, placeHoldersLen]
}

// base64 is 4/3 + up to two characters of the original data
function byteLength (b64) {
  var lens = getLens(b64)
  var validLen = lens[0]
  var placeHoldersLen = lens[1]
  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen
}

function _byteLength (b64, validLen, placeHoldersLen) {
  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen
}

function toByteArray (b64) {
  var tmp
  var lens = getLens(b64)
  var validLen = lens[0]
  var placeHoldersLen = lens[1]

  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))

  var curByte = 0

  // if there are placeholders, only get up to the last complete 4 chars
  var len = placeHoldersLen > 0
    ? validLen - 4
    : validLen

  var i
  for (i = 0; i < len; i += 4) {
    tmp =
      (revLookup[b64.charCodeAt(i)] << 18) |
      (revLookup[b64.charCodeAt(i + 1)] << 12) |
      (revLookup[b64.charCodeAt(i + 2)] << 6) |
      revLookup[b64.charCodeAt(i + 3)]
    arr[curByte++] = (tmp >> 16) & 0xFF
    arr[curByte++] = (tmp >> 8) & 0xFF
    arr[curByte++] = tmp & 0xFF
  }

  if (placeHoldersLen === 2) {
    tmp =
      (revLookup[b64.charCodeAt(i)] << 2) |
      (revLookup[b64.charCodeAt(i + 1)] >> 4)
    arr[curByte++] = tmp & 0xFF
  }

  if (placeHoldersLen === 1) {
    tmp =
      (revLookup[b64.charCodeAt(i)] << 10) |
      (revLookup[b64.charCodeAt(i + 1)] << 4) |
      (revLookup[b64.charCodeAt(i + 2)] >> 2)
    arr[curByte++] = (tmp >> 8) & 0xFF
    arr[curByte++] = tmp & 0xFF
  }

  return arr
}

function tripletToBase64 (num) {
  return lookup[num >> 18 & 0x3F] +
    lookup[num >> 12 & 0x3F] +
    lookup[num >> 6 & 0x3F] +
    lookup[num & 0x3F]
}

function encodeChunk (uint8, start, end) {
  var tmp
  var output = []
  for (var i = start; i < end; i += 3) {
    tmp =
      ((uint8[i] << 16) & 0xFF0000) +
      ((uint8[i + 1] << 8) & 0xFF00) +
      (uint8[i + 2] & 0xFF)
    output.push(tripletToBase64(tmp))
  }
  return output.join('')
}

function fromByteArray (uint8) {
  var tmp
  var len = uint8.length
  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes
  var parts = []
  var maxChunkLength = 16383 // must be multiple of 3

  // go through the array every three bytes, we'll deal with trailing stuff later
  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {
    parts.push(encodeChunk(
      uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)
    ))
  }

  // pad the end with zeros, but make sure to not forget the extra bytes
  if (extraBytes === 1) {
    tmp = uint8[len - 1]
    parts.push(
      lookup[tmp >> 2] +
      lookup[(tmp << 4) & 0x3F] +
      '=='
    )
  } else if (extraBytes === 2) {
    tmp = (uint8[len - 2] << 8) + uint8[len - 1]
    parts.push(
      lookup[tmp >> 10] +
      lookup[(tmp >> 4) & 0x3F] +
      lookup[(tmp << 2) & 0x3F] +
      '='
    )
  }

  return parts.join('')
}


/***/ }),

/***/ 942:
/***/ (function(module, __unused_webpack_exports, __webpack_require__) {

!function(e,t){ true?module.exports=t(__webpack_require__(5840)):0}(this,(function(e){return t={463:function(e,t,s){var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{l(i.next(e))}catch(e){n(e)}}function a(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};const r=s(913).w3cwebsocket;class n{constructor(e){this._socket=null,this.onconnect=()=>{},this.onGenericSignal=e=>{},this.onStateVector=e=>{},this.onSignalProperties=e=>{},this.onStateFormat=e=>{},this.ondisconnect=()=>{},this.onReceiveBlock=()=>{},this.callingFrom="",this.states={},this.signal=null,this.signalProperties=null,this.stateFormat=null,this.stateVecOrder=null,this.SignalType={INT16:0,FLOAT24:1,FLOAT32:2,INT32:3},this.address=e}getNullTermString(e){var t="";let s=0;for(;s<e.byteLength;){var i=e.getUint8(s);if(s++,0==i)break;t+=String.fromCharCode(i)}return t}connect(e,t){let s=this;return void 0===s.address&&(s.address=e),this.callingFrom=t,new Promise(((e,t)=>{s._socket=new r(s.address),s._socket.binaryType="arraybuffer",s._socket.onerror=()=>{t("Error connecting to data source at "+s.address)},s._socket.onopen=()=>{s.onconnect(),e()},s._socket.onclose=e=>{s.ondisconnect(),setTimeout((()=>{console.log("Disconnected"),this.connect("")}),1e3)},s._socket.onmessage=e=>{s._decodeMessage(e.data)}}))}connected(){return null!=this._socket&&this._socket.readyState===r.OPEN}_decodeMessage(e){let t=new DataView(e,0,1).getUint8(0);switch(t){case 3:let s=new DataView(e,1,e.byteLength-1);this._decodeStateFormat(s);break;case 4:let i=new DataView(e,1,2).getUint8(0);switch(i){case 1:let t=new DataView(e,2,e.byteLength-2);this._decodeGenericSignal(t);break;case 3:let s=new DataView(e,2,e.byteLength-2);this._decodeSignalProperties(s);break;default:console.error("Unsupported Supplement: "+i.toString())}this.onReceiveBlock();break;case 5:let r=new DataView(e,1,e.byteLength-1);this._decodeStateVector(r);break;default:console.error("Unsupported Descriptor: "+t.toString())}}_decodePhysicalUnits(e){let t;t={};let s=e.split(" "),i=0;return t.offset=Number(s[i++]),t.gain=Number(s[i++]),t.symbol=s[i++],t.vmin=Number(s[i++]),t.vmax=Number(s[i++]),t}_decodeSignalProperties(e){let t=this.getNullTermString(e);t=t.replace(/{/g," { "),t=t.replace(/}/g," } "),this.signalProperties={};let s=t.split(" "),i=[];for(let e=0;e<s.length;e++)""!==s[e].trim()&&i.push(s[e]);let r=0;if(this.signalProperties.name=i[r++],this.signalProperties.channels=[],"{"===i[r]){for(;"}"!==i[++r];)this.signalProperties.channels.push(i[r]);r++}else{let e=parseInt(i[r++]);for(let t=0;t<e;t++)this.signalProperties.channels.push((t+1).toString())}if(this.signalProperties.elements=[],"{"===i[r]){for(;"}"!==i[++r];)this.signalProperties.elements.push(i[r]);r++}else{let e=parseInt(i[r++]);for(let t=0;t<e;t++)this.signalProperties.elements.push((t+1).toString())}this.signalProperties.numelements=this.signalProperties.elements.length,this.signalProperties.signaltype=i[r++],this.signalProperties.channelunit=this._decodePhysicalUnits(i.slice(r,r+=5).join(" ")),this.signalProperties.elementunit=this._decodePhysicalUnits(i.slice(r,r+=5).join(" ")),r++,this.signalProperties.valueunits=[];for(let e=0;e<this.signalProperties.channels.length;e++)this.signalProperties.valueunits.push(this._decodePhysicalUnits(i.slice(r,r+=5).join(" ")));r++,this.onSignalProperties(this.signalProperties)}_decodeStateFormat(e){this.stateFormat={};let t=this.getNullTermString(e).split("\n");for(let e=0;e<t.length;e++){if(0===t[e].trim().length)continue;let s=t[e].split(" "),i=s[0];this.stateFormat[i]={},this.stateFormat[i].bitWidth=parseInt(s[1]),this.stateFormat[i].defaultValue=parseInt(s[2]),this.stateFormat[i].byteLocation=parseInt(s[3]),this.stateFormat[i].bitLocation=parseInt(s[4])}let s=[];for(let e in this.stateFormat){let t=8*this.stateFormat[e].byteLocation;t+=this.stateFormat[e].bitLocation,s.push([e,t])}s.sort(((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0)),this.stateVecOrder=[];for(let e=0;e<s.length;e++){let t=s[e][0];this.stateVecOrder.push([t,this.stateFormat[t].bitWidth])}this.onStateFormat(this.stateFormat)}_decodeGenericSignal(e){let t=0,s=e.getUint8(t);t+=1;let i=e.getUint16(t,!0);t+=2;let r=e.getUint16(t,!0);t+=2,t+=e.byteOffset;let n=new DataView(e.buffer,t),o=[];for(let e=0;e<i;++e){o.push([]);for(let t=0;t<r;++t)switch(s){case this.SignalType.INT16:o[e].push(n.getInt16(2*(r*e+t),!0));break;case this.SignalType.FLOAT32:o[e].push(n.getFloat32(4*(r*e+t),!0));break;case this.SignalType.INT32:o[e].push(n.getInt32(4*(r*e+t),!0));break;case this.SignalType.FLOAT24:o[e].push(0)}}this.signal=o,this.onGenericSignal(o)}_decodeStateVector(e){if(null==this.stateVecOrder)return;let t=new Int8Array(e.buffer),s=t.indexOf(0),i=t.indexOf(0,s+1),r=new TextDecoder,n=parseInt(r.decode(t.slice(1,s))),o=parseInt(r.decode(t.slice(s+1,i))),a=i+1,l=new DataView(e.buffer,a),c={};for(let e in this.stateFormat)c[e]=Array(o).fill(this.stateFormat[e].defaultValue);for(let e=0;e<o;e++){let t=new Uint8Array(l.buffer,l.byteOffset+e*n,n),s=[];for(let e=0;e<t.length;e++)s.push(0!=(1&t[e])?1:0),s.push(0!=(2&t[e])?1:0),s.push(0!=(4&t[e])?1:0),s.push(0!=(8&t[e])?1:0),s.push(0!=(16&t[e])?1:0),s.push(0!=(32&t[e])?1:0),s.push(0!=(64&t[e])?1:0),s.push(0!=(128&t[e])?1:0);for(let t=0;t<this.stateVecOrder.length;t++){let i=this.stateFormat[this.stateVecOrder[t][0]],r=8*i.byteLocation+i.bitLocation,n=0,o=1;for(let e=0;e<i.bitWidth;e++)s[r+e]&&(n=(n|o)>>>0),o=o<<1>>>0;c[this.stateVecOrder[t][0]][e]=n}}this.onStateVector(c),this.states=c}}e.exports={bciOperator:class{constructor(e){this.ondisconnect=()=>{},this.onStateChange=e=>{},this._execid=0,this._exec={},this.state="",this.address=e}connect(e){return new Promise(((t,s)=>{void 0===this.address&&(this.address=e||"ws://127.0.0.1:80"),this.websocket=new r(this.address),this.websocket.onerror=e=>{s("Error connecting to BCI2000 at "+this.address)},this.websocket.onopen=()=>{t()},this.websocket.onclose=()=>{this.ondisconnect()},this.websocket.onmessage=e=>{let{opcode:t,id:s,contents:i}=JSON.parse(e.data);switch(t){case"O":this._exec[s](i),delete this._exec[s]}}}))}tap(e){let t=this,s="WS"+e+"Server";return this.execute("Get Parameter "+s).then((e=>{if(e.indexOf("does not exist")>=0)return Promise.reject("Location parameter does not exist");if(""===e)return Promise.reject("Location parameter not set");let s=new n;return s.connect(t.address+":"+e.split(":")[1],"").then((e=>s))}))}connected(){return null!==this.websocket&&this.websocket.readyState===r.OPEN}execute(e){let t=this;return this.connected()?new Promise(((s,i)=>{let r=(++t._execid).toString();t._exec[r]=e=>s(e),t.websocket.send(JSON.stringify({opcode:"E",id:r,contents:e}))})):Promise.reject("Cannot execute instruction: not connected to BCI2000")}getVersion(){this.execute("Version").then((e=>console.log(e.split(" ")[1])))}showWindow(){return this.execute("Show Window")}hideWindow(){return this.execute("Hide Window")}setWatch(e,t,s){return this.execute("Add watch "+e+" at "+t+":"+s)}resetSystem(){return this.execute("Reset System")}setConfig(){return this.execute("Set Config")}start(){return this.execute("Start")}stop(){return this.execute("Stop")}kill(){return this.execute("Exit")}stateListen(){setInterval((()=>{this.execute("GET SYSTEM STATE").then((e=>{e.trim()!=this.state&&(this.onStateChange(e.trim()),this.state=e.trim())}))}),500)}getSubjectName(){return i(this,void 0,void 0,(function*(){return yield this.execute("Get Parameter SubjectName")}))}getTaskName(){return i(this,void 0,void 0,(function*(){return yield this.execute("Get Parameter DataFile")}))}getParameters(){return i(this,void 0,void 0,(function*(){let e,t=(yield this.execute("List Parameters")).split("\n"),s={};return t.forEach((t=>{let i=t.split("=")[0],r=i.split(" ")[1],n=i.split(" ")[2],o=i.split(" ")[0].split(":");o.forEach(((t,i)=>{switch(i){case 0:null==s[o[0]]&&(s[o[0]]={}),e=s[o[0]];break;case 1:null==s[o[0]][o[1]]&&(s[o[0]][o[1]]={}),e=s[o[0]][o[1]];break;case 2:null==s[o[0]][o[1]][o[2]]&&(s[o[0]][o[1]][o[2]]={}),e=s[o[0]][o[1]][o[2]]}})),"matrix"!=r&&4==t.split("=")[1].split("//")[0].trim().split(" ").length?e[n]={dataType:r,value:{value:t.split("=")[1].split("//")[0].trim().split(" ")[0],defaultValue:t.split("=")[1].split("//")[0].trim().split(" ")[1],low:t.split("=")[1].split("//")[0].trim().split(" ")[2],high:t.split("=")[1].split("//")[0].trim().split(" ")[3]},comment:t.split("=")[1].split("//")[1]}:e[n]={dataType:r,value:t.split("=")[1].split("//")[0].trim(),comment:t.split("=")[1].split("//")[1]}})),s}))}},bciData:n}},913:t=>{"use strict";t.exports=e}},s={},function e(i){var r=s[i];if(void 0!==r)return r.exports;var n=s[i]={exports:{}};return t[i].call(n.exports,n,n.exports,e),n.exports}(463);var t,s}));
//# sourceMappingURL=index.js.map

/***/ }),

/***/ 8764:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
/* eslint-disable no-proto */



var base64 = __webpack_require__(9742)
var ieee754 = __webpack_require__(645)
var isArray = __webpack_require__(5826)

exports.Buffer = Buffer
exports.SlowBuffer = SlowBuffer
exports.INSPECT_MAX_BYTES = 50

/**
 * If `Buffer.TYPED_ARRAY_SUPPORT`:
 *   === true    Use Uint8Array implementation (fastest)
 *   === false   Use Object implementation (most compatible, even IE6)
 *
 * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,
 * Opera 11.6+, iOS 4.2+.
 *
 * Due to various browser bugs, sometimes the Object implementation will be used even
 * when the browser supports typed arrays.
 *
 * Note:
 *
 *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,
 *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.
 *
 *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.
 *
 *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of
 *     incorrect length in some situations.

 * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they
 * get the Object implementation, which is slower but behaves correctly.
 */
Buffer.TYPED_ARRAY_SUPPORT = __webpack_require__.g.TYPED_ARRAY_SUPPORT !== undefined
  ? __webpack_require__.g.TYPED_ARRAY_SUPPORT
  : typedArraySupport()

/*
 * Export kMaxLength after typed array support is determined.
 */
exports.kMaxLength = kMaxLength()

function typedArraySupport () {
  try {
    var arr = new Uint8Array(1)
    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}
    return arr.foo() === 42 && // typed array instances can be augmented
        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`
        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`
  } catch (e) {
    return false
  }
}

function kMaxLength () {
  return Buffer.TYPED_ARRAY_SUPPORT
    ? 0x7fffffff
    : 0x3fffffff
}

function createBuffer (that, length) {
  if (kMaxLength() < length) {
    throw new RangeError('Invalid typed array length')
  }
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    // Return an augmented `Uint8Array` instance, for best performance
    that = new Uint8Array(length)
    that.__proto__ = Buffer.prototype
  } else {
    // Fallback: Return an object instance of the Buffer class
    if (that === null) {
      that = new Buffer(length)
    }
    that.length = length
  }

  return that
}

/**
 * The Buffer constructor returns instances of `Uint8Array` that have their
 * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of
 * `Uint8Array`, so the returned instances will have all the node `Buffer` methods
 * and the `Uint8Array` methods. Square bracket notation works as expected -- it
 * returns a single octet.
 *
 * The `Uint8Array` prototype remains unmodified.
 */

function Buffer (arg, encodingOrOffset, length) {
  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {
    return new Buffer(arg, encodingOrOffset, length)
  }

  // Common case.
  if (typeof arg === 'number') {
    if (typeof encodingOrOffset === 'string') {
      throw new Error(
        'If encoding is specified then the first argument must be a string'
      )
    }
    return allocUnsafe(this, arg)
  }
  return from(this, arg, encodingOrOffset, length)
}

Buffer.poolSize = 8192 // not used by this implementation

// TODO: Legacy, not needed anymore. Remove in next major version.
Buffer._augment = function (arr) {
  arr.__proto__ = Buffer.prototype
  return arr
}

function from (that, value, encodingOrOffset, length) {
  if (typeof value === 'number') {
    throw new TypeError('"value" argument must not be a number')
  }

  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {
    return fromArrayBuffer(that, value, encodingOrOffset, length)
  }

  if (typeof value === 'string') {
    return fromString(that, value, encodingOrOffset)
  }

  return fromObject(that, value)
}

/**
 * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError
 * if value is a number.
 * Buffer.from(str[, encoding])
 * Buffer.from(array)
 * Buffer.from(buffer)
 * Buffer.from(arrayBuffer[, byteOffset[, length]])
 **/
Buffer.from = function (value, encodingOrOffset, length) {
  return from(null, value, encodingOrOffset, length)
}

if (Buffer.TYPED_ARRAY_SUPPORT) {
  Buffer.prototype.__proto__ = Uint8Array.prototype
  Buffer.__proto__ = Uint8Array
  if (typeof Symbol !== 'undefined' && Symbol.species &&
      Buffer[Symbol.species] === Buffer) {
    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97
    Object.defineProperty(Buffer, Symbol.species, {
      value: null,
      configurable: true
    })
  }
}

function assertSize (size) {
  if (typeof size !== 'number') {
    throw new TypeError('"size" argument must be a number')
  } else if (size < 0) {
    throw new RangeError('"size" argument must not be negative')
  }
}

function alloc (that, size, fill, encoding) {
  assertSize(size)
  if (size <= 0) {
    return createBuffer(that, size)
  }
  if (fill !== undefined) {
    // Only pay attention to encoding if it's a string. This
    // prevents accidentally sending in a number that would
    // be interpretted as a start offset.
    return typeof encoding === 'string'
      ? createBuffer(that, size).fill(fill, encoding)
      : createBuffer(that, size).fill(fill)
  }
  return createBuffer(that, size)
}

/**
 * Creates a new filled Buffer instance.
 * alloc(size[, fill[, encoding]])
 **/
Buffer.alloc = function (size, fill, encoding) {
  return alloc(null, size, fill, encoding)
}

function allocUnsafe (that, size) {
  assertSize(size)
  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)
  if (!Buffer.TYPED_ARRAY_SUPPORT) {
    for (var i = 0; i < size; ++i) {
      that[i] = 0
    }
  }
  return that
}

/**
 * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.
 * */
Buffer.allocUnsafe = function (size) {
  return allocUnsafe(null, size)
}
/**
 * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.
 */
Buffer.allocUnsafeSlow = function (size) {
  return allocUnsafe(null, size)
}

function fromString (that, string, encoding) {
  if (typeof encoding !== 'string' || encoding === '') {
    encoding = 'utf8'
  }

  if (!Buffer.isEncoding(encoding)) {
    throw new TypeError('"encoding" must be a valid string encoding')
  }

  var length = byteLength(string, encoding) | 0
  that = createBuffer(that, length)

  var actual = that.write(string, encoding)

  if (actual !== length) {
    // Writing a hex string, for example, that contains invalid characters will
    // cause everything after the first invalid character to be ignored. (e.g.
    // 'abxxcd' will be treated as 'ab')
    that = that.slice(0, actual)
  }

  return that
}

function fromArrayLike (that, array) {
  var length = array.length < 0 ? 0 : checked(array.length) | 0
  that = createBuffer(that, length)
  for (var i = 0; i < length; i += 1) {
    that[i] = array[i] & 255
  }
  return that
}

function fromArrayBuffer (that, array, byteOffset, length) {
  array.byteLength // this throws if `array` is not a valid ArrayBuffer

  if (byteOffset < 0 || array.byteLength < byteOffset) {
    throw new RangeError('\'offset\' is out of bounds')
  }

  if (array.byteLength < byteOffset + (length || 0)) {
    throw new RangeError('\'length\' is out of bounds')
  }

  if (byteOffset === undefined && length === undefined) {
    array = new Uint8Array(array)
  } else if (length === undefined) {
    array = new Uint8Array(array, byteOffset)
  } else {
    array = new Uint8Array(array, byteOffset, length)
  }

  if (Buffer.TYPED_ARRAY_SUPPORT) {
    // Return an augmented `Uint8Array` instance, for best performance
    that = array
    that.__proto__ = Buffer.prototype
  } else {
    // Fallback: Return an object instance of the Buffer class
    that = fromArrayLike(that, array)
  }
  return that
}

function fromObject (that, obj) {
  if (Buffer.isBuffer(obj)) {
    var len = checked(obj.length) | 0
    that = createBuffer(that, len)

    if (that.length === 0) {
      return that
    }

    obj.copy(that, 0, 0, len)
    return that
  }

  if (obj) {
    if ((typeof ArrayBuffer !== 'undefined' &&
        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {
      if (typeof obj.length !== 'number' || isnan(obj.length)) {
        return createBuffer(that, 0)
      }
      return fromArrayLike(that, obj)
    }

    if (obj.type === 'Buffer' && isArray(obj.data)) {
      return fromArrayLike(that, obj.data)
    }
  }

  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')
}

function checked (length) {
  // Note: cannot use `length < kMaxLength()` here because that fails when
  // length is NaN (which is otherwise coerced to zero.)
  if (length >= kMaxLength()) {
    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +
                         'size: 0x' + kMaxLength().toString(16) + ' bytes')
  }
  return length | 0
}

function SlowBuffer (length) {
  if (+length != length) { // eslint-disable-line eqeqeq
    length = 0
  }
  return Buffer.alloc(+length)
}

Buffer.isBuffer = function isBuffer (b) {
  return !!(b != null && b._isBuffer)
}

Buffer.compare = function compare (a, b) {
  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {
    throw new TypeError('Arguments must be Buffers')
  }

  if (a === b) return 0

  var x = a.length
  var y = b.length

  for (var i = 0, len = Math.min(x, y); i < len; ++i) {
    if (a[i] !== b[i]) {
      x = a[i]
      y = b[i]
      break
    }
  }

  if (x < y) return -1
  if (y < x) return 1
  return 0
}

Buffer.isEncoding = function isEncoding (encoding) {
  switch (String(encoding).toLowerCase()) {
    case 'hex':
    case 'utf8':
    case 'utf-8':
    case 'ascii':
    case 'latin1':
    case 'binary':
    case 'base64':
    case 'ucs2':
    case 'ucs-2':
    case 'utf16le':
    case 'utf-16le':
      return true
    default:
      return false
  }
}

Buffer.concat = function concat (list, length) {
  if (!isArray(list)) {
    throw new TypeError('"list" argument must be an Array of Buffers')
  }

  if (list.length === 0) {
    return Buffer.alloc(0)
  }

  var i
  if (length === undefined) {
    length = 0
    for (i = 0; i < list.length; ++i) {
      length += list[i].length
    }
  }

  var buffer = Buffer.allocUnsafe(length)
  var pos = 0
  for (i = 0; i < list.length; ++i) {
    var buf = list[i]
    if (!Buffer.isBuffer(buf)) {
      throw new TypeError('"list" argument must be an Array of Buffers')
    }
    buf.copy(buffer, pos)
    pos += buf.length
  }
  return buffer
}

function byteLength (string, encoding) {
  if (Buffer.isBuffer(string)) {
    return string.length
  }
  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&
      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {
    return string.byteLength
  }
  if (typeof string !== 'string') {
    string = '' + string
  }

  var len = string.length
  if (len === 0) return 0

  // Use a for loop to avoid recursion
  var loweredCase = false
  for (;;) {
    switch (encoding) {
      case 'ascii':
      case 'latin1':
      case 'binary':
        return len
      case 'utf8':
      case 'utf-8':
      case undefined:
        return utf8ToBytes(string).length
      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return len * 2
      case 'hex':
        return len >>> 1
      case 'base64':
        return base64ToBytes(string).length
      default:
        if (loweredCase) return utf8ToBytes(string).length // assume utf8
        encoding = ('' + encoding).toLowerCase()
        loweredCase = true
    }
  }
}
Buffer.byteLength = byteLength

function slowToString (encoding, start, end) {
  var loweredCase = false

  // No need to verify that "this.length <= MAX_UINT32" since it's a read-only
  // property of a typed array.

  // This behaves neither like String nor Uint8Array in that we set start/end
  // to their upper/lower bounds if the value passed is out of range.
  // undefined is handled specially as per ECMA-262 6th Edition,
  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.
  if (start === undefined || start < 0) {
    start = 0
  }
  // Return early if start > this.length. Done here to prevent potential uint32
  // coercion fail below.
  if (start > this.length) {
    return ''
  }

  if (end === undefined || end > this.length) {
    end = this.length
  }

  if (end <= 0) {
    return ''
  }

  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.
  end >>>= 0
  start >>>= 0

  if (end <= start) {
    return ''
  }

  if (!encoding) encoding = 'utf8'

  while (true) {
    switch (encoding) {
      case 'hex':
        return hexSlice(this, start, end)

      case 'utf8':
      case 'utf-8':
        return utf8Slice(this, start, end)

      case 'ascii':
        return asciiSlice(this, start, end)

      case 'latin1':
      case 'binary':
        return latin1Slice(this, start, end)

      case 'base64':
        return base64Slice(this, start, end)

      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return utf16leSlice(this, start, end)

      default:
        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)
        encoding = (encoding + '').toLowerCase()
        loweredCase = true
    }
  }
}

// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect
// Buffer instances.
Buffer.prototype._isBuffer = true

function swap (b, n, m) {
  var i = b[n]
  b[n] = b[m]
  b[m] = i
}

Buffer.prototype.swap16 = function swap16 () {
  var len = this.length
  if (len % 2 !== 0) {
    throw new RangeError('Buffer size must be a multiple of 16-bits')
  }
  for (var i = 0; i < len; i += 2) {
    swap(this, i, i + 1)
  }
  return this
}

Buffer.prototype.swap32 = function swap32 () {
  var len = this.length
  if (len % 4 !== 0) {
    throw new RangeError('Buffer size must be a multiple of 32-bits')
  }
  for (var i = 0; i < len; i += 4) {
    swap(this, i, i + 3)
    swap(this, i + 1, i + 2)
  }
  return this
}

Buffer.prototype.swap64 = function swap64 () {
  var len = this.length
  if (len % 8 !== 0) {
    throw new RangeError('Buffer size must be a multiple of 64-bits')
  }
  for (var i = 0; i < len; i += 8) {
    swap(this, i, i + 7)
    swap(this, i + 1, i + 6)
    swap(this, i + 2, i + 5)
    swap(this, i + 3, i + 4)
  }
  return this
}

Buffer.prototype.toString = function toString () {
  var length = this.length | 0
  if (length === 0) return ''
  if (arguments.length === 0) return utf8Slice(this, 0, length)
  return slowToString.apply(this, arguments)
}

Buffer.prototype.equals = function equals (b) {
  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')
  if (this === b) return true
  return Buffer.compare(this, b) === 0
}

Buffer.prototype.inspect = function inspect () {
  var str = ''
  var max = exports.INSPECT_MAX_BYTES
  if (this.length > 0) {
    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')
    if (this.length > max) str += ' ... '
  }
  return '<Buffer ' + str + '>'
}

Buffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {
  if (!Buffer.isBuffer(target)) {
    throw new TypeError('Argument must be a Buffer')
  }

  if (start === undefined) {
    start = 0
  }
  if (end === undefined) {
    end = target ? target.length : 0
  }
  if (thisStart === undefined) {
    thisStart = 0
  }
  if (thisEnd === undefined) {
    thisEnd = this.length
  }

  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {
    throw new RangeError('out of range index')
  }

  if (thisStart >= thisEnd && start >= end) {
    return 0
  }
  if (thisStart >= thisEnd) {
    return -1
  }
  if (start >= end) {
    return 1
  }

  start >>>= 0
  end >>>= 0
  thisStart >>>= 0
  thisEnd >>>= 0

  if (this === target) return 0

  var x = thisEnd - thisStart
  var y = end - start
  var len = Math.min(x, y)

  var thisCopy = this.slice(thisStart, thisEnd)
  var targetCopy = target.slice(start, end)

  for (var i = 0; i < len; ++i) {
    if (thisCopy[i] !== targetCopy[i]) {
      x = thisCopy[i]
      y = targetCopy[i]
      break
    }
  }

  if (x < y) return -1
  if (y < x) return 1
  return 0
}

// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,
// OR the last index of `val` in `buffer` at offset <= `byteOffset`.
//
// Arguments:
// - buffer - a Buffer to search
// - val - a string, Buffer, or number
// - byteOffset - an index into `buffer`; will be clamped to an int32
// - encoding - an optional encoding, relevant is val is a string
// - dir - true for indexOf, false for lastIndexOf
function bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {
  // Empty buffer means no match
  if (buffer.length === 0) return -1

  // Normalize byteOffset
  if (typeof byteOffset === 'string') {
    encoding = byteOffset
    byteOffset = 0
  } else if (byteOffset > 0x7fffffff) {
    byteOffset = 0x7fffffff
  } else if (byteOffset < -0x80000000) {
    byteOffset = -0x80000000
  }
  byteOffset = +byteOffset  // Coerce to Number.
  if (isNaN(byteOffset)) {
    // byteOffset: it it's undefined, null, NaN, "foo", etc, search whole buffer
    byteOffset = dir ? 0 : (buffer.length - 1)
  }

  // Normalize byteOffset: negative offsets start from the end of the buffer
  if (byteOffset < 0) byteOffset = buffer.length + byteOffset
  if (byteOffset >= buffer.length) {
    if (dir) return -1
    else byteOffset = buffer.length - 1
  } else if (byteOffset < 0) {
    if (dir) byteOffset = 0
    else return -1
  }

  // Normalize val
  if (typeof val === 'string') {
    val = Buffer.from(val, encoding)
  }

  // Finally, search either indexOf (if dir is true) or lastIndexOf
  if (Buffer.isBuffer(val)) {
    // Special case: looking for empty string/buffer always fails
    if (val.length === 0) {
      return -1
    }
    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)
  } else if (typeof val === 'number') {
    val = val & 0xFF // Search for a byte value [0-255]
    if (Buffer.TYPED_ARRAY_SUPPORT &&
        typeof Uint8Array.prototype.indexOf === 'function') {
      if (dir) {
        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)
      } else {
        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)
      }
    }
    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)
  }

  throw new TypeError('val must be string, number or Buffer')
}

function arrayIndexOf (arr, val, byteOffset, encoding, dir) {
  var indexSize = 1
  var arrLength = arr.length
  var valLength = val.length

  if (encoding !== undefined) {
    encoding = String(encoding).toLowerCase()
    if (encoding === 'ucs2' || encoding === 'ucs-2' ||
        encoding === 'utf16le' || encoding === 'utf-16le') {
      if (arr.length < 2 || val.length < 2) {
        return -1
      }
      indexSize = 2
      arrLength /= 2
      valLength /= 2
      byteOffset /= 2
    }
  }

  function read (buf, i) {
    if (indexSize === 1) {
      return buf[i]
    } else {
      return buf.readUInt16BE(i * indexSize)
    }
  }

  var i
  if (dir) {
    var foundIndex = -1
    for (i = byteOffset; i < arrLength; i++) {
      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {
        if (foundIndex === -1) foundIndex = i
        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize
      } else {
        if (foundIndex !== -1) i -= i - foundIndex
        foundIndex = -1
      }
    }
  } else {
    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength
    for (i = byteOffset; i >= 0; i--) {
      var found = true
      for (var j = 0; j < valLength; j++) {
        if (read(arr, i + j) !== read(val, j)) {
          found = false
          break
        }
      }
      if (found) return i
    }
  }

  return -1
}

Buffer.prototype.includes = function includes (val, byteOffset, encoding) {
  return this.indexOf(val, byteOffset, encoding) !== -1
}

Buffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {
  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)
}

Buffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {
  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)
}

function hexWrite (buf, string, offset, length) {
  offset = Number(offset) || 0
  var remaining = buf.length - offset
  if (!length) {
    length = remaining
  } else {
    length = Number(length)
    if (length > remaining) {
      length = remaining
    }
  }

  // must be an even number of digits
  var strLen = string.length
  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')

  if (length > strLen / 2) {
    length = strLen / 2
  }
  for (var i = 0; i < length; ++i) {
    var parsed = parseInt(string.substr(i * 2, 2), 16)
    if (isNaN(parsed)) return i
    buf[offset + i] = parsed
  }
  return i
}

function utf8Write (buf, string, offset, length) {
  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)
}

function asciiWrite (buf, string, offset, length) {
  return blitBuffer(asciiToBytes(string), buf, offset, length)
}

function latin1Write (buf, string, offset, length) {
  return asciiWrite(buf, string, offset, length)
}

function base64Write (buf, string, offset, length) {
  return blitBuffer(base64ToBytes(string), buf, offset, length)
}

function ucs2Write (buf, string, offset, length) {
  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)
}

Buffer.prototype.write = function write (string, offset, length, encoding) {
  // Buffer#write(string)
  if (offset === undefined) {
    encoding = 'utf8'
    length = this.length
    offset = 0
  // Buffer#write(string, encoding)
  } else if (length === undefined && typeof offset === 'string') {
    encoding = offset
    length = this.length
    offset = 0
  // Buffer#write(string, offset[, length][, encoding])
  } else if (isFinite(offset)) {
    offset = offset | 0
    if (isFinite(length)) {
      length = length | 0
      if (encoding === undefined) encoding = 'utf8'
    } else {
      encoding = length
      length = undefined
    }
  // legacy write(string, encoding, offset, length) - remove in v0.13
  } else {
    throw new Error(
      'Buffer.write(string, encoding, offset[, length]) is no longer supported'
    )
  }

  var remaining = this.length - offset
  if (length === undefined || length > remaining) length = remaining

  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {
    throw new RangeError('Attempt to write outside buffer bounds')
  }

  if (!encoding) encoding = 'utf8'

  var loweredCase = false
  for (;;) {
    switch (encoding) {
      case 'hex':
        return hexWrite(this, string, offset, length)

      case 'utf8':
      case 'utf-8':
        return utf8Write(this, string, offset, length)

      case 'ascii':
        return asciiWrite(this, string, offset, length)

      case 'latin1':
      case 'binary':
        return latin1Write(this, string, offset, length)

      case 'base64':
        // Warning: maxLength not taken into account in base64Write
        return base64Write(this, string, offset, length)

      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return ucs2Write(this, string, offset, length)

      default:
        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)
        encoding = ('' + encoding).toLowerCase()
        loweredCase = true
    }
  }
}

Buffer.prototype.toJSON = function toJSON () {
  return {
    type: 'Buffer',
    data: Array.prototype.slice.call(this._arr || this, 0)
  }
}

function base64Slice (buf, start, end) {
  if (start === 0 && end === buf.length) {
    return base64.fromByteArray(buf)
  } else {
    return base64.fromByteArray(buf.slice(start, end))
  }
}

function utf8Slice (buf, start, end) {
  end = Math.min(buf.length, end)
  var res = []

  var i = start
  while (i < end) {
    var firstByte = buf[i]
    var codePoint = null
    var bytesPerSequence = (firstByte > 0xEF) ? 4
      : (firstByte > 0xDF) ? 3
      : (firstByte > 0xBF) ? 2
      : 1

    if (i + bytesPerSequence <= end) {
      var secondByte, thirdByte, fourthByte, tempCodePoint

      switch (bytesPerSequence) {
        case 1:
          if (firstByte < 0x80) {
            codePoint = firstByte
          }
          break
        case 2:
          secondByte = buf[i + 1]
          if ((secondByte & 0xC0) === 0x80) {
            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)
            if (tempCodePoint > 0x7F) {
              codePoint = tempCodePoint
            }
          }
          break
        case 3:
          secondByte = buf[i + 1]
          thirdByte = buf[i + 2]
          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {
            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)
            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {
              codePoint = tempCodePoint
            }
          }
          break
        case 4:
          secondByte = buf[i + 1]
          thirdByte = buf[i + 2]
          fourthByte = buf[i + 3]
          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {
            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)
            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {
              codePoint = tempCodePoint
            }
          }
      }
    }

    if (codePoint === null) {
      // we did not generate a valid codePoint so insert a
      // replacement char (U+FFFD) and advance only 1 byte
      codePoint = 0xFFFD
      bytesPerSequence = 1
    } else if (codePoint > 0xFFFF) {
      // encode to utf16 (surrogate pair dance)
      codePoint -= 0x10000
      res.push(codePoint >>> 10 & 0x3FF | 0xD800)
      codePoint = 0xDC00 | codePoint & 0x3FF
    }

    res.push(codePoint)
    i += bytesPerSequence
  }

  return decodeCodePointsArray(res)
}

// Based on http://stackoverflow.com/a/22747272/680742, the browser with
// the lowest limit is Chrome, with 0x10000 args.
// We go 1 magnitude less, for safety
var MAX_ARGUMENTS_LENGTH = 0x1000

function decodeCodePointsArray (codePoints) {
  var len = codePoints.length
  if (len <= MAX_ARGUMENTS_LENGTH) {
    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()
  }

  // Decode in chunks to avoid "call stack size exceeded".
  var res = ''
  var i = 0
  while (i < len) {
    res += String.fromCharCode.apply(
      String,
      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)
    )
  }
  return res
}

function asciiSlice (buf, start, end) {
  var ret = ''
  end = Math.min(buf.length, end)

  for (var i = start; i < end; ++i) {
    ret += String.fromCharCode(buf[i] & 0x7F)
  }
  return ret
}

function latin1Slice (buf, start, end) {
  var ret = ''
  end = Math.min(buf.length, end)

  for (var i = start; i < end; ++i) {
    ret += String.fromCharCode(buf[i])
  }
  return ret
}

function hexSlice (buf, start, end) {
  var len = buf.length

  if (!start || start < 0) start = 0
  if (!end || end < 0 || end > len) end = len

  var out = ''
  for (var i = start; i < end; ++i) {
    out += toHex(buf[i])
  }
  return out
}

function utf16leSlice (buf, start, end) {
  var bytes = buf.slice(start, end)
  var res = ''
  for (var i = 0; i < bytes.length; i += 2) {
    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)
  }
  return res
}

Buffer.prototype.slice = function slice (start, end) {
  var len = this.length
  start = ~~start
  end = end === undefined ? len : ~~end

  if (start < 0) {
    start += len
    if (start < 0) start = 0
  } else if (start > len) {
    start = len
  }

  if (end < 0) {
    end += len
    if (end < 0) end = 0
  } else if (end > len) {
    end = len
  }

  if (end < start) end = start

  var newBuf
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    newBuf = this.subarray(start, end)
    newBuf.__proto__ = Buffer.prototype
  } else {
    var sliceLen = end - start
    newBuf = new Buffer(sliceLen, undefined)
    for (var i = 0; i < sliceLen; ++i) {
      newBuf[i] = this[i + start]
    }
  }

  return newBuf
}

/*
 * Need to make sure that buffer isn't trying to write out of bounds.
 */
function checkOffset (offset, ext, length) {
  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')
  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')
}

Buffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) checkOffset(offset, byteLength, this.length)

  var val = this[offset]
  var mul = 1
  var i = 0
  while (++i < byteLength && (mul *= 0x100)) {
    val += this[offset + i] * mul
  }

  return val
}

Buffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) {
    checkOffset(offset, byteLength, this.length)
  }

  var val = this[offset + --byteLength]
  var mul = 1
  while (byteLength > 0 && (mul *= 0x100)) {
    val += this[offset + --byteLength] * mul
  }

  return val
}

Buffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 1, this.length)
  return this[offset]
}

Buffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 2, this.length)
  return this[offset] | (this[offset + 1] << 8)
}

Buffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 2, this.length)
  return (this[offset] << 8) | this[offset + 1]
}

Buffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)

  return ((this[offset]) |
      (this[offset + 1] << 8) |
      (this[offset + 2] << 16)) +
      (this[offset + 3] * 0x1000000)
}

Buffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)

  return (this[offset] * 0x1000000) +
    ((this[offset + 1] << 16) |
    (this[offset + 2] << 8) |
    this[offset + 3])
}

Buffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) checkOffset(offset, byteLength, this.length)

  var val = this[offset]
  var mul = 1
  var i = 0
  while (++i < byteLength && (mul *= 0x100)) {
    val += this[offset + i] * mul
  }
  mul *= 0x80

  if (val >= mul) val -= Math.pow(2, 8 * byteLength)

  return val
}

Buffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) checkOffset(offset, byteLength, this.length)

  var i = byteLength
  var mul = 1
  var val = this[offset + --i]
  while (i > 0 && (mul *= 0x100)) {
    val += this[offset + --i] * mul
  }
  mul *= 0x80

  if (val >= mul) val -= Math.pow(2, 8 * byteLength)

  return val
}

Buffer.prototype.readInt8 = function readInt8 (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 1, this.length)
  if (!(this[offset] & 0x80)) return (this[offset])
  return ((0xff - this[offset] + 1) * -1)
}

Buffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 2, this.length)
  var val = this[offset] | (this[offset + 1] << 8)
  return (val & 0x8000) ? val | 0xFFFF0000 : val
}

Buffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 2, this.length)
  var val = this[offset + 1] | (this[offset] << 8)
  return (val & 0x8000) ? val | 0xFFFF0000 : val
}

Buffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)

  return (this[offset]) |
    (this[offset + 1] << 8) |
    (this[offset + 2] << 16) |
    (this[offset + 3] << 24)
}

Buffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)

  return (this[offset] << 24) |
    (this[offset + 1] << 16) |
    (this[offset + 2] << 8) |
    (this[offset + 3])
}

Buffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)
  return ieee754.read(this, offset, true, 23, 4)
}

Buffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)
  return ieee754.read(this, offset, false, 23, 4)
}

Buffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 8, this.length)
  return ieee754.read(this, offset, true, 52, 8)
}

Buffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 8, this.length)
  return ieee754.read(this, offset, false, 52, 8)
}

function checkInt (buf, value, offset, ext, max, min) {
  if (!Buffer.isBuffer(buf)) throw new TypeError('"buffer" argument must be a Buffer instance')
  if (value > max || value < min) throw new RangeError('"value" argument is out of bounds')
  if (offset + ext > buf.length) throw new RangeError('Index out of range')
}

Buffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) {
    var maxBytes = Math.pow(2, 8 * byteLength) - 1
    checkInt(this, value, offset, byteLength, maxBytes, 0)
  }

  var mul = 1
  var i = 0
  this[offset] = value & 0xFF
  while (++i < byteLength && (mul *= 0x100)) {
    this[offset + i] = (value / mul) & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) {
    var maxBytes = Math.pow(2, 8 * byteLength) - 1
    checkInt(this, value, offset, byteLength, maxBytes, 0)
  }

  var i = byteLength - 1
  var mul = 1
  this[offset + i] = value & 0xFF
  while (--i >= 0 && (mul *= 0x100)) {
    this[offset + i] = (value / mul) & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)
  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)
  this[offset] = (value & 0xff)
  return offset + 1
}

function objectWriteUInt16 (buf, value, offset, littleEndian) {
  if (value < 0) value = 0xffff + value + 1
  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {
    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>
      (littleEndian ? i : 1 - i) * 8
  }
}

Buffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value & 0xff)
    this[offset + 1] = (value >>> 8)
  } else {
    objectWriteUInt16(this, value, offset, true)
  }
  return offset + 2
}

Buffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value >>> 8)
    this[offset + 1] = (value & 0xff)
  } else {
    objectWriteUInt16(this, value, offset, false)
  }
  return offset + 2
}

function objectWriteUInt32 (buf, value, offset, littleEndian) {
  if (value < 0) value = 0xffffffff + value + 1
  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {
    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff
  }
}

Buffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset + 3] = (value >>> 24)
    this[offset + 2] = (value >>> 16)
    this[offset + 1] = (value >>> 8)
    this[offset] = (value & 0xff)
  } else {
    objectWriteUInt32(this, value, offset, true)
  }
  return offset + 4
}

Buffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value >>> 24)
    this[offset + 1] = (value >>> 16)
    this[offset + 2] = (value >>> 8)
    this[offset + 3] = (value & 0xff)
  } else {
    objectWriteUInt32(this, value, offset, false)
  }
  return offset + 4
}

Buffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) {
    var limit = Math.pow(2, 8 * byteLength - 1)

    checkInt(this, value, offset, byteLength, limit - 1, -limit)
  }

  var i = 0
  var mul = 1
  var sub = 0
  this[offset] = value & 0xFF
  while (++i < byteLength && (mul *= 0x100)) {
    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {
      sub = 1
    }
    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) {
    var limit = Math.pow(2, 8 * byteLength - 1)

    checkInt(this, value, offset, byteLength, limit - 1, -limit)
  }

  var i = byteLength - 1
  var mul = 1
  var sub = 0
  this[offset + i] = value & 0xFF
  while (--i >= 0 && (mul *= 0x100)) {
    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {
      sub = 1
    }
    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)
  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)
  if (value < 0) value = 0xff + value + 1
  this[offset] = (value & 0xff)
  return offset + 1
}

Buffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value & 0xff)
    this[offset + 1] = (value >>> 8)
  } else {
    objectWriteUInt16(this, value, offset, true)
  }
  return offset + 2
}

Buffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value >>> 8)
    this[offset + 1] = (value & 0xff)
  } else {
    objectWriteUInt16(this, value, offset, false)
  }
  return offset + 2
}

Buffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value & 0xff)
    this[offset + 1] = (value >>> 8)
    this[offset + 2] = (value >>> 16)
    this[offset + 3] = (value >>> 24)
  } else {
    objectWriteUInt32(this, value, offset, true)
  }
  return offset + 4
}

Buffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)
  if (value < 0) value = 0xffffffff + value + 1
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value >>> 24)
    this[offset + 1] = (value >>> 16)
    this[offset + 2] = (value >>> 8)
    this[offset + 3] = (value & 0xff)
  } else {
    objectWriteUInt32(this, value, offset, false)
  }
  return offset + 4
}

function checkIEEE754 (buf, value, offset, ext, max, min) {
  if (offset + ext > buf.length) throw new RangeError('Index out of range')
  if (offset < 0) throw new RangeError('Index out of range')
}

function writeFloat (buf, value, offset, littleEndian, noAssert) {
  if (!noAssert) {
    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)
  }
  ieee754.write(buf, value, offset, littleEndian, 23, 4)
  return offset + 4
}

Buffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {
  return writeFloat(this, value, offset, true, noAssert)
}

Buffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {
  return writeFloat(this, value, offset, false, noAssert)
}

function writeDouble (buf, value, offset, littleEndian, noAssert) {
  if (!noAssert) {
    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)
  }
  ieee754.write(buf, value, offset, littleEndian, 52, 8)
  return offset + 8
}

Buffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {
  return writeDouble(this, value, offset, true, noAssert)
}

Buffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {
  return writeDouble(this, value, offset, false, noAssert)
}

// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)
Buffer.prototype.copy = function copy (target, targetStart, start, end) {
  if (!start) start = 0
  if (!end && end !== 0) end = this.length
  if (targetStart >= target.length) targetStart = target.length
  if (!targetStart) targetStart = 0
  if (end > 0 && end < start) end = start

  // Copy 0 bytes; we're done
  if (end === start) return 0
  if (target.length === 0 || this.length === 0) return 0

  // Fatal error conditions
  if (targetStart < 0) {
    throw new RangeError('targetStart out of bounds')
  }
  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')
  if (end < 0) throw new RangeError('sourceEnd out of bounds')

  // Are we oob?
  if (end > this.length) end = this.length
  if (target.length - targetStart < end - start) {
    end = target.length - targetStart + start
  }

  var len = end - start
  var i

  if (this === target && start < targetStart && targetStart < end) {
    // descending copy from end
    for (i = len - 1; i >= 0; --i) {
      target[i + targetStart] = this[i + start]
    }
  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {
    // ascending copy from start
    for (i = 0; i < len; ++i) {
      target[i + targetStart] = this[i + start]
    }
  } else {
    Uint8Array.prototype.set.call(
      target,
      this.subarray(start, start + len),
      targetStart
    )
  }

  return len
}

// Usage:
//    buffer.fill(number[, offset[, end]])
//    buffer.fill(buffer[, offset[, end]])
//    buffer.fill(string[, offset[, end]][, encoding])
Buffer.prototype.fill = function fill (val, start, end, encoding) {
  // Handle string cases:
  if (typeof val === 'string') {
    if (typeof start === 'string') {
      encoding = start
      start = 0
      end = this.length
    } else if (typeof end === 'string') {
      encoding = end
      end = this.length
    }
    if (val.length === 1) {
      var code = val.charCodeAt(0)
      if (code < 256) {
        val = code
      }
    }
    if (encoding !== undefined && typeof encoding !== 'string') {
      throw new TypeError('encoding must be a string')
    }
    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {
      throw new TypeError('Unknown encoding: ' + encoding)
    }
  } else if (typeof val === 'number') {
    val = val & 255
  }

  // Invalid ranges are not set to a default, so can range check early.
  if (start < 0 || this.length < start || this.length < end) {
    throw new RangeError('Out of range index')
  }

  if (end <= start) {
    return this
  }

  start = start >>> 0
  end = end === undefined ? this.length : end >>> 0

  if (!val) val = 0

  var i
  if (typeof val === 'number') {
    for (i = start; i < end; ++i) {
      this[i] = val
    }
  } else {
    var bytes = Buffer.isBuffer(val)
      ? val
      : utf8ToBytes(new Buffer(val, encoding).toString())
    var len = bytes.length
    for (i = 0; i < end - start; ++i) {
      this[i + start] = bytes[i % len]
    }
  }

  return this
}

// HELPER FUNCTIONS
// ================

var INVALID_BASE64_RE = /[^+\/0-9A-Za-z-_]/g

function base64clean (str) {
  // Node strips out invalid characters like \n and \t from the string, base64-js does not
  str = stringtrim(str).replace(INVALID_BASE64_RE, '')
  // Node converts strings with length < 2 to ''
  if (str.length < 2) return ''
  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not
  while (str.length % 4 !== 0) {
    str = str + '='
  }
  return str
}

function stringtrim (str) {
  if (str.trim) return str.trim()
  return str.replace(/^\s+|\s+$/g, '')
}

function toHex (n) {
  if (n < 16) return '0' + n.toString(16)
  return n.toString(16)
}

function utf8ToBytes (string, units) {
  units = units || Infinity
  var codePoint
  var length = string.length
  var leadSurrogate = null
  var bytes = []

  for (var i = 0; i < length; ++i) {
    codePoint = string.charCodeAt(i)

    // is surrogate component
    if (codePoint > 0xD7FF && codePoint < 0xE000) {
      // last char was a lead
      if (!leadSurrogate) {
        // no lead yet
        if (codePoint > 0xDBFF) {
          // unexpected trail
          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
          continue
        } else if (i + 1 === length) {
          // unpaired lead
          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
          continue
        }

        // valid lead
        leadSurrogate = codePoint

        continue
      }

      // 2 leads in a row
      if (codePoint < 0xDC00) {
        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
        leadSurrogate = codePoint
        continue
      }

      // valid surrogate pair
      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000
    } else if (leadSurrogate) {
      // valid bmp char, but last char was a lead
      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
    }

    leadSurrogate = null

    // encode utf8
    if (codePoint < 0x80) {
      if ((units -= 1) < 0) break
      bytes.push(codePoint)
    } else if (codePoint < 0x800) {
      if ((units -= 2) < 0) break
      bytes.push(
        codePoint >> 0x6 | 0xC0,
        codePoint & 0x3F | 0x80
      )
    } else if (codePoint < 0x10000) {
      if ((units -= 3) < 0) break
      bytes.push(
        codePoint >> 0xC | 0xE0,
        codePoint >> 0x6 & 0x3F | 0x80,
        codePoint & 0x3F | 0x80
      )
    } else if (codePoint < 0x110000) {
      if ((units -= 4) < 0) break
      bytes.push(
        codePoint >> 0x12 | 0xF0,
        codePoint >> 0xC & 0x3F | 0x80,
        codePoint >> 0x6 & 0x3F | 0x80,
        codePoint & 0x3F | 0x80
      )
    } else {
      throw new Error('Invalid code point')
    }
  }

  return bytes
}

function asciiToBytes (str) {
  var byteArray = []
  for (var i = 0; i < str.length; ++i) {
    // Node's code seems to be doing this and not & 0x7F..
    byteArray.push(str.charCodeAt(i) & 0xFF)
  }
  return byteArray
}

function utf16leToBytes (str, units) {
  var c, hi, lo
  var byteArray = []
  for (var i = 0; i < str.length; ++i) {
    if ((units -= 2) < 0) break

    c = str.charCodeAt(i)
    hi = c >> 8
    lo = c % 256
    byteArray.push(lo)
    byteArray.push(hi)
  }

  return byteArray
}

function base64ToBytes (str) {
  return base64.toByteArray(base64clean(str))
}

function blitBuffer (src, dst, offset, length) {
  for (var i = 0; i < length; ++i) {
    if ((i + offset >= dst.length) || (i >= src.length)) break
    dst[i + offset] = src[i]
  }
  return i
}

function isnan (val) {
  return val !== val // eslint-disable-line no-self-compare
}


/***/ }),

/***/ 2294:
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Z": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(3645);
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__);
// Imports

var ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default()(function(i){return i[1]});
// Module
___CSS_LOADER_EXPORT___.push([module.id, "\n* {\n    font-family: 'Montserrat', sans-serif;\n}\n\nhtml {\n    overflow: scroll;\n    overflow-x: hidden;\n    overflow-y: hidden;\n\n    }\n    ::-webkit-scrollbar {\n        width: 0px; \n        height: 0px; \n    }\n\nbody {\n    margin: 0;\n}\n\ndiv {\n    box-sizing: border-box; \n}\n\na {\n    color: rgb(155, 155, 155);\n    text-decoration: none;\n    transition: color 0.5s;\n}\n\na:hover{\n    color: rgb(200, 200, 200)\n}\n\n/* Selector */\nselect {\n    padding: 5px;\n    border: 1px solid darkgray;\n    border-radius: 5px;\n    background: black;\n    color: white;\n    font-size: 64%;\n    /* margin: 0px 10px; */\n    min-width: 100px;\n}\n\n\n/* Intro UI */\n.brainsatplay-default-menu {\n    color: white;\n}\n\n.brainsatplay-default-container {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    position: absolute;\n    top: 0;\n    left: 0;\n    box-sizing: border-box;\n    text-align: left;\n    height: 100%;\n    width: 100%;\n    padding: 5%;\n    color: white;\n    background: black;\n    z-index: 1;\n    /* line-height: 3em; */\n    transition: opacity 1.5s;\n}\n\n.brainsatplay-default-container div {\n    width: 100%;\n}\n\n.brainsatplay-default-container h1 {\n    font-size: 10vw;\n    margin: 0px;\n    text-transform: uppercase;\n    width: 100%;\n}\n\n.brainsatplay-default-container p {\n    font-size: 0.8em;\n    width: 100%;\n}\n\n.brainsatplay-intro-loadingbar {\n    position: absolute;\n    left: 0;\n    width: 100%;\n    height: 2px;\n    background: #ffffff;\n    margin-top: 50px;\n    z-index: 2;\n    transform: scaleX(0);\n    transform-origin: top left;\n    transition: transform 1.5s;\n    will-change: transform;\n}\n\n.brainsatplay-intro-loadingbar.ended\n{\n    transform-origin: 100% 0;\n    transition: transform 1.5s ease-in-out;\n}\n\n\n\n.brainsatplay-default-button {\n    box-sizing: border-box; \n    /* min-width: 50px; */\n    min-height: 50px;\n    flex-grow: 1;\n    width: 200px;\n    /* max-width: 48%; */\n    position: relative;\n    padding: 5px;\n    margin: 5px;\n    border-radius: 5px;\n    font-size: 80%;\n    background: black;\n    color: white;\n    border: 1px solid rgb(200, 200, 200);\n    text-align: left;\n    transition: 0.5s;\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    pointer-events: 'auto'\n}\n\n.brainsatplay-default-button:hover {\n    background-color: rgb(35,35,35);\n}\n\n\n\n/* Device Selector */\n\n.brainsatplay-header-grid{\n    display: flex;\n    align-items: center;\n    /* grid-template-columns: repeat(2,1fr); */\n} \n\n.brainsatplay-header-grid .brainsatplay-default-button{\n    max-width: 100px;\n    margin-left: 25px;\n    font-size: 80%;\n}\n\n.brainsatplay-device-gallery {\n    width: 100%;\n    display: flex;\n    flex-wrap: wrap;\n    /* border: 1px solid white; */\n} \n\n.brainsatplay-companyCard {\n    display: flex;\n    flex-wrap: wrap;\n    flex-grow: 1;\n    background: rgba(35,35,35,0.75);\n    padding: 25px;\n    margin: 10px;\n    border-radius: 5px;;\n    position: relative;\n}.devices {\n    width: 100%;\n    display: flex;\n}h3 {\n    margin: 10px;\n}\n\n.brainsatplay-deviceCard{\n    background:rgb(15,15,15);\n    padding: 10px;\n    margin: 10px;\n    flex-grow: 1;\n    border-radius: 5px;;\n    position: relative;\n}.variants {\n    width: 100%;\n    display: flex;\n}h4 {\n    margin: 10px;\n}\n\n.brainsatplay-variantButton{\n    /* width: 50px; */\n    flex-grow: 1;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: 0.5s;\n    border: 1px solid rgb(200, 200, 200);\n    border-radius: 5px;\n    font-size: 70%;\n    margin: 5px;\n    position: relative;\n}\n\n.brainsatplay-variantButton:hover {\n    background-color: rgb(35,35,35);\n}\n\n\n.indicator{\n    position: absolute;\n    width: 7px;\n    height: 7px;\n    background: transparent;\n    top: 10px;\n    right: 10px;\n    /* transform: translate(-50%,-50%)  */\n    border-radius: 50%;\n    border: 1px solid white;\n    /* opacity: 0.5; */\n}\n\n.indicator.on {\n    background: lime;\n    border: none;\n}\n\n /* Forms */\n\n\n/* Login */\n.brainsatplay-form input {\n    width: 100%; height: 100%; padding: 10px 0px; display: flex; align-items: center; justify-content:center; background:transparent; border: transparent; border-bottom: 1px solid whitesmoke; color: white;\n}:focus{\n    outline: none;\n}\n\n.brainsatplay-form-container button {\n    margin: 10px;\n    min-height: 0px;\n}\n\n.brainsatplay-form-container input::placeholder {\n    color: darkgray;\n}\n\n.brainsatplay-form-context {\n    flex-grow: 1;\n    max-width: 500px;\n}\n\n.brainsatplay-form-context form {\n    width: 100%;\n}\n\n.brainsatplay-login-container {\n    transition: 0.5s ease-in-out;\n    -o-transition: 0.5s ease-in-out;\n    -ms-transition: 0.5s ease-in-out;\n    -moz-transition: 0.5s ease-in-out;\n    -webkit-transition: 0.5s ease-in-out;\n}\n\n.brainsatplay-login{\n    /* linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)); */\n    /* width: 75%; */\n    /* font-size: 20px; */\n    text-align: center;\n    z-index:1;\n}\n\n.brainsatplay-login-element{\n    margin:20px;\n}\n\n.brainsatplay-login-button {\n    width: 100%;\n}\n\n.brainsatplay-signup-button {\n    width: 100%;\n}\n\n.brainsatplay-login-buttons{\n    display: flex;\n    flex-wrap: wrap;\n    justify-content:center;\n    align-items: center;\n}\n\n.brainsatplay-login-buttons button{\n    flex-grow: 1;\n    margin: 10px;\n}", ""]);
// Exports
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);


/***/ }),

/***/ 3645:
/***/ ((module) => {

"use strict";


/*
  MIT License http://www.opensource.org/licenses/mit-license.php
  Author Tobias Koppers @sokra
*/
// css base code, injected by the css-loader
// eslint-disable-next-line func-names
module.exports = function (cssWithMappingToString) {
  var list = []; // return the list of modules as css string

  list.toString = function toString() {
    return this.map(function (item) {
      var content = cssWithMappingToString(item);

      if (item[2]) {
        return "@media ".concat(item[2], " {").concat(content, "}");
      }

      return content;
    }).join("");
  }; // import a list of modules into the list
  // eslint-disable-next-line func-names


  list.i = function (modules, mediaQuery, dedupe) {
    if (typeof modules === "string") {
      // eslint-disable-next-line no-param-reassign
      modules = [[null, modules, ""]];
    }

    var alreadyImportedModules = {};

    if (dedupe) {
      for (var i = 0; i < this.length; i++) {
        // eslint-disable-next-line prefer-destructuring
        var id = this[i][0];

        if (id != null) {
          alreadyImportedModules[id] = true;
        }
      }
    }

    for (var _i = 0; _i < modules.length; _i++) {
      var item = [].concat(modules[_i]);

      if (dedupe && alreadyImportedModules[item[0]]) {
        // eslint-disable-next-line no-continue
        continue;
      }

      if (mediaQuery) {
        if (!item[2]) {
          item[2] = mediaQuery;
        } else {
          item[2] = "".concat(mediaQuery, " and ").concat(item[2]);
        }
      }

      list.push(item);
    }
  };

  return list;
};

/***/ }),

/***/ 284:
/***/ ((module) => {

var naiveFallback = function () {
	if (typeof self === "object" && self) return self;
	if (typeof window === "object" && window) return window;
	throw new Error("Unable to resolve global `this`");
};

module.exports = (function () {
	if (this) return this;

	// Unexpected strict mode (may happen if e.g. bundled into ESM module)

	// Fallback to standard globalThis if available
	if (typeof globalThis === "object" && globalThis) return globalThis;

	// Thanks @mathiasbynens -> https://mathiasbynens.be/notes/globalthis
	// In all ES5+ engines global object inherits from Object.prototype
	// (if you approached one that doesn't please report)
	try {
		Object.defineProperty(Object.prototype, "__global__", {
			get: function () { return this; },
			configurable: true
		});
	} catch (error) {
		// Unfortunate case of updates to Object.prototype being restricted
		// via preventExtensions, seal or freeze
		return naiveFallback();
	}
	try {
		// Safari case (window.__global__ works, but __global__ does not)
		if (!__global__) return naiveFallback();
		return __global__;
	} finally {
		delete Object.prototype.__global__;
	}
})();


/***/ }),

/***/ 7187:
/***/ ((module) => {

"use strict";
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.



var R = typeof Reflect === 'object' ? Reflect : null
var ReflectApply = R && typeof R.apply === 'function'
  ? R.apply
  : function ReflectApply(target, receiver, args) {
    return Function.prototype.apply.call(target, receiver, args);
  }

var ReflectOwnKeys
if (R && typeof R.ownKeys === 'function') {
  ReflectOwnKeys = R.ownKeys
} else if (Object.getOwnPropertySymbols) {
  ReflectOwnKeys = function ReflectOwnKeys(target) {
    return Object.getOwnPropertyNames(target)
      .concat(Object.getOwnPropertySymbols(target));
  };
} else {
  ReflectOwnKeys = function ReflectOwnKeys(target) {
    return Object.getOwnPropertyNames(target);
  };
}

function ProcessEmitWarning(warning) {
  if (console && console.warn) console.warn(warning);
}

var NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {
  return value !== value;
}

function EventEmitter() {
  EventEmitter.init.call(this);
}
module.exports = EventEmitter;
module.exports.once = once;

// Backwards-compat with node 0.10.x
EventEmitter.EventEmitter = EventEmitter;

EventEmitter.prototype._events = undefined;
EventEmitter.prototype._eventsCount = 0;
EventEmitter.prototype._maxListeners = undefined;

// By default EventEmitters will print a warning if more than 10 listeners are
// added to it. This is a useful default which helps finding memory leaks.
var defaultMaxListeners = 10;

function checkListener(listener) {
  if (typeof listener !== 'function') {
    throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof listener);
  }
}

Object.defineProperty(EventEmitter, 'defaultMaxListeners', {
  enumerable: true,
  get: function() {
    return defaultMaxListeners;
  },
  set: function(arg) {
    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {
      throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received ' + arg + '.');
    }
    defaultMaxListeners = arg;
  }
});

EventEmitter.init = function() {

  if (this._events === undefined ||
      this._events === Object.getPrototypeOf(this)._events) {
    this._events = Object.create(null);
    this._eventsCount = 0;
  }

  this._maxListeners = this._maxListeners || undefined;
};

// Obviously not all Emitters should be limited to 10. This function allows
// that to be increased. Set to zero for unlimited.
EventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {
  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {
    throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received ' + n + '.');
  }
  this._maxListeners = n;
  return this;
};

function _getMaxListeners(that) {
  if (that._maxListeners === undefined)
    return EventEmitter.defaultMaxListeners;
  return that._maxListeners;
}

EventEmitter.prototype.getMaxListeners = function getMaxListeners() {
  return _getMaxListeners(this);
};

EventEmitter.prototype.emit = function emit(type) {
  var args = [];
  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);
  var doError = (type === 'error');

  var events = this._events;
  if (events !== undefined)
    doError = (doError && events.error === undefined);
  else if (!doError)
    return false;

  // If there is no 'error' event listener then throw.
  if (doError) {
    var er;
    if (args.length > 0)
      er = args[0];
    if (er instanceof Error) {
      // Note: The comments on the `throw` lines are intentional, they show
      // up in Node's output if this results in an unhandled exception.
      throw er; // Unhandled 'error' event
    }
    // At least give some kind of context to the user
    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));
    err.context = er;
    throw err; // Unhandled 'error' event
  }

  var handler = events[type];

  if (handler === undefined)
    return false;

  if (typeof handler === 'function') {
    ReflectApply(handler, this, args);
  } else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      ReflectApply(listeners[i], this, args);
  }

  return true;
};

function _addListener(target, type, listener, prepend) {
  var m;
  var events;
  var existing;

  checkListener(listener);

  events = target._events;
  if (events === undefined) {
    events = target._events = Object.create(null);
    target._eventsCount = 0;
  } else {
    // To avoid recursion in the case that type === "newListener"! Before
    // adding it to the listeners, first emit "newListener".
    if (events.newListener !== undefined) {
      target.emit('newListener', type,
                  listener.listener ? listener.listener : listener);

      // Re-assign `events` because a newListener handler could have caused the
      // this._events to be assigned to a new object
      events = target._events;
    }
    existing = events[type];
  }

  if (existing === undefined) {
    // Optimize the case of one listener. Don't need the extra array object.
    existing = events[type] = listener;
    ++target._eventsCount;
  } else {
    if (typeof existing === 'function') {
      // Adding the second element, need to change to array.
      existing = events[type] =
        prepend ? [listener, existing] : [existing, listener];
      // If we've already got an array, just append.
    } else if (prepend) {
      existing.unshift(listener);
    } else {
      existing.push(listener);
    }

    // Check for listener leak
    m = _getMaxListeners(target);
    if (m > 0 && existing.length > m && !existing.warned) {
      existing.warned = true;
      // No error code for this since it is a Warning
      // eslint-disable-next-line no-restricted-syntax
      var w = new Error('Possible EventEmitter memory leak detected. ' +
                          existing.length + ' ' + String(type) + ' listeners ' +
                          'added. Use emitter.setMaxListeners() to ' +
                          'increase limit');
      w.name = 'MaxListenersExceededWarning';
      w.emitter = target;
      w.type = type;
      w.count = existing.length;
      ProcessEmitWarning(w);
    }
  }

  return target;
}

EventEmitter.prototype.addListener = function addListener(type, listener) {
  return _addListener(this, type, listener, false);
};

EventEmitter.prototype.on = EventEmitter.prototype.addListener;

EventEmitter.prototype.prependListener =
    function prependListener(type, listener) {
      return _addListener(this, type, listener, true);
    };

function onceWrapper() {
  if (!this.fired) {
    this.target.removeListener(this.type, this.wrapFn);
    this.fired = true;
    if (arguments.length === 0)
      return this.listener.call(this.target);
    return this.listener.apply(this.target, arguments);
  }
}

function _onceWrap(target, type, listener) {
  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };
  var wrapped = onceWrapper.bind(state);
  wrapped.listener = listener;
  state.wrapFn = wrapped;
  return wrapped;
}

EventEmitter.prototype.once = function once(type, listener) {
  checkListener(listener);
  this.on(type, _onceWrap(this, type, listener));
  return this;
};

EventEmitter.prototype.prependOnceListener =
    function prependOnceListener(type, listener) {
      checkListener(listener);
      this.prependListener(type, _onceWrap(this, type, listener));
      return this;
    };

// Emits a 'removeListener' event if and only if the listener was removed.
EventEmitter.prototype.removeListener =
    function removeListener(type, listener) {
      var list, events, position, i, originalListener;

      checkListener(listener);

      events = this._events;
      if (events === undefined)
        return this;

      list = events[type];
      if (list === undefined)
        return this;

      if (list === listener || list.listener === listener) {
        if (--this._eventsCount === 0)
          this._events = Object.create(null);
        else {
          delete events[type];
          if (events.removeListener)
            this.emit('removeListener', type, list.listener || listener);
        }
      } else if (typeof list !== 'function') {
        position = -1;

        for (i = list.length - 1; i >= 0; i--) {
          if (list[i] === listener || list[i].listener === listener) {
            originalListener = list[i].listener;
            position = i;
            break;
          }
        }

        if (position < 0)
          return this;

        if (position === 0)
          list.shift();
        else {
          spliceOne(list, position);
        }

        if (list.length === 1)
          events[type] = list[0];

        if (events.removeListener !== undefined)
          this.emit('removeListener', type, originalListener || listener);
      }

      return this;
    };

EventEmitter.prototype.off = EventEmitter.prototype.removeListener;

EventEmitter.prototype.removeAllListeners =
    function removeAllListeners(type) {
      var listeners, events, i;

      events = this._events;
      if (events === undefined)
        return this;

      // not listening for removeListener, no need to emit
      if (events.removeListener === undefined) {
        if (arguments.length === 0) {
          this._events = Object.create(null);
          this._eventsCount = 0;
        } else if (events[type] !== undefined) {
          if (--this._eventsCount === 0)
            this._events = Object.create(null);
          else
            delete events[type];
        }
        return this;
      }

      // emit removeListener for all listeners on all events
      if (arguments.length === 0) {
        var keys = Object.keys(events);
        var key;
        for (i = 0; i < keys.length; ++i) {
          key = keys[i];
          if (key === 'removeListener') continue;
          this.removeAllListeners(key);
        }
        this.removeAllListeners('removeListener');
        this._events = Object.create(null);
        this._eventsCount = 0;
        return this;
      }

      listeners = events[type];

      if (typeof listeners === 'function') {
        this.removeListener(type, listeners);
      } else if (listeners !== undefined) {
        // LIFO order
        for (i = listeners.length - 1; i >= 0; i--) {
          this.removeListener(type, listeners[i]);
        }
      }

      return this;
    };

function _listeners(target, type, unwrap) {
  var events = target._events;

  if (events === undefined)
    return [];

  var evlistener = events[type];
  if (evlistener === undefined)
    return [];

  if (typeof evlistener === 'function')
    return unwrap ? [evlistener.listener || evlistener] : [evlistener];

  return unwrap ?
    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);
}

EventEmitter.prototype.listeners = function listeners(type) {
  return _listeners(this, type, true);
};

EventEmitter.prototype.rawListeners = function rawListeners(type) {
  return _listeners(this, type, false);
};

EventEmitter.listenerCount = function(emitter, type) {
  if (typeof emitter.listenerCount === 'function') {
    return emitter.listenerCount(type);
  } else {
    return listenerCount.call(emitter, type);
  }
};

EventEmitter.prototype.listenerCount = listenerCount;
function listenerCount(type) {
  var events = this._events;

  if (events !== undefined) {
    var evlistener = events[type];

    if (typeof evlistener === 'function') {
      return 1;
    } else if (evlistener !== undefined) {
      return evlistener.length;
    }
  }

  return 0;
}

EventEmitter.prototype.eventNames = function eventNames() {
  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];
};

function arrayClone(arr, n) {
  var copy = new Array(n);
  for (var i = 0; i < n; ++i)
    copy[i] = arr[i];
  return copy;
}

function spliceOne(list, index) {
  for (; index + 1 < list.length; index++)
    list[index] = list[index + 1];
  list.pop();
}

function unwrapListeners(arr) {
  var ret = new Array(arr.length);
  for (var i = 0; i < ret.length; ++i) {
    ret[i] = arr[i].listener || arr[i];
  }
  return ret;
}

function once(emitter, name) {
  return new Promise(function (resolve, reject) {
    function eventListener() {
      if (errorListener !== undefined) {
        emitter.removeListener('error', errorListener);
      }
      resolve([].slice.call(arguments));
    };
    var errorListener;

    // Adding an error listener is not optional because
    // if an error is thrown on an event emitter we cannot
    // guarantee that the actual event we are waiting will
    // be fired. The result could be a silent way to create
    // memory or file descriptor leaks, which is something
    // we should avoid.
    if (name !== 'error') {
      errorListener = function errorListener(err) {
        emitter.removeListener(name, eventListener);
        reject(err);
      };

      emitter.once('error', errorListener);
    }

    emitter.once(name, eventListener);
  });
}


/***/ }),

/***/ 6123:
/***/ ((module) => {

/** 
 * Box-Muller implementation
 * https://en.wikipedia.org/wiki/Box%E2%80%93Muller_transform
 */

(function(exports){
  const PRECISION = 1e9;
  const _2PI = Math.PI * 2;
  function generateGaussian(mean,std){
    var u1 = Math.random();
    var u2 = Math.random();
    
    var z0 = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(_2PI * u2);
    var z1 = Math.sqrt(-2.0 * Math.log(u1)) * Math.sin(_2PI * u2);

    return z0 * std + mean;
  }

  exports(generateGaussian)
})
( true
    ? function(e) { module.exports = e; }
    : 0);
  


/***/ }),

/***/ 1481:
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

(function(exports) {

  const generateGaussian = __webpack_require__(6123);

  // Complementary error function
  // From Numerical Recipes in C 2e p221
  var erfc = function(x) {
    var z = Math.abs(x);
    var t = 1 / (1 + z / 2);
    var r = t * Math.exp(-z * z - 1.26551223 + t * (1.00002368 +
            t * (0.37409196 + t * (0.09678418 + t * (-0.18628806 +
            t * (0.27886807 + t * (-1.13520398 + t * (1.48851587 +
            t * (-0.82215223 + t * 0.17087277)))))))))
    return x >= 0 ? r : 2 - r;
  };

  // Inverse complementary error function
  // From Numerical Recipes 3e p265
  var ierfc = function(x) {
    if (x >= 2) { return -100; }
    if (x <= 0) { return 100; }

    var xx = (x < 1) ? x : 2 - x;
    var t = Math.sqrt(-2 * Math.log(xx / 2));

    var r = -0.70711 * ((2.30753 + t * 0.27061) /
            (1 + t * (0.99229 + t * 0.04481)) - t);

    for (var j = 0; j < 2; j++) {
      var err = erfc(r) - xx;
      r += err / (1.12837916709551257 * Math.exp(-(r * r)) - r * err);
    }

    return (x < 1) ? r : -r;
  };

  // Models the normal distribution
  var Gaussian = function(mean, variance) {
    if (variance <= 0) {
      throw new Error('Variance must be > 0 (but was ' + variance + ')');
    }
    this.mean = mean;
    this.variance = variance;
    this.standardDeviation = Math.sqrt(variance);
  }

  // Probability density function
  Gaussian.prototype.pdf = function(x) {
    var m = this.standardDeviation * Math.sqrt(2 * Math.PI);
    var e = Math.exp(-Math.pow(x - this.mean, 2) / (2 * this.variance));
    return e / m;
  };

  // Cumulative density function
  Gaussian.prototype.cdf = function(x) {
    return 0.5 * erfc(-(x - this.mean) / (this.standardDeviation * Math.sqrt(2)));
  };

  // Percent point function
  Gaussian.prototype.ppf = function(x) {
    return this.mean - this.standardDeviation * Math.sqrt(2) * ierfc(2 * x);
  };

  // Product distribution of this and d (scale for constant)
  Gaussian.prototype.mul = function(d) {
    if (typeof(d) === "number") {
      return this.scale(d);
    }
    var precision = 1 / this.variance;
    var dprecision = 1 / d.variance;
    return fromPrecisionMean(
        precision + dprecision, 
        precision * this.mean + dprecision * d.mean);
  };

  // Quotient distribution of this and d (scale for constant)
  Gaussian.prototype.div = function(d) {
    if (typeof(d) === "number") {
      return this.scale(1 / d);
    }
    var precision = 1 / this.variance;
    var dprecision = 1 / d.variance;
    return fromPrecisionMean(
        precision - dprecision, 
        precision * this.mean - dprecision * d.mean);
  };

  // Addition of this and d
  Gaussian.prototype.add = function(d) {
    return gaussian(this.mean + d.mean, this.variance + d.variance);
  };

  // Subtraction of this and d
  Gaussian.prototype.sub = function(d) {
    return gaussian(this.mean - d.mean, this.variance + d.variance);
  };

  // Scale this by constant c
  Gaussian.prototype.scale = function(c) {
    return gaussian(this.mean * c, this.variance * c * c);
  };

  // Generate [num] random samples
  Gaussian.prototype.random = function(num){
    let mean = this.mean;
    let std = this.standardDeviation;
    return Array(num).fill(0).map(() => {
      return generateGaussian(mean,std)
    })
  };

  var gaussian = function(mean, variance) {
    return new Gaussian(mean, variance);
  };

  var fromPrecisionMean = function(precision, precisionmean) {
    return gaussian(precisionmean / precision, 1 / precision);
  };

  exports(gaussian);
})
( true
    ? function(e) { module.exports = e; }
    : 0);


/***/ }),

/***/ 645:
/***/ ((__unused_webpack_module, exports) => {

exports.read = function (buffer, offset, isLE, mLen, nBytes) {
  var e, m
  var eLen = (nBytes * 8) - mLen - 1
  var eMax = (1 << eLen) - 1
  var eBias = eMax >> 1
  var nBits = -7
  var i = isLE ? (nBytes - 1) : 0
  var d = isLE ? -1 : 1
  var s = buffer[offset + i]

  i += d

  e = s & ((1 << (-nBits)) - 1)
  s >>= (-nBits)
  nBits += eLen
  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}

  m = e & ((1 << (-nBits)) - 1)
  e >>= (-nBits)
  nBits += mLen
  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}

  if (e === 0) {
    e = 1 - eBias
  } else if (e === eMax) {
    return m ? NaN : ((s ? -1 : 1) * Infinity)
  } else {
    m = m + Math.pow(2, mLen)
    e = e - eBias
  }
  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)
}

exports.write = function (buffer, value, offset, isLE, mLen, nBytes) {
  var e, m, c
  var eLen = (nBytes * 8) - mLen - 1
  var eMax = (1 << eLen) - 1
  var eBias = eMax >> 1
  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)
  var i = isLE ? 0 : (nBytes - 1)
  var d = isLE ? 1 : -1
  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0

  value = Math.abs(value)

  if (isNaN(value) || value === Infinity) {
    m = isNaN(value) ? 1 : 0
    e = eMax
  } else {
    e = Math.floor(Math.log(value) / Math.LN2)
    if (value * (c = Math.pow(2, -e)) < 1) {
      e--
      c *= 2
    }
    if (e + eBias >= 1) {
      value += rt / c
    } else {
      value += rt * Math.pow(2, 1 - eBias)
    }
    if (value * c >= 2) {
      e++
      c /= 2
    }

    if (e + eBias >= eMax) {
      m = 0
      e = eMax
    } else if (e + eBias >= 1) {
      m = ((value * c) - 1) * Math.pow(2, mLen)
      e = e + eBias
    } else {
      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)
      e = 0
    }
  }

  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}

  e = (e << mLen) | m
  eLen += mLen
  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}

  buffer[offset + i - d] |= s * 128
}


/***/ }),

/***/ 5826:
/***/ ((module) => {

var toString = {}.toString;

module.exports = Array.isArray || function (arr) {
  return toString.call(arr) == '[object Array]';
};


/***/ }),

/***/ 4139:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

Object.defineProperty(exports, "__esModule", ({ value: true }));
var operators_1 = __webpack_require__(1717);
function parseControl(controlData) {
    return controlData.pipe(operators_1.concatMap(function (data) { return data.split(''); }), operators_1.scan(function (acc, value) {
        if (acc.indexOf('}') >= 0) {
            return value;
        }
        else {
            return acc + value;
        }
    }, ''), operators_1.filter(function (value) { return value.indexOf('}') >= 0; }), operators_1.map(function (value) { return JSON.parse(value); }));
}
exports.parseControl = parseControl;
function decodeUnsigned12BitData(samples) {
    var samples12Bit = [];
    // tslint:disable:no-bitwise
    for (var i = 0; i < samples.length; i++) {
        if (i % 3 === 0) {
            samples12Bit.push(samples[i] << 4 | samples[i + 1] >> 4);
        }
        else {
            samples12Bit.push((samples[i] & 0xf) << 8 | samples[i + 1]);
            i++;
        }
    }
    // tslint:enable:no-bitwise
    return samples12Bit;
}
exports.decodeUnsigned12BitData = decodeUnsigned12BitData;
function decodeEEGSamples(samples) {
    return decodeUnsigned12BitData(samples)
        .map(function (n) { return 0.48828125 * (n - 0x800); });
}
exports.decodeEEGSamples = decodeEEGSamples;
function parseTelemetry(data) {
    // tslint:disable:object-literal-sort-keys
    return {
        sequenceId: data.getUint16(0),
        batteryLevel: data.getUint16(2) / 512.,
        fuelGaugeVoltage: data.getUint16(4) * 2.2,
        // Next 2 bytes are probably ADC millivolt level, not sure
        temperature: data.getUint16(8),
    };
    // tslint:enable:object-literal-sort-keys
}
exports.parseTelemetry = parseTelemetry;
function parseImuReading(data, scale) {
    function sample(startIndex) {
        return {
            x: scale * data.getInt16(startIndex),
            y: scale * data.getInt16(startIndex + 2),
            z: scale * data.getInt16(startIndex + 4),
        };
    }
    // tslint:disable:object-literal-sort-keys
    return {
        sequenceId: data.getUint16(0),
        samples: [sample(2), sample(8), sample(14)],
    };
    // tslint:enable:object-literal-sort-keys
}
function parseAccelerometer(data) {
    return parseImuReading(data, 0.0000610352);
}
exports.parseAccelerometer = parseAccelerometer;
function parseGyroscope(data) {
    return parseImuReading(data, 0.0074768);
}
exports.parseGyroscope = parseGyroscope;
//# sourceMappingURL=muse-parse.js.map

/***/ }),

/***/ 7338:
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

"use strict";

var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var rxjs_1 = __webpack_require__(4143);
var operators_1 = __webpack_require__(1717);
function decodeResponse(bytes) {
    return new TextDecoder().decode(bytes.subarray(1, 1 + bytes[0]));
}
exports.decodeResponse = decodeResponse;
function encodeCommand(cmd) {
    var encoded = new TextEncoder().encode("X" + cmd + "\n");
    encoded[0] = encoded.length - 1;
    return encoded;
}
exports.encodeCommand = encodeCommand;
function observableCharacteristic(characteristic) {
    return __awaiter(this, void 0, void 0, function () {
        var disconnected;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, characteristic.startNotifications()];
                case 1:
                    _a.sent();
                    disconnected = rxjs_1.fromEvent(characteristic.service.device, 'gattserverdisconnected');
                    return [2 /*return*/, rxjs_1.fromEvent(characteristic, 'characteristicvaluechanged').pipe(operators_1.takeUntil(disconnected), operators_1.map(function (event) { return event.target.value; }))];
            }
        });
    });
}
exports.observableCharacteristic = observableCharacteristic;
//# sourceMappingURL=muse-utils.js.map

/***/ }),

/***/ 1335:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

Object.defineProperty(exports, "__esModule", ({ value: true }));
var rxjs_1 = __webpack_require__(4143);
var operators_1 = __webpack_require__(1717);
var muse_1 = __webpack_require__(2306);
function zipSamples(eegReadings) {
    var buffer = [];
    var lastTimestamp = null;
    return eegReadings.pipe(operators_1.mergeMap(function (reading) {
        if (reading.timestamp !== lastTimestamp) {
            lastTimestamp = reading.timestamp;
            if (buffer.length) {
                var result = rxjs_1.from([buffer.slice()]);
                buffer.splice(0, buffer.length, reading);
                return result;
            }
        }
        buffer.push(reading);
        return rxjs_1.from([]);
    }), operators_1.concat(rxjs_1.from([buffer])), operators_1.mergeMap(function (readings) {
        var result = readings[0].samples.map(function (x, index) {
            var data = [NaN, NaN, NaN, NaN, NaN];
            for (var _i = 0, readings_1 = readings; _i < readings_1.length; _i++) {
                var reading = readings_1[_i];
                data[reading.electrode] = reading.samples[index];
            }
            return {
                data: data,
                index: readings[0].index,
                timestamp: readings[0].timestamp + (index * 1000) / muse_1.EEG_FREQUENCY,
            };
        });
        return rxjs_1.from(result);
    }));
}
exports.zipSamples = zipSamples;
//# sourceMappingURL=zip-samples.js.map

/***/ }),

/***/ 2306:
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

"use strict";

var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var rxjs_1 = __webpack_require__(4143);
var operators_1 = __webpack_require__(1717);
var muse_parse_1 = __webpack_require__(4139);
var muse_utils_1 = __webpack_require__(7338);
var zip_samples_1 = __webpack_require__(1335);
exports.zipSamples = zip_samples_1.zipSamples;
exports.MUSE_SERVICE = 0xfe8d;
var CONTROL_CHARACTERISTIC = '273e0001-4c4d-454d-96be-f03bac821358';
var TELEMETRY_CHARACTERISTIC = '273e000b-4c4d-454d-96be-f03bac821358';
var GYROSCOPE_CHARACTERISTIC = '273e0009-4c4d-454d-96be-f03bac821358';
var ACCELEROMETER_CHARACTERISTIC = '273e000a-4c4d-454d-96be-f03bac821358';
var EEG_CHARACTERISTICS = [
    '273e0003-4c4d-454d-96be-f03bac821358',
    '273e0004-4c4d-454d-96be-f03bac821358',
    '273e0005-4c4d-454d-96be-f03bac821358',
    '273e0006-4c4d-454d-96be-f03bac821358',
    '273e0007-4c4d-454d-96be-f03bac821358',
];
exports.EEG_FREQUENCY = 256;
// These names match the characteristics defined in EEG_CHARACTERISTICS above
exports.channelNames = ['TP9', 'AF7', 'AF8', 'TP10', 'AUX'];
var MuseClient = /** @class */ (function () {
    function MuseClient() {
        this.enableAux = false;
        this.deviceName = '';
        this.connectionStatus = new rxjs_1.BehaviorSubject(false);
        this.gatt = null;
        this.lastIndex = null;
        this.lastTimestamp = null;
    }
    MuseClient.prototype.connect = function (gatt) {
        return __awaiter(this, void 0, void 0, function () {
            var device, _a, service, _b, _c, telemetryCharacteristic, _d, gyroscopeCharacteristic, _e, accelerometerCharacteristic, _f, eegObservables, channelCount, _loop_1, this_1, channelIndex;
            var _this = this;
            return __generator(this, function (_g) {
                switch (_g.label) {
                    case 0:
                        if (!gatt) return [3 /*break*/, 1];
                        this.gatt = gatt;
                        return [3 /*break*/, 4];
                    case 1: return [4 /*yield*/, navigator.bluetooth.requestDevice({
                            filters: [{ services: [exports.MUSE_SERVICE] }],
                        })];
                    case 2:
                        device = _g.sent();
                        _a = this;
                        return [4 /*yield*/, device.gatt.connect()];
                    case 3:
                        _a.gatt = _g.sent();
                        _g.label = 4;
                    case 4:
                        this.deviceName = this.gatt.device.name || null;
                        return [4 /*yield*/, this.gatt.getPrimaryService(exports.MUSE_SERVICE)];
                    case 5:
                        service = _g.sent();
                        rxjs_1.fromEvent(this.gatt.device, 'gattserverdisconnected')
                            .pipe(operators_1.first())
                            .subscribe(function () {
                            _this.gatt = null;
                            _this.connectionStatus.next(false);
                        });
                        // Control
                        _b = this;
                        return [4 /*yield*/, service.getCharacteristic(CONTROL_CHARACTERISTIC)];
                    case 6:
                        // Control
                        _b.controlChar = _g.sent();
                        _c = this;
                        return [4 /*yield*/, muse_utils_1.observableCharacteristic(this.controlChar)];
                    case 7:
                        _c.rawControlData = (_g.sent()).pipe(operators_1.map(function (data) { return muse_utils_1.decodeResponse(new Uint8Array(data.buffer)); }), operators_1.share());
                        this.controlResponses = muse_parse_1.parseControl(this.rawControlData);
                        return [4 /*yield*/, service.getCharacteristic(TELEMETRY_CHARACTERISTIC)];
                    case 8:
                        telemetryCharacteristic = _g.sent();
                        _d = this;
                        return [4 /*yield*/, muse_utils_1.observableCharacteristic(telemetryCharacteristic)];
                    case 9:
                        _d.telemetryData = (_g.sent()).pipe(operators_1.map(muse_parse_1.parseTelemetry));
                        return [4 /*yield*/, service.getCharacteristic(GYROSCOPE_CHARACTERISTIC)];
                    case 10:
                        gyroscopeCharacteristic = _g.sent();
                        _e = this;
                        return [4 /*yield*/, muse_utils_1.observableCharacteristic(gyroscopeCharacteristic)];
                    case 11:
                        _e.gyroscopeData = (_g.sent()).pipe(operators_1.map(muse_parse_1.parseGyroscope));
                        return [4 /*yield*/, service.getCharacteristic(ACCELEROMETER_CHARACTERISTIC)];
                    case 12:
                        accelerometerCharacteristic = _g.sent();
                        _f = this;
                        return [4 /*yield*/, muse_utils_1.observableCharacteristic(accelerometerCharacteristic)];
                    case 13:
                        _f.accelerometerData = (_g.sent()).pipe(operators_1.map(muse_parse_1.parseAccelerometer));
                        this.eventMarkers = new rxjs_1.Subject();
                        // EEG
                        this.eegCharacteristics = [];
                        eegObservables = [];
                        channelCount = this.enableAux ? EEG_CHARACTERISTICS.length : 4;
                        _loop_1 = function (channelIndex) {
                            var characteristicId, eegChar, _a, _b;
                            return __generator(this, function (_c) {
                                switch (_c.label) {
                                    case 0:
                                        characteristicId = EEG_CHARACTERISTICS[channelIndex];
                                        return [4 /*yield*/, service.getCharacteristic(characteristicId)];
                                    case 1:
                                        eegChar = _c.sent();
                                        _b = (_a = eegObservables).push;
                                        return [4 /*yield*/, muse_utils_1.observableCharacteristic(eegChar)];
                                    case 2:
                                        _b.apply(_a, [(_c.sent()).pipe(operators_1.map(function (data) {
                                                var eventIndex = data.getUint16(0);
                                                return {
                                                    electrode: channelIndex,
                                                    index: eventIndex,
                                                    samples: muse_parse_1.decodeEEGSamples(new Uint8Array(data.buffer).subarray(2)),
                                                    timestamp: _this.getTimestamp(eventIndex),
                                                };
                                            }))]);
                                        this_1.eegCharacteristics.push(eegChar);
                                        return [2 /*return*/];
                                }
                            });
                        };
                        this_1 = this;
                        channelIndex = 0;
                        _g.label = 14;
                    case 14:
                        if (!(channelIndex < channelCount)) return [3 /*break*/, 17];
                        return [5 /*yield**/, _loop_1(channelIndex)];
                    case 15:
                        _g.sent();
                        _g.label = 16;
                    case 16:
                        channelIndex++;
                        return [3 /*break*/, 14];
                    case 17:
                        this.eegReadings = rxjs_1.merge.apply(void 0, eegObservables);
                        this.connectionStatus.next(true);
                        return [2 /*return*/];
                }
            });
        });
    };
    MuseClient.prototype.sendCommand = function (cmd) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.controlChar.writeValue(muse_utils_1.encodeCommand(cmd))];
                    case 1:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    MuseClient.prototype.start = function () {
        return __awaiter(this, void 0, void 0, function () {
            var preset;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.pause()];
                    case 1:
                        _a.sent();
                        preset = this.enableAux ? 'p20' : 'p21';
                        return [4 /*yield*/, this.controlChar.writeValue(muse_utils_1.encodeCommand(preset))];
                    case 2:
                        _a.sent();
                        return [4 /*yield*/, this.controlChar.writeValue(muse_utils_1.encodeCommand('s'))];
                    case 3:
                        _a.sent();
                        return [4 /*yield*/, this.resume()];
                    case 4:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    MuseClient.prototype.pause = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.sendCommand('h')];
                    case 1:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    MuseClient.prototype.resume = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.sendCommand('d')];
                    case 1:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    MuseClient.prototype.deviceInfo = function () {
        return __awaiter(this, void 0, void 0, function () {
            var resultListener;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        resultListener = this.controlResponses.pipe(operators_1.filter(function (r) { return !!r.fw; }), operators_1.take(1)).toPromise();
                        return [4 /*yield*/, this.sendCommand('v1')];
                    case 1:
                        _a.sent();
                        return [2 /*return*/, resultListener];
                }
            });
        });
    };
    MuseClient.prototype.injectMarker = function (value, timestamp) {
        if (timestamp === void 0) { timestamp = new Date().getTime(); }
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.eventMarkers.next({ value: value, timestamp: timestamp })];
                    case 1:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    MuseClient.prototype.disconnect = function () {
        if (this.gatt) {
            this.lastIndex = null;
            this.lastTimestamp = null;
            this.gatt.disconnect();
            this.connectionStatus.next(false);
        }
    };
    MuseClient.prototype.getTimestamp = function (eventIndex) {
        var SAMPLES_PER_READING = 12;
        var READING_DELTA = 1000 * (1.0 / exports.EEG_FREQUENCY) * SAMPLES_PER_READING;
        if (this.lastIndex === null || this.lastTimestamp === null) {
            this.lastIndex = eventIndex;
            this.lastTimestamp = new Date().getTime() - READING_DELTA;
        }
        // Handle wrap around
        while (this.lastIndex - eventIndex > 0x1000) {
            eventIndex += 0x10000;
        }
        if (eventIndex === this.lastIndex) {
            return this.lastTimestamp;
        }
        if (eventIndex > this.lastIndex) {
            this.lastTimestamp += READING_DELTA * (eventIndex - this.lastIndex);
            this.lastIndex = eventIndex;
            return this.lastTimestamp;
        }
        else {
            return this.lastTimestamp - READING_DELTA * (this.lastIndex - eventIndex);
        }
    };
    return MuseClient;
}());
exports.MuseClient = MuseClient;
//# sourceMappingURL=muse.js.map

/***/ }),

/***/ 4155:
/***/ ((module) => {

// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout () {
    throw new Error('clearTimeout has not been defined');
}
(function () {
    try {
        if (typeof setTimeout === 'function') {
            cachedSetTimeout = setTimeout;
        } else {
            cachedSetTimeout = defaultSetTimout;
        }
    } catch (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') {
            cachedClearTimeout = clearTimeout;
        } else {
            cachedClearTimeout = defaultClearTimeout;
        }
    } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
function runTimeout(fun) {
    if (cachedSetTimeout === setTimeout) {
        //normal enviroments in sane situations
        return setTimeout(fun, 0);
    }
    // if setTimeout wasn't available but was latter defined
    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedSetTimeout(fun, 0);
    } catch(e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return cachedSetTimeout.call(null, fun, 0);
        } catch(e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return cachedSetTimeout.call(this, fun, 0);
        }
    }


}
function runClearTimeout(marker) {
    if (cachedClearTimeout === clearTimeout) {
        //normal enviroments in sane situations
        return clearTimeout(marker);
    }
    // if clearTimeout wasn't available but was latter defined
    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedClearTimeout(marker);
    } catch (e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return cachedClearTimeout.call(null, marker);
        } catch (e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return cachedClearTimeout.call(this, marker);
        }
    }



}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = runTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    runClearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        runTimeout(drainQueue);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) { return [] }

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };


/***/ }),

/***/ 1407:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
/* eslint-disable no-proto */



var base64 = __webpack_require__(9742)
var ieee754 = __webpack_require__(645)
var customInspectSymbol =
  (typeof Symbol === 'function' && typeof Symbol['for'] === 'function') // eslint-disable-line dot-notation
    ? Symbol['for']('nodejs.util.inspect.custom') // eslint-disable-line dot-notation
    : null

exports.Buffer = Buffer
exports.SlowBuffer = SlowBuffer
exports.INSPECT_MAX_BYTES = 50

var K_MAX_LENGTH = 0x7fffffff
exports.kMaxLength = K_MAX_LENGTH

/**
 * If `Buffer.TYPED_ARRAY_SUPPORT`:
 *   === true    Use Uint8Array implementation (fastest)
 *   === false   Print warning and recommend using `buffer` v4.x which has an Object
 *               implementation (most compatible, even IE6)
 *
 * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,
 * Opera 11.6+, iOS 4.2+.
 *
 * We report that the browser does not support typed arrays if the are not subclassable
 * using __proto__. Firefox 4-29 lacks support for adding new properties to `Uint8Array`
 * (See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438). IE 10 lacks support
 * for __proto__ and has a buggy typed array implementation.
 */
Buffer.TYPED_ARRAY_SUPPORT = typedArraySupport()

if (!Buffer.TYPED_ARRAY_SUPPORT && typeof console !== 'undefined' &&
    typeof console.error === 'function') {
  console.error(
    'This browser lacks typed array (Uint8Array) support which is required by ' +
    '`buffer` v5.x. Use `buffer` v4.x if you require old browser support.'
  )
}

function typedArraySupport () {
  // Can typed array instances can be augmented?
  try {
    var arr = new Uint8Array(1)
    var proto = { foo: function () { return 42 } }
    Object.setPrototypeOf(proto, Uint8Array.prototype)
    Object.setPrototypeOf(arr, proto)
    return arr.foo() === 42
  } catch (e) {
    return false
  }
}

Object.defineProperty(Buffer.prototype, 'parent', {
  enumerable: true,
  get: function () {
    if (!Buffer.isBuffer(this)) return undefined
    return this.buffer
  }
})

Object.defineProperty(Buffer.prototype, 'offset', {
  enumerable: true,
  get: function () {
    if (!Buffer.isBuffer(this)) return undefined
    return this.byteOffset
  }
})

function createBuffer (length) {
  if (length > K_MAX_LENGTH) {
    throw new RangeError('The value "' + length + '" is invalid for option "size"')
  }
  // Return an augmented `Uint8Array` instance
  var buf = new Uint8Array(length)
  Object.setPrototypeOf(buf, Buffer.prototype)
  return buf
}

/**
 * The Buffer constructor returns instances of `Uint8Array` that have their
 * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of
 * `Uint8Array`, so the returned instances will have all the node `Buffer` methods
 * and the `Uint8Array` methods. Square bracket notation works as expected -- it
 * returns a single octet.
 *
 * The `Uint8Array` prototype remains unmodified.
 */

function Buffer (arg, encodingOrOffset, length) {
  // Common case.
  if (typeof arg === 'number') {
    if (typeof encodingOrOffset === 'string') {
      throw new TypeError(
        'The "string" argument must be of type string. Received type number'
      )
    }
    return allocUnsafe(arg)
  }
  return from(arg, encodingOrOffset, length)
}

Buffer.poolSize = 8192 // not used by this implementation

function from (value, encodingOrOffset, length) {
  if (typeof value === 'string') {
    return fromString(value, encodingOrOffset)
  }

  if (ArrayBuffer.isView(value)) {
    return fromArrayView(value)
  }

  if (value == null) {
    throw new TypeError(
      'The first argument must be one of type string, Buffer, ArrayBuffer, Array, ' +
      'or Array-like Object. Received type ' + (typeof value)
    )
  }

  if (isInstance(value, ArrayBuffer) ||
      (value && isInstance(value.buffer, ArrayBuffer))) {
    return fromArrayBuffer(value, encodingOrOffset, length)
  }

  if (typeof SharedArrayBuffer !== 'undefined' &&
      (isInstance(value, SharedArrayBuffer) ||
      (value && isInstance(value.buffer, SharedArrayBuffer)))) {
    return fromArrayBuffer(value, encodingOrOffset, length)
  }

  if (typeof value === 'number') {
    throw new TypeError(
      'The "value" argument must not be of type number. Received type number'
    )
  }

  var valueOf = value.valueOf && value.valueOf()
  if (valueOf != null && valueOf !== value) {
    return Buffer.from(valueOf, encodingOrOffset, length)
  }

  var b = fromObject(value)
  if (b) return b

  if (typeof Symbol !== 'undefined' && Symbol.toPrimitive != null &&
      typeof value[Symbol.toPrimitive] === 'function') {
    return Buffer.from(
      value[Symbol.toPrimitive]('string'), encodingOrOffset, length
    )
  }

  throw new TypeError(
    'The first argument must be one of type string, Buffer, ArrayBuffer, Array, ' +
    'or Array-like Object. Received type ' + (typeof value)
  )
}

/**
 * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError
 * if value is a number.
 * Buffer.from(str[, encoding])
 * Buffer.from(array)
 * Buffer.from(buffer)
 * Buffer.from(arrayBuffer[, byteOffset[, length]])
 **/
Buffer.from = function (value, encodingOrOffset, length) {
  return from(value, encodingOrOffset, length)
}

// Note: Change prototype *after* Buffer.from is defined to workaround Chrome bug:
// https://github.com/feross/buffer/pull/148
Object.setPrototypeOf(Buffer.prototype, Uint8Array.prototype)
Object.setPrototypeOf(Buffer, Uint8Array)

function assertSize (size) {
  if (typeof size !== 'number') {
    throw new TypeError('"size" argument must be of type number')
  } else if (size < 0) {
    throw new RangeError('The value "' + size + '" is invalid for option "size"')
  }
}

function alloc (size, fill, encoding) {
  assertSize(size)
  if (size <= 0) {
    return createBuffer(size)
  }
  if (fill !== undefined) {
    // Only pay attention to encoding if it's a string. This
    // prevents accidentally sending in a number that would
    // be interpreted as a start offset.
    return typeof encoding === 'string'
      ? createBuffer(size).fill(fill, encoding)
      : createBuffer(size).fill(fill)
  }
  return createBuffer(size)
}

/**
 * Creates a new filled Buffer instance.
 * alloc(size[, fill[, encoding]])
 **/
Buffer.alloc = function (size, fill, encoding) {
  return alloc(size, fill, encoding)
}

function allocUnsafe (size) {
  assertSize(size)
  return createBuffer(size < 0 ? 0 : checked(size) | 0)
}

/**
 * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.
 * */
Buffer.allocUnsafe = function (size) {
  return allocUnsafe(size)
}
/**
 * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.
 */
Buffer.allocUnsafeSlow = function (size) {
  return allocUnsafe(size)
}

function fromString (string, encoding) {
  if (typeof encoding !== 'string' || encoding === '') {
    encoding = 'utf8'
  }

  if (!Buffer.isEncoding(encoding)) {
    throw new TypeError('Unknown encoding: ' + encoding)
  }

  var length = byteLength(string, encoding) | 0
  var buf = createBuffer(length)

  var actual = buf.write(string, encoding)

  if (actual !== length) {
    // Writing a hex string, for example, that contains invalid characters will
    // cause everything after the first invalid character to be ignored. (e.g.
    // 'abxxcd' will be treated as 'ab')
    buf = buf.slice(0, actual)
  }

  return buf
}

function fromArrayLike (array) {
  var length = array.length < 0 ? 0 : checked(array.length) | 0
  var buf = createBuffer(length)
  for (var i = 0; i < length; i += 1) {
    buf[i] = array[i] & 255
  }
  return buf
}

function fromArrayView (arrayView) {
  if (isInstance(arrayView, Uint8Array)) {
    var copy = new Uint8Array(arrayView)
    return fromArrayBuffer(copy.buffer, copy.byteOffset, copy.byteLength)
  }
  return fromArrayLike(arrayView)
}

function fromArrayBuffer (array, byteOffset, length) {
  if (byteOffset < 0 || array.byteLength < byteOffset) {
    throw new RangeError('"offset" is outside of buffer bounds')
  }

  if (array.byteLength < byteOffset + (length || 0)) {
    throw new RangeError('"length" is outside of buffer bounds')
  }

  var buf
  if (byteOffset === undefined && length === undefined) {
    buf = new Uint8Array(array)
  } else if (length === undefined) {
    buf = new Uint8Array(array, byteOffset)
  } else {
    buf = new Uint8Array(array, byteOffset, length)
  }

  // Return an augmented `Uint8Array` instance
  Object.setPrototypeOf(buf, Buffer.prototype)

  return buf
}

function fromObject (obj) {
  if (Buffer.isBuffer(obj)) {
    var len = checked(obj.length) | 0
    var buf = createBuffer(len)

    if (buf.length === 0) {
      return buf
    }

    obj.copy(buf, 0, 0, len)
    return buf
  }

  if (obj.length !== undefined) {
    if (typeof obj.length !== 'number' || numberIsNaN(obj.length)) {
      return createBuffer(0)
    }
    return fromArrayLike(obj)
  }

  if (obj.type === 'Buffer' && Array.isArray(obj.data)) {
    return fromArrayLike(obj.data)
  }
}

function checked (length) {
  // Note: cannot use `length < K_MAX_LENGTH` here because that fails when
  // length is NaN (which is otherwise coerced to zero.)
  if (length >= K_MAX_LENGTH) {
    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +
                         'size: 0x' + K_MAX_LENGTH.toString(16) + ' bytes')
  }
  return length | 0
}

function SlowBuffer (length) {
  if (+length != length) { // eslint-disable-line eqeqeq
    length = 0
  }
  return Buffer.alloc(+length)
}

Buffer.isBuffer = function isBuffer (b) {
  return b != null && b._isBuffer === true &&
    b !== Buffer.prototype // so Buffer.isBuffer(Buffer.prototype) will be false
}

Buffer.compare = function compare (a, b) {
  if (isInstance(a, Uint8Array)) a = Buffer.from(a, a.offset, a.byteLength)
  if (isInstance(b, Uint8Array)) b = Buffer.from(b, b.offset, b.byteLength)
  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {
    throw new TypeError(
      'The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array'
    )
  }

  if (a === b) return 0

  var x = a.length
  var y = b.length

  for (var i = 0, len = Math.min(x, y); i < len; ++i) {
    if (a[i] !== b[i]) {
      x = a[i]
      y = b[i]
      break
    }
  }

  if (x < y) return -1
  if (y < x) return 1
  return 0
}

Buffer.isEncoding = function isEncoding (encoding) {
  switch (String(encoding).toLowerCase()) {
    case 'hex':
    case 'utf8':
    case 'utf-8':
    case 'ascii':
    case 'latin1':
    case 'binary':
    case 'base64':
    case 'ucs2':
    case 'ucs-2':
    case 'utf16le':
    case 'utf-16le':
      return true
    default:
      return false
  }
}

Buffer.concat = function concat (list, length) {
  if (!Array.isArray(list)) {
    throw new TypeError('"list" argument must be an Array of Buffers')
  }

  if (list.length === 0) {
    return Buffer.alloc(0)
  }

  var i
  if (length === undefined) {
    length = 0
    for (i = 0; i < list.length; ++i) {
      length += list[i].length
    }
  }

  var buffer = Buffer.allocUnsafe(length)
  var pos = 0
  for (i = 0; i < list.length; ++i) {
    var buf = list[i]
    if (isInstance(buf, Uint8Array)) {
      if (pos + buf.length > buffer.length) {
        Buffer.from(buf).copy(buffer, pos)
      } else {
        Uint8Array.prototype.set.call(
          buffer,
          buf,
          pos
        )
      }
    } else if (!Buffer.isBuffer(buf)) {
      throw new TypeError('"list" argument must be an Array of Buffers')
    } else {
      buf.copy(buffer, pos)
    }
    pos += buf.length
  }
  return buffer
}

function byteLength (string, encoding) {
  if (Buffer.isBuffer(string)) {
    return string.length
  }
  if (ArrayBuffer.isView(string) || isInstance(string, ArrayBuffer)) {
    return string.byteLength
  }
  if (typeof string !== 'string') {
    throw new TypeError(
      'The "string" argument must be one of type string, Buffer, or ArrayBuffer. ' +
      'Received type ' + typeof string
    )
  }

  var len = string.length
  var mustMatch = (arguments.length > 2 && arguments[2] === true)
  if (!mustMatch && len === 0) return 0

  // Use a for loop to avoid recursion
  var loweredCase = false
  for (;;) {
    switch (encoding) {
      case 'ascii':
      case 'latin1':
      case 'binary':
        return len
      case 'utf8':
      case 'utf-8':
        return utf8ToBytes(string).length
      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return len * 2
      case 'hex':
        return len >>> 1
      case 'base64':
        return base64ToBytes(string).length
      default:
        if (loweredCase) {
          return mustMatch ? -1 : utf8ToBytes(string).length // assume utf8
        }
        encoding = ('' + encoding).toLowerCase()
        loweredCase = true
    }
  }
}
Buffer.byteLength = byteLength

function slowToString (encoding, start, end) {
  var loweredCase = false

  // No need to verify that "this.length <= MAX_UINT32" since it's a read-only
  // property of a typed array.

  // This behaves neither like String nor Uint8Array in that we set start/end
  // to their upper/lower bounds if the value passed is out of range.
  // undefined is handled specially as per ECMA-262 6th Edition,
  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.
  if (start === undefined || start < 0) {
    start = 0
  }
  // Return early if start > this.length. Done here to prevent potential uint32
  // coercion fail below.
  if (start > this.length) {
    return ''
  }

  if (end === undefined || end > this.length) {
    end = this.length
  }

  if (end <= 0) {
    return ''
  }

  // Force coercion to uint32. This will also coerce falsey/NaN values to 0.
  end >>>= 0
  start >>>= 0

  if (end <= start) {
    return ''
  }

  if (!encoding) encoding = 'utf8'

  while (true) {
    switch (encoding) {
      case 'hex':
        return hexSlice(this, start, end)

      case 'utf8':
      case 'utf-8':
        return utf8Slice(this, start, end)

      case 'ascii':
        return asciiSlice(this, start, end)

      case 'latin1':
      case 'binary':
        return latin1Slice(this, start, end)

      case 'base64':
        return base64Slice(this, start, end)

      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return utf16leSlice(this, start, end)

      default:
        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)
        encoding = (encoding + '').toLowerCase()
        loweredCase = true
    }
  }
}

// This property is used by `Buffer.isBuffer` (and the `is-buffer` npm package)
// to detect a Buffer instance. It's not possible to use `instanceof Buffer`
// reliably in a browserify context because there could be multiple different
// copies of the 'buffer' package in use. This method works even for Buffer
// instances that were created from another copy of the `buffer` package.
// See: https://github.com/feross/buffer/issues/154
Buffer.prototype._isBuffer = true

function swap (b, n, m) {
  var i = b[n]
  b[n] = b[m]
  b[m] = i
}

Buffer.prototype.swap16 = function swap16 () {
  var len = this.length
  if (len % 2 !== 0) {
    throw new RangeError('Buffer size must be a multiple of 16-bits')
  }
  for (var i = 0; i < len; i += 2) {
    swap(this, i, i + 1)
  }
  return this
}

Buffer.prototype.swap32 = function swap32 () {
  var len = this.length
  if (len % 4 !== 0) {
    throw new RangeError('Buffer size must be a multiple of 32-bits')
  }
  for (var i = 0; i < len; i += 4) {
    swap(this, i, i + 3)
    swap(this, i + 1, i + 2)
  }
  return this
}

Buffer.prototype.swap64 = function swap64 () {
  var len = this.length
  if (len % 8 !== 0) {
    throw new RangeError('Buffer size must be a multiple of 64-bits')
  }
  for (var i = 0; i < len; i += 8) {
    swap(this, i, i + 7)
    swap(this, i + 1, i + 6)
    swap(this, i + 2, i + 5)
    swap(this, i + 3, i + 4)
  }
  return this
}

Buffer.prototype.toString = function toString () {
  var length = this.length
  if (length === 0) return ''
  if (arguments.length === 0) return utf8Slice(this, 0, length)
  return slowToString.apply(this, arguments)
}

Buffer.prototype.toLocaleString = Buffer.prototype.toString

Buffer.prototype.equals = function equals (b) {
  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')
  if (this === b) return true
  return Buffer.compare(this, b) === 0
}

Buffer.prototype.inspect = function inspect () {
  var str = ''
  var max = exports.INSPECT_MAX_BYTES
  str = this.toString('hex', 0, max).replace(/(.{2})/g, '$1 ').trim()
  if (this.length > max) str += ' ... '
  return '<Buffer ' + str + '>'
}
if (customInspectSymbol) {
  Buffer.prototype[customInspectSymbol] = Buffer.prototype.inspect
}

Buffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {
  if (isInstance(target, Uint8Array)) {
    target = Buffer.from(target, target.offset, target.byteLength)
  }
  if (!Buffer.isBuffer(target)) {
    throw new TypeError(
      'The "target" argument must be one of type Buffer or Uint8Array. ' +
      'Received type ' + (typeof target)
    )
  }

  if (start === undefined) {
    start = 0
  }
  if (end === undefined) {
    end = target ? target.length : 0
  }
  if (thisStart === undefined) {
    thisStart = 0
  }
  if (thisEnd === undefined) {
    thisEnd = this.length
  }

  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {
    throw new RangeError('out of range index')
  }

  if (thisStart >= thisEnd && start >= end) {
    return 0
  }
  if (thisStart >= thisEnd) {
    return -1
  }
  if (start >= end) {
    return 1
  }

  start >>>= 0
  end >>>= 0
  thisStart >>>= 0
  thisEnd >>>= 0

  if (this === target) return 0

  var x = thisEnd - thisStart
  var y = end - start
  var len = Math.min(x, y)

  var thisCopy = this.slice(thisStart, thisEnd)
  var targetCopy = target.slice(start, end)

  for (var i = 0; i < len; ++i) {
    if (thisCopy[i] !== targetCopy[i]) {
      x = thisCopy[i]
      y = targetCopy[i]
      break
    }
  }

  if (x < y) return -1
  if (y < x) return 1
  return 0
}

// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,
// OR the last index of `val` in `buffer` at offset <= `byteOffset`.
//
// Arguments:
// - buffer - a Buffer to search
// - val - a string, Buffer, or number
// - byteOffset - an index into `buffer`; will be clamped to an int32
// - encoding - an optional encoding, relevant is val is a string
// - dir - true for indexOf, false for lastIndexOf
function bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {
  // Empty buffer means no match
  if (buffer.length === 0) return -1

  // Normalize byteOffset
  if (typeof byteOffset === 'string') {
    encoding = byteOffset
    byteOffset = 0
  } else if (byteOffset > 0x7fffffff) {
    byteOffset = 0x7fffffff
  } else if (byteOffset < -0x80000000) {
    byteOffset = -0x80000000
  }
  byteOffset = +byteOffset // Coerce to Number.
  if (numberIsNaN(byteOffset)) {
    // byteOffset: it it's undefined, null, NaN, "foo", etc, search whole buffer
    byteOffset = dir ? 0 : (buffer.length - 1)
  }

  // Normalize byteOffset: negative offsets start from the end of the buffer
  if (byteOffset < 0) byteOffset = buffer.length + byteOffset
  if (byteOffset >= buffer.length) {
    if (dir) return -1
    else byteOffset = buffer.length - 1
  } else if (byteOffset < 0) {
    if (dir) byteOffset = 0
    else return -1
  }

  // Normalize val
  if (typeof val === 'string') {
    val = Buffer.from(val, encoding)
  }

  // Finally, search either indexOf (if dir is true) or lastIndexOf
  if (Buffer.isBuffer(val)) {
    // Special case: looking for empty string/buffer always fails
    if (val.length === 0) {
      return -1
    }
    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)
  } else if (typeof val === 'number') {
    val = val & 0xFF // Search for a byte value [0-255]
    if (typeof Uint8Array.prototype.indexOf === 'function') {
      if (dir) {
        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)
      } else {
        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)
      }
    }
    return arrayIndexOf(buffer, [val], byteOffset, encoding, dir)
  }

  throw new TypeError('val must be string, number or Buffer')
}

function arrayIndexOf (arr, val, byteOffset, encoding, dir) {
  var indexSize = 1
  var arrLength = arr.length
  var valLength = val.length

  if (encoding !== undefined) {
    encoding = String(encoding).toLowerCase()
    if (encoding === 'ucs2' || encoding === 'ucs-2' ||
        encoding === 'utf16le' || encoding === 'utf-16le') {
      if (arr.length < 2 || val.length < 2) {
        return -1
      }
      indexSize = 2
      arrLength /= 2
      valLength /= 2
      byteOffset /= 2
    }
  }

  function read (buf, i) {
    if (indexSize === 1) {
      return buf[i]
    } else {
      return buf.readUInt16BE(i * indexSize)
    }
  }

  var i
  if (dir) {
    var foundIndex = -1
    for (i = byteOffset; i < arrLength; i++) {
      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {
        if (foundIndex === -1) foundIndex = i
        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize
      } else {
        if (foundIndex !== -1) i -= i - foundIndex
        foundIndex = -1
      }
    }
  } else {
    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength
    for (i = byteOffset; i >= 0; i--) {
      var found = true
      for (var j = 0; j < valLength; j++) {
        if (read(arr, i + j) !== read(val, j)) {
          found = false
          break
        }
      }
      if (found) return i
    }
  }

  return -1
}

Buffer.prototype.includes = function includes (val, byteOffset, encoding) {
  return this.indexOf(val, byteOffset, encoding) !== -1
}

Buffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {
  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)
}

Buffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {
  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)
}

function hexWrite (buf, string, offset, length) {
  offset = Number(offset) || 0
  var remaining = buf.length - offset
  if (!length) {
    length = remaining
  } else {
    length = Number(length)
    if (length > remaining) {
      length = remaining
    }
  }

  var strLen = string.length

  if (length > strLen / 2) {
    length = strLen / 2
  }
  for (var i = 0; i < length; ++i) {
    var parsed = parseInt(string.substr(i * 2, 2), 16)
    if (numberIsNaN(parsed)) return i
    buf[offset + i] = parsed
  }
  return i
}

function utf8Write (buf, string, offset, length) {
  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)
}

function asciiWrite (buf, string, offset, length) {
  return blitBuffer(asciiToBytes(string), buf, offset, length)
}

function base64Write (buf, string, offset, length) {
  return blitBuffer(base64ToBytes(string), buf, offset, length)
}

function ucs2Write (buf, string, offset, length) {
  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)
}

Buffer.prototype.write = function write (string, offset, length, encoding) {
  // Buffer#write(string)
  if (offset === undefined) {
    encoding = 'utf8'
    length = this.length
    offset = 0
  // Buffer#write(string, encoding)
  } else if (length === undefined && typeof offset === 'string') {
    encoding = offset
    length = this.length
    offset = 0
  // Buffer#write(string, offset[, length][, encoding])
  } else if (isFinite(offset)) {
    offset = offset >>> 0
    if (isFinite(length)) {
      length = length >>> 0
      if (encoding === undefined) encoding = 'utf8'
    } else {
      encoding = length
      length = undefined
    }
  } else {
    throw new Error(
      'Buffer.write(string, encoding, offset[, length]) is no longer supported'
    )
  }

  var remaining = this.length - offset
  if (length === undefined || length > remaining) length = remaining

  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {
    throw new RangeError('Attempt to write outside buffer bounds')
  }

  if (!encoding) encoding = 'utf8'

  var loweredCase = false
  for (;;) {
    switch (encoding) {
      case 'hex':
        return hexWrite(this, string, offset, length)

      case 'utf8':
      case 'utf-8':
        return utf8Write(this, string, offset, length)

      case 'ascii':
      case 'latin1':
      case 'binary':
        return asciiWrite(this, string, offset, length)

      case 'base64':
        // Warning: maxLength not taken into account in base64Write
        return base64Write(this, string, offset, length)

      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return ucs2Write(this, string, offset, length)

      default:
        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)
        encoding = ('' + encoding).toLowerCase()
        loweredCase = true
    }
  }
}

Buffer.prototype.toJSON = function toJSON () {
  return {
    type: 'Buffer',
    data: Array.prototype.slice.call(this._arr || this, 0)
  }
}

function base64Slice (buf, start, end) {
  if (start === 0 && end === buf.length) {
    return base64.fromByteArray(buf)
  } else {
    return base64.fromByteArray(buf.slice(start, end))
  }
}

function utf8Slice (buf, start, end) {
  end = Math.min(buf.length, end)
  var res = []

  var i = start
  while (i < end) {
    var firstByte = buf[i]
    var codePoint = null
    var bytesPerSequence = (firstByte > 0xEF)
      ? 4
      : (firstByte > 0xDF)
          ? 3
          : (firstByte > 0xBF)
              ? 2
              : 1

    if (i + bytesPerSequence <= end) {
      var secondByte, thirdByte, fourthByte, tempCodePoint

      switch (bytesPerSequence) {
        case 1:
          if (firstByte < 0x80) {
            codePoint = firstByte
          }
          break
        case 2:
          secondByte = buf[i + 1]
          if ((secondByte & 0xC0) === 0x80) {
            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)
            if (tempCodePoint > 0x7F) {
              codePoint = tempCodePoint
            }
          }
          break
        case 3:
          secondByte = buf[i + 1]
          thirdByte = buf[i + 2]
          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {
            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)
            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {
              codePoint = tempCodePoint
            }
          }
          break
        case 4:
          secondByte = buf[i + 1]
          thirdByte = buf[i + 2]
          fourthByte = buf[i + 3]
          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {
            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)
            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {
              codePoint = tempCodePoint
            }
          }
      }
    }

    if (codePoint === null) {
      // we did not generate a valid codePoint so insert a
      // replacement char (U+FFFD) and advance only 1 byte
      codePoint = 0xFFFD
      bytesPerSequence = 1
    } else if (codePoint > 0xFFFF) {
      // encode to utf16 (surrogate pair dance)
      codePoint -= 0x10000
      res.push(codePoint >>> 10 & 0x3FF | 0xD800)
      codePoint = 0xDC00 | codePoint & 0x3FF
    }

    res.push(codePoint)
    i += bytesPerSequence
  }

  return decodeCodePointsArray(res)
}

// Based on http://stackoverflow.com/a/22747272/680742, the browser with
// the lowest limit is Chrome, with 0x10000 args.
// We go 1 magnitude less, for safety
var MAX_ARGUMENTS_LENGTH = 0x1000

function decodeCodePointsArray (codePoints) {
  var len = codePoints.length
  if (len <= MAX_ARGUMENTS_LENGTH) {
    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()
  }

  // Decode in chunks to avoid "call stack size exceeded".
  var res = ''
  var i = 0
  while (i < len) {
    res += String.fromCharCode.apply(
      String,
      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)
    )
  }
  return res
}

function asciiSlice (buf, start, end) {
  var ret = ''
  end = Math.min(buf.length, end)

  for (var i = start; i < end; ++i) {
    ret += String.fromCharCode(buf[i] & 0x7F)
  }
  return ret
}

function latin1Slice (buf, start, end) {
  var ret = ''
  end = Math.min(buf.length, end)

  for (var i = start; i < end; ++i) {
    ret += String.fromCharCode(buf[i])
  }
  return ret
}

function hexSlice (buf, start, end) {
  var len = buf.length

  if (!start || start < 0) start = 0
  if (!end || end < 0 || end > len) end = len

  var out = ''
  for (var i = start; i < end; ++i) {
    out += hexSliceLookupTable[buf[i]]
  }
  return out
}

function utf16leSlice (buf, start, end) {
  var bytes = buf.slice(start, end)
  var res = ''
  // If bytes.length is odd, the last 8 bits must be ignored (same as node.js)
  for (var i = 0; i < bytes.length - 1; i += 2) {
    res += String.fromCharCode(bytes[i] + (bytes[i + 1] * 256))
  }
  return res
}

Buffer.prototype.slice = function slice (start, end) {
  var len = this.length
  start = ~~start
  end = end === undefined ? len : ~~end

  if (start < 0) {
    start += len
    if (start < 0) start = 0
  } else if (start > len) {
    start = len
  }

  if (end < 0) {
    end += len
    if (end < 0) end = 0
  } else if (end > len) {
    end = len
  }

  if (end < start) end = start

  var newBuf = this.subarray(start, end)
  // Return an augmented `Uint8Array` instance
  Object.setPrototypeOf(newBuf, Buffer.prototype)

  return newBuf
}

/*
 * Need to make sure that buffer isn't trying to write out of bounds.
 */
function checkOffset (offset, ext, length) {
  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')
  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')
}

Buffer.prototype.readUintLE =
Buffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {
  offset = offset >>> 0
  byteLength = byteLength >>> 0
  if (!noAssert) checkOffset(offset, byteLength, this.length)

  var val = this[offset]
  var mul = 1
  var i = 0
  while (++i < byteLength && (mul *= 0x100)) {
    val += this[offset + i] * mul
  }

  return val
}

Buffer.prototype.readUintBE =
Buffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {
  offset = offset >>> 0
  byteLength = byteLength >>> 0
  if (!noAssert) {
    checkOffset(offset, byteLength, this.length)
  }

  var val = this[offset + --byteLength]
  var mul = 1
  while (byteLength > 0 && (mul *= 0x100)) {
    val += this[offset + --byteLength] * mul
  }

  return val
}

Buffer.prototype.readUint8 =
Buffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 1, this.length)
  return this[offset]
}

Buffer.prototype.readUint16LE =
Buffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 2, this.length)
  return this[offset] | (this[offset + 1] << 8)
}

Buffer.prototype.readUint16BE =
Buffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 2, this.length)
  return (this[offset] << 8) | this[offset + 1]
}

Buffer.prototype.readUint32LE =
Buffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 4, this.length)

  return ((this[offset]) |
      (this[offset + 1] << 8) |
      (this[offset + 2] << 16)) +
      (this[offset + 3] * 0x1000000)
}

Buffer.prototype.readUint32BE =
Buffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 4, this.length)

  return (this[offset] * 0x1000000) +
    ((this[offset + 1] << 16) |
    (this[offset + 2] << 8) |
    this[offset + 3])
}

Buffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {
  offset = offset >>> 0
  byteLength = byteLength >>> 0
  if (!noAssert) checkOffset(offset, byteLength, this.length)

  var val = this[offset]
  var mul = 1
  var i = 0
  while (++i < byteLength && (mul *= 0x100)) {
    val += this[offset + i] * mul
  }
  mul *= 0x80

  if (val >= mul) val -= Math.pow(2, 8 * byteLength)

  return val
}

Buffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {
  offset = offset >>> 0
  byteLength = byteLength >>> 0
  if (!noAssert) checkOffset(offset, byteLength, this.length)

  var i = byteLength
  var mul = 1
  var val = this[offset + --i]
  while (i > 0 && (mul *= 0x100)) {
    val += this[offset + --i] * mul
  }
  mul *= 0x80

  if (val >= mul) val -= Math.pow(2, 8 * byteLength)

  return val
}

Buffer.prototype.readInt8 = function readInt8 (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 1, this.length)
  if (!(this[offset] & 0x80)) return (this[offset])
  return ((0xff - this[offset] + 1) * -1)
}

Buffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 2, this.length)
  var val = this[offset] | (this[offset + 1] << 8)
  return (val & 0x8000) ? val | 0xFFFF0000 : val
}

Buffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 2, this.length)
  var val = this[offset + 1] | (this[offset] << 8)
  return (val & 0x8000) ? val | 0xFFFF0000 : val
}

Buffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 4, this.length)

  return (this[offset]) |
    (this[offset + 1] << 8) |
    (this[offset + 2] << 16) |
    (this[offset + 3] << 24)
}

Buffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 4, this.length)

  return (this[offset] << 24) |
    (this[offset + 1] << 16) |
    (this[offset + 2] << 8) |
    (this[offset + 3])
}

Buffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 4, this.length)
  return ieee754.read(this, offset, true, 23, 4)
}

Buffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 4, this.length)
  return ieee754.read(this, offset, false, 23, 4)
}

Buffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 8, this.length)
  return ieee754.read(this, offset, true, 52, 8)
}

Buffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {
  offset = offset >>> 0
  if (!noAssert) checkOffset(offset, 8, this.length)
  return ieee754.read(this, offset, false, 52, 8)
}

function checkInt (buf, value, offset, ext, max, min) {
  if (!Buffer.isBuffer(buf)) throw new TypeError('"buffer" argument must be a Buffer instance')
  if (value > max || value < min) throw new RangeError('"value" argument is out of bounds')
  if (offset + ext > buf.length) throw new RangeError('Index out of range')
}

Buffer.prototype.writeUintLE =
Buffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset >>> 0
  byteLength = byteLength >>> 0
  if (!noAssert) {
    var maxBytes = Math.pow(2, 8 * byteLength) - 1
    checkInt(this, value, offset, byteLength, maxBytes, 0)
  }

  var mul = 1
  var i = 0
  this[offset] = value & 0xFF
  while (++i < byteLength && (mul *= 0x100)) {
    this[offset + i] = (value / mul) & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeUintBE =
Buffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset >>> 0
  byteLength = byteLength >>> 0
  if (!noAssert) {
    var maxBytes = Math.pow(2, 8 * byteLength) - 1
    checkInt(this, value, offset, byteLength, maxBytes, 0)
  }

  var i = byteLength - 1
  var mul = 1
  this[offset + i] = value & 0xFF
  while (--i >= 0 && (mul *= 0x100)) {
    this[offset + i] = (value / mul) & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeUint8 =
Buffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)
  this[offset] = (value & 0xff)
  return offset + 1
}

Buffer.prototype.writeUint16LE =
Buffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)
  this[offset] = (value & 0xff)
  this[offset + 1] = (value >>> 8)
  return offset + 2
}

Buffer.prototype.writeUint16BE =
Buffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)
  this[offset] = (value >>> 8)
  this[offset + 1] = (value & 0xff)
  return offset + 2
}

Buffer.prototype.writeUint32LE =
Buffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)
  this[offset + 3] = (value >>> 24)
  this[offset + 2] = (value >>> 16)
  this[offset + 1] = (value >>> 8)
  this[offset] = (value & 0xff)
  return offset + 4
}

Buffer.prototype.writeUint32BE =
Buffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)
  this[offset] = (value >>> 24)
  this[offset + 1] = (value >>> 16)
  this[offset + 2] = (value >>> 8)
  this[offset + 3] = (value & 0xff)
  return offset + 4
}

Buffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) {
    var limit = Math.pow(2, (8 * byteLength) - 1)

    checkInt(this, value, offset, byteLength, limit - 1, -limit)
  }

  var i = 0
  var mul = 1
  var sub = 0
  this[offset] = value & 0xFF
  while (++i < byteLength && (mul *= 0x100)) {
    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {
      sub = 1
    }
    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) {
    var limit = Math.pow(2, (8 * byteLength) - 1)

    checkInt(this, value, offset, byteLength, limit - 1, -limit)
  }

  var i = byteLength - 1
  var mul = 1
  var sub = 0
  this[offset + i] = value & 0xFF
  while (--i >= 0 && (mul *= 0x100)) {
    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {
      sub = 1
    }
    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)
  if (value < 0) value = 0xff + value + 1
  this[offset] = (value & 0xff)
  return offset + 1
}

Buffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)
  this[offset] = (value & 0xff)
  this[offset + 1] = (value >>> 8)
  return offset + 2
}

Buffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)
  this[offset] = (value >>> 8)
  this[offset + 1] = (value & 0xff)
  return offset + 2
}

Buffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)
  this[offset] = (value & 0xff)
  this[offset + 1] = (value >>> 8)
  this[offset + 2] = (value >>> 16)
  this[offset + 3] = (value >>> 24)
  return offset + 4
}

Buffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)
  if (value < 0) value = 0xffffffff + value + 1
  this[offset] = (value >>> 24)
  this[offset + 1] = (value >>> 16)
  this[offset + 2] = (value >>> 8)
  this[offset + 3] = (value & 0xff)
  return offset + 4
}

function checkIEEE754 (buf, value, offset, ext, max, min) {
  if (offset + ext > buf.length) throw new RangeError('Index out of range')
  if (offset < 0) throw new RangeError('Index out of range')
}

function writeFloat (buf, value, offset, littleEndian, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) {
    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)
  }
  ieee754.write(buf, value, offset, littleEndian, 23, 4)
  return offset + 4
}

Buffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {
  return writeFloat(this, value, offset, true, noAssert)
}

Buffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {
  return writeFloat(this, value, offset, false, noAssert)
}

function writeDouble (buf, value, offset, littleEndian, noAssert) {
  value = +value
  offset = offset >>> 0
  if (!noAssert) {
    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)
  }
  ieee754.write(buf, value, offset, littleEndian, 52, 8)
  return offset + 8
}

Buffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {
  return writeDouble(this, value, offset, true, noAssert)
}

Buffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {
  return writeDouble(this, value, offset, false, noAssert)
}

// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)
Buffer.prototype.copy = function copy (target, targetStart, start, end) {
  if (!Buffer.isBuffer(target)) throw new TypeError('argument should be a Buffer')
  if (!start) start = 0
  if (!end && end !== 0) end = this.length
  if (targetStart >= target.length) targetStart = target.length
  if (!targetStart) targetStart = 0
  if (end > 0 && end < start) end = start

  // Copy 0 bytes; we're done
  if (end === start) return 0
  if (target.length === 0 || this.length === 0) return 0

  // Fatal error conditions
  if (targetStart < 0) {
    throw new RangeError('targetStart out of bounds')
  }
  if (start < 0 || start >= this.length) throw new RangeError('Index out of range')
  if (end < 0) throw new RangeError('sourceEnd out of bounds')

  // Are we oob?
  if (end > this.length) end = this.length
  if (target.length - targetStart < end - start) {
    end = target.length - targetStart + start
  }

  var len = end - start

  if (this === target && typeof Uint8Array.prototype.copyWithin === 'function') {
    // Use built-in when available, missing from IE11
    this.copyWithin(targetStart, start, end)
  } else {
    Uint8Array.prototype.set.call(
      target,
      this.subarray(start, end),
      targetStart
    )
  }

  return len
}

// Usage:
//    buffer.fill(number[, offset[, end]])
//    buffer.fill(buffer[, offset[, end]])
//    buffer.fill(string[, offset[, end]][, encoding])
Buffer.prototype.fill = function fill (val, start, end, encoding) {
  // Handle string cases:
  if (typeof val === 'string') {
    if (typeof start === 'string') {
      encoding = start
      start = 0
      end = this.length
    } else if (typeof end === 'string') {
      encoding = end
      end = this.length
    }
    if (encoding !== undefined && typeof encoding !== 'string') {
      throw new TypeError('encoding must be a string')
    }
    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {
      throw new TypeError('Unknown encoding: ' + encoding)
    }
    if (val.length === 1) {
      var code = val.charCodeAt(0)
      if ((encoding === 'utf8' && code < 128) ||
          encoding === 'latin1') {
        // Fast path: If `val` fits into a single byte, use that numeric value.
        val = code
      }
    }
  } else if (typeof val === 'number') {
    val = val & 255
  } else if (typeof val === 'boolean') {
    val = Number(val)
  }

  // Invalid ranges are not set to a default, so can range check early.
  if (start < 0 || this.length < start || this.length < end) {
    throw new RangeError('Out of range index')
  }

  if (end <= start) {
    return this
  }

  start = start >>> 0
  end = end === undefined ? this.length : end >>> 0

  if (!val) val = 0

  var i
  if (typeof val === 'number') {
    for (i = start; i < end; ++i) {
      this[i] = val
    }
  } else {
    var bytes = Buffer.isBuffer(val)
      ? val
      : Buffer.from(val, encoding)
    var len = bytes.length
    if (len === 0) {
      throw new TypeError('The value "' + val +
        '" is invalid for argument "value"')
    }
    for (i = 0; i < end - start; ++i) {
      this[i + start] = bytes[i % len]
    }
  }

  return this
}

// HELPER FUNCTIONS
// ================

var INVALID_BASE64_RE = /[^+/0-9A-Za-z-_]/g

function base64clean (str) {
  // Node takes equal signs as end of the Base64 encoding
  str = str.split('=')[0]
  // Node strips out invalid characters like \n and \t from the string, base64-js does not
  str = str.trim().replace(INVALID_BASE64_RE, '')
  // Node converts strings with length < 2 to ''
  if (str.length < 2) return ''
  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not
  while (str.length % 4 !== 0) {
    str = str + '='
  }
  return str
}

function utf8ToBytes (string, units) {
  units = units || Infinity
  var codePoint
  var length = string.length
  var leadSurrogate = null
  var bytes = []

  for (var i = 0; i < length; ++i) {
    codePoint = string.charCodeAt(i)

    // is surrogate component
    if (codePoint > 0xD7FF && codePoint < 0xE000) {
      // last char was a lead
      if (!leadSurrogate) {
        // no lead yet
        if (codePoint > 0xDBFF) {
          // unexpected trail
          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
          continue
        } else if (i + 1 === length) {
          // unpaired lead
          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
          continue
        }

        // valid lead
        leadSurrogate = codePoint

        continue
      }

      // 2 leads in a row
      if (codePoint < 0xDC00) {
        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
        leadSurrogate = codePoint
        continue
      }

      // valid surrogate pair
      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000
    } else if (leadSurrogate) {
      // valid bmp char, but last char was a lead
      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
    }

    leadSurrogate = null

    // encode utf8
    if (codePoint < 0x80) {
      if ((units -= 1) < 0) break
      bytes.push(codePoint)
    } else if (codePoint < 0x800) {
      if ((units -= 2) < 0) break
      bytes.push(
        codePoint >> 0x6 | 0xC0,
        codePoint & 0x3F | 0x80
      )
    } else if (codePoint < 0x10000) {
      if ((units -= 3) < 0) break
      bytes.push(
        codePoint >> 0xC | 0xE0,
        codePoint >> 0x6 & 0x3F | 0x80,
        codePoint & 0x3F | 0x80
      )
    } else if (codePoint < 0x110000) {
      if ((units -= 4) < 0) break
      bytes.push(
        codePoint >> 0x12 | 0xF0,
        codePoint >> 0xC & 0x3F | 0x80,
        codePoint >> 0x6 & 0x3F | 0x80,
        codePoint & 0x3F | 0x80
      )
    } else {
      throw new Error('Invalid code point')
    }
  }

  return bytes
}

function asciiToBytes (str) {
  var byteArray = []
  for (var i = 0; i < str.length; ++i) {
    // Node's code seems to be doing this and not & 0x7F..
    byteArray.push(str.charCodeAt(i) & 0xFF)
  }
  return byteArray
}

function utf16leToBytes (str, units) {
  var c, hi, lo
  var byteArray = []
  for (var i = 0; i < str.length; ++i) {
    if ((units -= 2) < 0) break

    c = str.charCodeAt(i)
    hi = c >> 8
    lo = c % 256
    byteArray.push(lo)
    byteArray.push(hi)
  }

  return byteArray
}

function base64ToBytes (str) {
  return base64.toByteArray(base64clean(str))
}

function blitBuffer (src, dst, offset, length) {
  for (var i = 0; i < length; ++i) {
    if ((i + offset >= dst.length) || (i >= src.length)) break
    dst[i + offset] = src[i]
  }
  return i
}

// ArrayBuffer or Uint8Array objects from other contexts (i.e. iframes) do not pass
// the `instanceof` check but they should be treated as of that type.
// See: https://github.com/feross/buffer/issues/166
function isInstance (obj, type) {
  return obj instanceof type ||
    (obj != null && obj.constructor != null && obj.constructor.name != null &&
      obj.constructor.name === type.name)
}
function numberIsNaN (obj) {
  // For IE11 support
  return obj !== obj // eslint-disable-line no-self-compare
}

// Create lookup table for `toString('hex')`
// See: https://github.com/feross/buffer/issues/219
var hexSliceLookupTable = (function () {
  var alphabet = '0123456789abcdef'
  var table = new Array(256)
  for (var i = 0; i < 16; ++i) {
    var i16 = i * 16
    for (var j = 0; j < 16; ++j) {
      table[i16 + j] = alphabet[i] + alphabet[j]
    }
  }
  return table
})()


/***/ }),

/***/ 5666:
/***/ ((module) => {

/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

var runtime = (function (exports) {
  "use strict";

  var Op = Object.prototype;
  var hasOwn = Op.hasOwnProperty;
  var undefined; // More compressible than void 0.
  var $Symbol = typeof Symbol === "function" ? Symbol : {};
  var iteratorSymbol = $Symbol.iterator || "@@iterator";
  var asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator";
  var toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag";

  function define(obj, key, value) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
    return obj[key];
  }
  try {
    // IE 8 has a broken Object.defineProperty that only works on DOM objects.
    define({}, "");
  } catch (err) {
    define = function(obj, key, value) {
      return obj[key] = value;
    };
  }

  function wrap(innerFn, outerFn, self, tryLocsList) {
    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.
    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;
    var generator = Object.create(protoGenerator.prototype);
    var context = new Context(tryLocsList || []);

    // The ._invoke method unifies the implementations of the .next,
    // .throw, and .return methods.
    generator._invoke = makeInvokeMethod(innerFn, self, context);

    return generator;
  }
  exports.wrap = wrap;

  // Try/catch helper to minimize deoptimizations. Returns a completion
  // record like context.tryEntries[i].completion. This interface could
  // have been (and was previously) designed to take a closure to be
  // invoked without arguments, but in all the cases we care about we
  // already have an existing method we want to call, so there's no need
  // to create a new function object. We can even get away with assuming
  // the method takes exactly one argument, since that happens to be true
  // in every case, so we don't have to touch the arguments object. The
  // only additional allocation required is the completion record, which
  // has a stable shape and so hopefully should be cheap to allocate.
  function tryCatch(fn, obj, arg) {
    try {
      return { type: "normal", arg: fn.call(obj, arg) };
    } catch (err) {
      return { type: "throw", arg: err };
    }
  }

  var GenStateSuspendedStart = "suspendedStart";
  var GenStateSuspendedYield = "suspendedYield";
  var GenStateExecuting = "executing";
  var GenStateCompleted = "completed";

  // Returning this object from the innerFn has the same effect as
  // breaking out of the dispatch switch statement.
  var ContinueSentinel = {};

  // Dummy constructor functions that we use as the .constructor and
  // .constructor.prototype properties for functions that return Generator
  // objects. For full spec compliance, you may wish to configure your
  // minifier not to mangle the names of these two functions.
  function Generator() {}
  function GeneratorFunction() {}
  function GeneratorFunctionPrototype() {}

  // This is a polyfill for %IteratorPrototype% for environments that
  // don't natively support it.
  var IteratorPrototype = {};
  IteratorPrototype[iteratorSymbol] = function () {
    return this;
  };

  var getProto = Object.getPrototypeOf;
  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));
  if (NativeIteratorPrototype &&
      NativeIteratorPrototype !== Op &&
      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {
    // This environment has a native %IteratorPrototype%; use it instead
    // of the polyfill.
    IteratorPrototype = NativeIteratorPrototype;
  }

  var Gp = GeneratorFunctionPrototype.prototype =
    Generator.prototype = Object.create(IteratorPrototype);
  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;
  GeneratorFunctionPrototype.constructor = GeneratorFunction;
  GeneratorFunction.displayName = define(
    GeneratorFunctionPrototype,
    toStringTagSymbol,
    "GeneratorFunction"
  );

  // Helper for defining the .next, .throw, and .return methods of the
  // Iterator interface in terms of a single ._invoke method.
  function defineIteratorMethods(prototype) {
    ["next", "throw", "return"].forEach(function(method) {
      define(prototype, method, function(arg) {
        return this._invoke(method, arg);
      });
    });
  }

  exports.isGeneratorFunction = function(genFun) {
    var ctor = typeof genFun === "function" && genFun.constructor;
    return ctor
      ? ctor === GeneratorFunction ||
        // For the native GeneratorFunction constructor, the best we can
        // do is to check its .name property.
        (ctor.displayName || ctor.name) === "GeneratorFunction"
      : false;
  };

  exports.mark = function(genFun) {
    if (Object.setPrototypeOf) {
      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);
    } else {
      genFun.__proto__ = GeneratorFunctionPrototype;
      define(genFun, toStringTagSymbol, "GeneratorFunction");
    }
    genFun.prototype = Object.create(Gp);
    return genFun;
  };

  // Within the body of any async function, `await x` is transformed to
  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
  // `hasOwn.call(value, "__await")` to determine if the yielded value is
  // meant to be awaited.
  exports.awrap = function(arg) {
    return { __await: arg };
  };

  function AsyncIterator(generator, PromiseImpl) {
    function invoke(method, arg, resolve, reject) {
      var record = tryCatch(generator[method], generator, arg);
      if (record.type === "throw") {
        reject(record.arg);
      } else {
        var result = record.arg;
        var value = result.value;
        if (value &&
            typeof value === "object" &&
            hasOwn.call(value, "__await")) {
          return PromiseImpl.resolve(value.__await).then(function(value) {
            invoke("next", value, resolve, reject);
          }, function(err) {
            invoke("throw", err, resolve, reject);
          });
        }

        return PromiseImpl.resolve(value).then(function(unwrapped) {
          // When a yielded Promise is resolved, its final value becomes
          // the .value of the Promise<{value,done}> result for the
          // current iteration.
          result.value = unwrapped;
          resolve(result);
        }, function(error) {
          // If a rejected Promise was yielded, throw the rejection back
          // into the async generator function so it can be handled there.
          return invoke("throw", error, resolve, reject);
        });
      }
    }

    var previousPromise;

    function enqueue(method, arg) {
      function callInvokeWithMethodAndArg() {
        return new PromiseImpl(function(resolve, reject) {
          invoke(method, arg, resolve, reject);
        });
      }

      return previousPromise =
        // If enqueue has been called before, then we want to wait until
        // all previous Promises have been resolved before calling invoke,
        // so that results are always delivered in the correct order. If
        // enqueue has not been called before, then it is important to
        // call invoke immediately, without waiting on a callback to fire,
        // so that the async generator function has the opportunity to do
        // any necessary setup in a predictable way. This predictability
        // is why the Promise constructor synchronously invokes its
        // executor callback, and why async functions synchronously
        // execute code before the first await. Since we implement simple
        // async functions in terms of async generators, it is especially
        // important to get this right, even though it requires care.
        previousPromise ? previousPromise.then(
          callInvokeWithMethodAndArg,
          // Avoid propagating failures to Promises returned by later
          // invocations of the iterator.
          callInvokeWithMethodAndArg
        ) : callInvokeWithMethodAndArg();
    }

    // Define the unified helper method that is used to implement .next,
    // .throw, and .return (see defineIteratorMethods).
    this._invoke = enqueue;
  }

  defineIteratorMethods(AsyncIterator.prototype);
  AsyncIterator.prototype[asyncIteratorSymbol] = function () {
    return this;
  };
  exports.AsyncIterator = AsyncIterator;

  // Note that simple async functions are implemented on top of
  // AsyncIterator objects; they just return a Promise for the value of
  // the final result produced by the iterator.
  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {
    if (PromiseImpl === void 0) PromiseImpl = Promise;

    var iter = new AsyncIterator(
      wrap(innerFn, outerFn, self, tryLocsList),
      PromiseImpl
    );

    return exports.isGeneratorFunction(outerFn)
      ? iter // If outerFn is a generator, return the full iterator.
      : iter.next().then(function(result) {
          return result.done ? result.value : iter.next();
        });
  };

  function makeInvokeMethod(innerFn, self, context) {
    var state = GenStateSuspendedStart;

    return function invoke(method, arg) {
      if (state === GenStateExecuting) {
        throw new Error("Generator is already running");
      }

      if (state === GenStateCompleted) {
        if (method === "throw") {
          throw arg;
        }

        // Be forgiving, per 25.3.3.3.3 of the spec:
        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume
        return doneResult();
      }

      context.method = method;
      context.arg = arg;

      while (true) {
        var delegate = context.delegate;
        if (delegate) {
          var delegateResult = maybeInvokeDelegate(delegate, context);
          if (delegateResult) {
            if (delegateResult === ContinueSentinel) continue;
            return delegateResult;
          }
        }

        if (context.method === "next") {
          // Setting context._sent for legacy support of Babel's
          // function.sent implementation.
          context.sent = context._sent = context.arg;

        } else if (context.method === "throw") {
          if (state === GenStateSuspendedStart) {
            state = GenStateCompleted;
            throw context.arg;
          }

          context.dispatchException(context.arg);

        } else if (context.method === "return") {
          context.abrupt("return", context.arg);
        }

        state = GenStateExecuting;

        var record = tryCatch(innerFn, self, context);
        if (record.type === "normal") {
          // If an exception is thrown from innerFn, we leave state ===
          // GenStateExecuting and loop back for another invocation.
          state = context.done
            ? GenStateCompleted
            : GenStateSuspendedYield;

          if (record.arg === ContinueSentinel) {
            continue;
          }

          return {
            value: record.arg,
            done: context.done
          };

        } else if (record.type === "throw") {
          state = GenStateCompleted;
          // Dispatch the exception by looping back around to the
          // context.dispatchException(context.arg) call above.
          context.method = "throw";
          context.arg = record.arg;
        }
      }
    };
  }

  // Call delegate.iterator[context.method](context.arg) and handle the
  // result, either by returning a { value, done } result from the
  // delegate iterator, or by modifying context.method and context.arg,
  // setting context.delegate to null, and returning the ContinueSentinel.
  function maybeInvokeDelegate(delegate, context) {
    var method = delegate.iterator[context.method];
    if (method === undefined) {
      // A .throw or .return when the delegate iterator has no .throw
      // method always terminates the yield* loop.
      context.delegate = null;

      if (context.method === "throw") {
        // Note: ["return"] must be used for ES3 parsing compatibility.
        if (delegate.iterator["return"]) {
          // If the delegate iterator has a return method, give it a
          // chance to clean up.
          context.method = "return";
          context.arg = undefined;
          maybeInvokeDelegate(delegate, context);

          if (context.method === "throw") {
            // If maybeInvokeDelegate(context) changed context.method from
            // "return" to "throw", let that override the TypeError below.
            return ContinueSentinel;
          }
        }

        context.method = "throw";
        context.arg = new TypeError(
          "The iterator does not provide a 'throw' method");
      }

      return ContinueSentinel;
    }

    var record = tryCatch(method, delegate.iterator, context.arg);

    if (record.type === "throw") {
      context.method = "throw";
      context.arg = record.arg;
      context.delegate = null;
      return ContinueSentinel;
    }

    var info = record.arg;

    if (! info) {
      context.method = "throw";
      context.arg = new TypeError("iterator result is not an object");
      context.delegate = null;
      return ContinueSentinel;
    }

    if (info.done) {
      // Assign the result of the finished delegate to the temporary
      // variable specified by delegate.resultName (see delegateYield).
      context[delegate.resultName] = info.value;

      // Resume execution at the desired location (see delegateYield).
      context.next = delegate.nextLoc;

      // If context.method was "throw" but the delegate handled the
      // exception, let the outer generator proceed normally. If
      // context.method was "next", forget context.arg since it has been
      // "consumed" by the delegate iterator. If context.method was
      // "return", allow the original .return call to continue in the
      // outer generator.
      if (context.method !== "return") {
        context.method = "next";
        context.arg = undefined;
      }

    } else {
      // Re-yield the result returned by the delegate method.
      return info;
    }

    // The delegate iterator is finished, so forget it and continue with
    // the outer generator.
    context.delegate = null;
    return ContinueSentinel;
  }

  // Define Generator.prototype.{next,throw,return} in terms of the
  // unified ._invoke helper method.
  defineIteratorMethods(Gp);

  define(Gp, toStringTagSymbol, "Generator");

  // A Generator should always return itself as the iterator object when the
  // @@iterator function is called on it. Some browsers' implementations of the
  // iterator prototype chain incorrectly implement this, causing the Generator
  // object to not be returned from this call. This ensures that doesn't happen.
  // See https://github.com/facebook/regenerator/issues/274 for more details.
  Gp[iteratorSymbol] = function() {
    return this;
  };

  Gp.toString = function() {
    return "[object Generator]";
  };

  function pushTryEntry(locs) {
    var entry = { tryLoc: locs[0] };

    if (1 in locs) {
      entry.catchLoc = locs[1];
    }

    if (2 in locs) {
      entry.finallyLoc = locs[2];
      entry.afterLoc = locs[3];
    }

    this.tryEntries.push(entry);
  }

  function resetTryEntry(entry) {
    var record = entry.completion || {};
    record.type = "normal";
    delete record.arg;
    entry.completion = record;
  }

  function Context(tryLocsList) {
    // The root entry object (effectively a try statement without a catch
    // or a finally block) gives us a place to store values thrown from
    // locations where there is no enclosing try statement.
    this.tryEntries = [{ tryLoc: "root" }];
    tryLocsList.forEach(pushTryEntry, this);
    this.reset(true);
  }

  exports.keys = function(object) {
    var keys = [];
    for (var key in object) {
      keys.push(key);
    }
    keys.reverse();

    // Rather than returning an object with a next method, we keep
    // things simple and return the next function itself.
    return function next() {
      while (keys.length) {
        var key = keys.pop();
        if (key in object) {
          next.value = key;
          next.done = false;
          return next;
        }
      }

      // To avoid creating an additional object, we just hang the .value
      // and .done properties off the next function object itself. This
      // also ensures that the minifier will not anonymize the function.
      next.done = true;
      return next;
    };
  };

  function values(iterable) {
    if (iterable) {
      var iteratorMethod = iterable[iteratorSymbol];
      if (iteratorMethod) {
        return iteratorMethod.call(iterable);
      }

      if (typeof iterable.next === "function") {
        return iterable;
      }

      if (!isNaN(iterable.length)) {
        var i = -1, next = function next() {
          while (++i < iterable.length) {
            if (hasOwn.call(iterable, i)) {
              next.value = iterable[i];
              next.done = false;
              return next;
            }
          }

          next.value = undefined;
          next.done = true;

          return next;
        };

        return next.next = next;
      }
    }

    // Return an iterator with no values.
    return { next: doneResult };
  }
  exports.values = values;

  function doneResult() {
    return { value: undefined, done: true };
  }

  Context.prototype = {
    constructor: Context,

    reset: function(skipTempReset) {
      this.prev = 0;
      this.next = 0;
      // Resetting context._sent for legacy support of Babel's
      // function.sent implementation.
      this.sent = this._sent = undefined;
      this.done = false;
      this.delegate = null;

      this.method = "next";
      this.arg = undefined;

      this.tryEntries.forEach(resetTryEntry);

      if (!skipTempReset) {
        for (var name in this) {
          // Not sure about the optimal order of these conditions:
          if (name.charAt(0) === "t" &&
              hasOwn.call(this, name) &&
              !isNaN(+name.slice(1))) {
            this[name] = undefined;
          }
        }
      }
    },

    stop: function() {
      this.done = true;

      var rootEntry = this.tryEntries[0];
      var rootRecord = rootEntry.completion;
      if (rootRecord.type === "throw") {
        throw rootRecord.arg;
      }

      return this.rval;
    },

    dispatchException: function(exception) {
      if (this.done) {
        throw exception;
      }

      var context = this;
      function handle(loc, caught) {
        record.type = "throw";
        record.arg = exception;
        context.next = loc;

        if (caught) {
          // If the dispatched exception was caught by a catch block,
          // then let that catch block handle the exception normally.
          context.method = "next";
          context.arg = undefined;
        }

        return !! caught;
      }

      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        var record = entry.completion;

        if (entry.tryLoc === "root") {
          // Exception thrown outside of any try block that could handle
          // it, so set the completion value of the entire function to
          // throw the exception.
          return handle("end");
        }

        if (entry.tryLoc <= this.prev) {
          var hasCatch = hasOwn.call(entry, "catchLoc");
          var hasFinally = hasOwn.call(entry, "finallyLoc");

          if (hasCatch && hasFinally) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            } else if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else if (hasCatch) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            }

          } else if (hasFinally) {
            if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else {
            throw new Error("try statement without catch or finally");
          }
        }
      }
    },

    abrupt: function(type, arg) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc <= this.prev &&
            hasOwn.call(entry, "finallyLoc") &&
            this.prev < entry.finallyLoc) {
          var finallyEntry = entry;
          break;
        }
      }

      if (finallyEntry &&
          (type === "break" ||
           type === "continue") &&
          finallyEntry.tryLoc <= arg &&
          arg <= finallyEntry.finallyLoc) {
        // Ignore the finally entry if control is not jumping to a
        // location outside the try/catch block.
        finallyEntry = null;
      }

      var record = finallyEntry ? finallyEntry.completion : {};
      record.type = type;
      record.arg = arg;

      if (finallyEntry) {
        this.method = "next";
        this.next = finallyEntry.finallyLoc;
        return ContinueSentinel;
      }

      return this.complete(record);
    },

    complete: function(record, afterLoc) {
      if (record.type === "throw") {
        throw record.arg;
      }

      if (record.type === "break" ||
          record.type === "continue") {
        this.next = record.arg;
      } else if (record.type === "return") {
        this.rval = this.arg = record.arg;
        this.method = "return";
        this.next = "end";
      } else if (record.type === "normal" && afterLoc) {
        this.next = afterLoc;
      }

      return ContinueSentinel;
    },

    finish: function(finallyLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.finallyLoc === finallyLoc) {
          this.complete(entry.completion, entry.afterLoc);
          resetTryEntry(entry);
          return ContinueSentinel;
        }
      }
    },

    "catch": function(tryLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc === tryLoc) {
          var record = entry.completion;
          if (record.type === "throw") {
            var thrown = record.arg;
            resetTryEntry(entry);
          }
          return thrown;
        }
      }

      // The context.catch method must only be called with a location
      // argument that corresponds to a known catch block.
      throw new Error("illegal catch attempt");
    },

    delegateYield: function(iterable, resultName, nextLoc) {
      this.delegate = {
        iterator: values(iterable),
        resultName: resultName,
        nextLoc: nextLoc
      };

      if (this.method === "next") {
        // Deliberately forget the last sent value so that we don't
        // accidentally pass it on to the delegate.
        this.arg = undefined;
      }

      return ContinueSentinel;
    }
  };

  // Regardless of whether this script is executing as a CommonJS module
  // or not, return the runtime object so that we can declare the variable
  // regeneratorRuntime in the outer scope, which allows this module to be
  // injected easily by `bin/regenerator --include-runtime script.js`.
  return exports;

}(
  // If this script is executing as a CommonJS module, use module.exports
  // as the regeneratorRuntime namespace. Otherwise create a new empty
  // object. Either way, the resulting object will be used to initialize
  // the regeneratorRuntime variable at the top of this file.
   true ? module.exports : 0
));

try {
  regeneratorRuntime = runtime;
} catch (accidentalStrictMode) {
  // This module should not be running in strict mode, so the above
  // assignment should always work unless something is misconfigured. Just
  // in case runtime.js accidentally runs in strict mode, we can escape
  // strict mode using a global Function call. This could conceivably fail
  // if a Content Security Policy forbids using Function, but in that case
  // the proper solution is to fix the accidental strict mode problem. If
  // you've misconfigured your bundler to force strict mode and applied a
  // CSP to forbid Function, and you're not willing to fix either of those
  // problems, please detail your unique predicament in a GitHub issue.
  Function("r", "regeneratorRuntime = r")(runtime);
}


/***/ }),

/***/ 7576:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

Object.defineProperty(exports, "__esModule", ({ value: true }));
var rxjs_1 = __webpack_require__(4143);
exports.BehaviorSubject = rxjs_1.BehaviorSubject;
//# sourceMappingURL=BehaviorSubject.js.map

/***/ }),

/***/ 5345:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

Object.defineProperty(exports, "__esModule", ({ value: true }));
var rxjs_1 = __webpack_require__(4143);
exports.Subject = rxjs_1.Subject;
//# sourceMappingURL=Subject.js.map

/***/ }),

/***/ 969:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

Object.defineProperty(exports, "__esModule", ({ value: true }));
var rxjs_1 = __webpack_require__(4143);
exports.fromEvent = rxjs_1.fromEvent;
//# sourceMappingURL=fromEvent.js.map

/***/ }),

/***/ 5624:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

Object.defineProperty(exports, "__esModule", ({ value: true }));
var operators_1 = __webpack_require__(1717);
exports.filter = operators_1.filter;
//# sourceMappingURL=filter.js.map

/***/ }),

/***/ 6097:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

Object.defineProperty(exports, "__esModule", ({ value: true }));
var operators_1 = __webpack_require__(1717);
exports.first = operators_1.first;
//# sourceMappingURL=first.js.map

/***/ }),

/***/ 1709:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

Object.defineProperty(exports, "__esModule", ({ value: true }));
var operators_1 = __webpack_require__(1717);
exports.map = operators_1.map;
//# sourceMappingURL=map.js.map

/***/ }),

/***/ 3895:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

Object.defineProperty(exports, "__esModule", ({ value: true }));
var operators_1 = __webpack_require__(1717);
exports.mergeMap = operators_1.mergeMap;
//# sourceMappingURL=mergeMap.js.map

/***/ }),

/***/ 6740:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

Object.defineProperty(exports, "__esModule", ({ value: true }));
var operators_1 = __webpack_require__(1717);
exports.takeUntil = operators_1.takeUntil;
//# sourceMappingURL=takeUntil.js.map

/***/ }),

/***/ 698:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

Object.defineProperty(exports, "__esModule", ({ value: true }));
var operators_1 = __webpack_require__(1717);
exports.tap = operators_1.tap;
//# sourceMappingURL=tap.js.map

/***/ }),

/***/ 9122:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", ({ value: true }));
__export(__webpack_require__(7576));
//# sourceMappingURL=BehaviorSubject.js.map

/***/ }),

/***/ 8314:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", ({ value: true }));
__export(__webpack_require__(5345));
//# sourceMappingURL=Subject.js.map

/***/ }),

/***/ 4143:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "ArgumentOutOfRangeError": () => (/* reexport */ ArgumentOutOfRangeError/* ArgumentOutOfRangeError */.W),
  "AsyncSubject": () => (/* reexport */ AsyncSubject/* AsyncSubject */.c),
  "BehaviorSubject": () => (/* reexport */ BehaviorSubject/* BehaviorSubject */.X),
  "ConnectableObservable": () => (/* reexport */ ConnectableObservable/* ConnectableObservable */.c),
  "EMPTY": () => (/* reexport */ empty/* EMPTY */.E),
  "EmptyError": () => (/* reexport */ EmptyError/* EmptyError */.K),
  "GroupedObservable": () => (/* reexport */ groupBy/* GroupedObservable */.T),
  "NEVER": () => (/* reexport */ NEVER),
  "Notification": () => (/* reexport */ Notification/* Notification */.P),
  "NotificationKind": () => (/* reexport */ Notification/* NotificationKind */.W),
  "ObjectUnsubscribedError": () => (/* reexport */ ObjectUnsubscribedError/* ObjectUnsubscribedError */.N),
  "Observable": () => (/* reexport */ Observable/* Observable */.y),
  "ReplaySubject": () => (/* reexport */ ReplaySubject/* ReplaySubject */.t),
  "Scheduler": () => (/* reexport */ Scheduler/* Scheduler */.b),
  "Subject": () => (/* reexport */ Subject/* Subject */.xQ),
  "Subscriber": () => (/* reexport */ Subscriber/* Subscriber */.L),
  "Subscription": () => (/* reexport */ Subscription/* Subscription */.w),
  "TimeoutError": () => (/* reexport */ TimeoutError/* TimeoutError */.W),
  "UnsubscriptionError": () => (/* reexport */ UnsubscriptionError/* UnsubscriptionError */.B),
  "VirtualAction": () => (/* reexport */ VirtualAction),
  "VirtualTimeScheduler": () => (/* reexport */ VirtualTimeScheduler),
  "animationFrame": () => (/* reexport */ animationFrame),
  "animationFrameScheduler": () => (/* reexport */ animationFrameScheduler),
  "asap": () => (/* reexport */ asap/* asap */.e),
  "asapScheduler": () => (/* reexport */ asap/* asapScheduler */.E),
  "async": () => (/* reexport */ scheduler_async/* async */.P),
  "asyncScheduler": () => (/* reexport */ scheduler_async/* asyncScheduler */.z),
  "bindCallback": () => (/* reexport */ bindCallback),
  "bindNodeCallback": () => (/* reexport */ bindNodeCallback),
  "combineLatest": () => (/* reexport */ combineLatest/* combineLatest */.aj),
  "concat": () => (/* reexport */ concat/* concat */.z),
  "config": () => (/* reexport */ config/* config */.v),
  "defer": () => (/* reexport */ defer/* defer */.P),
  "empty": () => (/* reexport */ empty/* empty */.c),
  "forkJoin": () => (/* reexport */ forkJoin),
  "from": () => (/* reexport */ from/* from */.D),
  "fromEvent": () => (/* reexport */ fromEvent),
  "fromEventPattern": () => (/* reexport */ fromEventPattern),
  "generate": () => (/* reexport */ generate),
  "identity": () => (/* reexport */ identity/* identity */.y),
  "iif": () => (/* reexport */ iif),
  "interval": () => (/* reexport */ interval),
  "isObservable": () => (/* reexport */ isObservable),
  "merge": () => (/* reexport */ merge/* merge */.T),
  "never": () => (/* reexport */ never),
  "noop": () => (/* reexport */ noop/* noop */.Z),
  "observable": () => (/* reexport */ observable/* observable */.L),
  "of": () => (/* reexport */ of.of),
  "onErrorResumeNext": () => (/* reexport */ onErrorResumeNext),
  "pairs": () => (/* reexport */ pairs),
  "partition": () => (/* reexport */ partition),
  "pipe": () => (/* reexport */ pipe/* pipe */.z),
  "queue": () => (/* reexport */ queue/* queue */.c),
  "queueScheduler": () => (/* reexport */ queue/* queueScheduler */.N),
  "race": () => (/* reexport */ race/* race */.S3),
  "range": () => (/* reexport */ range),
  "scheduled": () => (/* reexport */ scheduled/* scheduled */.x),
  "throwError": () => (/* reexport */ throwError/* throwError */._),
  "timer": () => (/* reexport */ timer/* timer */.H),
  "using": () => (/* reexport */ using),
  "zip": () => (/* reexport */ zip/* zip */.$R)
});

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Observable.js + 1 modules
var Observable = __webpack_require__(2772);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/ConnectableObservable.js
var ConnectableObservable = __webpack_require__(3140);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/operators/groupBy.js
var groupBy = __webpack_require__(1120);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/symbol/observable.js
var observable = __webpack_require__(5050);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Subject.js
var Subject = __webpack_require__(211);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/BehaviorSubject.js
var BehaviorSubject = __webpack_require__(9233);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/ReplaySubject.js
var ReplaySubject = __webpack_require__(2630);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/AsyncSubject.js
var AsyncSubject = __webpack_require__(364);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/asap.js + 3 modules
var asap = __webpack_require__(6650);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/async.js
var scheduler_async = __webpack_require__(964);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/queue.js + 2 modules
var queue = __webpack_require__(2546);
// EXTERNAL MODULE: ./node_modules/rxjs/node_modules/tslib/tslib.es6.js
var tslib_es6 = __webpack_require__(5987);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/AsyncAction.js + 1 modules
var AsyncAction = __webpack_require__(6114);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/AnimationFrameAction.js
/** PURE_IMPORTS_START tslib,_AsyncAction PURE_IMPORTS_END */


var AnimationFrameAction = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(AnimationFrameAction, _super);
    function AnimationFrameAction(scheduler, work) {
        var _this = _super.call(this, scheduler, work) || this;
        _this.scheduler = scheduler;
        _this.work = work;
        return _this;
    }
    AnimationFrameAction.prototype.requestAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if (delay !== null && delay > 0) {
            return _super.prototype.requestAsyncId.call(this, scheduler, id, delay);
        }
        scheduler.actions.push(this);
        return scheduler.scheduled || (scheduler.scheduled = requestAnimationFrame(function () { return scheduler.flush(null); }));
    };
    AnimationFrameAction.prototype.recycleAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if ((delay !== null && delay > 0) || (delay === null && this.delay > 0)) {
            return _super.prototype.recycleAsyncId.call(this, scheduler, id, delay);
        }
        if (scheduler.actions.length === 0) {
            cancelAnimationFrame(id);
            scheduler.scheduled = undefined;
        }
        return undefined;
    };
    return AnimationFrameAction;
}(AsyncAction/* AsyncAction */.o));

//# sourceMappingURL=AnimationFrameAction.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/AsyncScheduler.js
var AsyncScheduler = __webpack_require__(8399);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/AnimationFrameScheduler.js
/** PURE_IMPORTS_START tslib,_AsyncScheduler PURE_IMPORTS_END */


var AnimationFrameScheduler = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(AnimationFrameScheduler, _super);
    function AnimationFrameScheduler() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AnimationFrameScheduler.prototype.flush = function (action) {
        this.active = true;
        this.scheduled = undefined;
        var actions = this.actions;
        var error;
        var index = -1;
        var count = actions.length;
        action = action || actions.shift();
        do {
            if (error = action.execute(action.state, action.delay)) {
                break;
            }
        } while (++index < count && (action = actions.shift()));
        this.active = false;
        if (error) {
            while (++index < count && (action = actions.shift())) {
                action.unsubscribe();
            }
            throw error;
        }
    };
    return AnimationFrameScheduler;
}(AsyncScheduler/* AsyncScheduler */.v));

//# sourceMappingURL=AnimationFrameScheduler.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/animationFrame.js
/** PURE_IMPORTS_START _AnimationFrameAction,_AnimationFrameScheduler PURE_IMPORTS_END */


var animationFrameScheduler = /*@__PURE__*/ new AnimationFrameScheduler(AnimationFrameAction);
var animationFrame = animationFrameScheduler;
//# sourceMappingURL=animationFrame.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/VirtualTimeScheduler.js
/** PURE_IMPORTS_START tslib,_AsyncAction,_AsyncScheduler PURE_IMPORTS_END */



var VirtualTimeScheduler = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(VirtualTimeScheduler, _super);
    function VirtualTimeScheduler(SchedulerAction, maxFrames) {
        if (SchedulerAction === void 0) {
            SchedulerAction = VirtualAction;
        }
        if (maxFrames === void 0) {
            maxFrames = Number.POSITIVE_INFINITY;
        }
        var _this = _super.call(this, SchedulerAction, function () { return _this.frame; }) || this;
        _this.maxFrames = maxFrames;
        _this.frame = 0;
        _this.index = -1;
        return _this;
    }
    VirtualTimeScheduler.prototype.flush = function () {
        var _a = this, actions = _a.actions, maxFrames = _a.maxFrames;
        var error, action;
        while ((action = actions[0]) && action.delay <= maxFrames) {
            actions.shift();
            this.frame = action.delay;
            if (error = action.execute(action.state, action.delay)) {
                break;
            }
        }
        if (error) {
            while (action = actions.shift()) {
                action.unsubscribe();
            }
            throw error;
        }
    };
    VirtualTimeScheduler.frameTimeFactor = 10;
    return VirtualTimeScheduler;
}(AsyncScheduler/* AsyncScheduler */.v));

var VirtualAction = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(VirtualAction, _super);
    function VirtualAction(scheduler, work, index) {
        if (index === void 0) {
            index = scheduler.index += 1;
        }
        var _this = _super.call(this, scheduler, work) || this;
        _this.scheduler = scheduler;
        _this.work = work;
        _this.index = index;
        _this.active = true;
        _this.index = scheduler.index = index;
        return _this;
    }
    VirtualAction.prototype.schedule = function (state, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if (!this.id) {
            return _super.prototype.schedule.call(this, state, delay);
        }
        this.active = false;
        var action = new VirtualAction(this.scheduler, this.work);
        this.add(action);
        return action.schedule(state, delay);
    };
    VirtualAction.prototype.requestAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        this.delay = scheduler.frame + delay;
        var actions = scheduler.actions;
        actions.push(this);
        actions.sort(VirtualAction.sortActions);
        return true;
    };
    VirtualAction.prototype.recycleAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        return undefined;
    };
    VirtualAction.prototype._execute = function (state, delay) {
        if (this.active === true) {
            return _super.prototype._execute.call(this, state, delay);
        }
    };
    VirtualAction.sortActions = function (a, b) {
        if (a.delay === b.delay) {
            if (a.index === b.index) {
                return 0;
            }
            else if (a.index > b.index) {
                return 1;
            }
            else {
                return -1;
            }
        }
        else if (a.delay > b.delay) {
            return 1;
        }
        else {
            return -1;
        }
    };
    return VirtualAction;
}(AsyncAction/* AsyncAction */.o));

//# sourceMappingURL=VirtualTimeScheduler.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Scheduler.js
var Scheduler = __webpack_require__(8725);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Subscription.js
var Subscription = __webpack_require__(8760);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Subscriber.js
var Subscriber = __webpack_require__(979);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Notification.js
var Notification = __webpack_require__(2632);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/pipe.js
var pipe = __webpack_require__(2561);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/noop.js
var noop = __webpack_require__(3306);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/identity.js
var identity = __webpack_require__(3608);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/util/isObservable.js
/** PURE_IMPORTS_START _Observable PURE_IMPORTS_END */

function isObservable(obj) {
    return !!obj && (obj instanceof Observable/* Observable */.y || (typeof obj.lift === 'function' && typeof obj.subscribe === 'function'));
}
//# sourceMappingURL=isObservable.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/ArgumentOutOfRangeError.js
var ArgumentOutOfRangeError = __webpack_require__(6565);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/EmptyError.js
var EmptyError = __webpack_require__(6929);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/ObjectUnsubscribedError.js
var ObjectUnsubscribedError = __webpack_require__(1016);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/UnsubscriptionError.js
var UnsubscriptionError = __webpack_require__(8782);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/TimeoutError.js
var TimeoutError = __webpack_require__(1462);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/operators/map.js
var map = __webpack_require__(5709);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/canReportError.js
var canReportError = __webpack_require__(3642);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isArray.js
var isArray = __webpack_require__(9026);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isScheduler.js
var isScheduler = __webpack_require__(7507);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/bindCallback.js
/** PURE_IMPORTS_START _Observable,_AsyncSubject,_operators_map,_util_canReportError,_util_isArray,_util_isScheduler PURE_IMPORTS_END */






function bindCallback(callbackFunc, resultSelector, scheduler) {
    if (resultSelector) {
        if ((0,isScheduler/* isScheduler */.K)(resultSelector)) {
            scheduler = resultSelector;
        }
        else {
            return function () {
                var args = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    args[_i] = arguments[_i];
                }
                return bindCallback(callbackFunc, scheduler).apply(void 0, args).pipe((0,map/* map */.U)(function (args) { return (0,isArray/* isArray */.k)(args) ? resultSelector.apply(void 0, args) : resultSelector(args); }));
            };
        }
    }
    return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        var context = this;
        var subject;
        var params = {
            context: context,
            subject: subject,
            callbackFunc: callbackFunc,
            scheduler: scheduler,
        };
        return new Observable/* Observable */.y(function (subscriber) {
            if (!scheduler) {
                if (!subject) {
                    subject = new AsyncSubject/* AsyncSubject */.c();
                    var handler = function () {
                        var innerArgs = [];
                        for (var _i = 0; _i < arguments.length; _i++) {
                            innerArgs[_i] = arguments[_i];
                        }
                        subject.next(innerArgs.length <= 1 ? innerArgs[0] : innerArgs);
                        subject.complete();
                    };
                    try {
                        callbackFunc.apply(context, args.concat([handler]));
                    }
                    catch (err) {
                        if ((0,canReportError/* canReportError */._)(subject)) {
                            subject.error(err);
                        }
                        else {
                            console.warn(err);
                        }
                    }
                }
                return subject.subscribe(subscriber);
            }
            else {
                var state = {
                    args: args, subscriber: subscriber, params: params,
                };
                return scheduler.schedule(dispatch, 0, state);
            }
        });
    };
}
function dispatch(state) {
    var _this = this;
    var self = this;
    var args = state.args, subscriber = state.subscriber, params = state.params;
    var callbackFunc = params.callbackFunc, context = params.context, scheduler = params.scheduler;
    var subject = params.subject;
    if (!subject) {
        subject = params.subject = new AsyncSubject/* AsyncSubject */.c();
        var handler = function () {
            var innerArgs = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                innerArgs[_i] = arguments[_i];
            }
            var value = innerArgs.length <= 1 ? innerArgs[0] : innerArgs;
            _this.add(scheduler.schedule(dispatchNext, 0, { value: value, subject: subject }));
        };
        try {
            callbackFunc.apply(context, args.concat([handler]));
        }
        catch (err) {
            subject.error(err);
        }
    }
    this.add(subject.subscribe(subscriber));
}
function dispatchNext(state) {
    var value = state.value, subject = state.subject;
    subject.next(value);
    subject.complete();
}
function dispatchError(state) {
    var err = state.err, subject = state.subject;
    subject.error(err);
}
//# sourceMappingURL=bindCallback.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/bindNodeCallback.js
/** PURE_IMPORTS_START _Observable,_AsyncSubject,_operators_map,_util_canReportError,_util_isScheduler,_util_isArray PURE_IMPORTS_END */






function bindNodeCallback(callbackFunc, resultSelector, scheduler) {
    if (resultSelector) {
        if ((0,isScheduler/* isScheduler */.K)(resultSelector)) {
            scheduler = resultSelector;
        }
        else {
            return function () {
                var args = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    args[_i] = arguments[_i];
                }
                return bindNodeCallback(callbackFunc, scheduler).apply(void 0, args).pipe((0,map/* map */.U)(function (args) { return (0,isArray/* isArray */.k)(args) ? resultSelector.apply(void 0, args) : resultSelector(args); }));
            };
        }
    }
    return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        var params = {
            subject: undefined,
            args: args,
            callbackFunc: callbackFunc,
            scheduler: scheduler,
            context: this,
        };
        return new Observable/* Observable */.y(function (subscriber) {
            var context = params.context;
            var subject = params.subject;
            if (!scheduler) {
                if (!subject) {
                    subject = params.subject = new AsyncSubject/* AsyncSubject */.c();
                    var handler = function () {
                        var innerArgs = [];
                        for (var _i = 0; _i < arguments.length; _i++) {
                            innerArgs[_i] = arguments[_i];
                        }
                        var err = innerArgs.shift();
                        if (err) {
                            subject.error(err);
                            return;
                        }
                        subject.next(innerArgs.length <= 1 ? innerArgs[0] : innerArgs);
                        subject.complete();
                    };
                    try {
                        callbackFunc.apply(context, args.concat([handler]));
                    }
                    catch (err) {
                        if ((0,canReportError/* canReportError */._)(subject)) {
                            subject.error(err);
                        }
                        else {
                            console.warn(err);
                        }
                    }
                }
                return subject.subscribe(subscriber);
            }
            else {
                return scheduler.schedule(bindNodeCallback_dispatch, 0, { params: params, subscriber: subscriber, context: context });
            }
        });
    };
}
function bindNodeCallback_dispatch(state) {
    var _this = this;
    var params = state.params, subscriber = state.subscriber, context = state.context;
    var callbackFunc = params.callbackFunc, args = params.args, scheduler = params.scheduler;
    var subject = params.subject;
    if (!subject) {
        subject = params.subject = new AsyncSubject/* AsyncSubject */.c();
        var handler = function () {
            var innerArgs = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                innerArgs[_i] = arguments[_i];
            }
            var err = innerArgs.shift();
            if (err) {
                _this.add(scheduler.schedule(bindNodeCallback_dispatchError, 0, { err: err, subject: subject }));
            }
            else {
                var value = innerArgs.length <= 1 ? innerArgs[0] : innerArgs;
                _this.add(scheduler.schedule(bindNodeCallback_dispatchNext, 0, { value: value, subject: subject }));
            }
        };
        try {
            callbackFunc.apply(context, args.concat([handler]));
        }
        catch (err) {
            this.add(scheduler.schedule(bindNodeCallback_dispatchError, 0, { err: err, subject: subject }));
        }
    }
    this.add(subject.subscribe(subscriber));
}
function bindNodeCallback_dispatchNext(arg) {
    var value = arg.value, subject = arg.subject;
    subject.next(value);
    subject.complete();
}
function bindNodeCallback_dispatchError(arg) {
    var err = arg.err, subject = arg.subject;
    subject.error(err);
}
//# sourceMappingURL=bindNodeCallback.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/combineLatest.js
var combineLatest = __webpack_require__(5142);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/concat.js
var concat = __webpack_require__(9795);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/defer.js
var defer = __webpack_require__(1410);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/empty.js
var empty = __webpack_require__(5631);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isObject.js
var isObject = __webpack_require__(2009);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/from.js
var from = __webpack_require__(5760);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/forkJoin.js
/** PURE_IMPORTS_START _Observable,_util_isArray,_operators_map,_util_isObject,_from PURE_IMPORTS_END */





function forkJoin() {
    var sources = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        sources[_i] = arguments[_i];
    }
    if (sources.length === 1) {
        var first_1 = sources[0];
        if ((0,isArray/* isArray */.k)(first_1)) {
            return forkJoinInternal(first_1, null);
        }
        if ((0,isObject/* isObject */.K)(first_1) && Object.getPrototypeOf(first_1) === Object.prototype) {
            var keys = Object.keys(first_1);
            return forkJoinInternal(keys.map(function (key) { return first_1[key]; }), keys);
        }
    }
    if (typeof sources[sources.length - 1] === 'function') {
        var resultSelector_1 = sources.pop();
        sources = (sources.length === 1 && (0,isArray/* isArray */.k)(sources[0])) ? sources[0] : sources;
        return forkJoinInternal(sources, null).pipe((0,map/* map */.U)(function (args) { return resultSelector_1.apply(void 0, args); }));
    }
    return forkJoinInternal(sources, null);
}
function forkJoinInternal(sources, keys) {
    return new Observable/* Observable */.y(function (subscriber) {
        var len = sources.length;
        if (len === 0) {
            subscriber.complete();
            return;
        }
        var values = new Array(len);
        var completed = 0;
        var emitted = 0;
        var _loop_1 = function (i) {
            var source = (0,from/* from */.D)(sources[i]);
            var hasValue = false;
            subscriber.add(source.subscribe({
                next: function (value) {
                    if (!hasValue) {
                        hasValue = true;
                        emitted++;
                    }
                    values[i] = value;
                },
                error: function (err) { return subscriber.error(err); },
                complete: function () {
                    completed++;
                    if (completed === len || !hasValue) {
                        if (emitted === len) {
                            subscriber.next(keys ?
                                keys.reduce(function (result, key, i) { return (result[key] = values[i], result); }, {}) :
                                values);
                        }
                        subscriber.complete();
                    }
                }
            }));
        };
        for (var i = 0; i < len; i++) {
            _loop_1(i);
        }
    });
}
//# sourceMappingURL=forkJoin.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isFunction.js
var isFunction = __webpack_require__(4156);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/fromEvent.js
/** PURE_IMPORTS_START _Observable,_util_isArray,_util_isFunction,_operators_map PURE_IMPORTS_END */




var fromEvent_toString = /*@__PURE__*/ (/* unused pure expression or super */ null && ((function () { return Object.prototype.toString; })()));
function fromEvent(target, eventName, options, resultSelector) {
    if ((0,isFunction/* isFunction */.m)(options)) {
        resultSelector = options;
        options = undefined;
    }
    if (resultSelector) {
        return fromEvent(target, eventName, options).pipe((0,map/* map */.U)(function (args) { return (0,isArray/* isArray */.k)(args) ? resultSelector.apply(void 0, args) : resultSelector(args); }));
    }
    return new Observable/* Observable */.y(function (subscriber) {
        function handler(e) {
            if (arguments.length > 1) {
                subscriber.next(Array.prototype.slice.call(arguments));
            }
            else {
                subscriber.next(e);
            }
        }
        setupSubscription(target, eventName, handler, subscriber, options);
    });
}
function setupSubscription(sourceObj, eventName, handler, subscriber, options) {
    var unsubscribe;
    if (isEventTarget(sourceObj)) {
        var source_1 = sourceObj;
        sourceObj.addEventListener(eventName, handler, options);
        unsubscribe = function () { return source_1.removeEventListener(eventName, handler, options); };
    }
    else if (isJQueryStyleEventEmitter(sourceObj)) {
        var source_2 = sourceObj;
        sourceObj.on(eventName, handler);
        unsubscribe = function () { return source_2.off(eventName, handler); };
    }
    else if (isNodeStyleEventEmitter(sourceObj)) {
        var source_3 = sourceObj;
        sourceObj.addListener(eventName, handler);
        unsubscribe = function () { return source_3.removeListener(eventName, handler); };
    }
    else if (sourceObj && sourceObj.length) {
        for (var i = 0, len = sourceObj.length; i < len; i++) {
            setupSubscription(sourceObj[i], eventName, handler, subscriber, options);
        }
    }
    else {
        throw new TypeError('Invalid event target');
    }
    subscriber.add(unsubscribe);
}
function isNodeStyleEventEmitter(sourceObj) {
    return sourceObj && typeof sourceObj.addListener === 'function' && typeof sourceObj.removeListener === 'function';
}
function isJQueryStyleEventEmitter(sourceObj) {
    return sourceObj && typeof sourceObj.on === 'function' && typeof sourceObj.off === 'function';
}
function isEventTarget(sourceObj) {
    return sourceObj && typeof sourceObj.addEventListener === 'function' && typeof sourceObj.removeEventListener === 'function';
}
//# sourceMappingURL=fromEvent.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/fromEventPattern.js
/** PURE_IMPORTS_START _Observable,_util_isArray,_util_isFunction,_operators_map PURE_IMPORTS_END */




function fromEventPattern(addHandler, removeHandler, resultSelector) {
    if (resultSelector) {
        return fromEventPattern(addHandler, removeHandler).pipe((0,map/* map */.U)(function (args) { return (0,isArray/* isArray */.k)(args) ? resultSelector.apply(void 0, args) : resultSelector(args); }));
    }
    return new Observable/* Observable */.y(function (subscriber) {
        var handler = function () {
            var e = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                e[_i] = arguments[_i];
            }
            return subscriber.next(e.length === 1 ? e[0] : e);
        };
        var retValue;
        try {
            retValue = addHandler(handler);
        }
        catch (err) {
            subscriber.error(err);
            return undefined;
        }
        if (!(0,isFunction/* isFunction */.m)(removeHandler)) {
            return undefined;
        }
        return function () { return removeHandler(handler, retValue); };
    });
}
//# sourceMappingURL=fromEventPattern.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/generate.js
/** PURE_IMPORTS_START _Observable,_util_identity,_util_isScheduler PURE_IMPORTS_END */



function generate(initialStateOrOptions, condition, iterate, resultSelectorOrObservable, scheduler) {
    var resultSelector;
    var initialState;
    if (arguments.length == 1) {
        var options = initialStateOrOptions;
        initialState = options.initialState;
        condition = options.condition;
        iterate = options.iterate;
        resultSelector = options.resultSelector || identity/* identity */.y;
        scheduler = options.scheduler;
    }
    else if (resultSelectorOrObservable === undefined || (0,isScheduler/* isScheduler */.K)(resultSelectorOrObservable)) {
        initialState = initialStateOrOptions;
        resultSelector = identity/* identity */.y;
        scheduler = resultSelectorOrObservable;
    }
    else {
        initialState = initialStateOrOptions;
        resultSelector = resultSelectorOrObservable;
    }
    return new Observable/* Observable */.y(function (subscriber) {
        var state = initialState;
        if (scheduler) {
            return scheduler.schedule(generate_dispatch, 0, {
                subscriber: subscriber,
                iterate: iterate,
                condition: condition,
                resultSelector: resultSelector,
                state: state
            });
        }
        do {
            if (condition) {
                var conditionResult = void 0;
                try {
                    conditionResult = condition(state);
                }
                catch (err) {
                    subscriber.error(err);
                    return undefined;
                }
                if (!conditionResult) {
                    subscriber.complete();
                    break;
                }
            }
            var value = void 0;
            try {
                value = resultSelector(state);
            }
            catch (err) {
                subscriber.error(err);
                return undefined;
            }
            subscriber.next(value);
            if (subscriber.closed) {
                break;
            }
            try {
                state = iterate(state);
            }
            catch (err) {
                subscriber.error(err);
                return undefined;
            }
        } while (true);
        return undefined;
    });
}
function generate_dispatch(state) {
    var subscriber = state.subscriber, condition = state.condition;
    if (subscriber.closed) {
        return undefined;
    }
    if (state.needIterate) {
        try {
            state.state = state.iterate(state.state);
        }
        catch (err) {
            subscriber.error(err);
            return undefined;
        }
    }
    else {
        state.needIterate = true;
    }
    if (condition) {
        var conditionResult = void 0;
        try {
            conditionResult = condition(state.state);
        }
        catch (err) {
            subscriber.error(err);
            return undefined;
        }
        if (!conditionResult) {
            subscriber.complete();
            return undefined;
        }
        if (subscriber.closed) {
            return undefined;
        }
    }
    var value;
    try {
        value = state.resultSelector(state.state);
    }
    catch (err) {
        subscriber.error(err);
        return undefined;
    }
    if (subscriber.closed) {
        return undefined;
    }
    subscriber.next(value);
    if (subscriber.closed) {
        return undefined;
    }
    return this.schedule(state);
}
//# sourceMappingURL=generate.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/iif.js
/** PURE_IMPORTS_START _defer,_empty PURE_IMPORTS_END */


function iif(condition, trueResult, falseResult) {
    if (trueResult === void 0) {
        trueResult = empty/* EMPTY */.E;
    }
    if (falseResult === void 0) {
        falseResult = empty/* EMPTY */.E;
    }
    return (0,defer/* defer */.P)(function () { return condition() ? trueResult : falseResult; });
}
//# sourceMappingURL=iif.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isNumeric.js
var isNumeric = __webpack_require__(5812);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/interval.js
/** PURE_IMPORTS_START _Observable,_scheduler_async,_util_isNumeric PURE_IMPORTS_END */



function interval(period, scheduler) {
    if (period === void 0) {
        period = 0;
    }
    if (scheduler === void 0) {
        scheduler = scheduler_async/* async */.P;
    }
    if (!(0,isNumeric/* isNumeric */.k)(period) || period < 0) {
        period = 0;
    }
    if (!scheduler || typeof scheduler.schedule !== 'function') {
        scheduler = scheduler_async/* async */.P;
    }
    return new Observable/* Observable */.y(function (subscriber) {
        subscriber.add(scheduler.schedule(interval_dispatch, period, { subscriber: subscriber, counter: 0, period: period }));
        return subscriber;
    });
}
function interval_dispatch(state) {
    var subscriber = state.subscriber, counter = state.counter, period = state.period;
    subscriber.next(counter);
    this.schedule({ subscriber: subscriber, counter: counter + 1, period: period }, period);
}
//# sourceMappingURL=interval.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/merge.js
var merge = __webpack_require__(4370);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/never.js
/** PURE_IMPORTS_START _Observable,_util_noop PURE_IMPORTS_END */


var NEVER = /*@__PURE__*/ new Observable/* Observable */.y(noop/* noop */.Z);
function never() {
    return NEVER;
}
//# sourceMappingURL=never.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/of.js
var of = __webpack_require__(8170);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/onErrorResumeNext.js
/** PURE_IMPORTS_START _Observable,_from,_util_isArray,_empty PURE_IMPORTS_END */




function onErrorResumeNext() {
    var sources = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        sources[_i] = arguments[_i];
    }
    if (sources.length === 0) {
        return empty/* EMPTY */.E;
    }
    var first = sources[0], remainder = sources.slice(1);
    if (sources.length === 1 && (0,isArray/* isArray */.k)(first)) {
        return onErrorResumeNext.apply(void 0, first);
    }
    return new Observable/* Observable */.y(function (subscriber) {
        var subNext = function () { return subscriber.add(onErrorResumeNext.apply(void 0, remainder).subscribe(subscriber)); };
        return (0,from/* from */.D)(first).subscribe({
            next: function (value) { subscriber.next(value); },
            error: subNext,
            complete: subNext,
        });
    });
}
//# sourceMappingURL=onErrorResumeNext.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/pairs.js
/** PURE_IMPORTS_START _Observable,_Subscription PURE_IMPORTS_END */


function pairs(obj, scheduler) {
    if (!scheduler) {
        return new Observable/* Observable */.y(function (subscriber) {
            var keys = Object.keys(obj);
            for (var i = 0; i < keys.length && !subscriber.closed; i++) {
                var key = keys[i];
                if (obj.hasOwnProperty(key)) {
                    subscriber.next([key, obj[key]]);
                }
            }
            subscriber.complete();
        });
    }
    else {
        return new Observable/* Observable */.y(function (subscriber) {
            var keys = Object.keys(obj);
            var subscription = new Subscription/* Subscription */.w();
            subscription.add(scheduler.schedule(pairs_dispatch, 0, { keys: keys, index: 0, subscriber: subscriber, subscription: subscription, obj: obj }));
            return subscription;
        });
    }
}
function pairs_dispatch(state) {
    var keys = state.keys, index = state.index, subscriber = state.subscriber, subscription = state.subscription, obj = state.obj;
    if (!subscriber.closed) {
        if (index < keys.length) {
            var key = keys[index];
            subscriber.next([key, obj[key]]);
            subscription.add(this.schedule({ keys: keys, index: index + 1, subscriber: subscriber, subscription: subscription, obj: obj }));
        }
        else {
            subscriber.complete();
        }
    }
}
//# sourceMappingURL=pairs.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/not.js
var not = __webpack_require__(8463);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/subscribeTo.js + 3 modules
var subscribeTo = __webpack_require__(7843);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/operators/filter.js
var filter = __webpack_require__(6008);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/partition.js
/** PURE_IMPORTS_START _util_not,_util_subscribeTo,_operators_filter,_Observable PURE_IMPORTS_END */




function partition(source, predicate, thisArg) {
    return [
        (0,filter/* filter */.h)(predicate, thisArg)(new Observable/* Observable */.y((0,subscribeTo/* subscribeTo */.s)(source))),
        (0,filter/* filter */.h)((0,not/* not */.f)(predicate, thisArg))(new Observable/* Observable */.y((0,subscribeTo/* subscribeTo */.s)(source)))
    ];
}
//# sourceMappingURL=partition.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/race.js
var race = __webpack_require__(8821);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/range.js
/** PURE_IMPORTS_START _Observable PURE_IMPORTS_END */

function range(start, count, scheduler) {
    if (start === void 0) {
        start = 0;
    }
    return new Observable/* Observable */.y(function (subscriber) {
        if (count === undefined) {
            count = start;
            start = 0;
        }
        var index = 0;
        var current = start;
        if (scheduler) {
            return scheduler.schedule(range_dispatch, 0, {
                index: index, count: count, start: start, subscriber: subscriber
            });
        }
        else {
            do {
                if (index++ >= count) {
                    subscriber.complete();
                    break;
                }
                subscriber.next(current++);
                if (subscriber.closed) {
                    break;
                }
            } while (true);
        }
        return undefined;
    });
}
function range_dispatch(state) {
    var start = state.start, index = state.index, count = state.count, subscriber = state.subscriber;
    if (index >= count) {
        subscriber.complete();
        return;
    }
    subscriber.next(start);
    if (subscriber.closed) {
        return;
    }
    state.index = index + 1;
    state.start = start + 1;
    this.schedule(state);
}
//# sourceMappingURL=range.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/throwError.js
var throwError = __webpack_require__(4944);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/timer.js
var timer = __webpack_require__(9604);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/using.js
/** PURE_IMPORTS_START _Observable,_from,_empty PURE_IMPORTS_END */



function using(resourceFactory, observableFactory) {
    return new Observable/* Observable */.y(function (subscriber) {
        var resource;
        try {
            resource = resourceFactory();
        }
        catch (err) {
            subscriber.error(err);
            return undefined;
        }
        var result;
        try {
            result = observableFactory(resource);
        }
        catch (err) {
            subscriber.error(err);
            return undefined;
        }
        var source = result ? (0,from/* from */.D)(result) : empty/* EMPTY */.E;
        var subscription = source.subscribe(subscriber);
        return function () {
            subscription.unsubscribe();
            if (resource) {
                resource.unsubscribe();
            }
        };
    });
}
//# sourceMappingURL=using.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/zip.js
var zip = __webpack_require__(5080);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduled/scheduled.js + 5 modules
var scheduled = __webpack_require__(8107);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/config.js
var config = __webpack_require__(150);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/index.js
/** PURE_IMPORTS_START  PURE_IMPORTS_END */























































//# sourceMappingURL=index.js.map


/***/ }),

/***/ 364:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "c": () => (/* binding */ AsyncSubject)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Subject__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(211);
/* harmony import */ var _Subscription__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(8760);
/** PURE_IMPORTS_START tslib,_Subject,_Subscription PURE_IMPORTS_END */



var AsyncSubject = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(AsyncSubject, _super);
    function AsyncSubject() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.value = null;
        _this.hasNext = false;
        _this.hasCompleted = false;
        return _this;
    }
    AsyncSubject.prototype._subscribe = function (subscriber) {
        if (this.hasError) {
            subscriber.error(this.thrownError);
            return _Subscription__WEBPACK_IMPORTED_MODULE_1__/* .Subscription.EMPTY */ .w.EMPTY;
        }
        else if (this.hasCompleted && this.hasNext) {
            subscriber.next(this.value);
            subscriber.complete();
            return _Subscription__WEBPACK_IMPORTED_MODULE_1__/* .Subscription.EMPTY */ .w.EMPTY;
        }
        return _super.prototype._subscribe.call(this, subscriber);
    };
    AsyncSubject.prototype.next = function (value) {
        if (!this.hasCompleted) {
            this.value = value;
            this.hasNext = true;
        }
    };
    AsyncSubject.prototype.error = function (error) {
        if (!this.hasCompleted) {
            _super.prototype.error.call(this, error);
        }
    };
    AsyncSubject.prototype.complete = function () {
        this.hasCompleted = true;
        if (this.hasNext) {
            _super.prototype.next.call(this, this.value);
        }
        _super.prototype.complete.call(this);
    };
    return AsyncSubject;
}(_Subject__WEBPACK_IMPORTED_MODULE_2__/* .Subject */ .xQ));

//# sourceMappingURL=AsyncSubject.js.map


/***/ }),

/***/ 9233:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "X": () => (/* binding */ BehaviorSubject)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Subject__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(211);
/* harmony import */ var _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(1016);
/** PURE_IMPORTS_START tslib,_Subject,_util_ObjectUnsubscribedError PURE_IMPORTS_END */



var BehaviorSubject = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(BehaviorSubject, _super);
    function BehaviorSubject(_value) {
        var _this = _super.call(this) || this;
        _this._value = _value;
        return _this;
    }
    Object.defineProperty(BehaviorSubject.prototype, "value", {
        get: function () {
            return this.getValue();
        },
        enumerable: true,
        configurable: true
    });
    BehaviorSubject.prototype._subscribe = function (subscriber) {
        var subscription = _super.prototype._subscribe.call(this, subscriber);
        if (subscription && !subscription.closed) {
            subscriber.next(this._value);
        }
        return subscription;
    };
    BehaviorSubject.prototype.getValue = function () {
        if (this.hasError) {
            throw this.thrownError;
        }
        else if (this.closed) {
            throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_1__/* .ObjectUnsubscribedError */ .N();
        }
        else {
            return this._value;
        }
    };
    BehaviorSubject.prototype.next = function (value) {
        _super.prototype.next.call(this, this._value = value);
    };
    return BehaviorSubject;
}(_Subject__WEBPACK_IMPORTED_MODULE_2__/* .Subject */ .xQ));

//# sourceMappingURL=BehaviorSubject.js.map


/***/ }),

/***/ 2632:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "W": () => (/* binding */ NotificationKind),
/* harmony export */   "P": () => (/* binding */ Notification)
/* harmony export */ });
/* harmony import */ var _observable_empty__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(5631);
/* harmony import */ var _observable_of__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(8170);
/* harmony import */ var _observable_throwError__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(4944);
/** PURE_IMPORTS_START _observable_empty,_observable_of,_observable_throwError PURE_IMPORTS_END */



var NotificationKind;
/*@__PURE__*/ (function (NotificationKind) {
    NotificationKind["NEXT"] = "N";
    NotificationKind["ERROR"] = "E";
    NotificationKind["COMPLETE"] = "C";
})(NotificationKind || (NotificationKind = {}));
var Notification = /*@__PURE__*/ (function () {
    function Notification(kind, value, error) {
        this.kind = kind;
        this.value = value;
        this.error = error;
        this.hasValue = kind === 'N';
    }
    Notification.prototype.observe = function (observer) {
        switch (this.kind) {
            case 'N':
                return observer.next && observer.next(this.value);
            case 'E':
                return observer.error && observer.error(this.error);
            case 'C':
                return observer.complete && observer.complete();
        }
    };
    Notification.prototype.do = function (next, error, complete) {
        var kind = this.kind;
        switch (kind) {
            case 'N':
                return next && next(this.value);
            case 'E':
                return error && error(this.error);
            case 'C':
                return complete && complete();
        }
    };
    Notification.prototype.accept = function (nextOrObserver, error, complete) {
        if (nextOrObserver && typeof nextOrObserver.next === 'function') {
            return this.observe(nextOrObserver);
        }
        else {
            return this.do(nextOrObserver, error, complete);
        }
    };
    Notification.prototype.toObservable = function () {
        var kind = this.kind;
        switch (kind) {
            case 'N':
                return (0,_observable_of__WEBPACK_IMPORTED_MODULE_0__.of)(this.value);
            case 'E':
                return (0,_observable_throwError__WEBPACK_IMPORTED_MODULE_1__/* .throwError */ ._)(this.error);
            case 'C':
                return (0,_observable_empty__WEBPACK_IMPORTED_MODULE_2__/* .empty */ .c)();
        }
        throw new Error('unexpected notification kind value');
    };
    Notification.createNext = function (value) {
        if (typeof value !== 'undefined') {
            return new Notification('N', value);
        }
        return Notification.undefinedValueNotification;
    };
    Notification.createError = function (err) {
        return new Notification('E', undefined, err);
    };
    Notification.createComplete = function () {
        return Notification.completeNotification;
    };
    Notification.completeNotification = new Notification('C');
    Notification.undefinedValueNotification = new Notification('N', undefined);
    return Notification;
}());

//# sourceMappingURL=Notification.js.map


/***/ }),

/***/ 2772:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "y": () => (/* binding */ Observable)
});

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/canReportError.js
var canReportError = __webpack_require__(3642);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Subscriber.js
var Subscriber = __webpack_require__(979);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/symbol/rxSubscriber.js
var rxSubscriber = __webpack_require__(3142);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Observer.js
var Observer = __webpack_require__(2174);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/util/toSubscriber.js
/** PURE_IMPORTS_START _Subscriber,_symbol_rxSubscriber,_Observer PURE_IMPORTS_END */



function toSubscriber(nextOrObserver, error, complete) {
    if (nextOrObserver) {
        if (nextOrObserver instanceof Subscriber/* Subscriber */.L) {
            return nextOrObserver;
        }
        if (nextOrObserver[rxSubscriber/* rxSubscriber */.b]) {
            return nextOrObserver[rxSubscriber/* rxSubscriber */.b]();
        }
    }
    if (!nextOrObserver && !error && !complete) {
        return new Subscriber/* Subscriber */.L(Observer/* empty */.c);
    }
    return new Subscriber/* Subscriber */.L(nextOrObserver, error, complete);
}
//# sourceMappingURL=toSubscriber.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/symbol/observable.js
var observable = __webpack_require__(5050);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/pipe.js
var pipe = __webpack_require__(2561);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/config.js
var config = __webpack_require__(150);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/Observable.js
/** PURE_IMPORTS_START _util_canReportError,_util_toSubscriber,_symbol_observable,_util_pipe,_config PURE_IMPORTS_END */





var Observable = /*@__PURE__*/ (function () {
    function Observable(subscribe) {
        this._isScalar = false;
        if (subscribe) {
            this._subscribe = subscribe;
        }
    }
    Observable.prototype.lift = function (operator) {
        var observable = new Observable();
        observable.source = this;
        observable.operator = operator;
        return observable;
    };
    Observable.prototype.subscribe = function (observerOrNext, error, complete) {
        var operator = this.operator;
        var sink = toSubscriber(observerOrNext, error, complete);
        if (operator) {
            sink.add(operator.call(sink, this.source));
        }
        else {
            sink.add(this.source || (config/* config.useDeprecatedSynchronousErrorHandling */.v.useDeprecatedSynchronousErrorHandling && !sink.syncErrorThrowable) ?
                this._subscribe(sink) :
                this._trySubscribe(sink));
        }
        if (config/* config.useDeprecatedSynchronousErrorHandling */.v.useDeprecatedSynchronousErrorHandling) {
            if (sink.syncErrorThrowable) {
                sink.syncErrorThrowable = false;
                if (sink.syncErrorThrown) {
                    throw sink.syncErrorValue;
                }
            }
        }
        return sink;
    };
    Observable.prototype._trySubscribe = function (sink) {
        try {
            return this._subscribe(sink);
        }
        catch (err) {
            if (config/* config.useDeprecatedSynchronousErrorHandling */.v.useDeprecatedSynchronousErrorHandling) {
                sink.syncErrorThrown = true;
                sink.syncErrorValue = err;
            }
            if ((0,canReportError/* canReportError */._)(sink)) {
                sink.error(err);
            }
            else {
                console.warn(err);
            }
        }
    };
    Observable.prototype.forEach = function (next, promiseCtor) {
        var _this = this;
        promiseCtor = getPromiseCtor(promiseCtor);
        return new promiseCtor(function (resolve, reject) {
            var subscription;
            subscription = _this.subscribe(function (value) {
                try {
                    next(value);
                }
                catch (err) {
                    reject(err);
                    if (subscription) {
                        subscription.unsubscribe();
                    }
                }
            }, reject, resolve);
        });
    };
    Observable.prototype._subscribe = function (subscriber) {
        var source = this.source;
        return source && source.subscribe(subscriber);
    };
    Observable.prototype[observable/* observable */.L] = function () {
        return this;
    };
    Observable.prototype.pipe = function () {
        var operations = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            operations[_i] = arguments[_i];
        }
        if (operations.length === 0) {
            return this;
        }
        return (0,pipe/* pipeFromArray */.U)(operations)(this);
    };
    Observable.prototype.toPromise = function (promiseCtor) {
        var _this = this;
        promiseCtor = getPromiseCtor(promiseCtor);
        return new promiseCtor(function (resolve, reject) {
            var value;
            _this.subscribe(function (x) { return value = x; }, function (err) { return reject(err); }, function () { return resolve(value); });
        });
    };
    Observable.create = function (subscribe) {
        return new Observable(subscribe);
    };
    return Observable;
}());

function getPromiseCtor(promiseCtor) {
    if (!promiseCtor) {
        promiseCtor = config/* config.Promise */.v.Promise || Promise;
    }
    if (!promiseCtor) {
        throw new Error('no Promise impl found');
    }
    return promiseCtor;
}
//# sourceMappingURL=Observable.js.map


/***/ }),

/***/ 2174:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "c": () => (/* binding */ empty)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(150);
/* harmony import */ var _util_hostReportError__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(1644);
/** PURE_IMPORTS_START _config,_util_hostReportError PURE_IMPORTS_END */


var empty = {
    closed: true,
    next: function (value) { },
    error: function (err) {
        if (_config__WEBPACK_IMPORTED_MODULE_0__/* .config.useDeprecatedSynchronousErrorHandling */ .v.useDeprecatedSynchronousErrorHandling) {
            throw err;
        }
        else {
            (0,_util_hostReportError__WEBPACK_IMPORTED_MODULE_1__/* .hostReportError */ .z)(err);
        }
    },
    complete: function () { }
};
//# sourceMappingURL=Observer.js.map


/***/ }),

/***/ 2039:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "L": () => (/* binding */ OuterSubscriber)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Subscriber__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(979);
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


var OuterSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(OuterSubscriber, _super);
    function OuterSubscriber() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    OuterSubscriber.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {
        this.destination.next(innerValue);
    };
    OuterSubscriber.prototype.notifyError = function (error, innerSub) {
        this.destination.error(error);
    };
    OuterSubscriber.prototype.notifyComplete = function (innerSub) {
        this.destination.complete();
    };
    return OuterSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_1__/* .Subscriber */ .L));

//# sourceMappingURL=OuterSubscriber.js.map


/***/ }),

/***/ 2630:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "t": () => (/* binding */ ReplaySubject)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Subject__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(211);
/* harmony import */ var _scheduler_queue__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(2546);
/* harmony import */ var _Subscription__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(8760);
/* harmony import */ var _operators_observeOn__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(9276);
/* harmony import */ var _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(1016);
/* harmony import */ var _SubjectSubscription__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(8253);
/** PURE_IMPORTS_START tslib,_Subject,_scheduler_queue,_Subscription,_operators_observeOn,_util_ObjectUnsubscribedError,_SubjectSubscription PURE_IMPORTS_END */







var ReplaySubject = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(ReplaySubject, _super);
    function ReplaySubject(bufferSize, windowTime, scheduler) {
        if (bufferSize === void 0) {
            bufferSize = Number.POSITIVE_INFINITY;
        }
        if (windowTime === void 0) {
            windowTime = Number.POSITIVE_INFINITY;
        }
        var _this = _super.call(this) || this;
        _this.scheduler = scheduler;
        _this._events = [];
        _this._infiniteTimeWindow = false;
        _this._bufferSize = bufferSize < 1 ? 1 : bufferSize;
        _this._windowTime = windowTime < 1 ? 1 : windowTime;
        if (windowTime === Number.POSITIVE_INFINITY) {
            _this._infiniteTimeWindow = true;
            _this.next = _this.nextInfiniteTimeWindow;
        }
        else {
            _this.next = _this.nextTimeWindow;
        }
        return _this;
    }
    ReplaySubject.prototype.nextInfiniteTimeWindow = function (value) {
        if (!this.isStopped) {
            var _events = this._events;
            _events.push(value);
            if (_events.length > this._bufferSize) {
                _events.shift();
            }
        }
        _super.prototype.next.call(this, value);
    };
    ReplaySubject.prototype.nextTimeWindow = function (value) {
        if (!this.isStopped) {
            this._events.push(new ReplayEvent(this._getNow(), value));
            this._trimBufferThenGetEvents();
        }
        _super.prototype.next.call(this, value);
    };
    ReplaySubject.prototype._subscribe = function (subscriber) {
        var _infiniteTimeWindow = this._infiniteTimeWindow;
        var _events = _infiniteTimeWindow ? this._events : this._trimBufferThenGetEvents();
        var scheduler = this.scheduler;
        var len = _events.length;
        var subscription;
        if (this.closed) {
            throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_1__/* .ObjectUnsubscribedError */ .N();
        }
        else if (this.isStopped || this.hasError) {
            subscription = _Subscription__WEBPACK_IMPORTED_MODULE_2__/* .Subscription.EMPTY */ .w.EMPTY;
        }
        else {
            this.observers.push(subscriber);
            subscription = new _SubjectSubscription__WEBPACK_IMPORTED_MODULE_3__/* .SubjectSubscription */ .W(this, subscriber);
        }
        if (scheduler) {
            subscriber.add(subscriber = new _operators_observeOn__WEBPACK_IMPORTED_MODULE_4__/* .ObserveOnSubscriber */ .ht(subscriber, scheduler));
        }
        if (_infiniteTimeWindow) {
            for (var i = 0; i < len && !subscriber.closed; i++) {
                subscriber.next(_events[i]);
            }
        }
        else {
            for (var i = 0; i < len && !subscriber.closed; i++) {
                subscriber.next(_events[i].value);
            }
        }
        if (this.hasError) {
            subscriber.error(this.thrownError);
        }
        else if (this.isStopped) {
            subscriber.complete();
        }
        return subscription;
    };
    ReplaySubject.prototype._getNow = function () {
        return (this.scheduler || _scheduler_queue__WEBPACK_IMPORTED_MODULE_5__/* .queue */ .c).now();
    };
    ReplaySubject.prototype._trimBufferThenGetEvents = function () {
        var now = this._getNow();
        var _bufferSize = this._bufferSize;
        var _windowTime = this._windowTime;
        var _events = this._events;
        var eventsCount = _events.length;
        var spliceCount = 0;
        while (spliceCount < eventsCount) {
            if ((now - _events[spliceCount].time) < _windowTime) {
                break;
            }
            spliceCount++;
        }
        if (eventsCount > _bufferSize) {
            spliceCount = Math.max(spliceCount, eventsCount - _bufferSize);
        }
        if (spliceCount > 0) {
            _events.splice(0, spliceCount);
        }
        return _events;
    };
    return ReplaySubject;
}(_Subject__WEBPACK_IMPORTED_MODULE_6__/* .Subject */ .xQ));

var ReplayEvent = /*@__PURE__*/ (function () {
    function ReplayEvent(time, value) {
        this.time = time;
        this.value = value;
    }
    return ReplayEvent;
}());
//# sourceMappingURL=ReplaySubject.js.map


/***/ }),

/***/ 8725:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "b": () => (/* binding */ Scheduler)
/* harmony export */ });
var Scheduler = /*@__PURE__*/ (function () {
    function Scheduler(SchedulerAction, now) {
        if (now === void 0) {
            now = Scheduler.now;
        }
        this.SchedulerAction = SchedulerAction;
        this.now = now;
    }
    Scheduler.prototype.schedule = function (work, delay, state) {
        if (delay === void 0) {
            delay = 0;
        }
        return new this.SchedulerAction(this, work).schedule(state, delay);
    };
    Scheduler.now = function () { return Date.now(); };
    return Scheduler;
}());

//# sourceMappingURL=Scheduler.js.map


/***/ }),

/***/ 211:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Yc": () => (/* binding */ SubjectSubscriber),
/* harmony export */   "xQ": () => (/* binding */ Subject)
/* harmony export */ });
/* unused harmony export AnonymousSubject */
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(2772);
/* harmony import */ var _Subscriber__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(979);
/* harmony import */ var _Subscription__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(8760);
/* harmony import */ var _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(1016);
/* harmony import */ var _SubjectSubscription__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(8253);
/* harmony import */ var _internal_symbol_rxSubscriber__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(3142);
/** PURE_IMPORTS_START tslib,_Observable,_Subscriber,_Subscription,_util_ObjectUnsubscribedError,_SubjectSubscription,_internal_symbol_rxSubscriber PURE_IMPORTS_END */







var SubjectSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(SubjectSubscriber, _super);
    function SubjectSubscriber(destination) {
        var _this = _super.call(this, destination) || this;
        _this.destination = destination;
        return _this;
    }
    return SubjectSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_1__/* .Subscriber */ .L));

var Subject = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(Subject, _super);
    function Subject() {
        var _this = _super.call(this) || this;
        _this.observers = [];
        _this.closed = false;
        _this.isStopped = false;
        _this.hasError = false;
        _this.thrownError = null;
        return _this;
    }
    Subject.prototype[_internal_symbol_rxSubscriber__WEBPACK_IMPORTED_MODULE_2__/* .rxSubscriber */ .b] = function () {
        return new SubjectSubscriber(this);
    };
    Subject.prototype.lift = function (operator) {
        var subject = new AnonymousSubject(this, this);
        subject.operator = operator;
        return subject;
    };
    Subject.prototype.next = function (value) {
        if (this.closed) {
            throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_3__/* .ObjectUnsubscribedError */ .N();
        }
        if (!this.isStopped) {
            var observers = this.observers;
            var len = observers.length;
            var copy = observers.slice();
            for (var i = 0; i < len; i++) {
                copy[i].next(value);
            }
        }
    };
    Subject.prototype.error = function (err) {
        if (this.closed) {
            throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_3__/* .ObjectUnsubscribedError */ .N();
        }
        this.hasError = true;
        this.thrownError = err;
        this.isStopped = true;
        var observers = this.observers;
        var len = observers.length;
        var copy = observers.slice();
        for (var i = 0; i < len; i++) {
            copy[i].error(err);
        }
        this.observers.length = 0;
    };
    Subject.prototype.complete = function () {
        if (this.closed) {
            throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_3__/* .ObjectUnsubscribedError */ .N();
        }
        this.isStopped = true;
        var observers = this.observers;
        var len = observers.length;
        var copy = observers.slice();
        for (var i = 0; i < len; i++) {
            copy[i].complete();
        }
        this.observers.length = 0;
    };
    Subject.prototype.unsubscribe = function () {
        this.isStopped = true;
        this.closed = true;
        this.observers = null;
    };
    Subject.prototype._trySubscribe = function (subscriber) {
        if (this.closed) {
            throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_3__/* .ObjectUnsubscribedError */ .N();
        }
        else {
            return _super.prototype._trySubscribe.call(this, subscriber);
        }
    };
    Subject.prototype._subscribe = function (subscriber) {
        if (this.closed) {
            throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_3__/* .ObjectUnsubscribedError */ .N();
        }
        else if (this.hasError) {
            subscriber.error(this.thrownError);
            return _Subscription__WEBPACK_IMPORTED_MODULE_4__/* .Subscription.EMPTY */ .w.EMPTY;
        }
        else if (this.isStopped) {
            subscriber.complete();
            return _Subscription__WEBPACK_IMPORTED_MODULE_4__/* .Subscription.EMPTY */ .w.EMPTY;
        }
        else {
            this.observers.push(subscriber);
            return new _SubjectSubscription__WEBPACK_IMPORTED_MODULE_5__/* .SubjectSubscription */ .W(this, subscriber);
        }
    };
    Subject.prototype.asObservable = function () {
        var observable = new _Observable__WEBPACK_IMPORTED_MODULE_6__/* .Observable */ .y();
        observable.source = this;
        return observable;
    };
    Subject.create = function (destination, source) {
        return new AnonymousSubject(destination, source);
    };
    return Subject;
}(_Observable__WEBPACK_IMPORTED_MODULE_6__/* .Observable */ .y));

var AnonymousSubject = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(AnonymousSubject, _super);
    function AnonymousSubject(destination, source) {
        var _this = _super.call(this) || this;
        _this.destination = destination;
        _this.source = source;
        return _this;
    }
    AnonymousSubject.prototype.next = function (value) {
        var destination = this.destination;
        if (destination && destination.next) {
            destination.next(value);
        }
    };
    AnonymousSubject.prototype.error = function (err) {
        var destination = this.destination;
        if (destination && destination.error) {
            this.destination.error(err);
        }
    };
    AnonymousSubject.prototype.complete = function () {
        var destination = this.destination;
        if (destination && destination.complete) {
            this.destination.complete();
        }
    };
    AnonymousSubject.prototype._subscribe = function (subscriber) {
        var source = this.source;
        if (source) {
            return this.source.subscribe(subscriber);
        }
        else {
            return _Subscription__WEBPACK_IMPORTED_MODULE_4__/* .Subscription.EMPTY */ .w.EMPTY;
        }
    };
    return AnonymousSubject;
}(Subject));

//# sourceMappingURL=Subject.js.map


/***/ }),

/***/ 8253:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "W": () => (/* binding */ SubjectSubscription)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Subscription__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(8760);
/** PURE_IMPORTS_START tslib,_Subscription PURE_IMPORTS_END */


var SubjectSubscription = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(SubjectSubscription, _super);
    function SubjectSubscription(subject, subscriber) {
        var _this = _super.call(this) || this;
        _this.subject = subject;
        _this.subscriber = subscriber;
        _this.closed = false;
        return _this;
    }
    SubjectSubscription.prototype.unsubscribe = function () {
        if (this.closed) {
            return;
        }
        this.closed = true;
        var subject = this.subject;
        var observers = subject.observers;
        this.subject = null;
        if (!observers || observers.length === 0 || subject.isStopped || subject.closed) {
            return;
        }
        var subscriberIndex = observers.indexOf(this.subscriber);
        if (subscriberIndex !== -1) {
            observers.splice(subscriberIndex, 1);
        }
    };
    return SubjectSubscription;
}(_Subscription__WEBPACK_IMPORTED_MODULE_1__/* .Subscription */ .w));

//# sourceMappingURL=SubjectSubscription.js.map


/***/ }),

/***/ 979:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "L": () => (/* binding */ Subscriber)
/* harmony export */ });
/* unused harmony export SafeSubscriber */
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _util_isFunction__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(4156);
/* harmony import */ var _Observer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(2174);
/* harmony import */ var _Subscription__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(8760);
/* harmony import */ var _internal_symbol_rxSubscriber__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(3142);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(150);
/* harmony import */ var _util_hostReportError__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(1644);
/** PURE_IMPORTS_START tslib,_util_isFunction,_Observer,_Subscription,_internal_symbol_rxSubscriber,_config,_util_hostReportError PURE_IMPORTS_END */







var Subscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(Subscriber, _super);
    function Subscriber(destinationOrNext, error, complete) {
        var _this = _super.call(this) || this;
        _this.syncErrorValue = null;
        _this.syncErrorThrown = false;
        _this.syncErrorThrowable = false;
        _this.isStopped = false;
        switch (arguments.length) {
            case 0:
                _this.destination = _Observer__WEBPACK_IMPORTED_MODULE_1__/* .empty */ .c;
                break;
            case 1:
                if (!destinationOrNext) {
                    _this.destination = _Observer__WEBPACK_IMPORTED_MODULE_1__/* .empty */ .c;
                    break;
                }
                if (typeof destinationOrNext === 'object') {
                    if (destinationOrNext instanceof Subscriber) {
                        _this.syncErrorThrowable = destinationOrNext.syncErrorThrowable;
                        _this.destination = destinationOrNext;
                        destinationOrNext.add(_this);
                    }
                    else {
                        _this.syncErrorThrowable = true;
                        _this.destination = new SafeSubscriber(_this, destinationOrNext);
                    }
                    break;
                }
            default:
                _this.syncErrorThrowable = true;
                _this.destination = new SafeSubscriber(_this, destinationOrNext, error, complete);
                break;
        }
        return _this;
    }
    Subscriber.prototype[_internal_symbol_rxSubscriber__WEBPACK_IMPORTED_MODULE_2__/* .rxSubscriber */ .b] = function () { return this; };
    Subscriber.create = function (next, error, complete) {
        var subscriber = new Subscriber(next, error, complete);
        subscriber.syncErrorThrowable = false;
        return subscriber;
    };
    Subscriber.prototype.next = function (value) {
        if (!this.isStopped) {
            this._next(value);
        }
    };
    Subscriber.prototype.error = function (err) {
        if (!this.isStopped) {
            this.isStopped = true;
            this._error(err);
        }
    };
    Subscriber.prototype.complete = function () {
        if (!this.isStopped) {
            this.isStopped = true;
            this._complete();
        }
    };
    Subscriber.prototype.unsubscribe = function () {
        if (this.closed) {
            return;
        }
        this.isStopped = true;
        _super.prototype.unsubscribe.call(this);
    };
    Subscriber.prototype._next = function (value) {
        this.destination.next(value);
    };
    Subscriber.prototype._error = function (err) {
        this.destination.error(err);
        this.unsubscribe();
    };
    Subscriber.prototype._complete = function () {
        this.destination.complete();
        this.unsubscribe();
    };
    Subscriber.prototype._unsubscribeAndRecycle = function () {
        var _parentOrParents = this._parentOrParents;
        this._parentOrParents = null;
        this.unsubscribe();
        this.closed = false;
        this.isStopped = false;
        this._parentOrParents = _parentOrParents;
        return this;
    };
    return Subscriber;
}(_Subscription__WEBPACK_IMPORTED_MODULE_3__/* .Subscription */ .w));

var SafeSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(SafeSubscriber, _super);
    function SafeSubscriber(_parentSubscriber, observerOrNext, error, complete) {
        var _this = _super.call(this) || this;
        _this._parentSubscriber = _parentSubscriber;
        var next;
        var context = _this;
        if ((0,_util_isFunction__WEBPACK_IMPORTED_MODULE_4__/* .isFunction */ .m)(observerOrNext)) {
            next = observerOrNext;
        }
        else if (observerOrNext) {
            next = observerOrNext.next;
            error = observerOrNext.error;
            complete = observerOrNext.complete;
            if (observerOrNext !== _Observer__WEBPACK_IMPORTED_MODULE_1__/* .empty */ .c) {
                context = Object.create(observerOrNext);
                if ((0,_util_isFunction__WEBPACK_IMPORTED_MODULE_4__/* .isFunction */ .m)(context.unsubscribe)) {
                    _this.add(context.unsubscribe.bind(context));
                }
                context.unsubscribe = _this.unsubscribe.bind(_this);
            }
        }
        _this._context = context;
        _this._next = next;
        _this._error = error;
        _this._complete = complete;
        return _this;
    }
    SafeSubscriber.prototype.next = function (value) {
        if (!this.isStopped && this._next) {
            var _parentSubscriber = this._parentSubscriber;
            if (!_config__WEBPACK_IMPORTED_MODULE_5__/* .config.useDeprecatedSynchronousErrorHandling */ .v.useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {
                this.__tryOrUnsub(this._next, value);
            }
            else if (this.__tryOrSetError(_parentSubscriber, this._next, value)) {
                this.unsubscribe();
            }
        }
    };
    SafeSubscriber.prototype.error = function (err) {
        if (!this.isStopped) {
            var _parentSubscriber = this._parentSubscriber;
            var useDeprecatedSynchronousErrorHandling = _config__WEBPACK_IMPORTED_MODULE_5__/* .config.useDeprecatedSynchronousErrorHandling */ .v.useDeprecatedSynchronousErrorHandling;
            if (this._error) {
                if (!useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {
                    this.__tryOrUnsub(this._error, err);
                    this.unsubscribe();
                }
                else {
                    this.__tryOrSetError(_parentSubscriber, this._error, err);
                    this.unsubscribe();
                }
            }
            else if (!_parentSubscriber.syncErrorThrowable) {
                this.unsubscribe();
                if (useDeprecatedSynchronousErrorHandling) {
                    throw err;
                }
                (0,_util_hostReportError__WEBPACK_IMPORTED_MODULE_6__/* .hostReportError */ .z)(err);
            }
            else {
                if (useDeprecatedSynchronousErrorHandling) {
                    _parentSubscriber.syncErrorValue = err;
                    _parentSubscriber.syncErrorThrown = true;
                }
                else {
                    (0,_util_hostReportError__WEBPACK_IMPORTED_MODULE_6__/* .hostReportError */ .z)(err);
                }
                this.unsubscribe();
            }
        }
    };
    SafeSubscriber.prototype.complete = function () {
        var _this = this;
        if (!this.isStopped) {
            var _parentSubscriber = this._parentSubscriber;
            if (this._complete) {
                var wrappedComplete = function () { return _this._complete.call(_this._context); };
                if (!_config__WEBPACK_IMPORTED_MODULE_5__/* .config.useDeprecatedSynchronousErrorHandling */ .v.useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {
                    this.__tryOrUnsub(wrappedComplete);
                    this.unsubscribe();
                }
                else {
                    this.__tryOrSetError(_parentSubscriber, wrappedComplete);
                    this.unsubscribe();
                }
            }
            else {
                this.unsubscribe();
            }
        }
    };
    SafeSubscriber.prototype.__tryOrUnsub = function (fn, value) {
        try {
            fn.call(this._context, value);
        }
        catch (err) {
            this.unsubscribe();
            if (_config__WEBPACK_IMPORTED_MODULE_5__/* .config.useDeprecatedSynchronousErrorHandling */ .v.useDeprecatedSynchronousErrorHandling) {
                throw err;
            }
            else {
                (0,_util_hostReportError__WEBPACK_IMPORTED_MODULE_6__/* .hostReportError */ .z)(err);
            }
        }
    };
    SafeSubscriber.prototype.__tryOrSetError = function (parent, fn, value) {
        if (!_config__WEBPACK_IMPORTED_MODULE_5__/* .config.useDeprecatedSynchronousErrorHandling */ .v.useDeprecatedSynchronousErrorHandling) {
            throw new Error('bad call');
        }
        try {
            fn.call(this._context, value);
        }
        catch (err) {
            if (_config__WEBPACK_IMPORTED_MODULE_5__/* .config.useDeprecatedSynchronousErrorHandling */ .v.useDeprecatedSynchronousErrorHandling) {
                parent.syncErrorValue = err;
                parent.syncErrorThrown = true;
                return true;
            }
            else {
                (0,_util_hostReportError__WEBPACK_IMPORTED_MODULE_6__/* .hostReportError */ .z)(err);
                return true;
            }
        }
        return false;
    };
    SafeSubscriber.prototype._unsubscribe = function () {
        var _parentSubscriber = this._parentSubscriber;
        this._context = null;
        this._parentSubscriber = null;
        _parentSubscriber.unsubscribe();
    };
    return SafeSubscriber;
}(Subscriber));

//# sourceMappingURL=Subscriber.js.map


/***/ }),

/***/ 8760:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "w": () => (/* binding */ Subscription)
/* harmony export */ });
/* harmony import */ var _util_isArray__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(9026);
/* harmony import */ var _util_isObject__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(2009);
/* harmony import */ var _util_isFunction__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4156);
/* harmony import */ var _util_UnsubscriptionError__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(8782);
/** PURE_IMPORTS_START _util_isArray,_util_isObject,_util_isFunction,_util_UnsubscriptionError PURE_IMPORTS_END */




var Subscription = /*@__PURE__*/ (function () {
    function Subscription(unsubscribe) {
        this.closed = false;
        this._parentOrParents = null;
        this._subscriptions = null;
        if (unsubscribe) {
            this._ctorUnsubscribe = true;
            this._unsubscribe = unsubscribe;
        }
    }
    Subscription.prototype.unsubscribe = function () {
        var errors;
        if (this.closed) {
            return;
        }
        var _a = this, _parentOrParents = _a._parentOrParents, _ctorUnsubscribe = _a._ctorUnsubscribe, _unsubscribe = _a._unsubscribe, _subscriptions = _a._subscriptions;
        this.closed = true;
        this._parentOrParents = null;
        this._subscriptions = null;
        if (_parentOrParents instanceof Subscription) {
            _parentOrParents.remove(this);
        }
        else if (_parentOrParents !== null) {
            for (var index = 0; index < _parentOrParents.length; ++index) {
                var parent_1 = _parentOrParents[index];
                parent_1.remove(this);
            }
        }
        if ((0,_util_isFunction__WEBPACK_IMPORTED_MODULE_0__/* .isFunction */ .m)(_unsubscribe)) {
            if (_ctorUnsubscribe) {
                this._unsubscribe = undefined;
            }
            try {
                _unsubscribe.call(this);
            }
            catch (e) {
                errors = e instanceof _util_UnsubscriptionError__WEBPACK_IMPORTED_MODULE_1__/* .UnsubscriptionError */ .B ? flattenUnsubscriptionErrors(e.errors) : [e];
            }
        }
        if ((0,_util_isArray__WEBPACK_IMPORTED_MODULE_2__/* .isArray */ .k)(_subscriptions)) {
            var index = -1;
            var len = _subscriptions.length;
            while (++index < len) {
                var sub = _subscriptions[index];
                if ((0,_util_isObject__WEBPACK_IMPORTED_MODULE_3__/* .isObject */ .K)(sub)) {
                    try {
                        sub.unsubscribe();
                    }
                    catch (e) {
                        errors = errors || [];
                        if (e instanceof _util_UnsubscriptionError__WEBPACK_IMPORTED_MODULE_1__/* .UnsubscriptionError */ .B) {
                            errors = errors.concat(flattenUnsubscriptionErrors(e.errors));
                        }
                        else {
                            errors.push(e);
                        }
                    }
                }
            }
        }
        if (errors) {
            throw new _util_UnsubscriptionError__WEBPACK_IMPORTED_MODULE_1__/* .UnsubscriptionError */ .B(errors);
        }
    };
    Subscription.prototype.add = function (teardown) {
        var subscription = teardown;
        if (!teardown) {
            return Subscription.EMPTY;
        }
        switch (typeof teardown) {
            case 'function':
                subscription = new Subscription(teardown);
            case 'object':
                if (subscription === this || subscription.closed || typeof subscription.unsubscribe !== 'function') {
                    return subscription;
                }
                else if (this.closed) {
                    subscription.unsubscribe();
                    return subscription;
                }
                else if (!(subscription instanceof Subscription)) {
                    var tmp = subscription;
                    subscription = new Subscription();
                    subscription._subscriptions = [tmp];
                }
                break;
            default: {
                throw new Error('unrecognized teardown ' + teardown + ' added to Subscription.');
            }
        }
        var _parentOrParents = subscription._parentOrParents;
        if (_parentOrParents === null) {
            subscription._parentOrParents = this;
        }
        else if (_parentOrParents instanceof Subscription) {
            if (_parentOrParents === this) {
                return subscription;
            }
            subscription._parentOrParents = [_parentOrParents, this];
        }
        else if (_parentOrParents.indexOf(this) === -1) {
            _parentOrParents.push(this);
        }
        else {
            return subscription;
        }
        var subscriptions = this._subscriptions;
        if (subscriptions === null) {
            this._subscriptions = [subscription];
        }
        else {
            subscriptions.push(subscription);
        }
        return subscription;
    };
    Subscription.prototype.remove = function (subscription) {
        var subscriptions = this._subscriptions;
        if (subscriptions) {
            var subscriptionIndex = subscriptions.indexOf(subscription);
            if (subscriptionIndex !== -1) {
                subscriptions.splice(subscriptionIndex, 1);
            }
        }
    };
    Subscription.EMPTY = (function (empty) {
        empty.closed = true;
        return empty;
    }(new Subscription()));
    return Subscription;
}());

function flattenUnsubscriptionErrors(errors) {
    return errors.reduce(function (errs, err) { return errs.concat((err instanceof _util_UnsubscriptionError__WEBPACK_IMPORTED_MODULE_1__/* .UnsubscriptionError */ .B) ? err.errors : err); }, []);
}
//# sourceMappingURL=Subscription.js.map


/***/ }),

/***/ 150:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "v": () => (/* binding */ config)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var _enable_super_gross_mode_that_will_cause_bad_things = false;
var config = {
    Promise: undefined,
    set useDeprecatedSynchronousErrorHandling(value) {
        if (value) {
            var error = /*@__PURE__*/ new Error();
            /*@__PURE__*/ console.warn('DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n' + error.stack);
        }
        else if (_enable_super_gross_mode_that_will_cause_bad_things) {
            /*@__PURE__*/ console.log('RxJS: Back to a better error behavior. Thank you. <3');
        }
        _enable_super_gross_mode_that_will_cause_bad_things = value;
    },
    get useDeprecatedSynchronousErrorHandling() {
        return _enable_super_gross_mode_that_will_cause_bad_things;
    },
};
//# sourceMappingURL=config.js.map


/***/ }),

/***/ 7604:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "IY": () => (/* binding */ SimpleInnerSubscriber),
/* harmony export */   "Ds": () => (/* binding */ SimpleOuterSubscriber),
/* harmony export */   "ft": () => (/* binding */ innerSubscribe)
/* harmony export */ });
/* unused harmony exports ComplexInnerSubscriber, ComplexOuterSubscriber */
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Subscriber__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(979);
/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(2772);
/* harmony import */ var _util_subscribeTo__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(7843);
/** PURE_IMPORTS_START tslib,_Subscriber,_Observable,_util_subscribeTo PURE_IMPORTS_END */




var SimpleInnerSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(SimpleInnerSubscriber, _super);
    function SimpleInnerSubscriber(parent) {
        var _this = _super.call(this) || this;
        _this.parent = parent;
        return _this;
    }
    SimpleInnerSubscriber.prototype._next = function (value) {
        this.parent.notifyNext(value);
    };
    SimpleInnerSubscriber.prototype._error = function (error) {
        this.parent.notifyError(error);
        this.unsubscribe();
    };
    SimpleInnerSubscriber.prototype._complete = function () {
        this.parent.notifyComplete();
        this.unsubscribe();
    };
    return SimpleInnerSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_1__/* .Subscriber */ .L));

var ComplexInnerSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(ComplexInnerSubscriber, _super);
    function ComplexInnerSubscriber(parent, outerValue, outerIndex) {
        var _this = _super.call(this) || this;
        _this.parent = parent;
        _this.outerValue = outerValue;
        _this.outerIndex = outerIndex;
        return _this;
    }
    ComplexInnerSubscriber.prototype._next = function (value) {
        this.parent.notifyNext(this.outerValue, value, this.outerIndex, this);
    };
    ComplexInnerSubscriber.prototype._error = function (error) {
        this.parent.notifyError(error);
        this.unsubscribe();
    };
    ComplexInnerSubscriber.prototype._complete = function () {
        this.parent.notifyComplete(this);
        this.unsubscribe();
    };
    return ComplexInnerSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_1__/* .Subscriber */ .L));

var SimpleOuterSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(SimpleOuterSubscriber, _super);
    function SimpleOuterSubscriber() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SimpleOuterSubscriber.prototype.notifyNext = function (innerValue) {
        this.destination.next(innerValue);
    };
    SimpleOuterSubscriber.prototype.notifyError = function (err) {
        this.destination.error(err);
    };
    SimpleOuterSubscriber.prototype.notifyComplete = function () {
        this.destination.complete();
    };
    return SimpleOuterSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_1__/* .Subscriber */ .L));

var ComplexOuterSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(ComplexOuterSubscriber, _super);
    function ComplexOuterSubscriber() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ComplexOuterSubscriber.prototype.notifyNext = function (_outerValue, innerValue, _outerIndex, _innerSub) {
        this.destination.next(innerValue);
    };
    ComplexOuterSubscriber.prototype.notifyError = function (error) {
        this.destination.error(error);
    };
    ComplexOuterSubscriber.prototype.notifyComplete = function (_innerSub) {
        this.destination.complete();
    };
    return ComplexOuterSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_1__/* .Subscriber */ .L));

function innerSubscribe(result, innerSubscriber) {
    if (innerSubscriber.closed) {
        return undefined;
    }
    if (result instanceof _Observable__WEBPACK_IMPORTED_MODULE_2__/* .Observable */ .y) {
        return result.subscribe(innerSubscriber);
    }
    var subscription;
    try {
        subscription = (0,_util_subscribeTo__WEBPACK_IMPORTED_MODULE_3__/* .subscribeTo */ .s)(result)(innerSubscriber);
    }
    catch (error) {
        innerSubscriber.error(error);
    }
    return subscription;
}
//# sourceMappingURL=innerSubscribe.js.map


/***/ }),

/***/ 3140:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "c": () => (/* binding */ ConnectableObservable),
/* harmony export */   "N": () => (/* binding */ connectableObservableDescriptor)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Subject__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(211);
/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(2772);
/* harmony import */ var _Subscriber__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(979);
/* harmony import */ var _Subscription__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(8760);
/* harmony import */ var _operators_refCount__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(3018);
/** PURE_IMPORTS_START tslib,_Subject,_Observable,_Subscriber,_Subscription,_operators_refCount PURE_IMPORTS_END */






var ConnectableObservable = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(ConnectableObservable, _super);
    function ConnectableObservable(source, subjectFactory) {
        var _this = _super.call(this) || this;
        _this.source = source;
        _this.subjectFactory = subjectFactory;
        _this._refCount = 0;
        _this._isComplete = false;
        return _this;
    }
    ConnectableObservable.prototype._subscribe = function (subscriber) {
        return this.getSubject().subscribe(subscriber);
    };
    ConnectableObservable.prototype.getSubject = function () {
        var subject = this._subject;
        if (!subject || subject.isStopped) {
            this._subject = this.subjectFactory();
        }
        return this._subject;
    };
    ConnectableObservable.prototype.connect = function () {
        var connection = this._connection;
        if (!connection) {
            this._isComplete = false;
            connection = this._connection = new _Subscription__WEBPACK_IMPORTED_MODULE_1__/* .Subscription */ .w();
            connection.add(this.source
                .subscribe(new ConnectableSubscriber(this.getSubject(), this)));
            if (connection.closed) {
                this._connection = null;
                connection = _Subscription__WEBPACK_IMPORTED_MODULE_1__/* .Subscription.EMPTY */ .w.EMPTY;
            }
        }
        return connection;
    };
    ConnectableObservable.prototype.refCount = function () {
        return (0,_operators_refCount__WEBPACK_IMPORTED_MODULE_2__/* .refCount */ .x)()(this);
    };
    return ConnectableObservable;
}(_Observable__WEBPACK_IMPORTED_MODULE_3__/* .Observable */ .y));

var connectableObservableDescriptor = /*@__PURE__*/ (function () {
    var connectableProto = ConnectableObservable.prototype;
    return {
        operator: { value: null },
        _refCount: { value: 0, writable: true },
        _subject: { value: null, writable: true },
        _connection: { value: null, writable: true },
        _subscribe: { value: connectableProto._subscribe },
        _isComplete: { value: connectableProto._isComplete, writable: true },
        getSubject: { value: connectableProto.getSubject },
        connect: { value: connectableProto.connect },
        refCount: { value: connectableProto.refCount }
    };
})();
var ConnectableSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(ConnectableSubscriber, _super);
    function ConnectableSubscriber(destination, connectable) {
        var _this = _super.call(this, destination) || this;
        _this.connectable = connectable;
        return _this;
    }
    ConnectableSubscriber.prototype._error = function (err) {
        this._unsubscribe();
        _super.prototype._error.call(this, err);
    };
    ConnectableSubscriber.prototype._complete = function () {
        this.connectable._isComplete = true;
        this._unsubscribe();
        _super.prototype._complete.call(this);
    };
    ConnectableSubscriber.prototype._unsubscribe = function () {
        var connectable = this.connectable;
        if (connectable) {
            this.connectable = null;
            var connection = connectable._connection;
            connectable._refCount = 0;
            connectable._subject = null;
            connectable._connection = null;
            if (connection) {
                connection.unsubscribe();
            }
        }
    };
    return ConnectableSubscriber;
}(_Subject__WEBPACK_IMPORTED_MODULE_4__/* .SubjectSubscriber */ .Yc));
var RefCountOperator = /*@__PURE__*/ ((/* unused pure expression or super */ null && (function () {
    function RefCountOperator(connectable) {
        this.connectable = connectable;
    }
    RefCountOperator.prototype.call = function (subscriber, source) {
        var connectable = this.connectable;
        connectable._refCount++;
        var refCounter = new RefCountSubscriber(subscriber, connectable);
        var subscription = source.subscribe(refCounter);
        if (!refCounter.closed) {
            refCounter.connection = connectable.connect();
        }
        return subscription;
    };
    return RefCountOperator;
}())));
var RefCountSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(RefCountSubscriber, _super);
    function RefCountSubscriber(destination, connectable) {
        var _this = _super.call(this, destination) || this;
        _this.connectable = connectable;
        return _this;
    }
    RefCountSubscriber.prototype._unsubscribe = function () {
        var connectable = this.connectable;
        if (!connectable) {
            this.connection = null;
            return;
        }
        this.connectable = null;
        var refCount = connectable._refCount;
        if (refCount <= 0) {
            this.connection = null;
            return;
        }
        connectable._refCount = refCount - 1;
        if (refCount > 1) {
            this.connection = null;
            return;
        }
        var connection = this.connection;
        var sharedConnection = connectable._connection;
        this.connection = null;
        if (sharedConnection && (!connection || sharedConnection === connection)) {
            sharedConnection.unsubscribe();
        }
    };
    return RefCountSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_5__/* .Subscriber */ .L));
//# sourceMappingURL=ConnectableObservable.js.map


/***/ }),

/***/ 5142:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "aj": () => (/* binding */ combineLatest),
/* harmony export */   "Ms": () => (/* binding */ CombineLatestOperator)
/* harmony export */ });
/* unused harmony export CombineLatestSubscriber */
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(5987);
/* harmony import */ var _util_isScheduler__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(7507);
/* harmony import */ var _util_isArray__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(9026);
/* harmony import */ var _OuterSubscriber__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(2039);
/* harmony import */ var _util_subscribeToResult__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(2080);
/* harmony import */ var _fromArray__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(3375);
/** PURE_IMPORTS_START tslib,_util_isScheduler,_util_isArray,_OuterSubscriber,_util_subscribeToResult,_fromArray PURE_IMPORTS_END */






var NONE = {};
function combineLatest() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    var resultSelector = undefined;
    var scheduler = undefined;
    if ((0,_util_isScheduler__WEBPACK_IMPORTED_MODULE_0__/* .isScheduler */ .K)(observables[observables.length - 1])) {
        scheduler = observables.pop();
    }
    if (typeof observables[observables.length - 1] === 'function') {
        resultSelector = observables.pop();
    }
    if (observables.length === 1 && (0,_util_isArray__WEBPACK_IMPORTED_MODULE_1__/* .isArray */ .k)(observables[0])) {
        observables = observables[0];
    }
    return (0,_fromArray__WEBPACK_IMPORTED_MODULE_2__/* .fromArray */ .n)(observables, scheduler).lift(new CombineLatestOperator(resultSelector));
}
var CombineLatestOperator = /*@__PURE__*/ (function () {
    function CombineLatestOperator(resultSelector) {
        this.resultSelector = resultSelector;
    }
    CombineLatestOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new CombineLatestSubscriber(subscriber, this.resultSelector));
    };
    return CombineLatestOperator;
}());

var CombineLatestSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_3__/* .__extends */ .ZT(CombineLatestSubscriber, _super);
    function CombineLatestSubscriber(destination, resultSelector) {
        var _this = _super.call(this, destination) || this;
        _this.resultSelector = resultSelector;
        _this.active = 0;
        _this.values = [];
        _this.observables = [];
        return _this;
    }
    CombineLatestSubscriber.prototype._next = function (observable) {
        this.values.push(NONE);
        this.observables.push(observable);
    };
    CombineLatestSubscriber.prototype._complete = function () {
        var observables = this.observables;
        var len = observables.length;
        if (len === 0) {
            this.destination.complete();
        }
        else {
            this.active = len;
            this.toRespond = len;
            for (var i = 0; i < len; i++) {
                var observable = observables[i];
                this.add((0,_util_subscribeToResult__WEBPACK_IMPORTED_MODULE_4__/* .subscribeToResult */ .D)(this, observable, undefined, i));
            }
        }
    };
    CombineLatestSubscriber.prototype.notifyComplete = function (unused) {
        if ((this.active -= 1) === 0) {
            this.destination.complete();
        }
    };
    CombineLatestSubscriber.prototype.notifyNext = function (_outerValue, innerValue, outerIndex) {
        var values = this.values;
        var oldVal = values[outerIndex];
        var toRespond = !this.toRespond
            ? 0
            : oldVal === NONE ? --this.toRespond : this.toRespond;
        values[outerIndex] = innerValue;
        if (toRespond === 0) {
            if (this.resultSelector) {
                this._tryResultSelector(values);
            }
            else {
                this.destination.next(values.slice());
            }
        }
    };
    CombineLatestSubscriber.prototype._tryResultSelector = function (values) {
        var result;
        try {
            result = this.resultSelector.apply(this, values);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        this.destination.next(result);
    };
    return CombineLatestSubscriber;
}(_OuterSubscriber__WEBPACK_IMPORTED_MODULE_5__/* .OuterSubscriber */ .L));

//# sourceMappingURL=combineLatest.js.map


/***/ }),

/***/ 9795:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "z": () => (/* binding */ concat)
/* harmony export */ });
/* harmony import */ var _of__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(8170);
/* harmony import */ var _operators_concatAll__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(2257);
/** PURE_IMPORTS_START _of,_operators_concatAll PURE_IMPORTS_END */


function concat() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    return (0,_operators_concatAll__WEBPACK_IMPORTED_MODULE_0__/* .concatAll */ .u)()(_of__WEBPACK_IMPORTED_MODULE_1__.of.apply(void 0, observables));
}
//# sourceMappingURL=concat.js.map


/***/ }),

/***/ 1410:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "P": () => (/* binding */ defer)
/* harmony export */ });
/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(2772);
/* harmony import */ var _from__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(5760);
/* harmony import */ var _empty__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(5631);
/** PURE_IMPORTS_START _Observable,_from,_empty PURE_IMPORTS_END */



function defer(observableFactory) {
    return new _Observable__WEBPACK_IMPORTED_MODULE_0__/* .Observable */ .y(function (subscriber) {
        var input;
        try {
            input = observableFactory();
        }
        catch (err) {
            subscriber.error(err);
            return undefined;
        }
        var source = input ? (0,_from__WEBPACK_IMPORTED_MODULE_1__/* .from */ .D)(input) : (0,_empty__WEBPACK_IMPORTED_MODULE_2__/* .empty */ .c)();
        return source.subscribe(subscriber);
    });
}
//# sourceMappingURL=defer.js.map


/***/ }),

/***/ 5631:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "E": () => (/* binding */ EMPTY),
/* harmony export */   "c": () => (/* binding */ empty)
/* harmony export */ });
/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(2772);
/** PURE_IMPORTS_START _Observable PURE_IMPORTS_END */

var EMPTY = /*@__PURE__*/ new _Observable__WEBPACK_IMPORTED_MODULE_0__/* .Observable */ .y(function (subscriber) { return subscriber.complete(); });
function empty(scheduler) {
    return scheduler ? emptyScheduled(scheduler) : EMPTY;
}
function emptyScheduled(scheduler) {
    return new _Observable__WEBPACK_IMPORTED_MODULE_0__/* .Observable */ .y(function (subscriber) { return scheduler.schedule(function () { return subscriber.complete(); }); });
}
//# sourceMappingURL=empty.js.map


/***/ }),

/***/ 5760:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "D": () => (/* binding */ from)
/* harmony export */ });
/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(2772);
/* harmony import */ var _util_subscribeTo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(7843);
/* harmony import */ var _scheduled_scheduled__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(8107);
/** PURE_IMPORTS_START _Observable,_util_subscribeTo,_scheduled_scheduled PURE_IMPORTS_END */



function from(input, scheduler) {
    if (!scheduler) {
        if (input instanceof _Observable__WEBPACK_IMPORTED_MODULE_0__/* .Observable */ .y) {
            return input;
        }
        return new _Observable__WEBPACK_IMPORTED_MODULE_0__/* .Observable */ .y((0,_util_subscribeTo__WEBPACK_IMPORTED_MODULE_1__/* .subscribeTo */ .s)(input));
    }
    else {
        return (0,_scheduled_scheduled__WEBPACK_IMPORTED_MODULE_2__/* .scheduled */ .x)(input, scheduler);
    }
}
//# sourceMappingURL=from.js.map


/***/ }),

/***/ 3375:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "n": () => (/* binding */ fromArray)
/* harmony export */ });
/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(2772);
/* harmony import */ var _util_subscribeToArray__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(6900);
/* harmony import */ var _scheduled_scheduleArray__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(3109);
/** PURE_IMPORTS_START _Observable,_util_subscribeToArray,_scheduled_scheduleArray PURE_IMPORTS_END */



function fromArray(input, scheduler) {
    if (!scheduler) {
        return new _Observable__WEBPACK_IMPORTED_MODULE_0__/* .Observable */ .y((0,_util_subscribeToArray__WEBPACK_IMPORTED_MODULE_1__/* .subscribeToArray */ .V)(input));
    }
    else {
        return (0,_scheduled_scheduleArray__WEBPACK_IMPORTED_MODULE_2__/* .scheduleArray */ .r)(input, scheduler);
    }
}
//# sourceMappingURL=fromArray.js.map


/***/ }),

/***/ 4370:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "T": () => (/* binding */ merge)
/* harmony export */ });
/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(2772);
/* harmony import */ var _util_isScheduler__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(7507);
/* harmony import */ var _operators_mergeAll__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(2556);
/* harmony import */ var _fromArray__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(3375);
/** PURE_IMPORTS_START _Observable,_util_isScheduler,_operators_mergeAll,_fromArray PURE_IMPORTS_END */




function merge() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    var concurrent = Number.POSITIVE_INFINITY;
    var scheduler = null;
    var last = observables[observables.length - 1];
    if ((0,_util_isScheduler__WEBPACK_IMPORTED_MODULE_0__/* .isScheduler */ .K)(last)) {
        scheduler = observables.pop();
        if (observables.length > 1 && typeof observables[observables.length - 1] === 'number') {
            concurrent = observables.pop();
        }
    }
    else if (typeof last === 'number') {
        concurrent = observables.pop();
    }
    if (scheduler === null && observables.length === 1 && observables[0] instanceof _Observable__WEBPACK_IMPORTED_MODULE_1__/* .Observable */ .y) {
        return observables[0];
    }
    return (0,_operators_mergeAll__WEBPACK_IMPORTED_MODULE_2__/* .mergeAll */ .J)(concurrent)((0,_fromArray__WEBPACK_IMPORTED_MODULE_3__/* .fromArray */ .n)(observables, scheduler));
}
//# sourceMappingURL=merge.js.map


/***/ }),

/***/ 8170:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "of": () => (/* binding */ of)
/* harmony export */ });
/* harmony import */ var _util_isScheduler__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(7507);
/* harmony import */ var _fromArray__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(3375);
/* harmony import */ var _scheduled_scheduleArray__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(3109);
/** PURE_IMPORTS_START _util_isScheduler,_fromArray,_scheduled_scheduleArray PURE_IMPORTS_END */



function of() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
    }
    var scheduler = args[args.length - 1];
    if ((0,_util_isScheduler__WEBPACK_IMPORTED_MODULE_0__/* .isScheduler */ .K)(scheduler)) {
        args.pop();
        return (0,_scheduled_scheduleArray__WEBPACK_IMPORTED_MODULE_1__/* .scheduleArray */ .r)(args, scheduler);
    }
    else {
        return (0,_fromArray__WEBPACK_IMPORTED_MODULE_2__/* .fromArray */ .n)(args);
    }
}
//# sourceMappingURL=of.js.map


/***/ }),

/***/ 8821:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "S3": () => (/* binding */ race)
/* harmony export */ });
/* unused harmony exports RaceOperator, RaceSubscriber */
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(5987);
/* harmony import */ var _util_isArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(9026);
/* harmony import */ var _fromArray__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(3375);
/* harmony import */ var _OuterSubscriber__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(2039);
/* harmony import */ var _util_subscribeToResult__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(2080);
/** PURE_IMPORTS_START tslib,_util_isArray,_fromArray,_OuterSubscriber,_util_subscribeToResult PURE_IMPORTS_END */





function race() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    if (observables.length === 1) {
        if ((0,_util_isArray__WEBPACK_IMPORTED_MODULE_0__/* .isArray */ .k)(observables[0])) {
            observables = observables[0];
        }
        else {
            return observables[0];
        }
    }
    return (0,_fromArray__WEBPACK_IMPORTED_MODULE_1__/* .fromArray */ .n)(observables, undefined).lift(new RaceOperator());
}
var RaceOperator = /*@__PURE__*/ (function () {
    function RaceOperator() {
    }
    RaceOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new RaceSubscriber(subscriber));
    };
    return RaceOperator;
}());

var RaceSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_2__/* .__extends */ .ZT(RaceSubscriber, _super);
    function RaceSubscriber(destination) {
        var _this = _super.call(this, destination) || this;
        _this.hasFirst = false;
        _this.observables = [];
        _this.subscriptions = [];
        return _this;
    }
    RaceSubscriber.prototype._next = function (observable) {
        this.observables.push(observable);
    };
    RaceSubscriber.prototype._complete = function () {
        var observables = this.observables;
        var len = observables.length;
        if (len === 0) {
            this.destination.complete();
        }
        else {
            for (var i = 0; i < len && !this.hasFirst; i++) {
                var observable = observables[i];
                var subscription = (0,_util_subscribeToResult__WEBPACK_IMPORTED_MODULE_3__/* .subscribeToResult */ .D)(this, observable, undefined, i);
                if (this.subscriptions) {
                    this.subscriptions.push(subscription);
                }
                this.add(subscription);
            }
            this.observables = null;
        }
    };
    RaceSubscriber.prototype.notifyNext = function (_outerValue, innerValue, outerIndex) {
        if (!this.hasFirst) {
            this.hasFirst = true;
            for (var i = 0; i < this.subscriptions.length; i++) {
                if (i !== outerIndex) {
                    var subscription = this.subscriptions[i];
                    subscription.unsubscribe();
                    this.remove(subscription);
                }
            }
            this.subscriptions = null;
        }
        this.destination.next(innerValue);
    };
    return RaceSubscriber;
}(_OuterSubscriber__WEBPACK_IMPORTED_MODULE_4__/* .OuterSubscriber */ .L));

//# sourceMappingURL=race.js.map


/***/ }),

/***/ 4944:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "_": () => (/* binding */ throwError)
/* harmony export */ });
/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(2772);
/** PURE_IMPORTS_START _Observable PURE_IMPORTS_END */

function throwError(error, scheduler) {
    if (!scheduler) {
        return new _Observable__WEBPACK_IMPORTED_MODULE_0__/* .Observable */ .y(function (subscriber) { return subscriber.error(error); });
    }
    else {
        return new _Observable__WEBPACK_IMPORTED_MODULE_0__/* .Observable */ .y(function (subscriber) { return scheduler.schedule(dispatch, 0, { error: error, subscriber: subscriber }); });
    }
}
function dispatch(_a) {
    var error = _a.error, subscriber = _a.subscriber;
    subscriber.error(error);
}
//# sourceMappingURL=throwError.js.map


/***/ }),

/***/ 9604:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "H": () => (/* binding */ timer)
/* harmony export */ });
/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(2772);
/* harmony import */ var _scheduler_async__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(964);
/* harmony import */ var _util_isNumeric__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5812);
/* harmony import */ var _util_isScheduler__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(7507);
/** PURE_IMPORTS_START _Observable,_scheduler_async,_util_isNumeric,_util_isScheduler PURE_IMPORTS_END */




function timer(dueTime, periodOrScheduler, scheduler) {
    if (dueTime === void 0) {
        dueTime = 0;
    }
    var period = -1;
    if ((0,_util_isNumeric__WEBPACK_IMPORTED_MODULE_0__/* .isNumeric */ .k)(periodOrScheduler)) {
        period = Number(periodOrScheduler) < 1 && 1 || Number(periodOrScheduler);
    }
    else if ((0,_util_isScheduler__WEBPACK_IMPORTED_MODULE_1__/* .isScheduler */ .K)(periodOrScheduler)) {
        scheduler = periodOrScheduler;
    }
    if (!(0,_util_isScheduler__WEBPACK_IMPORTED_MODULE_1__/* .isScheduler */ .K)(scheduler)) {
        scheduler = _scheduler_async__WEBPACK_IMPORTED_MODULE_2__/* .async */ .P;
    }
    return new _Observable__WEBPACK_IMPORTED_MODULE_3__/* .Observable */ .y(function (subscriber) {
        var due = (0,_util_isNumeric__WEBPACK_IMPORTED_MODULE_0__/* .isNumeric */ .k)(dueTime)
            ? dueTime
            : (+dueTime - scheduler.now());
        return scheduler.schedule(dispatch, due, {
            index: 0, period: period, subscriber: subscriber
        });
    });
}
function dispatch(state) {
    var index = state.index, period = state.period, subscriber = state.subscriber;
    subscriber.next(index);
    if (subscriber.closed) {
        return;
    }
    else if (period === -1) {
        return subscriber.complete();
    }
    state.index = index + 1;
    this.schedule(state, period);
}
//# sourceMappingURL=timer.js.map


/***/ }),

/***/ 5080:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "$R": () => (/* binding */ zip),
/* harmony export */   "mx": () => (/* binding */ ZipOperator)
/* harmony export */ });
/* unused harmony export ZipSubscriber */
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(5987);
/* harmony import */ var _fromArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(3375);
/* harmony import */ var _util_isArray__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(9026);
/* harmony import */ var _Subscriber__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(979);
/* harmony import */ var _internal_symbol_iterator__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(999);
/* harmony import */ var _innerSubscribe__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(7604);
/** PURE_IMPORTS_START tslib,_fromArray,_util_isArray,_Subscriber,_.._internal_symbol_iterator,_innerSubscribe PURE_IMPORTS_END */






function zip() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    var resultSelector = observables[observables.length - 1];
    if (typeof resultSelector === 'function') {
        observables.pop();
    }
    return (0,_fromArray__WEBPACK_IMPORTED_MODULE_0__/* .fromArray */ .n)(observables, undefined).lift(new ZipOperator(resultSelector));
}
var ZipOperator = /*@__PURE__*/ (function () {
    function ZipOperator(resultSelector) {
        this.resultSelector = resultSelector;
    }
    ZipOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new ZipSubscriber(subscriber, this.resultSelector));
    };
    return ZipOperator;
}());

var ZipSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_1__/* .__extends */ .ZT(ZipSubscriber, _super);
    function ZipSubscriber(destination, resultSelector, values) {
        if (values === void 0) {
            values = Object.create(null);
        }
        var _this = _super.call(this, destination) || this;
        _this.resultSelector = resultSelector;
        _this.iterators = [];
        _this.active = 0;
        _this.resultSelector = (typeof resultSelector === 'function') ? resultSelector : undefined;
        return _this;
    }
    ZipSubscriber.prototype._next = function (value) {
        var iterators = this.iterators;
        if ((0,_util_isArray__WEBPACK_IMPORTED_MODULE_2__/* .isArray */ .k)(value)) {
            iterators.push(new StaticArrayIterator(value));
        }
        else if (typeof value[_internal_symbol_iterator__WEBPACK_IMPORTED_MODULE_3__/* .iterator */ .hZ] === 'function') {
            iterators.push(new StaticIterator(value[_internal_symbol_iterator__WEBPACK_IMPORTED_MODULE_3__/* .iterator */ .hZ]()));
        }
        else {
            iterators.push(new ZipBufferIterator(this.destination, this, value));
        }
    };
    ZipSubscriber.prototype._complete = function () {
        var iterators = this.iterators;
        var len = iterators.length;
        this.unsubscribe();
        if (len === 0) {
            this.destination.complete();
            return;
        }
        this.active = len;
        for (var i = 0; i < len; i++) {
            var iterator = iterators[i];
            if (iterator.stillUnsubscribed) {
                var destination = this.destination;
                destination.add(iterator.subscribe());
            }
            else {
                this.active--;
            }
        }
    };
    ZipSubscriber.prototype.notifyInactive = function () {
        this.active--;
        if (this.active === 0) {
            this.destination.complete();
        }
    };
    ZipSubscriber.prototype.checkIterators = function () {
        var iterators = this.iterators;
        var len = iterators.length;
        var destination = this.destination;
        for (var i = 0; i < len; i++) {
            var iterator = iterators[i];
            if (typeof iterator.hasValue === 'function' && !iterator.hasValue()) {
                return;
            }
        }
        var shouldComplete = false;
        var args = [];
        for (var i = 0; i < len; i++) {
            var iterator = iterators[i];
            var result = iterator.next();
            if (iterator.hasCompleted()) {
                shouldComplete = true;
            }
            if (result.done) {
                destination.complete();
                return;
            }
            args.push(result.value);
        }
        if (this.resultSelector) {
            this._tryresultSelector(args);
        }
        else {
            destination.next(args);
        }
        if (shouldComplete) {
            destination.complete();
        }
    };
    ZipSubscriber.prototype._tryresultSelector = function (args) {
        var result;
        try {
            result = this.resultSelector.apply(this, args);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        this.destination.next(result);
    };
    return ZipSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_4__/* .Subscriber */ .L));

var StaticIterator = /*@__PURE__*/ (function () {
    function StaticIterator(iterator) {
        this.iterator = iterator;
        this.nextResult = iterator.next();
    }
    StaticIterator.prototype.hasValue = function () {
        return true;
    };
    StaticIterator.prototype.next = function () {
        var result = this.nextResult;
        this.nextResult = this.iterator.next();
        return result;
    };
    StaticIterator.prototype.hasCompleted = function () {
        var nextResult = this.nextResult;
        return Boolean(nextResult && nextResult.done);
    };
    return StaticIterator;
}());
var StaticArrayIterator = /*@__PURE__*/ (function () {
    function StaticArrayIterator(array) {
        this.array = array;
        this.index = 0;
        this.length = 0;
        this.length = array.length;
    }
    StaticArrayIterator.prototype[_internal_symbol_iterator__WEBPACK_IMPORTED_MODULE_3__/* .iterator */ .hZ] = function () {
        return this;
    };
    StaticArrayIterator.prototype.next = function (value) {
        var i = this.index++;
        var array = this.array;
        return i < this.length ? { value: array[i], done: false } : { value: null, done: true };
    };
    StaticArrayIterator.prototype.hasValue = function () {
        return this.array.length > this.index;
    };
    StaticArrayIterator.prototype.hasCompleted = function () {
        return this.array.length === this.index;
    };
    return StaticArrayIterator;
}());
var ZipBufferIterator = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_1__/* .__extends */ .ZT(ZipBufferIterator, _super);
    function ZipBufferIterator(destination, parent, observable) {
        var _this = _super.call(this, destination) || this;
        _this.parent = parent;
        _this.observable = observable;
        _this.stillUnsubscribed = true;
        _this.buffer = [];
        _this.isComplete = false;
        return _this;
    }
    ZipBufferIterator.prototype[_internal_symbol_iterator__WEBPACK_IMPORTED_MODULE_3__/* .iterator */ .hZ] = function () {
        return this;
    };
    ZipBufferIterator.prototype.next = function () {
        var buffer = this.buffer;
        if (buffer.length === 0 && this.isComplete) {
            return { value: null, done: true };
        }
        else {
            return { value: buffer.shift(), done: false };
        }
    };
    ZipBufferIterator.prototype.hasValue = function () {
        return this.buffer.length > 0;
    };
    ZipBufferIterator.prototype.hasCompleted = function () {
        return this.buffer.length === 0 && this.isComplete;
    };
    ZipBufferIterator.prototype.notifyComplete = function () {
        if (this.buffer.length > 0) {
            this.isComplete = true;
            this.parent.notifyInactive();
        }
        else {
            this.destination.complete();
        }
    };
    ZipBufferIterator.prototype.notifyNext = function (innerValue) {
        this.buffer.push(innerValue);
        this.parent.checkIterators();
    };
    ZipBufferIterator.prototype.subscribe = function () {
        return (0,_innerSubscribe__WEBPACK_IMPORTED_MODULE_5__/* .innerSubscribe */ .ft)(this.observable, new _innerSubscribe__WEBPACK_IMPORTED_MODULE_5__/* .SimpleInnerSubscriber */ .IY(this));
    };
    return ZipBufferIterator;
}(_innerSubscribe__WEBPACK_IMPORTED_MODULE_5__/* .SimpleOuterSubscriber */ .Ds));
//# sourceMappingURL=zip.js.map


/***/ }),

/***/ 2257:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "u": () => (/* binding */ concatAll)
/* harmony export */ });
/* harmony import */ var _mergeAll__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(2556);
/** PURE_IMPORTS_START _mergeAll PURE_IMPORTS_END */

function concatAll() {
    return (0,_mergeAll__WEBPACK_IMPORTED_MODULE_0__/* .mergeAll */ .J)(1);
}
//# sourceMappingURL=concatAll.js.map


/***/ }),

/***/ 6008:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "h": () => (/* binding */ filter)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Subscriber__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(979);
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function filter(predicate, thisArg) {
    return function filterOperatorFunction(source) {
        return source.lift(new FilterOperator(predicate, thisArg));
    };
}
var FilterOperator = /*@__PURE__*/ (function () {
    function FilterOperator(predicate, thisArg) {
        this.predicate = predicate;
        this.thisArg = thisArg;
    }
    FilterOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new FilterSubscriber(subscriber, this.predicate, this.thisArg));
    };
    return FilterOperator;
}());
var FilterSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(FilterSubscriber, _super);
    function FilterSubscriber(destination, predicate, thisArg) {
        var _this = _super.call(this, destination) || this;
        _this.predicate = predicate;
        _this.thisArg = thisArg;
        _this.count = 0;
        return _this;
    }
    FilterSubscriber.prototype._next = function (value) {
        var result;
        try {
            result = this.predicate.call(this.thisArg, value, this.count++);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        if (result) {
            this.destination.next(value);
        }
    };
    return FilterSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_1__/* .Subscriber */ .L));
//# sourceMappingURL=filter.js.map


/***/ }),

/***/ 1120:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "v": () => (/* binding */ groupBy),
/* harmony export */   "T": () => (/* binding */ GroupedObservable)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Subscriber__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(979);
/* harmony import */ var _Subscription__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(8760);
/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(2772);
/* harmony import */ var _Subject__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(211);
/** PURE_IMPORTS_START tslib,_Subscriber,_Subscription,_Observable,_Subject PURE_IMPORTS_END */





function groupBy(keySelector, elementSelector, durationSelector, subjectSelector) {
    return function (source) {
        return source.lift(new GroupByOperator(keySelector, elementSelector, durationSelector, subjectSelector));
    };
}
var GroupByOperator = /*@__PURE__*/ (function () {
    function GroupByOperator(keySelector, elementSelector, durationSelector, subjectSelector) {
        this.keySelector = keySelector;
        this.elementSelector = elementSelector;
        this.durationSelector = durationSelector;
        this.subjectSelector = subjectSelector;
    }
    GroupByOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new GroupBySubscriber(subscriber, this.keySelector, this.elementSelector, this.durationSelector, this.subjectSelector));
    };
    return GroupByOperator;
}());
var GroupBySubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(GroupBySubscriber, _super);
    function GroupBySubscriber(destination, keySelector, elementSelector, durationSelector, subjectSelector) {
        var _this = _super.call(this, destination) || this;
        _this.keySelector = keySelector;
        _this.elementSelector = elementSelector;
        _this.durationSelector = durationSelector;
        _this.subjectSelector = subjectSelector;
        _this.groups = null;
        _this.attemptedToUnsubscribe = false;
        _this.count = 0;
        return _this;
    }
    GroupBySubscriber.prototype._next = function (value) {
        var key;
        try {
            key = this.keySelector(value);
        }
        catch (err) {
            this.error(err);
            return;
        }
        this._group(value, key);
    };
    GroupBySubscriber.prototype._group = function (value, key) {
        var groups = this.groups;
        if (!groups) {
            groups = this.groups = new Map();
        }
        var group = groups.get(key);
        var element;
        if (this.elementSelector) {
            try {
                element = this.elementSelector(value);
            }
            catch (err) {
                this.error(err);
            }
        }
        else {
            element = value;
        }
        if (!group) {
            group = (this.subjectSelector ? this.subjectSelector() : new _Subject__WEBPACK_IMPORTED_MODULE_1__/* .Subject */ .xQ());
            groups.set(key, group);
            var groupedObservable = new GroupedObservable(key, group, this);
            this.destination.next(groupedObservable);
            if (this.durationSelector) {
                var duration = void 0;
                try {
                    duration = this.durationSelector(new GroupedObservable(key, group));
                }
                catch (err) {
                    this.error(err);
                    return;
                }
                this.add(duration.subscribe(new GroupDurationSubscriber(key, group, this)));
            }
        }
        if (!group.closed) {
            group.next(element);
        }
    };
    GroupBySubscriber.prototype._error = function (err) {
        var groups = this.groups;
        if (groups) {
            groups.forEach(function (group, key) {
                group.error(err);
            });
            groups.clear();
        }
        this.destination.error(err);
    };
    GroupBySubscriber.prototype._complete = function () {
        var groups = this.groups;
        if (groups) {
            groups.forEach(function (group, key) {
                group.complete();
            });
            groups.clear();
        }
        this.destination.complete();
    };
    GroupBySubscriber.prototype.removeGroup = function (key) {
        this.groups.delete(key);
    };
    GroupBySubscriber.prototype.unsubscribe = function () {
        if (!this.closed) {
            this.attemptedToUnsubscribe = true;
            if (this.count === 0) {
                _super.prototype.unsubscribe.call(this);
            }
        }
    };
    return GroupBySubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_2__/* .Subscriber */ .L));
var GroupDurationSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(GroupDurationSubscriber, _super);
    function GroupDurationSubscriber(key, group, parent) {
        var _this = _super.call(this, group) || this;
        _this.key = key;
        _this.group = group;
        _this.parent = parent;
        return _this;
    }
    GroupDurationSubscriber.prototype._next = function (value) {
        this.complete();
    };
    GroupDurationSubscriber.prototype._unsubscribe = function () {
        var _a = this, parent = _a.parent, key = _a.key;
        this.key = this.parent = null;
        if (parent) {
            parent.removeGroup(key);
        }
    };
    return GroupDurationSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_2__/* .Subscriber */ .L));
var GroupedObservable = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(GroupedObservable, _super);
    function GroupedObservable(key, groupSubject, refCountSubscription) {
        var _this = _super.call(this) || this;
        _this.key = key;
        _this.groupSubject = groupSubject;
        _this.refCountSubscription = refCountSubscription;
        return _this;
    }
    GroupedObservable.prototype._subscribe = function (subscriber) {
        var subscription = new _Subscription__WEBPACK_IMPORTED_MODULE_3__/* .Subscription */ .w();
        var _a = this, refCountSubscription = _a.refCountSubscription, groupSubject = _a.groupSubject;
        if (refCountSubscription && !refCountSubscription.closed) {
            subscription.add(new InnerRefCountSubscription(refCountSubscription));
        }
        subscription.add(groupSubject.subscribe(subscriber));
        return subscription;
    };
    return GroupedObservable;
}(_Observable__WEBPACK_IMPORTED_MODULE_4__/* .Observable */ .y));

var InnerRefCountSubscription = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(InnerRefCountSubscription, _super);
    function InnerRefCountSubscription(parent) {
        var _this = _super.call(this) || this;
        _this.parent = parent;
        parent.count++;
        return _this;
    }
    InnerRefCountSubscription.prototype.unsubscribe = function () {
        var parent = this.parent;
        if (!parent.closed && !this.closed) {
            _super.prototype.unsubscribe.call(this);
            parent.count -= 1;
            if (parent.count === 0 && parent.attemptedToUnsubscribe) {
                parent.unsubscribe();
            }
        }
    };
    return InnerRefCountSubscription;
}(_Subscription__WEBPACK_IMPORTED_MODULE_3__/* .Subscription */ .w));
//# sourceMappingURL=groupBy.js.map


/***/ }),

/***/ 5709:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "U": () => (/* binding */ map)
/* harmony export */ });
/* unused harmony export MapOperator */
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Subscriber__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(979);
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function map(project, thisArg) {
    return function mapOperation(source) {
        if (typeof project !== 'function') {
            throw new TypeError('argument is not a function. Are you looking for `mapTo()`?');
        }
        return source.lift(new MapOperator(project, thisArg));
    };
}
var MapOperator = /*@__PURE__*/ (function () {
    function MapOperator(project, thisArg) {
        this.project = project;
        this.thisArg = thisArg;
    }
    MapOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new MapSubscriber(subscriber, this.project, this.thisArg));
    };
    return MapOperator;
}());

var MapSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(MapSubscriber, _super);
    function MapSubscriber(destination, project, thisArg) {
        var _this = _super.call(this, destination) || this;
        _this.project = project;
        _this.count = 0;
        _this.thisArg = thisArg || _this;
        return _this;
    }
    MapSubscriber.prototype._next = function (value) {
        var result;
        try {
            result = this.project.call(this.thisArg, value, this.count++);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        this.destination.next(result);
    };
    return MapSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_1__/* .Subscriber */ .L));
//# sourceMappingURL=map.js.map


/***/ }),

/***/ 2556:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "J": () => (/* binding */ mergeAll)
/* harmony export */ });
/* harmony import */ var _mergeMap__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(7746);
/* harmony import */ var _util_identity__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(3608);
/** PURE_IMPORTS_START _mergeMap,_util_identity PURE_IMPORTS_END */


function mergeAll(concurrent) {
    if (concurrent === void 0) {
        concurrent = Number.POSITIVE_INFINITY;
    }
    return (0,_mergeMap__WEBPACK_IMPORTED_MODULE_0__/* .mergeMap */ .zg)(_util_identity__WEBPACK_IMPORTED_MODULE_1__/* .identity */ .y, concurrent);
}
//# sourceMappingURL=mergeAll.js.map


/***/ }),

/***/ 7746:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "zg": () => (/* binding */ mergeMap),
/* harmony export */   "VS": () => (/* binding */ flatMap)
/* harmony export */ });
/* unused harmony exports MergeMapOperator, MergeMapSubscriber */
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(5987);
/* harmony import */ var _map__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(5709);
/* harmony import */ var _observable_from__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5760);
/* harmony import */ var _innerSubscribe__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(7604);
/** PURE_IMPORTS_START tslib,_map,_observable_from,_innerSubscribe PURE_IMPORTS_END */




function mergeMap(project, resultSelector, concurrent) {
    if (concurrent === void 0) {
        concurrent = Number.POSITIVE_INFINITY;
    }
    if (typeof resultSelector === 'function') {
        return function (source) { return source.pipe(mergeMap(function (a, i) { return (0,_observable_from__WEBPACK_IMPORTED_MODULE_0__/* .from */ .D)(project(a, i)).pipe((0,_map__WEBPACK_IMPORTED_MODULE_1__/* .map */ .U)(function (b, ii) { return resultSelector(a, b, i, ii); })); }, concurrent)); };
    }
    else if (typeof resultSelector === 'number') {
        concurrent = resultSelector;
    }
    return function (source) { return source.lift(new MergeMapOperator(project, concurrent)); };
}
var MergeMapOperator = /*@__PURE__*/ (function () {
    function MergeMapOperator(project, concurrent) {
        if (concurrent === void 0) {
            concurrent = Number.POSITIVE_INFINITY;
        }
        this.project = project;
        this.concurrent = concurrent;
    }
    MergeMapOperator.prototype.call = function (observer, source) {
        return source.subscribe(new MergeMapSubscriber(observer, this.project, this.concurrent));
    };
    return MergeMapOperator;
}());

var MergeMapSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_2__/* .__extends */ .ZT(MergeMapSubscriber, _super);
    function MergeMapSubscriber(destination, project, concurrent) {
        if (concurrent === void 0) {
            concurrent = Number.POSITIVE_INFINITY;
        }
        var _this = _super.call(this, destination) || this;
        _this.project = project;
        _this.concurrent = concurrent;
        _this.hasCompleted = false;
        _this.buffer = [];
        _this.active = 0;
        _this.index = 0;
        return _this;
    }
    MergeMapSubscriber.prototype._next = function (value) {
        if (this.active < this.concurrent) {
            this._tryNext(value);
        }
        else {
            this.buffer.push(value);
        }
    };
    MergeMapSubscriber.prototype._tryNext = function (value) {
        var result;
        var index = this.index++;
        try {
            result = this.project(value, index);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        this.active++;
        this._innerSub(result);
    };
    MergeMapSubscriber.prototype._innerSub = function (ish) {
        var innerSubscriber = new _innerSubscribe__WEBPACK_IMPORTED_MODULE_3__/* .SimpleInnerSubscriber */ .IY(this);
        var destination = this.destination;
        destination.add(innerSubscriber);
        var innerSubscription = (0,_innerSubscribe__WEBPACK_IMPORTED_MODULE_3__/* .innerSubscribe */ .ft)(ish, innerSubscriber);
        if (innerSubscription !== innerSubscriber) {
            destination.add(innerSubscription);
        }
    };
    MergeMapSubscriber.prototype._complete = function () {
        this.hasCompleted = true;
        if (this.active === 0 && this.buffer.length === 0) {
            this.destination.complete();
        }
        this.unsubscribe();
    };
    MergeMapSubscriber.prototype.notifyNext = function (innerValue) {
        this.destination.next(innerValue);
    };
    MergeMapSubscriber.prototype.notifyComplete = function () {
        var buffer = this.buffer;
        this.active--;
        if (buffer.length > 0) {
            this._next(buffer.shift());
        }
        else if (this.active === 0 && this.hasCompleted) {
            this.destination.complete();
        }
    };
    return MergeMapSubscriber;
}(_innerSubscribe__WEBPACK_IMPORTED_MODULE_3__/* .SimpleOuterSubscriber */ .Ds));

var flatMap = mergeMap;
//# sourceMappingURL=mergeMap.js.map


/***/ }),

/***/ 9276:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "QV": () => (/* binding */ observeOn),
/* harmony export */   "ht": () => (/* binding */ ObserveOnSubscriber)
/* harmony export */ });
/* unused harmony exports ObserveOnOperator, ObserveOnMessage */
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Subscriber__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(979);
/* harmony import */ var _Notification__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(2632);
/** PURE_IMPORTS_START tslib,_Subscriber,_Notification PURE_IMPORTS_END */



function observeOn(scheduler, delay) {
    if (delay === void 0) {
        delay = 0;
    }
    return function observeOnOperatorFunction(source) {
        return source.lift(new ObserveOnOperator(scheduler, delay));
    };
}
var ObserveOnOperator = /*@__PURE__*/ (function () {
    function ObserveOnOperator(scheduler, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        this.scheduler = scheduler;
        this.delay = delay;
    }
    ObserveOnOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new ObserveOnSubscriber(subscriber, this.scheduler, this.delay));
    };
    return ObserveOnOperator;
}());

var ObserveOnSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(ObserveOnSubscriber, _super);
    function ObserveOnSubscriber(destination, scheduler, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        var _this = _super.call(this, destination) || this;
        _this.scheduler = scheduler;
        _this.delay = delay;
        return _this;
    }
    ObserveOnSubscriber.dispatch = function (arg) {
        var notification = arg.notification, destination = arg.destination;
        notification.observe(destination);
        this.unsubscribe();
    };
    ObserveOnSubscriber.prototype.scheduleMessage = function (notification) {
        var destination = this.destination;
        destination.add(this.scheduler.schedule(ObserveOnSubscriber.dispatch, this.delay, new ObserveOnMessage(notification, this.destination)));
    };
    ObserveOnSubscriber.prototype._next = function (value) {
        this.scheduleMessage(_Notification__WEBPACK_IMPORTED_MODULE_1__/* .Notification.createNext */ .P.createNext(value));
    };
    ObserveOnSubscriber.prototype._error = function (err) {
        this.scheduleMessage(_Notification__WEBPACK_IMPORTED_MODULE_1__/* .Notification.createError */ .P.createError(err));
        this.unsubscribe();
    };
    ObserveOnSubscriber.prototype._complete = function () {
        this.scheduleMessage(_Notification__WEBPACK_IMPORTED_MODULE_1__/* .Notification.createComplete */ .P.createComplete());
        this.unsubscribe();
    };
    return ObserveOnSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_2__/* .Subscriber */ .L));

var ObserveOnMessage = /*@__PURE__*/ (function () {
    function ObserveOnMessage(notification, destination) {
        this.notification = notification;
        this.destination = destination;
    }
    return ObserveOnMessage;
}());

//# sourceMappingURL=observeOn.js.map


/***/ }),

/***/ 3018:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "x": () => (/* binding */ refCount)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Subscriber__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(979);
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function refCount() {
    return function refCountOperatorFunction(source) {
        return source.lift(new RefCountOperator(source));
    };
}
var RefCountOperator = /*@__PURE__*/ (function () {
    function RefCountOperator(connectable) {
        this.connectable = connectable;
    }
    RefCountOperator.prototype.call = function (subscriber, source) {
        var connectable = this.connectable;
        connectable._refCount++;
        var refCounter = new RefCountSubscriber(subscriber, connectable);
        var subscription = source.subscribe(refCounter);
        if (!refCounter.closed) {
            refCounter.connection = connectable.connect();
        }
        return subscription;
    };
    return RefCountOperator;
}());
var RefCountSubscriber = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(RefCountSubscriber, _super);
    function RefCountSubscriber(destination, connectable) {
        var _this = _super.call(this, destination) || this;
        _this.connectable = connectable;
        return _this;
    }
    RefCountSubscriber.prototype._unsubscribe = function () {
        var connectable = this.connectable;
        if (!connectable) {
            this.connection = null;
            return;
        }
        this.connectable = null;
        var refCount = connectable._refCount;
        if (refCount <= 0) {
            this.connection = null;
            return;
        }
        connectable._refCount = refCount - 1;
        if (refCount > 1) {
            this.connection = null;
            return;
        }
        var connection = this.connection;
        var sharedConnection = connectable._connection;
        this.connection = null;
        if (sharedConnection && (!connection || sharedConnection === connection)) {
            sharedConnection.unsubscribe();
        }
    };
    return RefCountSubscriber;
}(_Subscriber__WEBPACK_IMPORTED_MODULE_1__/* .Subscriber */ .L));
//# sourceMappingURL=refCount.js.map


/***/ }),

/***/ 3109:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "r": () => (/* binding */ scheduleArray)
/* harmony export */ });
/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(2772);
/* harmony import */ var _Subscription__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(8760);
/** PURE_IMPORTS_START _Observable,_Subscription PURE_IMPORTS_END */


function scheduleArray(input, scheduler) {
    return new _Observable__WEBPACK_IMPORTED_MODULE_0__/* .Observable */ .y(function (subscriber) {
        var sub = new _Subscription__WEBPACK_IMPORTED_MODULE_1__/* .Subscription */ .w();
        var i = 0;
        sub.add(scheduler.schedule(function () {
            if (i === input.length) {
                subscriber.complete();
                return;
            }
            subscriber.next(input[i++]);
            if (!subscriber.closed) {
                sub.add(this.schedule());
            }
        }));
        return sub;
    });
}
//# sourceMappingURL=scheduleArray.js.map


/***/ }),

/***/ 8107:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "x": () => (/* binding */ scheduled)
});

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Observable.js + 1 modules
var Observable = __webpack_require__(2772);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Subscription.js
var Subscription = __webpack_require__(8760);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/symbol/observable.js
var symbol_observable = __webpack_require__(5050);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduled/scheduleObservable.js
/** PURE_IMPORTS_START _Observable,_Subscription,_symbol_observable PURE_IMPORTS_END */



function scheduleObservable(input, scheduler) {
    return new Observable/* Observable */.y(function (subscriber) {
        var sub = new Subscription/* Subscription */.w();
        sub.add(scheduler.schedule(function () {
            var observable = input[symbol_observable/* observable */.L]();
            sub.add(observable.subscribe({
                next: function (value) { sub.add(scheduler.schedule(function () { return subscriber.next(value); })); },
                error: function (err) { sub.add(scheduler.schedule(function () { return subscriber.error(err); })); },
                complete: function () { sub.add(scheduler.schedule(function () { return subscriber.complete(); })); },
            }));
        }));
        return sub;
    });
}
//# sourceMappingURL=scheduleObservable.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduled/schedulePromise.js
/** PURE_IMPORTS_START _Observable,_Subscription PURE_IMPORTS_END */


function schedulePromise(input, scheduler) {
    return new Observable/* Observable */.y(function (subscriber) {
        var sub = new Subscription/* Subscription */.w();
        sub.add(scheduler.schedule(function () {
            return input.then(function (value) {
                sub.add(scheduler.schedule(function () {
                    subscriber.next(value);
                    sub.add(scheduler.schedule(function () { return subscriber.complete(); }));
                }));
            }, function (err) {
                sub.add(scheduler.schedule(function () { return subscriber.error(err); }));
            });
        }));
        return sub;
    });
}
//# sourceMappingURL=schedulePromise.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduled/scheduleArray.js
var scheduleArray = __webpack_require__(3109);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/symbol/iterator.js
var symbol_iterator = __webpack_require__(999);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduled/scheduleIterable.js
/** PURE_IMPORTS_START _Observable,_Subscription,_symbol_iterator PURE_IMPORTS_END */



function scheduleIterable(input, scheduler) {
    if (!input) {
        throw new Error('Iterable cannot be null');
    }
    return new Observable/* Observable */.y(function (subscriber) {
        var sub = new Subscription/* Subscription */.w();
        var iterator;
        sub.add(function () {
            if (iterator && typeof iterator.return === 'function') {
                iterator.return();
            }
        });
        sub.add(scheduler.schedule(function () {
            iterator = input[symbol_iterator/* iterator */.hZ]();
            sub.add(scheduler.schedule(function () {
                if (subscriber.closed) {
                    return;
                }
                var value;
                var done;
                try {
                    var result = iterator.next();
                    value = result.value;
                    done = result.done;
                }
                catch (err) {
                    subscriber.error(err);
                    return;
                }
                if (done) {
                    subscriber.complete();
                }
                else {
                    subscriber.next(value);
                    this.schedule();
                }
            }));
        }));
        return sub;
    });
}
//# sourceMappingURL=scheduleIterable.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/util/isInteropObservable.js
/** PURE_IMPORTS_START _symbol_observable PURE_IMPORTS_END */

function isInteropObservable(input) {
    return input && typeof input[symbol_observable/* observable */.L] === 'function';
}
//# sourceMappingURL=isInteropObservable.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isPromise.js
var isPromise = __webpack_require__(336);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isArrayLike.js
var isArrayLike = __webpack_require__(9217);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/util/isIterable.js
/** PURE_IMPORTS_START _symbol_iterator PURE_IMPORTS_END */

function isIterable(input) {
    return input && typeof input[symbol_iterator/* iterator */.hZ] === 'function';
}
//# sourceMappingURL=isIterable.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduled/scheduled.js
/** PURE_IMPORTS_START _scheduleObservable,_schedulePromise,_scheduleArray,_scheduleIterable,_util_isInteropObservable,_util_isPromise,_util_isArrayLike,_util_isIterable PURE_IMPORTS_END */








function scheduled(input, scheduler) {
    if (input != null) {
        if (isInteropObservable(input)) {
            return scheduleObservable(input, scheduler);
        }
        else if ((0,isPromise/* isPromise */.t)(input)) {
            return schedulePromise(input, scheduler);
        }
        else if ((0,isArrayLike/* isArrayLike */.z)(input)) {
            return (0,scheduleArray/* scheduleArray */.r)(input, scheduler);
        }
        else if (isIterable(input) || typeof input === 'string') {
            return scheduleIterable(input, scheduler);
        }
    }
    throw new TypeError((input !== null && typeof input || input) + ' is not observable');
}
//# sourceMappingURL=scheduled.js.map


/***/ }),

/***/ 6114:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "o": () => (/* binding */ AsyncAction)
});

// EXTERNAL MODULE: ./node_modules/rxjs/node_modules/tslib/tslib.es6.js
var tslib_es6 = __webpack_require__(5987);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Subscription.js
var Subscription = __webpack_require__(8760);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/Action.js
/** PURE_IMPORTS_START tslib,_Subscription PURE_IMPORTS_END */


var Action = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(Action, _super);
    function Action(scheduler, work) {
        return _super.call(this) || this;
    }
    Action.prototype.schedule = function (state, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        return this;
    };
    return Action;
}(Subscription/* Subscription */.w));

//# sourceMappingURL=Action.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/AsyncAction.js
/** PURE_IMPORTS_START tslib,_Action PURE_IMPORTS_END */


var AsyncAction = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(AsyncAction, _super);
    function AsyncAction(scheduler, work) {
        var _this = _super.call(this, scheduler, work) || this;
        _this.scheduler = scheduler;
        _this.work = work;
        _this.pending = false;
        return _this;
    }
    AsyncAction.prototype.schedule = function (state, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if (this.closed) {
            return this;
        }
        this.state = state;
        var id = this.id;
        var scheduler = this.scheduler;
        if (id != null) {
            this.id = this.recycleAsyncId(scheduler, id, delay);
        }
        this.pending = true;
        this.delay = delay;
        this.id = this.id || this.requestAsyncId(scheduler, this.id, delay);
        return this;
    };
    AsyncAction.prototype.requestAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        return setInterval(scheduler.flush.bind(scheduler, this), delay);
    };
    AsyncAction.prototype.recycleAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if (delay !== null && this.delay === delay && this.pending === false) {
            return id;
        }
        clearInterval(id);
        return undefined;
    };
    AsyncAction.prototype.execute = function (state, delay) {
        if (this.closed) {
            return new Error('executing a cancelled action');
        }
        this.pending = false;
        var error = this._execute(state, delay);
        if (error) {
            return error;
        }
        else if (this.pending === false && this.id != null) {
            this.id = this.recycleAsyncId(this.scheduler, this.id, null);
        }
    };
    AsyncAction.prototype._execute = function (state, delay) {
        var errored = false;
        var errorValue = undefined;
        try {
            this.work(state);
        }
        catch (e) {
            errored = true;
            errorValue = !!e && e || new Error(e);
        }
        if (errored) {
            this.unsubscribe();
            return errorValue;
        }
    };
    AsyncAction.prototype._unsubscribe = function () {
        var id = this.id;
        var scheduler = this.scheduler;
        var actions = scheduler.actions;
        var index = actions.indexOf(this);
        this.work = null;
        this.state = null;
        this.pending = false;
        this.scheduler = null;
        if (index !== -1) {
            actions.splice(index, 1);
        }
        if (id != null) {
            this.id = this.recycleAsyncId(scheduler, id, null);
        }
        this.delay = null;
    };
    return AsyncAction;
}(Action));

//# sourceMappingURL=AsyncAction.js.map


/***/ }),

/***/ 8399:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "v": () => (/* binding */ AsyncScheduler)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5987);
/* harmony import */ var _Scheduler__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(8725);
/** PURE_IMPORTS_START tslib,_Scheduler PURE_IMPORTS_END */


var AsyncScheduler = /*@__PURE__*/ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__/* .__extends */ .ZT(AsyncScheduler, _super);
    function AsyncScheduler(SchedulerAction, now) {
        if (now === void 0) {
            now = _Scheduler__WEBPACK_IMPORTED_MODULE_1__/* .Scheduler.now */ .b.now;
        }
        var _this = _super.call(this, SchedulerAction, function () {
            if (AsyncScheduler.delegate && AsyncScheduler.delegate !== _this) {
                return AsyncScheduler.delegate.now();
            }
            else {
                return now();
            }
        }) || this;
        _this.actions = [];
        _this.active = false;
        _this.scheduled = undefined;
        return _this;
    }
    AsyncScheduler.prototype.schedule = function (work, delay, state) {
        if (delay === void 0) {
            delay = 0;
        }
        if (AsyncScheduler.delegate && AsyncScheduler.delegate !== this) {
            return AsyncScheduler.delegate.schedule(work, delay, state);
        }
        else {
            return _super.prototype.schedule.call(this, work, delay, state);
        }
    };
    AsyncScheduler.prototype.flush = function (action) {
        var actions = this.actions;
        if (this.active) {
            actions.push(action);
            return;
        }
        var error;
        this.active = true;
        do {
            if (error = action.execute(action.state, action.delay)) {
                break;
            }
        } while (action = actions.shift());
        this.active = false;
        if (error) {
            while (action = actions.shift()) {
                action.unsubscribe();
            }
            throw error;
        }
    };
    return AsyncScheduler;
}(_Scheduler__WEBPACK_IMPORTED_MODULE_1__/* .Scheduler */ .b));

//# sourceMappingURL=AsyncScheduler.js.map


/***/ }),

/***/ 6650:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "e": () => (/* binding */ asap),
  "E": () => (/* binding */ asapScheduler)
});

// EXTERNAL MODULE: ./node_modules/rxjs/node_modules/tslib/tslib.es6.js
var tslib_es6 = __webpack_require__(5987);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/util/Immediate.js
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var nextHandle = 1;
var RESOLVED = /*@__PURE__*/ (function () { return /*@__PURE__*/ Promise.resolve(); })();
var activeHandles = {};
function findAndClearHandle(handle) {
    if (handle in activeHandles) {
        delete activeHandles[handle];
        return true;
    }
    return false;
}
var Immediate = {
    setImmediate: function (cb) {
        var handle = nextHandle++;
        activeHandles[handle] = true;
        RESOLVED.then(function () { return findAndClearHandle(handle) && cb(); });
        return handle;
    },
    clearImmediate: function (handle) {
        findAndClearHandle(handle);
    },
};
var TestTools = {
    pending: function () {
        return Object.keys(activeHandles).length;
    }
};
//# sourceMappingURL=Immediate.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/AsyncAction.js + 1 modules
var AsyncAction = __webpack_require__(6114);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/AsapAction.js
/** PURE_IMPORTS_START tslib,_util_Immediate,_AsyncAction PURE_IMPORTS_END */



var AsapAction = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(AsapAction, _super);
    function AsapAction(scheduler, work) {
        var _this = _super.call(this, scheduler, work) || this;
        _this.scheduler = scheduler;
        _this.work = work;
        return _this;
    }
    AsapAction.prototype.requestAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if (delay !== null && delay > 0) {
            return _super.prototype.requestAsyncId.call(this, scheduler, id, delay);
        }
        scheduler.actions.push(this);
        return scheduler.scheduled || (scheduler.scheduled = Immediate.setImmediate(scheduler.flush.bind(scheduler, null)));
    };
    AsapAction.prototype.recycleAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if ((delay !== null && delay > 0) || (delay === null && this.delay > 0)) {
            return _super.prototype.recycleAsyncId.call(this, scheduler, id, delay);
        }
        if (scheduler.actions.length === 0) {
            Immediate.clearImmediate(id);
            scheduler.scheduled = undefined;
        }
        return undefined;
    };
    return AsapAction;
}(AsyncAction/* AsyncAction */.o));

//# sourceMappingURL=AsapAction.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/AsyncScheduler.js
var AsyncScheduler = __webpack_require__(8399);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/AsapScheduler.js
/** PURE_IMPORTS_START tslib,_AsyncScheduler PURE_IMPORTS_END */


var AsapScheduler = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(AsapScheduler, _super);
    function AsapScheduler() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AsapScheduler.prototype.flush = function (action) {
        this.active = true;
        this.scheduled = undefined;
        var actions = this.actions;
        var error;
        var index = -1;
        var count = actions.length;
        action = action || actions.shift();
        do {
            if (error = action.execute(action.state, action.delay)) {
                break;
            }
        } while (++index < count && (action = actions.shift()));
        this.active = false;
        if (error) {
            while (++index < count && (action = actions.shift())) {
                action.unsubscribe();
            }
            throw error;
        }
    };
    return AsapScheduler;
}(AsyncScheduler/* AsyncScheduler */.v));

//# sourceMappingURL=AsapScheduler.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/asap.js
/** PURE_IMPORTS_START _AsapAction,_AsapScheduler PURE_IMPORTS_END */


var asapScheduler = /*@__PURE__*/ new AsapScheduler(AsapAction);
var asap = asapScheduler;
//# sourceMappingURL=asap.js.map


/***/ }),

/***/ 964:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "z": () => (/* binding */ asyncScheduler),
/* harmony export */   "P": () => (/* binding */ async)
/* harmony export */ });
/* harmony import */ var _AsyncAction__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(6114);
/* harmony import */ var _AsyncScheduler__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(8399);
/** PURE_IMPORTS_START _AsyncAction,_AsyncScheduler PURE_IMPORTS_END */


var asyncScheduler = /*@__PURE__*/ new _AsyncScheduler__WEBPACK_IMPORTED_MODULE_0__/* .AsyncScheduler */ .v(_AsyncAction__WEBPACK_IMPORTED_MODULE_1__/* .AsyncAction */ .o);
var async = asyncScheduler;
//# sourceMappingURL=async.js.map


/***/ }),

/***/ 2546:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "c": () => (/* binding */ queue),
  "N": () => (/* binding */ queueScheduler)
});

// EXTERNAL MODULE: ./node_modules/rxjs/node_modules/tslib/tslib.es6.js
var tslib_es6 = __webpack_require__(5987);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/AsyncAction.js + 1 modules
var AsyncAction = __webpack_require__(6114);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/QueueAction.js
/** PURE_IMPORTS_START tslib,_AsyncAction PURE_IMPORTS_END */


var QueueAction = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(QueueAction, _super);
    function QueueAction(scheduler, work) {
        var _this = _super.call(this, scheduler, work) || this;
        _this.scheduler = scheduler;
        _this.work = work;
        return _this;
    }
    QueueAction.prototype.schedule = function (state, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if (delay > 0) {
            return _super.prototype.schedule.call(this, state, delay);
        }
        this.delay = delay;
        this.state = state;
        this.scheduler.flush(this);
        return this;
    };
    QueueAction.prototype.execute = function (state, delay) {
        return (delay > 0 || this.closed) ?
            _super.prototype.execute.call(this, state, delay) :
            this._execute(state, delay);
    };
    QueueAction.prototype.requestAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if ((delay !== null && delay > 0) || (delay === null && this.delay > 0)) {
            return _super.prototype.requestAsyncId.call(this, scheduler, id, delay);
        }
        return scheduler.flush(this);
    };
    return QueueAction;
}(AsyncAction/* AsyncAction */.o));

//# sourceMappingURL=QueueAction.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/AsyncScheduler.js
var AsyncScheduler = __webpack_require__(8399);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/QueueScheduler.js
/** PURE_IMPORTS_START tslib,_AsyncScheduler PURE_IMPORTS_END */


var QueueScheduler = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(QueueScheduler, _super);
    function QueueScheduler() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return QueueScheduler;
}(AsyncScheduler/* AsyncScheduler */.v));

//# sourceMappingURL=QueueScheduler.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/queue.js
/** PURE_IMPORTS_START _QueueAction,_QueueScheduler PURE_IMPORTS_END */


var queueScheduler = /*@__PURE__*/ new QueueScheduler(QueueAction);
var queue = queueScheduler;
//# sourceMappingURL=queue.js.map


/***/ }),

/***/ 999:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "hZ": () => (/* binding */ iterator)
/* harmony export */ });
/* unused harmony exports getSymbolIterator, $$iterator */
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function getSymbolIterator() {
    if (typeof Symbol !== 'function' || !Symbol.iterator) {
        return '@@iterator';
    }
    return Symbol.iterator;
}
var iterator = /*@__PURE__*/ getSymbolIterator();
var $$iterator = (/* unused pure expression or super */ null && (iterator));
//# sourceMappingURL=iterator.js.map


/***/ }),

/***/ 5050:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "L": () => (/* binding */ observable)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var observable = /*@__PURE__*/ (function () { return typeof Symbol === 'function' && Symbol.observable || '@@observable'; })();
//# sourceMappingURL=observable.js.map


/***/ }),

/***/ 3142:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "b": () => (/* binding */ rxSubscriber)
/* harmony export */ });
/* unused harmony export $$rxSubscriber */
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var rxSubscriber = /*@__PURE__*/ (function () {
    return typeof Symbol === 'function'
        ? /*@__PURE__*/ Symbol('rxSubscriber')
        : '@@rxSubscriber_' + /*@__PURE__*/ Math.random();
})();
var $$rxSubscriber = (/* unused pure expression or super */ null && (rxSubscriber));
//# sourceMappingURL=rxSubscriber.js.map


/***/ }),

/***/ 6565:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "W": () => (/* binding */ ArgumentOutOfRangeError)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var ArgumentOutOfRangeErrorImpl = /*@__PURE__*/ (function () {
    function ArgumentOutOfRangeErrorImpl() {
        Error.call(this);
        this.message = 'argument out of range';
        this.name = 'ArgumentOutOfRangeError';
        return this;
    }
    ArgumentOutOfRangeErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);
    return ArgumentOutOfRangeErrorImpl;
})();
var ArgumentOutOfRangeError = ArgumentOutOfRangeErrorImpl;
//# sourceMappingURL=ArgumentOutOfRangeError.js.map


/***/ }),

/***/ 6929:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "K": () => (/* binding */ EmptyError)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var EmptyErrorImpl = /*@__PURE__*/ (function () {
    function EmptyErrorImpl() {
        Error.call(this);
        this.message = 'no elements in sequence';
        this.name = 'EmptyError';
        return this;
    }
    EmptyErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);
    return EmptyErrorImpl;
})();
var EmptyError = EmptyErrorImpl;
//# sourceMappingURL=EmptyError.js.map


/***/ }),

/***/ 1016:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "N": () => (/* binding */ ObjectUnsubscribedError)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var ObjectUnsubscribedErrorImpl = /*@__PURE__*/ (function () {
    function ObjectUnsubscribedErrorImpl() {
        Error.call(this);
        this.message = 'object unsubscribed';
        this.name = 'ObjectUnsubscribedError';
        return this;
    }
    ObjectUnsubscribedErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);
    return ObjectUnsubscribedErrorImpl;
})();
var ObjectUnsubscribedError = ObjectUnsubscribedErrorImpl;
//# sourceMappingURL=ObjectUnsubscribedError.js.map


/***/ }),

/***/ 1462:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "W": () => (/* binding */ TimeoutError)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var TimeoutErrorImpl = /*@__PURE__*/ (function () {
    function TimeoutErrorImpl() {
        Error.call(this);
        this.message = 'Timeout has occurred';
        this.name = 'TimeoutError';
        return this;
    }
    TimeoutErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);
    return TimeoutErrorImpl;
})();
var TimeoutError = TimeoutErrorImpl;
//# sourceMappingURL=TimeoutError.js.map


/***/ }),

/***/ 8782:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "B": () => (/* binding */ UnsubscriptionError)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var UnsubscriptionErrorImpl = /*@__PURE__*/ (function () {
    function UnsubscriptionErrorImpl(errors) {
        Error.call(this);
        this.message = errors ?
            errors.length + " errors occurred during unsubscription:\n" + errors.map(function (err, i) { return i + 1 + ") " + err.toString(); }).join('\n  ') : '';
        this.name = 'UnsubscriptionError';
        this.errors = errors;
        return this;
    }
    UnsubscriptionErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);
    return UnsubscriptionErrorImpl;
})();
var UnsubscriptionError = UnsubscriptionErrorImpl;
//# sourceMappingURL=UnsubscriptionError.js.map


/***/ }),

/***/ 3642:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "_": () => (/* binding */ canReportError)
/* harmony export */ });
/* harmony import */ var _Subscriber__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(979);
/** PURE_IMPORTS_START _Subscriber PURE_IMPORTS_END */

function canReportError(observer) {
    while (observer) {
        var _a = observer, closed_1 = _a.closed, destination = _a.destination, isStopped = _a.isStopped;
        if (closed_1 || isStopped) {
            return false;
        }
        else if (destination && destination instanceof _Subscriber__WEBPACK_IMPORTED_MODULE_0__/* .Subscriber */ .L) {
            observer = destination;
        }
        else {
            observer = null;
        }
    }
    return true;
}
//# sourceMappingURL=canReportError.js.map


/***/ }),

/***/ 1644:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "z": () => (/* binding */ hostReportError)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function hostReportError(err) {
    setTimeout(function () { throw err; }, 0);
}
//# sourceMappingURL=hostReportError.js.map


/***/ }),

/***/ 3608:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "y": () => (/* binding */ identity)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function identity(x) {
    return x;
}
//# sourceMappingURL=identity.js.map


/***/ }),

/***/ 9026:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "k": () => (/* binding */ isArray)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var isArray = /*@__PURE__*/ (function () { return Array.isArray || (function (x) { return x && typeof x.length === 'number'; }); })();
//# sourceMappingURL=isArray.js.map


/***/ }),

/***/ 9217:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "z": () => (/* binding */ isArrayLike)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var isArrayLike = (function (x) { return x && typeof x.length === 'number' && typeof x !== 'function'; });
//# sourceMappingURL=isArrayLike.js.map


/***/ }),

/***/ 4156:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "m": () => (/* binding */ isFunction)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function isFunction(x) {
    return typeof x === 'function';
}
//# sourceMappingURL=isFunction.js.map


/***/ }),

/***/ 5812:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "k": () => (/* binding */ isNumeric)
/* harmony export */ });
/* harmony import */ var _isArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(9026);
/** PURE_IMPORTS_START _isArray PURE_IMPORTS_END */

function isNumeric(val) {
    return !(0,_isArray__WEBPACK_IMPORTED_MODULE_0__/* .isArray */ .k)(val) && (val - parseFloat(val) + 1) >= 0;
}
//# sourceMappingURL=isNumeric.js.map


/***/ }),

/***/ 2009:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "K": () => (/* binding */ isObject)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function isObject(x) {
    return x !== null && typeof x === 'object';
}
//# sourceMappingURL=isObject.js.map


/***/ }),

/***/ 336:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "t": () => (/* binding */ isPromise)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function isPromise(value) {
    return !!value && typeof value.subscribe !== 'function' && typeof value.then === 'function';
}
//# sourceMappingURL=isPromise.js.map


/***/ }),

/***/ 7507:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "K": () => (/* binding */ isScheduler)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function isScheduler(value) {
    return value && typeof value.schedule === 'function';
}
//# sourceMappingURL=isScheduler.js.map


/***/ }),

/***/ 3306:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Z": () => (/* binding */ noop)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function noop() { }
//# sourceMappingURL=noop.js.map


/***/ }),

/***/ 8463:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "f": () => (/* binding */ not)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function not(pred, thisArg) {
    function notPred() {
        return !(notPred.pred.apply(notPred.thisArg, arguments));
    }
    notPred.pred = pred;
    notPred.thisArg = thisArg;
    return notPred;
}
//# sourceMappingURL=not.js.map


/***/ }),

/***/ 2561:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "z": () => (/* binding */ pipe),
/* harmony export */   "U": () => (/* binding */ pipeFromArray)
/* harmony export */ });
/* harmony import */ var _identity__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(3608);
/** PURE_IMPORTS_START _identity PURE_IMPORTS_END */

function pipe() {
    var fns = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        fns[_i] = arguments[_i];
    }
    return pipeFromArray(fns);
}
function pipeFromArray(fns) {
    if (fns.length === 0) {
        return _identity__WEBPACK_IMPORTED_MODULE_0__/* .identity */ .y;
    }
    if (fns.length === 1) {
        return fns[0];
    }
    return function piped(input) {
        return fns.reduce(function (prev, fn) { return fn(prev); }, input);
    };
}
//# sourceMappingURL=pipe.js.map


/***/ }),

/***/ 7843:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "s": () => (/* binding */ subscribeTo)
});

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/subscribeToArray.js
var subscribeToArray = __webpack_require__(6900);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/hostReportError.js
var hostReportError = __webpack_require__(1644);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/util/subscribeToPromise.js
/** PURE_IMPORTS_START _hostReportError PURE_IMPORTS_END */

var subscribeToPromise = function (promise) {
    return function (subscriber) {
        promise.then(function (value) {
            if (!subscriber.closed) {
                subscriber.next(value);
                subscriber.complete();
            }
        }, function (err) { return subscriber.error(err); })
            .then(null, hostReportError/* hostReportError */.z);
        return subscriber;
    };
};
//# sourceMappingURL=subscribeToPromise.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/symbol/iterator.js
var symbol_iterator = __webpack_require__(999);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/util/subscribeToIterable.js
/** PURE_IMPORTS_START _symbol_iterator PURE_IMPORTS_END */

var subscribeToIterable = function (iterable) {
    return function (subscriber) {
        var iterator = iterable[symbol_iterator/* iterator */.hZ]();
        do {
            var item = void 0;
            try {
                item = iterator.next();
            }
            catch (err) {
                subscriber.error(err);
                return subscriber;
            }
            if (item.done) {
                subscriber.complete();
                break;
            }
            subscriber.next(item.value);
            if (subscriber.closed) {
                break;
            }
        } while (true);
        if (typeof iterator.return === 'function') {
            subscriber.add(function () {
                if (iterator.return) {
                    iterator.return();
                }
            });
        }
        return subscriber;
    };
};
//# sourceMappingURL=subscribeToIterable.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/symbol/observable.js
var observable = __webpack_require__(5050);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/util/subscribeToObservable.js
/** PURE_IMPORTS_START _symbol_observable PURE_IMPORTS_END */

var subscribeToObservable = function (obj) {
    return function (subscriber) {
        var obs = obj[observable/* observable */.L]();
        if (typeof obs.subscribe !== 'function') {
            throw new TypeError('Provided object does not correctly implement Symbol.observable');
        }
        else {
            return obs.subscribe(subscriber);
        }
    };
};
//# sourceMappingURL=subscribeToObservable.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isArrayLike.js
var isArrayLike = __webpack_require__(9217);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isPromise.js
var isPromise = __webpack_require__(336);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isObject.js
var isObject = __webpack_require__(2009);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/util/subscribeTo.js
/** PURE_IMPORTS_START _subscribeToArray,_subscribeToPromise,_subscribeToIterable,_subscribeToObservable,_isArrayLike,_isPromise,_isObject,_symbol_iterator,_symbol_observable PURE_IMPORTS_END */









var subscribeTo = function (result) {
    if (!!result && typeof result[observable/* observable */.L] === 'function') {
        return subscribeToObservable(result);
    }
    else if ((0,isArrayLike/* isArrayLike */.z)(result)) {
        return (0,subscribeToArray/* subscribeToArray */.V)(result);
    }
    else if ((0,isPromise/* isPromise */.t)(result)) {
        return subscribeToPromise(result);
    }
    else if (!!result && typeof result[symbol_iterator/* iterator */.hZ] === 'function') {
        return subscribeToIterable(result);
    }
    else {
        var value = (0,isObject/* isObject */.K)(result) ? 'an invalid object' : "'" + result + "'";
        var msg = "You provided " + value + " where a stream was expected."
            + ' You can provide an Observable, Promise, Array, or Iterable.';
        throw new TypeError(msg);
    }
};
//# sourceMappingURL=subscribeTo.js.map


/***/ }),

/***/ 6900:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "V": () => (/* binding */ subscribeToArray)
/* harmony export */ });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var subscribeToArray = function (array) {
    return function (subscriber) {
        for (var i = 0, len = array.length; i < len && !subscriber.closed; i++) {
            subscriber.next(array[i]);
        }
        subscriber.complete();
    };
};
//# sourceMappingURL=subscribeToArray.js.map


/***/ }),

/***/ 2080:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "D": () => (/* binding */ subscribeToResult)
});

// EXTERNAL MODULE: ./node_modules/rxjs/node_modules/tslib/tslib.es6.js
var tslib_es6 = __webpack_require__(5987);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Subscriber.js
var Subscriber = __webpack_require__(979);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/InnerSubscriber.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


var InnerSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(InnerSubscriber, _super);
    function InnerSubscriber(parent, outerValue, outerIndex) {
        var _this = _super.call(this) || this;
        _this.parent = parent;
        _this.outerValue = outerValue;
        _this.outerIndex = outerIndex;
        _this.index = 0;
        return _this;
    }
    InnerSubscriber.prototype._next = function (value) {
        this.parent.notifyNext(this.outerValue, value, this.outerIndex, this.index++, this);
    };
    InnerSubscriber.prototype._error = function (error) {
        this.parent.notifyError(error, this);
        this.unsubscribe();
    };
    InnerSubscriber.prototype._complete = function () {
        this.parent.notifyComplete(this);
        this.unsubscribe();
    };
    return InnerSubscriber;
}(Subscriber/* Subscriber */.L));

//# sourceMappingURL=InnerSubscriber.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/subscribeTo.js + 3 modules
var subscribeTo = __webpack_require__(7843);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Observable.js + 1 modules
var Observable = __webpack_require__(2772);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/util/subscribeToResult.js
/** PURE_IMPORTS_START _InnerSubscriber,_subscribeTo,_Observable PURE_IMPORTS_END */



function subscribeToResult(outerSubscriber, result, outerValue, outerIndex, innerSubscriber) {
    if (innerSubscriber === void 0) {
        innerSubscriber = new InnerSubscriber(outerSubscriber, outerValue, outerIndex);
    }
    if (innerSubscriber.closed) {
        return undefined;
    }
    if (result instanceof Observable/* Observable */.y) {
        return result.subscribe(innerSubscriber);
    }
    return (0,subscribeTo/* subscribeTo */.s)(result)(innerSubscriber);
}
//# sourceMappingURL=subscribeToResult.js.map


/***/ }),

/***/ 1717:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "audit": () => (/* reexport */ audit),
  "auditTime": () => (/* reexport */ auditTime),
  "buffer": () => (/* reexport */ buffer),
  "bufferCount": () => (/* reexport */ bufferCount),
  "bufferTime": () => (/* reexport */ bufferTime),
  "bufferToggle": () => (/* reexport */ bufferToggle),
  "bufferWhen": () => (/* reexport */ bufferWhen),
  "catchError": () => (/* reexport */ catchError),
  "combineAll": () => (/* reexport */ combineAll),
  "combineLatest": () => (/* reexport */ combineLatest_combineLatest),
  "concat": () => (/* reexport */ concat_concat),
  "concatAll": () => (/* reexport */ concatAll/* concatAll */.u),
  "concatMap": () => (/* reexport */ concatMap),
  "concatMapTo": () => (/* reexport */ concatMapTo),
  "count": () => (/* reexport */ count),
  "debounce": () => (/* reexport */ debounce),
  "debounceTime": () => (/* reexport */ debounceTime),
  "defaultIfEmpty": () => (/* reexport */ defaultIfEmpty),
  "delay": () => (/* reexport */ delay),
  "delayWhen": () => (/* reexport */ delayWhen),
  "dematerialize": () => (/* reexport */ dematerialize),
  "distinct": () => (/* reexport */ distinct),
  "distinctUntilChanged": () => (/* reexport */ distinctUntilChanged),
  "distinctUntilKeyChanged": () => (/* reexport */ distinctUntilKeyChanged),
  "elementAt": () => (/* reexport */ elementAt),
  "endWith": () => (/* reexport */ endWith),
  "every": () => (/* reexport */ every),
  "exhaust": () => (/* reexport */ exhaust),
  "exhaustMap": () => (/* reexport */ exhaustMap),
  "expand": () => (/* reexport */ expand),
  "filter": () => (/* reexport */ filter/* filter */.h),
  "finalize": () => (/* reexport */ finalize),
  "find": () => (/* reexport */ find),
  "findIndex": () => (/* reexport */ findIndex),
  "first": () => (/* reexport */ first),
  "flatMap": () => (/* reexport */ mergeMap/* flatMap */.VS),
  "groupBy": () => (/* reexport */ groupBy/* groupBy */.v),
  "ignoreElements": () => (/* reexport */ ignoreElements),
  "isEmpty": () => (/* reexport */ isEmpty),
  "last": () => (/* reexport */ last),
  "map": () => (/* reexport */ map/* map */.U),
  "mapTo": () => (/* reexport */ mapTo),
  "materialize": () => (/* reexport */ materialize),
  "max": () => (/* reexport */ max),
  "merge": () => (/* reexport */ merge_merge),
  "mergeAll": () => (/* reexport */ mergeAll/* mergeAll */.J),
  "mergeMap": () => (/* reexport */ mergeMap/* mergeMap */.zg),
  "mergeMapTo": () => (/* reexport */ mergeMapTo),
  "mergeScan": () => (/* reexport */ mergeScan),
  "min": () => (/* reexport */ min),
  "multicast": () => (/* reexport */ multicast),
  "observeOn": () => (/* reexport */ observeOn/* observeOn */.QV),
  "onErrorResumeNext": () => (/* reexport */ onErrorResumeNext),
  "pairwise": () => (/* reexport */ pairwise),
  "partition": () => (/* reexport */ partition),
  "pluck": () => (/* reexport */ pluck),
  "publish": () => (/* reexport */ publish),
  "publishBehavior": () => (/* reexport */ publishBehavior),
  "publishLast": () => (/* reexport */ publishLast),
  "publishReplay": () => (/* reexport */ publishReplay),
  "race": () => (/* reexport */ race_race),
  "reduce": () => (/* reexport */ reduce),
  "refCount": () => (/* reexport */ refCount/* refCount */.x),
  "repeat": () => (/* reexport */ repeat),
  "repeatWhen": () => (/* reexport */ repeatWhen),
  "retry": () => (/* reexport */ retry),
  "retryWhen": () => (/* reexport */ retryWhen),
  "sample": () => (/* reexport */ sample),
  "sampleTime": () => (/* reexport */ sampleTime),
  "scan": () => (/* reexport */ scan),
  "sequenceEqual": () => (/* reexport */ sequenceEqual),
  "share": () => (/* reexport */ share),
  "shareReplay": () => (/* reexport */ shareReplay),
  "single": () => (/* reexport */ single),
  "skip": () => (/* reexport */ skip),
  "skipLast": () => (/* reexport */ skipLast),
  "skipUntil": () => (/* reexport */ skipUntil),
  "skipWhile": () => (/* reexport */ skipWhile),
  "startWith": () => (/* reexport */ startWith),
  "subscribeOn": () => (/* reexport */ subscribeOn),
  "switchAll": () => (/* reexport */ switchAll),
  "switchMap": () => (/* reexport */ switchMap),
  "switchMapTo": () => (/* reexport */ switchMapTo),
  "take": () => (/* reexport */ take),
  "takeLast": () => (/* reexport */ takeLast),
  "takeUntil": () => (/* reexport */ takeUntil),
  "takeWhile": () => (/* reexport */ takeWhile),
  "tap": () => (/* reexport */ tap),
  "throttle": () => (/* reexport */ throttle),
  "throttleTime": () => (/* reexport */ throttleTime),
  "throwIfEmpty": () => (/* reexport */ throwIfEmpty),
  "timeInterval": () => (/* reexport */ timeInterval),
  "timeout": () => (/* reexport */ timeout),
  "timeoutWith": () => (/* reexport */ timeoutWith),
  "timestamp": () => (/* reexport */ timestamp),
  "toArray": () => (/* reexport */ toArray),
  "window": () => (/* reexport */ window_window),
  "windowCount": () => (/* reexport */ windowCount),
  "windowTime": () => (/* reexport */ windowTime),
  "windowToggle": () => (/* reexport */ windowToggle),
  "windowWhen": () => (/* reexport */ windowWhen),
  "withLatestFrom": () => (/* reexport */ withLatestFrom),
  "zip": () => (/* reexport */ zip_zip),
  "zipAll": () => (/* reexport */ zipAll)
});

// EXTERNAL MODULE: ./node_modules/rxjs/node_modules/tslib/tslib.es6.js
var tslib_es6 = __webpack_require__(5987);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/innerSubscribe.js
var innerSubscribe = __webpack_require__(7604);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/audit.js
/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */


function audit(durationSelector) {
    return function auditOperatorFunction(source) {
        return source.lift(new AuditOperator(durationSelector));
    };
}
var AuditOperator = /*@__PURE__*/ (function () {
    function AuditOperator(durationSelector) {
        this.durationSelector = durationSelector;
    }
    AuditOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new AuditSubscriber(subscriber, this.durationSelector));
    };
    return AuditOperator;
}());
var AuditSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(AuditSubscriber, _super);
    function AuditSubscriber(destination, durationSelector) {
        var _this = _super.call(this, destination) || this;
        _this.durationSelector = durationSelector;
        _this.hasValue = false;
        return _this;
    }
    AuditSubscriber.prototype._next = function (value) {
        this.value = value;
        this.hasValue = true;
        if (!this.throttled) {
            var duration = void 0;
            try {
                var durationSelector = this.durationSelector;
                duration = durationSelector(value);
            }
            catch (err) {
                return this.destination.error(err);
            }
            var innerSubscription = (0,innerSubscribe/* innerSubscribe */.ft)(duration, new innerSubscribe/* SimpleInnerSubscriber */.IY(this));
            if (!innerSubscription || innerSubscription.closed) {
                this.clearThrottle();
            }
            else {
                this.add(this.throttled = innerSubscription);
            }
        }
    };
    AuditSubscriber.prototype.clearThrottle = function () {
        var _a = this, value = _a.value, hasValue = _a.hasValue, throttled = _a.throttled;
        if (throttled) {
            this.remove(throttled);
            this.throttled = undefined;
            throttled.unsubscribe();
        }
        if (hasValue) {
            this.value = undefined;
            this.hasValue = false;
            this.destination.next(value);
        }
    };
    AuditSubscriber.prototype.notifyNext = function () {
        this.clearThrottle();
    };
    AuditSubscriber.prototype.notifyComplete = function () {
        this.clearThrottle();
    };
    return AuditSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=audit.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/async.js
var scheduler_async = __webpack_require__(964);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/timer.js
var timer = __webpack_require__(9604);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/auditTime.js
/** PURE_IMPORTS_START _scheduler_async,_audit,_observable_timer PURE_IMPORTS_END */



function auditTime(duration, scheduler) {
    if (scheduler === void 0) {
        scheduler = scheduler_async/* async */.P;
    }
    return audit(function () { return (0,timer/* timer */.H)(duration, scheduler); });
}
//# sourceMappingURL=auditTime.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/buffer.js
/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */


function buffer(closingNotifier) {
    return function bufferOperatorFunction(source) {
        return source.lift(new BufferOperator(closingNotifier));
    };
}
var BufferOperator = /*@__PURE__*/ (function () {
    function BufferOperator(closingNotifier) {
        this.closingNotifier = closingNotifier;
    }
    BufferOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new BufferSubscriber(subscriber, this.closingNotifier));
    };
    return BufferOperator;
}());
var BufferSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(BufferSubscriber, _super);
    function BufferSubscriber(destination, closingNotifier) {
        var _this = _super.call(this, destination) || this;
        _this.buffer = [];
        _this.add((0,innerSubscribe/* innerSubscribe */.ft)(closingNotifier, new innerSubscribe/* SimpleInnerSubscriber */.IY(_this)));
        return _this;
    }
    BufferSubscriber.prototype._next = function (value) {
        this.buffer.push(value);
    };
    BufferSubscriber.prototype.notifyNext = function () {
        var buffer = this.buffer;
        this.buffer = [];
        this.destination.next(buffer);
    };
    return BufferSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=buffer.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Subscriber.js
var Subscriber = __webpack_require__(979);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/bufferCount.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function bufferCount(bufferSize, startBufferEvery) {
    if (startBufferEvery === void 0) {
        startBufferEvery = null;
    }
    return function bufferCountOperatorFunction(source) {
        return source.lift(new BufferCountOperator(bufferSize, startBufferEvery));
    };
}
var BufferCountOperator = /*@__PURE__*/ (function () {
    function BufferCountOperator(bufferSize, startBufferEvery) {
        this.bufferSize = bufferSize;
        this.startBufferEvery = startBufferEvery;
        if (!startBufferEvery || bufferSize === startBufferEvery) {
            this.subscriberClass = BufferCountSubscriber;
        }
        else {
            this.subscriberClass = BufferSkipCountSubscriber;
        }
    }
    BufferCountOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new this.subscriberClass(subscriber, this.bufferSize, this.startBufferEvery));
    };
    return BufferCountOperator;
}());
var BufferCountSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(BufferCountSubscriber, _super);
    function BufferCountSubscriber(destination, bufferSize) {
        var _this = _super.call(this, destination) || this;
        _this.bufferSize = bufferSize;
        _this.buffer = [];
        return _this;
    }
    BufferCountSubscriber.prototype._next = function (value) {
        var buffer = this.buffer;
        buffer.push(value);
        if (buffer.length == this.bufferSize) {
            this.destination.next(buffer);
            this.buffer = [];
        }
    };
    BufferCountSubscriber.prototype._complete = function () {
        var buffer = this.buffer;
        if (buffer.length > 0) {
            this.destination.next(buffer);
        }
        _super.prototype._complete.call(this);
    };
    return BufferCountSubscriber;
}(Subscriber/* Subscriber */.L));
var BufferSkipCountSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(BufferSkipCountSubscriber, _super);
    function BufferSkipCountSubscriber(destination, bufferSize, startBufferEvery) {
        var _this = _super.call(this, destination) || this;
        _this.bufferSize = bufferSize;
        _this.startBufferEvery = startBufferEvery;
        _this.buffers = [];
        _this.count = 0;
        return _this;
    }
    BufferSkipCountSubscriber.prototype._next = function (value) {
        var _a = this, bufferSize = _a.bufferSize, startBufferEvery = _a.startBufferEvery, buffers = _a.buffers, count = _a.count;
        this.count++;
        if (count % startBufferEvery === 0) {
            buffers.push([]);
        }
        for (var i = buffers.length; i--;) {
            var buffer = buffers[i];
            buffer.push(value);
            if (buffer.length === bufferSize) {
                buffers.splice(i, 1);
                this.destination.next(buffer);
            }
        }
    };
    BufferSkipCountSubscriber.prototype._complete = function () {
        var _a = this, buffers = _a.buffers, destination = _a.destination;
        while (buffers.length > 0) {
            var buffer = buffers.shift();
            if (buffer.length > 0) {
                destination.next(buffer);
            }
        }
        _super.prototype._complete.call(this);
    };
    return BufferSkipCountSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=bufferCount.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isScheduler.js
var isScheduler = __webpack_require__(7507);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/bufferTime.js
/** PURE_IMPORTS_START tslib,_scheduler_async,_Subscriber,_util_isScheduler PURE_IMPORTS_END */




function bufferTime(bufferTimeSpan) {
    var length = arguments.length;
    var scheduler = scheduler_async/* async */.P;
    if ((0,isScheduler/* isScheduler */.K)(arguments[arguments.length - 1])) {
        scheduler = arguments[arguments.length - 1];
        length--;
    }
    var bufferCreationInterval = null;
    if (length >= 2) {
        bufferCreationInterval = arguments[1];
    }
    var maxBufferSize = Number.POSITIVE_INFINITY;
    if (length >= 3) {
        maxBufferSize = arguments[2];
    }
    return function bufferTimeOperatorFunction(source) {
        return source.lift(new BufferTimeOperator(bufferTimeSpan, bufferCreationInterval, maxBufferSize, scheduler));
    };
}
var BufferTimeOperator = /*@__PURE__*/ (function () {
    function BufferTimeOperator(bufferTimeSpan, bufferCreationInterval, maxBufferSize, scheduler) {
        this.bufferTimeSpan = bufferTimeSpan;
        this.bufferCreationInterval = bufferCreationInterval;
        this.maxBufferSize = maxBufferSize;
        this.scheduler = scheduler;
    }
    BufferTimeOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new BufferTimeSubscriber(subscriber, this.bufferTimeSpan, this.bufferCreationInterval, this.maxBufferSize, this.scheduler));
    };
    return BufferTimeOperator;
}());
var Context = /*@__PURE__*/ (function () {
    function Context() {
        this.buffer = [];
    }
    return Context;
}());
var BufferTimeSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(BufferTimeSubscriber, _super);
    function BufferTimeSubscriber(destination, bufferTimeSpan, bufferCreationInterval, maxBufferSize, scheduler) {
        var _this = _super.call(this, destination) || this;
        _this.bufferTimeSpan = bufferTimeSpan;
        _this.bufferCreationInterval = bufferCreationInterval;
        _this.maxBufferSize = maxBufferSize;
        _this.scheduler = scheduler;
        _this.contexts = [];
        var context = _this.openContext();
        _this.timespanOnly = bufferCreationInterval == null || bufferCreationInterval < 0;
        if (_this.timespanOnly) {
            var timeSpanOnlyState = { subscriber: _this, context: context, bufferTimeSpan: bufferTimeSpan };
            _this.add(context.closeAction = scheduler.schedule(dispatchBufferTimeSpanOnly, bufferTimeSpan, timeSpanOnlyState));
        }
        else {
            var closeState = { subscriber: _this, context: context };
            var creationState = { bufferTimeSpan: bufferTimeSpan, bufferCreationInterval: bufferCreationInterval, subscriber: _this, scheduler: scheduler };
            _this.add(context.closeAction = scheduler.schedule(dispatchBufferClose, bufferTimeSpan, closeState));
            _this.add(scheduler.schedule(dispatchBufferCreation, bufferCreationInterval, creationState));
        }
        return _this;
    }
    BufferTimeSubscriber.prototype._next = function (value) {
        var contexts = this.contexts;
        var len = contexts.length;
        var filledBufferContext;
        for (var i = 0; i < len; i++) {
            var context_1 = contexts[i];
            var buffer = context_1.buffer;
            buffer.push(value);
            if (buffer.length == this.maxBufferSize) {
                filledBufferContext = context_1;
            }
        }
        if (filledBufferContext) {
            this.onBufferFull(filledBufferContext);
        }
    };
    BufferTimeSubscriber.prototype._error = function (err) {
        this.contexts.length = 0;
        _super.prototype._error.call(this, err);
    };
    BufferTimeSubscriber.prototype._complete = function () {
        var _a = this, contexts = _a.contexts, destination = _a.destination;
        while (contexts.length > 0) {
            var context_2 = contexts.shift();
            destination.next(context_2.buffer);
        }
        _super.prototype._complete.call(this);
    };
    BufferTimeSubscriber.prototype._unsubscribe = function () {
        this.contexts = null;
    };
    BufferTimeSubscriber.prototype.onBufferFull = function (context) {
        this.closeContext(context);
        var closeAction = context.closeAction;
        closeAction.unsubscribe();
        this.remove(closeAction);
        if (!this.closed && this.timespanOnly) {
            context = this.openContext();
            var bufferTimeSpan = this.bufferTimeSpan;
            var timeSpanOnlyState = { subscriber: this, context: context, bufferTimeSpan: bufferTimeSpan };
            this.add(context.closeAction = this.scheduler.schedule(dispatchBufferTimeSpanOnly, bufferTimeSpan, timeSpanOnlyState));
        }
    };
    BufferTimeSubscriber.prototype.openContext = function () {
        var context = new Context();
        this.contexts.push(context);
        return context;
    };
    BufferTimeSubscriber.prototype.closeContext = function (context) {
        this.destination.next(context.buffer);
        var contexts = this.contexts;
        var spliceIndex = contexts ? contexts.indexOf(context) : -1;
        if (spliceIndex >= 0) {
            contexts.splice(contexts.indexOf(context), 1);
        }
    };
    return BufferTimeSubscriber;
}(Subscriber/* Subscriber */.L));
function dispatchBufferTimeSpanOnly(state) {
    var subscriber = state.subscriber;
    var prevContext = state.context;
    if (prevContext) {
        subscriber.closeContext(prevContext);
    }
    if (!subscriber.closed) {
        state.context = subscriber.openContext();
        state.context.closeAction = this.schedule(state, state.bufferTimeSpan);
    }
}
function dispatchBufferCreation(state) {
    var bufferCreationInterval = state.bufferCreationInterval, bufferTimeSpan = state.bufferTimeSpan, subscriber = state.subscriber, scheduler = state.scheduler;
    var context = subscriber.openContext();
    var action = this;
    if (!subscriber.closed) {
        subscriber.add(context.closeAction = scheduler.schedule(dispatchBufferClose, bufferTimeSpan, { subscriber: subscriber, context: context }));
        action.schedule(state, bufferCreationInterval);
    }
}
function dispatchBufferClose(arg) {
    var subscriber = arg.subscriber, context = arg.context;
    subscriber.closeContext(context);
}
//# sourceMappingURL=bufferTime.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Subscription.js
var Subscription = __webpack_require__(8760);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/subscribeToResult.js + 1 modules
var subscribeToResult = __webpack_require__(2080);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/OuterSubscriber.js
var OuterSubscriber = __webpack_require__(2039);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/bufferToggle.js
/** PURE_IMPORTS_START tslib,_Subscription,_util_subscribeToResult,_OuterSubscriber PURE_IMPORTS_END */




function bufferToggle(openings, closingSelector) {
    return function bufferToggleOperatorFunction(source) {
        return source.lift(new BufferToggleOperator(openings, closingSelector));
    };
}
var BufferToggleOperator = /*@__PURE__*/ (function () {
    function BufferToggleOperator(openings, closingSelector) {
        this.openings = openings;
        this.closingSelector = closingSelector;
    }
    BufferToggleOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new BufferToggleSubscriber(subscriber, this.openings, this.closingSelector));
    };
    return BufferToggleOperator;
}());
var BufferToggleSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(BufferToggleSubscriber, _super);
    function BufferToggleSubscriber(destination, openings, closingSelector) {
        var _this = _super.call(this, destination) || this;
        _this.closingSelector = closingSelector;
        _this.contexts = [];
        _this.add((0,subscribeToResult/* subscribeToResult */.D)(_this, openings));
        return _this;
    }
    BufferToggleSubscriber.prototype._next = function (value) {
        var contexts = this.contexts;
        var len = contexts.length;
        for (var i = 0; i < len; i++) {
            contexts[i].buffer.push(value);
        }
    };
    BufferToggleSubscriber.prototype._error = function (err) {
        var contexts = this.contexts;
        while (contexts.length > 0) {
            var context_1 = contexts.shift();
            context_1.subscription.unsubscribe();
            context_1.buffer = null;
            context_1.subscription = null;
        }
        this.contexts = null;
        _super.prototype._error.call(this, err);
    };
    BufferToggleSubscriber.prototype._complete = function () {
        var contexts = this.contexts;
        while (contexts.length > 0) {
            var context_2 = contexts.shift();
            this.destination.next(context_2.buffer);
            context_2.subscription.unsubscribe();
            context_2.buffer = null;
            context_2.subscription = null;
        }
        this.contexts = null;
        _super.prototype._complete.call(this);
    };
    BufferToggleSubscriber.prototype.notifyNext = function (outerValue, innerValue) {
        outerValue ? this.closeBuffer(outerValue) : this.openBuffer(innerValue);
    };
    BufferToggleSubscriber.prototype.notifyComplete = function (innerSub) {
        this.closeBuffer(innerSub.context);
    };
    BufferToggleSubscriber.prototype.openBuffer = function (value) {
        try {
            var closingSelector = this.closingSelector;
            var closingNotifier = closingSelector.call(this, value);
            if (closingNotifier) {
                this.trySubscribe(closingNotifier);
            }
        }
        catch (err) {
            this._error(err);
        }
    };
    BufferToggleSubscriber.prototype.closeBuffer = function (context) {
        var contexts = this.contexts;
        if (contexts && context) {
            var buffer = context.buffer, subscription = context.subscription;
            this.destination.next(buffer);
            contexts.splice(contexts.indexOf(context), 1);
            this.remove(subscription);
            subscription.unsubscribe();
        }
    };
    BufferToggleSubscriber.prototype.trySubscribe = function (closingNotifier) {
        var contexts = this.contexts;
        var buffer = [];
        var subscription = new Subscription/* Subscription */.w();
        var context = { buffer: buffer, subscription: subscription };
        contexts.push(context);
        var innerSubscription = (0,subscribeToResult/* subscribeToResult */.D)(this, closingNotifier, context);
        if (!innerSubscription || innerSubscription.closed) {
            this.closeBuffer(context);
        }
        else {
            innerSubscription.context = context;
            this.add(innerSubscription);
            subscription.add(innerSubscription);
        }
    };
    return BufferToggleSubscriber;
}(OuterSubscriber/* OuterSubscriber */.L));
//# sourceMappingURL=bufferToggle.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/bufferWhen.js
/** PURE_IMPORTS_START tslib,_Subscription,_innerSubscribe PURE_IMPORTS_END */



function bufferWhen(closingSelector) {
    return function (source) {
        return source.lift(new BufferWhenOperator(closingSelector));
    };
}
var BufferWhenOperator = /*@__PURE__*/ (function () {
    function BufferWhenOperator(closingSelector) {
        this.closingSelector = closingSelector;
    }
    BufferWhenOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new BufferWhenSubscriber(subscriber, this.closingSelector));
    };
    return BufferWhenOperator;
}());
var BufferWhenSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(BufferWhenSubscriber, _super);
    function BufferWhenSubscriber(destination, closingSelector) {
        var _this = _super.call(this, destination) || this;
        _this.closingSelector = closingSelector;
        _this.subscribing = false;
        _this.openBuffer();
        return _this;
    }
    BufferWhenSubscriber.prototype._next = function (value) {
        this.buffer.push(value);
    };
    BufferWhenSubscriber.prototype._complete = function () {
        var buffer = this.buffer;
        if (buffer) {
            this.destination.next(buffer);
        }
        _super.prototype._complete.call(this);
    };
    BufferWhenSubscriber.prototype._unsubscribe = function () {
        this.buffer = undefined;
        this.subscribing = false;
    };
    BufferWhenSubscriber.prototype.notifyNext = function () {
        this.openBuffer();
    };
    BufferWhenSubscriber.prototype.notifyComplete = function () {
        if (this.subscribing) {
            this.complete();
        }
        else {
            this.openBuffer();
        }
    };
    BufferWhenSubscriber.prototype.openBuffer = function () {
        var closingSubscription = this.closingSubscription;
        if (closingSubscription) {
            this.remove(closingSubscription);
            closingSubscription.unsubscribe();
        }
        var buffer = this.buffer;
        if (this.buffer) {
            this.destination.next(buffer);
        }
        this.buffer = [];
        var closingNotifier;
        try {
            var closingSelector = this.closingSelector;
            closingNotifier = closingSelector();
        }
        catch (err) {
            return this.error(err);
        }
        closingSubscription = new Subscription/* Subscription */.w();
        this.closingSubscription = closingSubscription;
        this.add(closingSubscription);
        this.subscribing = true;
        closingSubscription.add((0,innerSubscribe/* innerSubscribe */.ft)(closingNotifier, new innerSubscribe/* SimpleInnerSubscriber */.IY(this)));
        this.subscribing = false;
    };
    return BufferWhenSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=bufferWhen.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/catchError.js
/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */


function catchError(selector) {
    return function catchErrorOperatorFunction(source) {
        var operator = new CatchOperator(selector);
        var caught = source.lift(operator);
        return (operator.caught = caught);
    };
}
var CatchOperator = /*@__PURE__*/ (function () {
    function CatchOperator(selector) {
        this.selector = selector;
    }
    CatchOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new CatchSubscriber(subscriber, this.selector, this.caught));
    };
    return CatchOperator;
}());
var CatchSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(CatchSubscriber, _super);
    function CatchSubscriber(destination, selector, caught) {
        var _this = _super.call(this, destination) || this;
        _this.selector = selector;
        _this.caught = caught;
        return _this;
    }
    CatchSubscriber.prototype.error = function (err) {
        if (!this.isStopped) {
            var result = void 0;
            try {
                result = this.selector(err, this.caught);
            }
            catch (err2) {
                _super.prototype.error.call(this, err2);
                return;
            }
            this._unsubscribeAndRecycle();
            var innerSubscriber = new innerSubscribe/* SimpleInnerSubscriber */.IY(this);
            this.add(innerSubscriber);
            var innerSubscription = (0,innerSubscribe/* innerSubscribe */.ft)(result, innerSubscriber);
            if (innerSubscription !== innerSubscriber) {
                this.add(innerSubscription);
            }
        }
    };
    return CatchSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=catchError.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/combineLatest.js
var combineLatest = __webpack_require__(5142);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/combineAll.js
/** PURE_IMPORTS_START _observable_combineLatest PURE_IMPORTS_END */

function combineAll(project) {
    return function (source) { return source.lift(new combineLatest/* CombineLatestOperator */.Ms(project)); };
}
//# sourceMappingURL=combineAll.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isArray.js
var util_isArray = __webpack_require__(9026);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/from.js
var observable_from = __webpack_require__(5760);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/combineLatest.js
/** PURE_IMPORTS_START _util_isArray,_observable_combineLatest,_observable_from PURE_IMPORTS_END */



var none = {};
function combineLatest_combineLatest() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    var project = null;
    if (typeof observables[observables.length - 1] === 'function') {
        project = observables.pop();
    }
    if (observables.length === 1 && (0,util_isArray/* isArray */.k)(observables[0])) {
        observables = observables[0].slice();
    }
    return function (source) { return source.lift.call((0,observable_from/* from */.D)([source].concat(observables)), new combineLatest/* CombineLatestOperator */.Ms(project)); };
}
//# sourceMappingURL=combineLatest.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/concat.js
var concat = __webpack_require__(9795);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/concat.js
/** PURE_IMPORTS_START _observable_concat PURE_IMPORTS_END */

function concat_concat() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    return function (source) { return source.lift.call(concat/* concat.apply */.z.apply(void 0, [source].concat(observables))); };
}
//# sourceMappingURL=concat.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/operators/concatAll.js
var concatAll = __webpack_require__(2257);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/operators/mergeMap.js
var mergeMap = __webpack_require__(7746);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/concatMap.js
/** PURE_IMPORTS_START _mergeMap PURE_IMPORTS_END */

function concatMap(project, resultSelector) {
    return (0,mergeMap/* mergeMap */.zg)(project, resultSelector, 1);
}
//# sourceMappingURL=concatMap.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/concatMapTo.js
/** PURE_IMPORTS_START _concatMap PURE_IMPORTS_END */

function concatMapTo(innerObservable, resultSelector) {
    return concatMap(function () { return innerObservable; }, resultSelector);
}
//# sourceMappingURL=concatMapTo.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/count.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function count(predicate) {
    return function (source) { return source.lift(new CountOperator(predicate, source)); };
}
var CountOperator = /*@__PURE__*/ (function () {
    function CountOperator(predicate, source) {
        this.predicate = predicate;
        this.source = source;
    }
    CountOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new CountSubscriber(subscriber, this.predicate, this.source));
    };
    return CountOperator;
}());
var CountSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(CountSubscriber, _super);
    function CountSubscriber(destination, predicate, source) {
        var _this = _super.call(this, destination) || this;
        _this.predicate = predicate;
        _this.source = source;
        _this.count = 0;
        _this.index = 0;
        return _this;
    }
    CountSubscriber.prototype._next = function (value) {
        if (this.predicate) {
            this._tryPredicate(value);
        }
        else {
            this.count++;
        }
    };
    CountSubscriber.prototype._tryPredicate = function (value) {
        var result;
        try {
            result = this.predicate(value, this.index++, this.source);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        if (result) {
            this.count++;
        }
    };
    CountSubscriber.prototype._complete = function () {
        this.destination.next(this.count);
        this.destination.complete();
    };
    return CountSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=count.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/debounce.js
/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */


function debounce(durationSelector) {
    return function (source) { return source.lift(new DebounceOperator(durationSelector)); };
}
var DebounceOperator = /*@__PURE__*/ (function () {
    function DebounceOperator(durationSelector) {
        this.durationSelector = durationSelector;
    }
    DebounceOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new DebounceSubscriber(subscriber, this.durationSelector));
    };
    return DebounceOperator;
}());
var DebounceSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(DebounceSubscriber, _super);
    function DebounceSubscriber(destination, durationSelector) {
        var _this = _super.call(this, destination) || this;
        _this.durationSelector = durationSelector;
        _this.hasValue = false;
        return _this;
    }
    DebounceSubscriber.prototype._next = function (value) {
        try {
            var result = this.durationSelector.call(this, value);
            if (result) {
                this._tryNext(value, result);
            }
        }
        catch (err) {
            this.destination.error(err);
        }
    };
    DebounceSubscriber.prototype._complete = function () {
        this.emitValue();
        this.destination.complete();
    };
    DebounceSubscriber.prototype._tryNext = function (value, duration) {
        var subscription = this.durationSubscription;
        this.value = value;
        this.hasValue = true;
        if (subscription) {
            subscription.unsubscribe();
            this.remove(subscription);
        }
        subscription = (0,innerSubscribe/* innerSubscribe */.ft)(duration, new innerSubscribe/* SimpleInnerSubscriber */.IY(this));
        if (subscription && !subscription.closed) {
            this.add(this.durationSubscription = subscription);
        }
    };
    DebounceSubscriber.prototype.notifyNext = function () {
        this.emitValue();
    };
    DebounceSubscriber.prototype.notifyComplete = function () {
        this.emitValue();
    };
    DebounceSubscriber.prototype.emitValue = function () {
        if (this.hasValue) {
            var value = this.value;
            var subscription = this.durationSubscription;
            if (subscription) {
                this.durationSubscription = undefined;
                subscription.unsubscribe();
                this.remove(subscription);
            }
            this.value = undefined;
            this.hasValue = false;
            _super.prototype._next.call(this, value);
        }
    };
    return DebounceSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=debounce.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/debounceTime.js
/** PURE_IMPORTS_START tslib,_Subscriber,_scheduler_async PURE_IMPORTS_END */



function debounceTime(dueTime, scheduler) {
    if (scheduler === void 0) {
        scheduler = scheduler_async/* async */.P;
    }
    return function (source) { return source.lift(new DebounceTimeOperator(dueTime, scheduler)); };
}
var DebounceTimeOperator = /*@__PURE__*/ (function () {
    function DebounceTimeOperator(dueTime, scheduler) {
        this.dueTime = dueTime;
        this.scheduler = scheduler;
    }
    DebounceTimeOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new DebounceTimeSubscriber(subscriber, this.dueTime, this.scheduler));
    };
    return DebounceTimeOperator;
}());
var DebounceTimeSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(DebounceTimeSubscriber, _super);
    function DebounceTimeSubscriber(destination, dueTime, scheduler) {
        var _this = _super.call(this, destination) || this;
        _this.dueTime = dueTime;
        _this.scheduler = scheduler;
        _this.debouncedSubscription = null;
        _this.lastValue = null;
        _this.hasValue = false;
        return _this;
    }
    DebounceTimeSubscriber.prototype._next = function (value) {
        this.clearDebounce();
        this.lastValue = value;
        this.hasValue = true;
        this.add(this.debouncedSubscription = this.scheduler.schedule(dispatchNext, this.dueTime, this));
    };
    DebounceTimeSubscriber.prototype._complete = function () {
        this.debouncedNext();
        this.destination.complete();
    };
    DebounceTimeSubscriber.prototype.debouncedNext = function () {
        this.clearDebounce();
        if (this.hasValue) {
            var lastValue = this.lastValue;
            this.lastValue = null;
            this.hasValue = false;
            this.destination.next(lastValue);
        }
    };
    DebounceTimeSubscriber.prototype.clearDebounce = function () {
        var debouncedSubscription = this.debouncedSubscription;
        if (debouncedSubscription !== null) {
            this.remove(debouncedSubscription);
            debouncedSubscription.unsubscribe();
            this.debouncedSubscription = null;
        }
    };
    return DebounceTimeSubscriber;
}(Subscriber/* Subscriber */.L));
function dispatchNext(subscriber) {
    subscriber.debouncedNext();
}
//# sourceMappingURL=debounceTime.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/defaultIfEmpty.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function defaultIfEmpty(defaultValue) {
    if (defaultValue === void 0) {
        defaultValue = null;
    }
    return function (source) { return source.lift(new DefaultIfEmptyOperator(defaultValue)); };
}
var DefaultIfEmptyOperator = /*@__PURE__*/ (function () {
    function DefaultIfEmptyOperator(defaultValue) {
        this.defaultValue = defaultValue;
    }
    DefaultIfEmptyOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new DefaultIfEmptySubscriber(subscriber, this.defaultValue));
    };
    return DefaultIfEmptyOperator;
}());
var DefaultIfEmptySubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(DefaultIfEmptySubscriber, _super);
    function DefaultIfEmptySubscriber(destination, defaultValue) {
        var _this = _super.call(this, destination) || this;
        _this.defaultValue = defaultValue;
        _this.isEmpty = true;
        return _this;
    }
    DefaultIfEmptySubscriber.prototype._next = function (value) {
        this.isEmpty = false;
        this.destination.next(value);
    };
    DefaultIfEmptySubscriber.prototype._complete = function () {
        if (this.isEmpty) {
            this.destination.next(this.defaultValue);
        }
        this.destination.complete();
    };
    return DefaultIfEmptySubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=defaultIfEmpty.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/util/isDate.js
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function isDate(value) {
    return value instanceof Date && !isNaN(+value);
}
//# sourceMappingURL=isDate.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Notification.js
var Notification = __webpack_require__(2632);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/delay.js
/** PURE_IMPORTS_START tslib,_scheduler_async,_util_isDate,_Subscriber,_Notification PURE_IMPORTS_END */





function delay(delay, scheduler) {
    if (scheduler === void 0) {
        scheduler = scheduler_async/* async */.P;
    }
    var absoluteDelay = isDate(delay);
    var delayFor = absoluteDelay ? (+delay - scheduler.now()) : Math.abs(delay);
    return function (source) { return source.lift(new DelayOperator(delayFor, scheduler)); };
}
var DelayOperator = /*@__PURE__*/ (function () {
    function DelayOperator(delay, scheduler) {
        this.delay = delay;
        this.scheduler = scheduler;
    }
    DelayOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new DelaySubscriber(subscriber, this.delay, this.scheduler));
    };
    return DelayOperator;
}());
var DelaySubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(DelaySubscriber, _super);
    function DelaySubscriber(destination, delay, scheduler) {
        var _this = _super.call(this, destination) || this;
        _this.delay = delay;
        _this.scheduler = scheduler;
        _this.queue = [];
        _this.active = false;
        _this.errored = false;
        return _this;
    }
    DelaySubscriber.dispatch = function (state) {
        var source = state.source;
        var queue = source.queue;
        var scheduler = state.scheduler;
        var destination = state.destination;
        while (queue.length > 0 && (queue[0].time - scheduler.now()) <= 0) {
            queue.shift().notification.observe(destination);
        }
        if (queue.length > 0) {
            var delay_1 = Math.max(0, queue[0].time - scheduler.now());
            this.schedule(state, delay_1);
        }
        else {
            this.unsubscribe();
            source.active = false;
        }
    };
    DelaySubscriber.prototype._schedule = function (scheduler) {
        this.active = true;
        var destination = this.destination;
        destination.add(scheduler.schedule(DelaySubscriber.dispatch, this.delay, {
            source: this, destination: this.destination, scheduler: scheduler
        }));
    };
    DelaySubscriber.prototype.scheduleNotification = function (notification) {
        if (this.errored === true) {
            return;
        }
        var scheduler = this.scheduler;
        var message = new DelayMessage(scheduler.now() + this.delay, notification);
        this.queue.push(message);
        if (this.active === false) {
            this._schedule(scheduler);
        }
    };
    DelaySubscriber.prototype._next = function (value) {
        this.scheduleNotification(Notification/* Notification.createNext */.P.createNext(value));
    };
    DelaySubscriber.prototype._error = function (err) {
        this.errored = true;
        this.queue = [];
        this.destination.error(err);
        this.unsubscribe();
    };
    DelaySubscriber.prototype._complete = function () {
        this.scheduleNotification(Notification/* Notification.createComplete */.P.createComplete());
        this.unsubscribe();
    };
    return DelaySubscriber;
}(Subscriber/* Subscriber */.L));
var DelayMessage = /*@__PURE__*/ (function () {
    function DelayMessage(time, notification) {
        this.time = time;
        this.notification = notification;
    }
    return DelayMessage;
}());
//# sourceMappingURL=delay.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Observable.js + 1 modules
var Observable = __webpack_require__(2772);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/delayWhen.js
/** PURE_IMPORTS_START tslib,_Subscriber,_Observable,_OuterSubscriber,_util_subscribeToResult PURE_IMPORTS_END */





function delayWhen(delayDurationSelector, subscriptionDelay) {
    if (subscriptionDelay) {
        return function (source) {
            return new SubscriptionDelayObservable(source, subscriptionDelay)
                .lift(new DelayWhenOperator(delayDurationSelector));
        };
    }
    return function (source) { return source.lift(new DelayWhenOperator(delayDurationSelector)); };
}
var DelayWhenOperator = /*@__PURE__*/ (function () {
    function DelayWhenOperator(delayDurationSelector) {
        this.delayDurationSelector = delayDurationSelector;
    }
    DelayWhenOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new DelayWhenSubscriber(subscriber, this.delayDurationSelector));
    };
    return DelayWhenOperator;
}());
var DelayWhenSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(DelayWhenSubscriber, _super);
    function DelayWhenSubscriber(destination, delayDurationSelector) {
        var _this = _super.call(this, destination) || this;
        _this.delayDurationSelector = delayDurationSelector;
        _this.completed = false;
        _this.delayNotifierSubscriptions = [];
        _this.index = 0;
        return _this;
    }
    DelayWhenSubscriber.prototype.notifyNext = function (outerValue, _innerValue, _outerIndex, _innerIndex, innerSub) {
        this.destination.next(outerValue);
        this.removeSubscription(innerSub);
        this.tryComplete();
    };
    DelayWhenSubscriber.prototype.notifyError = function (error, innerSub) {
        this._error(error);
    };
    DelayWhenSubscriber.prototype.notifyComplete = function (innerSub) {
        var value = this.removeSubscription(innerSub);
        if (value) {
            this.destination.next(value);
        }
        this.tryComplete();
    };
    DelayWhenSubscriber.prototype._next = function (value) {
        var index = this.index++;
        try {
            var delayNotifier = this.delayDurationSelector(value, index);
            if (delayNotifier) {
                this.tryDelay(delayNotifier, value);
            }
        }
        catch (err) {
            this.destination.error(err);
        }
    };
    DelayWhenSubscriber.prototype._complete = function () {
        this.completed = true;
        this.tryComplete();
        this.unsubscribe();
    };
    DelayWhenSubscriber.prototype.removeSubscription = function (subscription) {
        subscription.unsubscribe();
        var subscriptionIdx = this.delayNotifierSubscriptions.indexOf(subscription);
        if (subscriptionIdx !== -1) {
            this.delayNotifierSubscriptions.splice(subscriptionIdx, 1);
        }
        return subscription.outerValue;
    };
    DelayWhenSubscriber.prototype.tryDelay = function (delayNotifier, value) {
        var notifierSubscription = (0,subscribeToResult/* subscribeToResult */.D)(this, delayNotifier, value);
        if (notifierSubscription && !notifierSubscription.closed) {
            var destination = this.destination;
            destination.add(notifierSubscription);
            this.delayNotifierSubscriptions.push(notifierSubscription);
        }
    };
    DelayWhenSubscriber.prototype.tryComplete = function () {
        if (this.completed && this.delayNotifierSubscriptions.length === 0) {
            this.destination.complete();
        }
    };
    return DelayWhenSubscriber;
}(OuterSubscriber/* OuterSubscriber */.L));
var SubscriptionDelayObservable = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SubscriptionDelayObservable, _super);
    function SubscriptionDelayObservable(source, subscriptionDelay) {
        var _this = _super.call(this) || this;
        _this.source = source;
        _this.subscriptionDelay = subscriptionDelay;
        return _this;
    }
    SubscriptionDelayObservable.prototype._subscribe = function (subscriber) {
        this.subscriptionDelay.subscribe(new SubscriptionDelaySubscriber(subscriber, this.source));
    };
    return SubscriptionDelayObservable;
}(Observable/* Observable */.y));
var SubscriptionDelaySubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SubscriptionDelaySubscriber, _super);
    function SubscriptionDelaySubscriber(parent, source) {
        var _this = _super.call(this) || this;
        _this.parent = parent;
        _this.source = source;
        _this.sourceSubscribed = false;
        return _this;
    }
    SubscriptionDelaySubscriber.prototype._next = function (unused) {
        this.subscribeToSource();
    };
    SubscriptionDelaySubscriber.prototype._error = function (err) {
        this.unsubscribe();
        this.parent.error(err);
    };
    SubscriptionDelaySubscriber.prototype._complete = function () {
        this.unsubscribe();
        this.subscribeToSource();
    };
    SubscriptionDelaySubscriber.prototype.subscribeToSource = function () {
        if (!this.sourceSubscribed) {
            this.sourceSubscribed = true;
            this.unsubscribe();
            this.source.subscribe(this.parent);
        }
    };
    return SubscriptionDelaySubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=delayWhen.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/dematerialize.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function dematerialize() {
    return function dematerializeOperatorFunction(source) {
        return source.lift(new DeMaterializeOperator());
    };
}
var DeMaterializeOperator = /*@__PURE__*/ (function () {
    function DeMaterializeOperator() {
    }
    DeMaterializeOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new DeMaterializeSubscriber(subscriber));
    };
    return DeMaterializeOperator;
}());
var DeMaterializeSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(DeMaterializeSubscriber, _super);
    function DeMaterializeSubscriber(destination) {
        return _super.call(this, destination) || this;
    }
    DeMaterializeSubscriber.prototype._next = function (value) {
        value.observe(this.destination);
    };
    return DeMaterializeSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=dematerialize.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/distinct.js
/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */


function distinct(keySelector, flushes) {
    return function (source) { return source.lift(new DistinctOperator(keySelector, flushes)); };
}
var DistinctOperator = /*@__PURE__*/ (function () {
    function DistinctOperator(keySelector, flushes) {
        this.keySelector = keySelector;
        this.flushes = flushes;
    }
    DistinctOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new DistinctSubscriber(subscriber, this.keySelector, this.flushes));
    };
    return DistinctOperator;
}());
var DistinctSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(DistinctSubscriber, _super);
    function DistinctSubscriber(destination, keySelector, flushes) {
        var _this = _super.call(this, destination) || this;
        _this.keySelector = keySelector;
        _this.values = new Set();
        if (flushes) {
            _this.add((0,innerSubscribe/* innerSubscribe */.ft)(flushes, new innerSubscribe/* SimpleInnerSubscriber */.IY(_this)));
        }
        return _this;
    }
    DistinctSubscriber.prototype.notifyNext = function () {
        this.values.clear();
    };
    DistinctSubscriber.prototype.notifyError = function (error) {
        this._error(error);
    };
    DistinctSubscriber.prototype._next = function (value) {
        if (this.keySelector) {
            this._useKeySelector(value);
        }
        else {
            this._finalizeNext(value, value);
        }
    };
    DistinctSubscriber.prototype._useKeySelector = function (value) {
        var key;
        var destination = this.destination;
        try {
            key = this.keySelector(value);
        }
        catch (err) {
            destination.error(err);
            return;
        }
        this._finalizeNext(key, value);
    };
    DistinctSubscriber.prototype._finalizeNext = function (key, value) {
        var values = this.values;
        if (!values.has(key)) {
            values.add(key);
            this.destination.next(value);
        }
    };
    return DistinctSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));

//# sourceMappingURL=distinct.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/distinctUntilChanged.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function distinctUntilChanged(compare, keySelector) {
    return function (source) { return source.lift(new DistinctUntilChangedOperator(compare, keySelector)); };
}
var DistinctUntilChangedOperator = /*@__PURE__*/ (function () {
    function DistinctUntilChangedOperator(compare, keySelector) {
        this.compare = compare;
        this.keySelector = keySelector;
    }
    DistinctUntilChangedOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new DistinctUntilChangedSubscriber(subscriber, this.compare, this.keySelector));
    };
    return DistinctUntilChangedOperator;
}());
var DistinctUntilChangedSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(DistinctUntilChangedSubscriber, _super);
    function DistinctUntilChangedSubscriber(destination, compare, keySelector) {
        var _this = _super.call(this, destination) || this;
        _this.keySelector = keySelector;
        _this.hasKey = false;
        if (typeof compare === 'function') {
            _this.compare = compare;
        }
        return _this;
    }
    DistinctUntilChangedSubscriber.prototype.compare = function (x, y) {
        return x === y;
    };
    DistinctUntilChangedSubscriber.prototype._next = function (value) {
        var key;
        try {
            var keySelector = this.keySelector;
            key = keySelector ? keySelector(value) : value;
        }
        catch (err) {
            return this.destination.error(err);
        }
        var result = false;
        if (this.hasKey) {
            try {
                var compare = this.compare;
                result = compare(this.key, key);
            }
            catch (err) {
                return this.destination.error(err);
            }
        }
        else {
            this.hasKey = true;
        }
        if (!result) {
            this.key = key;
            this.destination.next(value);
        }
    };
    return DistinctUntilChangedSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=distinctUntilChanged.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/distinctUntilKeyChanged.js
/** PURE_IMPORTS_START _distinctUntilChanged PURE_IMPORTS_END */

function distinctUntilKeyChanged(key, compare) {
    return distinctUntilChanged(function (x, y) { return compare ? compare(x[key], y[key]) : x[key] === y[key]; });
}
//# sourceMappingURL=distinctUntilKeyChanged.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/ArgumentOutOfRangeError.js
var ArgumentOutOfRangeError = __webpack_require__(6565);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/operators/filter.js
var filter = __webpack_require__(6008);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/EmptyError.js
var EmptyError = __webpack_require__(6929);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/throwIfEmpty.js
/** PURE_IMPORTS_START tslib,_util_EmptyError,_Subscriber PURE_IMPORTS_END */



function throwIfEmpty(errorFactory) {
    if (errorFactory === void 0) {
        errorFactory = defaultErrorFactory;
    }
    return function (source) {
        return source.lift(new ThrowIfEmptyOperator(errorFactory));
    };
}
var ThrowIfEmptyOperator = /*@__PURE__*/ (function () {
    function ThrowIfEmptyOperator(errorFactory) {
        this.errorFactory = errorFactory;
    }
    ThrowIfEmptyOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new ThrowIfEmptySubscriber(subscriber, this.errorFactory));
    };
    return ThrowIfEmptyOperator;
}());
var ThrowIfEmptySubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(ThrowIfEmptySubscriber, _super);
    function ThrowIfEmptySubscriber(destination, errorFactory) {
        var _this = _super.call(this, destination) || this;
        _this.errorFactory = errorFactory;
        _this.hasValue = false;
        return _this;
    }
    ThrowIfEmptySubscriber.prototype._next = function (value) {
        this.hasValue = true;
        this.destination.next(value);
    };
    ThrowIfEmptySubscriber.prototype._complete = function () {
        if (!this.hasValue) {
            var err = void 0;
            try {
                err = this.errorFactory();
            }
            catch (e) {
                err = e;
            }
            this.destination.error(err);
        }
        else {
            return this.destination.complete();
        }
    };
    return ThrowIfEmptySubscriber;
}(Subscriber/* Subscriber */.L));
function defaultErrorFactory() {
    return new EmptyError/* EmptyError */.K();
}
//# sourceMappingURL=throwIfEmpty.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/empty.js
var empty = __webpack_require__(5631);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/take.js
/** PURE_IMPORTS_START tslib,_Subscriber,_util_ArgumentOutOfRangeError,_observable_empty PURE_IMPORTS_END */




function take(count) {
    return function (source) {
        if (count === 0) {
            return (0,empty/* empty */.c)();
        }
        else {
            return source.lift(new TakeOperator(count));
        }
    };
}
var TakeOperator = /*@__PURE__*/ (function () {
    function TakeOperator(total) {
        this.total = total;
        if (this.total < 0) {
            throw new ArgumentOutOfRangeError/* ArgumentOutOfRangeError */.W;
        }
    }
    TakeOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new TakeSubscriber(subscriber, this.total));
    };
    return TakeOperator;
}());
var TakeSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(TakeSubscriber, _super);
    function TakeSubscriber(destination, total) {
        var _this = _super.call(this, destination) || this;
        _this.total = total;
        _this.count = 0;
        return _this;
    }
    TakeSubscriber.prototype._next = function (value) {
        var total = this.total;
        var count = ++this.count;
        if (count <= total) {
            this.destination.next(value);
            if (count === total) {
                this.destination.complete();
                this.unsubscribe();
            }
        }
    };
    return TakeSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=take.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/elementAt.js
/** PURE_IMPORTS_START _util_ArgumentOutOfRangeError,_filter,_throwIfEmpty,_defaultIfEmpty,_take PURE_IMPORTS_END */





function elementAt(index, defaultValue) {
    if (index < 0) {
        throw new ArgumentOutOfRangeError/* ArgumentOutOfRangeError */.W();
    }
    var hasDefaultValue = arguments.length >= 2;
    return function (source) {
        return source.pipe((0,filter/* filter */.h)(function (v, i) { return i === index; }), take(1), hasDefaultValue
            ? defaultIfEmpty(defaultValue)
            : throwIfEmpty(function () { return new ArgumentOutOfRangeError/* ArgumentOutOfRangeError */.W(); }));
    };
}
//# sourceMappingURL=elementAt.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/of.js
var of = __webpack_require__(8170);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/endWith.js
/** PURE_IMPORTS_START _observable_concat,_observable_of PURE_IMPORTS_END */


function endWith() {
    var array = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        array[_i] = arguments[_i];
    }
    return function (source) { return (0,concat/* concat */.z)(source, of.of.apply(void 0, array)); };
}
//# sourceMappingURL=endWith.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/every.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function every(predicate, thisArg) {
    return function (source) { return source.lift(new EveryOperator(predicate, thisArg, source)); };
}
var EveryOperator = /*@__PURE__*/ (function () {
    function EveryOperator(predicate, thisArg, source) {
        this.predicate = predicate;
        this.thisArg = thisArg;
        this.source = source;
    }
    EveryOperator.prototype.call = function (observer, source) {
        return source.subscribe(new EverySubscriber(observer, this.predicate, this.thisArg, this.source));
    };
    return EveryOperator;
}());
var EverySubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(EverySubscriber, _super);
    function EverySubscriber(destination, predicate, thisArg, source) {
        var _this = _super.call(this, destination) || this;
        _this.predicate = predicate;
        _this.thisArg = thisArg;
        _this.source = source;
        _this.index = 0;
        _this.thisArg = thisArg || _this;
        return _this;
    }
    EverySubscriber.prototype.notifyComplete = function (everyValueMatch) {
        this.destination.next(everyValueMatch);
        this.destination.complete();
    };
    EverySubscriber.prototype._next = function (value) {
        var result = false;
        try {
            result = this.predicate.call(this.thisArg, value, this.index++, this.source);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        if (!result) {
            this.notifyComplete(false);
        }
    };
    EverySubscriber.prototype._complete = function () {
        this.notifyComplete(true);
    };
    return EverySubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=every.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/exhaust.js
/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */


function exhaust() {
    return function (source) { return source.lift(new SwitchFirstOperator()); };
}
var SwitchFirstOperator = /*@__PURE__*/ (function () {
    function SwitchFirstOperator() {
    }
    SwitchFirstOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new SwitchFirstSubscriber(subscriber));
    };
    return SwitchFirstOperator;
}());
var SwitchFirstSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SwitchFirstSubscriber, _super);
    function SwitchFirstSubscriber(destination) {
        var _this = _super.call(this, destination) || this;
        _this.hasCompleted = false;
        _this.hasSubscription = false;
        return _this;
    }
    SwitchFirstSubscriber.prototype._next = function (value) {
        if (!this.hasSubscription) {
            this.hasSubscription = true;
            this.add((0,innerSubscribe/* innerSubscribe */.ft)(value, new innerSubscribe/* SimpleInnerSubscriber */.IY(this)));
        }
    };
    SwitchFirstSubscriber.prototype._complete = function () {
        this.hasCompleted = true;
        if (!this.hasSubscription) {
            this.destination.complete();
        }
    };
    SwitchFirstSubscriber.prototype.notifyComplete = function () {
        this.hasSubscription = false;
        if (this.hasCompleted) {
            this.destination.complete();
        }
    };
    return SwitchFirstSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=exhaust.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/operators/map.js
var map = __webpack_require__(5709);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/exhaustMap.js
/** PURE_IMPORTS_START tslib,_map,_observable_from,_innerSubscribe PURE_IMPORTS_END */




function exhaustMap(project, resultSelector) {
    if (resultSelector) {
        return function (source) { return source.pipe(exhaustMap(function (a, i) { return (0,observable_from/* from */.D)(project(a, i)).pipe((0,map/* map */.U)(function (b, ii) { return resultSelector(a, b, i, ii); })); })); };
    }
    return function (source) {
        return source.lift(new ExhaustMapOperator(project));
    };
}
var ExhaustMapOperator = /*@__PURE__*/ (function () {
    function ExhaustMapOperator(project) {
        this.project = project;
    }
    ExhaustMapOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new ExhaustMapSubscriber(subscriber, this.project));
    };
    return ExhaustMapOperator;
}());
var ExhaustMapSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(ExhaustMapSubscriber, _super);
    function ExhaustMapSubscriber(destination, project) {
        var _this = _super.call(this, destination) || this;
        _this.project = project;
        _this.hasSubscription = false;
        _this.hasCompleted = false;
        _this.index = 0;
        return _this;
    }
    ExhaustMapSubscriber.prototype._next = function (value) {
        if (!this.hasSubscription) {
            this.tryNext(value);
        }
    };
    ExhaustMapSubscriber.prototype.tryNext = function (value) {
        var result;
        var index = this.index++;
        try {
            result = this.project(value, index);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        this.hasSubscription = true;
        this._innerSub(result);
    };
    ExhaustMapSubscriber.prototype._innerSub = function (result) {
        var innerSubscriber = new innerSubscribe/* SimpleInnerSubscriber */.IY(this);
        var destination = this.destination;
        destination.add(innerSubscriber);
        var innerSubscription = (0,innerSubscribe/* innerSubscribe */.ft)(result, innerSubscriber);
        if (innerSubscription !== innerSubscriber) {
            destination.add(innerSubscription);
        }
    };
    ExhaustMapSubscriber.prototype._complete = function () {
        this.hasCompleted = true;
        if (!this.hasSubscription) {
            this.destination.complete();
        }
        this.unsubscribe();
    };
    ExhaustMapSubscriber.prototype.notifyNext = function (innerValue) {
        this.destination.next(innerValue);
    };
    ExhaustMapSubscriber.prototype.notifyError = function (err) {
        this.destination.error(err);
    };
    ExhaustMapSubscriber.prototype.notifyComplete = function () {
        this.hasSubscription = false;
        if (this.hasCompleted) {
            this.destination.complete();
        }
    };
    return ExhaustMapSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=exhaustMap.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/expand.js
/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */


function expand(project, concurrent, scheduler) {
    if (concurrent === void 0) {
        concurrent = Number.POSITIVE_INFINITY;
    }
    concurrent = (concurrent || 0) < 1 ? Number.POSITIVE_INFINITY : concurrent;
    return function (source) { return source.lift(new ExpandOperator(project, concurrent, scheduler)); };
}
var ExpandOperator = /*@__PURE__*/ (function () {
    function ExpandOperator(project, concurrent, scheduler) {
        this.project = project;
        this.concurrent = concurrent;
        this.scheduler = scheduler;
    }
    ExpandOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new ExpandSubscriber(subscriber, this.project, this.concurrent, this.scheduler));
    };
    return ExpandOperator;
}());

var ExpandSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(ExpandSubscriber, _super);
    function ExpandSubscriber(destination, project, concurrent, scheduler) {
        var _this = _super.call(this, destination) || this;
        _this.project = project;
        _this.concurrent = concurrent;
        _this.scheduler = scheduler;
        _this.index = 0;
        _this.active = 0;
        _this.hasCompleted = false;
        if (concurrent < Number.POSITIVE_INFINITY) {
            _this.buffer = [];
        }
        return _this;
    }
    ExpandSubscriber.dispatch = function (arg) {
        var subscriber = arg.subscriber, result = arg.result, value = arg.value, index = arg.index;
        subscriber.subscribeToProjection(result, value, index);
    };
    ExpandSubscriber.prototype._next = function (value) {
        var destination = this.destination;
        if (destination.closed) {
            this._complete();
            return;
        }
        var index = this.index++;
        if (this.active < this.concurrent) {
            destination.next(value);
            try {
                var project = this.project;
                var result = project(value, index);
                if (!this.scheduler) {
                    this.subscribeToProjection(result, value, index);
                }
                else {
                    var state = { subscriber: this, result: result, value: value, index: index };
                    var destination_1 = this.destination;
                    destination_1.add(this.scheduler.schedule(ExpandSubscriber.dispatch, 0, state));
                }
            }
            catch (e) {
                destination.error(e);
            }
        }
        else {
            this.buffer.push(value);
        }
    };
    ExpandSubscriber.prototype.subscribeToProjection = function (result, value, index) {
        this.active++;
        var destination = this.destination;
        destination.add((0,innerSubscribe/* innerSubscribe */.ft)(result, new innerSubscribe/* SimpleInnerSubscriber */.IY(this)));
    };
    ExpandSubscriber.prototype._complete = function () {
        this.hasCompleted = true;
        if (this.hasCompleted && this.active === 0) {
            this.destination.complete();
        }
        this.unsubscribe();
    };
    ExpandSubscriber.prototype.notifyNext = function (innerValue) {
        this._next(innerValue);
    };
    ExpandSubscriber.prototype.notifyComplete = function () {
        var buffer = this.buffer;
        this.active--;
        if (buffer && buffer.length > 0) {
            this._next(buffer.shift());
        }
        if (this.hasCompleted && this.active === 0) {
            this.destination.complete();
        }
    };
    return ExpandSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));

//# sourceMappingURL=expand.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/finalize.js
/** PURE_IMPORTS_START tslib,_Subscriber,_Subscription PURE_IMPORTS_END */



function finalize(callback) {
    return function (source) { return source.lift(new FinallyOperator(callback)); };
}
var FinallyOperator = /*@__PURE__*/ (function () {
    function FinallyOperator(callback) {
        this.callback = callback;
    }
    FinallyOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new FinallySubscriber(subscriber, this.callback));
    };
    return FinallyOperator;
}());
var FinallySubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(FinallySubscriber, _super);
    function FinallySubscriber(destination, callback) {
        var _this = _super.call(this, destination) || this;
        _this.add(new Subscription/* Subscription */.w(callback));
        return _this;
    }
    return FinallySubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=finalize.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/find.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function find(predicate, thisArg) {
    if (typeof predicate !== 'function') {
        throw new TypeError('predicate is not a function');
    }
    return function (source) { return source.lift(new FindValueOperator(predicate, source, false, thisArg)); };
}
var FindValueOperator = /*@__PURE__*/ (function () {
    function FindValueOperator(predicate, source, yieldIndex, thisArg) {
        this.predicate = predicate;
        this.source = source;
        this.yieldIndex = yieldIndex;
        this.thisArg = thisArg;
    }
    FindValueOperator.prototype.call = function (observer, source) {
        return source.subscribe(new FindValueSubscriber(observer, this.predicate, this.source, this.yieldIndex, this.thisArg));
    };
    return FindValueOperator;
}());

var FindValueSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(FindValueSubscriber, _super);
    function FindValueSubscriber(destination, predicate, source, yieldIndex, thisArg) {
        var _this = _super.call(this, destination) || this;
        _this.predicate = predicate;
        _this.source = source;
        _this.yieldIndex = yieldIndex;
        _this.thisArg = thisArg;
        _this.index = 0;
        return _this;
    }
    FindValueSubscriber.prototype.notifyComplete = function (value) {
        var destination = this.destination;
        destination.next(value);
        destination.complete();
        this.unsubscribe();
    };
    FindValueSubscriber.prototype._next = function (value) {
        var _a = this, predicate = _a.predicate, thisArg = _a.thisArg;
        var index = this.index++;
        try {
            var result = predicate.call(thisArg || this, value, index, this.source);
            if (result) {
                this.notifyComplete(this.yieldIndex ? index : value);
            }
        }
        catch (err) {
            this.destination.error(err);
        }
    };
    FindValueSubscriber.prototype._complete = function () {
        this.notifyComplete(this.yieldIndex ? -1 : undefined);
    };
    return FindValueSubscriber;
}(Subscriber/* Subscriber */.L));

//# sourceMappingURL=find.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/findIndex.js
/** PURE_IMPORTS_START _operators_find PURE_IMPORTS_END */

function findIndex(predicate, thisArg) {
    return function (source) { return source.lift(new FindValueOperator(predicate, source, true, thisArg)); };
}
//# sourceMappingURL=findIndex.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/identity.js
var identity = __webpack_require__(3608);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/first.js
/** PURE_IMPORTS_START _util_EmptyError,_filter,_take,_defaultIfEmpty,_throwIfEmpty,_util_identity PURE_IMPORTS_END */






function first(predicate, defaultValue) {
    var hasDefaultValue = arguments.length >= 2;
    return function (source) { return source.pipe(predicate ? (0,filter/* filter */.h)(function (v, i) { return predicate(v, i, source); }) : identity/* identity */.y, take(1), hasDefaultValue ? defaultIfEmpty(defaultValue) : throwIfEmpty(function () { return new EmptyError/* EmptyError */.K(); })); };
}
//# sourceMappingURL=first.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/operators/groupBy.js
var groupBy = __webpack_require__(1120);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/ignoreElements.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function ignoreElements() {
    return function ignoreElementsOperatorFunction(source) {
        return source.lift(new IgnoreElementsOperator());
    };
}
var IgnoreElementsOperator = /*@__PURE__*/ (function () {
    function IgnoreElementsOperator() {
    }
    IgnoreElementsOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new IgnoreElementsSubscriber(subscriber));
    };
    return IgnoreElementsOperator;
}());
var IgnoreElementsSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(IgnoreElementsSubscriber, _super);
    function IgnoreElementsSubscriber() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    IgnoreElementsSubscriber.prototype._next = function (unused) {
    };
    return IgnoreElementsSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=ignoreElements.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/isEmpty.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function isEmpty() {
    return function (source) { return source.lift(new IsEmptyOperator()); };
}
var IsEmptyOperator = /*@__PURE__*/ (function () {
    function IsEmptyOperator() {
    }
    IsEmptyOperator.prototype.call = function (observer, source) {
        return source.subscribe(new IsEmptySubscriber(observer));
    };
    return IsEmptyOperator;
}());
var IsEmptySubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(IsEmptySubscriber, _super);
    function IsEmptySubscriber(destination) {
        return _super.call(this, destination) || this;
    }
    IsEmptySubscriber.prototype.notifyComplete = function (isEmpty) {
        var destination = this.destination;
        destination.next(isEmpty);
        destination.complete();
    };
    IsEmptySubscriber.prototype._next = function (value) {
        this.notifyComplete(false);
    };
    IsEmptySubscriber.prototype._complete = function () {
        this.notifyComplete(true);
    };
    return IsEmptySubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=isEmpty.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/takeLast.js
/** PURE_IMPORTS_START tslib,_Subscriber,_util_ArgumentOutOfRangeError,_observable_empty PURE_IMPORTS_END */




function takeLast(count) {
    return function takeLastOperatorFunction(source) {
        if (count === 0) {
            return (0,empty/* empty */.c)();
        }
        else {
            return source.lift(new TakeLastOperator(count));
        }
    };
}
var TakeLastOperator = /*@__PURE__*/ (function () {
    function TakeLastOperator(total) {
        this.total = total;
        if (this.total < 0) {
            throw new ArgumentOutOfRangeError/* ArgumentOutOfRangeError */.W;
        }
    }
    TakeLastOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new TakeLastSubscriber(subscriber, this.total));
    };
    return TakeLastOperator;
}());
var TakeLastSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(TakeLastSubscriber, _super);
    function TakeLastSubscriber(destination, total) {
        var _this = _super.call(this, destination) || this;
        _this.total = total;
        _this.ring = new Array();
        _this.count = 0;
        return _this;
    }
    TakeLastSubscriber.prototype._next = function (value) {
        var ring = this.ring;
        var total = this.total;
        var count = this.count++;
        if (ring.length < total) {
            ring.push(value);
        }
        else {
            var index = count % total;
            ring[index] = value;
        }
    };
    TakeLastSubscriber.prototype._complete = function () {
        var destination = this.destination;
        var count = this.count;
        if (count > 0) {
            var total = this.count >= this.total ? this.total : this.count;
            var ring = this.ring;
            for (var i = 0; i < total; i++) {
                var idx = (count++) % total;
                destination.next(ring[idx]);
            }
        }
        destination.complete();
    };
    return TakeLastSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=takeLast.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/last.js
/** PURE_IMPORTS_START _util_EmptyError,_filter,_takeLast,_throwIfEmpty,_defaultIfEmpty,_util_identity PURE_IMPORTS_END */






function last(predicate, defaultValue) {
    var hasDefaultValue = arguments.length >= 2;
    return function (source) { return source.pipe(predicate ? (0,filter/* filter */.h)(function (v, i) { return predicate(v, i, source); }) : identity/* identity */.y, takeLast(1), hasDefaultValue ? defaultIfEmpty(defaultValue) : throwIfEmpty(function () { return new EmptyError/* EmptyError */.K(); })); };
}
//# sourceMappingURL=last.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/mapTo.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function mapTo(value) {
    return function (source) { return source.lift(new MapToOperator(value)); };
}
var MapToOperator = /*@__PURE__*/ (function () {
    function MapToOperator(value) {
        this.value = value;
    }
    MapToOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new MapToSubscriber(subscriber, this.value));
    };
    return MapToOperator;
}());
var MapToSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(MapToSubscriber, _super);
    function MapToSubscriber(destination, value) {
        var _this = _super.call(this, destination) || this;
        _this.value = value;
        return _this;
    }
    MapToSubscriber.prototype._next = function (x) {
        this.destination.next(this.value);
    };
    return MapToSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=mapTo.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/materialize.js
/** PURE_IMPORTS_START tslib,_Subscriber,_Notification PURE_IMPORTS_END */



function materialize() {
    return function materializeOperatorFunction(source) {
        return source.lift(new MaterializeOperator());
    };
}
var MaterializeOperator = /*@__PURE__*/ (function () {
    function MaterializeOperator() {
    }
    MaterializeOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new MaterializeSubscriber(subscriber));
    };
    return MaterializeOperator;
}());
var MaterializeSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(MaterializeSubscriber, _super);
    function MaterializeSubscriber(destination) {
        return _super.call(this, destination) || this;
    }
    MaterializeSubscriber.prototype._next = function (value) {
        this.destination.next(Notification/* Notification.createNext */.P.createNext(value));
    };
    MaterializeSubscriber.prototype._error = function (err) {
        var destination = this.destination;
        destination.next(Notification/* Notification.createError */.P.createError(err));
        destination.complete();
    };
    MaterializeSubscriber.prototype._complete = function () {
        var destination = this.destination;
        destination.next(Notification/* Notification.createComplete */.P.createComplete());
        destination.complete();
    };
    return MaterializeSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=materialize.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/scan.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function scan(accumulator, seed) {
    var hasSeed = false;
    if (arguments.length >= 2) {
        hasSeed = true;
    }
    return function scanOperatorFunction(source) {
        return source.lift(new ScanOperator(accumulator, seed, hasSeed));
    };
}
var ScanOperator = /*@__PURE__*/ (function () {
    function ScanOperator(accumulator, seed, hasSeed) {
        if (hasSeed === void 0) {
            hasSeed = false;
        }
        this.accumulator = accumulator;
        this.seed = seed;
        this.hasSeed = hasSeed;
    }
    ScanOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new ScanSubscriber(subscriber, this.accumulator, this.seed, this.hasSeed));
    };
    return ScanOperator;
}());
var ScanSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(ScanSubscriber, _super);
    function ScanSubscriber(destination, accumulator, _seed, hasSeed) {
        var _this = _super.call(this, destination) || this;
        _this.accumulator = accumulator;
        _this._seed = _seed;
        _this.hasSeed = hasSeed;
        _this.index = 0;
        return _this;
    }
    Object.defineProperty(ScanSubscriber.prototype, "seed", {
        get: function () {
            return this._seed;
        },
        set: function (value) {
            this.hasSeed = true;
            this._seed = value;
        },
        enumerable: true,
        configurable: true
    });
    ScanSubscriber.prototype._next = function (value) {
        if (!this.hasSeed) {
            this.seed = value;
            this.destination.next(value);
        }
        else {
            return this._tryNext(value);
        }
    };
    ScanSubscriber.prototype._tryNext = function (value) {
        var index = this.index++;
        var result;
        try {
            result = this.accumulator(this.seed, value, index);
        }
        catch (err) {
            this.destination.error(err);
        }
        this.seed = result;
        this.destination.next(result);
    };
    return ScanSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=scan.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/pipe.js
var pipe = __webpack_require__(2561);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/reduce.js
/** PURE_IMPORTS_START _scan,_takeLast,_defaultIfEmpty,_util_pipe PURE_IMPORTS_END */




function reduce(accumulator, seed) {
    if (arguments.length >= 2) {
        return function reduceOperatorFunctionWithSeed(source) {
            return (0,pipe/* pipe */.z)(scan(accumulator, seed), takeLast(1), defaultIfEmpty(seed))(source);
        };
    }
    return function reduceOperatorFunction(source) {
        return (0,pipe/* pipe */.z)(scan(function (acc, value, index) { return accumulator(acc, value, index + 1); }), takeLast(1))(source);
    };
}
//# sourceMappingURL=reduce.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/max.js
/** PURE_IMPORTS_START _reduce PURE_IMPORTS_END */

function max(comparer) {
    var max = (typeof comparer === 'function')
        ? function (x, y) { return comparer(x, y) > 0 ? x : y; }
        : function (x, y) { return x > y ? x : y; };
    return reduce(max);
}
//# sourceMappingURL=max.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/merge.js
var merge = __webpack_require__(4370);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/merge.js
/** PURE_IMPORTS_START _observable_merge PURE_IMPORTS_END */

function merge_merge() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    return function (source) { return source.lift.call(merge/* merge.apply */.T.apply(void 0, [source].concat(observables))); };
}
//# sourceMappingURL=merge.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/operators/mergeAll.js
var mergeAll = __webpack_require__(2556);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/mergeMapTo.js
/** PURE_IMPORTS_START _mergeMap PURE_IMPORTS_END */

function mergeMapTo(innerObservable, resultSelector, concurrent) {
    if (concurrent === void 0) {
        concurrent = Number.POSITIVE_INFINITY;
    }
    if (typeof resultSelector === 'function') {
        return (0,mergeMap/* mergeMap */.zg)(function () { return innerObservable; }, resultSelector, concurrent);
    }
    if (typeof resultSelector === 'number') {
        concurrent = resultSelector;
    }
    return (0,mergeMap/* mergeMap */.zg)(function () { return innerObservable; }, concurrent);
}
//# sourceMappingURL=mergeMapTo.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/mergeScan.js
/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */


function mergeScan(accumulator, seed, concurrent) {
    if (concurrent === void 0) {
        concurrent = Number.POSITIVE_INFINITY;
    }
    return function (source) { return source.lift(new MergeScanOperator(accumulator, seed, concurrent)); };
}
var MergeScanOperator = /*@__PURE__*/ (function () {
    function MergeScanOperator(accumulator, seed, concurrent) {
        this.accumulator = accumulator;
        this.seed = seed;
        this.concurrent = concurrent;
    }
    MergeScanOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new MergeScanSubscriber(subscriber, this.accumulator, this.seed, this.concurrent));
    };
    return MergeScanOperator;
}());

var MergeScanSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(MergeScanSubscriber, _super);
    function MergeScanSubscriber(destination, accumulator, acc, concurrent) {
        var _this = _super.call(this, destination) || this;
        _this.accumulator = accumulator;
        _this.acc = acc;
        _this.concurrent = concurrent;
        _this.hasValue = false;
        _this.hasCompleted = false;
        _this.buffer = [];
        _this.active = 0;
        _this.index = 0;
        return _this;
    }
    MergeScanSubscriber.prototype._next = function (value) {
        if (this.active < this.concurrent) {
            var index = this.index++;
            var destination = this.destination;
            var ish = void 0;
            try {
                var accumulator = this.accumulator;
                ish = accumulator(this.acc, value, index);
            }
            catch (e) {
                return destination.error(e);
            }
            this.active++;
            this._innerSub(ish);
        }
        else {
            this.buffer.push(value);
        }
    };
    MergeScanSubscriber.prototype._innerSub = function (ish) {
        var innerSubscriber = new innerSubscribe/* SimpleInnerSubscriber */.IY(this);
        var destination = this.destination;
        destination.add(innerSubscriber);
        var innerSubscription = (0,innerSubscribe/* innerSubscribe */.ft)(ish, innerSubscriber);
        if (innerSubscription !== innerSubscriber) {
            destination.add(innerSubscription);
        }
    };
    MergeScanSubscriber.prototype._complete = function () {
        this.hasCompleted = true;
        if (this.active === 0 && this.buffer.length === 0) {
            if (this.hasValue === false) {
                this.destination.next(this.acc);
            }
            this.destination.complete();
        }
        this.unsubscribe();
    };
    MergeScanSubscriber.prototype.notifyNext = function (innerValue) {
        var destination = this.destination;
        this.acc = innerValue;
        this.hasValue = true;
        destination.next(innerValue);
    };
    MergeScanSubscriber.prototype.notifyComplete = function () {
        var buffer = this.buffer;
        this.active--;
        if (buffer.length > 0) {
            this._next(buffer.shift());
        }
        else if (this.active === 0 && this.hasCompleted) {
            if (this.hasValue === false) {
                this.destination.next(this.acc);
            }
            this.destination.complete();
        }
    };
    return MergeScanSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));

//# sourceMappingURL=mergeScan.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/min.js
/** PURE_IMPORTS_START _reduce PURE_IMPORTS_END */

function min(comparer) {
    var min = (typeof comparer === 'function')
        ? function (x, y) { return comparer(x, y) < 0 ? x : y; }
        : function (x, y) { return x < y ? x : y; };
    return reduce(min);
}
//# sourceMappingURL=min.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/ConnectableObservable.js
var ConnectableObservable = __webpack_require__(3140);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/multicast.js
/** PURE_IMPORTS_START _observable_ConnectableObservable PURE_IMPORTS_END */

function multicast(subjectOrSubjectFactory, selector) {
    return function multicastOperatorFunction(source) {
        var subjectFactory;
        if (typeof subjectOrSubjectFactory === 'function') {
            subjectFactory = subjectOrSubjectFactory;
        }
        else {
            subjectFactory = function subjectFactory() {
                return subjectOrSubjectFactory;
            };
        }
        if (typeof selector === 'function') {
            return source.lift(new MulticastOperator(subjectFactory, selector));
        }
        var connectable = Object.create(source, ConnectableObservable/* connectableObservableDescriptor */.N);
        connectable.source = source;
        connectable.subjectFactory = subjectFactory;
        return connectable;
    };
}
var MulticastOperator = /*@__PURE__*/ (function () {
    function MulticastOperator(subjectFactory, selector) {
        this.subjectFactory = subjectFactory;
        this.selector = selector;
    }
    MulticastOperator.prototype.call = function (subscriber, source) {
        var selector = this.selector;
        var subject = this.subjectFactory();
        var subscription = selector(subject).subscribe(subscriber);
        subscription.add(source.subscribe(subject));
        return subscription;
    };
    return MulticastOperator;
}());

//# sourceMappingURL=multicast.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/operators/observeOn.js
var observeOn = __webpack_require__(9276);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/onErrorResumeNext.js
/** PURE_IMPORTS_START tslib,_observable_from,_util_isArray,_innerSubscribe PURE_IMPORTS_END */




function onErrorResumeNext() {
    var nextSources = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        nextSources[_i] = arguments[_i];
    }
    if (nextSources.length === 1 && (0,util_isArray/* isArray */.k)(nextSources[0])) {
        nextSources = nextSources[0];
    }
    return function (source) { return source.lift(new OnErrorResumeNextOperator(nextSources)); };
}
function onErrorResumeNextStatic() {
    var nextSources = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        nextSources[_i] = arguments[_i];
    }
    var source = undefined;
    if (nextSources.length === 1 && isArray(nextSources[0])) {
        nextSources = nextSources[0];
    }
    source = nextSources.shift();
    return from(source).lift(new OnErrorResumeNextOperator(nextSources));
}
var OnErrorResumeNextOperator = /*@__PURE__*/ (function () {
    function OnErrorResumeNextOperator(nextSources) {
        this.nextSources = nextSources;
    }
    OnErrorResumeNextOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new OnErrorResumeNextSubscriber(subscriber, this.nextSources));
    };
    return OnErrorResumeNextOperator;
}());
var OnErrorResumeNextSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(OnErrorResumeNextSubscriber, _super);
    function OnErrorResumeNextSubscriber(destination, nextSources) {
        var _this = _super.call(this, destination) || this;
        _this.destination = destination;
        _this.nextSources = nextSources;
        return _this;
    }
    OnErrorResumeNextSubscriber.prototype.notifyError = function () {
        this.subscribeToNextSource();
    };
    OnErrorResumeNextSubscriber.prototype.notifyComplete = function () {
        this.subscribeToNextSource();
    };
    OnErrorResumeNextSubscriber.prototype._error = function (err) {
        this.subscribeToNextSource();
        this.unsubscribe();
    };
    OnErrorResumeNextSubscriber.prototype._complete = function () {
        this.subscribeToNextSource();
        this.unsubscribe();
    };
    OnErrorResumeNextSubscriber.prototype.subscribeToNextSource = function () {
        var next = this.nextSources.shift();
        if (!!next) {
            var innerSubscriber = new innerSubscribe/* SimpleInnerSubscriber */.IY(this);
            var destination = this.destination;
            destination.add(innerSubscriber);
            var innerSubscription = (0,innerSubscribe/* innerSubscribe */.ft)(next, innerSubscriber);
            if (innerSubscription !== innerSubscriber) {
                destination.add(innerSubscription);
            }
        }
        else {
            this.destination.complete();
        }
    };
    return OnErrorResumeNextSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=onErrorResumeNext.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/pairwise.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function pairwise() {
    return function (source) { return source.lift(new PairwiseOperator()); };
}
var PairwiseOperator = /*@__PURE__*/ (function () {
    function PairwiseOperator() {
    }
    PairwiseOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new PairwiseSubscriber(subscriber));
    };
    return PairwiseOperator;
}());
var PairwiseSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(PairwiseSubscriber, _super);
    function PairwiseSubscriber(destination) {
        var _this = _super.call(this, destination) || this;
        _this.hasPrev = false;
        return _this;
    }
    PairwiseSubscriber.prototype._next = function (value) {
        var pair;
        if (this.hasPrev) {
            pair = [this.prev, value];
        }
        else {
            this.hasPrev = true;
        }
        this.prev = value;
        if (pair) {
            this.destination.next(pair);
        }
    };
    return PairwiseSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=pairwise.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/not.js
var not = __webpack_require__(8463);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/partition.js
/** PURE_IMPORTS_START _util_not,_filter PURE_IMPORTS_END */


function partition(predicate, thisArg) {
    return function (source) {
        return [
            (0,filter/* filter */.h)(predicate, thisArg)(source),
            (0,filter/* filter */.h)((0,not/* not */.f)(predicate, thisArg))(source)
        ];
    };
}
//# sourceMappingURL=partition.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/pluck.js
/** PURE_IMPORTS_START _map PURE_IMPORTS_END */

function pluck() {
    var properties = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        properties[_i] = arguments[_i];
    }
    var length = properties.length;
    if (length === 0) {
        throw new Error('list of properties cannot be empty.');
    }
    return function (source) { return (0,map/* map */.U)(plucker(properties, length))(source); };
}
function plucker(props, length) {
    var mapper = function (x) {
        var currentProp = x;
        for (var i = 0; i < length; i++) {
            var p = currentProp != null ? currentProp[props[i]] : undefined;
            if (p !== void 0) {
                currentProp = p;
            }
            else {
                return undefined;
            }
        }
        return currentProp;
    };
    return mapper;
}
//# sourceMappingURL=pluck.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/Subject.js
var Subject = __webpack_require__(211);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/publish.js
/** PURE_IMPORTS_START _Subject,_multicast PURE_IMPORTS_END */


function publish(selector) {
    return selector ?
        multicast(function () { return new Subject/* Subject */.xQ(); }, selector) :
        multicast(new Subject/* Subject */.xQ());
}
//# sourceMappingURL=publish.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/BehaviorSubject.js
var BehaviorSubject = __webpack_require__(9233);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/publishBehavior.js
/** PURE_IMPORTS_START _BehaviorSubject,_multicast PURE_IMPORTS_END */


function publishBehavior(value) {
    return function (source) { return multicast(new BehaviorSubject/* BehaviorSubject */.X(value))(source); };
}
//# sourceMappingURL=publishBehavior.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/AsyncSubject.js
var AsyncSubject = __webpack_require__(364);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/publishLast.js
/** PURE_IMPORTS_START _AsyncSubject,_multicast PURE_IMPORTS_END */


function publishLast() {
    return function (source) { return multicast(new AsyncSubject/* AsyncSubject */.c())(source); };
}
//# sourceMappingURL=publishLast.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/ReplaySubject.js
var ReplaySubject = __webpack_require__(2630);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/publishReplay.js
/** PURE_IMPORTS_START _ReplaySubject,_multicast PURE_IMPORTS_END */


function publishReplay(bufferSize, windowTime, selectorOrScheduler, scheduler) {
    if (selectorOrScheduler && typeof selectorOrScheduler !== 'function') {
        scheduler = selectorOrScheduler;
    }
    var selector = typeof selectorOrScheduler === 'function' ? selectorOrScheduler : undefined;
    var subject = new ReplaySubject/* ReplaySubject */.t(bufferSize, windowTime, scheduler);
    return function (source) { return multicast(function () { return subject; }, selector)(source); };
}
//# sourceMappingURL=publishReplay.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/race.js
var race = __webpack_require__(8821);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/race.js
/** PURE_IMPORTS_START _util_isArray,_observable_race PURE_IMPORTS_END */


function race_race() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    return function raceOperatorFunction(source) {
        if (observables.length === 1 && (0,util_isArray/* isArray */.k)(observables[0])) {
            observables = observables[0];
        }
        return source.lift.call(race/* race.apply */.S3.apply(void 0, [source].concat(observables)));
    };
}
//# sourceMappingURL=race.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/repeat.js
/** PURE_IMPORTS_START tslib,_Subscriber,_observable_empty PURE_IMPORTS_END */



function repeat(count) {
    if (count === void 0) {
        count = -1;
    }
    return function (source) {
        if (count === 0) {
            return (0,empty/* empty */.c)();
        }
        else if (count < 0) {
            return source.lift(new RepeatOperator(-1, source));
        }
        else {
            return source.lift(new RepeatOperator(count - 1, source));
        }
    };
}
var RepeatOperator = /*@__PURE__*/ (function () {
    function RepeatOperator(count, source) {
        this.count = count;
        this.source = source;
    }
    RepeatOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new RepeatSubscriber(subscriber, this.count, this.source));
    };
    return RepeatOperator;
}());
var RepeatSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(RepeatSubscriber, _super);
    function RepeatSubscriber(destination, count, source) {
        var _this = _super.call(this, destination) || this;
        _this.count = count;
        _this.source = source;
        return _this;
    }
    RepeatSubscriber.prototype.complete = function () {
        if (!this.isStopped) {
            var _a = this, source = _a.source, count = _a.count;
            if (count === 0) {
                return _super.prototype.complete.call(this);
            }
            else if (count > -1) {
                this.count = count - 1;
            }
            source.subscribe(this._unsubscribeAndRecycle());
        }
    };
    return RepeatSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=repeat.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/repeatWhen.js
/** PURE_IMPORTS_START tslib,_Subject,_innerSubscribe PURE_IMPORTS_END */



function repeatWhen(notifier) {
    return function (source) { return source.lift(new RepeatWhenOperator(notifier)); };
}
var RepeatWhenOperator = /*@__PURE__*/ (function () {
    function RepeatWhenOperator(notifier) {
        this.notifier = notifier;
    }
    RepeatWhenOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new RepeatWhenSubscriber(subscriber, this.notifier, source));
    };
    return RepeatWhenOperator;
}());
var RepeatWhenSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(RepeatWhenSubscriber, _super);
    function RepeatWhenSubscriber(destination, notifier, source) {
        var _this = _super.call(this, destination) || this;
        _this.notifier = notifier;
        _this.source = source;
        _this.sourceIsBeingSubscribedTo = true;
        return _this;
    }
    RepeatWhenSubscriber.prototype.notifyNext = function () {
        this.sourceIsBeingSubscribedTo = true;
        this.source.subscribe(this);
    };
    RepeatWhenSubscriber.prototype.notifyComplete = function () {
        if (this.sourceIsBeingSubscribedTo === false) {
            return _super.prototype.complete.call(this);
        }
    };
    RepeatWhenSubscriber.prototype.complete = function () {
        this.sourceIsBeingSubscribedTo = false;
        if (!this.isStopped) {
            if (!this.retries) {
                this.subscribeToRetries();
            }
            if (!this.retriesSubscription || this.retriesSubscription.closed) {
                return _super.prototype.complete.call(this);
            }
            this._unsubscribeAndRecycle();
            this.notifications.next(undefined);
        }
    };
    RepeatWhenSubscriber.prototype._unsubscribe = function () {
        var _a = this, notifications = _a.notifications, retriesSubscription = _a.retriesSubscription;
        if (notifications) {
            notifications.unsubscribe();
            this.notifications = undefined;
        }
        if (retriesSubscription) {
            retriesSubscription.unsubscribe();
            this.retriesSubscription = undefined;
        }
        this.retries = undefined;
    };
    RepeatWhenSubscriber.prototype._unsubscribeAndRecycle = function () {
        var _unsubscribe = this._unsubscribe;
        this._unsubscribe = null;
        _super.prototype._unsubscribeAndRecycle.call(this);
        this._unsubscribe = _unsubscribe;
        return this;
    };
    RepeatWhenSubscriber.prototype.subscribeToRetries = function () {
        this.notifications = new Subject/* Subject */.xQ();
        var retries;
        try {
            var notifier = this.notifier;
            retries = notifier(this.notifications);
        }
        catch (e) {
            return _super.prototype.complete.call(this);
        }
        this.retries = retries;
        this.retriesSubscription = (0,innerSubscribe/* innerSubscribe */.ft)(retries, new innerSubscribe/* SimpleInnerSubscriber */.IY(this));
    };
    return RepeatWhenSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=repeatWhen.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/retry.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function retry(count) {
    if (count === void 0) {
        count = -1;
    }
    return function (source) { return source.lift(new RetryOperator(count, source)); };
}
var RetryOperator = /*@__PURE__*/ (function () {
    function RetryOperator(count, source) {
        this.count = count;
        this.source = source;
    }
    RetryOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new RetrySubscriber(subscriber, this.count, this.source));
    };
    return RetryOperator;
}());
var RetrySubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(RetrySubscriber, _super);
    function RetrySubscriber(destination, count, source) {
        var _this = _super.call(this, destination) || this;
        _this.count = count;
        _this.source = source;
        return _this;
    }
    RetrySubscriber.prototype.error = function (err) {
        if (!this.isStopped) {
            var _a = this, source = _a.source, count = _a.count;
            if (count === 0) {
                return _super.prototype.error.call(this, err);
            }
            else if (count > -1) {
                this.count = count - 1;
            }
            source.subscribe(this._unsubscribeAndRecycle());
        }
    };
    return RetrySubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=retry.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/retryWhen.js
/** PURE_IMPORTS_START tslib,_Subject,_innerSubscribe PURE_IMPORTS_END */



function retryWhen(notifier) {
    return function (source) { return source.lift(new RetryWhenOperator(notifier, source)); };
}
var RetryWhenOperator = /*@__PURE__*/ (function () {
    function RetryWhenOperator(notifier, source) {
        this.notifier = notifier;
        this.source = source;
    }
    RetryWhenOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new RetryWhenSubscriber(subscriber, this.notifier, this.source));
    };
    return RetryWhenOperator;
}());
var RetryWhenSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(RetryWhenSubscriber, _super);
    function RetryWhenSubscriber(destination, notifier, source) {
        var _this = _super.call(this, destination) || this;
        _this.notifier = notifier;
        _this.source = source;
        return _this;
    }
    RetryWhenSubscriber.prototype.error = function (err) {
        if (!this.isStopped) {
            var errors = this.errors;
            var retries = this.retries;
            var retriesSubscription = this.retriesSubscription;
            if (!retries) {
                errors = new Subject/* Subject */.xQ();
                try {
                    var notifier = this.notifier;
                    retries = notifier(errors);
                }
                catch (e) {
                    return _super.prototype.error.call(this, e);
                }
                retriesSubscription = (0,innerSubscribe/* innerSubscribe */.ft)(retries, new innerSubscribe/* SimpleInnerSubscriber */.IY(this));
            }
            else {
                this.errors = undefined;
                this.retriesSubscription = undefined;
            }
            this._unsubscribeAndRecycle();
            this.errors = errors;
            this.retries = retries;
            this.retriesSubscription = retriesSubscription;
            errors.next(err);
        }
    };
    RetryWhenSubscriber.prototype._unsubscribe = function () {
        var _a = this, errors = _a.errors, retriesSubscription = _a.retriesSubscription;
        if (errors) {
            errors.unsubscribe();
            this.errors = undefined;
        }
        if (retriesSubscription) {
            retriesSubscription.unsubscribe();
            this.retriesSubscription = undefined;
        }
        this.retries = undefined;
    };
    RetryWhenSubscriber.prototype.notifyNext = function () {
        var _unsubscribe = this._unsubscribe;
        this._unsubscribe = null;
        this._unsubscribeAndRecycle();
        this._unsubscribe = _unsubscribe;
        this.source.subscribe(this);
    };
    return RetryWhenSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=retryWhen.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/operators/refCount.js
var refCount = __webpack_require__(3018);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/sample.js
/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */


function sample(notifier) {
    return function (source) { return source.lift(new SampleOperator(notifier)); };
}
var SampleOperator = /*@__PURE__*/ (function () {
    function SampleOperator(notifier) {
        this.notifier = notifier;
    }
    SampleOperator.prototype.call = function (subscriber, source) {
        var sampleSubscriber = new SampleSubscriber(subscriber);
        var subscription = source.subscribe(sampleSubscriber);
        subscription.add((0,innerSubscribe/* innerSubscribe */.ft)(this.notifier, new innerSubscribe/* SimpleInnerSubscriber */.IY(sampleSubscriber)));
        return subscription;
    };
    return SampleOperator;
}());
var SampleSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SampleSubscriber, _super);
    function SampleSubscriber() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.hasValue = false;
        return _this;
    }
    SampleSubscriber.prototype._next = function (value) {
        this.value = value;
        this.hasValue = true;
    };
    SampleSubscriber.prototype.notifyNext = function () {
        this.emitValue();
    };
    SampleSubscriber.prototype.notifyComplete = function () {
        this.emitValue();
    };
    SampleSubscriber.prototype.emitValue = function () {
        if (this.hasValue) {
            this.hasValue = false;
            this.destination.next(this.value);
        }
    };
    return SampleSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=sample.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/sampleTime.js
/** PURE_IMPORTS_START tslib,_Subscriber,_scheduler_async PURE_IMPORTS_END */



function sampleTime(period, scheduler) {
    if (scheduler === void 0) {
        scheduler = scheduler_async/* async */.P;
    }
    return function (source) { return source.lift(new SampleTimeOperator(period, scheduler)); };
}
var SampleTimeOperator = /*@__PURE__*/ (function () {
    function SampleTimeOperator(period, scheduler) {
        this.period = period;
        this.scheduler = scheduler;
    }
    SampleTimeOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new SampleTimeSubscriber(subscriber, this.period, this.scheduler));
    };
    return SampleTimeOperator;
}());
var SampleTimeSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SampleTimeSubscriber, _super);
    function SampleTimeSubscriber(destination, period, scheduler) {
        var _this = _super.call(this, destination) || this;
        _this.period = period;
        _this.scheduler = scheduler;
        _this.hasValue = false;
        _this.add(scheduler.schedule(dispatchNotification, period, { subscriber: _this, period: period }));
        return _this;
    }
    SampleTimeSubscriber.prototype._next = function (value) {
        this.lastValue = value;
        this.hasValue = true;
    };
    SampleTimeSubscriber.prototype.notifyNext = function () {
        if (this.hasValue) {
            this.hasValue = false;
            this.destination.next(this.lastValue);
        }
    };
    return SampleTimeSubscriber;
}(Subscriber/* Subscriber */.L));
function dispatchNotification(state) {
    var subscriber = state.subscriber, period = state.period;
    subscriber.notifyNext();
    this.schedule(state, period);
}
//# sourceMappingURL=sampleTime.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/sequenceEqual.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function sequenceEqual(compareTo, comparator) {
    return function (source) { return source.lift(new SequenceEqualOperator(compareTo, comparator)); };
}
var SequenceEqualOperator = /*@__PURE__*/ (function () {
    function SequenceEqualOperator(compareTo, comparator) {
        this.compareTo = compareTo;
        this.comparator = comparator;
    }
    SequenceEqualOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new SequenceEqualSubscriber(subscriber, this.compareTo, this.comparator));
    };
    return SequenceEqualOperator;
}());

var SequenceEqualSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SequenceEqualSubscriber, _super);
    function SequenceEqualSubscriber(destination, compareTo, comparator) {
        var _this = _super.call(this, destination) || this;
        _this.compareTo = compareTo;
        _this.comparator = comparator;
        _this._a = [];
        _this._b = [];
        _this._oneComplete = false;
        _this.destination.add(compareTo.subscribe(new SequenceEqualCompareToSubscriber(destination, _this)));
        return _this;
    }
    SequenceEqualSubscriber.prototype._next = function (value) {
        if (this._oneComplete && this._b.length === 0) {
            this.emit(false);
        }
        else {
            this._a.push(value);
            this.checkValues();
        }
    };
    SequenceEqualSubscriber.prototype._complete = function () {
        if (this._oneComplete) {
            this.emit(this._a.length === 0 && this._b.length === 0);
        }
        else {
            this._oneComplete = true;
        }
        this.unsubscribe();
    };
    SequenceEqualSubscriber.prototype.checkValues = function () {
        var _c = this, _a = _c._a, _b = _c._b, comparator = _c.comparator;
        while (_a.length > 0 && _b.length > 0) {
            var a = _a.shift();
            var b = _b.shift();
            var areEqual = false;
            try {
                areEqual = comparator ? comparator(a, b) : a === b;
            }
            catch (e) {
                this.destination.error(e);
            }
            if (!areEqual) {
                this.emit(false);
            }
        }
    };
    SequenceEqualSubscriber.prototype.emit = function (value) {
        var destination = this.destination;
        destination.next(value);
        destination.complete();
    };
    SequenceEqualSubscriber.prototype.nextB = function (value) {
        if (this._oneComplete && this._a.length === 0) {
            this.emit(false);
        }
        else {
            this._b.push(value);
            this.checkValues();
        }
    };
    SequenceEqualSubscriber.prototype.completeB = function () {
        if (this._oneComplete) {
            this.emit(this._a.length === 0 && this._b.length === 0);
        }
        else {
            this._oneComplete = true;
        }
    };
    return SequenceEqualSubscriber;
}(Subscriber/* Subscriber */.L));

var SequenceEqualCompareToSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SequenceEqualCompareToSubscriber, _super);
    function SequenceEqualCompareToSubscriber(destination, parent) {
        var _this = _super.call(this, destination) || this;
        _this.parent = parent;
        return _this;
    }
    SequenceEqualCompareToSubscriber.prototype._next = function (value) {
        this.parent.nextB(value);
    };
    SequenceEqualCompareToSubscriber.prototype._error = function (err) {
        this.parent.error(err);
        this.unsubscribe();
    };
    SequenceEqualCompareToSubscriber.prototype._complete = function () {
        this.parent.completeB();
        this.unsubscribe();
    };
    return SequenceEqualCompareToSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=sequenceEqual.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/share.js
/** PURE_IMPORTS_START _multicast,_refCount,_Subject PURE_IMPORTS_END */



function shareSubjectFactory() {
    return new Subject/* Subject */.xQ();
}
function share() {
    return function (source) { return (0,refCount/* refCount */.x)()(multicast(shareSubjectFactory)(source)); };
}
//# sourceMappingURL=share.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/shareReplay.js
/** PURE_IMPORTS_START _ReplaySubject PURE_IMPORTS_END */

function shareReplay(configOrBufferSize, windowTime, scheduler) {
    var config;
    if (configOrBufferSize && typeof configOrBufferSize === 'object') {
        config = configOrBufferSize;
    }
    else {
        config = {
            bufferSize: configOrBufferSize,
            windowTime: windowTime,
            refCount: false,
            scheduler: scheduler,
        };
    }
    return function (source) { return source.lift(shareReplayOperator(config)); };
}
function shareReplayOperator(_a) {
    var _b = _a.bufferSize, bufferSize = _b === void 0 ? Number.POSITIVE_INFINITY : _b, _c = _a.windowTime, windowTime = _c === void 0 ? Number.POSITIVE_INFINITY : _c, useRefCount = _a.refCount, scheduler = _a.scheduler;
    var subject;
    var refCount = 0;
    var subscription;
    var hasError = false;
    var isComplete = false;
    return function shareReplayOperation(source) {
        refCount++;
        var innerSub;
        if (!subject || hasError) {
            hasError = false;
            subject = new ReplaySubject/* ReplaySubject */.t(bufferSize, windowTime, scheduler);
            innerSub = subject.subscribe(this);
            subscription = source.subscribe({
                next: function (value) {
                    subject.next(value);
                },
                error: function (err) {
                    hasError = true;
                    subject.error(err);
                },
                complete: function () {
                    isComplete = true;
                    subscription = undefined;
                    subject.complete();
                },
            });
            if (isComplete) {
                subscription = undefined;
            }
        }
        else {
            innerSub = subject.subscribe(this);
        }
        this.add(function () {
            refCount--;
            innerSub.unsubscribe();
            innerSub = undefined;
            if (subscription && !isComplete && useRefCount && refCount === 0) {
                subscription.unsubscribe();
                subscription = undefined;
                subject = undefined;
            }
        });
    };
}
//# sourceMappingURL=shareReplay.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/single.js
/** PURE_IMPORTS_START tslib,_Subscriber,_util_EmptyError PURE_IMPORTS_END */



function single(predicate) {
    return function (source) { return source.lift(new SingleOperator(predicate, source)); };
}
var SingleOperator = /*@__PURE__*/ (function () {
    function SingleOperator(predicate, source) {
        this.predicate = predicate;
        this.source = source;
    }
    SingleOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new SingleSubscriber(subscriber, this.predicate, this.source));
    };
    return SingleOperator;
}());
var SingleSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SingleSubscriber, _super);
    function SingleSubscriber(destination, predicate, source) {
        var _this = _super.call(this, destination) || this;
        _this.predicate = predicate;
        _this.source = source;
        _this.seenValue = false;
        _this.index = 0;
        return _this;
    }
    SingleSubscriber.prototype.applySingleValue = function (value) {
        if (this.seenValue) {
            this.destination.error('Sequence contains more than one element');
        }
        else {
            this.seenValue = true;
            this.singleValue = value;
        }
    };
    SingleSubscriber.prototype._next = function (value) {
        var index = this.index++;
        if (this.predicate) {
            this.tryNext(value, index);
        }
        else {
            this.applySingleValue(value);
        }
    };
    SingleSubscriber.prototype.tryNext = function (value, index) {
        try {
            if (this.predicate(value, index, this.source)) {
                this.applySingleValue(value);
            }
        }
        catch (err) {
            this.destination.error(err);
        }
    };
    SingleSubscriber.prototype._complete = function () {
        var destination = this.destination;
        if (this.index > 0) {
            destination.next(this.seenValue ? this.singleValue : undefined);
            destination.complete();
        }
        else {
            destination.error(new EmptyError/* EmptyError */.K);
        }
    };
    return SingleSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=single.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/skip.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function skip(count) {
    return function (source) { return source.lift(new SkipOperator(count)); };
}
var SkipOperator = /*@__PURE__*/ (function () {
    function SkipOperator(total) {
        this.total = total;
    }
    SkipOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new SkipSubscriber(subscriber, this.total));
    };
    return SkipOperator;
}());
var SkipSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SkipSubscriber, _super);
    function SkipSubscriber(destination, total) {
        var _this = _super.call(this, destination) || this;
        _this.total = total;
        _this.count = 0;
        return _this;
    }
    SkipSubscriber.prototype._next = function (x) {
        if (++this.count > this.total) {
            this.destination.next(x);
        }
    };
    return SkipSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=skip.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/skipLast.js
/** PURE_IMPORTS_START tslib,_Subscriber,_util_ArgumentOutOfRangeError PURE_IMPORTS_END */



function skipLast(count) {
    return function (source) { return source.lift(new SkipLastOperator(count)); };
}
var SkipLastOperator = /*@__PURE__*/ (function () {
    function SkipLastOperator(_skipCount) {
        this._skipCount = _skipCount;
        if (this._skipCount < 0) {
            throw new ArgumentOutOfRangeError/* ArgumentOutOfRangeError */.W;
        }
    }
    SkipLastOperator.prototype.call = function (subscriber, source) {
        if (this._skipCount === 0) {
            return source.subscribe(new Subscriber/* Subscriber */.L(subscriber));
        }
        else {
            return source.subscribe(new SkipLastSubscriber(subscriber, this._skipCount));
        }
    };
    return SkipLastOperator;
}());
var SkipLastSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SkipLastSubscriber, _super);
    function SkipLastSubscriber(destination, _skipCount) {
        var _this = _super.call(this, destination) || this;
        _this._skipCount = _skipCount;
        _this._count = 0;
        _this._ring = new Array(_skipCount);
        return _this;
    }
    SkipLastSubscriber.prototype._next = function (value) {
        var skipCount = this._skipCount;
        var count = this._count++;
        if (count < skipCount) {
            this._ring[count] = value;
        }
        else {
            var currentIndex = count % skipCount;
            var ring = this._ring;
            var oldValue = ring[currentIndex];
            ring[currentIndex] = value;
            this.destination.next(oldValue);
        }
    };
    return SkipLastSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=skipLast.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/skipUntil.js
/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */


function skipUntil(notifier) {
    return function (source) { return source.lift(new SkipUntilOperator(notifier)); };
}
var SkipUntilOperator = /*@__PURE__*/ (function () {
    function SkipUntilOperator(notifier) {
        this.notifier = notifier;
    }
    SkipUntilOperator.prototype.call = function (destination, source) {
        return source.subscribe(new SkipUntilSubscriber(destination, this.notifier));
    };
    return SkipUntilOperator;
}());
var SkipUntilSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SkipUntilSubscriber, _super);
    function SkipUntilSubscriber(destination, notifier) {
        var _this = _super.call(this, destination) || this;
        _this.hasValue = false;
        var innerSubscriber = new innerSubscribe/* SimpleInnerSubscriber */.IY(_this);
        _this.add(innerSubscriber);
        _this.innerSubscription = innerSubscriber;
        var innerSubscription = (0,innerSubscribe/* innerSubscribe */.ft)(notifier, innerSubscriber);
        if (innerSubscription !== innerSubscriber) {
            _this.add(innerSubscription);
            _this.innerSubscription = innerSubscription;
        }
        return _this;
    }
    SkipUntilSubscriber.prototype._next = function (value) {
        if (this.hasValue) {
            _super.prototype._next.call(this, value);
        }
    };
    SkipUntilSubscriber.prototype.notifyNext = function () {
        this.hasValue = true;
        if (this.innerSubscription) {
            this.innerSubscription.unsubscribe();
        }
    };
    SkipUntilSubscriber.prototype.notifyComplete = function () {
    };
    return SkipUntilSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=skipUntil.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/skipWhile.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function skipWhile(predicate) {
    return function (source) { return source.lift(new SkipWhileOperator(predicate)); };
}
var SkipWhileOperator = /*@__PURE__*/ (function () {
    function SkipWhileOperator(predicate) {
        this.predicate = predicate;
    }
    SkipWhileOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new SkipWhileSubscriber(subscriber, this.predicate));
    };
    return SkipWhileOperator;
}());
var SkipWhileSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SkipWhileSubscriber, _super);
    function SkipWhileSubscriber(destination, predicate) {
        var _this = _super.call(this, destination) || this;
        _this.predicate = predicate;
        _this.skipping = true;
        _this.index = 0;
        return _this;
    }
    SkipWhileSubscriber.prototype._next = function (value) {
        var destination = this.destination;
        if (this.skipping) {
            this.tryCallPredicate(value);
        }
        if (!this.skipping) {
            destination.next(value);
        }
    };
    SkipWhileSubscriber.prototype.tryCallPredicate = function (value) {
        try {
            var result = this.predicate(value, this.index++);
            this.skipping = Boolean(result);
        }
        catch (err) {
            this.destination.error(err);
        }
    };
    return SkipWhileSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=skipWhile.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/startWith.js
/** PURE_IMPORTS_START _observable_concat,_util_isScheduler PURE_IMPORTS_END */


function startWith() {
    var array = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        array[_i] = arguments[_i];
    }
    var scheduler = array[array.length - 1];
    if ((0,isScheduler/* isScheduler */.K)(scheduler)) {
        array.pop();
        return function (source) { return (0,concat/* concat */.z)(array, source, scheduler); };
    }
    else {
        return function (source) { return (0,concat/* concat */.z)(array, source); };
    }
}
//# sourceMappingURL=startWith.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/scheduler/asap.js + 3 modules
var asap = __webpack_require__(6650);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isNumeric.js
var isNumeric = __webpack_require__(5812);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/observable/SubscribeOnObservable.js
/** PURE_IMPORTS_START tslib,_Observable,_scheduler_asap,_util_isNumeric PURE_IMPORTS_END */




var SubscribeOnObservable = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SubscribeOnObservable, _super);
    function SubscribeOnObservable(source, delayTime, scheduler) {
        if (delayTime === void 0) {
            delayTime = 0;
        }
        if (scheduler === void 0) {
            scheduler = asap/* asap */.e;
        }
        var _this = _super.call(this) || this;
        _this.source = source;
        _this.delayTime = delayTime;
        _this.scheduler = scheduler;
        if (!(0,isNumeric/* isNumeric */.k)(delayTime) || delayTime < 0) {
            _this.delayTime = 0;
        }
        if (!scheduler || typeof scheduler.schedule !== 'function') {
            _this.scheduler = asap/* asap */.e;
        }
        return _this;
    }
    SubscribeOnObservable.create = function (source, delay, scheduler) {
        if (delay === void 0) {
            delay = 0;
        }
        if (scheduler === void 0) {
            scheduler = asap/* asap */.e;
        }
        return new SubscribeOnObservable(source, delay, scheduler);
    };
    SubscribeOnObservable.dispatch = function (arg) {
        var source = arg.source, subscriber = arg.subscriber;
        return this.add(source.subscribe(subscriber));
    };
    SubscribeOnObservable.prototype._subscribe = function (subscriber) {
        var delay = this.delayTime;
        var source = this.source;
        var scheduler = this.scheduler;
        return scheduler.schedule(SubscribeOnObservable.dispatch, delay, {
            source: source, subscriber: subscriber
        });
    };
    return SubscribeOnObservable;
}(Observable/* Observable */.y));

//# sourceMappingURL=SubscribeOnObservable.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/subscribeOn.js
/** PURE_IMPORTS_START _observable_SubscribeOnObservable PURE_IMPORTS_END */

function subscribeOn(scheduler, delay) {
    if (delay === void 0) {
        delay = 0;
    }
    return function subscribeOnOperatorFunction(source) {
        return source.lift(new SubscribeOnOperator(scheduler, delay));
    };
}
var SubscribeOnOperator = /*@__PURE__*/ (function () {
    function SubscribeOnOperator(scheduler, delay) {
        this.scheduler = scheduler;
        this.delay = delay;
    }
    SubscribeOnOperator.prototype.call = function (subscriber, source) {
        return new SubscribeOnObservable(source, this.delay, this.scheduler).subscribe(subscriber);
    };
    return SubscribeOnOperator;
}());
//# sourceMappingURL=subscribeOn.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/switchMap.js
/** PURE_IMPORTS_START tslib,_map,_observable_from,_innerSubscribe PURE_IMPORTS_END */




function switchMap(project, resultSelector) {
    if (typeof resultSelector === 'function') {
        return function (source) { return source.pipe(switchMap(function (a, i) { return (0,observable_from/* from */.D)(project(a, i)).pipe((0,map/* map */.U)(function (b, ii) { return resultSelector(a, b, i, ii); })); })); };
    }
    return function (source) { return source.lift(new SwitchMapOperator(project)); };
}
var SwitchMapOperator = /*@__PURE__*/ (function () {
    function SwitchMapOperator(project) {
        this.project = project;
    }
    SwitchMapOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new SwitchMapSubscriber(subscriber, this.project));
    };
    return SwitchMapOperator;
}());
var SwitchMapSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(SwitchMapSubscriber, _super);
    function SwitchMapSubscriber(destination, project) {
        var _this = _super.call(this, destination) || this;
        _this.project = project;
        _this.index = 0;
        return _this;
    }
    SwitchMapSubscriber.prototype._next = function (value) {
        var result;
        var index = this.index++;
        try {
            result = this.project(value, index);
        }
        catch (error) {
            this.destination.error(error);
            return;
        }
        this._innerSub(result);
    };
    SwitchMapSubscriber.prototype._innerSub = function (result) {
        var innerSubscription = this.innerSubscription;
        if (innerSubscription) {
            innerSubscription.unsubscribe();
        }
        var innerSubscriber = new innerSubscribe/* SimpleInnerSubscriber */.IY(this);
        var destination = this.destination;
        destination.add(innerSubscriber);
        this.innerSubscription = (0,innerSubscribe/* innerSubscribe */.ft)(result, innerSubscriber);
        if (this.innerSubscription !== innerSubscriber) {
            destination.add(this.innerSubscription);
        }
    };
    SwitchMapSubscriber.prototype._complete = function () {
        var innerSubscription = this.innerSubscription;
        if (!innerSubscription || innerSubscription.closed) {
            _super.prototype._complete.call(this);
        }
        this.unsubscribe();
    };
    SwitchMapSubscriber.prototype._unsubscribe = function () {
        this.innerSubscription = undefined;
    };
    SwitchMapSubscriber.prototype.notifyComplete = function () {
        this.innerSubscription = undefined;
        if (this.isStopped) {
            _super.prototype._complete.call(this);
        }
    };
    SwitchMapSubscriber.prototype.notifyNext = function (innerValue) {
        this.destination.next(innerValue);
    };
    return SwitchMapSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=switchMap.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/switchAll.js
/** PURE_IMPORTS_START _switchMap,_util_identity PURE_IMPORTS_END */


function switchAll() {
    return switchMap(identity/* identity */.y);
}
//# sourceMappingURL=switchAll.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/switchMapTo.js
/** PURE_IMPORTS_START _switchMap PURE_IMPORTS_END */

function switchMapTo(innerObservable, resultSelector) {
    return resultSelector ? switchMap(function () { return innerObservable; }, resultSelector) : switchMap(function () { return innerObservable; });
}
//# sourceMappingURL=switchMapTo.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/takeUntil.js
/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */


function takeUntil(notifier) {
    return function (source) { return source.lift(new TakeUntilOperator(notifier)); };
}
var TakeUntilOperator = /*@__PURE__*/ (function () {
    function TakeUntilOperator(notifier) {
        this.notifier = notifier;
    }
    TakeUntilOperator.prototype.call = function (subscriber, source) {
        var takeUntilSubscriber = new TakeUntilSubscriber(subscriber);
        var notifierSubscription = (0,innerSubscribe/* innerSubscribe */.ft)(this.notifier, new innerSubscribe/* SimpleInnerSubscriber */.IY(takeUntilSubscriber));
        if (notifierSubscription && !takeUntilSubscriber.seenValue) {
            takeUntilSubscriber.add(notifierSubscription);
            return source.subscribe(takeUntilSubscriber);
        }
        return takeUntilSubscriber;
    };
    return TakeUntilOperator;
}());
var TakeUntilSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(TakeUntilSubscriber, _super);
    function TakeUntilSubscriber(destination) {
        var _this = _super.call(this, destination) || this;
        _this.seenValue = false;
        return _this;
    }
    TakeUntilSubscriber.prototype.notifyNext = function () {
        this.seenValue = true;
        this.complete();
    };
    TakeUntilSubscriber.prototype.notifyComplete = function () {
    };
    return TakeUntilSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=takeUntil.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/takeWhile.js
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function takeWhile(predicate, inclusive) {
    if (inclusive === void 0) {
        inclusive = false;
    }
    return function (source) {
        return source.lift(new TakeWhileOperator(predicate, inclusive));
    };
}
var TakeWhileOperator = /*@__PURE__*/ (function () {
    function TakeWhileOperator(predicate, inclusive) {
        this.predicate = predicate;
        this.inclusive = inclusive;
    }
    TakeWhileOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new TakeWhileSubscriber(subscriber, this.predicate, this.inclusive));
    };
    return TakeWhileOperator;
}());
var TakeWhileSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(TakeWhileSubscriber, _super);
    function TakeWhileSubscriber(destination, predicate, inclusive) {
        var _this = _super.call(this, destination) || this;
        _this.predicate = predicate;
        _this.inclusive = inclusive;
        _this.index = 0;
        return _this;
    }
    TakeWhileSubscriber.prototype._next = function (value) {
        var destination = this.destination;
        var result;
        try {
            result = this.predicate(value, this.index++);
        }
        catch (err) {
            destination.error(err);
            return;
        }
        this.nextOrComplete(value, result);
    };
    TakeWhileSubscriber.prototype.nextOrComplete = function (value, predicateResult) {
        var destination = this.destination;
        if (Boolean(predicateResult)) {
            destination.next(value);
        }
        else {
            if (this.inclusive) {
                destination.next(value);
            }
            destination.complete();
        }
    };
    return TakeWhileSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=takeWhile.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/noop.js
var noop = __webpack_require__(3306);
// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/isFunction.js
var isFunction = __webpack_require__(4156);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/tap.js
/** PURE_IMPORTS_START tslib,_Subscriber,_util_noop,_util_isFunction PURE_IMPORTS_END */




function tap(nextOrObserver, error, complete) {
    return function tapOperatorFunction(source) {
        return source.lift(new DoOperator(nextOrObserver, error, complete));
    };
}
var DoOperator = /*@__PURE__*/ (function () {
    function DoOperator(nextOrObserver, error, complete) {
        this.nextOrObserver = nextOrObserver;
        this.error = error;
        this.complete = complete;
    }
    DoOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new TapSubscriber(subscriber, this.nextOrObserver, this.error, this.complete));
    };
    return DoOperator;
}());
var TapSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(TapSubscriber, _super);
    function TapSubscriber(destination, observerOrNext, error, complete) {
        var _this = _super.call(this, destination) || this;
        _this._tapNext = noop/* noop */.Z;
        _this._tapError = noop/* noop */.Z;
        _this._tapComplete = noop/* noop */.Z;
        _this._tapError = error || noop/* noop */.Z;
        _this._tapComplete = complete || noop/* noop */.Z;
        if ((0,isFunction/* isFunction */.m)(observerOrNext)) {
            _this._context = _this;
            _this._tapNext = observerOrNext;
        }
        else if (observerOrNext) {
            _this._context = observerOrNext;
            _this._tapNext = observerOrNext.next || noop/* noop */.Z;
            _this._tapError = observerOrNext.error || noop/* noop */.Z;
            _this._tapComplete = observerOrNext.complete || noop/* noop */.Z;
        }
        return _this;
    }
    TapSubscriber.prototype._next = function (value) {
        try {
            this._tapNext.call(this._context, value);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        this.destination.next(value);
    };
    TapSubscriber.prototype._error = function (err) {
        try {
            this._tapError.call(this._context, err);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        this.destination.error(err);
    };
    TapSubscriber.prototype._complete = function () {
        try {
            this._tapComplete.call(this._context);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        return this.destination.complete();
    };
    return TapSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=tap.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/throttle.js
/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */


var defaultThrottleConfig = {
    leading: true,
    trailing: false
};
function throttle(durationSelector, config) {
    if (config === void 0) {
        config = defaultThrottleConfig;
    }
    return function (source) { return source.lift(new ThrottleOperator(durationSelector, !!config.leading, !!config.trailing)); };
}
var ThrottleOperator = /*@__PURE__*/ (function () {
    function ThrottleOperator(durationSelector, leading, trailing) {
        this.durationSelector = durationSelector;
        this.leading = leading;
        this.trailing = trailing;
    }
    ThrottleOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new ThrottleSubscriber(subscriber, this.durationSelector, this.leading, this.trailing));
    };
    return ThrottleOperator;
}());
var ThrottleSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(ThrottleSubscriber, _super);
    function ThrottleSubscriber(destination, durationSelector, _leading, _trailing) {
        var _this = _super.call(this, destination) || this;
        _this.destination = destination;
        _this.durationSelector = durationSelector;
        _this._leading = _leading;
        _this._trailing = _trailing;
        _this._hasValue = false;
        return _this;
    }
    ThrottleSubscriber.prototype._next = function (value) {
        this._hasValue = true;
        this._sendValue = value;
        if (!this._throttled) {
            if (this._leading) {
                this.send();
            }
            else {
                this.throttle(value);
            }
        }
    };
    ThrottleSubscriber.prototype.send = function () {
        var _a = this, _hasValue = _a._hasValue, _sendValue = _a._sendValue;
        if (_hasValue) {
            this.destination.next(_sendValue);
            this.throttle(_sendValue);
        }
        this._hasValue = false;
        this._sendValue = undefined;
    };
    ThrottleSubscriber.prototype.throttle = function (value) {
        var duration = this.tryDurationSelector(value);
        if (!!duration) {
            this.add(this._throttled = (0,innerSubscribe/* innerSubscribe */.ft)(duration, new innerSubscribe/* SimpleInnerSubscriber */.IY(this)));
        }
    };
    ThrottleSubscriber.prototype.tryDurationSelector = function (value) {
        try {
            return this.durationSelector(value);
        }
        catch (err) {
            this.destination.error(err);
            return null;
        }
    };
    ThrottleSubscriber.prototype.throttlingDone = function () {
        var _a = this, _throttled = _a._throttled, _trailing = _a._trailing;
        if (_throttled) {
            _throttled.unsubscribe();
        }
        this._throttled = undefined;
        if (_trailing) {
            this.send();
        }
    };
    ThrottleSubscriber.prototype.notifyNext = function () {
        this.throttlingDone();
    };
    ThrottleSubscriber.prototype.notifyComplete = function () {
        this.throttlingDone();
    };
    return ThrottleSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=throttle.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/throttleTime.js
/** PURE_IMPORTS_START tslib,_Subscriber,_scheduler_async,_throttle PURE_IMPORTS_END */




function throttleTime(duration, scheduler, config) {
    if (scheduler === void 0) {
        scheduler = scheduler_async/* async */.P;
    }
    if (config === void 0) {
        config = defaultThrottleConfig;
    }
    return function (source) { return source.lift(new ThrottleTimeOperator(duration, scheduler, config.leading, config.trailing)); };
}
var ThrottleTimeOperator = /*@__PURE__*/ (function () {
    function ThrottleTimeOperator(duration, scheduler, leading, trailing) {
        this.duration = duration;
        this.scheduler = scheduler;
        this.leading = leading;
        this.trailing = trailing;
    }
    ThrottleTimeOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new ThrottleTimeSubscriber(subscriber, this.duration, this.scheduler, this.leading, this.trailing));
    };
    return ThrottleTimeOperator;
}());
var ThrottleTimeSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(ThrottleTimeSubscriber, _super);
    function ThrottleTimeSubscriber(destination, duration, scheduler, leading, trailing) {
        var _this = _super.call(this, destination) || this;
        _this.duration = duration;
        _this.scheduler = scheduler;
        _this.leading = leading;
        _this.trailing = trailing;
        _this._hasTrailingValue = false;
        _this._trailingValue = null;
        return _this;
    }
    ThrottleTimeSubscriber.prototype._next = function (value) {
        if (this.throttled) {
            if (this.trailing) {
                this._trailingValue = value;
                this._hasTrailingValue = true;
            }
        }
        else {
            this.add(this.throttled = this.scheduler.schedule(throttleTime_dispatchNext, this.duration, { subscriber: this }));
            if (this.leading) {
                this.destination.next(value);
            }
            else if (this.trailing) {
                this._trailingValue = value;
                this._hasTrailingValue = true;
            }
        }
    };
    ThrottleTimeSubscriber.prototype._complete = function () {
        if (this._hasTrailingValue) {
            this.destination.next(this._trailingValue);
            this.destination.complete();
        }
        else {
            this.destination.complete();
        }
    };
    ThrottleTimeSubscriber.prototype.clearThrottle = function () {
        var throttled = this.throttled;
        if (throttled) {
            if (this.trailing && this._hasTrailingValue) {
                this.destination.next(this._trailingValue);
                this._trailingValue = null;
                this._hasTrailingValue = false;
            }
            throttled.unsubscribe();
            this.remove(throttled);
            this.throttled = null;
        }
    };
    return ThrottleTimeSubscriber;
}(Subscriber/* Subscriber */.L));
function throttleTime_dispatchNext(arg) {
    var subscriber = arg.subscriber;
    subscriber.clearThrottle();
}
//# sourceMappingURL=throttleTime.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/defer.js
var defer = __webpack_require__(1410);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/timeInterval.js
/** PURE_IMPORTS_START _scheduler_async,_scan,_observable_defer,_map PURE_IMPORTS_END */




function timeInterval(scheduler) {
    if (scheduler === void 0) {
        scheduler = scheduler_async/* async */.P;
    }
    return function (source) {
        return (0,defer/* defer */.P)(function () {
            return source.pipe(scan(function (_a, value) {
                var current = _a.current;
                return ({ value: value, current: scheduler.now(), last: current });
            }, { current: scheduler.now(), value: undefined, last: undefined }), (0,map/* map */.U)(function (_a) {
                var current = _a.current, last = _a.last, value = _a.value;
                return new TimeInterval(value, current - last);
            }));
        });
    };
}
var TimeInterval = /*@__PURE__*/ (function () {
    function TimeInterval(value, interval) {
        this.value = value;
        this.interval = interval;
    }
    return TimeInterval;
}());

//# sourceMappingURL=timeInterval.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/util/TimeoutError.js
var TimeoutError = __webpack_require__(1462);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/timeoutWith.js
/** PURE_IMPORTS_START tslib,_scheduler_async,_util_isDate,_innerSubscribe PURE_IMPORTS_END */




function timeoutWith(due, withObservable, scheduler) {
    if (scheduler === void 0) {
        scheduler = scheduler_async/* async */.P;
    }
    return function (source) {
        var absoluteTimeout = isDate(due);
        var waitFor = absoluteTimeout ? (+due - scheduler.now()) : Math.abs(due);
        return source.lift(new TimeoutWithOperator(waitFor, absoluteTimeout, withObservable, scheduler));
    };
}
var TimeoutWithOperator = /*@__PURE__*/ (function () {
    function TimeoutWithOperator(waitFor, absoluteTimeout, withObservable, scheduler) {
        this.waitFor = waitFor;
        this.absoluteTimeout = absoluteTimeout;
        this.withObservable = withObservable;
        this.scheduler = scheduler;
    }
    TimeoutWithOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new TimeoutWithSubscriber(subscriber, this.absoluteTimeout, this.waitFor, this.withObservable, this.scheduler));
    };
    return TimeoutWithOperator;
}());
var TimeoutWithSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(TimeoutWithSubscriber, _super);
    function TimeoutWithSubscriber(destination, absoluteTimeout, waitFor, withObservable, scheduler) {
        var _this = _super.call(this, destination) || this;
        _this.absoluteTimeout = absoluteTimeout;
        _this.waitFor = waitFor;
        _this.withObservable = withObservable;
        _this.scheduler = scheduler;
        _this.scheduleTimeout();
        return _this;
    }
    TimeoutWithSubscriber.dispatchTimeout = function (subscriber) {
        var withObservable = subscriber.withObservable;
        subscriber._unsubscribeAndRecycle();
        subscriber.add((0,innerSubscribe/* innerSubscribe */.ft)(withObservable, new innerSubscribe/* SimpleInnerSubscriber */.IY(subscriber)));
    };
    TimeoutWithSubscriber.prototype.scheduleTimeout = function () {
        var action = this.action;
        if (action) {
            this.action = action.schedule(this, this.waitFor);
        }
        else {
            this.add(this.action = this.scheduler.schedule(TimeoutWithSubscriber.dispatchTimeout, this.waitFor, this));
        }
    };
    TimeoutWithSubscriber.prototype._next = function (value) {
        if (!this.absoluteTimeout) {
            this.scheduleTimeout();
        }
        _super.prototype._next.call(this, value);
    };
    TimeoutWithSubscriber.prototype._unsubscribe = function () {
        this.action = undefined;
        this.scheduler = null;
        this.withObservable = null;
    };
    return TimeoutWithSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=timeoutWith.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/throwError.js
var throwError = __webpack_require__(4944);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/timeout.js
/** PURE_IMPORTS_START _scheduler_async,_util_TimeoutError,_timeoutWith,_observable_throwError PURE_IMPORTS_END */




function timeout(due, scheduler) {
    if (scheduler === void 0) {
        scheduler = scheduler_async/* async */.P;
    }
    return timeoutWith(due, (0,throwError/* throwError */._)(new TimeoutError/* TimeoutError */.W()), scheduler);
}
//# sourceMappingURL=timeout.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/timestamp.js
/** PURE_IMPORTS_START _scheduler_async,_map PURE_IMPORTS_END */


function timestamp(scheduler) {
    if (scheduler === void 0) {
        scheduler = scheduler_async/* async */.P;
    }
    return (0,map/* map */.U)(function (value) { return new Timestamp(value, scheduler.now()); });
}
var Timestamp = /*@__PURE__*/ (function () {
    function Timestamp(value, timestamp) {
        this.value = value;
        this.timestamp = timestamp;
    }
    return Timestamp;
}());

//# sourceMappingURL=timestamp.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/toArray.js
/** PURE_IMPORTS_START _reduce PURE_IMPORTS_END */

function toArrayReducer(arr, item, index) {
    if (index === 0) {
        return [item];
    }
    arr.push(item);
    return arr;
}
function toArray() {
    return reduce(toArrayReducer, []);
}
//# sourceMappingURL=toArray.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/window.js
/** PURE_IMPORTS_START tslib,_Subject,_innerSubscribe PURE_IMPORTS_END */



function window_window(windowBoundaries) {
    return function windowOperatorFunction(source) {
        return source.lift(new WindowOperator(windowBoundaries));
    };
}
var WindowOperator = /*@__PURE__*/ (function () {
    function WindowOperator(windowBoundaries) {
        this.windowBoundaries = windowBoundaries;
    }
    WindowOperator.prototype.call = function (subscriber, source) {
        var windowSubscriber = new WindowSubscriber(subscriber);
        var sourceSubscription = source.subscribe(windowSubscriber);
        if (!sourceSubscription.closed) {
            windowSubscriber.add((0,innerSubscribe/* innerSubscribe */.ft)(this.windowBoundaries, new innerSubscribe/* SimpleInnerSubscriber */.IY(windowSubscriber)));
        }
        return sourceSubscription;
    };
    return WindowOperator;
}());
var WindowSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(WindowSubscriber, _super);
    function WindowSubscriber(destination) {
        var _this = _super.call(this, destination) || this;
        _this.window = new Subject/* Subject */.xQ();
        destination.next(_this.window);
        return _this;
    }
    WindowSubscriber.prototype.notifyNext = function () {
        this.openWindow();
    };
    WindowSubscriber.prototype.notifyError = function (error) {
        this._error(error);
    };
    WindowSubscriber.prototype.notifyComplete = function () {
        this._complete();
    };
    WindowSubscriber.prototype._next = function (value) {
        this.window.next(value);
    };
    WindowSubscriber.prototype._error = function (err) {
        this.window.error(err);
        this.destination.error(err);
    };
    WindowSubscriber.prototype._complete = function () {
        this.window.complete();
        this.destination.complete();
    };
    WindowSubscriber.prototype._unsubscribe = function () {
        this.window = null;
    };
    WindowSubscriber.prototype.openWindow = function () {
        var prevWindow = this.window;
        if (prevWindow) {
            prevWindow.complete();
        }
        var destination = this.destination;
        var newWindow = this.window = new Subject/* Subject */.xQ();
        destination.next(newWindow);
    };
    return WindowSubscriber;
}(innerSubscribe/* SimpleOuterSubscriber */.Ds));
//# sourceMappingURL=window.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/windowCount.js
/** PURE_IMPORTS_START tslib,_Subscriber,_Subject PURE_IMPORTS_END */



function windowCount(windowSize, startWindowEvery) {
    if (startWindowEvery === void 0) {
        startWindowEvery = 0;
    }
    return function windowCountOperatorFunction(source) {
        return source.lift(new WindowCountOperator(windowSize, startWindowEvery));
    };
}
var WindowCountOperator = /*@__PURE__*/ (function () {
    function WindowCountOperator(windowSize, startWindowEvery) {
        this.windowSize = windowSize;
        this.startWindowEvery = startWindowEvery;
    }
    WindowCountOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new WindowCountSubscriber(subscriber, this.windowSize, this.startWindowEvery));
    };
    return WindowCountOperator;
}());
var WindowCountSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(WindowCountSubscriber, _super);
    function WindowCountSubscriber(destination, windowSize, startWindowEvery) {
        var _this = _super.call(this, destination) || this;
        _this.destination = destination;
        _this.windowSize = windowSize;
        _this.startWindowEvery = startWindowEvery;
        _this.windows = [new Subject/* Subject */.xQ()];
        _this.count = 0;
        destination.next(_this.windows[0]);
        return _this;
    }
    WindowCountSubscriber.prototype._next = function (value) {
        var startWindowEvery = (this.startWindowEvery > 0) ? this.startWindowEvery : this.windowSize;
        var destination = this.destination;
        var windowSize = this.windowSize;
        var windows = this.windows;
        var len = windows.length;
        for (var i = 0; i < len && !this.closed; i++) {
            windows[i].next(value);
        }
        var c = this.count - windowSize + 1;
        if (c >= 0 && c % startWindowEvery === 0 && !this.closed) {
            windows.shift().complete();
        }
        if (++this.count % startWindowEvery === 0 && !this.closed) {
            var window_1 = new Subject/* Subject */.xQ();
            windows.push(window_1);
            destination.next(window_1);
        }
    };
    WindowCountSubscriber.prototype._error = function (err) {
        var windows = this.windows;
        if (windows) {
            while (windows.length > 0 && !this.closed) {
                windows.shift().error(err);
            }
        }
        this.destination.error(err);
    };
    WindowCountSubscriber.prototype._complete = function () {
        var windows = this.windows;
        if (windows) {
            while (windows.length > 0 && !this.closed) {
                windows.shift().complete();
            }
        }
        this.destination.complete();
    };
    WindowCountSubscriber.prototype._unsubscribe = function () {
        this.count = 0;
        this.windows = null;
    };
    return WindowCountSubscriber;
}(Subscriber/* Subscriber */.L));
//# sourceMappingURL=windowCount.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/windowTime.js
/** PURE_IMPORTS_START tslib,_Subject,_scheduler_async,_Subscriber,_util_isNumeric,_util_isScheduler PURE_IMPORTS_END */






function windowTime(windowTimeSpan) {
    var scheduler = scheduler_async/* async */.P;
    var windowCreationInterval = null;
    var maxWindowSize = Number.POSITIVE_INFINITY;
    if ((0,isScheduler/* isScheduler */.K)(arguments[3])) {
        scheduler = arguments[3];
    }
    if ((0,isScheduler/* isScheduler */.K)(arguments[2])) {
        scheduler = arguments[2];
    }
    else if ((0,isNumeric/* isNumeric */.k)(arguments[2])) {
        maxWindowSize = Number(arguments[2]);
    }
    if ((0,isScheduler/* isScheduler */.K)(arguments[1])) {
        scheduler = arguments[1];
    }
    else if ((0,isNumeric/* isNumeric */.k)(arguments[1])) {
        windowCreationInterval = Number(arguments[1]);
    }
    return function windowTimeOperatorFunction(source) {
        return source.lift(new WindowTimeOperator(windowTimeSpan, windowCreationInterval, maxWindowSize, scheduler));
    };
}
var WindowTimeOperator = /*@__PURE__*/ (function () {
    function WindowTimeOperator(windowTimeSpan, windowCreationInterval, maxWindowSize, scheduler) {
        this.windowTimeSpan = windowTimeSpan;
        this.windowCreationInterval = windowCreationInterval;
        this.maxWindowSize = maxWindowSize;
        this.scheduler = scheduler;
    }
    WindowTimeOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new WindowTimeSubscriber(subscriber, this.windowTimeSpan, this.windowCreationInterval, this.maxWindowSize, this.scheduler));
    };
    return WindowTimeOperator;
}());
var CountedSubject = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(CountedSubject, _super);
    function CountedSubject() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._numberOfNextedValues = 0;
        return _this;
    }
    CountedSubject.prototype.next = function (value) {
        this._numberOfNextedValues++;
        _super.prototype.next.call(this, value);
    };
    Object.defineProperty(CountedSubject.prototype, "numberOfNextedValues", {
        get: function () {
            return this._numberOfNextedValues;
        },
        enumerable: true,
        configurable: true
    });
    return CountedSubject;
}(Subject/* Subject */.xQ));
var WindowTimeSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(WindowTimeSubscriber, _super);
    function WindowTimeSubscriber(destination, windowTimeSpan, windowCreationInterval, maxWindowSize, scheduler) {
        var _this = _super.call(this, destination) || this;
        _this.destination = destination;
        _this.windowTimeSpan = windowTimeSpan;
        _this.windowCreationInterval = windowCreationInterval;
        _this.maxWindowSize = maxWindowSize;
        _this.scheduler = scheduler;
        _this.windows = [];
        var window = _this.openWindow();
        if (windowCreationInterval !== null && windowCreationInterval >= 0) {
            var closeState = { subscriber: _this, window: window, context: null };
            var creationState = { windowTimeSpan: windowTimeSpan, windowCreationInterval: windowCreationInterval, subscriber: _this, scheduler: scheduler };
            _this.add(scheduler.schedule(dispatchWindowClose, windowTimeSpan, closeState));
            _this.add(scheduler.schedule(dispatchWindowCreation, windowCreationInterval, creationState));
        }
        else {
            var timeSpanOnlyState = { subscriber: _this, window: window, windowTimeSpan: windowTimeSpan };
            _this.add(scheduler.schedule(dispatchWindowTimeSpanOnly, windowTimeSpan, timeSpanOnlyState));
        }
        return _this;
    }
    WindowTimeSubscriber.prototype._next = function (value) {
        var windows = this.windows;
        var len = windows.length;
        for (var i = 0; i < len; i++) {
            var window_1 = windows[i];
            if (!window_1.closed) {
                window_1.next(value);
                if (window_1.numberOfNextedValues >= this.maxWindowSize) {
                    this.closeWindow(window_1);
                }
            }
        }
    };
    WindowTimeSubscriber.prototype._error = function (err) {
        var windows = this.windows;
        while (windows.length > 0) {
            windows.shift().error(err);
        }
        this.destination.error(err);
    };
    WindowTimeSubscriber.prototype._complete = function () {
        var windows = this.windows;
        while (windows.length > 0) {
            var window_2 = windows.shift();
            if (!window_2.closed) {
                window_2.complete();
            }
        }
        this.destination.complete();
    };
    WindowTimeSubscriber.prototype.openWindow = function () {
        var window = new CountedSubject();
        this.windows.push(window);
        var destination = this.destination;
        destination.next(window);
        return window;
    };
    WindowTimeSubscriber.prototype.closeWindow = function (window) {
        window.complete();
        var windows = this.windows;
        windows.splice(windows.indexOf(window), 1);
    };
    return WindowTimeSubscriber;
}(Subscriber/* Subscriber */.L));
function dispatchWindowTimeSpanOnly(state) {
    var subscriber = state.subscriber, windowTimeSpan = state.windowTimeSpan, window = state.window;
    if (window) {
        subscriber.closeWindow(window);
    }
    state.window = subscriber.openWindow();
    this.schedule(state, windowTimeSpan);
}
function dispatchWindowCreation(state) {
    var windowTimeSpan = state.windowTimeSpan, subscriber = state.subscriber, scheduler = state.scheduler, windowCreationInterval = state.windowCreationInterval;
    var window = subscriber.openWindow();
    var action = this;
    var context = { action: action, subscription: null };
    var timeSpanState = { subscriber: subscriber, window: window, context: context };
    context.subscription = scheduler.schedule(dispatchWindowClose, windowTimeSpan, timeSpanState);
    action.add(context.subscription);
    action.schedule(state, windowCreationInterval);
}
function dispatchWindowClose(state) {
    var subscriber = state.subscriber, window = state.window, context = state.context;
    if (context && context.action && context.subscription) {
        context.action.remove(context.subscription);
    }
    subscriber.closeWindow(window);
}
//# sourceMappingURL=windowTime.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/windowToggle.js
/** PURE_IMPORTS_START tslib,_Subject,_Subscription,_OuterSubscriber,_util_subscribeToResult PURE_IMPORTS_END */





function windowToggle(openings, closingSelector) {
    return function (source) { return source.lift(new WindowToggleOperator(openings, closingSelector)); };
}
var WindowToggleOperator = /*@__PURE__*/ (function () {
    function WindowToggleOperator(openings, closingSelector) {
        this.openings = openings;
        this.closingSelector = closingSelector;
    }
    WindowToggleOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new WindowToggleSubscriber(subscriber, this.openings, this.closingSelector));
    };
    return WindowToggleOperator;
}());
var WindowToggleSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(WindowToggleSubscriber, _super);
    function WindowToggleSubscriber(destination, openings, closingSelector) {
        var _this = _super.call(this, destination) || this;
        _this.openings = openings;
        _this.closingSelector = closingSelector;
        _this.contexts = [];
        _this.add(_this.openSubscription = (0,subscribeToResult/* subscribeToResult */.D)(_this, openings, openings));
        return _this;
    }
    WindowToggleSubscriber.prototype._next = function (value) {
        var contexts = this.contexts;
        if (contexts) {
            var len = contexts.length;
            for (var i = 0; i < len; i++) {
                contexts[i].window.next(value);
            }
        }
    };
    WindowToggleSubscriber.prototype._error = function (err) {
        var contexts = this.contexts;
        this.contexts = null;
        if (contexts) {
            var len = contexts.length;
            var index = -1;
            while (++index < len) {
                var context_1 = contexts[index];
                context_1.window.error(err);
                context_1.subscription.unsubscribe();
            }
        }
        _super.prototype._error.call(this, err);
    };
    WindowToggleSubscriber.prototype._complete = function () {
        var contexts = this.contexts;
        this.contexts = null;
        if (contexts) {
            var len = contexts.length;
            var index = -1;
            while (++index < len) {
                var context_2 = contexts[index];
                context_2.window.complete();
                context_2.subscription.unsubscribe();
            }
        }
        _super.prototype._complete.call(this);
    };
    WindowToggleSubscriber.prototype._unsubscribe = function () {
        var contexts = this.contexts;
        this.contexts = null;
        if (contexts) {
            var len = contexts.length;
            var index = -1;
            while (++index < len) {
                var context_3 = contexts[index];
                context_3.window.unsubscribe();
                context_3.subscription.unsubscribe();
            }
        }
    };
    WindowToggleSubscriber.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {
        if (outerValue === this.openings) {
            var closingNotifier = void 0;
            try {
                var closingSelector = this.closingSelector;
                closingNotifier = closingSelector(innerValue);
            }
            catch (e) {
                return this.error(e);
            }
            var window_1 = new Subject/* Subject */.xQ();
            var subscription = new Subscription/* Subscription */.w();
            var context_4 = { window: window_1, subscription: subscription };
            this.contexts.push(context_4);
            var innerSubscription = (0,subscribeToResult/* subscribeToResult */.D)(this, closingNotifier, context_4);
            if (innerSubscription.closed) {
                this.closeWindow(this.contexts.length - 1);
            }
            else {
                innerSubscription.context = context_4;
                subscription.add(innerSubscription);
            }
            this.destination.next(window_1);
        }
        else {
            this.closeWindow(this.contexts.indexOf(outerValue));
        }
    };
    WindowToggleSubscriber.prototype.notifyError = function (err) {
        this.error(err);
    };
    WindowToggleSubscriber.prototype.notifyComplete = function (inner) {
        if (inner !== this.openSubscription) {
            this.closeWindow(this.contexts.indexOf(inner.context));
        }
    };
    WindowToggleSubscriber.prototype.closeWindow = function (index) {
        if (index === -1) {
            return;
        }
        var contexts = this.contexts;
        var context = contexts[index];
        var window = context.window, subscription = context.subscription;
        contexts.splice(index, 1);
        window.complete();
        subscription.unsubscribe();
    };
    return WindowToggleSubscriber;
}(OuterSubscriber/* OuterSubscriber */.L));
//# sourceMappingURL=windowToggle.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/windowWhen.js
/** PURE_IMPORTS_START tslib,_Subject,_OuterSubscriber,_util_subscribeToResult PURE_IMPORTS_END */




function windowWhen(closingSelector) {
    return function windowWhenOperatorFunction(source) {
        return source.lift(new windowWhen_WindowOperator(closingSelector));
    };
}
var windowWhen_WindowOperator = /*@__PURE__*/ (function () {
    function WindowOperator(closingSelector) {
        this.closingSelector = closingSelector;
    }
    WindowOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new windowWhen_WindowSubscriber(subscriber, this.closingSelector));
    };
    return WindowOperator;
}());
var windowWhen_WindowSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(WindowSubscriber, _super);
    function WindowSubscriber(destination, closingSelector) {
        var _this = _super.call(this, destination) || this;
        _this.destination = destination;
        _this.closingSelector = closingSelector;
        _this.openWindow();
        return _this;
    }
    WindowSubscriber.prototype.notifyNext = function (_outerValue, _innerValue, _outerIndex, _innerIndex, innerSub) {
        this.openWindow(innerSub);
    };
    WindowSubscriber.prototype.notifyError = function (error) {
        this._error(error);
    };
    WindowSubscriber.prototype.notifyComplete = function (innerSub) {
        this.openWindow(innerSub);
    };
    WindowSubscriber.prototype._next = function (value) {
        this.window.next(value);
    };
    WindowSubscriber.prototype._error = function (err) {
        this.window.error(err);
        this.destination.error(err);
        this.unsubscribeClosingNotification();
    };
    WindowSubscriber.prototype._complete = function () {
        this.window.complete();
        this.destination.complete();
        this.unsubscribeClosingNotification();
    };
    WindowSubscriber.prototype.unsubscribeClosingNotification = function () {
        if (this.closingNotification) {
            this.closingNotification.unsubscribe();
        }
    };
    WindowSubscriber.prototype.openWindow = function (innerSub) {
        if (innerSub === void 0) {
            innerSub = null;
        }
        if (innerSub) {
            this.remove(innerSub);
            innerSub.unsubscribe();
        }
        var prevWindow = this.window;
        if (prevWindow) {
            prevWindow.complete();
        }
        var window = this.window = new Subject/* Subject */.xQ();
        this.destination.next(window);
        var closingNotifier;
        try {
            var closingSelector = this.closingSelector;
            closingNotifier = closingSelector();
        }
        catch (e) {
            this.destination.error(e);
            this.window.error(e);
            return;
        }
        this.add(this.closingNotification = (0,subscribeToResult/* subscribeToResult */.D)(this, closingNotifier));
    };
    return WindowSubscriber;
}(OuterSubscriber/* OuterSubscriber */.L));
//# sourceMappingURL=windowWhen.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/withLatestFrom.js
/** PURE_IMPORTS_START tslib,_OuterSubscriber,_util_subscribeToResult PURE_IMPORTS_END */



function withLatestFrom() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
    }
    return function (source) {
        var project;
        if (typeof args[args.length - 1] === 'function') {
            project = args.pop();
        }
        var observables = args;
        return source.lift(new WithLatestFromOperator(observables, project));
    };
}
var WithLatestFromOperator = /*@__PURE__*/ (function () {
    function WithLatestFromOperator(observables, project) {
        this.observables = observables;
        this.project = project;
    }
    WithLatestFromOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new WithLatestFromSubscriber(subscriber, this.observables, this.project));
    };
    return WithLatestFromOperator;
}());
var WithLatestFromSubscriber = /*@__PURE__*/ (function (_super) {
    tslib_es6/* __extends */.ZT(WithLatestFromSubscriber, _super);
    function WithLatestFromSubscriber(destination, observables, project) {
        var _this = _super.call(this, destination) || this;
        _this.observables = observables;
        _this.project = project;
        _this.toRespond = [];
        var len = observables.length;
        _this.values = new Array(len);
        for (var i = 0; i < len; i++) {
            _this.toRespond.push(i);
        }
        for (var i = 0; i < len; i++) {
            var observable = observables[i];
            _this.add((0,subscribeToResult/* subscribeToResult */.D)(_this, observable, undefined, i));
        }
        return _this;
    }
    WithLatestFromSubscriber.prototype.notifyNext = function (_outerValue, innerValue, outerIndex) {
        this.values[outerIndex] = innerValue;
        var toRespond = this.toRespond;
        if (toRespond.length > 0) {
            var found = toRespond.indexOf(outerIndex);
            if (found !== -1) {
                toRespond.splice(found, 1);
            }
        }
    };
    WithLatestFromSubscriber.prototype.notifyComplete = function () {
    };
    WithLatestFromSubscriber.prototype._next = function (value) {
        if (this.toRespond.length === 0) {
            var args = [value].concat(this.values);
            if (this.project) {
                this._tryProject(args);
            }
            else {
                this.destination.next(args);
            }
        }
    };
    WithLatestFromSubscriber.prototype._tryProject = function (args) {
        var result;
        try {
            result = this.project.apply(this, args);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        this.destination.next(result);
    };
    return WithLatestFromSubscriber;
}(OuterSubscriber/* OuterSubscriber */.L));
//# sourceMappingURL=withLatestFrom.js.map

// EXTERNAL MODULE: ./node_modules/rxjs/_esm5/internal/observable/zip.js
var zip = __webpack_require__(5080);
;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/zip.js
/** PURE_IMPORTS_START _observable_zip PURE_IMPORTS_END */

function zip_zip() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    return function zipOperatorFunction(source) {
        return source.lift.call(zip/* zip.apply */.$R.apply(void 0, [source].concat(observables)));
    };
}
//# sourceMappingURL=zip.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/internal/operators/zipAll.js
/** PURE_IMPORTS_START _observable_zip PURE_IMPORTS_END */

function zipAll(project) {
    return function (source) { return source.lift(new zip/* ZipOperator */.mx(project)); };
}
//# sourceMappingURL=zipAll.js.map

;// CONCATENATED MODULE: ./node_modules/rxjs/_esm5/operators/index.js
/** PURE_IMPORTS_START  PURE_IMPORTS_END */







































































































//# sourceMappingURL=index.js.map


/***/ }),

/***/ 5987:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "ZT": () => (/* binding */ __extends)
/* harmony export */ });
/* unused harmony exports __assign, __rest, __decorate, __param, __metadata, __awaiter, __generator, __createBinding, __exportStar, __values, __read, __spread, __spreadArrays, __await, __asyncGenerator, __asyncDelegator, __asyncValues, __makeTemplateObject, __importStar, __importDefault, __classPrivateFieldGet, __classPrivateFieldSet */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var __assign = function() {
    __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
        return t;
    }
    return __assign.apply(this, arguments);
}

function __rest(s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
}

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

function __param(paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
}

function __metadata(metadataKey, metadataValue) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(metadataKey, metadataValue);
}

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

function __generator(thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
}

function __createBinding(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}

function __exportStar(m, exports) {
    for (var p in m) if (p !== "default" && !exports.hasOwnProperty(p)) exports[p] = m[p];
}

function __values(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
}

function __read(o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
}

function __spread() {
    for (var ar = [], i = 0; i < arguments.length; i++)
        ar = ar.concat(__read(arguments[i]));
    return ar;
}

function __spreadArrays() {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};

function __await(v) {
    return this instanceof __await ? (this.v = v, this) : new __await(v);
}

function __asyncGenerator(thisArg, _arguments, generator) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var g = generator.apply(thisArg, _arguments || []), i, q = [];
    return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;
    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }
    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }
    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }
    function fulfill(value) { resume("next", value); }
    function reject(value) { resume("throw", value); }
    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }
}

function __asyncDelegator(o) {
    var i, p;
    return i = {}, verb("next"), verb("throw", function (e) { throw e; }), verb("return"), i[Symbol.iterator] = function () { return this; }, i;
    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === "return" } : f ? f(v) : v; } : f; }
}

function __asyncValues(o) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var m = o[Symbol.asyncIterator], i;
    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }
}

function __makeTemplateObject(cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};

function __importStar(mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result.default = mod;
    return result;
}

function __importDefault(mod) {
    return (mod && mod.__esModule) ? mod : { default: mod };
}

function __classPrivateFieldGet(receiver, privateMap) {
    if (!privateMap.has(receiver)) {
        throw new TypeError("attempted to get private field on non-instance");
    }
    return privateMap.get(receiver);
}

function __classPrivateFieldSet(receiver, privateMap, value) {
    if (!privateMap.has(receiver)) {
        throw new TypeError("attempted to set private field on non-instance");
    }
    privateMap.set(receiver, value);
    return value;
}


/***/ }),

/***/ 9126:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", ({ value: true }));
__export(__webpack_require__(969));
//# sourceMappingURL=fromEvent.js.map

/***/ }),

/***/ 8111:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", ({ value: true }));
__export(__webpack_require__(5624));
//# sourceMappingURL=filter.js.map

/***/ }),

/***/ 173:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", ({ value: true }));
__export(__webpack_require__(6097));
//# sourceMappingURL=first.js.map

/***/ }),

/***/ 2068:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", ({ value: true }));
__export(__webpack_require__(1709));
//# sourceMappingURL=map.js.map

/***/ }),

/***/ 904:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", ({ value: true }));
__export(__webpack_require__(3895));
//# sourceMappingURL=mergeMap.js.map

/***/ }),

/***/ 8120:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", ({ value: true }));
__export(__webpack_require__(6740));
//# sourceMappingURL=takeUntil.js.map

/***/ }),

/***/ 9890:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", ({ value: true }));
__export(__webpack_require__(698));
//# sourceMappingURL=tap.js.map

/***/ }),

/***/ 1301:
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

/* provided dependency */ var Buffer = __webpack_require__(8764)["Buffer"];
/*
  Based heavily on the Streaming Boyer-Moore-Horspool C++ implementation
  by Hongli Lai at: https://github.com/FooBarWidget/boyer-moore-horspool
*/
var EventEmitter = __webpack_require__(7187).EventEmitter,
    inherits = __webpack_require__(9539).inherits;

function jsmemcmp(buf1, pos1, buf2, pos2, num) {
  for (var i = 0; i < num; ++i, ++pos1, ++pos2)
    if (buf1[pos1] !== buf2[pos2])
      return false;
  return true;
}

function SBMH(needle) {
  if (typeof needle === 'string')
    needle = new Buffer(needle);
  var i, j, needle_len = needle.length;

  this.maxMatches = Infinity;
  this.matches = 0;

  this._occ = new Array(256);
  this._lookbehind_size = 0;
  this._needle = needle;
  this._bufpos = 0;

  this._lookbehind = new Buffer(needle_len);

  // Initialize occurrence table.
  for (j = 0; j < 256; ++j)
    this._occ[j] = needle_len;

  // Populate occurrence table with analysis of the needle,
  // ignoring last letter.
  if (needle_len >= 1) {
    for (i = 0; i < needle_len - 1; ++i)
      this._occ[needle[i]] = needle_len - 1 - i;
  }
}
inherits(SBMH, EventEmitter);

SBMH.prototype.reset = function() {
  this._lookbehind_size = 0;
  this.matches = 0;
  this._bufpos = 0;
};

SBMH.prototype.push = function(chunk, pos) {
  var r, chlen;
  if (!Buffer.isBuffer(chunk))
    chunk = new Buffer(chunk, 'binary');
  chlen = chunk.length;
  this._bufpos = pos || 0;
  while (r !== chlen && this.matches < this.maxMatches)
    r = this._sbmh_feed(chunk);
  return r;
};

SBMH.prototype._sbmh_feed = function(data) {
  var len = data.length, needle = this._needle, needle_len = needle.length;

  // Positive: points to a position in `data`
  //           pos == 3 points to data[3]
  // Negative: points to a position in the lookbehind buffer
  //           pos == -2 points to lookbehind[lookbehind_size - 2]
  var pos = -this._lookbehind_size,
      last_needle_char = needle[needle_len - 1],
      occ = this._occ,
      lookbehind = this._lookbehind;

  if (pos < 0) {
    // Lookbehind buffer is not empty. Perform Boyer-Moore-Horspool
    // search with character lookup code that considers both the
    // lookbehind buffer and the current round's haystack data.
    //
    // Loop until
    //   there is a match.
    // or until
    //   we've moved past the position that requires the
    //   lookbehind buffer. In this case we switch to the
    //   optimized loop.
    // or until
    //   the character to look at lies outside the haystack.
    while (pos < 0 && pos <= len - needle_len) {
       var ch = this._sbmh_lookup_char(data, pos + needle_len - 1);

      if (ch === last_needle_char
          && this._sbmh_memcmp(data, pos, needle_len - 1)) {
        this._lookbehind_size = 0;
        ++this.matches;
        if (pos > -this._lookbehind_size)
          this.emit('info', true, lookbehind, 0, this._lookbehind_size + pos);
        else
          this.emit('info', true);

        this._bufpos = pos + needle_len;
        return pos + needle_len;
      } else
        pos += occ[ch];
    }

    // No match.

    if (pos < 0) {
      // There's too few data for Boyer-Moore-Horspool to run,
      // so let's use a different algorithm to skip as much as
      // we can.
      // Forward pos until
      //   the trailing part of lookbehind + data
      //   looks like the beginning of the needle
      // or until
      //   pos == 0
      while (pos < 0 && !this._sbmh_memcmp(data, pos, len - pos))
        pos++;
    }

    if (pos >= 0) {
      // Discard lookbehind buffer.
      this.emit('info', false, lookbehind, 0, this._lookbehind_size);
      this._lookbehind_size = 0;
    } else {
      // Cut off part of the lookbehind buffer that has
      // been processed and append the entire haystack
      // into it.
      var bytesToCutOff = this._lookbehind_size + pos;

      if (bytesToCutOff > 0) {
        // The cut off data is guaranteed not to contain the needle.
        this.emit('info', false, lookbehind, 0, bytesToCutOff);
      }

      lookbehind.copy(lookbehind, 0, bytesToCutOff,
                      this._lookbehind_size - bytesToCutOff);
      this._lookbehind_size -= bytesToCutOff;

      data.copy(lookbehind, this._lookbehind_size);
      this._lookbehind_size += len;

      this._bufpos = len;
      return len;
    }
  }

  if (pos >= 0)
    pos += this._bufpos;

  // Lookbehind buffer is now empty. Perform Boyer-Moore-Horspool
  // search with optimized character lookup code that only considers
  // the current round's haystack data.
  while (pos <= len - needle_len) {
    var ch = data[pos + needle_len - 1];

    if (ch === last_needle_char
        && data[pos] === needle[0]
        && jsmemcmp(needle, 0, data, pos, needle_len - 1)) {
      ++this.matches;
      if (pos > 0)
        this.emit('info', true, data, this._bufpos, pos);
      else
        this.emit('info', true);

      this._bufpos = pos + needle_len;
      return pos + needle_len;
    } else
      pos += occ[ch];
  }

  // There was no match. If there's trailing haystack data that we cannot
  // match yet using the Boyer-Moore-Horspool algorithm (because the trailing
  // data is less than the needle size) then match using a modified
  // algorithm that starts matching from the beginning instead of the end.
  // Whatever trailing data is left after running this algorithm is added to
  // the lookbehind buffer.
  if (pos < len) {
    while (pos < len && (data[pos] !== needle[0]
                         || !jsmemcmp(data, pos, needle, 0, len - pos))) {
      ++pos;
    }
    if (pos < len) {
      data.copy(lookbehind, 0, pos, pos + (len - pos));
      this._lookbehind_size = len - pos;
    }
  }

  // Everything until pos is guaranteed not to contain needle data.
  if (pos > 0)
    this.emit('info', false, data, this._bufpos, pos < len ? pos : len);

  this._bufpos = len;
  return len;
};

SBMH.prototype._sbmh_lookup_char = function(data, pos) {
  if (pos < 0)
    return this._lookbehind[this._lookbehind_size + pos];
  else
    return data[pos];
}

SBMH.prototype._sbmh_memcmp = function(data, pos, len) {
  var i = 0;

  while (i < len) {
    if (this._sbmh_lookup_char(data, pos + i) === this._needle[i])
      ++i;
    else
      return false;
  }
  return true;
}

module.exports = SBMH;


/***/ }),

/***/ 3379:
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

"use strict";


var isOldIE = function isOldIE() {
  var memo;
  return function memorize() {
    if (typeof memo === 'undefined') {
      // Test for IE <= 9 as proposed by Browserhacks
      // @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805
      // Tests for existence of standard globals is to allow style-loader
      // to operate correctly into non-standard environments
      // @see https://github.com/webpack-contrib/style-loader/issues/177
      memo = Boolean(window && document && document.all && !window.atob);
    }

    return memo;
  };
}();

var getTarget = function getTarget() {
  var memo = {};
  return function memorize(target) {
    if (typeof memo[target] === 'undefined') {
      var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself

      if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {
        try {
          // This will throw an exception if access to iframe is blocked
          // due to cross-origin restrictions
          styleTarget = styleTarget.contentDocument.head;
        } catch (e) {
          // istanbul ignore next
          styleTarget = null;
        }
      }

      memo[target] = styleTarget;
    }

    return memo[target];
  };
}();

var stylesInDom = [];

function getIndexByIdentifier(identifier) {
  var result = -1;

  for (var i = 0; i < stylesInDom.length; i++) {
    if (stylesInDom[i].identifier === identifier) {
      result = i;
      break;
    }
  }

  return result;
}

function modulesToDom(list, options) {
  var idCountMap = {};
  var identifiers = [];

  for (var i = 0; i < list.length; i++) {
    var item = list[i];
    var id = options.base ? item[0] + options.base : item[0];
    var count = idCountMap[id] || 0;
    var identifier = "".concat(id, " ").concat(count);
    idCountMap[id] = count + 1;
    var index = getIndexByIdentifier(identifier);
    var obj = {
      css: item[1],
      media: item[2],
      sourceMap: item[3]
    };

    if (index !== -1) {
      stylesInDom[index].references++;
      stylesInDom[index].updater(obj);
    } else {
      stylesInDom.push({
        identifier: identifier,
        updater: addStyle(obj, options),
        references: 1
      });
    }

    identifiers.push(identifier);
  }

  return identifiers;
}

function insertStyleElement(options) {
  var style = document.createElement('style');
  var attributes = options.attributes || {};

  if (typeof attributes.nonce === 'undefined') {
    var nonce =  true ? __webpack_require__.nc : 0;

    if (nonce) {
      attributes.nonce = nonce;
    }
  }

  Object.keys(attributes).forEach(function (key) {
    style.setAttribute(key, attributes[key]);
  });

  if (typeof options.insert === 'function') {
    options.insert(style);
  } else {
    var target = getTarget(options.insert || 'head');

    if (!target) {
      throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");
    }

    target.appendChild(style);
  }

  return style;
}

function removeStyleElement(style) {
  // istanbul ignore if
  if (style.parentNode === null) {
    return false;
  }

  style.parentNode.removeChild(style);
}
/* istanbul ignore next  */


var replaceText = function replaceText() {
  var textStore = [];
  return function replace(index, replacement) {
    textStore[index] = replacement;
    return textStore.filter(Boolean).join('\n');
  };
}();

function applyToSingletonTag(style, index, remove, obj) {
  var css = remove ? '' : obj.media ? "@media ".concat(obj.media, " {").concat(obj.css, "}") : obj.css; // For old IE

  /* istanbul ignore if  */

  if (style.styleSheet) {
    style.styleSheet.cssText = replaceText(index, css);
  } else {
    var cssNode = document.createTextNode(css);
    var childNodes = style.childNodes;

    if (childNodes[index]) {
      style.removeChild(childNodes[index]);
    }

    if (childNodes.length) {
      style.insertBefore(cssNode, childNodes[index]);
    } else {
      style.appendChild(cssNode);
    }
  }
}

function applyToTag(style, options, obj) {
  var css = obj.css;
  var media = obj.media;
  var sourceMap = obj.sourceMap;

  if (media) {
    style.setAttribute('media', media);
  } else {
    style.removeAttribute('media');
  }

  if (sourceMap && typeof btoa !== 'undefined') {
    css += "\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), " */");
  } // For old IE

  /* istanbul ignore if  */


  if (style.styleSheet) {
    style.styleSheet.cssText = css;
  } else {
    while (style.firstChild) {
      style.removeChild(style.firstChild);
    }

    style.appendChild(document.createTextNode(css));
  }
}

var singleton = null;
var singletonCounter = 0;

function addStyle(obj, options) {
  var style;
  var update;
  var remove;

  if (options.singleton) {
    var styleIndex = singletonCounter++;
    style = singleton || (singleton = insertStyleElement(options));
    update = applyToSingletonTag.bind(null, style, styleIndex, false);
    remove = applyToSingletonTag.bind(null, style, styleIndex, true);
  } else {
    style = insertStyleElement(options);
    update = applyToTag.bind(null, style, options);

    remove = function remove() {
      removeStyleElement(style);
    };
  }

  update(obj);
  return function updateStyle(newObj) {
    if (newObj) {
      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap) {
        return;
      }

      update(obj = newObj);
    } else {
      remove();
    }
  };
}

module.exports = function (list, options) {
  options = options || {}; // Force single-tag solution on IE6-9, which has a hard limit on the # of <style>
  // tags it will allow on a page

  if (!options.singleton && typeof options.singleton !== 'boolean') {
    options.singleton = isOldIE();
  }

  list = list || [];
  var lastIdentifiers = modulesToDom(list, options);
  return function update(newList) {
    newList = newList || [];

    if (Object.prototype.toString.call(newList) !== '[object Array]') {
      return;
    }

    for (var i = 0; i < lastIdentifiers.length; i++) {
      var identifier = lastIdentifiers[i];
      var index = getIndexByIdentifier(identifier);
      stylesInDom[index].references--;
    }

    var newLastIdentifiers = modulesToDom(newList, options);

    for (var _i = 0; _i < lastIdentifiers.length; _i++) {
      var _identifier = lastIdentifiers[_i];

      var _index = getIndexByIdentifier(_identifier);

      if (stylesInDom[_index].references === 0) {
        stylesInDom[_index].updater();

        stylesInDom.splice(_index, 1);
      }
    }

    lastIdentifiers = newLastIdentifiers;
  };
};

/***/ }),

/***/ 1496:
/***/ ((module) => {

if (typeof Object.create === 'function') {
  // implementation from standard node.js 'util' module
  module.exports = function inherits(ctor, superCtor) {
    ctor.super_ = superCtor
    ctor.prototype = Object.create(superCtor.prototype, {
      constructor: {
        value: ctor,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
  };
} else {
  // old school shim for old browsers
  module.exports = function inherits(ctor, superCtor) {
    ctor.super_ = superCtor
    var TempCtor = function () {}
    TempCtor.prototype = superCtor.prototype
    ctor.prototype = new TempCtor()
    ctor.prototype.constructor = ctor
  }
}


/***/ }),

/***/ 384:
/***/ ((module) => {

module.exports = function isBuffer(arg) {
  return arg && typeof arg === 'object'
    && typeof arg.copy === 'function'
    && typeof arg.fill === 'function'
    && typeof arg.readUInt8 === 'function';
}

/***/ }),

/***/ 9539:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

/* provided dependency */ var process = __webpack_require__(4155);
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var getOwnPropertyDescriptors = Object.getOwnPropertyDescriptors ||
  function getOwnPropertyDescriptors(obj) {
    var keys = Object.keys(obj);
    var descriptors = {};
    for (var i = 0; i < keys.length; i++) {
      descriptors[keys[i]] = Object.getOwnPropertyDescriptor(obj, keys[i]);
    }
    return descriptors;
  };

var formatRegExp = /%[sdj%]/g;
exports.format = function(f) {
  if (!isString(f)) {
    var objects = [];
    for (var i = 0; i < arguments.length; i++) {
      objects.push(inspect(arguments[i]));
    }
    return objects.join(' ');
  }

  var i = 1;
  var args = arguments;
  var len = args.length;
  var str = String(f).replace(formatRegExp, function(x) {
    if (x === '%%') return '%';
    if (i >= len) return x;
    switch (x) {
      case '%s': return String(args[i++]);
      case '%d': return Number(args[i++]);
      case '%j':
        try {
          return JSON.stringify(args[i++]);
        } catch (_) {
          return '[Circular]';
        }
      default:
        return x;
    }
  });
  for (var x = args[i]; i < len; x = args[++i]) {
    if (isNull(x) || !isObject(x)) {
      str += ' ' + x;
    } else {
      str += ' ' + inspect(x);
    }
  }
  return str;
};


// Mark that a method should not be used.
// Returns a modified function which warns once by default.
// If --no-deprecation is set, then it is a no-op.
exports.deprecate = function(fn, msg) {
  if (typeof process !== 'undefined' && process.noDeprecation === true) {
    return fn;
  }

  // Allow for deprecating things in the process of starting up.
  if (typeof process === 'undefined') {
    return function() {
      return exports.deprecate(fn, msg).apply(this, arguments);
    };
  }

  var warned = false;
  function deprecated() {
    if (!warned) {
      if (process.throwDeprecation) {
        throw new Error(msg);
      } else if (process.traceDeprecation) {
        console.trace(msg);
      } else {
        console.error(msg);
      }
      warned = true;
    }
    return fn.apply(this, arguments);
  }

  return deprecated;
};


var debugs = {};
var debugEnviron;
exports.debuglog = function(set) {
  if (isUndefined(debugEnviron))
    debugEnviron = process.env.NODE_DEBUG || '';
  set = set.toUpperCase();
  if (!debugs[set]) {
    if (new RegExp('\\b' + set + '\\b', 'i').test(debugEnviron)) {
      var pid = process.pid;
      debugs[set] = function() {
        var msg = exports.format.apply(exports, arguments);
        console.error('%s %d: %s', set, pid, msg);
      };
    } else {
      debugs[set] = function() {};
    }
  }
  return debugs[set];
};


/**
 * Echos the value of a value. Trys to print the value out
 * in the best way possible given the different types.
 *
 * @param {Object} obj The object to print out.
 * @param {Object} opts Optional options object that alters the output.
 */
/* legacy: obj, showHidden, depth, colors*/
function inspect(obj, opts) {
  // default options
  var ctx = {
    seen: [],
    stylize: stylizeNoColor
  };
  // legacy...
  if (arguments.length >= 3) ctx.depth = arguments[2];
  if (arguments.length >= 4) ctx.colors = arguments[3];
  if (isBoolean(opts)) {
    // legacy...
    ctx.showHidden = opts;
  } else if (opts) {
    // got an "options" object
    exports._extend(ctx, opts);
  }
  // set default options
  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;
  if (isUndefined(ctx.depth)) ctx.depth = 2;
  if (isUndefined(ctx.colors)) ctx.colors = false;
  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;
  if (ctx.colors) ctx.stylize = stylizeWithColor;
  return formatValue(ctx, obj, ctx.depth);
}
exports.inspect = inspect;


// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics
inspect.colors = {
  'bold' : [1, 22],
  'italic' : [3, 23],
  'underline' : [4, 24],
  'inverse' : [7, 27],
  'white' : [37, 39],
  'grey' : [90, 39],
  'black' : [30, 39],
  'blue' : [34, 39],
  'cyan' : [36, 39],
  'green' : [32, 39],
  'magenta' : [35, 39],
  'red' : [31, 39],
  'yellow' : [33, 39]
};

// Don't use 'blue' not visible on cmd.exe
inspect.styles = {
  'special': 'cyan',
  'number': 'yellow',
  'boolean': 'yellow',
  'undefined': 'grey',
  'null': 'bold',
  'string': 'green',
  'date': 'magenta',
  // "name": intentionally not styling
  'regexp': 'red'
};


function stylizeWithColor(str, styleType) {
  var style = inspect.styles[styleType];

  if (style) {
    return '\u001b[' + inspect.colors[style][0] + 'm' + str +
           '\u001b[' + inspect.colors[style][1] + 'm';
  } else {
    return str;
  }
}


function stylizeNoColor(str, styleType) {
  return str;
}


function arrayToHash(array) {
  var hash = {};

  array.forEach(function(val, idx) {
    hash[val] = true;
  });

  return hash;
}


function formatValue(ctx, value, recurseTimes) {
  // Provide a hook for user-specified inspect functions.
  // Check that value is an object with an inspect function on it
  if (ctx.customInspect &&
      value &&
      isFunction(value.inspect) &&
      // Filter out the util module, it's inspect function is special
      value.inspect !== exports.inspect &&
      // Also filter out any prototype objects using the circular check.
      !(value.constructor && value.constructor.prototype === value)) {
    var ret = value.inspect(recurseTimes, ctx);
    if (!isString(ret)) {
      ret = formatValue(ctx, ret, recurseTimes);
    }
    return ret;
  }

  // Primitive types cannot have properties
  var primitive = formatPrimitive(ctx, value);
  if (primitive) {
    return primitive;
  }

  // Look up the keys of the object.
  var keys = Object.keys(value);
  var visibleKeys = arrayToHash(keys);

  if (ctx.showHidden) {
    keys = Object.getOwnPropertyNames(value);
  }

  // IE doesn't make error fields non-enumerable
  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx
  if (isError(value)
      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {
    return formatError(value);
  }

  // Some type of object without properties can be shortcutted.
  if (keys.length === 0) {
    if (isFunction(value)) {
      var name = value.name ? ': ' + value.name : '';
      return ctx.stylize('[Function' + name + ']', 'special');
    }
    if (isRegExp(value)) {
      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');
    }
    if (isDate(value)) {
      return ctx.stylize(Date.prototype.toString.call(value), 'date');
    }
    if (isError(value)) {
      return formatError(value);
    }
  }

  var base = '', array = false, braces = ['{', '}'];

  // Make Array say that they are Array
  if (isArray(value)) {
    array = true;
    braces = ['[', ']'];
  }

  // Make functions say that they are functions
  if (isFunction(value)) {
    var n = value.name ? ': ' + value.name : '';
    base = ' [Function' + n + ']';
  }

  // Make RegExps say that they are RegExps
  if (isRegExp(value)) {
    base = ' ' + RegExp.prototype.toString.call(value);
  }

  // Make dates with properties first say the date
  if (isDate(value)) {
    base = ' ' + Date.prototype.toUTCString.call(value);
  }

  // Make error with message first say the error
  if (isError(value)) {
    base = ' ' + formatError(value);
  }

  if (keys.length === 0 && (!array || value.length == 0)) {
    return braces[0] + base + braces[1];
  }

  if (recurseTimes < 0) {
    if (isRegExp(value)) {
      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');
    } else {
      return ctx.stylize('[Object]', 'special');
    }
  }

  ctx.seen.push(value);

  var output;
  if (array) {
    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);
  } else {
    output = keys.map(function(key) {
      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);
    });
  }

  ctx.seen.pop();

  return reduceToSingleString(output, base, braces);
}


function formatPrimitive(ctx, value) {
  if (isUndefined(value))
    return ctx.stylize('undefined', 'undefined');
  if (isString(value)) {
    var simple = '\'' + JSON.stringify(value).replace(/^"|"$/g, '')
                                             .replace(/'/g, "\\'")
                                             .replace(/\\"/g, '"') + '\'';
    return ctx.stylize(simple, 'string');
  }
  if (isNumber(value))
    return ctx.stylize('' + value, 'number');
  if (isBoolean(value))
    return ctx.stylize('' + value, 'boolean');
  // For some reason typeof null is "object", so special case here.
  if (isNull(value))
    return ctx.stylize('null', 'null');
}


function formatError(value) {
  return '[' + Error.prototype.toString.call(value) + ']';
}


function formatArray(ctx, value, recurseTimes, visibleKeys, keys) {
  var output = [];
  for (var i = 0, l = value.length; i < l; ++i) {
    if (hasOwnProperty(value, String(i))) {
      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,
          String(i), true));
    } else {
      output.push('');
    }
  }
  keys.forEach(function(key) {
    if (!key.match(/^\d+$/)) {
      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,
          key, true));
    }
  });
  return output;
}


function formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {
  var name, str, desc;
  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };
  if (desc.get) {
    if (desc.set) {
      str = ctx.stylize('[Getter/Setter]', 'special');
    } else {
      str = ctx.stylize('[Getter]', 'special');
    }
  } else {
    if (desc.set) {
      str = ctx.stylize('[Setter]', 'special');
    }
  }
  if (!hasOwnProperty(visibleKeys, key)) {
    name = '[' + key + ']';
  }
  if (!str) {
    if (ctx.seen.indexOf(desc.value) < 0) {
      if (isNull(recurseTimes)) {
        str = formatValue(ctx, desc.value, null);
      } else {
        str = formatValue(ctx, desc.value, recurseTimes - 1);
      }
      if (str.indexOf('\n') > -1) {
        if (array) {
          str = str.split('\n').map(function(line) {
            return '  ' + line;
          }).join('\n').substr(2);
        } else {
          str = '\n' + str.split('\n').map(function(line) {
            return '   ' + line;
          }).join('\n');
        }
      }
    } else {
      str = ctx.stylize('[Circular]', 'special');
    }
  }
  if (isUndefined(name)) {
    if (array && key.match(/^\d+$/)) {
      return str;
    }
    name = JSON.stringify('' + key);
    if (name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)) {
      name = name.substr(1, name.length - 2);
      name = ctx.stylize(name, 'name');
    } else {
      name = name.replace(/'/g, "\\'")
                 .replace(/\\"/g, '"')
                 .replace(/(^"|"$)/g, "'");
      name = ctx.stylize(name, 'string');
    }
  }

  return name + ': ' + str;
}


function reduceToSingleString(output, base, braces) {
  var numLinesEst = 0;
  var length = output.reduce(function(prev, cur) {
    numLinesEst++;
    if (cur.indexOf('\n') >= 0) numLinesEst++;
    return prev + cur.replace(/\u001b\[\d\d?m/g, '').length + 1;
  }, 0);

  if (length > 60) {
    return braces[0] +
           (base === '' ? '' : base + '\n ') +
           ' ' +
           output.join(',\n  ') +
           ' ' +
           braces[1];
  }

  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];
}


// NOTE: These type checking functions intentionally don't use `instanceof`
// because it is fragile and can be easily faked with `Object.create()`.
function isArray(ar) {
  return Array.isArray(ar);
}
exports.isArray = isArray;

function isBoolean(arg) {
  return typeof arg === 'boolean';
}
exports.isBoolean = isBoolean;

function isNull(arg) {
  return arg === null;
}
exports.isNull = isNull;

function isNullOrUndefined(arg) {
  return arg == null;
}
exports.isNullOrUndefined = isNullOrUndefined;

function isNumber(arg) {
  return typeof arg === 'number';
}
exports.isNumber = isNumber;

function isString(arg) {
  return typeof arg === 'string';
}
exports.isString = isString;

function isSymbol(arg) {
  return typeof arg === 'symbol';
}
exports.isSymbol = isSymbol;

function isUndefined(arg) {
  return arg === void 0;
}
exports.isUndefined = isUndefined;

function isRegExp(re) {
  return isObject(re) && objectToString(re) === '[object RegExp]';
}
exports.isRegExp = isRegExp;

function isObject(arg) {
  return typeof arg === 'object' && arg !== null;
}
exports.isObject = isObject;

function isDate(d) {
  return isObject(d) && objectToString(d) === '[object Date]';
}
exports.isDate = isDate;

function isError(e) {
  return isObject(e) &&
      (objectToString(e) === '[object Error]' || e instanceof Error);
}
exports.isError = isError;

function isFunction(arg) {
  return typeof arg === 'function';
}
exports.isFunction = isFunction;

function isPrimitive(arg) {
  return arg === null ||
         typeof arg === 'boolean' ||
         typeof arg === 'number' ||
         typeof arg === 'string' ||
         typeof arg === 'symbol' ||  // ES6 symbol
         typeof arg === 'undefined';
}
exports.isPrimitive = isPrimitive;

exports.isBuffer = __webpack_require__(384);

function objectToString(o) {
  return Object.prototype.toString.call(o);
}


function pad(n) {
  return n < 10 ? '0' + n.toString(10) : n.toString(10);
}


var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',
              'Oct', 'Nov', 'Dec'];

// 26 Feb 16:19:34
function timestamp() {
  var d = new Date();
  var time = [pad(d.getHours()),
              pad(d.getMinutes()),
              pad(d.getSeconds())].join(':');
  return [d.getDate(), months[d.getMonth()], time].join(' ');
}


// log is just a thin wrapper to console.log that prepends a timestamp
exports.log = function() {
  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));
};


/**
 * Inherit the prototype methods from one constructor into another.
 *
 * The Function.prototype.inherits from lang.js rewritten as a standalone
 * function (not on Function.prototype). NOTE: If this file is to be loaded
 * during bootstrapping this function needs to be rewritten using some native
 * functions as prototype setup using normal JavaScript does not work as
 * expected during bootstrapping (see mirror.js in r114903).
 *
 * @param {function} ctor Constructor function which needs to inherit the
 *     prototype.
 * @param {function} superCtor Constructor function to inherit prototype from.
 */
exports.inherits = __webpack_require__(1496);

exports._extend = function(origin, add) {
  // Don't do anything if add isn't an object
  if (!add || !isObject(add)) return origin;

  var keys = Object.keys(add);
  var i = keys.length;
  while (i--) {
    origin[keys[i]] = add[keys[i]];
  }
  return origin;
};

function hasOwnProperty(obj, prop) {
  return Object.prototype.hasOwnProperty.call(obj, prop);
}

var kCustomPromisifiedSymbol = typeof Symbol !== 'undefined' ? Symbol('util.promisify.custom') : undefined;

exports.promisify = function promisify(original) {
  if (typeof original !== 'function')
    throw new TypeError('The "original" argument must be of type Function');

  if (kCustomPromisifiedSymbol && original[kCustomPromisifiedSymbol]) {
    var fn = original[kCustomPromisifiedSymbol];
    if (typeof fn !== 'function') {
      throw new TypeError('The "util.promisify.custom" argument must be of type Function');
    }
    Object.defineProperty(fn, kCustomPromisifiedSymbol, {
      value: fn, enumerable: false, writable: false, configurable: true
    });
    return fn;
  }

  function fn() {
    var promiseResolve, promiseReject;
    var promise = new Promise(function (resolve, reject) {
      promiseResolve = resolve;
      promiseReject = reject;
    });

    var args = [];
    for (var i = 0; i < arguments.length; i++) {
      args.push(arguments[i]);
    }
    args.push(function (err, value) {
      if (err) {
        promiseReject(err);
      } else {
        promiseResolve(value);
      }
    });

    try {
      original.apply(this, args);
    } catch (err) {
      promiseReject(err);
    }

    return promise;
  }

  Object.setPrototypeOf(fn, Object.getPrototypeOf(original));

  if (kCustomPromisifiedSymbol) Object.defineProperty(fn, kCustomPromisifiedSymbol, {
    value: fn, enumerable: false, writable: false, configurable: true
  });
  return Object.defineProperties(
    fn,
    getOwnPropertyDescriptors(original)
  );
}

exports.promisify.custom = kCustomPromisifiedSymbol

function callbackifyOnRejected(reason, cb) {
  // `!reason` guard inspired by bluebird (Ref: https://goo.gl/t5IS6M).
  // Because `null` is a special error value in callbacks which means "no error
  // occurred", we error-wrap so the callback consumer can distinguish between
  // "the promise rejected with null" or "the promise fulfilled with undefined".
  if (!reason) {
    var newReason = new Error('Promise was rejected with a falsy value');
    newReason.reason = reason;
    reason = newReason;
  }
  return cb(reason);
}

function callbackify(original) {
  if (typeof original !== 'function') {
    throw new TypeError('The "original" argument must be of type Function');
  }

  // We DO NOT return the promise as it gives the user a false sense that
  // the promise is actually somehow related to the callback's execution
  // and that the callback throwing will reject the promise.
  function callbackified() {
    var args = [];
    for (var i = 0; i < arguments.length; i++) {
      args.push(arguments[i]);
    }

    var maybeCb = args.pop();
    if (typeof maybeCb !== 'function') {
      throw new TypeError('The last argument must be of type Function');
    }
    var self = this;
    var cb = function() {
      return maybeCb.apply(self, arguments);
    };
    // In true node style we process the callback on `nextTick` with all the
    // implications (stack, `uncaughtException`, `async_hooks`)
    original.apply(this, args)
      .then(function(ret) { process.nextTick(cb, null, ret) },
            function(rej) { process.nextTick(callbackifyOnRejected, rej, cb) });
  }

  Object.setPrototypeOf(callbackified, Object.getPrototypeOf(original));
  Object.defineProperties(callbackified,
                          getOwnPropertyDescriptors(original));
  return callbackified;
}
exports.callbackify = callbackify;


/***/ }),

/***/ 4763:
/***/ ((module) => {

/**
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
module.exports = Worker;

/***/ }),

/***/ 5840:
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var _globalThis;
if (typeof globalThis === 'object') {
	_globalThis = globalThis;
} else {
	try {
		_globalThis = __webpack_require__(284);
	} catch (error) {
	} finally {
		if (!_globalThis && typeof window !== 'undefined') { _globalThis = window; }
		if (!_globalThis) { throw new Error('Could not determine global this'); }
	}
}

var NativeWebSocket = _globalThis.WebSocket || _globalThis.MozWebSocket;
var websocket_version = __webpack_require__(9387);


/**
 * Expose a W3C WebSocket class with just one or two arguments.
 */
function W3CWebSocket(uri, protocols) {
	var native_instance;

	if (protocols) {
		native_instance = new NativeWebSocket(uri, protocols);
	}
	else {
		native_instance = new NativeWebSocket(uri);
	}

	/**
	 * 'native_instance' is an instance of nativeWebSocket (the browser's WebSocket
	 * class). Since it is an Object it will be returned as it is when creating an
	 * instance of W3CWebSocket via 'new W3CWebSocket()'.
	 *
	 * ECMAScript 5: http://bclary.com/2004/11/07/#a-13.2.2
	 */
	return native_instance;
}
if (NativeWebSocket) {
	['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED'].forEach(function(prop) {
		Object.defineProperty(W3CWebSocket, prop, {
			get: function() { return NativeWebSocket[prop]; }
		});
	});
}

/**
 * Module exports.
 */
module.exports = {
    'w3cwebsocket' : NativeWebSocket ? W3CWebSocket : null,
    'version'      : websocket_version
};


/***/ }),

/***/ 9387:
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__(2847).version;


/***/ }),

/***/ 2847:
/***/ ((module) => {

"use strict";
module.exports = {"version":"1.0.34"};

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			id: moduleId,
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = __webpack_modules__;
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/get javascript chunk filename */
/******/ 	(() => {
/******/ 		// This function allow to reference async chunks
/******/ 		__webpack_require__.u = (chunkId) => {
/******/ 			// return url for filenames based on template
/******/ 			return "" + chunkId + ".brainsatplay.js";
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/publicPath */
/******/ 	(() => {
/******/ 		__webpack_require__.p = "/src/libraries/js/dist/";
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/jsonp chunk loading */
/******/ 	(() => {
/******/ 		__webpack_require__.b = document.baseURI || self.location.href;
/******/ 		
/******/ 		// object to store loaded and loading chunks
/******/ 		// undefined = chunk not loaded, null = chunk preloaded/prefetched
/******/ 		// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded
/******/ 		var installedChunks = {
/******/ 			179: 0
/******/ 		};
/******/ 		
/******/ 		// no chunk on demand loading
/******/ 		
/******/ 		// no prefetching
/******/ 		
/******/ 		// no preloaded
/******/ 		
/******/ 		// no HMR
/******/ 		
/******/ 		// no HMR manifest
/******/ 		
/******/ 		// no on chunks loaded
/******/ 		
/******/ 		// no jsonp function
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be in strict mode.
(() => {
"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "Application": () => (/* reexport */ Application),
  "Session": () => (/* reexport */ Session),
  "plugins": () => (/* reexport */ plugins_namespaceObject)
});

// NAMESPACE OBJECT: ./src/libraries/js/src/plugins/plugins.js
var plugins_namespaceObject = {};
__webpack_require__.r(plugins_namespaceObject);
__webpack_require__.d(plugins_namespaceObject, {
  "Debug": () => (Debug),
  "Keyboard": () => (Keyboard),
  "Neurofeedback": () => (Neurofeedback),
  "Signal": () => (Signal),
  "Transform": () => (Transform)
});

;// CONCATENATED MODULE: ./src/libraries/js/src/plugins/input/Signal.js
function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Signal = function Signal(label, session) {
  var _this = this;

  var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  _classCallCheck(this, Signal);

  this.init = function () {
    // Auto-Start a Synthetic Stream
    if (_this.params.autoconnect && _this.session.deviceStreams.length === 0) {
      _this.session.connectDevice(undefined, undefined, undefined, {
        device: 'Synthetic',
        variant: '',
        analysis: ['eegcoherence']
      });
    }
  };

  this.deinit = function () {// MUST DISCONNECT STREAM
  };

  this["default"] = function () {
    return {
      value: _this.session.atlas.data
    };
  };

  this.label = label;
  this.session = session;
  this.params = params;
  this.paramOptions = {
    autoconnect: {
      "default": false,
      show: false
    }
  };
};
Signal.id = String(Math.floor(Math.random() * 1000000));
;// CONCATENATED MODULE: ./src/libraries/js/src/plugins/algorithms/Transform.js
function Transform_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Transform = function Transform(label, session) {
  var _this = this;

  var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  Transform_classCallCheck(this, Transform);

  this.init = function () {};

  this.deinit = function () {};

  this["default"] = function (userData) {
    if (!Array.isArray(u.value)) u.value = [u.value];
    userData.forEach(function (u) {
      if (_this.params.operator.toLowerCase() === 'Add') {
        u.value = u.value.map(function (v) {
          return v += _this.params.value;
        });
      } else if (_this.params.operator.toLowerCase() === 'Subtract') {
        u.value = u.value.map(function (v) {
          return v -= _this.params.value;
        });
      } else if (_this.params.operator.toLowerCase() === 'Multiply') {
        u.value = u.value.map(function (v) {
          return v *= _this.params.value;
        });
      } else if (_this.params.operator.toLowerCase() === 'Divide') {
        u.value = u.value.map(function (v) {
          return v /= _this.params.value;
        });
      } else if (_this.params.operator.toLowerCase() === 'Mean') {
        u.value = u.value.reduce(function (a, b) {
          return a + b;
        }) / u.value.length;
      } else if (_this.params.operator.toLowerCase() === 'Sum') {
        u.value = u.value.reduce(function (a, b) {
          return a + b;
        });
      }
    });
    return userData;
  };

  this.label = label;
  this.session = session;
  this.params = params;
  this.paramOptions = {
    operator: {
      "default": '',
      options: ['Add', 'Subtract', 'Multiply', 'Divide', 'Mean', 'Sum']
    },
    value: {
      "default": 0,
      options: null
    }
  };
};
Transform.id = String(Math.floor(Math.random() * 1000000));
;// CONCATENATED MODULE: ./src/libraries/js/src/plugins/input/Keyboard.js
function Keyboard_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var Keyboard = /*#__PURE__*/function () {
  function Keyboard(label, session) {
    var _this = this;

    var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

    Keyboard_classCallCheck(this, Keyboard);

    this.init = function () {
      document.addEventListener('keydown', _this.handleKeyDown);
      document.addEventListener('keyup', _this.handleKeyUp);
    };

    this.deinit = function () {
      document.removeEventListener('keydown', _this.handleKeyDown);
      document.removeEventListener('keyup', _this.handleKeyDown);
    };

    this.handleKeyDown = function (e) {
      if (_this.matchKey(e.code) && _this.state.value != true) _this.state.value = true;
    };

    this.handleKeyUp = function (e) {
      if (_this.matchKey(e.code)) _this.state.value = false;
    };

    this.label = label;
    this.session = session;
    this.params = params;
    this.paramOptions = {
      key: {
        "default": 'Space',
        options: null
      }
    };
  }

  _createClass(Keyboard, [{
    key: "matchKey",
    value: function matchKey(code) {
      var regex = new RegExp("(?:^|W)".concat(this.params.key, "(?:$|W)"), 'i');
      return code.match(regex) || code.replace('Key', '').match(regex) || code.replace('Digit', '').match(regex);
    }
  }]);

  return Keyboard;
}();
Keyboard.id = String(Math.floor(Math.random() * 1000000));
;// CONCATENATED MODULE: ./src/libraries/js/src/plugins/output/Debug.js
function Debug_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Debug = function Debug(label, session) {
  var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  Debug_classCallCheck(this, Debug);

  this.init = function () {};

  this.deinit = function () {};

  this["default"] = function (userData) {
    userData.forEach(function (u) {
      console.log(u);
    });
    return userData;
  };

  this.label = label;
  this.session = session;
  this.params = params;
};
Debug.id = String(Math.floor(Math.random() * 1000000));
;// CONCATENATED MODULE: ./src/libraries/js/src/plugins/algorithms/Neurofeedback.js
function Neurofeedback_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Neurofeedback = function Neurofeedback(label, session) {
  var _this = this;

  var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  Neurofeedback_classCallCheck(this, Neurofeedback);

  this.init = function () {};

  this.deinit = function () {// MUST DISCONNECT STREAM
  };

  this["default"] = function (userData) {
    userData.forEach(function (u) {
      var arr = []; // Grab Atlas by Default (if not passed already)

      var data = u.value != null ? u.value : _this.session.atlas.data;

      try {
        /* 
        
        EEG Neurofeedback
         */
        var eegMetrics = ['Alpha Beta Ratio', 'Alpha Theta Ratio', 'Theta Beta Ratio', 'Alpha Ratio', 'Gamma Peak', 'Low Gamma Score'];

        if (eegMetrics.includes(_this.params.metric)) {
          data.eeg.forEach(function (ch) {
            if (_this.params.metric === 'Alpha Beta Ratio') {
              arr.push(_this.session.atlas.getAlphaBetaRatio(ch));
            } else if (_this.params.metric === 'Alpha Theta Ratio') {
              arr.push(_this.session.atlas.getAlphaThetaRatio(ch));
            } else if (_this.params.metric === 'Theta Beta Ratio') {
              arr.push(_this.session.atlas.getThetaBetaRatio(ch));
            } else if (_this.params.metric === 'Alpha Ratio') {
              arr.push(_this.session.atlas.getAlphaRatio(ch));
            } else if (_this.params.metric === 'Gamma Peak') {
              arr.push(_this.session.atlas.get40HzGamma(ch));
            } else if (_this.params.metric === 'Low Gamma Score') {
              arr.push(_this.session.atlas.getLowGammaScore(ch));
            } else {
              arr.push(0);
            }
          });
        }
        /* 
             Coherence Neurofeedback
         */


        var coherenceMetrics = ['Alpha Coherence'];

        if (coherenceMetrics.includes(_this.params.metric)) {
          data.coherence.forEach(function (e) {
            if (_this.params.metric === 'Alpha Coherence') {
              var value = _this.session.atlas.getCoherenceScore(e, 'alpha1');

              arr.push(value);
            }
          });
        }
        /* 
             HEG Neurofeedback
         */


        var hegMetrics = ['HEG Score'];

        if (hegMetrics.includes(_this.params.metric)) {
          data.heg.forEach(function (ch) {
            if (_this.params.metric === 'HEG Score') {
              arr.push(_this.session.atlas.getHEGRatioScore(ch));
            } else {
              arr.push(0);
            }
          });
        }
        /* 
             Custom Neurofeedback
         */


        if (_this.params.metric === 'Focus') {
          var frontalData = _this.session.atlas.getFrontalData();

          frontalData.forEach(function (ch) {
            arr.push(Math.min(1 / _this.session.atlas.getThetaBetaRatio(ch), 1));
          });
        }
      } catch (_unused) {
        console.error('input not compatible');
        arr.push(0);
      } // Output to User Data Object


      if (_this.params.output === 'Mean') u.value = _this.session.atlas.mean(arr);else u.value = arr;
      u.label = _this.params.metric;
    });
    return userData;
  };

  this.label = label;
  this.session = session;
  this.params = params; // Operator Configuration 

  this.paramOptions = {
    metric: {
      "default": 'Alpha Coherence',
      options: ['Alpha Coherence', 'Focus', 'Alpha Beta Ratio', 'Alpha Theta Ratio', 'Theta Beta Ratio', 'Alpha Ratio', 'Gamma Peak', 'Low Gamma Score', 'HEG Score']
    },
    output: {
      "default": 'Mean',
      options: ['Mean']
    }
  };
};
Neurofeedback.id = String(Math.floor(Math.random() * 1000000));
;// CONCATENATED MODULE: ./src/libraries/js/src/plugins/plugins.js






// EXTERNAL MODULE: ./node_modules/regenerator-runtime/runtime.js
var runtime = __webpack_require__(5666);
// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js
var injectStylesIntoStyleTag = __webpack_require__(3379);
var injectStylesIntoStyleTag_default = /*#__PURE__*/__webpack_require__.n(injectStylesIntoStyleTag);
// EXTERNAL MODULE: ./node_modules/css-loader/dist/cjs.js!./src/libraries/js/src/ui/styles/defaults.css
var defaults = __webpack_require__(2294);
;// CONCATENATED MODULE: ./src/libraries/js/src/ui/styles/defaults.css

            

var options = {};

options.insert = "head";
options.singleton = false;

var update = injectStylesIntoStyleTag_default()(defaults/* default */.Z, options);



/* harmony default export */ const styles_defaults = (defaults/* default.locals */.Z.locals || {});
;// CONCATENATED MODULE: ./src/libraries/js/src/ui/ObjectListener.js
function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function ObjectListener_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function ObjectListener_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function ObjectListener_createClass(Constructor, protoProps, staticProps) { if (protoProps) ObjectListener_defineProperties(Constructor.prototype, protoProps); if (staticProps) ObjectListener_defineProperties(Constructor, staticProps); return Constructor; }

/*
//Example:
let events = new ObjectListener();
let x = { y: 1, z: { w: 2 }}


events.addListener("y",x,"y");
events.addListener("z",x,"z");

x.z.w = 3;
x.y = 2;
//See console

*/
//By Joshua Brewster (MIT)
//Create instance and then call instance.addListener(listenerName,objectToListenTo,propToListenTo,onchange,interval).
//name, propToListenTo, onchange, and interval are optional (leave or set as undefined). Onchange is a custom callback just like for other event listeners. Set a name to make it easier to start and stop or edit each listener.
var ObjectListener = /*#__PURE__*/function () {
  function ObjectListener() {
    var _this = this;

    var debug = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

    ObjectListener_classCallCheck(this, ObjectListener);

    this.addFunc = function () {
      var key = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      var newCallback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
      var callbackIdx = null;

      if (newCallback !== null) {
        if (key === null) {
          _this.listeners.forEach(function (obj, i) {
            callbackIdx = obj.listener.addFunc(newCallback);
          });
        } else {
          var found = _this.listeners.find(function (o, i) {
            if (o.key === key) {
              callbackIdx = o.listener.addFunc(newCallback);
            }
          });
        }
      }

      return callbackIdx;
    };

    this.removeFuncs = function () {
      var key = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      var idx = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

      if (key === null) {
        _this.listeners.forEach(function (obj, i) {
          obj.listener.removeFuncs(idx);
        });
      } else {
        var found = _this.listeners.find(function (o, i) {
          if (o.key === key) {
            o.listener.removeFuncs(idx);
          }
        });
      }
    };

    this.debug = debug;
    this.listeners = [];
  } //add a new object listener with specified props (or none to watch the whole object), and onchange functions, with optional interval


  ObjectListener_createClass(ObjectListener, [{
    key: "addListener",
    value: function addListener() {
      var listenerKey = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      var objectToListenTo = arguments.length > 1 ? arguments[1] : undefined;
      var propToListenTo = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : undefined;
      var onchange = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : undefined;
      var interval = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : undefined;
      var debug = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : this.debug;

      if (objectToListenTo === undefined) {
        console.error("You must assign an object");
        return;
      }

      var key = listenerKey;

      if (key === null) {
        key = Math.floor(Math.random() * 100000);
      }

      var listener = {
        key: key,
        listener: new ObjectListenerInstance(objectToListenTo, propToListenTo, onchange, interval, debug)
      };
      this.listeners.push(listener);
    }
  }, {
    key: "hasKey",
    value: function hasKey(key) {
      var found = false;
      this.listeners.forEach(function (item, i) {
        if (item.key === key) {
          found = true;
          return true;
        }
      });
      return found;
    }
  }, {
    key: "getKeyIndices",
    value: function getKeyIndices(key) {
      var indices = [];
      this.listeners.find(function (o, i) {
        if (o.key === key) {
          indices.push(i);
        }
      });
      return indices;
    }
  }, {
    key: "onchange",
    value: function onchange() {
      var key = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      var newCallback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

      if (key === null) {
        this.listeners.forEach(function (obj, i) {
          obj.listener.onchange = newCallback;
        });
      } else {
        var found = this.listeners.find(function (o, i) {
          if (o.name === key) {
            o.listener.onchange = newCallback;
          }
        });
      }
    } //Add extra onchange functions

  }, {
    key: "stop",
    value: //Stop all or named listeners
    function stop() {
      var key = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

      if (key === null) {
        this.listeners.forEach(function (obj, i) {
          obj.listener.stop();
        });
      } else {
        var found = this.listeners.find(function (o, i) {
          if (o.name === key) {
            o.listener.stop();
          }
        });
      }
    } //Restart all or named listeners

  }, {
    key: "start",
    value: function start() {
      var key = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

      if (key === null) {
        this.listeners.forEach(function (obj, i) {
          obj.listener.start();
        });
      } else {
        var found = this.listeners.find(function (o, i) {
          if (o.name === key) {
            o.listener.start();
          }
        });
      }
    }
  }, {
    key: "remove",
    value: function remove() {
      var _this2 = this;

      var key = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

      if (key === null) {
        this.listeners.splice(0, this.listeners.length);
      } else {
        var indices = [];
        var found = this.listeners.forEach(function (o, i) {
          if (o.key === key) {
            indices.push(i);
          }
        });
        indices.reverse().forEach(function (idx) {
          _this2.listeners[idx].listener.stop();

          _this2.listeners.splice(idx, 1);
        });
      }
    }
  }]);

  return ObjectListener;
}(); //Instance of an object listener. This will subscribe to object properties (or whole objects) and run attached functions when a change is detected.

var ObjectListenerInstance = /*#__PURE__*/function () {
  function ObjectListenerInstance(object) {
    var _this3 = this;

    var propName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "__ANY__";
    var onchange = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.onchange;
    var interval = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : "FRAMERATE";
    var debug = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;

    ObjectListener_classCallCheck(this, ObjectListenerInstance);

    _initialiseProps.call(this);

    this.debug = debug;
    this.onchange = onchange; //Main onchange function

    this.onchangeFuncs = []; //Execute extra functions pushed to this array

    this.object = object; //Objects are always passed by reference

    this.propName = propName;
    this.propOld = undefined;
    this.setListenerRef(propName);
    this.running = true;
    this.interval;

    if (interval < 10) {
      this.interval = 10;
      console.log("Min recommended interval set: 10ms");
    } else {
      this.interval = interval;
    }

    if (typeof window === 'undefined') {
      setTimeout(function () {
        _this3.check();
      }, 60);
    } else {
      this.checker = requestAnimationFrame(this.check);
    }
  } //Main onchange execution


  ObjectListener_createClass(ObjectListenerInstance, [{
    key: "removeFuncs",
    value: //Remove extra onchange functions
    function removeFuncs() {
      var idx = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

      if (idx === null) {
        this.onchangeFuncs = [];
      } else if (this.onchangeFuncs[idx] !== undefined) {
        this.onchangeFuncs.splice(idx, 1);
      }
    } //Execute extra onchange functions

  }, {
    key: "start",
    value: function start() {
      var _this4 = this;

      this.running = true;

      if (typeof window === 'undefined') {
        setTimeout(function () {
          _this4.check();
        }, 16);
      } else {
        this.checker = requestAnimationFrame(this.check);
      }
    }
  }, {
    key: "stop",
    value: function stop() {
      this.running = false;
      cancelAnimationFrame(this.checker);
    }
  }]);

  return ObjectListenerInstance;
}(); //This only really matters in Chrome and one other browser

var _initialiseProps = function _initialiseProps() {
  var _this5 = this;

  this.onchange = function (newData) {
    console.log(_this5.propName, " changed from: ", _this5.propOld, " to: ", _this5.object[_this5.propName]);
  };

  this.addFunc = function () {
    var onchange = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

    if (onchange !== null) {
      _this5.onchangeFuncs.push(onchange);
    }

    return _this5.onchangeFuncs.length - 1;
  };

  this.onchangeMulti = function (newData) {
    var onChangeCache = _toConsumableArray(_this5.onchangeFuncs);

    onChangeCache.forEach(function (func, i) {
      if (_this5.debug === true) {
        console.log(func);
      }

      func(newData);
    });
  };

  this.setListenerRef = function (propName) {
    if (propName === "__ANY__" || propName === null || propName === undefined) {
      _this5.propOld = JSON.stringifyFast(_this5.object);
    } else if (Array.isArray(_this5.object[propName])) {
      _this5.propOld = JSON.stringifyFast(_this5.object[propName].slice(_this5.object[propName].length - 20));
    } else if (_typeof(_this5.object[propName]) === "object") {
      _this5.propOld = JSON.stringifyFast(_this5.object[propName]);
    } else if (typeof _this5.object[propName] === "function") {
      _this5.propOld = _this5.object[propName].toString();
    } else {
      _this5.propOld = _this5.object[propName]; //usually a number, bool, or string;
    }

    if (_this5.debug === true) {
      console.log("propname", propName, ", new assignment: ", _this5.propOld);
    }
  };

  this.check = function () {
    if (_this5.propName === "__ANY__" || _this5.propName === null || _this5.propName === undefined) {
      if (_this5.propOld !== JSON.stringifyFast(_this5.object)) {
        if (_this5.debug === true) {
          console.log("onchange: ", _this5.onchange);
        }

        _this5.onchange(_this5.object);

        if (_this5.onchangeFuncs.length > 0) {
          _this5.onchangeMulti(_this5.object);
        }

        _this5.setListenerRef(_this5.propName);
      }
    } else if (Array.isArray(_this5.object[_this5.propName])) {
      //cut arrays down for speed
      if (_this5.propOld !== JSON.stringifyFast(_this5.object[_this5.propName].slice(_this5.object[_this5.propName].length - 20))) {
        if (_this5.debug === true) {
          console.log("onchange: ", _this5.onchange);
        }

        _this5.onchange(_this5.object[_this5.propName]);

        if (_this5.onchangeFuncs.length > 0) {
          _this5.onchangeMulti(_this5.object[_this5.propName]);
        }

        _this5.setListenerRef(_this5.propName);
      }
    } else if (_typeof(_this5.object[_this5.propName]) === "object") {
      var string = JSON.stringifyFast(_this5.object[_this5.propName]);

      if (_this5.propOld !== string) {
        if (_this5.debug === true) {
          console.log("onchange: ", _this5.onchange);
        }

        _this5.onchange(_this5.object[_this5.propName]);

        if (_this5.onchangeFuncs.length > 0) {
          _this5.onchangeMulti(_this5.object[_this5.propName]);
        }

        _this5.setListenerRef(_this5.propName);
      }
    } else if (typeof _this5.object[_this5.propName] === "function") {
      if (_this5.propOld !== _this5.object[_this5.propName].toString()) {
        if (_this5.debug === true) {
          console.log("onchange: ", _this5.onchange);
        }

        _this5.onchange(_this5.object[_this5.propName].toString());

        if (_this5.onchangeFuncs.length > 0) {
          _this5.onchangeMulti(_this5.object[_this5.propName].toString());
        }

        _this5.setListenerRef(_this5.propName);
      }
    } else if (_this5.object[_this5.propName] !== _this5.propOld) {
      if (_this5.debug === true) {
        console.log("onchange: ", _this5.onchange);
      }

      _this5.onchange(_this5.object[_this5.propName]);

      if (_this5.onchangeFuncs.length > 0) {
        _this5.onchangeMulti(_this5.object[_this5.propName]);
      }

      _this5.setListenerRef(_this5.propName);
    }

    if (_this5.running === true) {
      if (_this5.debug === true) {
        console.log("checking", _this5.object, _this5.propName);
      }

      if (_this5.interval === "FRAMERATE") {
        if (typeof window === 'undefined') {
          setTimeout(function () {
            _this5.check();
          }, 16);
        } else {
          _this5.checker = requestAnimationFrame(_this5.check);
        }
      } else {
        setTimeout(function () {
          _this5.check();
        }, _this5.interval);
      }
    }

    ;
  };
};

function sortObjectByValue(object) {
  //Sorts number and string objects by numeric value. Strings have charcodes summed for comparison. Objects and functions are stringified.
  var sortable = [];

  for (var prop in object) {
    sortable.push([prop, object[prop]]);
  }

  sortable.sort(function (a, b) {
    var prop1 = a;
    var prop2 = b;

    if (typeof prop1[1] === "function") {
      prop1[1] = prop1[1].toString();
    } else if (_typeof(prop1[1]) === "object") {
      prop1[1] = JSON.stringifyFast(prop1[1]);
    }

    if (typeof prop2[1] === "function") {
      prop2[1] = prop2[1].toString();
    } else if (_typeof(prop2[1]) === "object") {
      prop2[1] = JSON.stringifyFast(prop2[1]);
    }

    if (typeof prop1[1] === "string") {
      var temp = 0;
      prop1.forEach(function (_char, i) {
        temp += prop1.charCodeAt(i);
      });
      prop1 = temp;
    }

    if (typeof prop2[1] === "string") {
      var temp = 0;
      prop2.forEach(function (_char2, i) {
        temp += prop2.charCodeAt(i);
      });
      prop2 = temp;
    }

    return prop1[1] - prop2[1];
  });
  var sorted = {};
  sortable.forEach(function (item) {
    sorted[item[0]] = item[1];
  });
  return sorted;
}
function sortObjectByPropName(object) {
  var sortable = [];

  for (var prop in object) {
    sortable.push([prop, object[prop]]);
  }

  sortable.sort(function (a, b) {
    return a[0] > b[0];
  });
  var sorted = {};
  sortable.forEach(function (item) {
    sorted[item[0]] = item[1];
  });
  return sorted;
} //modified to also cut down the size arrays for faster looping

if (JSON.stringifyFast === undefined) {
  //Workaround for objects containing DOM nodes, which can't be stringified with JSON. From: https://stackoverflow.com/questions/4816099/chrome-sendrequest-error-typeerror-converting-circular-structure-to-json
  JSON.stringifyFast = function () {
    var refs = new Map();
    var parents = [];
    var path = ["this"];

    function clear() {
      refs.clear();
      parents.length = 0;
      path.length = 1;
    }

    function updateParents(key, value) {
      //for json.parse
      var idx = parents.length - 1;
      var prev = parents[idx];

      if (prev[key] === value || idx === 0) {
        path.push(key);
        parents.push(value);
      } else {
        while (idx-- >= 0) {
          prev = parents[idx];

          if (prev[key] === value) {
            idx += 2;
            parents.length = idx;
            path.length = idx;
            --idx;
            parents[idx] = value;
            path[idx] = key;
            break;
          }
        }
      }
    }

    function checkValues(key, value) {
      var val = value;

      if (val !== null) {
        if (_typeof(value) === "object") {
          //if (key) { updateParents(key, value); }
          var other = refs.get(val);
          var c = value.constructor.name;

          if (other) {
            return '[Circular Reference]' + other;
          } else if (c === "Array" && value.length > 20) {
            //Cut arrays down to 100 samples for referencing
            val = value.slice(value.length - 20);
            refs.set(val, path.join('.'));
          } else if (c !== "Object" && c !== "Number" && c !== "String" && c !== "Boolean") {
            //simplify classes, objects, and functions, point to nested objects for the state manager to monitor those properly
            val = "instanceof_" + c;
            refs.set(val, path.join('.'));
          } else if (_typeof(val) === 'object') {
            var obj = {};

            for (var prop in val) {
              if (Array.isArray(val[prop])) {
                obj[prop] = val[prop].slice(val[prop].length - 20);
              } //deal with arrays in nested objects (e.g. means, slices)
              else {
                  obj[prop] = val[prop];
                }
            }
          } else {
            refs.set(val, path.join('.'));
          }
        }
      }

      return val;
    }

    return function stringifyFast(obj, space) {
      try {
        parents.push(obj);
        return JSON.stringify(obj, checkValues, space);
      } finally {
        clear();
      }
    };
  }();
}
;// CONCATENATED MODULE: ./src/libraries/js/src/ui/DOMFragment.js
function DOMFragment_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { DOMFragment_typeof = function _typeof(obj) { return typeof obj; }; } else { DOMFragment_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return DOMFragment_typeof(obj); }

function DOMFragment_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function DOMFragment_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function DOMFragment_createClass(Constructor, protoProps, staticProps) { if (protoProps) DOMFragment_defineProperties(Constructor.prototype, protoProps); if (staticProps) DOMFragment_defineProperties(Constructor, staticProps); return Constructor; }

 //By Joshua Brewster (MIT)

/* 
const htmlprops;

function templateStringGen(props) {
    return `
    <div id=`+props.id+`>Clickme</div>
    `;
}

function onRender() {
    document.getElementById(htmlprops.id).onclick = () => { document.getElementById(htmlprops.id).innerHTML = "Clicked!"; }
}

function onChange() {
  console.log('props changed!');
}

const fragment = new DOMFragment(templateStringGen,document.body,htmlprops,onRender,onChange,"NEVER"); 
//Renders a static DOM fragment to the given parent node. 
// Change propUpdateInterval to "FRAMERATE" or any millisecond value and add an 
// onchange function to have the html re-render when the props update and have an 
// additional function fire.

*/

var DOMFragment_DOMFragment = /*#__PURE__*/function () {
  /**
   * @ignore
   * @constructor
   * @alias DOMFragment
   * @description Create a DOM fragment.
   * @param {function} templateStringGen - Function to generate template string.
   * @param {HTMLElement} parentNode HTML DOM node to append fragment into.
   * @param {callback} onRender Callback when element is rendered.
   * @param {callback} onchange Callback when element is changed.
   * @param {int} propUpdateInterval How often to update properties.
   */
  function DOMFragment() {
    var _this = this;

    var templateStringGen = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.templateStringGen;
    var parentNode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.body;
    var props = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
    var onRender = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function (props) {};
    var onchange = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : function (props) {};
    var propUpdateInterval = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : "NEVER";

    DOMFragment_classCallCheck(this, DOMFragment);

    this.onchange = function () {
      var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _this.renderSettings.props;
    };

    this.onRender = function () {
      var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _this.renderSettings.props;
    };

    this.onRender = onRender;
    this.onchange = onchange;
    this.parentNode = parentNode;

    if (typeof parentNode === "string") {
      this.parentNode = document.getElementById(parentNode);
    }

    this.renderSettings = {
      templateStringGen: templateStringGen,
      props: props
    };
    this.templateString = "";

    if (typeof templateStringGen === 'function') {
      this.templateString = templateStringGen(props);
    } else {
      this.templateString = templateStringGen;
    }

    var interval = propUpdateInterval;

    if (this.renderSettings.props === {}) {
      interval = "NEVER";
    }

    this.node = null;
    this.listener = undefined;

    if (Object.keys(this.renderSettings.props).length > 0 && !(interval === null || interval === undefined || interval === "NEVER")) {
      console.log("making listeners for ", templateStringGen);
      this.listener = new ObjectListener();

      var templateChange = function templateChange() {
        _this.updateNode();
      };

      this.listener.addListener('templateChange', this.renderSettings, 'templateStringGen', templateChange, interval);

      var propsChange = function propsChange() {
        _this.updateNode();

        _this.onchange();
      };

      this.listener.addListener('props', this.renderSettings, 'props', propsChange, interval);
    }

    this.renderNode();
  }

  DOMFragment_createClass(DOMFragment, [{
    key: "appendFragment",
    value: //appendId is the element Id you want to append this fragment to
    function appendFragment(HTMLtoAppend, parentNode) {
      var template = document.createElement('template');
      template.innerHTML = HTMLtoAppend;
      var fragment = template.content;
      parentNode.appendChild(fragment);
      return parentNode.children[parentNode.children.length - 1];
    } //delete selected fragment. Will delete the most recent fragment if Ids are shared.

  }, {
    key: "deleteFragment",
    value: function deleteFragment(parentNode, nodeId) {
      var node = document.getElementById(nodeId);
      parentNode.removeChild(node);
    } //Remove Element Parent By Element Id (for those pesky anonymous child fragment containers)

  }, {
    key: "removeParent",
    value: function removeParent(elementId) {
      // Removes an element from the document
      var element = document.getElementById(elementId);
      element.parentNode.parentNode.removeChild(element.parentNode);
    }
  }, {
    key: "renderNode",
    value: function renderNode() {
      var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.parentNode;
      this.node = this.appendFragment(this.templateString, parentNode);
      this.onRender();
    }
  }, {
    key: "updateNode",
    value: function updateNode() {
      var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.parentNode;
      var node = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.node;
      var props = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.props;
      parentNode.removeChild(node);

      if (typeof this.renderSettings.templateStringGen === 'function') {
        this.templateString = this.renderSettings.templateStringGen(this.props);
      } else {
        this.templateString = this.renderSettings.templateStringGen;
      }

      this.renderNode(parentNode, props);
    }
  }, {
    key: "deleteNode",
    value: function deleteNode() {
      var node = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.node;

      if (typeof node === "string") {
        thisNode = document.getElementById(node);
        thisNode.parentNode.removeChild(thisNode);
        this.node = null;
      } else if (DOMFragment_typeof(node) === "object") {
        node.parentNode.removeChild(node);
        this.node = null;
      }
    } //Add a scoped stylesheet after begin

  }, {
    key: "appendStylesheet",
    value: function appendStylesheet() {
      var styles = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
      var node = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.node;

      if (typeof styles === 'string') {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.type = "text/css";
        link.href = styles;
        node.insertAdjacentElement('afterbegin', link);
      } else if (Array.isArray(styles)) {
        styles.forEach(function (style) {
          var link = document.createElement('link');
          link.rel = "stylesheet";
          link.type = "text/css";
          link.href = style;
          node.insertAdjacentElement('afterbegin', link);
        });
      } else if (typeof styles === 'function') {
        var stylehtml = styles();
        node.insertAdjacentHTML('afterbegin', stylehtml);
      }
    }
  }]);

  return DOMFragment;
}();
;// CONCATENATED MODULE: ./src/libraries/js/src/ui/StateManager.js
function StateManager_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { StateManager_typeof = function _typeof(obj) { return typeof obj; }; } else { StateManager_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return StateManager_typeof(obj); }

function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = StateManager_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }

function StateManager_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return StateManager_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return StateManager_arrayLikeToArray(o, minLen); }

function StateManager_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function StateManager_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function StateManager_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function StateManager_createClass(Constructor, protoProps, staticProps) { if (protoProps) StateManager_defineProperties(Constructor.prototype, protoProps); if (staticProps) StateManager_defineProperties(Constructor, staticProps); return Constructor; }

 //By Joshua Brewster (MIT)
//Simple state manager.
//Set key responses to have functions fire when keyed values change
//add variables to state with addToState(key, value, keyonchange (optional))

var StateManager = /*#__PURE__*/function () {
  function StateManager() {
    var init = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var interval = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "FRAMERATE";

    StateManager_classCallCheck(this, StateManager);

    //Default interval is at the browser framerate
    this.data = init;
    this.interval = interval;
    this.pushToState = {};
    this.prev = Object.assign({}, this.data);
    this.update = {
      added: '',
      removed: '',
      buffer: new Set()
    };
    this.listener = new ObjectListener();
    /*
    const onStateChanged = () => {
        this.prev = Object.assign({},this.data);
        //this.prev=JSON.parse(JSON.stringifyFast(this.data));
    }
     //Causes app to be stuck on startup
    this.listener.addListener(
        "state",
        this.data,
        "__ANY__",
        onStateChanged,
        interval,
    );
    */
  }

  StateManager_createClass(StateManager, [{
    key: "setInterval",
    value: function setInterval() {
      var _this = this;

      var interval = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "FRAMERATE";
      this.interval = interval;
      this.listener.listeners.forEach(function (obj, i) {
        obj.interval = _this.interval;
      });
    } // Managed State Updates. Must Still Clean Event Listeners

  }, {
    key: "updateState",
    value: function updateState(key, value) {
      if (this.data[key] == null) {
        this.addToState(key, value);
      } else {
        this.data[key] = value;
      }
    }
  }, {
    key: "removeState",
    value: function removeState(key) {
      this.unsubscribeAll(key);
      delete this.data[key]; // Log Update

      this.update.removed = key;
      this.update.buffer.add(key);
    } //Alternatively just add to the state by doing this.state[key] = value with the state manager instance

  }, {
    key: "addToState",
    value: function addToState(key, value) {
      var _this2 = this;

      var onchange = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
      var debug = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;

      if (!this.listener.hasKey('push')) {
        //we won't add this listener unless we use this function
        var pushToStateResponse = function pushToStateResponse() {
          if (Object.keys(_this2.pushToState).length > 0) {
            Object.assign(_this2.prev, _this2.data); //Temp fix until the global state listener function works as expected

            Object.assign(_this2.data, _this2.pushToState); //console.log("new state: ", this.data); console.log("props set: ", this.pushToState);

            var _iterator = _createForOfIteratorHelper(Object.getOwnPropertyNames(_this2.pushToState)),
                _step;

            try {
              for (_iterator.s(); !(_step = _iterator.n()).done;) {
                var prop = _step.value;
                delete _this2.pushToState[prop];
              }
            } catch (err) {
              _iterator.e(err);
            } finally {
              _iterator.f();
            }
          }
        };

        this.listener.addListener("push", this.pushToState, "__ANY__", pushToStateResponse, this.interval);
      }

      this.data[key] = value; // Log Update

      this.update.added = key;
      this.update.buffer.add(key);

      if (onchange !== null) {
        return this.addSecondaryKeyResponse(key, onchange, debug);
      }
    }
  }, {
    key: "getState",
    value: function getState() {
      //Return a hard copy of the latest state with reduced values
      return JSON.parse(JSON.stringifyFast(this.data));
    }
  }, {
    key: "setState",
    value: function setState() {
      var updateObj = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      //Pass object with keys in. Undefined keys in state will be added automatically. State only notifies of change based on update interval
      //console.log("setting state");
      Object.assign(this.pushToState, updateObj);
      return this.pushToState;
    } //Set main onchange response for the property-specific object listener. Don't touch the state

  }, {
    key: "setPrimaryKeyResponse",
    value: function setPrimaryKeyResponse() {
      var key = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      var onchange = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
      var debug = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

      if (onchange !== null) {
        if (this.listener.hasKey(key)) {
          this.listener.onchange(key, onchange);
        } else if (key !== null) {
          this.listener.addListener(key, this.data, key, onchange, this.data["stateUpdateInterval"], debug);
        }
      }
    } //Add extra onchange responses to the object listener for a set property. Use state key for state-wide change responses

  }, {
    key: "addSecondaryKeyResponse",
    value: function addSecondaryKeyResponse() {
      var key = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      var onchange = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
      var debug = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

      if (onchange !== null) {
        if (this.listener.hasKey(key)) {
          return this.listener.addFunc(key, onchange);
        } else if (key !== null) {
          this.listener.addListener(key, this.data, key, function () {}, this.data["stateUpdateInterval"], debug);
          return this.listener.addFunc(key, onchange);
        } else {
          return this.listener.addFunc("state", onchange);
        }
      }
    } //removes all secondary responses if idx left null. use "state" key for state-wide change responses

  }, {
    key: "removeSecondaryKeyResponse",
    value: function removeSecondaryKeyResponse() {
      var key = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      var responseIdx = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

      if (key !== null) {
        if (this.listener.hasKey(key)) {
          this.listener.removeFuncs(key, responseIdx);
        }
      } else {
        console.error("provide key");
      }
    } //Remove any extra object listeners for a key. Entering "state" will break the state manager's primary response

  }, {
    key: "clearAllKeyResponses",
    value: function clearAllKeyResponses() {
      var key = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      if (this.listener.hasKey(key)) this.listener.remove(key);
    } //Save the return value to provide as the responseIdx in unsubscribe

  }, {
    key: "subscribe",
    value: function subscribe(key, onchange) {
      if (this.data[key] === undefined) {
        this.addToState(key, null, onchange);
      } else {
        return this.addSecondaryKeyResponse(key, onchange);
      }
    } //Unsubscribe from the given key using the index of the response saved from the subscribe() function

  }, {
    key: "unsubscribe",
    value: function unsubscribe(key) {
      var responseIdx = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
      if (responseIdx !== null) this.removeSecondaryKeyResponse(key, responseIdx);else console.error("Specify a subcription function index");
    }
  }, {
    key: "unsubscribeAll",
    value: function unsubscribeAll(key) {
      // Removes the listener for the key (including the animation loop)
      this.clearAllKeyResponses(key);
    }
  }]);

  return StateManager;
}(); //modified to also cut down the size arrays for faster looping

if (JSON.stringifyFast === undefined) {
  //Workaround for objects containing DOM nodes, which can't be stringified with JSON. From: https://stackoverflow.com/questions/4816099/chrome-sendrequest-error-typeerror-converting-circular-structure-to-json
  JSON.stringifyFast = function () {
    var refs = new Map();
    var parents = [];
    var path = ["this"];

    function clear() {
      refs.clear();
      parents.length = 0;
      path.length = 1;
    }

    function updateParents(key, value) {
      //for json.parse
      var idx = parents.length - 1;
      var prev = parents[idx];

      if (prev[key] === value || idx === 0) {
        path.push(key);
        parents.push(value);
      } else {
        while (idx-- >= 0) {
          prev = parents[idx];

          if (prev[key] === value) {
            idx += 2;
            parents.length = idx;
            path.length = idx;
            --idx;
            parents[idx] = value;
            path[idx] = key;
            break;
          }
        }
      }
    }

    function checkValues(key, value) {
      var val = value;

      if (val !== null) {
        if (StateManager_typeof(value) === "object") {
          //if (key) { updateParents(key, value); }
          var other = refs.get(val);
          var c = value.constructor.name;

          if (other) {
            return '[Circular Reference]' + other;
          } else if (c === "Array" && value.length > 20) {
            //Cut arrays down to 100 samples for referencing
            val = value.slice(value.length - 20);
            refs.set(val, path.join('.'));
          } else if (c !== "Object" && c !== "Number" && c !== "String" && c !== "Boolean") {
            //simplify classes, objects, and functions, point to nested objects for the state manager to monitor those properly
            val = "instanceof_" + c;
            refs.set(val, path.join('.'));
          } else if (StateManager_typeof(val) === 'object') {
            var obj = {};

            for (var prop in val) {
              if (Array.isArray(val[prop])) {
                obj[prop] = val[prop].slice(val[prop].length - 20);
              } //deal with arrays in nested objects (e.g. means, slices)
              else {
                  obj[prop] = val[prop];
                }
            }
          } else {
            refs.set(val, path.join('.'));
          }
        }
      }

      return val;
    }

    return function stringifyFast(obj, space) {
      try {
        parents.push(obj);
        return JSON.stringify(obj, checkValues, space);
      } finally {
        clear();
      }
    };
  }();
}
// EXTERNAL MODULE: ./node_modules/web-worker/cjs/browser.js
var browser = __webpack_require__(4763);
var browser_default = /*#__PURE__*/__webpack_require__.n(browser);
;// CONCATENATED MODULE: ./src/libraries/js/src/Workers.js
function Workers_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }


var defaultWorkerThreads = 2;
var eegWorkers = [];

for (var i = 0; i < defaultWorkerThreads; i++) {
  eegWorkers.push(new (browser_default())(new URL(/* worker import */ __webpack_require__.p + __webpack_require__.u(3), __webpack_require__.b), {
    name: 'eegworker_' + i,
    type: undefined
  }));
}

var WorkerManager = function WorkerManager() {
  var _this = this;

  Workers_classCallCheck(this, WorkerManager);

  Workers_initialiseProps.call(this);

  this.workerResponses = [];
  this.workers = [];
  this.workerThreads = defaultWorkerThreads;
  this.workerThreadrot = 0; // Setup EEG Workers

  try {
    for (var i = 0; i < eegWorkers.length; i++) {
      eegWorkers[i].onmessage = function (e) {
        var msg = e.data; //console.log(msg)
        //window.receivedMsg(msg);

        _this.workerResponses.forEach(function (foo, i) {
          foo(msg);
        });
      };

      this.workers.push(eegWorkers[i]);
    }

    console.log("worker threads: ", this.workers.length);
  } catch (err) {
    console.error(err);
  }
};

var Workers_initialiseProps = function _initialiseProps() {
  var _this2 = this;

  this.addWorker = function (workerurl) {
    console.log('add worker');

    try {
      _this2.workers.push(new (browser_default())(workerurl, //new URL(workerurl, import.meta.url),
      {
        name: 'eegworker_' + _this2.workers.length,
        type: 'module'
      }));

      _this2.workers[i].onmessage = function (e) {
        var msg = e.data; //console.log(msg)
        //window.receivedMsg(msg);

        _this2.workerResponses.forEach(function (foo, i) {
          foo(msg);
        });
      };

      console.log("worker threads: ", _this2.workers.length);
      return _this2.workers.length - 1; //index
    } catch (err) {
      console.log(err);
    }
  };

  this.postToWorker = function (input) {
    var workeridx = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

    if (workeridx === null) {
      _this2.workers[_this2.workerThreadrot].postMessage(input);

      if (_this2.workerThreads > 1) {
        _this2.workerThreadrot++;

        if (_this2.workerThreadrot >= _this2.workerThreads) {
          _this2.workerThreadrot = 0;
        }
      }
    } else {
      _this2.workers[workeridx].postMessage(input);
    }
  };
};
;// CONCATENATED MODULE: ./src/libraries/js/src/DataAtlas.js
function DataAtlas_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { DataAtlas_typeof = function _typeof(obj) { return typeof obj; }; } else { DataAtlas_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return DataAtlas_typeof(obj); }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function DataAtlas_toConsumableArray(arr) { return DataAtlas_arrayWithoutHoles(arr) || DataAtlas_iterableToArray(arr) || DataAtlas_unsupportedIterableToArray(arr) || DataAtlas_nonIterableSpread(); }

function DataAtlas_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function DataAtlas_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return DataAtlas_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return DataAtlas_arrayLikeToArray(o, minLen); }

function DataAtlas_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function DataAtlas_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return DataAtlas_arrayLikeToArray(arr); }

function DataAtlas_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function DataAtlas_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function DataAtlas_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function DataAtlas_createClass(Constructor, protoProps, staticProps) { if (protoProps) DataAtlas_defineProperties(Constructor.prototype, protoProps); if (staticProps) DataAtlas_defineProperties(Constructor, staticProps); return Constructor; }

//relies on eegworker (see implementation in public/index.html)
//Joshua Brewster, Garrett Flynn GPL (copyleft)

 //-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------

var DataAtlas_DataAtlas = /*#__PURE__*/function () {
  /**
      * @constructor
   * @alias DataAtlas
      * @description Class for organizing data and automating analysis protocols.
      */
  function DataAtlas() //'eegfft','eegcoherence','bcijs_bandpowers','heg_pulse'
  {
    var _this = this;

    var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "atlas";
    var initialData = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
      eegshared: {
        eegChannelTags: [{
          ch: 0,
          tag: 'FP1',
          analyze: true
        }, {
          ch: 1,
          tag: 'FP2',
          analyze: true
        }],
        sps: 512
      }
    };
    var config = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '10_20';
    var useCoherence = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;
    var useAnalyzer = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;
    var analysis = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : ['eegfft'];

    DataAtlas_classCallCheck(this, DataAtlas);

    this.getDeviceDataByTag = function () {
      var device = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'eeg';
      var tag = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'FP1';
      //put eegshared for device to get shared info
      var found = undefined;

      if (typeof tag === 'number' && device === 'eeg') {
        var r = _this.data[device + "shared"][device + "ChannelTags"].find(function (o, i) {
          if (o.ch === tag && o.tag !== null) {
            tag = o.tag; //you can search for eeg data by channel number as well

            return true;
          }
        }); //console.log(tag)

      }

      if (device.indexOf("shared") < 0) {
        var atlasCoord = _this.data[device].find(function (o, i) {
          if (o.tag === tag) {
            found = o;
            return true;
          }
        });

        return found; //return shared data structs	
      } else if (tag === null || tag === 'all') {
        return _this.data[device]; //return all device data structs	
      } else if (typeof tag === 'string' || typeof tag === 'number') {
        var _r = _this.data[device].find(function (o, i) {
          if (o.tag === tag) {
            found = o;
            return true;
          }
        });

        return found; //return tagged data struct
      } else {
        return found; //return undefined	
      }
    };

    this.getEEGDataByChannel = function () {
      var ch = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      var found = undefined;
      if (typeof ch === 'string') ch = parseInt(ch);

      var search = _this.data.eegshared.eegChannelTags.find(function (o, i) {
        if (o.ch === ch) {
          if (o.tag === null || o.tag === 'other') {
            found = _this.getEEGDataByTag(o.ch);
          } else {
            found = _this.getEEGDataByTag(o.tag);
          }

          if (found !== false) return true;
        }
      });

      return found;
    };

    this.getEEGDataByTag = function () {
      var tag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "FP1";
      var found = undefined;
      var regex = new RegExp(tag, 'i');

      var atlasCoord = _this.data.eeg.find(function (o, i) {
        if (regex.test(o.tag) || o.ch === parseInt(tag)) {
          found = o;
          return true;
        }
      });

      return found;
    };

    this.getCoherenceByTag = function () {
      var tag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "FP1::FZ";
      var found = undefined;

      var atlasCoord = _this.data.coherence.find(function (o, i) {
        if (o.tag === tag) {
          found = o;
          return true;
        }
      });

      return found;
    };

    this.getLatestFFTData = function () {
      var tag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : undefined;
      var dat = [];

      _this.data.eegshared.eegChannelTags.forEach(function (r, i) {
        if (tag) {
          if (tag === r.tag || parseInt(tag) === r.ch) {
            if (r.analyze === true) {
              var row = _this.getEEGDataByTag(r.tag);

              if (row.fftCount === 0) {
                dat.push({
                  tag: row.tag,
                  fftCount: row.fftCount
                });
              } else {
                var lastIndex = row.fftCount - 1;
                dat.push({
                  tag: row.tag,
                  fftCount: row.fftCount,
                  time: row.fftTimes[lastIndex],
                  fft: row.ffts[lastIndex],
                  slice: {
                    scp: row.slices.scp[lastIndex],
                    delta: row.slices.delta[lastIndex],
                    theta: row.slices.theta[lastIndex],
                    alpha1: row.slices.alpha1[lastIndex],
                    alpha2: row.slices.alpha2[lastIndex],
                    beta: row.slices.beta[lastIndex],
                    lowgamma: row.slices.lowgamma[lastIndex],
                    highgamma: row.slices.highgamma[lastIndex]
                  },
                  mean: {
                    scp: row.means.scp[lastIndex],
                    delta: row.means.delta[lastIndex],
                    theta: row.means.theta[lastIndex],
                    alpha1: row.means.alpha1[lastIndex],
                    alpha2: row.means.alpha2[lastIndex],
                    beta: row.means.beta[lastIndex],
                    lowgamma: row.means.lowgamma[lastIndex],
                    highgamma: row.means.highgamma[lastIndex]
                  }
                });
              }
            }
          }
        } else if (r.analyze === true) {
          var _row = _this.getEEGDataByTag(r.tag);

          if (_row.fftCount === 0) {
            dat.push({
              tag: _row.tag,
              fftCount: _row.fftCount
            });
          } else {
            //console.log(row);
            var _lastIndex = _row.fftCount - 1;

            dat.push({
              tag: _row.tag,
              fftCount: _row.fftCount,
              time: _row.fftTimes[_lastIndex],
              fft: _row.ffts[_lastIndex],
              slice: {
                scp: _row.slices.scp[_lastIndex],
                delta: _row.slices.delta[_lastIndex],
                theta: _row.slices.theta[_lastIndex],
                alpha1: _row.slices.alpha1[_lastIndex],
                alpha2: _row.slices.alpha2[_lastIndex],
                beta: _row.slices.beta[_lastIndex],
                lowgamma: _row.slices.lowgamma[_lastIndex],
                highgamma: _row.slices.highgamma[_lastIndex]
              },
              mean: {
                scp: _row.means.scp[_lastIndex],
                delta: _row.means.delta[_lastIndex],
                theta: _row.means.theta[_lastIndex],
                alpha1: _row.means.alpha1[_lastIndex],
                alpha2: _row.means.alpha2[_lastIndex],
                beta: _row.means.beta[_lastIndex],
                lowgamma: _row.means.lowgamma[_lastIndex],
                highgamma: _row.means.highgamma[_lastIndex]
              }
            });
          }
        }
      });

      return dat;
    };

    this.getLatestCoherenceData = function () {
      var tag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : undefined;
      var dat = [];

      _this.data.coherence.forEach(function (row, i) {
        if (tag) {
          if (row.tag === tag) {
            var lastIndex = row.fftCount - 1;
            dat.push({
              tag: row.tag,
              fftCount: row.fftCount,
              time: row.times[lastIndex],
              fft: row.ffts[lastIndex],
              slice: {
                scp: row.slices.scp[lastIndex],
                delta: row.slices.delta[lastIndex],
                theta: row.slices.theta[lastIndex],
                alpha1: row.slices.alpha1[lastIndex],
                alpha2: row.slices.alpha2[lastIndex],
                beta: row.slices.beta[lastIndex],
                gamma: row.slices.gamma[lastIndex]
              },
              mean: {
                scp: row.means.scp[lastIndex],
                delta: row.means.delta[lastIndex],
                theta: row.means.theta[lastIndex],
                alpha1: row.means.alpha1[lastIndex],
                alpha2: row.means.alpha2[lastIndex],
                beta: row.means.beta[lastIndex],
                gamma: row.means.gamma[lastIndex]
              }
            });
          }
        } else {
          var _lastIndex2 = row.fftCount - 1;

          dat.push({
            tag: row.tag,
            fftCount: row.fftCount,
            time: row.times[_lastIndex2],
            fft: row.ffts[_lastIndex2],
            slice: {
              scp: row.slices.scp[_lastIndex2],
              delta: row.slices.delta[_lastIndex2],
              theta: row.slices.theta[_lastIndex2],
              alpha1: row.slices.alpha1[_lastIndex2],
              alpha2: row.slices.alpha2[_lastIndex2],
              beta: row.slices.beta[_lastIndex2],
              gamma: row.slices.gamma[_lastIndex2]
            },
            mean: {
              scp: row.means.scp[_lastIndex2],
              delta: row.means.delta[_lastIndex2],
              theta: row.means.theta[_lastIndex2],
              alpha1: row.means.alpha1[_lastIndex2],
              alpha2: row.means.alpha2[_lastIndex2],
              beta: row.means.beta[_lastIndex2],
              gamma: row.means.gamma[_lastIndex2]
            }
          });
        }
      });

      return dat;
    };

    this.getFrontalData = function () {
      var frontalData = [];

      if (_this.settings.eeg) {
        var regex = new RegExp('([F]|[F][A-Za-z]|[A-Za-z][F])([0-9]|[0-9][0-9])', 'i');

        var frontalTags = _this.data.eegshared.eegChannelTags.filter(function (_ref) {
          var tag = _ref.tag;
          return tag.match(regex);
        });

        frontalTags.forEach(function (o) {
          frontalData.push(_this.getEEGDataByTag(o.tag));
        });
      }

      return frontalData;
    };

    this.getFrontalCoherenceData = function () {
      var coherenceData = [];

      if (_this.settings.coherence) {
        var regex = new RegExp('([F]|[F][A-Za-z]|[A-Za-z][F])([0-9]|[0-9][0-9])', 'i');

        var frontalTags = _this.data.eegshared.eegChannelTags.filter(function (_ref2) {
          var tag = _ref2.tag;
          return tag.match(regex);
        });

        frontalTags.forEach(function (o, i) {
          for (var j = i + 1; j < frontalTags.length; j++) {
            coherenceData.push(_this.getCoherenceByTag("".concat(o.tag, "::").concat(frontalTags[j].tag)));
          }
        });
      }

      return coherenceData;
    };

    this.getCNCoherenceData = function () {
      var coh_ref_ch = undefined;

      if (_this.settings.coherence) {
        coh_ref_ch = _this.getCoherenceByTag('C3_C4');

        if (coh_ref_ch === undefined) {
          coh_ref_ch = _this.getCoherenceByTag('C4_C3');
        }
      }

      return coh_ref_ch;
    };

    this.getCNData = function () {
      var cns_data = undefined;

      if (_this.settings.eeg) {
        var c3 = _this.getEEGDataByTag('C3');

        var c4 = _this.getEEGDataByTag('C4');

        if (c3 && c4) {
          cns_data = [c3, c4];
        }
      }

      return cns_data;
    };

    this.getCoherenceScore = function (coh_data) {
      var band = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'alpha1';
      var scores = [];
      if (!Array.isArray(coh_data)) coh_data = [coh_data];
      coh_data.forEach(function (data) {
        if (data.fftCount > 0) {
          var ct = data.fftCount;
          var avg = Math.min(20, ct);
          var slice = data.means[band].slice(ct - avg); // let score = coh_data.means.alpha1[ct-1] - this.mean(slice);

          scores.push(_this.mean(slice));
        }
      });
      return _this.mean(scores);
    };

    this.getAlphaRatio = function (eeg_data) {
      if (eeg_data.fftCount > 0) {
        var ratio = eeg_data.means.alpha2[eeg_data.fftCount - 1] / eeg_data.means.alpha1[eeg_data.fftCount - 1];
        return ratio;
      } else return 0;
    };

    this.getThetaBetaRatio = function (eeg_data) {
      if (eeg_data.fftCount > 0) {
        var ratio = eeg_data.means.theta[eeg_data.fftCount - 1] / eeg_data.means.beta[eeg_data.fftCount - 1];
        return ratio;
      } else return 0;
    };

    this.getAlphaBetaRatio = function (eeg_data) {
      if (eeg_data.fftCount > 0) {
        var ratio = (eeg_data.means.alpha1[eeg_data.fftCount - 1] + eeg_data.means.alpha2[eeg_data.fftCount - 1]) * .5 / eeg_data.means.beta[eeg_data.fftCount - 1];
        return ratio;
      } else return 0;
    };

    this.getAlphaThetaRatio = function (eeg_data) {
      if (eeg_data.fftCount > 0) {
        var ratio = (eeg_data.means.alpha1[eeg_data.fftCount - 1] + eeg_data.means.alpha2[eeg_data.fftCount - 1]) * .5 / eeg_data.means.theta[eeg_data.fftCount - 1];
        return ratio;
      } else return 0;
    };

    this.get40HzGamma = function (eeg_data) {
      if (eeg_data.fftCount > 0) {
        var lowgamma = eeg_data.slices.lowgamma[eeg_data.fftCount - 1];
        var centered = [];
        lowgamma.forEach(function (val, i) {
          if (_this.data.eegshared.bandFreqs.lowgamma[0][i] > 38 && _this.data.eegshared.bandFreqs.lowgamma[0][i] < 42) {
            centered.push(val);
          }
        });
        return Math.max.apply(Math, centered);
      } else return 0;
    };

    this.getLowGammaScore = function (eeg_data) {
      if (eeg_data.fftCount > 0) {
        var ct = eeg_data.fftCount;
        var avg = 20;

        if (ct < avg) {
          avg = ct;
        }

        var slice = eeg_data.means.lowgamma.slice(ct - avg);

        var score = eeg_data.means.lowgamma[ct - 1] - _this.mean(slice);

        return score;
      } else return 0;
    };

    this.getHEGRatioScore = function (heg_ch) {
      if (heg_ch.count > 0) {
        var ct = heg_ch.count;
        var avg = 40;

        if (ct < avg) {
          avg = ct;
        }

        var slice = heg_ch.ratio.slice(ct - avg);

        var score = heg_ch.ratio[ct - 1] - _this.mean(slice);

        return score;
      } else return 0;
    };

    this.getBlink = function () {
      var sideChannels = [['AF7', 'FP1'], ['AF8', 'FP2']];
      var blinks = [false, false];
      if (_this.data.blink == null) _this.data.blink = {
        blinkDuration: 1,
        // One second
        blinkThreshold: 220,
        // uV
        lastBlink: Date.now()
      }; // let quality = this.contactQuality(this.blink.threshold,this.blink.duration)

      if (Date.now() - _this.data.blink.lastBlink > _this.data.blink.blinkDuration * 1000) {
        sideChannels.forEach(function (channels, ind) {
          var _this$getEEGDataByTag;

          var data = (_this$getEEGDataByTag = _this.getEEGDataByTag(channels[0])) !== null && _this$getEEGDataByTag !== void 0 ? _this$getEEGDataByTag : _this.getEEGDataByTag(channels[1]);
          var blinkRange = data.filtered.slice(data.filtered.length - _this.data.blink.blinkDuration * _this.data.eegshared.sps);
          var max = Math.max.apply(Math, DataAtlas_toConsumableArray(blinkRange.map(function (v) {
            return Math.abs(v);
          })));
          blinks[ind] = max > _this.data.blink.blinkThreshold;
        });
        _this.data.blink.lastBlink = Date.now();
      }

      return blinks;
    };

    this.beatDetection = function (hegstruct, sps) {
      //beat detect smoothing window and midpoint
      var window = Math.floor(sps / 4);
      var pw = window;

      if (pw % 2 === 0) {
        pw += 1;
      } //make sure the peak window is an odd number


      var mid = Math.round(pw * .5); //breathing detect smoothing window and midpoint

      var window2 = Math.floor(sps * 3);
      var pw2 = window2;

      if (pw2 % 2 === 0) {
        pw2 += 1;
      }

      var mid2 = Math.round(pw2 * .5);
      var bt = hegstruct.beat_detect;
      bt.rir.push(hegstruct.red[hegstruct.count - 1] + hegstruct.ir[hegstruct.count - 1]);

      if (bt.rir.length > pw) {
        bt.rir[bt.rir.length - 1] = _this.mean(bt.rir.slice(bt.rir.length - pw));
      } else {
        bt.rir[bt.rir.length - 1] = _this.mean(bt.rir);
      }

      if (bt.rir.length > pw2) {
        bt.rir2.push(_this.mean(bt.rir.slice(bt.rir.length - pw2))); //filter with SMA
      } else {
        bt.rir2.push(_this.mean(bt.rir));
      }

      if (hegstruct.count > 1) {
        bt.drir_dt.push((bt.rir[hegstruct.count - 1] - bt.rir[hegstruct.count - 2]) / (hegstruct.times[hegstruct.count - 1] - hegstruct.times[hegstruct.count - 2]));

        if (bt.drir_dt.length > pw) {
          bt.drir_dt[bt.drir_dt.length - 1] = _this.mean(bt.drir_dt.slice(bt.drir_dt.length - pw)); //filter with SMA
          //Find local maxima and local minima.

          var l1 = bt.localmins.length,
              l2 = bt.localmaxs.length;

          if (_this.isExtrema(bt.rir.slice(bt.rir.length - pw), 'valley')) {
            //if(this.isCriticalPoint(bt.drir_dt.slice(bt.drir_dt.length-pw),'valley')) {
            bt.localmins.push({
              idx: hegstruct.count - mid,
              val: bt.rir[hegstruct.count - mid],
              t: hegstruct.times[hegstruct.count - mid]
            });
          } else if (_this.isExtrema(bt.rir.slice(bt.rir.length - pw), 'peak')) {
            //else if(this.isCriticalPoint(bt.drir_dt.slice(bt.drir_dt.length-pw),'peak')) {
            bt.localmaxs.push({
              idx: hegstruct.count - mid,
              val: bt.rir[hegstruct.count - mid],
              t: hegstruct.times[hegstruct.count - mid]
            });
          }

          if (bt.localmins.length > 1 && bt.localmaxs.length > 1) {
            //Shouldn't be more than 2 extra samples on the end if we have the correct number of beats.
            if (bt.localmins.length > bt.localmaxs.length + 2) {
              while (bt.localmins.length > bt.localmaxs.length + 2) {
                bt.localmins.splice(bt.localmins.length - 2, 1);
              }
            } //Keep the last detected max or min if excess detected
            else if (bt.localmaxs.length > bt.localmins.length + 2) {
                while (bt.localmaxs.length > bt.localmins.length + 2) {
                  bt.localmaxs.splice(bt.localmins.length - 2, 1);
                }
              }

            if (l1 < bt.localmins.length) bt.val_dists.push({
              dt: bt.localmins[bt.localmins.length - 1].t - bt.localmins[bt.localmins.length - 2].t,
              t: bt.localmins[bt.localmins.length - 1].t,
              y0: bt.localmins[bt.localmins.length - 2].val,
              y1: bt.localmins[bt.localmins.length - 1].val
            });
            if (l2 < bt.localmaxs.length) bt.peak_dists.push({
              dt: bt.localmaxs[bt.localmaxs.length - 1].t - bt.localmaxs[bt.localmaxs.length - 2].t,
              t: bt.localmaxs[bt.localmaxs.length - 1].t,
              y0: bt.localmaxs[bt.localmaxs.length - 2].val,
              y1: bt.localmaxs[bt.localmaxs.length - 1].val
            }); //Found a peak and valley to average together (for accuracy)

            if (bt.peak_dists.length > 1 && bt.val_dists.length > 1) {
              //Make sure you are using the leading valley
              //console.log(bt.peak_dists[bt.peak_dists.length-1].dt,bt.val_dists[bt.val_dists.length-1].dt,bt.peak_dists[bt.peak_dists.length-2].dt,bt.val_dists[bt.val_dists.length-2].dt)
              if (bt.val_dists[bt.val_dists.length - 1].t > bt.peak_dists[bt.peak_dists.length - 1].t) {
                if (bt.beats.length < 1) {
                  bt.beats.push({
                    t: bt.peak_dists[bt.peak_dists.length - 1].t,
                    hrv: 0,
                    bpm: 60 / (0.0005 * (bt.peak_dists[bt.peak_dists.length - 1].dt + bt.val_dists[bt.val_dists.length - 1].dt)),
                    height0: bt.peak_dists[bt.peak_dists.length - 1].y0 - bt.val_dists[bt.val_dists.length - 1].y0,
                    height1: bt.peak_dists[bt.peak_dists.length - 1].y1 - bt.val_dists[bt.val_dists.length - 1].y1
                  });
                } else if (bt.beats[bt.beats.length - 1].t !== bt.peak_dists[bt.peak_dists.length - 1].t) {
                  var bpm = 60 / (0.0005 * (bt.peak_dists[bt.peak_dists.length - 1].dt + bt.val_dists[bt.val_dists.length - 1].dt));
                  bt.beats.push({
                    t: bt.peak_dists[bt.peak_dists.length - 1].t,
                    hrv: Math.abs(bpm - bt.beats[bt.beats.length - 1].bpm),
                    bpm: bpm,
                    height0: bt.peak_dists[bt.peak_dists.length - 1].y0 - bt.val_dists[bt.val_dists.length - 1].y0,
                    height1: bt.peak_dists[bt.peak_dists.length - 1].y1 - bt.val_dists[bt.val_dists.length - 1].y1
                  });
                }
              } else {
                if (bt.beats.length < 2) {
                  bt.beats.push({
                    t: bt.peak_dists[bt.peak_dists.length - 2].t,
                    hrv: 0,
                    bpm: 60 / (0.0005 * (bt.peak_dists[bt.peak_dists.length - 1].dt + bt.val_dists[bt.val_dists.length - 1].dt)),
                    height0: bt.peak_dists[bt.peak_dists.length - 2].y0 - bt.val_dists[bt.val_dists.length - 2].y0,
                    height1: bt.peak_dists[bt.peak_dists.length - 2].y1 - bt.val_dists[bt.val_dists.length - 2].y1
                  });
                } else if (bt.beats[bt.beats.length - 1].t !== bt.peak_dists[bt.peak_dists.length - 2].t) {
                  var _bpm = 60 / (0.0005 * (bt.peak_dists[bt.peak_dists.length - 1].dt + bt.val_dists[bt.val_dists.length - 1].dt));

                  bt.beats.push({
                    t: bt.peak_dists[bt.peak_dists.length - 2].t,
                    hrv: Math.abs(_bpm - bt.beats[bt.beats.length - 2].bpm),
                    bpm: _bpm,
                    height0: bt.peak_dists[bt.peak_dists.length - 2].y0 - bt.val_dists[bt.val_dists.length - 2].y0,
                    height1: bt.peak_dists[bt.peak_dists.length - 2].y1 - bt.val_dists[bt.val_dists.length - 2].y1
                  });
                }
              }
            }
          }
        }

        if (bt.rir2.length > pw2) {
          //Find local maxima and local minima.
          var l3 = bt.localmins2.length,
              l4 = bt.localmaxs2.length;

          if (_this.isExtrema(bt.rir2.slice(bt.rir2.length - pw2), 'valley')) {
            bt.localmins2.push({
              idx: hegstruct.count - mid2,
              val: bt.rir[hegstruct.count - mid2],
              t: hegstruct.times[hegstruct.count - mid2]
            });
          } else if (_this.isExtrema(bt.rir2.slice(bt.rir2.length - pw2), 'peak')) {
            bt.localmaxs2.push({
              idx: hegstruct.count - mid2,
              val: bt.rir[hegstruct.count - mid2],
              t: hegstruct.times[hegstruct.count - mid2]
            });
          }

          if (bt.localmins2.length > 1 && bt.localmaxs2.length > 1) {
            //Shouldn't be more than 2 extra samples on the end if we have the correct number of beats.
            if (bt.localmins2.length > bt.localmaxs2.length + 2) {
              while (bt.localmins2.length > bt.localmaxs2.length + 2) {
                bt.localmins2.splice(bt.localmins2.length - 2, 1);
              }
            } //Keep the last detected max or min if excess detected
            else if (bt.localmaxs2.length > bt.localmins2.length + 2) {
                while (bt.localmaxs2.length > bt.localmins2.length + 2) {
                  bt.localmaxs2.splice(bt.localmins2.length - 2, 1);
                }
              }

            if (l3 < bt.localmins2.length) bt.val_dists2.push({
              dt: bt.localmins2[bt.localmins2.length - 1].t - bt.localmins2[bt.localmins2.length - 2].t,
              t: bt.localmins2[bt.localmins2.length - 1].t,
              y0: bt.localmins2[bt.localmins2.length - 2].val,
              y1: bt.localmins2[bt.localmins2.length - 1].val
            });
            if (l4 < bt.localmaxs2.length) bt.peak_dists2.push({
              dt: bt.localmaxs2[bt.localmaxs2.length - 1].t - bt.localmaxs2[bt.localmaxs2.length - 2].t,
              t: bt.localmaxs2[bt.localmaxs2.length - 1].t,
              y0: bt.localmaxs2[bt.localmaxs2.length - 2].val,
              y1: bt.localmaxs2[bt.localmaxs2.length - 1].val
            }); //Found a peak and valley to average together (for accuracy)

            if (bt.peak_dists2.length > 1 && bt.val_dists2.length > 1) {
              //Make sure you are using the leading valley
              if (bt.val_dists2[bt.val_dists2.length - 1].t > bt.peak_dists2[bt.peak_dists2.length - 1].t) {
                if (bt.breaths.length === 0) {
                  bt.breaths.push(_defineProperty({
                    t: bt.peak_dists2[bt.peak_dists2.length - 1].t,
                    bpm: 2000 * 60 / (bt.peak_dists2[bt.peak_dists2.length - 1].dt + bt.val_dists2[bt.val_dists2.length - 1].dt),
                    brv: 0,
                    height0: bt.peak_dists2[bt.peak_dists2.length - 1].y0 - bt.val_dists2[bt.val_dists2.length - 1].y0
                  }, "height0", bt.peak_dists2[bt.peak_dists2.length - 1].y1 - bt.val_dists2[bt.val_dists2.length - 1].y1));
                } else if (bt.breaths[bt.breaths.length - 1].t !== bt.peak_dists2[bt.peak_dists2.length - 1].t) {
                  var _bpm2 = 2000 * 60 / (bt.peak_dists2[bt.peak_dists2.length - 1].dt + bt.val_dists2[bt.val_dists2.length - 1].dt);

                  bt.breaths.push(_defineProperty({
                    t: bt.peak_dists2[bt.peak_dists2.length - 1].t,
                    bpm: _bpm2,
                    brv: Math.abs(_bpm2 - bt.breaths[bt.breaths.length - 1].bpm),
                    height0: bt.peak_dists2[bt.peak_dists2.length - 1].y0 - bt.val_dists2[bt.val_dists2.length - 1].y0
                  }, "height0", bt.peak_dists2[bt.peak_dists2.length - 1].y1 - bt.val_dists2[bt.val_dists2.length - 1].y1));
                }
              } else {
                if (bt.breaths.length === 0) {
                  bt.breaths.push(_defineProperty({
                    t: bt.peak_dists2[bt.peak_dists2.length - 2].t,
                    bpm: 2000 * 60 / (bt.peak_dists2[bt.peak_dists2.length - 2].dt + bt.val_dists2[bt.val_dists2.length - 2].dt),
                    brv: 0,
                    height0: bt.peak_dists2[bt.peak_dists2.length - 2].y0 - bt.val_dists2[bt.val_dists2.length - 2].y0
                  }, "height0", bt.peak_dists2[bt.peak_dists2.length - 2].y1 - bt.val_dists2[bt.val_dists2.length - 2].y1));
                } else if (bt.breaths[bt.breaths.length - 1].t !== bt.peak_dists2[bt.peak_dists2.length - 2].t) {
                  var _bpm3 = 2000 * 60 / (bt.peak_dists2[bt.peak_dists2.length - 2].dt + bt.val_dists2[bt.val_dists2.length - 2].dt);

                  bt.breaths.push(_defineProperty({
                    t: bt.peak_dists2[bt.peak_dists2.length - 2].t,
                    bpm: _bpm3,
                    brv: Math.abs(_bpm3 - bt.breaths[bt.breaths.length - 1].bpm),
                    height0: bt.peak_dists2[bt.peak_dists2.length - 2].y0 - bt.val_dists2[bt.val_dists2.length - 2].y0
                  }, "height0", bt.peak_dists2[bt.peak_dists2.length - 2].y1 - bt.val_dists2[bt.val_dists2.length - 2].y1));
                }
              }
            }
          }
        }
      }
    };

    this.mapFFTData = function (fft, lastPostTime, tag) {
      var atlasCoord = _this.data.eeg.find(function (o, i) {
        if (o.tag === tag) {
          o.fftCount++;
          o.fftTimes.push(lastPostTime);
          o.ffts.push(fft);

          if (_this.data.eegshared.bandFreqs.scp[1].length > 0) {
            var scp = fft.slice(_this.data.eegshared.bandFreqs.scp[1][0], _this.data.eegshared.bandFreqs.scp[1][_this.data.eegshared.bandFreqs.scp[1].length - 1] + 1);
            o.slices.scp.push(scp);
            o.means.scp.push(_this.mean(scp));
          }

          if (_this.data.eegshared.bandFreqs.scp[1].length > 0) {
            var delta = fft.slice(_this.data.eegshared.bandFreqs.delta[1][0], _this.data.eegshared.bandFreqs.delta[1][_this.data.eegshared.bandFreqs.delta[1].length - 1] + 1);
            o.slices.delta.push(delta);
            o.means.delta.push(_this.mean(delta));
          }

          if (_this.data.eegshared.bandFreqs.theta[1].length > 0) {
            var theta = fft.slice(_this.data.eegshared.bandFreqs.theta[1][0], _this.data.eegshared.bandFreqs.theta[1][_this.data.eegshared.bandFreqs.theta[1].length - 1] + 1);
            o.slices.theta.push(theta);
            o.means.theta.push(_this.mean(theta));
          }

          if (_this.data.eegshared.bandFreqs.alpha1[1].length > 0) {
            var alpha1 = fft.slice(_this.data.eegshared.bandFreqs.alpha1[1][0], _this.data.eegshared.bandFreqs.alpha1[1][_this.data.eegshared.bandFreqs.alpha1[1].length - 1] + 1);
            o.slices.alpha1.push(alpha1);
            o.means.alpha1.push(_this.mean(alpha1));
          }

          if (_this.data.eegshared.bandFreqs.alpha2[1].length > 0) {
            var alpha2 = fft.slice(_this.data.eegshared.bandFreqs.alpha2[1][0], _this.data.eegshared.bandFreqs.alpha2[1][_this.data.eegshared.bandFreqs.alpha2[1].length - 1] + 1);
            o.slices.alpha2.push(alpha2);
            o.means.alpha2.push(_this.mean(alpha2));
          }

          if (_this.data.eegshared.bandFreqs.beta[1].length > 0) {
            var beta = fft.slice(_this.data.eegshared.bandFreqs.beta[1][0], _this.data.eegshared.bandFreqs.beta[1][_this.data.eegshared.bandFreqs.beta[1].length - 1] + 1);
            o.slices.beta.push(beta);
            o.means.beta.push(_this.mean(beta));
          }

          if (_this.data.eegshared.bandFreqs.lowgamma[1].length > 0) {
            var lowgamma = fft.slice(_this.data.eegshared.bandFreqs.lowgamma[1][0], _this.data.eegshared.bandFreqs.lowgamma[1][_this.data.eegshared.bandFreqs.lowgamma[1].length - 1] + 1);
            o.slices.lowgamma.push(lowgamma);
            o.means.lowgamma.push(_this.mean(lowgamma));
          }

          if (_this.data.eegshared.bandFreqs.highgamma[1].length > 0) {
            var highgamma = fft.slice(_this.data.eegshared.bandFreqs.highgamma[1][0], _this.data.eegshared.bandFreqs.highgamma[1][_this.data.eegshared.bandFreqs.highgamma[1].length - 1] + 1);
            o.slices.highgamma.push(highgamma);
            o.means.highgamma.push(_this.mean(highgamma));
          } //console.timeEnd("slicing bands");


          return true;
        }
      });
    };

    this.mapCoherenceData = function (data, lastPostTime) {
      //Expects data in correct order
      data.forEach(function (row, i) {
        _this.data.coherence[i].fftCount++;

        _this.data.coherence[i].ffts.push(row);

        _this.data.coherence[i].fftTimes.push(lastPostTime);

        if (_this.data.eegshared.bandFreqs.scp[1].length > 0) {
          var scp = row.slice(_this.data.eegshared.bandFreqs.scp[1][0], _this.data.eegshared.bandFreqs.scp[1][_this.data.eegshared.bandFreqs.scp[1].length - 1] + 1);

          _this.data.coherence[i].slices.scp.push(scp);

          _this.data.coherence[i].means.scp.push(_this.mean(scp));
        }

        if (_this.data.eegshared.bandFreqs.delta[1].length > 0) {
          var delta = row.slice(_this.data.eegshared.bandFreqs.delta[1][0], _this.data.eegshared.bandFreqs.delta[1][_this.data.eegshared.bandFreqs.delta[1].length - 1] + 1);

          _this.data.coherence[i].slices.delta.push(delta);

          _this.data.coherence[i].means.delta.push(_this.mean(delta));
        }

        if (_this.data.eegshared.bandFreqs.theta[1].length > 0) {
          var theta = row.slice(_this.data.eegshared.bandFreqs.theta[1][0], _this.data.eegshared.bandFreqs.theta[1][_this.data.eegshared.bandFreqs.theta[1].length - 1] + 1);

          _this.data.coherence[i].slices.theta.push(theta);

          _this.data.coherence[i].means.theta.push(_this.mean(theta));
        }

        if (_this.data.eegshared.bandFreqs.alpha1[1].length > 0) {
          var alpha1 = row.slice(_this.data.eegshared.bandFreqs.alpha1[1][0], _this.data.eegshared.bandFreqs.alpha1[1][_this.data.eegshared.bandFreqs.alpha1[1].length - 1] + 1);

          _this.data.coherence[i].slices.alpha1.push(alpha1);

          _this.data.coherence[i].means.alpha1.push(_this.mean(alpha1));
        }

        if (_this.data.eegshared.bandFreqs.alpha2[1].length > 0) {
          var alpha2 = row.slice(_this.data.eegshared.bandFreqs.alpha2[1][0], _this.data.eegshared.bandFreqs.alpha2[1][_this.data.eegshared.bandFreqs.alpha2[1].length - 1] + 1);

          _this.data.coherence[i].slices.alpha2.push(alpha2);

          _this.data.coherence[i].means.alpha2.push(_this.mean(alpha2));
        }

        if (_this.data.eegshared.bandFreqs.beta[1].length > 0) {
          var beta = row.slice(_this.data.eegshared.bandFreqs.beta[1][0], _this.data.eegshared.bandFreqs.beta[1][_this.data.eegshared.bandFreqs.beta[1].length - 1] + 1);

          _this.data.coherence[i].slices.beta.push(beta);

          _this.data.coherence[i].means.beta.push(_this.mean(beta));
        }

        if (_this.data.eegshared.bandFreqs.lowgamma[1].length > 0) {
          var lowgamma = row.slice(_this.data.eegshared.bandFreqs.lowgamma[1][0], _this.data.eegshared.bandFreqs.lowgamma[1][_this.data.eegshared.bandFreqs.lowgamma[1].length - 1] + 1);

          _this.data.coherence[i].slices.lowgamma.push(lowgamma);

          _this.data.coherence[i].means.lowgamma.push(_this.mean(lowgamma));
        }

        if (_this.data.eegshared.bandFreqs.highgamma[1].length > 0) {
          var highgamma = row.slice(_this.data.eegshared.bandFreqs.highgamma[1][0], _this.data.eegshared.bandFreqs.highgamma[1][_this.data.eegshared.bandFreqs.highgamma[1].length - 1] + 1);

          _this.data.coherence[i].slices.highgamma.push(highgamma);

          _this.data.coherence[i].means.highgamma.push(_this.mean(highgamma));
        }
      });
    };

    this.bufferEEGSignals = function () {
      var seconds = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      //Buffers 1 second of all tagged eeg signals (unless null or 'other'). Data buffered in order of objects in the eeg array
      var nSamples = Math.floor(_this.data.eegshared.sps * seconds);
      var buffer = [];
      var syncTime = null;

      for (var i = 0; i < _this.data.eegshared.eegChannelTags.length; i++) {
        if (_this.data.eegshared.eegChannelTags[i].analyze === true && _this.data.eegshared.eegChannelTags[i].tag !== null && _this.data.eegshared.eegChannelTags[i].tag !== 'other') {
          var dat = _this.getEEGDataByTag(_this.data.eegshared.eegChannelTags[i].tag); //console.log(dat)


          if (dat !== undefined) {
            //console.log(dat);
            if (dat.filtered.length > 0) {
              buffer.push(dat.filtered.slice(dat.filtered.length - nSamples));
            } else if (dat.raw.length > 0) {
              buffer.push(dat.raw.slice(dat.raw.length - nSamples));
            }

            if (syncTime === null) {
              syncTime = dat.times[dat.times.length - 1];
            }
          }
        }
      }

      if (_this.settings.analyzing === true) {
        _this.workerPostTime = syncTime;
      }

      return buffer;
    };

    this.readyEEGDataForWriting = function () {
      var from = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      var to = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'end';
      var header = ["TimeStamps", "UnixTime"];
      var data = [];
      var mapidx = 0;
      var noteidx = 0;
      var datums = [];
      var fft_ref_ch = null;

      _this.data.eegshared.eegChannelTags.forEach(function (row, j) {
        if (fft_ref_ch === null && row.tag !== 'other' && row.analyze === true) fft_ref_ch = _this.getEEGDataByChannel(row.ch);
        datums.push(_this.getEEGDataByChannel(row.ch));
      });

      if (datums.length > 0) {
        if (to === 'end') {
          to = datums[0].count;
        }

        if (datums[0].count < from) {
          from = _this.atlas.rolloverLimit - 2000;
        }

        if (from !== 0) {
          while (fft_ref_ch.fftTimes[mapidx] < datums[0].times[from]) {
            mapidx++;
          }
        }

        var _loop = function _loop(i) {
          var line = [];
          line.push(_this.toISOLocal(new Date(datums[0].times[i])), datums[0].times[i]); //first get the raw/filtered

          datums.forEach(function (row, j) {
            if (i === 0) {
              header.push(row.tag);
            }

            if (row.filtered.length > i) {
              line.push(row.filtered[i].toFixed(0));
            } else if (row.raw.length > i) {
              line.push(row.raw[i].toFixed(0));
            }
          }); //then get the fft/coherence data

          if (fft_ref_ch.fftCount >= mapidx && fft_ref_ch.fftTimes[mapidx] === datums[0].times[i]) {
            datums.forEach(function (row, j) {
              if (mapidx === 0) {
                var found = _this.data.eegshared.eegChannelTags.find(function (o, k) {
                  if ((row.tag === o.ch || row.tag === o.tag) && (o.analyze === false || o.tag === 'other')) {
                    return true;
                  }
                });

                if (!found) {
                  //don't add headers for rows not being analyzed
                  var bpfreqs = DataAtlas_toConsumableArray(_this.data.eegshared.frequencies).map(function (x, k) {
                    return x = x.toFixed(3);
                  });

                  header.push(row.tag + "; FFT Hz:", bpfreqs.join(","));
                }
              }

              if (datums[0].times[i] === row.fftTimes[mapidx]) {
                line.push([''].concat(DataAtlas_toConsumableArray(DataAtlas_toConsumableArray(row.ffts[mapidx]).map(function (x, k) {
                  return x = x.toFixed(3);
                }))));
              }
            });

            if (_this.settings.coherence) {
              _this.data.coherence.forEach(function (row, j) {
                if (mapidx === 0) {
                  var bpfreqs = DataAtlas_toConsumableArray(_this.data.eegshared.frequencies).map(function (x, k) {
                    return x = x.toFixed(3);
                  });

                  header.push(row.tag + "; FFT Hz:", bpfreqs.join(","));
                }

                if (datums[0].fftTimes[mapidx] === row.fftTimes[mapidx]) {
                  try {
                    line.push([''].concat(DataAtlas_toConsumableArray(DataAtlas_toConsumableArray(row.ffts[mapidx]).map(function (x, k) {
                      return x = x.toFixed(3);
                    }))));
                  } catch (err) {
                    console.log(err, mapidx, row);
                  }
                }
              });
            }

            mapidx++;
          }

          if (_this.data.other.notes.length > 0) {
            if (i === 0) {
              header.push('Notes');
            } else {
              while (_this.data.other.notes[noteidx].time < datums[0].times[i]) {
                noteidx++;
              }
            }

            if (_this.data.other.notes[noteidx].time <= datums[0].times[i]) {
              if (line.length !== header.length) line = new Array(header.length - line.length - 1).fill(''); //resize line to correct size if not long enough

              line.push(_this.data.other.notes[noteidx].note);
              nodeidx++;
            }
          }

          data.push(line.join(","));
        };

        for (var i = from; i < to; i++) {
          _loop(i);
        } //console.log(data)


        return [header.join(",") + "\n", data.join("\n")];
      } else return undefined;
    };

    this.readyHEGDataForWriting = function () {
      var from = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      var to = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'end';
      var hegIdx = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var header = ["TimeStamps", "UnixTime", "Red", "IR", "Ratio", "Ambient", "Temp", "BPM", "HRV", "BrPM", "BRV"];
      var data = [];
      var row = _this.data.heg[hegIdx];
      var noteidx = 0;
      var beatidx = 0;
      var breathidx = 0;
      if (to === 'end') to = row.times.length;

      for (var i = from; i < to; i++) {
        var _row$beat_detect$beat, _row$beat_detect$brea;

        var t = row.times[i];
        var amb = row.ambient[i];
        if (!amb) amb = 0;
        var dataToPush = [_this.toISOLocal(new Date(t)), t, row.red[i], row.ir[i], row.ratio[i], amb, row.temp[i]];

        if (t === ((_row$beat_detect$beat = row.beat_detect.beats[beatidx]) === null || _row$beat_detect$beat === void 0 ? void 0 : _row$beat_detect$beat.t)) {
          var _row$beat_detect$beat2;

          dataToPush.push((_row$beat_detect$beat2 = row.beat_detect.beats[beatidx]) === null || _row$beat_detect$beat2 === void 0 ? void 0 : _row$beat_detect$beat2.bpm, row.beat_detect.beats[beatidx].hrv);
          beatidx++;
        } else {
          dataToPush.push('', '');
        }

        if (t === ((_row$beat_detect$brea = row.beat_detect.breaths[breathidx]) === null || _row$beat_detect$brea === void 0 ? void 0 : _row$beat_detect$brea.t)) {
          dataToPush.push(row.beat_detect.breaths[breathidx].bpm, row.beat_detect.breaths[breathidx].brv);
          breathidx++;
        } else {
          dataToPush.push('', '');
        }

        if (_this.data.other.notes.length > 0) {
          if (i === 0) {
            header.push('Notes');
          } else {
            while (_this.data.other.notes[noteidx].time < t) {
              noteidx++;
            }
          }

          if (_this.data.other.notes[noteidx].time <= t) {
            dataToPush.push(_this.data.other.notes[noteidx].note);
            nodeidx++;
          }
        }

        data.push(dataToPush.join(','));
      }

      ;
      return [header.join(',') + "\n", data.join('\n')];
    };

    this.workeronmessage = function (msg) {
      //console.log(msg);
      if (msg.origin === _this.name) {
        if (msg.foo === "multidftbandpass" || msg.foo === "multidft") {
          //parse data into atlas
          var ffts = DataAtlas_toConsumableArray(msg.output[1]);

          var fftIdx = 0;

          _this.data.eegshared.eegChannelTags.forEach(function (row, i) {
            if (row.tag !== null && row.tag !== 'other' && row.analyze === true) {
              _this.mapFFTData(ffts[fftIdx], _this.workerPostTime, row.tag);

              fftIdx++; //console.log(o);
            }
          });

          _this.checkRollover('eeg');
        } else if (msg.foo === "coherence") {
          var ffts = DataAtlas_toConsumableArray(msg.output[1]);

          var coher = DataAtlas_toConsumableArray(msg.output[2]);

          var _fftIdx = 0;

          _this.data.eegshared.eegChannelTags.forEach(function (row, i) {
            if (row.tag !== null && row.tag !== 'other' && row.analyze === true) {
              _this.mapFFTData(ffts[_fftIdx], _this.workerPostTime, row.tag);

              _fftIdx++; //console.log(o);
            }
          }); //coherence


          _this.mapCoherenceData(coher, _this.workerPostTime);

          _this.checkRollover('eeg');
        }

        _this.workerWaiting = false;
      }
    };

    this.analyzer = function () {
      //Make this stop when streaming stops
      //fft,coherence,bcijs_bandpowers,bcijs_pca,heg_pulse
      if (_this.settings.analyzing === true) {
        _this.settings.analysis.forEach(function (run, i) {
          _this.analyzerOpts.forEach(function (opt, j) {
            if (opt === run) {
              _this.analyzerFuncs[j]();
            }
          });
        });

        if (typeof window === 'undefined') {
          setTimeout(function () {
            _this.analyzer();
          }, 60);
        } else {
          setTimeout(function () {
            requestAnimationFrame(_this.analyzer);
          }, 50);
        }
      }
    };

    this.makeFeedbackOptions = function (applet) {
      var parentNode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.getElementById(applet.props.id).querySelector('.brainsatplay-neurofeedback-container');
      var id = applet.props.id;
      var html = '';
      var feedbackOptions;

      if (_this.settings.deviceConnected) {
        parentNode.style.pointerEvents = 'auto'; // if (parentNode.style.position === 'absolute')
        // Custom Feedback Functions

        var getFrontalAlphaCoherence = function getFrontalAlphaCoherence() {
          return _this.getCoherenceScore(_this.getFrontalCoherenceData(), 'alpha1');
        };

        var getFocus = function getFocus() {
          var frontalData = _this.getFrontalData();

          var thetaBetaArray = [];
          frontalData.forEach(function (data) {
            thetaBetaArray.push(_this.getThetaBetaRatio(data));
          });
          var output = Math.min(1 / (thetaBetaArray.reduce(function (tot, curr) {
            return tot + curr;
          }) / thetaBetaArray.length), 1); // clamp focus at 1

          return output;
        };

        var getHEGRatio = function getHEGRatio() {
          var ct = _this.data.heg[0].count;

          if (ct > 1) {
            var ratio = _this.data.heg[0].ratio[ct - 1];
            return ratio;
          } else return 0;
        };

        var getHEGScore = function getHEGScore() {
          var ct = _this.data.heg[0].count;

          if (ct > 1) {
            var avg = 40;

            if (ct < avg) {
              avg = ct;
            }

            var slice = _this.data.heg[0].ratio.slice(ct - avg);

            var score = _this.data.heg[0].ratio[ct - 1] - _this.mean(slice);

            return score;
          } else return 0;
        }; // A custom function to animate heartbeats


        var animateBeats = function animateBeats(type) {
          var beats = _this.data.heg[0].beat_detect[type];
          var prevBeatLength = _this.data.heg[0].beat_detect.prevBeatLength;
          _this.data.heg[0].beat_detect.prevBeatLength = beats.length;

          if (prevBeatLength < beats.length) {
            console.log('beat');
            beats[beats.length - 1].tRead = Date.now();
          }

          if (0 < beats.length) {
            var secondsElapsed = (Date.now() - beats[beats.length - 1].tRead) / 1000; // let beatProgression = secondsElapsed // 1 s animation

            var beatProgression = secondsElapsed * beats[beats.length - 1].bpm / 30; // animate based on estimated bpm

            if (beatProgression < 1) {
              var animation = 1 - (0.5 + 0.5 * Math.cos(2 * Math.PI * beatProgression));
              return animation;
            } else {
              return 0;
            }
          } else {
            return 0;
          }
        };

        var animateHeartbeats = function animateHeartbeats() {
          return animateBeats('beats');
        };

        var animateBreaths = function animateBreaths() {
          return animateBeats('breaths');
        }; // Option Declaration


        feedbackOptions = [{
          label: 'Select your neurofeedback',
          "function": applet.defaultNeurofeedback
        }];

        if (_this.settings.heg) {
          feedbackOptions.push({
            label: 'HEG Ratio',
            "function": getHEGRatio
          }, {
            label: 'HEG Score',
            "function": getHEGScore
          }, {
            label: 'Heartbeat',
            "function": animateHeartbeats
          }, {
            label: 'Breath',
            "function": animateBreaths
          });
        }

        if (_this.settings.eeg) {
          feedbackOptions.push({
            label: 'Frontal Alpha Coherence',
            "function": getFrontalAlphaCoherence
          }, {
            label: 'Focus (Theta/Beta Ratio)',
            "function": getFocus
          });
        }

        var neurofeedbackSelector = document.getElementById("".concat(id, "-neurofeedbackselector"));

        if (neurofeedbackSelector == null) {
          html = "<div><select id=\"".concat(id, "-neurofeedbackselector\">");
          feedbackOptions.forEach(function (o, i) {
            if (i === 0) html += "<option value=".concat(o["function"].name, " disabled>").concat(o.label, "</option>");else if (i === 1) html += "<option value=".concat(o["function"].name, " selected>").concat(o.label, "</option>");else html += "<option value=".concat(o["function"].name, ">").concat(o.label, "</option>");
            if (i === feedbackOptions.length - 1) html += "</select></div>";
          });
          parentNode.innerHTML += html;
          neurofeedbackSelector = document.getElementById("".concat(id, "-neurofeedbackselector"));
        }

        applet.getNeurofeedback = feedbackOptions.find(function (o) {
          return o["function"].name == neurofeedbackSelector.value;
        })["function"];

        neurofeedbackSelector.onchange = function (e) {
          applet.getNeurofeedback = feedbackOptions.find(function (o) {
            return o["function"].name == e.target.value;
          })["function"];
        };
      }
    };

    this.name = name;
    this.config = config;

    if (window.workers == null) {
      window.workers = new WorkerManager();
    } else {
      console.log('Workers already created.');
    }

    this.state = new StateManager({
      deviceConnected: false,
      analyzing: false,
      analysis: analysis,
      // ['eegfft']
      heg: false,
      eeg: false,
      coherence: false,
      eyetracker: false,
      accelerometer: false,
      hrv: false,
      fnirs: false,
      ecg: false,
      spo2: false,
      emg: false
    });
    this.settings = this.state.data; //to subscribe use let sub = this.state.subscribe('deviceConnected',(status) => {});

    this.data = {
      eegshared: {
        eegChannelTags: [],
        sps: 1,
        startTime: 0,
        frequencies: [],
        bandFreqs: {
          scp: [[], []],
          delta: [[], []],
          theta: [[], []],
          alpha1: [[], []],
          alpha2: [[], []],
          beta: [[], []],
          lowgamma: [[], []],
          highgamma: [[], []]
        }
      },
      eeg: [],
      coherence: [],
      heg: [],
      fnirs: [],
      accelerometer: [],
      hrv: [],
      spo2: [],
      emg: [],
      ecg: [],
      eyetracker: [],
      other: {
        notes: [],
        games: {}
      }
    };
    Object.assign(this.data, initialData);
    this.rolloverLimit = 2001 * 6 * 5; //Max samples allowed in arrays before rollover kicks in (5min of data for FreeEEG32, 10min for Muse, etc)
    // Enforce uppercase

    if (!Array.isArray(this.data.eegshared.eegChannelTags)) {
      var slice;
      if (typeof this.data.eegshared.eegChannelTags === "string") slice = parseInt(this.data.eegshared.eegChannelTags);else slice = this.data.eegshared.eegChannelTags;
      this.data.eegshared.eegChannelTags = ["FP1", "FP2", "FZ", "F3", "F4", "F7", "F8", "CZ", "C3", "C4", "T3", "T4", "T5", "T6", "PZ", "P3", "P4", "O1", "O2"].slice(0, slice);
      this.data.eegshared.eegChannelTags = this.data.eegshared.eegChannelTags.map(function (t, i) {
        return {
          ch: i,
          tag: t,
          analyze: true
        };
      });
    } // Create EEG Map


    if (config === '10_20') {
      this.settings.eeg = true;
      this.data.eeg = this.gen10_20Atlas(this.data.eegshared.eegChannelTags);
    } else if (config === 'muse') {
      this.settings.eeg = true;
      this.data.eeg = this.genMuseAtlas();
    } else if (config === 'big') {
      this.settings.eeg = true;
      this.data.eeg = this.gen10_20Atlas();
    } else if (config === 'hegduino') {
      this.addHEGCoord(this.data.heg.length, 0, 60, 60);
      this.settings.heg = true;
    } else if (config === 'eyetracker') {
      this.settings.eyetracker = true;
      this.addEyeTracker(this.data.eyetracker.length);
    }

    if (useCoherence === true) {
      this.settings.coherence = true;
      this.data.coherence = this.genCoherenceMap(this.data.eegshared.eegChannelTags); //console.log(this.data.coherence);
    }

    if (this.data.eegshared.eegChannelTags) {
      //add structs for non-specified channels
      this.data.eegshared.eegChannelTags.forEach(function (row, i) {
        if (_this.getEEGDataByTag(row.tag) === undefined) {
          _this.addEEGCoord(row.ch);
        }
      });
    }

    if (this.data.eegshared.sps) {
      this.data.eegshared.frequencies = this.bandpassWindow(0, 128, this.data.eegshared.sps * 0.5);
      this.data.eegshared.bandFreqs = this.getBandFreqs(this.data.eegshared.frequencies); //console.log(this.data.eegshared.bandFreqs)
    }

    this.analyzerOpts = []; //'eegfft','eegcoherence','bcijs_bandpower','bcijs_pca','heg_pulse'

    this.analyzerFuncs = [];
    this.workerPostTime = 0;
    this.workerWaiting = false;
    this.workerIdx = 0;

    if (useAnalyzer === true) {
      this.addDefaultAnalyzerFuncs();

      if (!window.workers.workerResponses) {
        window.workers.workerResponses = [];
      } //placeholder till we can get webworkers working outside of the index.html
      //this.workerIdx = addWorker(); // add a worker for this DataAtlas analyzer instance


      window.workers.workerResponses.push(this.workeronmessage); //this.analyzer();
    }
  }

  DataAtlas_createClass(DataAtlas, [{
    key: "genEEGCoordinateStruct",
    value: function genEEGCoordinateStruct(tag) {
      var x = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      var y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var z = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
      var bands = {
        scp: [],
        delta: [],
        theta: [],
        alpha1: [],
        alpha2: [],
        beta: [],
        lowgamma: [],
        highgamma: []
      };
      var struct = {
        tag: tag,
        position: {
          x: x,
          y: y,
          z: z
        },
        count: 0,
        times: [],
        raw: [],
        filtered: [],
        fftCount: 0,
        fftTimes: [],
        //Separate timing for ffts on workers
        ffts: [],
        slices: JSON.parse(JSON.stringify(bands)),
        means: JSON.parse(JSON.stringify(bands)),
        lastReadFFT: 0,
        // counter value when this struct was last read from (using get functions)
        lastRead: 0
      };
      return struct;
    }
  }, {
    key: "addEEGCoord",
    value: function addEEGCoord(tag) {
      var x = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 999;
      var y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 999;
      var z = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 999;
      this.data.eeg.push(this.genEEGCoordinateStruct(tag, x, y, z));
    }
  }, {
    key: "genMuseAtlas",
    value: function genMuseAtlas() {
      var _this2 = this;

      //Muse coordinates (estimated)
      var eegmap = [];
      var c = [[-21.5, 70.2, -0.1], [28.4, 69.1, -0.4], [-54.8, 33.9, -3.5], [56.6, 30.8, -4.1]]; //FP1, FP2, F7, F8

      function mid(arr1, arr2) {
        //midpoint
        var midpoint = [];
        arr1.forEach(function (el, i) {
          midpoint.push(0.5 * (el + arr2[i]));
        });
        return midpoint;
      }

      var tags = ['AF7', 'AF8', 'TP9', 'TP10', 'AUX'];
      var coords = [mid(c[0], c[2]), //estimated
      mid(c[1], c[3]), //estimated
      [-80.2, -31.3, -10.7], //estimated
      [81.9, -34.2, -8.2], //estimated
      [NaN, NaN, NaN]];
      tags.forEach(function (tag, i) {
        eegmap.push(_this2.genEEGCoordinateStruct(tag, coords[i][0], coords[i][1], coords[i][2]));
      });
      return eegmap;
    }
  }, {
    key: "gen10_20Atlas",
    value: function gen10_20Atlas(channelDicts) {
      var _this3 = this;

      var eegCoordinates = {
        FP1: [-21.2, 66.9, 12.1],
        FPZ: [1.4, 65.1, 11.3],
        FP2: [24.3, 66.3, 12.5],
        AF7: [-41.7, 52.8, 11.3],
        AF3: [-32.7, 48.4, 32.8],
        AFZ: [1.8, 54.8, 37.9],
        AF4: [35.1, 50.1, 31.1],
        AF8: [43.9, 52.7, 9.3],
        F5: [-51.4, 26.7, 24.7],
        F3: [-39.7, 25.3, 44.7],
        F1: [-22.1, 26.8, 54.9],
        FZ: [0.0, 26.8, 60.6],
        F2: [23.6, 28.2, 55.6],
        F4: [41.9, 27.5, 43.9],
        F6: [52.9, 28.7, 25.2],
        F7: [-52.1, 28.6, 3.8],
        F8: [53.2, 28.4, 3.1],
        FC5: [-59.1, 3.0, 26.1],
        FC3: [-45.5, 2.4, 51.3],
        FC1: [-24.7, 0.3, 66.4],
        FCZ: [1.0, 1.0, 72.8],
        FC2: [26.1, 3.2, 66.0],
        FC4: [47.5, 4.6, 49.7],
        FC6: [60.5, 4.9, 25.5],
        FT9: [-53.8, -2.1, -29.1],
        FT7: [-59.2, 3.4, -2.1],
        FT8: [60.2, 4.7, -2.8],
        FT10: [55.0, -3.6, -31.0],
        T7: [-65.8, -17.8, -2.9],
        T5: [-61.5, -65.3, 1.1],
        T3: [-70.2, -21.3, -10.7],
        T4: [71.9, -25.2, -8.2],
        T6: [59.3, -67.6, 3.8],
        T8: [67.4, -18.5, -3.4],
        C5: [-63.6, -18.9, 25.8],
        C3: [-49.1, -20.7, 53.2],
        C1: [-25.1, -22.5, 70.1],
        CZ: [0.8, -21.9, 77.4],
        C2: [26.7, -20.9, 69.5],
        C4: [50.3, -18.8, 53.0],
        C6: [65.2, -18.0, 26.4],
        CP5: [-61.8, -46.2, 22.5],
        CP3: [-46.9, -47.7, 49.7],
        CP1: [-24.0, -49.1, 66.1],
        CPZ: [0.7, -47.9, 72.6],
        CP2: [25.8, -47.1, 66.0],
        CP4: [49.5, -45.5, 50.7],
        CP6: [62.9, -44.6, 24.4],
        TP9: [-73.6, -46.7, -4.0],
        // estimated
        TP7: [-63.6, -44.7, -4.0],
        TP8: [64.6, -45.4, -3.7],
        TP10: [74.6, -47.4, -3.7],
        // estimated
        P9: [-50.8, -51.3, -37.7],
        P7: [-55.9, -64.8, 0.0],
        P5: [-52.7, -67.1, 19.9],
        P3: [-41.4, -67.8, 42.4],
        P1: [-21.6, -71.3, 52.6],
        PZ: [0.7, -69.3, 56.9],
        P2: [24.4, -69.9, 53.5],
        P4: [44.2, -65.8, 42.7],
        P6: [54.4, -65.3, 20.2],
        P8: [56.4, -64.4, 0.1],
        P10: [51.0, -53.9, -36.5],
        PO7: [-44.0, -81.7, 1.6],
        PO3: [-33.3, -84.3, 26.5],
        POZ: [0.0, -87.9, 33.5],
        PO4: [35.2, -82.6, 26.1],
        PO8: [43.3, -82.0, 0.7],
        O1: [-25.8, -93.3, 7.7],
        OZ: [0.3, -97.1, 8.7],
        O2: [25.0, -95.2, 6.2]
      };
      var eegmap = [];

      if (channelDicts == null) {
        for (var prop in eegCoordinates) {
          eegmap.push(this.genEEGCoordinateStruct(prop, eegCoordinates[prop][0], eegCoordinates[prop][1], eegCoordinates[prop][2]));
        }
      } else {
        if (Array.isArray(channelDicts)) {
          channelDicts.forEach(function (channelDict) {
            var tag = channelDict.tag;
            if (eegCoordinates[tag]) eegmap.push(_this3.genEEGCoordinateStruct(tag, eegCoordinates[tag][0], eegCoordinates[tag][1], eegCoordinates[tag][2]));else eegmap.push(_this3.genEEGCoordinateStruct(tag, NaN, NaN, NaN));
          });
        }
      }

      return eegmap;
    }
  }, {
    key: "genCoherenceStruct",
    value: function genCoherenceStruct(tag0, tag1, coord0, coord1) {
      var bandFreqs = {
        scp: [],
        delta: [],
        theta: [],
        alpha1: [],
        alpha2: [],
        beta: [],
        lowgamma: [],
        highgamma: []
      };
      return {
        tag: tag0 + "::" + tag1,
        x0: coord0 === null || coord0 === void 0 ? void 0 : coord0.x,
        y0: coord0 === null || coord0 === void 0 ? void 0 : coord0.y,
        z0: coord0 === null || coord0 === void 0 ? void 0 : coord0.z,
        x1: coord1 === null || coord1 === void 0 ? void 0 : coord1.x,
        y1: coord1 === null || coord1 === void 0 ? void 0 : coord1.y,
        z1: coord1 === null || coord1 === void 0 ? void 0 : coord1.z,
        fftCount: 0,
        fftTimes: [],
        ffts: [],
        slices: JSON.parse(JSON.stringify(bandFreqs)),
        means: JSON.parse(JSON.stringify(bandFreqs)),
        // counter value when this struct was last read from (for using get functions)
        lastRead: 0
      };
    }
  }, {
    key: "genCoherenceMap",
    value: function genCoherenceMap() {
      var channelTags = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.data.eegshared.eegChannelTags;
      var taggedOnly = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
      var cmap = [];
      var l = 1,
          k = 0;

      for (var i = 0; i < channelTags.length * (channelTags.length + 1) / 2 - channelTags.length; i++) {
        if (taggedOnly === false || taggedOnly === true && channelTags[k].tag !== null && channelTags[k + l].tag !== null && channelTags[k].tag !== 'other' && channelTags[k + l].tag !== 'other' && channelTags[k].analyze === true && channelTags[k + l].analyze === true) {
          var coord0 = this.getEEGDataByTag(channelTags[k].tag);
          var coord1 = this.getEEGDataByTag(channelTags[k + l].tag);
          cmap.push(this.genCoherenceStruct(channelTags[k].tag, channelTags[k + l].tag, coord0.position, coord1.position));
        }

        l++;

        if (l + k === channelTags.length) {
          k++;
          l = 1;
        }
      } //console.log(cmap,channelTags);


      return cmap;
    }
  }, {
    key: "genHEGStruct",
    value: function genHEGStruct(tag, x, y, z) {
      return {
        tag: tag,
        position: {
          x: x,
          y: y,
          z: z
        },
        count: 0,
        times: [],
        red: [],
        ir: [],
        ambient: [],
        ratio: [],
        temp: [],
        beat_detect: {
          beats: [],
          breaths: [],
          rir: [],
          rir2: [],
          drir_dt: [],
          localmins: [],
          localmaxs: [],
          val_dists: [],
          peak_dists: [],
          localmins2: [],
          localmaxs2: [],
          val_dists2: [],
          peak_dists2: []
        },
        lastRead: 0,
        startTime: 0
      };
    }
  }, {
    key: "addHEGCoord",
    value: function addHEGCoord() {
      var tag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "heg1";
      var x = arguments.length > 1 ? arguments[1] : undefined;
      var y = arguments.length > 2 ? arguments[2] : undefined;
      var z = arguments.length > 3 ? arguments[3] : undefined;
      this.data.heg.push(this.genHEGStruct(tag, x, y, z));
    }
  }, {
    key: "genFNIRSStruct",
    value: function genFNIRSStruct(tag, x, y, z) {
      return {
        tag: tag,
        position: {
          x: x,
          y: y,
          z: z
        },
        count: 0,
        times: [],
        red: [],
        ir: [],
        ir2: [],
        ambient: [],
        lastRead: 0
      };
    }
  }, {
    key: "addFNIRSCoord",
    value: function addFNIRSCoord() {
      var tag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "banana1";
      var x = arguments.length > 1 ? arguments[1] : undefined;
      var y = arguments.length > 2 ? arguments[2] : undefined;
      var z = arguments.length > 3 ? arguments[3] : undefined;
      this.data.fnirs.push(this.genHEGStruct(tag, x, y, z));
    }
  }, {
    key: "genAccelerometerStruct",
    value: function genAccelerometerStruct(tag, x, y, z) {
      return {
        tag: tag,
        position: {
          x: x,
          y: y,
          z: z
        },
        count: 0,
        times: [],
        Ax: [],
        Ay: [],
        Az: [],
        Gx: [],
        Gy: [],
        Gz: [],
        lastRead: 0,
        startTime: 0
      };
    }
  }, {
    key: "addAccelerometerCoord",
    value: function addAccelerometerCoord() {
      var tag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "accel1";
      var x = arguments.length > 1 ? arguments[1] : undefined;
      var y = arguments.length > 2 ? arguments[2] : undefined;
      var z = arguments.length > 3 ? arguments[3] : undefined;
      this.data.accelerometer.push(this.genAccelerometerStruct(tag, x, y, z));
    }
  }, {
    key: "genHRVStruct",
    value: function genHRVStruct(tag) {
      return {
        tag: tag,
        count: 0,
        times: [],
        raw: [],
        filtered: [],
        bpm: [],
        hrv: [],
        lastRead: 0,
        startTime: 0
      };
    }
  }, {
    key: "addHRV",
    value: function addHRV() {
      var tag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "hrv1";
      this.data.hrv.push(genHRVStruct(tag));
    }
  }, {
    key: "genEyeTrackerStruct",
    value: function genEyeTrackerStruct(tag) {
      return {
        tag: tag,
        count: 0,
        times: [],
        x: [],
        y: [],
        smax: [],
        smay: [],
        lastRead: 0,
        startTime: 0
      };
    }
  }, {
    key: "addEyeTracker",
    value: function addEyeTracker() {
      var tag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "eyes";
      this.data.eyetracker.push(this.genEyeTrackerStruct(tag));
    } //also do ecg,emg
    //Makes a note to be saved. Will automatically get the latest timestamp for attached devices if there is one, or just Date.now();

  }, {
    key: "makeNote",
    value: function makeNote() {
      var text = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'event';
      var timestamp = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;

      if (timestamp === undefined) {
        if (this.settings.eeg) {
          var row = this.getEEGDataByChannel(this.data.eegshared.eegChannelTags[0].ch);
          timestamp = row.times[row.times.length - 1];
          this.data.other.notes.push({
            time: timestamp,
            note: text
          });
        }

        if (this.settings.heg) {
          timestamp = this.data.heg[0].times[this.data.heg[0].times.length - 1];
          this.data.other.notes.push({
            time: timestamp,
            note: text
          });
        } else {
          this.data.other.notes.push({
            time: Date.now(),
            note: text
          });
        }
      } else {
        this.data.other.notes.push({
          time: timestamp,
          note: text
        });
      }
    }
  }, {
    key: "getCoordPositions",
    value: //Return an array of Array(3)s for each coordinate. Useful e.g. for graphics
    function getCoordPositions() {
      var device = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'eeg';
      var coords = [];

      for (var i = 0; i < this.data[device].length; i++) {
        coords.push([this.data[device][i].position.x, this.data[device][i].position.y, this.data[device][i].position.z]);
      }

      return coords;
    } //Get the latest data pushed to tagged channels

  }, {
    key: "mean",
    value: //get the average of an array
    function mean(arr) {
      if (arr.length > 0) {
        var sum = arr.reduce(function (prev, curr) {
          return curr += prev;
        });
        return sum / arr.length;
      } else {
        return 0;
      }
    } //Report moving average of frontal coherence

  }, {
    key: "isExtrema",
    value: function isExtrema(arr) {
      var critical = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'peak';

      //Checks if the middle point of the (odd-numbered) array is a local extrema. options: 'peak','valley','tangent'. Even numbered arrays are popped
      var ref = DataAtlas_toConsumableArray(arr);

      if (ref.length % 2 === 0) ref.pop();

      if (arr.length > 1) {
        var pass = true;
        ref.forEach(function (val, i) {
          if (critical === 'peak') {
            //search first derivative
            if (i < Math.floor(ref.length * .5) && val >= ref[Math.floor(ref.length * .5)]) {
              pass = false;
            } else if (i > Math.floor(ref.length * .5) && val >= ref[Math.floor(ref.length * .5)]) {
              pass = false;
            }
          } else if (critical === 'valley') {
            //search first derivative
            if (i < Math.floor(ref.length * .5) && val <= ref[Math.floor(ref.length * .5)]) {
              pass = false;
            } else if (i > Math.floor(ref.length * .5) && val <= ref[Math.floor(ref.length * .5)]) {
              pass = false;
            }
          } else {
            //look for tangents (best with 2nd derivative usually)
            if (i < Math.floor(ref.length * .5) && val <= ref[Math.floor(ref.length * .5)]) {
              pass = false;
            } else if (i > Math.floor(ref.length * .5) && val <= ref[Math.floor(ref.length * .5)]) {
              pass = false;
            }
          } //|| (i < ref.length*.5 && val <= 0 ) || (i > ref.length*.5 && val > 0)

        });

        if (critical !== 'peak' && critical !== 'valley' && pass === false) {
          pass = true;
          ref.forEach(function (val, i) {
            if (i < Math.floor(ref.length * .5) && val >= ref[Math.floor(ref.length * .5)]) {
              pass = false;
            } else if (i > Math.floor(ref.length * .5) && val >= ref[Math.floor(ref.length * .5)]) {
              pass = false;
            }
          });
        }

        return pass;
      }
    }
  }, {
    key: "isCriticalPoint",
    value: function isCriticalPoint(arr) {
      var critical = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'peak';

      //Checks if the middle point of the (odd-numbered) array is a critical point. options: 'peak','valley','tangent'. Even numbered arrays are popped
      var ref = DataAtlas_toConsumableArray(arr);

      if (ref.length % 2 === 0) ref.pop();

      if (arr.length > 1) {
        var pass = true;
        ref.forEach(function (val, i) {
          if (critical === 'peak') {
            //search first derivative
            if (i < ref.length * .5 && val <= 0) {
              pass = false;
            } else if (i > ref.length * .5 && val > 0) {
              pass = false;
            }
          } else if (critical === 'valley') {
            //search first derivative
            if (i < ref.length * .5 && val >= 0) {
              pass = false;
            } else if (i > ref.length * .5 && val < 0) {
              pass = false;
            }
          } else {
            //look for tangents (best with 2nd derivative usually)
            if (i < ref.length * .5 && val >= 0) {
              pass = false;
            } else if (i > ref.length * .5 && val < 0) {
              pass = false;
            }
          }
        });

        if (critical !== 'peak' && critical !== 'valley' && pass === false) {
          pass = true;
          ref.forEach(function (val, i) {
            if (i < ref.length * .5 && val <= 0) {
              pass = false;
            } else if (i > ref.length * .5 && val > 0) {
              pass = false;
            }
          });
        }

        return pass;
      }
    } //Simple beat detection. 
    //For pulse it applies a 1/4th second moving average and finds zero-crosses on the first derivative of R+IR. Data should be filtered with an IIR/Biquad filter with crystal clear pulse waves
    //For breathing detection it applies a 3 second moving average and peak finding should work. Run every new sample

  }, {
    key: "setDefaultTags",
    value: function setDefaultTags() {
      return [{
        ch: 0,
        tag: null
      }, {
        ch: 1,
        tag: null
      }, {
        ch: 2,
        tag: null
      }, {
        ch: 3,
        tag: null
      }, {
        ch: 4,
        tag: null
      }, {
        ch: 5,
        tag: null
      }, {
        ch: 6,
        tag: null
      }, {
        ch: 7,
        tag: null
      }, {
        ch: 8,
        tag: null
      }, {
        ch: 9,
        tag: null
      }, {
        ch: 10,
        tag: null
      }, {
        ch: 11,
        tag: null
      }, {
        ch: 12,
        tag: null
      }, {
        ch: 13,
        tag: null
      }, {
        ch: 14,
        tag: null
      }, {
        ch: 15,
        tag: null
      }, {
        ch: 16,
        tag: null
      }, {
        ch: 17,
        tag: null
      }, {
        ch: 18,
        tag: null
      }, {
        ch: 19,
        tag: null
      }, {
        ch: 20,
        tag: null
      }, {
        ch: 21,
        tag: null
      }, {
        ch: 22,
        tag: null
      }, {
        ch: 23,
        tag: null
      }, {
        ch: 24,
        tag: null
      }, {
        ch: 25,
        tag: null
      }, {
        ch: 26,
        tag: null
      }, {
        ch: 27,
        tag: null
      }, {
        ch: 28,
        tag: null
      }, {
        ch: 29,
        tag: null
      }, {
        ch: 30,
        tag: null
      }, {
        ch: 31,
        tag: null
      }];
    }
  }, {
    key: "getBandFreqs",
    value: function getBandFreqs(frequencies) {
      //Returns an object with the frequencies and indices associated with the bandpass window (for processing the FFT results)
      var scpFreqs = [[], []],
          deltaFreqs = [[], []],
          thetaFreqs = [[], []],
          alpha1Freqs = [[], []],
          alpha2Freqs = [[], []],
          betaFreqs = [[], []],
          lowgammaFreqs = [[], []],
          highgammaFreqs = [[], []]; //x axis values and indices for named EEG frequency bands

      frequencies.forEach(function (item, idx) {
        if (item >= 0.1 && item <= 1) {
          scpFreqs[0].push(item);
          scpFreqs[1].push(idx);
        } else if (item >= 1 && item <= 4) {
          deltaFreqs[0].push(item);
          deltaFreqs[1].push(idx);
        } else if (item > 4 && item <= 8) {
          thetaFreqs[0].push(item);
          thetaFreqs[1].push(idx);
        } else if (item > 8 && item <= 10) {
          alpha1Freqs[0].push(item);
          alpha1Freqs[1].push(idx);
        } else if (item > 10 && item <= 12) {
          alpha2Freqs[0].push(item);
          alpha2Freqs[1].push(idx);
        } else if (item > 12 && item <= 30) {
          betaFreqs[0].push(item);
          betaFreqs[1].push(idx);
        } else if (item > 30 && item <= 45) {
          lowgammaFreqs[0].push(item);
          lowgammaFreqs[1].push(idx);
        } else if (item > 45) {
          highgammaFreqs[0].push(item);
          highgammaFreqs[1].push(idx);
        }
      });
      return {
        scp: scpFreqs,
        delta: deltaFreqs,
        theta: thetaFreqs,
        alpha1: alpha1Freqs,
        alpha2: alpha2Freqs,
        beta: betaFreqs,
        lowgamma: lowgammaFreqs,
        highgamma: highgammaFreqs
      };
    }
  }, {
    key: "bandpassWindow",
    value: //Returns the x axis (frequencies) for the bandpass filter amplitudes. The window gets stretched or squeezed between the chosen frequencies based on the sample rate in my implementation.
    function bandpassWindow(freqStart, freqEnd, nSteps) {
      var diff = (freqEnd - freqStart) / nSteps;
      var fftwindow = [];
      var i = 0;

      while (i < freqEnd) {
        fftwindow.push(i);
        i += diff;
      }

      return fftwindow;
    }
  }, {
    key: "toISOLocal",
    value: function toISOLocal(d) {
      var z = function z(n) {
        return ('0' + n).slice(-2);
      };

      var zz = function zz(n) {
        return ('00' + n).slice(-3);
      };

      var off = d.getTimezoneOffset();
      var sign = off < 0 ? '+' : '-';
      off = Math.abs(off);
      return d.getFullYear() + '-' //https://stackoverflow.com/questions/49330139/date-toisostring-but-local-time-instead-of-utc
      + z(d.getMonth() + 1) + '-' + z(d.getDate()) + 'T' + z(d.getHours()) + ':' + z(d.getMinutes()) + ':' + z(d.getSeconds()) + '.' + zz(d.getMilliseconds()) + "(UTC" + sign + z(off / 60 | 0) + ':00)';
    }
  }, {
    key: "regenAtlasses",
    value: function regenAtlasses(freqStart, freqEnd) {
      var sps = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 512;
      this.data.eeg = this.makeAtlas10_20(); //reset atlas

      var bandPassWindow = this.bandPassWindow(freqStart, freqEnd, sps);
      this.data.eegshared.frequencies = bandPassWindow; //Push the x-axis values for each frame captured as they may change - should make this lighter

      this.data.eegshared.bandFreqs = this.getBandFreqs(bandPassWindow); //Update bands accessed by the atlas for averaging

      this.coherenceMap = this.genCoherenceMap();
    }
  }, {
    key: "addDefaultAnalyzerFuncs",
    value: function addDefaultAnalyzerFuncs() {
      var _this4 = this;

      this.analyzerOpts.push('eegfft', 'eegcoherence');

      var fftFunc = function fftFunc() {
        if (_this4.workerWaiting === false) {
          var buf = _this4.bufferEEGSignals(1);

          if (buf.length > 0) {
            if (buf[0].length >= _this4.data.eegshared.sps) {
              // console.log('posting to worker',window.workers)
              window.workers.postToWorker({
                foo: 'multidftbandpass',
                input: [buf, 1, 0, 128, 1],
                origin: _this4.name
              }, _this4.workerIdx);
              _this4.workerWaiting = true;
            }
          }
        }
      };

      var coherenceFunc = function coherenceFunc() {
        if (_this4.workerWaiting === false) {
          var buf = _this4.bufferEEGSignals(1);

          if (buf.length > 0) {
            if (buf[0].length >= _this4.data.eegshared.sps) {
              // console.log('posting to worker',window.workers)
              window.workers.postToWorker({
                foo: 'coherence',
                input: [buf, 1, 0, 128, 1],
                origin: _this4.name
              }, _this4.workerIdx); //postToWorker({foo:'gpucoh', input:[buf, 1, 0, this.data.eegshared.sps*0.5, 1], origin:this.name},this.workerIdx);

              _this4.workerWaiting = true;
            }
          }
        }
      };

      this.analyzerFuncs.push(fftFunc, coherenceFunc); //'bcijs_bandpowers','bcijs_pca','heg_pulse'
    }
  }, {
    key: "addAnalyzerFunc",
    value: function addAnalyzerFunc() {
      var _this5 = this;

      var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
      var foo = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};
      var n = this.analyzerOpts.find(function (name, i) {
        if (name === name) {
          _this5.analyzerFuncs[i] = foo;
          return true;
        }
      });

      if (n === undefined) {
        this.analyzerOpts.push(name);
        this.analyzerFuncs.push(foo);
      }
    }
  }, {
    key: "checkRollover",
    value: function checkRollover() {
      var _this6 = this;

      var dataArr = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

      //'eeg','heg', etc
      if (dataArr === null) {
        for (var prop in this.data) {
          if (Array.isArray(this.data[prop])) {
            this.data[prop].forEach(function (row, i) {
              for (var p in row) {
                if (!Array.isArray(row[p]) && DataAtlas_typeof(row[p]) === 'object') {
                  //e.g. {slices:{alpha1:[...]}}
                  for (var pz in row[p]) {
                    if (Array.isArray(row[p][pz])) {
                      if (row[p][pz].length > _this6.rolloverLimit) {
                        row[p][pz].splice(0, row[p][pz].length - _this6.rolloverLimit - 2000);
                      }
                    }
                  }
                } else if (Array.isArray(row[p])) {
                  // e.g. {ffts:[...] fftCount:x}
                  if (row[p].length > _this6.rolloverLimit) {
                    row[p].splice(0, row[p].length - _this6.rolloverLimit - 2000);

                    if (p === 'ffts') {
                      //adjust counters
                      row.fftCount = row[p].length;

                      if (row.lastReadFFT > row[p].length) {
                        row.lastReadFFT = row[p].length;
                      }
                    } else if (p === 'times') {
                      row.count = row[p].length;

                      if (row.lastRead > row[p].length) {
                        row.lastRead = row[p].length;
                      }
                    }
                  }
                }
              }
            });
          }
        }
      } else {
        //spaghetti
        if (Array.isArray(this.data[dataArr])) {
          this.data[dataArr].forEach(function (row, i) {
            for (var p in row) {
              if (!Array.isArray(row[p]) && DataAtlas_typeof(row[p]) === 'object') {
                //nested object with arrays
                for (var pz in row[p]) {
                  if (Array.isArray(row[p][pz])) {
                    if (row[p][pz].length > _this6.rolloverLimit) {
                      row[p][pz].splice(0, row[p][pz].length - _this6.rolloverLimit - 2000);
                    }
                  }
                }
              } else if (Array.isArray(row[p])) {
                //arrays
                if (row[p].length > _this6.rolloverLimit) {
                  row[p].splice(0, row[p].length - _this6.rolloverLimit - 2000);

                  if (p === 'ffts') {
                    //adjust counters
                    row.fftCount = row[p].length;
                    row.lastReadFFT = row[p].length;
                  } else if (p === 'times') {
                    row.count = row[p].length;
                    row.lastRead = row[p].length;
                  }
                }
              }
            }
          });
        }
      }
    }
  }]);

  return DataAtlas;
}();
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/freeeeg32/eeg32.js
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function eeg32_toConsumableArray(arr) { return eeg32_arrayWithoutHoles(arr) || eeg32_iterableToArray(arr) || eeg32_unsupportedIterableToArray(arr) || eeg32_nonIterableSpread(); }

function eeg32_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function eeg32_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return eeg32_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return eeg32_arrayLikeToArray(o, minLen); }

function eeg32_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function eeg32_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return eeg32_arrayLikeToArray(arr); }

function eeg32_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function eeg32_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { eeg32_typeof = function _typeof(obj) { return typeof obj; }; } else { eeg32_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return eeg32_typeof(obj); }

function eeg32_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function eeg32_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function eeg32_createClass(Constructor, protoProps, staticProps) { if (protoProps) eeg32_defineProperties(Constructor.prototype, protoProps); if (staticProps) eeg32_defineProperties(Constructor, staticProps); return Constructor; }

//Joshua Brewster, GPL (copyleft)
 //For async functions on node\\

var eeg32 = /*#__PURE__*/function () {
  //Contains structs and necessary functions/API calls to analyze serial data for the FreeEEG32
  function eeg32() {
    var onDecodedCallback = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.onDecodedCallback;
    var onConnectedCallback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onConnectedCallback;
    var onDisconnectedCallback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.onDisconnectedCallback;
    var CustomDecoder = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : this.decode;
    var baudrate = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 115200;

    eeg32_classCallCheck(this, eeg32);

    this.onDecodedCallback = onDecodedCallback;
    this.onConnectedCallback = onConnectedCallback;
    this.onDisconnectedCallback = onDisconnectedCallback;
    this.decode = CustomDecoder; //Free EEG 32 data structure:

    /*
        [stop byte, start byte, counter byte, 32x3 channel data bytes (24 bit), 3x2 accelerometer data bytes, stop byte, start byte...] Gyroscope not enabled yet but would be printed after the accelerometer..
        Total = 105 bytes/line
    */

    this.connected = false;
    this.subscribed = false;
    this.buffer = [];
    this.startByte = 160; // Start byte value

    this.stopByte = 192; // Stop byte value

    this.searchString = new Uint8Array([this.stopByte, this.startByte]); //Byte search string

    this.readRate = 16.666667; //Throttle EEG read speed. (1.953ms/sample min @103 bytes/line)

    this.readBufferSize = 2000; //Serial read buffer size, increase for slower read speeds (~1030bytes every 20ms) to keep up with the stream (or it will crash)

    this.sps = 512; // Sample rate

    this.nChannels = 32;
    this.nPeripheralChannels = 6; // accelerometer and gyroscope (2 bytes * 3 coordinates each)

    this.updateMs = 1000 / this.sps; //even spacing

    this.stepSize = 1 / Math.pow(2, 24);
    this.vref = 2.50; //2.5V voltage ref +/- 250nV

    this.gain = 8;
    this.vscale = this.vref / this.gain * this.stepSize; //volts per step.

    this.uVperStep = 1000000 * (this.vref / this.gain * this.stepSize); //uV per step.

    this.scalar = 1 / (1000000 / (this.vref / this.gain * this.stepSize)); //steps per uV.

    this.maxBufferedSamples = this.sps * 60 * 2; //max samples in buffer this.sps*60*nMinutes = max minutes of data

    this.data = {
      //Data object to keep our head from exploding. Get current data with e.g. this.data.A0[this.data.count-1]
      count: 0,
      startms: 0,
      ms: [],
      'A0': [],
      'A1': [],
      'A2': [],
      'A3': [],
      'A4': [],
      'A5': [],
      'A6': [],
      'A7': [],
      //ADC 0
      'A8': [],
      'A9': [],
      'A10': [],
      'A11': [],
      'A12': [],
      'A13': [],
      'A14': [],
      'A15': [],
      //ADC 1
      'A16': [],
      'A17': [],
      'A18': [],
      'A19': [],
      'A20': [],
      'A21': [],
      'A22': [],
      'A23': [],
      //ADC 2
      'A24': [],
      'A25': [],
      'A26': [],
      'A27': [],
      'A28': [],
      'A29': [],
      'A30': [],
      'A31': [],
      //ADC 3
      'Ax': [],
      'Ay': [],
      'Az': [],
      'Gx': [],
      'Gy': [],
      'Gz': [] //Peripheral data (accelerometer, gyroscope)

    };
    this.resetDataBuffers(); //navigator.serial utils

    if (!navigator.serial) {
      console.error("`navigator.serial not found! Enable #enable-experimental-web-platform-features in chrome://flags (search 'experimental')");
    }

    this.port = null;
    this.reader = null;
    this.baudrate = baudrate;
  }

  eeg32_createClass(eeg32, [{
    key: "resetDataBuffers",
    value: function resetDataBuffers() {
      this.data.count = 0;
      this.data.startms = 0;

      for (var prop in this.data) {
        if (eeg32_typeof(this.data[prop]) === "object") {
          this.data[prop] = new Array(this.maxBufferedSamples).fill(0);
        }
      }
    }
  }, {
    key: "setScalar",
    value: function setScalar() {
      var gain = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 24;
      var stepSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1 / (Math.pow(2, 23) - 1);
      var vref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 4.50;
      this.stepSize = stepSize;
      this.vref = vref; //2.5V voltage ref +/- 250nV

      this.gain = gain;
      this.vscale = this.vref / this.gain * this.stepSize; //volts per step.

      this.uVperStep = 1000000 * (this.vref / this.gain * this.stepSize); //uV per step.

      this.scalar = 1 / (1000000 / (this.vref / this.gain * this.stepSize)); //steps per uV.
    }
  }, {
    key: "getLatestData",
    value: function getLatestData() {
      var channel = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "A0";
      var count = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      //Return slice of specified size of the latest data from the specified channel
      var ct = count;

      if (ct <= 1) {
        return [this.data[channel][this.data.count - 1]];
      } else {
        if (ct > this.data.count) {
          ct = this.data.count;
        }

        return this.data[channel].slice(this.data.count - ct, this.data.count);
      }
    }
  }, {
    key: "bytesToInt16",
    value: function bytesToInt16(x0, x1) {
      return x0 * 256 + x1;
    }
  }, {
    key: "int16ToBytes",
    value: function int16ToBytes(y) {
      //Turns a 24 bit int into a 3 byte sequence
      return [y & 0xFF, y >> 8 & 0xFF];
    }
  }, {
    key: "bytesToInt24",
    value: function bytesToInt24(x0, x1, x2) {
      //Turns a 3 byte sequence into a 24 bit int
      return x0 * 65536 + x1 * 256 + x2;
    }
  }, {
    key: "int24ToBytes",
    value: function int24ToBytes(y) {
      //Turns a 24 bit int into a 3 byte sequence
      return [y & 0xFF, y >> 8 & 0xFF, y >> 16 & 0xFF];
    }
  }, {
    key: "decode",
    value: function decode() {
      var buffer = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.buffer;
      //returns true if successful, returns false if not
      var needle = this.searchString;
      var haystack = buffer;
      var search = this.boyerMoore(needle);
      var skip = search.byteLength;
      var indices = [];
      var newLines = 0;

      for (var i = search(haystack); i !== -1; i = search(haystack, i + skip)) {
        indices.push(i);
      } //console.log(indices);


      if (indices.length >= 2) {
        for (var k = 1; k < indices.length; k++) {
          if (indices[k] - indices[k - 1] !== 105) {} //This is not a valid sequence going by size, drop sequence and return
          else {
              var line = buffer.slice(indices[k - 1], indices[k] + 1); //Splice out this line to be decoded
              // line[0] = stop byte, line[1] = start byte, line[2] = counter, line[3:99] = ADC data 32x3 bytes, line[100-104] = Accelerometer data 3x2 bytes
              //line found, decode.

              if (this.data.count < this.maxBufferedSamples) {
                this.data.count++;
              }

              if (this.data.count - 1 === 0) {
                this.data.ms[this.data.count - 1] = Date.now();
                this.data.startms = this.data.ms[0];
              } else {
                this.data.ms[this.data.count - 1] = this.data.ms[this.data.count - 2] + this.updateMs;

                if (this.data.count >= this.maxBufferedSamples) {
                  this.data.ms.splice(0, 5120);
                  this.data.ms.push(new Array(5120).fill(0));
                }
              } //Assume no dropped samples


              for (var i = 3; i < 99; i += 3) {
                var channel = "A" + (i - 3) / 3;
                this.data[channel][this.data.count - 1] = this.bytesToInt24(line[i], line[i + 1], line[i + 2]);

                if (this.data.count >= this.maxBufferedSamples) {
                  this.data[channel].splice(0, 5120);
                  this.data[channel].push(new Array(5120).fill(0)); //shave off the last 10 seconds of data if buffer full (don't use shift())
                } //console.log(this.data[channel][this.data.count-1],indices[k], channel)

              }

              this.data["Ax"][this.data.count - 1] = this.bytesToInt16(line[99], line[100]);
              this.data["Ay"][this.data.count - 1] = this.bytesToInt16(line[101], line[102]);
              this.data["Az"][this.data.count - 1] = this.bytesToInt16(line[103], line[104]);

              if (this.data.count >= this.maxBufferedSamples) {
                this.data["Ax"].splice(0, 5120);
                this.data["Ay"].splice(0, 5120);
                this.data["Az"].splice(0, 5120);
                this.data["Ax"].push(new Array(5120).fill(0));
                this.data["Ay"].push(new Array(5120).fill(0));
                this.data["Az"].push(new Array(5120).fill(0));
                this.data.count -= 5120;
              } //console.log(this.data)


              newLines++; //console.log(indices[k-1],indices[k])
              //console.log(buffer[indices[k-1],buffer[indices[k]]])
              //indices.shift();
            }
        }

        if (newLines > 0) buffer.splice(0, indices[indices.length - 1]);
        return newLines; //Continue
      } //else {this.buffer = []; return false;}

    } //Callbacks

  }, {
    key: "onDecodedCallback",
    value: function onDecodedCallback(newLinesInt) {//console.log("new samples:", newLinesInt);
    }
  }, {
    key: "onConnectedCallback",
    value: function onConnectedCallback() {
      console.log("port connected!");
    }
  }, {
    key: "onDisconnectedCallback",
    value: function onDisconnectedCallback() {
      console.log("port disconnected!");
    }
  }, {
    key: "onReceive",
    value: function onReceive(value) {
      var _this$buffer;

      (_this$buffer = this.buffer).push.apply(_this$buffer, eeg32_toConsumableArray(value));

      var newLines = this.decode(this.buffer); //console.log(this.data)
      //console.log("decoding... ", this.buffer.length)

      if (newLines !== false && newLines !== 0 && !isNaN(newLines)) this.onDecodedCallback(newLines);
    }
  }, {
    key: "onPortSelected",
    value: function () {
      var _onPortSelected = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(port) {
        var baud,
            _args = arguments;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                baud = _args.length > 1 && _args[1] !== undefined ? _args[1] : this.baudrate;
                _context.prev = 1;
                _context.prev = 2;
                _context.next = 5;
                return port.open({
                  baudRate: baud,
                  bufferSize: this.readBufferSize
                });

              case 5:
                this.onConnectedCallback();
                this.connected = true;
                this.subscribed = true;
                this.subscribe(port); //this.subscribeSafe(port);

                _context.next = 19;
                break;

              case 11:
                _context.prev = 11;
                _context.t0 = _context["catch"](2);
                _context.next = 15;
                return port.open({
                  baudrate: baud,
                  buffersize: this.readBufferSize
                });

              case 15:
                this.onConnectedCallback();
                this.connected = true;
                this.subscribed = true;
                this.subscribe(port); //this.subscribeSafe(port);

              case 19:
                _context.next = 25;
                break;

              case 21:
                _context.prev = 21;
                _context.t1 = _context["catch"](1);
                console.log(_context.t1);
                this.connected = false;

              case 25:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[1, 21], [2, 11]]);
      }));

      function onPortSelected(_x) {
        return _onPortSelected.apply(this, arguments);
      }

      return onPortSelected;
    }()
  }, {
    key: "subscribe",
    value: function () {
      var _subscribe = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5(port) {
        var _this = this;

        var streamData;
        return regeneratorRuntime.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                if (this.port.readable && this.subscribed === true) {
                  this.reader = port.readable.getReader();

                  streamData = /*#__PURE__*/function () {
                    var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {
                      var _yield$_this$reader$r, value, done;

                      return regeneratorRuntime.wrap(function _callee4$(_context4) {
                        while (1) {
                          switch (_context4.prev = _context4.next) {
                            case 0:
                              _context4.prev = 0;
                              _context4.next = 3;
                              return _this.reader.read();

                            case 3:
                              _yield$_this$reader$r = _context4.sent;
                              value = _yield$_this$reader$r.value;
                              done = _yield$_this$reader$r.done;

                              if (!(done || _this.subscribed === false)) {
                                _context4.next = 9;
                                break;
                              }

                              _context4.next = 9;
                              return _this.reader.releaseLock();

                            case 9:
                              if (value) {
                                //console.log(value.length);
                                try {
                                  _this.onReceive(value);
                                } catch (err) {
                                  console.log(err);
                                } //console.log("new Read");
                                //console.log(this.decoder.decode(value));

                              }

                              if (_this.subscribed === true) {
                                setTimeout(function () {
                                  streamData();
                                }, _this.readRate); //Throttled read 1/512sps = 1.953ms/sample @ 103 bytes / line or 1030bytes every 20ms
                              }

                              _context4.next = 17;
                              break;

                            case 13:
                              _context4.prev = 13;
                              _context4.t0 = _context4["catch"](0);
                              console.log(_context4.t0); // TODO: Handle non-fatal read error.

                              if (_context4.t0.message.includes('framing') || _context4.t0.message.includes('overflow') || _context4.t0.message.includes('overrun') || _context4.t0.message.includes('Overflow') || _context4.t0.message.includes('break')) {
                                _this.subscribed = false;
                                setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
                                  return regeneratorRuntime.wrap(function _callee2$(_context2) {
                                    while (1) {
                                      switch (_context2.prev = _context2.next) {
                                        case 0:
                                          if (!_this.reader) {
                                            _context2.next = 4;
                                            break;
                                          }

                                          _context2.next = 3;
                                          return _this.reader.releaseLock();

                                        case 3:
                                          _this.reader = null;

                                        case 4:
                                          _this.subscribed = true;

                                          _this.subscribe(port); //if that fails then close port and reopen it


                                        case 6:
                                        case "end":
                                          return _context2.stop();
                                      }
                                    }
                                  }, _callee2);
                                })), 30); //try to resubscribe 
                              } else if (_context4.t0.message.includes('parity') || _context4.t0.message.includes('Parity')) {
                                if (_this.port) {
                                  _this.subscribed = false;
                                  setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {
                                    return regeneratorRuntime.wrap(function _callee3$(_context3) {
                                      while (1) {
                                        switch (_context3.prev = _context3.next) {
                                          case 0:
                                            if (!_this.reader) {
                                              _context3.next = 4;
                                              break;
                                            }

                                            _context3.next = 3;
                                            return _this.reader.releaseLock();

                                          case 3:
                                            _this.reader = null;

                                          case 4:
                                            _context3.next = 6;
                                            return port.close();

                                          case 6:
                                            //this.port = null;
                                            _this.connected = false;
                                            setTimeout(function () {
                                              _this.onPortSelected(_this.port);
                                            }, 100); //close the port and reopen

                                          case 8:
                                          case "end":
                                            return _context3.stop();
                                        }
                                      }
                                    }, _callee3);
                                  })), 50);
                                }
                              } else {
                                _this.closePort();
                              }

                            case 17:
                            case "end":
                              return _context4.stop();
                          }
                        }
                      }, _callee4, null, [[0, 13]]);
                    }));

                    return function streamData() {
                      return _ref.apply(this, arguments);
                    };
                  }();

                  streamData();
                }

              case 1:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function subscribe(_x2) {
        return _subscribe.apply(this, arguments);
      }

      return subscribe;
    }() //Unfinished

  }, {
    key: "subscribeSafe",
    value: function () {
      var _subscribeSafe = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6(port) {
        var _this2 = this;

        var readable;
        return regeneratorRuntime.wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                //Using promises instead of async/await to cure hangs when the serial update does not meet tick requirements
                readable = new Promise(function (resolve, reject) {
                  while (_this2.port.readable && _this2.subscribed === true) {
                    _this2.reader = port.readable.getReader();
                    var looper = true;
                    var prom1 = new Promise(function (resolve, reject) {
                      return _this2.reader.read();
                    });
                    var prom2 = new Promise(function (resolve, reject) {
                      setTimeout(resolve, 100, "readfail");
                    });

                    while (looper === true) {
                      //console.log("reading...");
                      Promise.race([prom1, prom2]).then(function (result) {
                        console.log("newpromise");

                        if (result === "readfail") {
                          console.log(result);
                        } else {
                          var value = result.value,
                              done = result.done;

                          if (done === true || _this2.subscribed === true) {
                            var donezo = new Promise(function (resolve, reject) {
                              resolve(_this2.reader.releaseLock());
                            }).then(function () {
                              looper = false;
                              return;
                            });
                          } else {
                            _this2.onReceive(value);
                          }
                        }
                      });
                    }
                  }

                  resolve("not readable");
                });

              case 1:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6);
      }));

      function subscribeSafe(_x3) {
        return _subscribeSafe.apply(this, arguments);
      }

      return subscribeSafe;
    }()
  }, {
    key: "closePort",
    value: function () {
      var _closePort = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee8() {
        var _this3 = this;

        var port,
            _args8 = arguments;
        return regeneratorRuntime.wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                port = _args8.length > 0 && _args8[0] !== undefined ? _args8[0] : this.port;

                //if(this.reader) {this.reader.releaseLock();}
                if (this.port) {
                  this.subscribed = false;
                  setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7() {
                    return regeneratorRuntime.wrap(function _callee7$(_context7) {
                      while (1) {
                        switch (_context7.prev = _context7.next) {
                          case 0:
                            if (!_this3.reader) {
                              _context7.next = 4;
                              break;
                            }

                            _context7.next = 3;
                            return _this3.reader.releaseLock();

                          case 3:
                            _this3.reader = null;

                          case 4:
                            _context7.next = 6;
                            return port.close();

                          case 6:
                            _this3.port = null;
                            _this3.connected = false;

                            _this3.onDisconnectedCallback();

                          case 9:
                          case "end":
                            return _context7.stop();
                        }
                      }
                    }, _callee7);
                  })), 100);
                }

              case 2:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function closePort() {
        return _closePort.apply(this, arguments);
      }

      return closePort;
    }()
  }, {
    key: "setupSerialAsync",
    value: function () {
      var _setupSerialAsync = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee9() {
        var _this4 = this;

        var baudrate,
            filters,
            _args9 = arguments;
        return regeneratorRuntime.wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                baudrate = _args9.length > 0 && _args9[0] !== undefined ? _args9[0] : this.baudrate;
                //You can specify baudrate just in case
                filters = [{
                  usbVendorId: 0x10c4,
                  usbProductId: 0x0043
                } //CP2102 filter (e.g. for UART via ESP32)
                ];
                _context9.next = 4;
                return navigator.serial.requestPort();

              case 4:
                this.port = _context9.sent;
                navigator.serial.addEventListener("disconnect", function (e) {
                  _this4.closePort(_this4.port);
                });
                this.onPortSelected(this.port, baudrate); //navigator.serial.addEventListener("onReceive", (e) => {console.log(e)});//this.onReceive(e));

              case 7:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function setupSerialAsync() {
        return _setupSerialAsync.apply(this, arguments);
      }

      return setupSerialAsync;
    }() //Boyer Moore fast byte search method copied from https://codereview.stackexchange.com/questions/20136/uint8array-indexof-method-that-allows-to-search-for-byte-sequences

  }, {
    key: "asUint8Array",
    value: function asUint8Array(input) {
      if (input instanceof Uint8Array) {
        return input;
      } else if (typeof input === 'string') {
        // This naive transform only supports ASCII patterns. UTF-8 support
        // not necessary for the intended use case here.
        var arr = new Uint8Array(input.length);

        for (var i = 0; i < input.length; i++) {
          var c = input.charCodeAt(i);

          if (c > 127) {
            throw new TypeError("Only ASCII patterns are supported");
          }

          arr[i] = c;
        }

        return arr;
      } else {
        // Assume that it's already something that can be coerced.
        return new Uint8Array(input);
      }
    }
  }, {
    key: "boyerMoore",
    value: function boyerMoore(patternBuffer) {
      var _this5 = this;

      // Implementation of Boyer-Moore substring search ported from page 772 of
      // Algorithms Fourth Edition (Sedgewick, Wayne)
      // http://algs4.cs.princeton.edu/53substring/BoyerMoore.java.html

      /*
      USAGE:
      	// needle should be ASCII string, ArrayBuffer, or Uint8Array
      	// haystack should be an ArrayBuffer or Uint8Array
      	var search = boyerMoore(needle);
      	var skip = search.byteLength;
      	var indices = [];
      	for (var i = search(haystack); i !== -1; i = search(haystack, i + skip)) {
      		indices.push(i);
      	}
      */
      var pattern = this.asUint8Array(patternBuffer);
      var M = pattern.length;

      if (M === 0) {
        throw new TypeError("patternBuffer must be at least 1 byte long");
      } // radix


      var R = 256;
      var rightmost_positions = new Int32Array(R); // position of the rightmost occurrence of the byte c in the pattern

      for (var c = 0; c < R; c++) {
        // -1 for bytes not in pattern
        rightmost_positions[c] = -1;
      }

      for (var j = 0; j < M; j++) {
        // rightmost position for bytes in pattern
        rightmost_positions[pattern[j]] = j;
      }

      var boyerMooreSearch = function boyerMooreSearch(txtBuffer, start, end) {
        // Return offset of first match, -1 if no match.
        var txt = _this5.asUint8Array(txtBuffer);

        if (start === undefined) start = 0;
        if (end === undefined) end = txt.length;
        var pat = pattern;
        var right = rightmost_positions;
        var lastIndex = end - pat.length;
        var lastPatIndex = pat.length - 1;
        var skip;

        for (var i = start; i <= lastIndex; i += skip) {
          skip = 0;

          for (var j = lastPatIndex; j >= 0; j--) {
            var c = txt[i + j];

            if (pat[j] !== c) {
              skip = Math.max(1, j - right[c]);
              break;
            }
          }

          if (skip === 0) {
            return i;
          }
        }

        return -1;
      };

      boyerMooreSearch.byteLength = pattern.byteLength;
      return boyerMooreSearch;
    } //---------------------end copy/pasted solution------------------------

  }]);

  return eeg32;
}();
;// CONCATENATED MODULE: ./src/libraries/js/src/utils/BiquadFilters.js
function BiquadFilters_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function BiquadFilters_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function BiquadFilters_createClass(Constructor, protoProps, staticProps) { if (protoProps) BiquadFilters_defineProperties(Constructor.prototype, protoProps); if (staticProps) BiquadFilters_defineProperties(Constructor, staticProps); return Constructor; }

//https://arachnoid.com/phase_locked_loop/resources/biquad_module.py
//Translated to JS by Josh Brewster
var Biquad = /*#__PURE__*/function () {
  function Biquad(type, freq, sps) {
    var Q = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1 / Math.sqrt(2);
    var dbGain = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;

    BiquadFilters_classCallCheck(this, Biquad);

    var types = ['lowpass', 'highpass', 'bandpass', 'notch', 'peak', 'lowshelf', 'highshelf'];

    if (types.indexOf(type) < 0) {
      console.error("Valid types: 'lowpass','highpass','bandpass','notch','peak','lowshelf','highshelf'");
      return false;
    }

    this.type = type;
    this.freq = freq;
    this.sps = sps;
    this.Q = Q;
    this.dbGain = dbGain;
    this.a0 = 0, this.a1 = 0, this.a2 = 0, this.b0 = 0, this.b1 = 0, this.b2 = 0;
    this.x1 = 0, this.x2 = 0, this.y1 = 0, this.y2 = 0;
    var A = Math.pow(10, dbGain / 40);
    var omega = 2 * Math.PI * freq / sps;
    var sn = Math.sin(omega);
    var cs = Math.cos(omega);
    var alpha = sn / (2 * Q);
    var beta = Math.sqrt(A + A);
    this[type](A, sn, cs, alpha, beta); //scale constants

    this.b0 /= this.a0;
    this.b1 /= this.a0;
    this.b2 /= this.a0;
    this.a1 /= this.a0;
    this.a2 /= this.a0;
  }

  BiquadFilters_createClass(Biquad, [{
    key: "lowpass",
    value: function lowpass(A, sn, cs, alpha, beta) {
      //Stop upper frequencies
      this.b0 = (1 - cs) * .5;
      this.b1 = 1 - cs;
      this.b2 = (1 - cs) * .5;
      this.a0 = 1 + alpha;
      this.a1 = -2 * cs;
      this.a2 = 1 - alpha;
    }
  }, {
    key: "highpass",
    value: function highpass(A, sn, cs, alpha, beta) {
      //Stop lower frequencies 
      this.b0 = (1 + cs) * .5;
      this.b1 = -(1 + cs);
      this.b2 = (1 + cs) * .5;
      this.a0 = 1 + alpha;
      this.a1 = -2 * cs;
      this.a2 = 1 - alpha;
    }
  }, {
    key: "bandpass",
    value: function bandpass(A, sn, cs, alpha, beta) {
      //Stop lower and upper frequencies. Q = frequency_resonant / Bandwidth(to 3db cutoff line); frequency_resonant = Math.sqrt(f_low * f_high); So for 60Hz with 0.5Hz bandwidth: Fr = Math.sqrt(59.5*60.5). Q = Fr/0.5 = 120;
      this.b0 = alpha;
      this.b1 = 0;
      this.b2 = -alpha;
      this.a0 = 1 + alpha;
      this.a1 = -2 * cs;
      this.a2 = 1 - alpha;
    }
  }, {
    key: "notch",
    value: function notch(A, sn, cs, alpha, beta) {
      //Stop a specific frequency
      this.b0 = 1;
      this.b1 = -2 * cs;
      this.b2 = 1;
      this.a0 = 1 + alpha;
      this.a1 = -2 * cs;
      this.a2 = 1 - alpha;
    }
  }, {
    key: "peak",
    value: function peak(A, sn, cs, alpha, beta) {
      //Opposite of a notch filter, stop all but one frequency
      this.b0 = 1 + alpha * A;
      this.b1 = -2 * cs;
      this.b2 = 1 - alpha * A;
      this.a0 = 1 + alpha / A;
      this.a1 = -2 * cs;
      this.a2 = 1 - alpha / A;
    }
  }, {
    key: "lowshelf",
    value: function lowshelf(A, sn, cs, alpha, beta) {
      //Amplify signals below the cutoff
      this.b0 = A * (A + 1 - (A - 1) * cs + beta * sn);
      this.b1 = 2 * A * (A - 1 - (A + 1) * cs);
      this.b2 = A * (A + 1 - (A - 1) * cs - beta * sn);
      this.a0 = A + 1 + (A + 1) * cs + beta * sn;
      this.a1 = 2 * (A - 1 + (A + 1) * cs);
      this.a2 = A + 1 + (A - 1) * cs - beta * sn;
    }
  }, {
    key: "highshelf",
    value: function highshelf(A, sn, cs, alpha, beta) {
      //Amplify signals above the cutoff
      this.b0 = A * (A + 1 + (A - 1) * cs + beta * sn);
      this.b1 = 2 * A * (A - 1 + (A + 1) * cs);
      this.b2 = A * (A + 1 - (A - 1) * cs - beta * sn);
      this.a0 = A + 1 - (A + 1) * cs - beta * sn;
      this.a1 = 2 * (A - 1 - (A + 1) * cs);
      this.a2 = A + 1 - (A - 1) * cs - beta * sn;
    }
  }, {
    key: "applyFilter",
    value: function applyFilter(signal_step) {
      //Step the filter forward, return modulated signal amplitude
      var y = this.b0 * signal_step + this.b1 * this.x1 + this.b2 * this.x2 - this.a1 * this.y1 - this.a2 * this.y2;
      this.x2 = this.x1;
      this.x1 = signal_step;
      this.y2 = this.y1;
      this.y1 = y;
      return y;
    }
  }, {
    key: "zResult",
    value: function zResult(freq) {
      //This should return the z-transfer function values. Max freq = sps/2
      try {
        var phi = Math.pow(Math.sin(Math.PI * freq * 2 / (2 * this.sps)), 2);
        var result = (Math.pow(this.b0 + this.b1 + this.b2, 2) - 4 * (this.b0 * this.b1 + 4 * this.b0 * this.b2 + this.b1 * this.b2) * phi + 16 * this.b0 * this.b2 * phi * phi) / (Math.pow(1 + this.a1 + this.a2, 2) - 4 * (this.a1 + 4 * this.a2 + this.a1 * this.a2) * phi + 16 * this.a2 * phi * phi);
        return result;
      } catch (err) {
        return -200;
      }
    } //Get the center frequency for your bandpass filter

  }], [{
    key: "calcCenterFrequency",
    value: function calcCenterFrequency(freqStart, freqEnd) {
      return (freqStart + freqEnd) / 2;
    }
  }, {
    key: "calcBandwidth",
    value: function calcBandwidth(freqStart, freqEnd) {
      return freqEnd - this.calcCenterFrequency(freqStart, freqEnd);
    } //Use for bandpass or peak filter //Q gets sharper as resonance approaches infinity. Set to 500 for example for a more precise filter. Recommended r: Math.floor(Math.log10(frequency))

  }, {
    key: "calcBandpassQ",
    value: function calcBandpassQ(frequency, bandwidth) {
      var resonance = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Math.pow(10, Math.floor(Math.log10(frequency)));
      //Use Math.sqrt(0.5) for low pass, high pass, and shelf filters
      var Q = resonance * Math.sqrt((frequency - bandwidth) * (frequency + bandwidth)) / (2 * bandwidth); //tweaked

      return Q;
    }
  }, {
    key: "calcNotchQ",
    value: function calcNotchQ(frequency, bandwidth) {
      var resonance = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Math.pow(10, Math.floor(Math.log10(frequency)));
      //Q gets sharper as resonance approaches infinity. Recommended r: Math.floor(Math.log10(frequency))
      var Q = resonance * frequency * bandwidth / Math.sqrt((frequency - bandwidth) * (frequency + bandwidth)); // bw/f

      return Q;
    }
  }]);

  return Biquad;
}();
var DCBlocker = /*#__PURE__*/function () {
  function DCBlocker() {
    var r = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0.995;

    BiquadFilters_classCallCheck(this, DCBlocker);

    this.r = r;
    this.y1 = this.y2 = this.x1 = this.x2 = 0;
  }

  BiquadFilters_createClass(DCBlocker, [{
    key: "applyFilter",
    value: function applyFilter(signal_step) {
      this.x2 = this.x1;
      this.x1 = signal_step;
      var y = this.x1 - this.x2 + this.r * this.y1;
      this.y2 = this.y1;
      this.y1 = y;
      return y;
    }
  }]);

  return DCBlocker;
}();
/* 

  let notch = new Biquad('notch',60,512,Biquad.calcNotchQ(60,1),0);

  let bandpass = new Biquad('bandpass',
                            Biquad.calcCenterFrequency(3,45),
                            512,
                            Biquad.calcBandpassQ(Biquad.calcCenterFrequency(3,45),Biquad.calcBandwidth(3,45)),
                            0);

*/
//Macros

var makeNotchFilter = function makeNotchFilter(frequency, sps, bandwidth) {
  return new Biquad('notch', frequency, sps, Biquad.calcNotchQ(frequency, bandwidth), 0);
};
var makeBandpassFilter = function makeBandpassFilter(freqStart, freqEnd, sps) {
  var resonance = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : Math.pow(10, Math.floor(Math.log10(Biquad.calcCenterFrequency(freqStart, freqEnd))));
  return new Biquad('bandpass', Biquad.calcCenterFrequency(freqStart, freqEnd), sps, Biquad.calcBandpassQ(Biquad.calcCenterFrequency(freqStart, freqEnd), Biquad.calcBandwidth(freqStart, freqEnd), resonance), 0);
}; //Macro for running multiple filter passes over a signal. 

var BiquadChannelFilterer = /*#__PURE__*/function () {
  function BiquadChannelFilterer() {
    var channel = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "A0";
    var sps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 512;
    var filtering = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
    var scalingFactor = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;

    BiquadFilters_classCallCheck(this, BiquadChannelFilterer);

    this.channel = channel;
    this.idx = 0;
    this.sps = sps;
    this.filtering = filtering;
    this.bplower = 3;
    this.bpupper = 45;
    this.scalingFactor = scalingFactor;
    this.useSMA4 = false;
    this.last4 = [];
    this.useNotch50 = true;
    this.useNotch60 = true;
    this.useLp1 = false;
    this.useBp1 = false;
    this.useDCB = true;
    this.useScaling = false;
    this.notch50 = [makeNotchFilter(50, sps, 1), makeNotchFilter(100, sps, 1)];
    this.notch60 = [makeNotchFilter(60, sps, 1), makeNotchFilter(120, sps, 1)];
    this.lp1 = [new Biquad('lowpass', 50, sps), new Biquad('lowpass', 50, sps), new Biquad('lowpass', 50, sps), new Biquad('lowpass', 50, sps)];
    this.bp1 = [makeBandpassFilter(this.bplower, this.bpupper, sps, 9.75), makeBandpassFilter(this.bplower, this.bpupper, sps, 9.75), makeBandpassFilter(this.bplower, this.bpupper, sps, 9.75), makeBandpassFilter(this.bplower, this.bpupper, sps, 9.75)];
    this.dcb = new DCBlocker(0.995);
  }

  BiquadFilters_createClass(BiquadChannelFilterer, [{
    key: "reset",
    value: function reset() {
      var sps = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.sps;
      this.notch50 = makeNotchFilter(50, sps, 1);
      this.notch60 = makeNotchFilter(60, sps, 1);
      this.lp1 = [new Biquad('lowpass', 50, sps), new Biquad('lowpass', 50, sps), new Biquad('lowpass', 50, sps), new Biquad('lowpass', 50, sps)];
      this.bp1 = [makeBandpassFilter(this.bplower, this.bpupper, sps, 9.75), makeBandpassFilter(this.bplower, this.bpupper, sps, 9.75), makeBandpassFilter(this.bplower, this.bpupper, sps, 9.75), makeBandpassFilter(this.bplower, this.bpupper, sps, 9.75)];
      this.dcb = new DCBlocker(0.995);
    }
  }, {
    key: "setBandpass",
    value: function setBandpass() {
      var bplower = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.bplower;
      var bpupper = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.bpupper;
      var sps = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.sps;
      this.bplower = bplower;
      this.bpupper = bpupper;
      this.bp1 = [makeBandpassFilter(bplower, bpupper, sps), makeBandpassFilter(bplower, bpupper, sps), makeBandpassFilter(bplower, bpupper, sps), makeBandpassFilter(bplower, bpupper, sps)];
    }
  }, {
    key: "apply",
    value: function apply() {
      var latestData = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      var idx = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.lastidx + 1;
      var out = latestData;

      if (this.filtering === true) {
        if (this.useDCB === true) {
          //Apply a DC blocking filter
          out = this.dcb.applyFilter(out);
        }

        if (this.useSMA4 === true) {
          // 4 sample simple moving average (i.e. low pass)
          if (idx < 4) {
            this.last4.push(out);
          } else {
            out = this.last4.reduce(function (accumulator, currentValue) {
              return accumulator + currentValue;
            }) / this.last4.length;
            this.last4.shift();
            this.last4.push(out);
          }
        }

        if (this.useNotch50 === true) {
          //Apply a 50hz notch filter
          this.notch50.forEach(function (f, i) {
            out = f.applyFilter(out);
          });
        }

        if (this.useNotch60 === true) {
          //Apply a 60hz notch filter
          this.notch60.forEach(function (f, i) {
            out = f.applyFilter(out);
          });
        }

        if (this.useLp1 === true) {
          //Apply 4 50Hz lowpass filters
          this.lp1.forEach(function (f, i) {
            out = f.applyFilter(out);
          });
        }

        if (this.useBp1 === true) {
          //Apply 4 Bandpass filters
          this.bp1.forEach(function (f, i) {
            out = f.applyFilter(out);
          });
          out *= this.bp1.length;
        }

        if (this.useScaling === true) {
          out *= this.scalingFactor;
        }
      }

      this.lastidx = idx; //console.log(this.channel, out)

      return out;
    }
  }]);

  return BiquadChannelFilterer;
}();
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/freeeeg32/freeeeg32Plugin.js
function freeeeg32Plugin_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { freeeeg32Plugin_typeof = function _typeof(obj) { return typeof obj; }; } else { freeeeg32Plugin_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return freeeeg32Plugin_typeof(obj); }

function freeeeg32Plugin_toConsumableArray(arr) { return freeeeg32Plugin_arrayWithoutHoles(arr) || freeeeg32Plugin_iterableToArray(arr) || freeeeg32Plugin_unsupportedIterableToArray(arr) || freeeeg32Plugin_nonIterableSpread(); }

function freeeeg32Plugin_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function freeeeg32Plugin_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return freeeeg32Plugin_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return freeeeg32Plugin_arrayLikeToArray(o, minLen); }

function freeeeg32Plugin_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function freeeeg32Plugin_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return freeeeg32Plugin_arrayLikeToArray(arr); }

function freeeeg32Plugin_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function freeeeg32Plugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function freeeeg32Plugin_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { freeeeg32Plugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { freeeeg32Plugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function freeeeg32Plugin_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

//Template system to feed into the deviceStream class for creating possible configurations. 
//Just fill out the template functions accordingly and add this class (with a unique name) to the list of usable devices.




var eeg32Plugin = function eeg32Plugin() {
  var _this = this;

  var mode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "freeeeg32_2";
  var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onconnect;
  var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.ondisconnect;

  freeeeg32Plugin_classCallCheck(this, eeg32Plugin);

  this.init = /*#__PURE__*/function () {
    var _ref = freeeeg32Plugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(info, pipeToAtlas) {
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _this.info = info;
              info.sps = 512;
              info.deviceType = 'eeg';

              if (_this.mode === "freeeeg32_2") {
                info.eegChannelTags = [{
                  ch: 4,
                  tag: "FP2",
                  analyze: true
                }, {
                  ch: 24,
                  tag: "FP1",
                  analyze: true
                }, {
                  ch: 8,
                  tag: "other",
                  analyze: false
                }];
              } else if (_this.mode === 'freeeeg32_19') {
                info.eegChannelTags = [{
                  ch: 4,
                  tag: "FP2",
                  analyze: true
                }, {
                  ch: 24,
                  tag: "FP1",
                  analyze: true
                }, {
                  ch: 0,
                  tag: "O2",
                  analyze: true
                }, {
                  ch: 1,
                  tag: "T6",
                  analyze: true
                }, {
                  ch: 2,
                  tag: "T4",
                  analyze: true
                }, {
                  ch: 3,
                  tag: "F8",
                  analyze: true
                }, {
                  ch: 5,
                  tag: "F4",
                  analyze: true
                }, {
                  ch: 6,
                  tag: "C4",
                  analyze: true
                }, {
                  ch: 7,
                  tag: "P4",
                  analyze: true
                }, {
                  ch: 25,
                  tag: "F3",
                  analyze: true
                }, {
                  ch: 26,
                  tag: "C3",
                  analyze: true
                }, {
                  ch: 27,
                  tag: "P3",
                  analyze: true
                }, {
                  ch: 28,
                  tag: "O1",
                  analyze: true
                }, {
                  ch: 29,
                  tag: "T5",
                  analyze: true
                }, {
                  ch: 30,
                  tag: "T3",
                  analyze: true
                }, {
                  ch: 31,
                  tag: "F7",
                  analyze: true
                }, {
                  ch: 16,
                  tag: "FZ",
                  analyze: true
                }, {
                  ch: 12,
                  tag: "PZ",
                  analyze: true
                }, {
                  ch: 8,
                  tag: "other",
                  analyze: false
                }];
              } else {
                info.eegChannelTags = [{
                  ch: 4,
                  tag: "FP2",
                  analyze: true
                }, {
                  ch: 24,
                  tag: "FP1",
                  analyze: true
                }, {
                  ch: 8,
                  tag: "other",
                  analyze: false
                }];
              }

              _this.device = new eeg32(function (newLinesInt) {
                _this.atlas.data.eegshared.eegChannelTags.forEach(function (o, i) {
                  var latest = _this.device.getLatestData("A" + o.ch, newLinesInt);

                  var latestFiltered = new Array(latest.length).fill(0);

                  if (o.tag !== "other" && info.useFilters === true) {
                    _this.filters.find(function (f, j) {
                      if (f.channel === o.ch) {
                        latest.forEach(function (sample, k) {
                          latestFiltered[k] = f.apply(sample);
                        });
                        return true;
                      }
                    });

                    if (info.useAtlas === true) {
                      var _coord$times, _coord$filtered, _coord$raw;

                      var coord;

                      if (o.tag !== null) {
                        coord = _this.atlas.getEEGDataByTag(o.tag);
                      } else {
                        coord = _this.atlas.getEEGDataByChannel(o.ch);
                      }

                      coord.count += newLinesInt;

                      (_coord$times = coord.times).push.apply(_coord$times, freeeeg32Plugin_toConsumableArray(_this.device.data.ms.slice(_this.device.data.count - newLinesInt, _this.device.data.count)));

                      (_coord$filtered = coord.filtered).push.apply(_coord$filtered, freeeeg32Plugin_toConsumableArray(latestFiltered));

                      (_coord$raw = coord.raw).push.apply(_coord$raw, freeeeg32Plugin_toConsumableArray(latest));
                    }
                  } else {
                    if (info.useAtlas === true) {
                      var _coord$times2, _coord$raw2;

                      var _coord = _this.atlas.getEEGDataByChannel(o.ch);

                      _coord.count += newLinesInt;

                      (_coord$times2 = _coord.times).push.apply(_coord$times2, freeeeg32Plugin_toConsumableArray(_this.device.data.ms.slice(_this.device.data.count - newLinesInt, _this.device.data.count)));

                      (_coord$raw2 = _coord.raw).push.apply(_coord$raw2, freeeeg32Plugin_toConsumableArray(latest));
                    }
                  }
                });
              }, function () {
                _this.setupAtlas(pipeToAtlas, info);

                if (info.useAtlas === true) {
                  _this.atlas.data.eegshared.startTime = Date.now();

                  if (_this.atlas.settings.analyzing !== true && info.analysis.length > 0) {
                    _this.atlas.settings.analyzing = true;
                    _this.atlas.settings.deviceConnected = true;
                    setTimeout(function () {
                      _this.atlas.analyzer();
                    }, 1200);
                  }

                  _this.onconnect();
                }
              }, function () {
                _this.atlas.settings.analyzing = false;

                _this.ondisconnect();
              });

            case 5:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }();

  this.setupAtlas = function (pipeToAtlas, info) {
    if (info.useFilters === true) {
      info.eegChannelTags.forEach(function (row, i) {
        if (row.tag !== 'other') {
          _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, true, _this.device.uVperStep));
        } else {
          _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, false, _this.device.uVperStep));
        }

        _this.filters[_this.filters.length - 1].useScaling = true; //this.filters[this.filters.length-1].useBp1 = true;
      });
    }

    if (pipeToAtlas === true) {
      var config = '10_20';
      _this.atlas = new DataAtlas_DataAtlas(location + ":" + _this.mode, {
        eegshared: {
          eegChannelTags: info.eegChannelTags,
          sps: info.sps
        }
      }, config, true, true, info.analysis);
      info.useAtlas = true;
    } else if (freeeeg32Plugin_typeof(pipeToAtlas) === 'object') {
      _this.atlas = pipeToAtlas; //External atlas reference

      _this.atlas.data.eegshared.eegChannelTags = info.eegChannelTags;
      _this.atlas.data.eegshared.sps = info.sps;
      _this.atlas.data.eegshared.frequencies = _this.atlas.bandpassWindow(0, 128, info.sps * 0.5);
      _this.atlas.data.eegshared.bandFreqs = _this.atlas.getBandFreqs(_this.atlas.data.eegshared.frequencies);
      _this.atlas.data.eeg = _this.atlas.gen10_20Atlas();
      _this.atlas.data.coherence = _this.atlas.genCoherenceMap(info.eegChannelTags);

      _this.atlas.data.eegshared.eegChannelTags.forEach(function (row, i) {
        if (_this.atlas.getEEGDataByTag(row.tag) === undefined) {
          _this.atlas.addEEGCoord(row.ch);
        }
      });

      _this.atlas.settings.coherence = true;
      _this.atlas.settings.eeg = true;
      info.useAtlas = true;

      if (info.analysis.length > 0) {
        var _this$atlas$settings$;

        (_this$atlas$settings$ = _this.atlas.settings.analysis).push.apply(_this$atlas$settings$, freeeeg32Plugin_toConsumableArray(info.analysis));

        if (!_this.atlas.settings.analyzing) {
          _this.atlas.settings.analyzing = true;

          _this.atlas.analyzer();
        }
      }
    }
  };

  this.connect = /*#__PURE__*/freeeeg32Plugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
    return regeneratorRuntime.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            _context2.next = 2;
            return _this.device.setupSerialAsync();

          case 2:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  }));

  this.disconnect = function () {
    if (_this.ui) _this.ui.deleteNode();

    _this.device.closePort();
  };

  this.onconnect = function () {};

  this.ondisconnect = function () {};

  this.addControls = function () {
    var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
    var id = Math.floor(Math.random() * 10000); //prevents any possible overlap with other elements

    var template = function template() {
      return "\n            ";
    };

    var setup = function setup() {}; //this.ui = new DOMFragment(
    //    template,
    //    parentNode,
    //    undefined,
    //    setup
    //);

  };

  this.atlas = null;
  this.mode = mode;
  this.device = null; //Invoke a device class here if needed

  this.filters = [];
  this.info;
  this.onconnect = onconnect;
  this.ondisconnect = ondisconnect;
};
// EXTERNAL MODULE: ./node_modules/muse-js/dist/muse.js
var muse = __webpack_require__(2306);
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/musePlugin.js
function musePlugin_toConsumableArray(arr) { return musePlugin_arrayWithoutHoles(arr) || musePlugin_iterableToArray(arr) || musePlugin_unsupportedIterableToArray(arr) || musePlugin_nonIterableSpread(); }

function musePlugin_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function musePlugin_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return musePlugin_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return musePlugin_arrayLikeToArray(o, minLen); }

function musePlugin_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function musePlugin_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return musePlugin_arrayLikeToArray(arr); }

function musePlugin_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function musePlugin_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { musePlugin_typeof = function _typeof(obj) { return typeof obj; }; } else { musePlugin_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return musePlugin_typeof(obj); }

function musePlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function musePlugin_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { musePlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { musePlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function musePlugin_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

//Template system to feed into the deviceStream class for creating possible configurations. 
//Just fill out the template functions accordingly and add this class (with a unique name) to the list of usable devices.




var musePlugin = function musePlugin(mode) {
  var _this = this;

  var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onconnect;
  var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.ondisconnect;

  musePlugin_classCallCheck(this, musePlugin);

  this.init = /*#__PURE__*/function () {
    var _ref = musePlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(info, pipeToAtlas) {
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              info.sps = 256;
              info.deviceType = 'eeg';
              info.eegChannelTags = [{
                ch: 0,
                tag: "TP9",
                analyze: true
              }, {
                ch: 1,
                tag: "AF7",
                analyze: true
              }, {
                ch: 2,
                tag: "AF8",
                analyze: true
              }, {
                ch: 3,
                tag: "TP10",
                analyze: true
              }];
              _this.device = new muse.MuseClient();

              if (_this.mode == 'muse_Aux') {
                _this.device.enableAux = true;
                info.eegChannelTags.push({
                  ch: 4,
                  tag: "AUX",
                  analyze: true
                });
              }

              _this.info = info;

              _this._onConnected = function () {
                _this.setupAtlas(info, pipeToAtlas);
              };

            case 7:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }();

  this.setupAtlas = function (info, pipeToAtlas) {
    if (info.useFilters === true) {
      info.eegChannelTags.forEach(function (row, i) {
        if (row.tag !== 'other') {
          _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, true, 1));
        } else {
          _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, false, 1));
        } //this.filters[this.filters.length-1].useBp1 = true;

      });
    }

    if (pipeToAtlas === true) {
      //New Atlas
      var config = 'muse';
      _this.atlas = new DataAtlas_DataAtlas(location + ":" + _this.mode, {
        eegshared: {
          eegChannelTags: info.eegChannelTags,
          sps: info.sps
        }
      }, config, true, true, info.analysis);
      info.useAtlas = true;
    } else if (musePlugin_typeof(pipeToAtlas) === 'object') {
      //Reusing an atlas
      _this.atlas = pipeToAtlas; //External atlas reference

      _this.atlas.data.eegshared.eegChannelTags = info.eegChannelTags;
      _this.atlas.data.eegshared.sps = info.sps;
      _this.atlas.data.eegshared.frequencies = _this.atlas.bandpassWindow(0, 128, info.sps * 0.5);
      _this.atlas.data.eegshared.bandFreqs = _this.atlas.getBandFreqs(_this.atlas.data.eegshared.frequencies);
      _this.atlas.data.eeg = _this.atlas.genMuseAtlas();
      _this.atlas.data.coherence = _this.atlas.genCoherenceMap(info.eegChannelTags);
      _this.atlas.settings.coherence = true;
      _this.atlas.settings.eeg = true;
      info.useAtlas = true;

      if (info.analysis.length > 0) {
        var _this$atlas$settings$;

        (_this$atlas$settings$ = _this.atlas.settings.analysis).push.apply(_this$atlas$settings$, musePlugin_toConsumableArray(info.analysis));

        if (!_this.atlas.settings.analyzing) {
          _this.atlas.settings.analyzing = true;

          _this.atlas.analyzer();
        }
      }
    }
  };

  this._onConnected = function () {};

  this.timeCorrection = function (coord, data, timestamp) {
    var direction = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 'back';
    // Update Sampling Rate for New Data
    var prevTime = coord.times[coord.times.length - 1];
    if (prevTime == null) prevTime = timestamp - data.length / _this.info.sps;
    var timeToSample = (timestamp - prevTime) / data.length;
    _this.info.sps = 1000 / timeToSample; // In Seconds
    // Calculate Time Vector through Linear interpolation

    var time = Array(data.length).fill(timestamp);
    if (direction === 'back') time = time.map(function (t, i) {
      return t - timeToSample * (time.length - i);
    }); // Back
    else time = time.map(function (t, i) {
        return t + timeToSample * i;
      }); // Forward

    return time;
  };

  this.connect = /*#__PURE__*/musePlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
    return regeneratorRuntime.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            _context2.next = 2;
            return _this.device.connect();

          case 2:
            _context2.next = 4;
            return _this.device.start();

          case 4:
            _this._onConnected();

            _this.device.eegReadings.subscribe(function (o) {
              if (_this.info.useAtlas) {
                var _coord$times, _coord$raw;

                var coord = _this.atlas.getEEGDataByChannel(o.electrode);

                var time = _this.timeCorrection(coord, o.samples, o.timestamp); // Add Data to Atlas


                (_coord$times = coord.times).push.apply(_coord$times, musePlugin_toConsumableArray(time));

                (_coord$raw = coord.raw).push.apply(_coord$raw, musePlugin_toConsumableArray(o.samples));

                coord.count += o.samples.length; // Filter Data

                if (_this.info.useFilters === true) {
                  var _coord$filtered;

                  var latestFiltered = new Array(o.samples.length).fill(0);

                  if (_this.filters[o.electrode] !== undefined) {
                    o.samples.forEach(function (sample, k) {
                      latestFiltered[k] = _this.filters[o.electrode].apply(sample);
                    });
                  }

                  (_coord$filtered = coord.filtered).push.apply(_coord$filtered, musePlugin_toConsumableArray(latestFiltered));
                }
              }
            });

            _this.atlas.data.eegshared.startTime = Date.now();
            _this.atlas.settings.deviceConnected = true;

            if (_this.atlas.settings.analyzing !== true && _this.info.analysis.length > 0) {
              _this.atlas.settings.analyzing = true;
              setTimeout(function () {
                _this.atlas.analyzer();
              }, 1200);
            }

            _this.device.gatt.device.addEventListener('gattserverdisconnected', function () {
              if (_this.atlas.settings.deviceConnected) {
                _this.atlas.analyzing = false;
                _this.atlas.settings.deviceConnected = false;

                _this.ondisconnect();
              }
            });

            _this.onconnect();

          case 11:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  }));

  this.disconnect = function () {
    if (_this.ui) _this.ui.deleteNode();

    _this.device.disconnect();
  };

  this.onconnect = function () {};

  this.ondisconnect = function () {};

  this.addControls = function () {
    var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
    var id = Math.floor(Math.random() * 10000); //prevents any possible overlap with other elements

    var template = function template() {
      return "\n            ";
    };

    var setup = function setup() {};

    _this.ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
  };

  this.atlas = null;
  this.mode = mode;
  this.device = null; //Invoke a device class here if needed

  this.filters = [];
  this.info;
  this.onconnect = onconnect;
  this.ondisconnect = ondisconnect;
};
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/hegduino/hegduino.js
function hegduino_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function hegduino_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { hegduino_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { hegduino_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function hegduino_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function hegduino_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function hegduino_createClass(Constructor, protoProps, staticProps) { if (protoProps) hegduino_defineProperties(Constructor.prototype, protoProps); if (staticProps) hegduino_defineProperties(Constructor, staticProps); return Constructor; }

//Joshua Brewster, MIT License
 //for async calls

var hegduino = /*#__PURE__*/function () {
  function hegduino() {
    var mode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'usb';
    var ondata = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (newline) {};
    var onconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};
    var ondisconnect = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function () {};
    var hostURL = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 'http://192.168.4.1/';

    hegduino_classCallCheck(this, hegduino);

    this["interface"] = null;
    this.mode = mode;

    if (mode === 'usb' || mode === 'serial') {
      this.setupSerialDevice(ondata, onconnect, ondisconnect);
    } else if (mode === 'ble' || mode === 'bt') {
      this.setupBLEDevice(ondata, onconnect, ondisconnect);
    } else if (mode === 'wifi' || mode === 'events' || mode === 'sse') {
      this.setupSSEDevice(hostURL, ondata, onconnect, ondisconnect);
    }
  }

  hegduino_createClass(hegduino, [{
    key: "setupSerialDevice",
    value: function setupSerialDevice() {
      var ondata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};
      var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};
      var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};
      this["interface"] = new webSerial();
      this["interface"].onConnectedCallback = onconnect;
      this["interface"].onReadLine = ondata;
      this["interface"].onDisconnectedCallback = ondisconnect;
    }
  }, {
    key: "setupBLEDevice",
    value: function setupBLEDevice() {
      var _this = this;

      var ondata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};
      var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};
      var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};
      this["interface"] = new hegBLE();
      this["interface"].onConnectedCallback = onconnect;
      this["interface"].onDisconnectedCallback = ondisconnect;

      this["interface"].onNotificationCallback = function (e) {
        var line = _this["interface"].decoder.decode(e.target.value);

        ondata(line);
      };
    } //Change hostURL if device is on main net and has a new IP

  }, {
    key: "setupSSEDevice",
    value: function setupSSEDevice() {
      var hostURL = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'http://192.168.4.1/';
      var ondata = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};
      var onconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};
      var ondisconnect = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function () {};

      var onheg = function onheg(e) {
        ondata(e.data);
      };

      this["interface"] = new EventSourceUtil(hostURL + "events", onconnect, ondisconnect, undefined, [{
        tag: 'heg',
        callback: onheg
      }]);
      this["interface"].newPostFunction('sendCommand', hostURL + "command");
    }
  }, {
    key: "sendCommand",
    value: function sendCommand() {
      var command = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';

      if (this.mode === 'usb' || this.mode === 'serial') {
        this["interface"].sendMessage(command);
      } else if (this.mode === 'ble' || this.mode === 'bt') {
        this["interface"].sendMessage(command);
      } else if (this.mode === 'wifi' || this.mode === 'events' || this.mode === 'sse') {
        this["interface"].sendCommand(command);
      }
    }
  }, {
    key: "connect",
    value: function connect(path) {
      //chrome serial requires a path be specified (e.g. 'COM3')
      if (this.mode === 'usb' || this.mode === 'serial') {
        if (navigator.serial) this["interface"].setupSerialAsync();else if (chrome.serial) this["interface"].connectSelected(true, path);else {
          console.error("ERROR: Cannot locate navigator.serial. Enable #experimental-web-platform-features in chrome://flags");
          alert("Serial support not found. Enable #experimental-web-platform-features in chrome://flags or use a chrome extension");
        }
      } else if (this.mode === 'ble' || this.mode === 'bt') {
        this["interface"].connect();
      } else if (this.mode === 'wifi' || this.mode === 'events' || this.mode === 'sse') {
        this["interface"].open();
      }
    }
  }, {
    key: "disconnect",
    value: function disconnect() {
      if (this.mode === 'usb' || this.mode === 'serial') {
        if (navigator.serial) this["interface"].closePort();else this["interface"].connectSelected(false);
      } else if (this.mode === 'ble' || this.mode === 'bt') {
        this["interface"].disconnect();
      } else if (this.mode === 'wifi' || this.mode === 'events' || this.mode === 'sse') {
        this["interface"].close();
      }
    }
  }]);

  return hegduino;
}(); //alternatively use heg-connection.ts by Dovydas (@Giveback007 on Github)

var hegBLE = /*#__PURE__*/function () {
  //This is formatted for the way the HEG sends/receives information. Other BLE devices will likely need changes to this to be interactive.
  function hegBLE() {
    var serviceUUID = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
    var rxUUID = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '6e400002-b5a3-f393-e0a9-e50e24dcca9e';
    var txUUID = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '6e400003-b5a3-f393-e0a9-e50e24dcca9e';
    var defaultUI = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;
    var parentId = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : "main_body";
    var buttonId = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : "blebutton";
    var async = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : false;

    hegduino_classCallCheck(this, hegBLE);

    hegduino_initialiseProps.call(this);

    this.serviceUUID = serviceUUID;
    this.rxUUID = rxUUID; //characteristic that can receive input from this device

    this.txUUID = txUUID; //characteristic that can transmit input to this device

    this.encoder = new TextEncoder("utf-8");
    this.decoder = new TextDecoder("utf-8");
    this.device = null;
    this.server = null;
    this.service = null;
    this.parentId = parentId;
    this.buttonId = buttonId;
    this.async = async;
    this.android = navigator.userAgent.toLowerCase().indexOf("android") > -1; //Use fast mode on android (lower MTU throughput)

    this.n; //nsamples
    //BLE Updater modified from this sparkfun tutorial: https://learn.sparkfun.com/tutorials/esp32-ota-updates-over-ble-from-a-react-web-application/all
    //See original copyright:

    /*************************************************** 
     This is a React WebApp written to Flash an ESP32 via BLE
    
    Written by Andrew England (SparkFun)
    BSD license, all text above must be included in any redistribution.
    *****************************************************/

    this.otaServiceUuid = serviceUUID.toLowerCase();
    this.versionCharacteristicUuid = '6E400007-B5A3-F393-E0A9-E50E24DCCA9E'.toLowerCase();
    this.fileCharacteristicUuid = '6E400006-B5A3-F393-E0A9-E50E24DCCA9E'.toLowerCase();
    this.esp32Device = null;
    this.esp32otaService = null;
    this.readyFlagCharacteristic = null;
    this.dataToSend = null;
    this.updateData = null;
    this.totalSize;
    this.remaining;
    this.amountToWrite;
    this.currentPosition;
    this.currentHardwareVersion = "N/A";
    this.softwareVersion = "N/A";
    this.latestCompatibleSoftware = "N/A";
    this.characteristicSize = 512; //MTUs //20 byte limit on android   

    if (defaultUI === true) {
      this.initUI(parentId, buttonId);
    }
  }

  hegduino_createClass(hegBLE, [{
    key: "initUI",
    value: function initUI(parentId, buttonId) {
      var _this2 = this;

      if (this.device !== null) {
        if (this.device.gatt.connected) {
          this.device.gatt.disconnect();
          console.log("device disconnected");
        }
      }

      var HTMLtoAppend = '<button id="' + buttonId + '">BLE Connect</button>';
      HEGwebAPI.appendFragment(HTMLtoAppend, parentId);

      document.getElementById(buttonId).onclick = function () {
        if (_this2.async === false) {
          _this2.connect();
        } else {
          _this2.initBLEasync();
        }
      };
    } //Typical web BLE calls

  }, {
    key: "getFile",
    value: //get the file to start the update process
    function getFile() {
      var _this3 = this;

      var input = document.createElement('input');
      input.accept = '.bin';
      input.type = 'file';

      input.onchange = function (e) {
        var file = e.target.files[0];
        var reader = new FileReader();

        reader.onload = function (event) {
          _this3.updateData = event.target.result;

          _this3.SendFileOverBluetooth();

          input.value = '';
        };

        reader.readAsArrayBuffer(file);
      };

      input.click();
    }
    /* SendFileOverBluetooth(data)
    * Figures out how large our update binary is, attaches an eventListener to our dataCharacteristic so the Server can tell us when it has finished writing the data to memory
    * Calls SendBufferedData(), which begins a loop of write, wait for ready flag, write, wait for ready flag...
    */

  }, {
    key: "SendFileOverBluetooth",
    value: function SendFileOverBluetooth() {
      var _this4 = this;

      if (!this.esp32otaService) {
        console.log("No ota Service");
        return;
      }

      this.totalSize = this.updateData.byteLength;
      this.remaining = this.totalSize;
      this.amountToWrite = 0;
      this.currentPosition = 0;
      this.esp32otaService.getCharacteristic(this.fileCharacteristicUuid).then(function (characteristic) {
        _this4.readyFlagCharacteristic = characteristic;
        return characteristic.startNotifications().then(function (_) {
          _this4.readyFlagCharacteristic.addEventListener('characteristicvaluechanged', _this4.SendBufferedData);
        });
      })["catch"](function (error) {
        console.log(error);
      });
      this.SendBufferedData();
    }
    /* SendBufferedData()
    * An ISR attached to the same characteristic that it writes to, this function slices data into characteristic sized chunks and sends them to the Server
    */

  }, {
    key: "SendBufferedData",
    value: function SendBufferedData() {
      var _this5 = this;

      if (this.remaining > 0) {
        if (this.remaining >= this.characteristicSize) {
          this.amountToWrite = this.characteristicSize;
        } else {
          this.amountToWrite = this.remaining;
        }

        this.dataToSend = this.updateData.slice(this.currentPosition, this.currentPosition + this.amountToWrite);
        this.currentPosition += this.amountToWrite;
        this.remaining -= this.amountToWrite;
        console.log("remaining: " + this.remaining);
        this.esp32otaService.getCharacteristic(this.fileCharacteristicUuid).then(function (characteristic) {
          return _this5.RecursiveSend(characteristic, _this5.dataToSend);
        }).then(function (_) {
          var progress = (100 * (_this5.currentPosition / _this5.totalSize)).toPrecision(3) + '%';

          _this5.onProgress(progress);

          return;
        })["catch"](function (error) {
          console.log(error);
        });
      }
    }
  }, {
    key: "onProgress",
    value: function onProgress(progress) {
      console.log("ESP32 Update Progress: ", progress);
    }
  }, {
    key: "RecursiveSend",
    value: function RecursiveSend(characteristic, data) {
      var _this6 = this;

      return characteristic.writeValue(data)["catch"](function (error) {
        return _this6.RecursiveSend(characteristic, data);
      });
    } //Async solution fix for slower devices (android). This is slower than the other method on PC. Credit Dovydas Stirpeika

  }, {
    key: "connectAsync",
    value: function () {
      var _connectAsync = hegduino_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
        var _this$device$gatt;

        var btServer, service, tx;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                _context.next = 2;
                return navigator.bluetooth.requestDevice({
                  filters: [{
                    namePrefix: 'HEG'
                  }],
                  optionalServices: [this.serviceUUID]
                });

              case 2:
                this.device = _context.sent;
                console.log("BLE Device: ", this.device);
                _context.next = 6;
                return (_this$device$gatt = this.device.gatt) === null || _this$device$gatt === void 0 ? void 0 : _this$device$gatt.connect();

              case 6:
                btServer = _context.sent;

                if (btServer) {
                  _context.next = 9;
                  break;
                }

                throw 'no connection';

              case 9:
                this.device.addEventListener('gattserverdisconnected', onDisconnected);
                this.server = btServer;
                _context.next = 13;
                return this.server.getPrimaryService(this.serviceUUID);

              case 13:
                service = _context.sent;
                _context.next = 16;
                return service.getCharacteristic(this.rxUUID);

              case 16:
                tx = _context.sent;
                _context.next = 19;
                return tx.writeValue(this.encoder.encode("t"));

              case 19:
                if (!(this.android == true)) {
                  _context.next = 22;
                  break;
                }

                _context.next = 22;
                return tx.writeValue(this.encoder.encode("o"));

              case 22:
                _context.next = 24;
                return service.getCharacteristic(this.txUUID);

              case 24:
                this.characteristic = _context.sent;
                this.onConnectedCallback();
                return _context.abrupt("return", true);

              case 27:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this);
      }));

      function connectAsync() {
        return _connectAsync.apply(this, arguments);
      }

      return connectAsync;
    }()
  }, {
    key: "readDeviceAsync",
    value: function () {
      var _readDeviceAsync = hegduino_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
        var data, val;
        return regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                if (this.characteristic) {
                  _context2.next = 3;
                  break;
                }

                console.log("HEG not connected");
                throw "error";

              case 3:
                // await this.characteristic.startNotifications();
                this.doReadHeg = true;
                data = "";

              case 5:
                if (!this.doReadHeg) {
                  _context2.next = 14;
                  break;
                }

                _context2.t0 = this.decoder;
                _context2.next = 9;
                return this.characteristic.readValue();

              case 9:
                _context2.t1 = _context2.sent;
                val = _context2.t0.decode.call(_context2.t0, _context2.t1);

                if (val !== this.data) {
                  data = val;
                  console.log(data); //data = data[data.length - 1];
                  //const arr = data.replace(/[\n\r]+/g, '')

                  this.n += 1;
                  this.onReadAsyncCallback(data);
                }

                _context2.next = 5;
                break;

              case 14:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function readDeviceAsync() {
        return _readDeviceAsync.apply(this, arguments);
      }

      return readDeviceAsync;
    }()
  }, {
    key: "initBLEasync",
    value: function () {
      var _initBLEasync = hegduino_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {
        return regeneratorRuntime.wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this.connectAsync();

              case 2:
                this.readDeviceasync();
                this.spsinterval();

              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function initBLEasync() {
        return _initBLEasync.apply(this, arguments);
      }

      return initBLEasync;
    }()
  }]);

  return hegBLE;
}();

var hegduino_initialiseProps = function _initialiseProps() {
  var _this14 = this;

  this.connect = function () {
    var serviceUUID = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _this14.serviceUUID;
    var rxUUID = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _this14.rxUUID;
    var txUUID = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _this14.txUUID;
    //Must be run by button press or user-initiated call
    navigator.bluetooth.requestDevice({
      //    acceptAllDevices: true,
      filters: [{
        services: [serviceUUID]
      }, {
        namePrefix: 'HEG'
      }],
      optionalServices: [serviceUUID]
    }).then(function (device) {
      //document.getElementById("device").innerHTML += device.name+ "/"+ device.id +"/"+ device.gatt.connected+"<br>";
      _this14.device = device;
      return device.gatt.connect(); //Connect to HEG
    }).then(sleeper(100)).then(function (server) {
      return server.getPrimaryService(serviceUUID);
    }).then(sleeper(100)).then(function (service) {
      _this14.service = service;
      _this14.esp32otaService = service;
      service.getCharacteristic(rxUUID).then(sleeper(100)).then(function (tx) {
        _this14.rxchar = tx;
        return tx.writeValue(_this14.encoder.encode("t")); // Send command to start HEG automatically (if not already started)
      });

      if (_this14.android == true) {
        service.getCharacteristic(rxUUID).then(sleeper(1000)).then(function (tx) {
          return tx.writeValue(_this14.encoder.encode("o")); // Fast output mode for android
        });
      }

      return service.getCharacteristic(txUUID); // Get stream source
    }).then(sleeper(1100)).then(function (characteristic) {
      _this14.txchar = characteristic;
      return characteristic.startNotifications(); // Subscribe to stream
    }).then(sleeper(100)).then(function (characteristic) {
      characteristic.addEventListener('characteristicvaluechanged', _this14.onNotificationCallback); //Update page with each notification
    }).then(sleeper(100)).then(_this14.onConnectedCallback())["catch"](function (err) {
      console.error(err);

      _this14.onErrorCallback(err);
    });

    function sleeper(ms) {
      return function (x) {
        return new Promise(function (resolve) {
          return setTimeout(function () {
            return resolve(x);
          }, ms);
        });
      };
    }
  };

  this.onNotificationCallback = function (e) {
    //Customize this with the UI (e.g. have it call the handleScore function)
    var val = _this14.decoder.decode(e.target.value);

    console.log("BLE MSG: ", val);
  };

  this.onConnectedCallback = function () {//Use this to set up the front end UI once connected here
  };

  this.onErrorCallback = function () {//Use this to set up the front end UI once connected here
  };

  this.sendMessage = function (msg) {
    if (_this14.service) _this14.service.getCharacteristic(_this14.rxUUID).then(function (tx) {
      return tx.writeValue(_this14.encoder.encode(msg));
    });
  };

  this.disconnect = function () {
    var _this14$server;

    (_this14$server = _this14.server) === null || _this14$server === void 0 ? void 0 : _this14$server.disconnect();

    _this14.onDisconnectedCallback();
  };

  this.onDisconnectedCallback = function () {
    console.log("BLE device disconnected!");
  };

  this.onReadAsyncCallback = function (data) {
    console.log("BLE Data: ", data);
  };

  this.stopReadAsync = function () {
    _this14.doReadHeg = false;
    tx.writeValue(_this14.encoder.encode("f"));
  };

  this.spsinterval = function () {
    setTimeout(function () {
      console.log("SPS", _this14.n + '');
      _this14.n = 0;

      _this14.spsinterval();
    }, 1000);
  };
};

var EventSourceUtil = /*#__PURE__*/function () {
  function EventSourceUtil() {
    var _this7 = this;

    var hostUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'http://192.168.4.1/events';
    var onOpen = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onOpen;
    var onError = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.onError;
    var onMsg = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : this.onMsg;
    var customCallbacks = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [];

    hegduino_classCallCheck(this, EventSourceUtil);

    this.onOpen = function (e) {
      console.log("Events Connected!", e.data);
    };

    this.onError = function (e) {
      console.log("event source error:", e.data);

      if (e.target.readyState !== EventSource.OPEN) {
        console.log("Events Disconnected");
      }
    };

    this.onMsg = function (e) {
      console.log("event source:", e.data);
    };

    this.open = function () {
      _this7.createEventListeners();
    };

    this.close = function () {
      _this7.removeEventListeners();
    };

    //Add custom callbacks like [{tag:'heg',callback:(e) => {console.log(e.data);}}]
    this.hostUrl = hostUrl;
    this.onOpen = onOpen;
    this.onError = onError;
    this.onMsg = onMsg;
    this.source = null;
    this.customCallbacks = customCallbacks;
    this.createEventListeners(hostUrl, custom);
  }

  hegduino_createClass(EventSourceUtil, [{
    key: "createEventListeners",
    value: function createEventListeners() {
      var hostUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.hostUrl;
      var customCallbacks = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.customCallbacks;
      var source = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.source;

      if (source !== null) {
        this.removeEventListeners(customCallbacks, source);
      }

      if (window.EventSource) {
        source = new EventSource(hostUrl);
        source.addEventListener('open', this.onOpen, false);
        source.addEventListener('error', this.onError, false);
        source.addEventListener('message', this.onMsg, false);

        if (customCallbacks.length > 0) {
          customCallbacks.forEach(function (item, i) {
            source.addEventListener(item.tag, item.callback, false);
          });
        }
      }
    }
  }, {
    key: "removeEventListeners",
    value: function removeEventListeners() {
      var customCallbacks = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.custom;
      var source = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.source;

      if (window.EventSource) {
        source.close();
        source.removeEventListener('open', this.openEvent, false);
        source.removeEventListener('error', this.errorEvent, false);
        source.removeEventListener('message', this.messageEvent, false);

        if (customCallbacks.length > 0) {
          customCallbacks.forEach(function (item, i) {
            source.removeEventListener(item.tag, item.callback, false);
          });
        }

        source = null;
      }
    } //create a function to post to URLS with optional data, usernames, and passwords

  }, {
    key: "newPostFunction",
    value: function newPostFunction() {
      var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "post";
      var url = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.hostUrl;
      var data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : undefined;
      var user = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : undefined;
      var pass = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : undefined;

      var newPostFunction = function newPostFunction() {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', url, true, user, pass);
        xhr.send(data); //Accepts: string | Document | Blob | ArrayBufferView | ArrayBuffer | FormData | URLSearchParams | ReadableStream<Uint8Array>

        xhr.onerror = function () {
          xhr.abort();
        };
      };

      this[name] = newPostFunction;
      return newPostFunction;
    }
  }]);

  return EventSourceUtil;
}(); //Utils developed by Diego Schmaedech (MIT License) for chrome. Modified/Generalized and updated for web Serial by Joshua Brewster (MIT License) 

var webSerial = /*#__PURE__*/function () {
  function webSerial() {
    var _this8 = this;

    var defaultUI = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
    var parentId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'serialmenu';
    var streamMonitorId = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "serialmonitor";

    hegduino_classCallCheck(this, webSerial);

    this.onGetDevices = function (ports) {
      //leftover from chrome.serial
      document.getElementById('serialports').innerHTML = '';
      var paths = [];

      for (var i = 0; i < ports.length; i++) {
        console.log(ports[i].path);
      }

      ports.forEach(function (port) {
        var displayName = port["displayName"] + "(" + port.path + ")";
        console.log("displayName " + displayName);
        if (!displayName) displayName = port.path;
        paths.push({
          'option': displayName,
          'value': port.path
        });
        console.log(_this8.defaultUI);

        if (_this8.defaultUI == true) {
          var newOption = document.createElement("option");
          newOption.text = displayName;
          newOption.value = port.path;
          console.log('option', newOption);
          document.getElementById('serialports').appendChild(newOption);
        }
      });
      _this8.displayPorts = paths;
    };

    this.onReceive = function (receiveInfo) {
      //console.log("onReceive");
      if (receiveInfo.connectionId !== _this8.connectionId) {
        console.log("ERR: Receive ID:", receiveInfo.connectionId);
        return;
      }

      var bufView = new Uint8Array(receiveInfo.data);
      var encodedString = String.fromCharCode.apply(null, bufView);
      _this8.encodedBuffer += decodeURIComponent(escape(encodedString));
      console.log(_this8.encodedBuffer.length);
      var index;

      while ((index = _this8.encodedBuffer.indexOf('\n')) >= 0) {
        var line = _this8.encodedBuffer.substr(0, index + 1);

        if (_this8.recordData == true) {
          _this8.recorded.push(line);
        }

        if (_this8.monitoring = true) {
          _this8.newSamples++;

          _this8.monitorData.push(line);
        }

        _this8.onReadLine(line);

        _this8.encodedBuffer = _this8.encodedBuffer.substr(index + 1);
      }
    };

    this.onConnectComplete = function (connectionInfo) {
      _this8.connectionId = connectionInfo.connectionId;
      console.log("Connected! ID:", _this8.connectionId);
      chrome.serial.onReceive.addListener(_this8.onReceive);
      chrome.serial.onReceiveError.addListener(_this8.onReceiveError);

      _this8.onConnectedCallback();
    };

    this.displayPorts = [];
    this.defaultUI = defaultUI;
    this.encodedBuffer = "";
    this.connectionId = -1;
    this.recordData = false;
    this.recorded = [];
    this.port = null;
    this.decoder = null;
    this.subscribed = false;
    this.reader = null;
    this.writer = null;
    this.monitoring = false;
    this.newSamples = 0;
    this.monitorSamples = 10000; //Max 10000 samples visible in stream monitor by default

    this.monitorData = [];
    this.monitorIdx = 0;

    if (chrome.serial) {
      if (defaultUI === true) {
        this.setupSelect(parentId, false);
      }

      this.setupSerial();
    } else if (navigator.serial) {
      this.decoder = new TextDecoder();

      if (defaultUI === true) {
        this.setupSelect(parentId, true);
      }
    } else {
      console.log("ERROR: Cannot locate navigator.serial. Enable #experimental-web-platform-features in chrome://flags");
      alert("Serial support not found. Enable #experimental-web-platform-features in chrome://flags or use a chrome extension");
    }
  }

  hegduino_createClass(webSerial, [{
    key: "setupSelect",
    value: function setupSelect(parentId) {
      var _this9 = this;

      var useAsync = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

      if (chrome.serial) {
        var displayOptions = document.createElement('select'); //Element ready to be appended

        displayOptions.setAttribute('id', 'serialports');
        var frag = document.createDocumentFragment();
        frag.appendChild(displayOptions);
        document.getElementById(parentId).innerHTML = '<button id="refreshSerial">Get</button><button id="connectSerial">Set</button>';
        document.getElementById(parentId).appendChild(frag);

        document.getElementById('connectSerial').onclick = function () {
          if (useAsync) {
            _this9.setupSerialAsync();
          } else {
            if (_this9.connectionId !== -1) {
              _this9.connectSelected(false);
            }

            ; // Disconnect previous

            _this9.connectSelected(true, document.getElementById('serialports').value);
          }
        };
      } else if (navigator.serial) {
        var frag = document.createDocumentFragment();
        document.getElementById(parentId).innerHTML = '<button id="refreshSerial">Set USB Device</button>';
        document.getElementById(parentId).appendChild(frag);
      }

      document.getElementById('refreshSerial').onclick = function () {
        if (useAsync) {
          _this9.setupSerialAsync();
        } else {
          _this9.setupSerial();
        }
      };
    } // setupMonitor(parentId) {
    //     if(this.monitorData.length > this.monitorSamples){ 
    //         this.monitorData.splice(0, this.monitorData.length - this.monitorSamples);
    //     }
    //     var div = document.createElement('div');
    //     div.setAttribute('id','streamMonitor');
    //     this.monitorData.forEach((item,idx)=>{
    //         div.innerHTML += '<div id='+this.monitorIdx+'>'+item+'</div>';
    //         this.monitorIdx++;
    //     });
    //     this.newSamples = 0;
    //     var frag = document.createDocumentFragment();
    //     frag.appendChild(div);
    //     document.getElementById(parentId).appendChild(frag);
    //     var monitorAnim = () => {
    //         if(this.newSamples > 0){
    //             if(this.monitorData.length > this.monitorSamples){ 
    //                 //Remove old samples if over the limit
    //                 for(var i = this.monitorIdx - this.monitorSamples - (this.monitorData.length - this.monitorSamples); i > this.monitorIdx - this.monitorSamples; i++){
    //                     document.getElementById(i).remove();
    //                 }
    //                 this.monitorData.splice(0, this.monitorData.length - this.monitorSamples);
    //             }
    //             //Load new samples
    //             for(var i = 0; i < newSamples; i++) {
    //                 var newdiv = document.createElement('div');
    //                 newdiv.innerHTML = '<div id="'+this.monitorIdx+'">'+this.monitorData[this.monitorData.length - 1 - i]+'</div>';
    //                 var frag = document.createDocumentFragment();
    //                 frag.appendChild(newdiv);        
    //                 document.getElementById(parentId).appendChild(frag);
    //                 this.monitorIdx++;
    //                 var elem = document.getElementById('streamMonitor');
    //                 elem.scrollTop = elem.scrollHeight;
    //             }
    //             setTimeout(requestAnimationFrame(monitorAnim),15);
    //         }
    //     }
    //     requestAnimationFrame(monitorAnim);
    // }

  }, {
    key: "onReceiveError",
    value: function onReceiveError(errorInfo) {
      console.log("onReceiveError");

      if (errorInfo.connectionId === this.connectionId) {
        console.log("Error from ID:", errorInfo.connectionId);
        this.onError.dispatch(errorInfo.error);
        console.log("Error: " + errorInfo.error);
      }
    }
  }, {
    key: "onConnectedCallback",
    value: function onConnectedCallback() {
      //Customize this one for the front end integration after the device is successfully connected.
      console.log("USB device Ready!");
    }
  }, {
    key: "onDisconnectedCallback",
    value: function onDisconnectedCallback() {
      console.log("USB device disconnected!");
    }
  }, {
    key: "sendMessage",
    value: function sendMessage(msg) {
      msg += "\n";
      var encodedString = unescape(encodeURIComponent(msg));
      var bytes = new Uint8Array(encodedString.length);

      for (var i = 0; i < encodedString.length; ++i) {
        bytes[i] = encodedString.charCodeAt(i);
      }

      if (chrome.serial) {
        if (this.connectionId > -1) {
          chrome.serial.send(this.connectionId, bytes.buffer, this.onSendCallback);
          console.log("Send message:", msg);
        } else {
          console.log("Device is disconnected!");
        }
      } else if (navigator.serial) {
        if (this.port.writable) {
          this.sendMessageAsync(bytes.buffer);
        }
      }
    }
  }, {
    key: "onSendCallback",
    value: function onSendCallback(sendInfo) {
      console.log("sendInfo", sendInfo);
    }
  }, {
    key: "onReadLine",
    value: function onReadLine(line) {
      console.log(line);
    }
  }, {
    key: "connectSelected",
    value: function connectSelected() {
      var connect = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
      var devicePath = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';

      //Set connect to false to disconnect  
      if (connect == true && devicePath !== '') {
        console.log("Connecting", devicePath);
        chrome.serial.connect(devicePath, {
          bitrate: 115200
        }, this.onConnectComplete);
      } else {
        console.log("Disconnect" + devicePath);

        if (this.connectionId < 0) {
          console.log("connectionId", this.connectionId);
          return;
        }

        this.encodedBuffer = "";
        chrome.serial.onReceive.removeListener(this.onReceive);
        chrome.serial.onReceiveError.removeListener(this.onReceiveError);
        chrome.serial.flush(this.connectionId, function () {
          console.log("chrome.serial.flush", this.connectionId);
        });
        chrome.serial.disconnect(this.connectionId, function () {
          console.log("chrome.serial.disconnect", this.connectionId);
        });
      }
    }
  }, {
    key: "setupSerial",
    value: function setupSerial() {
      chrome.serial.getDevices(this.onGetDevices);
    }
  }, {
    key: "sendMessageAsync",
    value: function () {
      var _sendMessageAsync = hegduino_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4(msg) {
        var writer;
        return regeneratorRuntime.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                writer = this.port.writable.getWriter();
                _context4.next = 3;
                return writer.write(msg);

              case 3:
                writer.releaseLock();

              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function sendMessageAsync(_x) {
        return _sendMessageAsync.apply(this, arguments);
      }

      return sendMessageAsync;
    }()
  }, {
    key: "onPortSelected",
    value: function () {
      var _onPortSelected = hegduino_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5(port) {
        return regeneratorRuntime.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.prev = 0;
                _context5.next = 3;
                return port.open({
                  baudRate: 115200,
                  bufferSize: 1000
                });

              case 3:
                _context5.next = 9;
                break;

              case 5:
                _context5.prev = 5;
                _context5.t0 = _context5["catch"](0);
                _context5.next = 9;
                return port.open({
                  baudrate: 115200,
                  buffersize: 1000
                });

              case 9:
                this.onConnectedCallback();
                this.connected = true;
                this.subscribed = true;
                this.subscribe(port);

              case 13:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this, [[0, 5]]);
      }));

      function onPortSelected(_x2) {
        return _onPortSelected.apply(this, arguments);
      }

      return onPortSelected;
    }()
  }, {
    key: "onReceiveAsync",
    value: function onReceiveAsync(value) {
      this.encodedBuffer += this.decoder.decode(value);
      var index;

      while ((index = this.encodedBuffer.indexOf('\n')) >= 0) {
        var line = this.encodedBuffer.substr(0, index + 1);

        if (this.recordData == true) {
          this.recorded.push(line);
        }

        if (this.monitoring = true) {
          this.newSamples++;
          this.monitorData.push(line);
        }

        this.onReadLine(line);
        this.encodedBuffer = this.encodedBuffer.substr(index + 1);
      }
    }
  }, {
    key: "subscribe",
    value: function () {
      var _subscribe = hegduino_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee9(port) {
        var _this10 = this;

        var streamData;
        return regeneratorRuntime.wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                if (this.port.readable && this.subscribed === true) {
                  this.reader = port.readable.getReader();

                  streamData = /*#__PURE__*/function () {
                    var _ref = hegduino_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee8() {
                      var _yield$_this10$reader, value, done;

                      return regeneratorRuntime.wrap(function _callee8$(_context8) {
                        while (1) {
                          switch (_context8.prev = _context8.next) {
                            case 0:
                              _context8.prev = 0;
                              _context8.next = 3;
                              return _this10.reader.read();

                            case 3:
                              _yield$_this10$reader = _context8.sent;
                              value = _yield$_this10$reader.value;
                              done = _yield$_this10$reader.done;

                              if (!(done || _this10.subscribed === false)) {
                                _context8.next = 9;
                                break;
                              }

                              _context8.next = 9;
                              return _this10.reader.releaseLock();

                            case 9:
                              if (value) {
                                //console.log(value.length);
                                try {
                                  _this10.onReceiveAsync(value);

                                  if (_this10.subscribed === true) {
                                    setTimeout(function () {
                                      streamData();
                                    }, 30);
                                  }
                                } catch (err) {
                                  console.log(err);
                                } //console.log("new Read");
                                //console.log(this.decoder.decode(value));

                              }

                              _context8.next = 16;
                              break;

                            case 12:
                              _context8.prev = 12;
                              _context8.t0 = _context8["catch"](0);
                              console.log(_context8.t0); // TODO: Handle non-fatal read error.

                              if (_context8.t0.message.includes('framing') || _context8.t0.message.includes('overflow') || _context8.t0.message.includes('overrun') || _context8.t0.message.includes('Overflow') || _context8.t0.message.includes('break')) {
                                _this10.subscribed = false;
                                setTimeout( /*#__PURE__*/hegduino_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6() {
                                  return regeneratorRuntime.wrap(function _callee6$(_context6) {
                                    while (1) {
                                      switch (_context6.prev = _context6.next) {
                                        case 0:
                                          if (!_this10.reader) {
                                            _context6.next = 4;
                                            break;
                                          }

                                          _context6.next = 3;
                                          return _this10.reader.releaseLock();

                                        case 3:
                                          _this10.reader = null;

                                        case 4:
                                          _this10.subscribed = true;

                                          _this10.subscribe(port); //if that fails then close port and reopen it


                                        case 6:
                                        case "end":
                                          return _context6.stop();
                                      }
                                    }
                                  }, _callee6);
                                })), 30); //try to resubscribe 
                              } else if (_context8.t0.message.includes('parity') || _context8.t0.message.includes('Parity')) {
                                if (_this10.port) {
                                  _this10.subscribed = false;
                                  setTimeout( /*#__PURE__*/hegduino_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7() {
                                    return regeneratorRuntime.wrap(function _callee7$(_context7) {
                                      while (1) {
                                        switch (_context7.prev = _context7.next) {
                                          case 0:
                                            if (!_this10.reader) {
                                              _context7.next = 4;
                                              break;
                                            }

                                            _context7.next = 3;
                                            return _this10.reader.releaseLock();

                                          case 3:
                                            _this10.reader = null;

                                          case 4:
                                            _context7.next = 6;
                                            return port.close();

                                          case 6:
                                            //this.port = null;
                                            _this10.connected = false;
                                            setTimeout(function () {
                                              _this10.onPortSelected(_this10.port);
                                            }, 100); //close the port and reopen

                                          case 8:
                                          case "end":
                                            return _context7.stop();
                                        }
                                      }
                                    }, _callee7);
                                  })), 50);
                                }
                              } else {
                                _this10.closePort();
                              }

                            case 16:
                            case "end":
                              return _context8.stop();
                          }
                        }
                      }, _callee8, null, [[0, 12]]);
                    }));

                    return function streamData() {
                      return _ref.apply(this, arguments);
                    };
                  }();

                  streamData();
                }

              case 1:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function subscribe(_x3) {
        return _subscribe.apply(this, arguments);
      }

      return subscribe;
    }()
  }, {
    key: "closePort",
    value: function () {
      var _closePort = hegduino_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee11() {
        var _this11 = this;

        var port,
            _args11 = arguments;
        return regeneratorRuntime.wrap(function _callee11$(_context11) {
          while (1) {
            switch (_context11.prev = _context11.next) {
              case 0:
                port = _args11.length > 0 && _args11[0] !== undefined ? _args11[0] : this.port;

                //if(this.reader) {this.reader.releaseLock();}
                if (this.port) {
                  this.subscribed = false;
                  setTimeout( /*#__PURE__*/hegduino_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee10() {
                    return regeneratorRuntime.wrap(function _callee10$(_context10) {
                      while (1) {
                        switch (_context10.prev = _context10.next) {
                          case 0:
                            if (!_this11.reader) {
                              _context10.next = 4;
                              break;
                            }

                            _context10.next = 3;
                            return _this11.reader.releaseLock();

                          case 3:
                            _this11.reader = null;

                          case 4:
                            _context10.next = 6;
                            return port.close();

                          case 6:
                            //this.port = null;
                            _this11.connected = false;

                            _this11.onDisconnectedCallback();

                          case 8:
                          case "end":
                            return _context10.stop();
                        }
                      }
                    }, _callee10);
                  })), 50);
                }

              case 2:
              case "end":
                return _context11.stop();
            }
          }
        }, _callee11, this);
      }));

      function closePort() {
        return _closePort.apply(this, arguments);
      }

      return closePort;
    }()
  }, {
    key: "setupSerialAsync",
    value: function () {
      var _setupSerialAsync = hegduino_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee12() {
        var _this12 = this;

        var filters;
        return regeneratorRuntime.wrap(function _callee12$(_context12) {
          while (1) {
            switch (_context12.prev = _context12.next) {
              case 0:
                filters = [{
                  usbVendorId: 0x10c4,
                  usbProductId: 0x0043
                } //CP2102 filter
                ];
                _context12.next = 3;
                return navigator.serial.requestPort();

              case 3:
                this.port = _context12.sent;
                navigator.serial.addEventListener("disconnect", function (e) {
                  _this12.closePort();
                });
                this.onPortSelected(this.port);

              case 6:
              case "end":
                return _context12.stop();
            }
          }
        }, _callee12, this);
      }));

      function setupSerialAsync() {
        return _setupSerialAsync.apply(this, arguments);
      }

      return setupSerialAsync;
    }()
  }, {
    key: "saveCsv",
    value: function saveCsv() {
      var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.recorded;
      var name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new Date().toISOString();
      var delimiter = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "|";
      var header = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : "Header\n";
      var csvDat = header;
      data.forEach(function (line) {
        csvDat += line.split(delimiter).join(",") + "\n";
      });
      var hiddenElement = document.createElement('a');
      hiddenElement.href = "data:text/csv;charset=utf-8," + encodeURI(csvDat);
      hiddenElement.target = "_blank";

      if (name !== "") {
        hiddenElement.download = name + ".csv";
      } else {
        hiddenElement.download = new Date().toISOString() + ".csv";
      }

      hiddenElement.click();
    }
  }, {
    key: "openFile",
    value: function openFile() {
      var _this13 = this;

      var delimiter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : ",";
      var input = document.createElement('input');
      input.type = 'file';

      input.onchange = function (e) {
        _this13.csvDat = [];
        var file = e.target.files[0];
        var reader = new FileReader();
        reader.readAsText(file);

        reader.onload = function (event) {
          var tempcsvData = event.target.result;
          var tempcsvArr = tempcsvData.split("\n");
          tempcsvArr.pop();
          tempcsvArr.forEach(function (row, i) {
            if (i == 0) {
              var temp = row.split(delimiter);
            } else {
              var temp = row.split(delimiter);

              _this13.csvDat.push(temp);
            }
          });

          _this13.onOpen();
        };

        input.value = '';
      };

      input.click();
    }
  }, {
    key: "onOpen",
    value: function onOpen() {
      // Customize this function in your init script, access data with ex. console.log(serialMonitor.csvDat), where var serialMonitor = new chromeSerial(defaultUI=false)
      alert("CSV Opened!");
    }
  }]);

  return webSerial;
}();
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/hegduino/hegduinoPlugin.js
function hegduinoPlugin_toConsumableArray(arr) { return hegduinoPlugin_arrayWithoutHoles(arr) || hegduinoPlugin_iterableToArray(arr) || hegduinoPlugin_unsupportedIterableToArray(arr) || hegduinoPlugin_nonIterableSpread(); }

function hegduinoPlugin_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function hegduinoPlugin_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return hegduinoPlugin_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return hegduinoPlugin_arrayLikeToArray(o, minLen); }

function hegduinoPlugin_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function hegduinoPlugin_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return hegduinoPlugin_arrayLikeToArray(arr); }

function hegduinoPlugin_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function hegduinoPlugin_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { hegduinoPlugin_typeof = function _typeof(obj) { return typeof obj; }; } else { hegduinoPlugin_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return hegduinoPlugin_typeof(obj); }

function hegduinoPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function hegduinoPlugin_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { hegduinoPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { hegduinoPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function hegduinoPlugin_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function hegduinoPlugin_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function hegduinoPlugin_createClass(Constructor, protoProps, staticProps) { if (protoProps) hegduinoPlugin_defineProperties(Constructor.prototype, protoProps); if (staticProps) hegduinoPlugin_defineProperties(Constructor, staticProps); return Constructor; }

//Template system to feed into the deviceStream class for creating possible configurations. 
//Just fill out the template functions accordingly and add this class (with a unique name) to the list of usable devices.




var hegduinoPlugin = /*#__PURE__*/function () {
  function hegduinoPlugin() {
    var _this = this;

    var mode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'hegduino_usb';
    var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onconnect;
    var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.ondisconnect;

    hegduinoPlugin_classCallCheck(this, hegduinoPlugin);

    this.init = /*#__PURE__*/function () {
      var _ref = hegduinoPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(info, pipeToAtlas) {
        var ondata;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                info.sps = 32;
                info.deviceType = 'heg';

                ondata = function ondata(newline) {
                  if (newline.indexOf("|") > -1) {
                    var data = newline.split("|"); //console.log(data);

                    if (data.length > 3) {
                      var coord = _this.atlas.data.heg[info.deviceNum];
                      coord.count++;

                      if (coord.count === 1) {
                        coord.startTime = Date.now();
                      }

                      if (_this.device.mode === 'ble' && _this.device["interface"].android === true) {
                        coord.times.push(Date.now());

                        if (!_this.filtering) {
                          coord.red.push(parseFloat(data[0]));
                          coord.ir.push(parseFloat(data[1]));
                          coord.ratio.push(parseFloat(data[2]));
                        } else {
                          coord.red.push(_this.filters[0].applyFilter(parseFloat(data[0])));
                          coord.ir.push(_this.filters[1].applyFilter(parseFloat(data[1])));
                          coord.ratio.push(_this.filters[2].applyFilter(parseFloat(data[2])));
                        } //ignore the rest for now

                      } else {
                        if (coord.times.length === 0) {
                          coord.times.push(Date.now());
                          _this.refuS = parseFloat(data[0]);
                        } //Microseconds = parseFloat(data[0]). We are using date.now() in ms to keep the UI usage normalized
                        else {
                            var t = parseFloat(data[0]);
                            coord.times.push(Math.floor(coord.times[coord.times.length - 1] + (t - _this.refuS) * 0.001));
                            _this.refuS = t; //keep times synchronous
                          }

                        if (!_this.filtering) {
                          coord.red.push(parseFloat(data[1]));
                          coord.ir.push(parseFloat(data[2]));
                          coord.ratio.push(parseFloat(data[3]));
                          coord.ambient.push(parseFloat(data[4]));
                          coord.temp.push(parseFloat(data[5])); // temp is on new firmware
                        } else {
                          coord.red.push(_this.filters[0].applyFilter(parseFloat(data[1])));
                          coord.ir.push(_this.filters[1].applyFilter(parseFloat(data[2])));
                          coord.ratio.push(_this.filters[2].applyFilter(parseFloat(data[3])));
                          coord.ambient.push(_this.filters[3].applyFilter(parseFloat(data[4])));
                          coord.temp.push(parseFloat(data[5])); // temp is on new firmware
                        } //ignore the rest for now

                      } //Simple beat detection. For breathing detection applying a ~3 second moving average and peak finding should work


                      _this.atlas.beatDetection(coord, info.sps);
                    }
                  } else {
                    console.log("HEGDUINO: ", newline);
                  }
                };

                if (_this.mode === 'hegduino_wifi' || _this.mode === 'hegduino_sse') {
                  info.sps = 20; //20sps incoming rate fixed for wifi

                  _this.device = new hegduino('wifi', ondata, function () {
                    _this.setupAtlas(pipeToAtlas, info);

                    if (_this.atlas.settings.analyzing !== true && info.analysis.length > 0) {
                      _this.atlas.settings.analyzing = true;
                      setTimeout(function () {
                        _this.atlas.analyzer();
                      }, 1200);
                    }

                    _this.atlas.settings.deviceConnected = true;

                    _this.device.sendCommand('t');

                    _this.onconnect();
                  }, function () {
                    _this.atlas.settings.analyzing = false;
                    _this.atlas.settings.deviceConnected = false;

                    _this.ondisconnect();
                  });
                } else if (_this.mode === 'hegduino_Bluetooth') {
                  _this.device = new hegduino('ble', ondata, function () {
                    _this.setupAtlas(pipeToAtlas, info);

                    if (_this.atlas.settings.analyzing !== true && info.analysis.length > 0) {
                      _this.atlas.settings.analyzing = true;
                      setTimeout(function () {
                        _this.atlas.analyzer();
                      }, 1200);
                    }

                    _this.atlas.settings.deviceConnected = true;

                    _this.device.sendCommand('t');

                    _this.onconnect();
                  }, function () {
                    _this.atlas.settings.analyzing = false;
                    _this.atlas.settings.deviceConnected = false;

                    _this.ondisconnect();
                  });
                } else if (_this.mode === 'hegduino_USB') {
                  _this.device = new hegduino('usb', ondata, function () {
                    _this.setupAtlas(pipeToAtlas, info);

                    if (_this.atlas.settings.analyzing !== true && info.analysis.length > 0) {
                      _this.atlas.settings.analyzing = true;
                      setTimeout(function () {
                        _this.atlas.analyzer();
                      }, 1200);
                    }

                    _this.atlas.settings.deviceConnected = true;

                    _this.device.sendCommand('t');

                    _this.onconnect();
                  }, function () {
                    _this.atlas.settings.analyzing = false;
                    _this.atlas.settings.deviceConnected = false;

                    _this.ondisconnect();
                  });
                }

              case 4:
              case "end":
                return _context.stop();
            }
          }
        }, _callee);
      }));

      return function (_x, _x2) {
        return _ref.apply(this, arguments);
      };
    }();

    this.setupAtlas = function (pipeToAtlas, info) {
      _this.filters.push(new BiquadChannelFilterer('red', 100, false, 1), new BiquadChannelFilterer('ir', 100, false, 1), new BiquadChannelFilterer('ratio', 100, false, 1), new BiquadChannelFilterer('ambient', 100, false, 1));

      _this.filters.forEach(function (filter) {
        filter.useSMA4 = true;
        filter.useDCB = false;
      });

      if (pipeToAtlas === true) {
        var config = 'hegduino';
        _this.atlas = new DataAtlas_DataAtlas(location + ":" + _this.mode, {
          hegshared: {
            sps: info.sps
          }
        }, config, false, true, info.analysis);
        info.deviceNum = _this.atlas.data.heg.length - 1;
        info.useAtlas = true;
      } else if (hegduinoPlugin_typeof(pipeToAtlas) === 'object') {
        _this.atlas = pipeToAtlas; //External atlas reference

        info.deviceNum = _this.atlas.data.heg.length;
        _this.atlas.data.hegshared = {
          sps: info.sps
        };

        _this.atlas.addHEGCoord(_this.atlas.data.heg.length);

        _this.atlas.settings.heg = true;
        info.useAtlas = true;

        if (info.analysis.length > 0) {
          var _this$atlas$settings$;

          (_this$atlas$settings$ = _this.atlas.settings.analysis).push.apply(_this$atlas$settings$, hegduinoPlugin_toConsumableArray(info.analysis));

          if (!_this.atlas.settings.analyzing) {
            _this.atlas.settings.analyzing = true;

            _this.atlas.analyzer();
          }
        }
      }
    };

    this.connect = function () {
      _this.device.connect();
    };

    this.disconnect = function () {
      _this.device.disconnect();

      if (_this.ui) _this.ui.deleteNode();
    };

    this.onconnect = function () {};

    this.ondisconnect = function () {};

    this.addControls = function () {
      var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
      var id = Math.floor(Math.random() * 10000); //prevents any possible overlap with other elements

      var template = function template() {
        var t = "\n            <br>\n            <div id='" + id + "hegduinoControls'>\n                <h3>Control Panel</h3>\n                <hr>\n                <button id='" + id + "hegon'>On</button>\n                <button id='" + id + "hegoff'>Off</button>\n                <input id='" + id + "hegcmd' type='text' placeholder='R'></input><button id='" + id + "sendcmd'>Send</button>\n                Add Digital Filters:<input id='" + id + "filter' type='checkbox'></input>\n            ";

        if (_this.mode === 'hegduino_ble') {
          t += "\n                <button id='" + id + "hegupdate'>Update Firmware (.bin)</button>\n                </div>\n                ";
        } else {
          t += "</div>";
        }

        return t;
      };

      var setup = function setup() {
        document.getElementById(id + 'hegon').onclick = function () {
          _this.device.sendCommand('t');
        };

        document.getElementById(id + 'hegoff').onclick = function () {
          _this.device.sendCommand('f');
        };

        document.getElementById(id + 'sendcmd').onclick = function () {
          _this.device.sendCommand(document.getElementById(id + 'hegcmd').value);
        };

        if (_this.mode === 'hegduino_ble') {
          document.getElementById(id + 'hegupdate').onclick = function () {
            _this.device.getFile(); //testing

          };
        }

        document.getElementById(id + 'filter').onchange = function () {
          _this.filters.forEach(function (filter) {
            if (filter.filtering) filter.filtering = false;else filter.filtering = true;
          });
        };
      };

      _this.ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
    };

    this.atlas = null;
    this.mode = mode;
    this.device = null; //Invoke a device class here if needed

    this.filters = [];
    this.filtering = false;
    this.ui = null;
    this.refuS = 0;
    this.onconnect = onconnect;
    this.ondisconnect = ondisconnect;
  } //Input data and averaging window, output array of moving averages (should be same size as input array, initial values not fully averaged due to window)


  hegduinoPlugin_createClass(hegduinoPlugin, [{
    key: "mean",
    value: function mean(arr) {
      var sum = arr.reduce(function (prev, curr) {
        return curr += prev;
      });
      return sum / arr.length;
    }
  }]);

  return hegduinoPlugin;
}();
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/cyton/cyton.js
function cyton_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function cyton_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { cyton_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { cyton_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function cyton_toConsumableArray(arr) { return cyton_arrayWithoutHoles(arr) || cyton_iterableToArray(arr) || cyton_unsupportedIterableToArray(arr) || cyton_nonIterableSpread(); }

function cyton_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function cyton_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return cyton_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return cyton_arrayLikeToArray(o, minLen); }

function cyton_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function cyton_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return cyton_arrayLikeToArray(arr); }

function cyton_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function cyton_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { cyton_typeof = function _typeof(obj) { return typeof obj; }; } else { cyton_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return cyton_typeof(obj); }

function cyton_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function cyton_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function cyton_createClass(Constructor, protoProps, staticProps) { if (protoProps) cyton_defineProperties(Constructor.prototype, protoProps); if (staticProps) cyton_defineProperties(Constructor, staticProps); return Constructor; }

//Joshua Brewster, GPL (copyleft)
 //For async functions on node\\

var cyton = /*#__PURE__*/function () {
  //Contains structs and necessary functions/API calls to analyze serial data for the OpenBCI Cyton and Daisy-Cyto
  function cyton() {
    var onDecodedCallback = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.onDecodedCallback;
    var onConnectedCallback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onConnectedCallback;
    var onDisconnectedCallback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.onDisconnectedCallback;
    var mode = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 'daisy';
    var CustomDecoder = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : this.decode;
    var baudrate = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 115200;

    cyton_classCallCheck(this, cyton);

    this.onDecodedCallback = onDecodedCallback;
    this.onConnectedCallback = onConnectedCallback;
    this.onDisconnectedCallback = onDisconnectedCallback;
    this.decode = CustomDecoder; //Free EEG 32 data structure:

    /*
        [stop byte, start byte, counter byte, 32x3 channel data bytes (24 bit), 3x2 accelerometer data bytes, stop byte, start byte...] Gyroscope not enabled yet but would be printed after the accelerometer..
        Total = 105 bytes/line
    */

    this.connected = false;
    this.subscribed = false;
    this.buffer = [];
    this.startByte = 160; //0xA0; // Start byte value

    this.stopByte = 192; //0xC0; // Stop byte value  //0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6

    this.searchString = new Uint8Array([this.stopByte, this.startByte]); //Byte search string

    this.readRate = 16.666667; //Throttle EEG read speed. (1.953ms/sample min @103 bytes/line)

    this.readBufferSize = 2000; //Serial read buffer size, increase for slower read speeds (~1030bytes every 20ms) to keep up with the stream (or it will crash)

    this.sps = 250; // Sample rate

    this.nChannels = 16;
    this.nPeripheralChannels = 6; // accelerometer and gyroscope (2 bytes * 3 coordinates each)

    this.updateMs = 1000 / this.sps; //even spacing

    this.stepSize = 1 / (Math.pow(2, 23) - 1);
    this.vref = 4.50; //2.5V voltage ref +/- 250nV

    this.gain = 24;
    this.vscale = this.vref / this.gain * this.stepSize; //volts per step.

    this.uVperStep = 1000000 * (this.vref / this.gain * this.stepSize); //uV per step.

    this.scalar = 1 / (1000000 / (this.vref / this.gain * this.stepSize)); //steps per uV.

    this.maxBufferedSamples = this.sps * 60 * 1; //max samples in buffer this.sps*60*nMinutes = max minutes of data

    this.mode = mode;
    this.data = {
      //Data object to keep our head from exploding. Get current data with e.g. this.data.A0[this.data.count-1]
      count: 0,
      startms: 0,
      ms: [],
      'A0': [],
      'A1': [],
      'A2': [],
      'A3': [],
      'A4': [],
      'A5': [],
      'A6': [],
      'A7': [],
      //ADC 0
      'A8': [],
      'A9': [],
      'A10': [],
      'A11': [],
      'A12': [],
      'A13': [],
      'A14': [],
      'A15': [],
      //ADC 1
      'Ax': [],
      'Ay': [],
      'Az': [],
      'Gx': [],
      'Gy': [],
      'Gz': [] //Peripheral data (accelerometer, gyroscope)

    };
    this.resetDataBuffers(); //navigator.serial utils

    if (!navigator.serial) {
      console.error("`navigator.serial not found! Enable #enable-experimental-web-platform-features in chrome://flags (search 'experimental')");
    }

    this.port = null;
    this.reader = null;
    this.baudrate = baudrate;
  }

  cyton_createClass(cyton, [{
    key: "resetDataBuffers",
    value: function resetDataBuffers() {
      this.data.count = 0;
      this.data.startms = 0;

      for (var prop in this.data) {
        if (cyton_typeof(this.data[prop]) === "object") {
          this.data[prop] = new Array(this.maxBufferedSamples).fill(0);
        }
      }
    }
  }, {
    key: "setScalar",
    value: function setScalar() {
      var gain = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 24;
      var stepSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1 / (Math.pow(2, 23) - 1);
      var vref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 4.50;
      this.stepSize = stepSize;
      this.vref = vref; //2.5V voltage ref +/- 250nV

      this.gain = gain;
      this.vscale = this.vref / this.gain * this.stepSize; //volts per step.

      this.uVperStep = 1000000 * (this.vref / this.gain * this.stepSize); //uV per step.

      this.scalar = 1 / (1000000 / (this.vref / this.gain * this.stepSize)); //steps per uV.
    }
  }, {
    key: "getLatestData",
    value: function getLatestData() {
      var channel = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "A0";
      var count = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      //Return slice of specified size of the latest data from the specified channel
      var ct = count;

      if (ct <= 1) {
        return [this.data[channel][this.data.count - 1]];
      } else {
        if (ct > this.data.count) {
          ct = this.data.count;
        }

        return this.data[channel].slice(this.data.count - ct, this.data.count);
      }
    } //cyton uses signed ints

  }, {
    key: "bytesToInt16",
    value: function bytesToInt16(x0, x1) {
      var int16 = (0xFF & x0) << 8 | 0xFF & x1;

      if ((int16 & 0x00800000) > 0) {
        int16 |= 0xFFFF0000;
      } else {
        int16 &= 0x0000FFFF;
      }

      return int16;
    }
  }, {
    key: "int16ToBytes",
    value: function int16ToBytes(y) {
      //Turns a 24 bit int into a 3 byte sequence
      return [y & 0xFF, y >> 8 & 0xFF];
    } //cyton uses signed ints

  }, {
    key: "bytesToInt24",
    value: function bytesToInt24(x0, x1, x2) {
      //Turns a 3 byte sequence into a 24 bit int
      var int24 = (0xFF & x0) << 16 | (0xFF & x1) << 8 | 0xFF & x2;

      if ((int24 & 0x00800000) > 0) {
        int24 |= 0xFF000000;
      } else {
        int24 &= 0x00FFFFFF;
      }

      return int24;
    }
  }, {
    key: "int24ToBytes",
    value: function int24ToBytes(y) {
      //Turns a 24 bit int into a 3 byte sequence
      return [y & 0xFF, y >> 8 & 0xFF, y >> 16 & 0xFF];
    }
  }, {
    key: "decode",
    value: function decode() {
      var buffer = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.buffer;
      //returns true if successful, returns false if not
      var needle = this.searchString;
      var haystack = buffer;
      var search = this.boyerMoore(needle);
      var skip = search.byteLength;
      var indices = [];
      var newLines = 0;

      for (var i = search(haystack); i !== -1; i = search(haystack, i + skip)) {
        indices.push(i);
      } //console.log(indices);


      if (indices.length >= 2) {
        for (var k = 1; k < indices.length; k++) {
          if (indices[k] - indices[k - 1] === 33) {
            var line = buffer.slice(indices[k - 1], indices[k] + 1); //Slice out this line to be decoded
            // line[0] = stop byte, line[1] = start byte, line[2] = counter, line[3:99] = ADC data 32x3 bytes, line[100-104] = Accelerometer data 3x2 bytes
            //line found, decode.

            if (this.data.count < this.maxBufferedSamples) {
              this.data.count++;
            }

            if (this.data.count - 1 === 0) {
              this.data.ms[this.data.count - 1] = Date.now();
              this.data.startms = this.data.ms[0];
            } else {
              this.data.ms[this.data.count - 1] = this.data.ms[this.data.count - 2] + this.updateMs;

              if (this.data.count >= this.maxBufferedSamples) {
                this.data.ms.splice(0, 5120);
                this.data.ms.push(new Array(5120).fill(0));
              }
            } //Assume no dropped samples


            for (var i = 3; i < 27; i += 3) {
              var channel = void 0;

              if (this.mode === 'daisy') {
                if (line[2] % 2 !== 0) {
                  channel = "A" + (i - 3) / 3;
                } else {
                  channel = "A" + (8 + (i - 3) / 3);
                }
              } else {
                channel = "A" + (i - 3) / 3;
              }

              this.data[channel][this.data.count - 1] = this.bytesToInt24(line[i], line[i + 1], line[i + 2]);

              if (this.data.count >= this.maxBufferedSamples) {
                this.data[channel].splice(0, 5120);
                this.data[channel].push(new Array(5120).fill(0)); //shave off the last 10 seconds of data if buffer full (don't use shift())
              } //console.log(this.data[channel][this.data.count-1],indices[k], channel)

            }

            this.data["Ax"][this.data.count - 1] = this.bytesToInt16(line[27], line[28]);
            this.data["Ay"][this.data.count - 1] = this.bytesToInt16(line[29], line[30]);
            this.data["Az"][this.data.count - 1] = this.bytesToInt16(line[31], line[32]);

            if (this.data.count >= this.maxBufferedSamples) {
              this.data["Ax"].splice(0, 5120);
              this.data["Ay"].splice(0, 5120);
              this.data["Az"].splice(0, 5120);
              this.data["Ax"].push(new Array(5120).fill(0));
              this.data["Ay"].push(new Array(5120).fill(0));
              this.data["Az"].push(new Array(5120).fill(0));
              this.data.count -= 5120;
            } //console.log(this.data)


            newLines++; //console.log(indices[k-1],indices[k])
            //console.log(buffer[indices[k-1],buffer[indices[k]]])
            //indices.shift();
          }
        }

        if (newLines > 0) buffer.splice(0, indices[indices.length - 1]);
        return newLines; //Continue
      } //else {this.buffer = []; return false;}

    } //Callbacks

  }, {
    key: "onDecodedCallback",
    value: function onDecodedCallback(newLinesInt) {//console.log("new samples:", newLinesInt);
    }
  }, {
    key: "onConnectedCallback",
    value: function onConnectedCallback() {
      console.log("port connected!");
    }
  }, {
    key: "onDisconnectedCallback",
    value: function onDisconnectedCallback() {
      console.log("port disconnected!");
    }
  }, {
    key: "onReceive",
    value: function onReceive(value) {
      var _this$buffer;

      (_this$buffer = this.buffer).push.apply(_this$buffer, cyton_toConsumableArray(value)); //console.log(this.buffer);
      //console.log("decoding... ", this.buffer.length)


      var newLines = this.decode(this.buffer); //console.log(newLines, this.data);
      //console.log(this.data)

      if (newLines !== false && newLines !== 0 && !isNaN(newLines)) this.onDecodedCallback(newLines);
    }
  }, {
    key: "sendMsg",
    value: function () {
      var _sendMsg = cyton_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(msg) {
        var encodedString, bytes, writer;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                msg += "\n";
                encodedString = unescape(encodeURIComponent(msg));
                bytes = new Uint8Array(encodedString.length);
                writer = this.port.writable.getWriter();
                _context.next = 6;
                return writer.write(bytes.buffer);

              case 6:
                writer.releaseLock();
                return _context.abrupt("return", true);

              case 8:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this);
      }));

      function sendMsg(_x) {
        return _sendMsg.apply(this, arguments);
      }

      return sendMsg;
    }()
  }, {
    key: "onPortSelected",
    value: function () {
      var _onPortSelected = cyton_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(port) {
        var _this = this;

        var baud,
            _args2 = arguments;
        return regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                baud = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : this.baudrate;
                _context2.prev = 1;
                _context2.prev = 2;
                _context2.next = 5;
                return port.open({
                  baudRate: baud,
                  bufferSize: this.readBufferSize
                });

              case 5:
                setTimeout(function () {
                  _this.onConnectedCallback();

                  _this.connected = true;
                  _this.subscribed = true;

                  _this.sendMsg('b');

                  _this.subscribe(port); //this.subscribeSafe(port);

                }, 500);
                _context2.next = 13;
                break;

              case 8:
                _context2.prev = 8;
                _context2.t0 = _context2["catch"](2);
                _context2.next = 12;
                return port.open({
                  baudrate: baud,
                  buffersize: this.readBufferSize
                });

              case 12:
                setTimeout(function () {
                  _this.onConnectedCallback();

                  _this.connected = true;
                  _this.subscribed = true;

                  _this.sendMsg('b');

                  _this.subscribe(port); //this.subscribeSafe(port);

                }, 500);

              case 13:
                _context2.next = 19;
                break;

              case 15:
                _context2.prev = 15;
                _context2.t1 = _context2["catch"](1);
                console.log(_context2.t1);
                this.connected = false;

              case 19:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this, [[1, 15], [2, 8]]);
      }));

      function onPortSelected(_x2) {
        return _onPortSelected.apply(this, arguments);
      }

      return onPortSelected;
    }()
  }, {
    key: "subscribe",
    value: function () {
      var _subscribe = cyton_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4(port) {
        var _this2 = this;

        var streamData;
        return regeneratorRuntime.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                if (this.port.readable && this.subscribed === true) {
                  this.reader = port.readable.getReader();

                  streamData = /*#__PURE__*/function () {
                    var _ref = cyton_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {
                      var _yield$_this2$reader$, value, done;

                      return regeneratorRuntime.wrap(function _callee3$(_context3) {
                        while (1) {
                          switch (_context3.prev = _context3.next) {
                            case 0:
                              _context3.prev = 0;
                              _context3.next = 3;
                              return _this2.reader.read();

                            case 3:
                              _yield$_this2$reader$ = _context3.sent;
                              value = _yield$_this2$reader$.value;
                              done = _yield$_this2$reader$.done;

                              if (!(done || _this2.subscribed === false)) {
                                _context3.next = 9;
                                break;
                              }

                              _context3.next = 9;
                              return _this2.reader.releaseLock();

                            case 9:
                              if (value) {
                                //console.log(value.length);
                                try {
                                  _this2.onReceive(value);
                                } catch (err) {
                                  console.log(err);
                                } //console.log("new Read");
                                //console.log(this.decoder.decode(value));

                              }

                              if (_this2.subscribed === true) {
                                setTimeout(function () {
                                  streamData();
                                }, _this2.readRate); //Throttled read 1/512sps = 1.953ms/sample @ 103 bytes / line or 1030bytes every 20ms
                              }

                              _context3.next = 17;
                              break;

                            case 13:
                              _context3.prev = 13;
                              _context3.t0 = _context3["catch"](0);
                              console.log(_context3.t0); // TODO: Handle non-fatal read error.

                              _this2.closePort();

                            case 17:
                            case "end":
                              return _context3.stop();
                          }
                        }
                      }, _callee3, null, [[0, 13]]);
                    }));

                    return function streamData() {
                      return _ref.apply(this, arguments);
                    };
                  }();

                  streamData();
                }

              case 1:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function subscribe(_x3) {
        return _subscribe.apply(this, arguments);
      }

      return subscribe;
    }() //Unfinished

  }, {
    key: "subscribeSafe",
    value: function () {
      var _subscribeSafe = cyton_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5(port) {
        var _this3 = this;

        var readable;
        return regeneratorRuntime.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                //Using promises instead of async/await to cure hangs when the serial update does not meet tick requirements
                readable = new Promise(function (resolve, reject) {
                  while (_this3.port.readable && _this3.subscribed === true) {
                    _this3.reader = port.readable.getReader();
                    var looper = true;
                    var prom1 = new Promise(function (resolve, reject) {
                      return _this3.reader.read();
                    });
                    var prom2 = new Promise(function (resolve, reject) {
                      setTimeout(resolve, 100, "readfail");
                    });

                    while (looper === true) {
                      //console.log("reading...");
                      Promise.race([prom1, prom2]).then(function (result) {
                        console.log("newpromise");

                        if (result === "readfail") {
                          console.log(result);
                        } else {
                          var value = result.value,
                              done = result.done;

                          if (done === true || _this3.subscribed === true) {
                            var donezo = new Promise(function (resolve, reject) {
                              resolve(_this3.reader.releaseLock());
                            }).then(function () {
                              looper = false;
                              return;
                            });
                          } else {
                            _this3.onReceive(value);
                          }
                        }
                      });
                    }
                  }

                  resolve("not readable");
                });

              case 1:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5);
      }));

      function subscribeSafe(_x4) {
        return _subscribeSafe.apply(this, arguments);
      }

      return subscribeSafe;
    }()
  }, {
    key: "closePort",
    value: function () {
      var _closePort = cyton_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7() {
        var _this4 = this;

        var port,
            _args7 = arguments;
        return regeneratorRuntime.wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                port = _args7.length > 0 && _args7[0] !== undefined ? _args7[0] : this.port;

                //if(this.reader) {this.reader.releaseLock();}
                if (this.port) {
                  this.subscribed = false;
                  this.sendMsg('s');
                  setTimeout( /*#__PURE__*/cyton_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6() {
                    return regeneratorRuntime.wrap(function _callee6$(_context6) {
                      while (1) {
                        switch (_context6.prev = _context6.next) {
                          case 0:
                            if (_this4.reader) {
                              _this4.reader = null;
                            }

                            _context6.next = 3;
                            return port.close();

                          case 3:
                            _this4.port = null;
                            _this4.connected = false;

                            _this4.onDisconnectedCallback();

                          case 6:
                          case "end":
                            return _context6.stop();
                        }
                      }
                    }, _callee6);
                  })), 100);
                }

              case 2:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function closePort() {
        return _closePort.apply(this, arguments);
      }

      return closePort;
    }()
  }, {
    key: "setupSerialAsync",
    value: function () {
      var _setupSerialAsync = cyton_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee8() {
        var _this5 = this;

        var baudrate,
            filters,
            _args8 = arguments;
        return regeneratorRuntime.wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                baudrate = _args8.length > 0 && _args8[0] !== undefined ? _args8[0] : this.baudrate;
                //You can specify baudrate just in case
                filters = [{
                  usbVendorId: 0x10c4,
                  usbProductId: 0x0043
                } //CP2102 filter (e.g. for UART via ESP32)
                ];
                _context8.next = 4;
                return navigator.serial.requestPort();

              case 4:
                this.port = _context8.sent;
                navigator.serial.addEventListener("disconnect", function (e) {
                  _this5.closePort(_this5.port);
                });
                this.onPortSelected(this.port, baudrate); //navigator.serial.addEventListener("onReceive", (e) => {console.log(e)});//this.onReceive(e));

              case 7:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function setupSerialAsync() {
        return _setupSerialAsync.apply(this, arguments);
      }

      return setupSerialAsync;
    }() //Boyer Moore fast byte search method copied from https://codereview.stackexchange.com/questions/20136/uint8array-indexof-method-that-allows-to-search-for-byte-sequences

  }, {
    key: "asUint8Array",
    value: function asUint8Array(input) {
      if (input instanceof Uint8Array) {
        return input;
      } else if (typeof input === 'string') {
        // This naive transform only supports ASCII patterns. UTF-8 support
        // not necessary for the intended use case here.
        var arr = new Uint8Array(input.length);

        for (var i = 0; i < input.length; i++) {
          var c = input.charCodeAt(i);

          if (c > 127) {
            throw new TypeError("Only ASCII patterns are supported");
          }

          arr[i] = c;
        }

        return arr;
      } else {
        // Assume that it's already something that can be coerced.
        return new Uint8Array(input);
      }
    }
  }, {
    key: "boyerMoore",
    value: function boyerMoore(patternBuffer) {
      var _this6 = this;

      // Implementation of Boyer-Moore substring search ported from page 772 of
      // Algorithms Fourth Edition (Sedgewick, Wayne)
      // http://algs4.cs.princeton.edu/53substring/BoyerMoore.java.html

      /*
      USAGE:
      	// needle should be ASCII string, ArrayBuffer, or Uint8Array
      	// haystack should be an ArrayBuffer or Uint8Array
      	var search = boyerMoore(needle);
      	var skip = search.byteLength;
      	var indices = [];
      	for (var i = search(haystack); i !== -1; i = search(haystack, i + skip)) {
      		indices.push(i);
      	}
      */
      var pattern = this.asUint8Array(patternBuffer);
      var M = pattern.length;

      if (M === 0) {
        throw new TypeError("patternBuffer must be at least 1 byte long");
      } // radix


      var R = 256;
      var rightmost_positions = new Int32Array(R); // position of the rightmost occurrence of the byte c in the pattern

      for (var c = 0; c < R; c++) {
        // -1 for bytes not in pattern
        rightmost_positions[c] = -1;
      }

      for (var j = 0; j < M; j++) {
        // rightmost position for bytes in pattern
        rightmost_positions[pattern[j]] = j;
      }

      var boyerMooreSearch = function boyerMooreSearch(txtBuffer, start, end) {
        // Return offset of first match, -1 if no match.
        var txt = _this6.asUint8Array(txtBuffer);

        if (start === undefined) start = 0;
        if (end === undefined) end = txt.length;
        var pat = pattern;
        var right = rightmost_positions;
        var lastIndex = end - pat.length;
        var lastPatIndex = pat.length - 1;
        var skip;

        for (var i = start; i <= lastIndex; i += skip) {
          skip = 0;

          for (var j = lastPatIndex; j >= 0; j--) {
            var c = txt[i + j];

            if (pat[j] !== c) {
              skip = Math.max(1, j - right[c]);
              break;
            }
          }

          if (skip === 0) {
            return i;
          }
        }

        return -1;
      };

      boyerMooreSearch.byteLength = pattern.byteLength;
      return boyerMooreSearch;
    } //---------------------end copy/pasted solution------------------------

  }]);

  return cyton;
}();
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/cyton/cytonPlugin.js
function cytonPlugin_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { cytonPlugin_typeof = function _typeof(obj) { return typeof obj; }; } else { cytonPlugin_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return cytonPlugin_typeof(obj); }

function cytonPlugin_toConsumableArray(arr) { return cytonPlugin_arrayWithoutHoles(arr) || cytonPlugin_iterableToArray(arr) || cytonPlugin_unsupportedIterableToArray(arr) || cytonPlugin_nonIterableSpread(); }

function cytonPlugin_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function cytonPlugin_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return cytonPlugin_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return cytonPlugin_arrayLikeToArray(o, minLen); }

function cytonPlugin_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function cytonPlugin_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return cytonPlugin_arrayLikeToArray(arr); }

function cytonPlugin_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function cytonPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function cytonPlugin_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { cytonPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { cytonPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function cytonPlugin_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

//Template system to feed into the deviceStream class for creating possible configurations. 
//Just fill out the template functions accordingly and add this class (with a unique name) to the list of usable devices.




var cytonPlugin = function cytonPlugin() {
  var _this = this;

  var mode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'cyton_daisy';
  var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onconnect;
  var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.ondisconnect;

  cytonPlugin_classCallCheck(this, cytonPlugin);

  this.init = /*#__PURE__*/cytonPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
    var info,
        pipeToAtlas,
        onDecoded,
        onConnect,
        onDisconnect,
        eegChannelTags,
        _args = arguments;
    return regeneratorRuntime.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            info = _args.length > 0 && _args[0] !== undefined ? _args[0] : {
              sps: null,
              deviceType: null,
              eegChannelTags: null,
              analysis: ['eegfft'],
              useAtlas: undefined
            };
            pipeToAtlas = _args.length > 1 && _args[1] !== undefined ? _args[1] : true;
            //info and pipeToAtlas passed by reference from deviceStream class
            info.sps = 250;
            info.deviceType = 'eeg';

            onDecoded = function onDecoded(newLinesInt) {
              _this.atlas.data.eegshared.eegChannelTags.forEach(function (o, i) {
                var latest = _this.device.getLatestData("A" + o.ch, newLinesInt);

                var latestFiltered = new Array(latest.length).fill(0);

                if (o.tag !== "other" && info.useFilters === true) {
                  _this.filters.forEach(function (f, j) {
                    if (f.channel === o.ch) {
                      latest.forEach(function (sample, k) {
                        latestFiltered[k] = f.apply(sample);
                      });
                    }
                  });

                  if (info.useAtlas === true) {
                    var _coord$times, _coord$filtered, _coord$raw;

                    var coord;

                    if (o.tag !== null) {
                      coord = _this.atlas.getEEGDataByTag(o.tag);
                    } else {
                      coord = _this.atlas.getEEGDataByChannel(o.ch);
                    }

                    coord.count += newLinesInt;

                    (_coord$times = coord.times).push.apply(_coord$times, cytonPlugin_toConsumableArray(_this.device.data.ms.slice(_this.device.data.count - newLinesInt, _this.device.data.count)));

                    (_coord$filtered = coord.filtered).push.apply(_coord$filtered, cytonPlugin_toConsumableArray(latestFiltered));

                    (_coord$raw = coord.raw).push.apply(_coord$raw, cytonPlugin_toConsumableArray(latest));
                  }
                } else {
                  if (info.useAtlas === true) {
                    var _coord$times2, _coord$raw2;

                    var _coord = _this.atlas.getEEGDataByChannel(o.ch);

                    _coord.count += newLinesInt;

                    (_coord$times2 = _coord.times).push.apply(_coord$times2, cytonPlugin_toConsumableArray(_this.device.data.ms.slice(_this.device.data.count - newLinesInt, _this.device.data.count)));

                    (_coord$raw2 = _coord.raw).push.apply(_coord$raw2, cytonPlugin_toConsumableArray(latest));
                  }
                }
              });
            };

            onConnect = function onConnect() {
              _this.setupAtlas(pipeToAtlas, info);

              if (info.useAtlas === true) {
                _this.atlas.data.eegshared.startTime = Date.now();

                if (_this.atlas.settings.analyzing !== true && info.analysis.length > 0) {
                  _this.atlas.settings.analyzing = true;
                  setTimeout(function () {
                    _this.atlas.analyzer();
                  }, 1200);
                }
              }

              _this.atlas.settings.deviceConnected = true;

              _this.onconnect();
            };

            onDisconnect = function onDisconnect() {
              _this.atlas.settings.analyzing = false;
              _this.atlas.settings.deviceConnected = false;

              _this.ondisconnect();
            };

            eegChannelTags = [];

            if (_this.mode.indexOf('Daisy') > -1) {
              eegChannelTags = [{
                ch: 0,
                tag: "FP1",
                analyze: true
              }, {
                ch: 1,
                tag: "FP2",
                analyze: true
              }, {
                ch: 2,
                tag: "C3",
                analyze: true
              }, {
                ch: 3,
                tag: "C4",
                analyze: true
              }, {
                ch: 4,
                tag: "P7",
                analyze: true
              }, {
                ch: 5,
                tag: "P8",
                analyze: true
              }, {
                ch: 6,
                tag: "O1",
                analyze: true
              }, {
                ch: 7,
                tag: "O2",
                analyze: true
              }, {
                ch: 8,
                tag: "F7",
                analyze: true
              }, {
                ch: 9,
                tag: "F8",
                analyze: true
              }, {
                ch: 10,
                tag: "F3",
                analyze: true
              }, {
                ch: 11,
                tag: "F4",
                analyze: true
              }, {
                ch: 12,
                tag: "T7",
                analyze: true
              }, {
                ch: 13,
                tag: "T8",
                analyze: true
              }, {
                ch: 14,
                tag: "P3",
                analyze: true
              }, {
                ch: 15,
                tag: "P4",
                analyze: true
              }];
              _this.device = new cyton(onDecoded, onConnect, onDisconnect, 'daisy');
            } else {
              eegChannelTags = [{
                ch: 0,
                tag: "FP1",
                analyze: true
              }, {
                ch: 1,
                tag: "FP2",
                analyze: true
              }, {
                ch: 2,
                tag: "C3",
                analyze: true
              }, {
                ch: 3,
                tag: "C4",
                analyze: true
              }, {
                ch: 4,
                tag: "P7",
                analyze: true
              }, {
                ch: 5,
                tag: "P8",
                analyze: true
              }, {
                ch: 6,
                tag: "O1",
                analyze: true
              }, {
                ch: 7,
                tag: "O2",
                analyze: true
              }];
              _this.device = new cyton(onDecoded, onConnect, onDisconnect, 'single');
            }

          case 9:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  }));

  this.setupAtlas = function () {
    var pipeToAtlas = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
    var info = arguments.length > 1 ? arguments[1] : undefined;

    if (info.useFilters === true) {
      eegChannelTags.forEach(function (row, i) {
        if (row.tag !== 'other') {
          _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, true, _this.device.uVperStep));
        } else {
          _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, false, _this.device.uVperStep));
        }
      });
    }

    info.eegChannelTags = eegChannelTags;

    if (pipeToAtlas === true) {
      //New Atlas
      var config = '10_20';
      _this.atlas = new DataAtlas_DataAtlas(location + ":" + _this.mode, {
        eegshared: {
          eegChannelTags: info.eegChannelTags,
          sps: info.sps
        }
      }, config, true, true, info.analysis);
      info.useAtlas = true;
    } else if (cytonPlugin_typeof(pipeToAtlas) === 'object') {
      //Reusing an atlas
      _this.atlas = pipeToAtlas; //External atlas reference

      _this.atlas.data.eegshared.eegChannelTags = info.eegChannelTags;
      _this.atlas.data.eegshared.sps = info.sps;
      _this.atlas.data.eegshared.frequencies = _this.atlas.bandpassWindow(0, 128, info.sps * 0.5);
      _this.atlas.data.eegshared.bandFreqs = _this.atlas.getBandFreqs(_this.atlas.data.eegshared.frequencies);
      _this.atlas.data.eeg = _this.atlas.gen10_20Atlas();
      _this.atlas.data.coherence = _this.atlas.genCoherenceMap(info.eegChannelTags);

      _this.atlas.data.eegshared.eegChannelTags.forEach(function (row, i) {
        if (_this.atlas.getEEGDataByTag(row.tag) === undefined) {
          _this.atlas.addEEGCoord(row.ch);
        }
      });

      _this.atlas.settings.coherence = true;
      _this.atlas.settings.eeg = true;
      info.useAtlas = true;

      if (info.analysis.length > 0) {
        var _this$atlas$settings$;

        (_this$atlas$settings$ = _this.atlas.settings.analysis).push.apply(_this$atlas$settings$, cytonPlugin_toConsumableArray(info.analysis));

        if (!_this.atlas.settings.analyzing) {
          _this.atlas.settings.analyzing = true;

          _this.atlas.analyzer();
        }
      }
    }
  };

  this.connect = /*#__PURE__*/cytonPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
    return regeneratorRuntime.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            _context2.next = 2;
            return _this.device.setupSerialAsync();

          case 2:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  }));

  this.disconnect = function () {
    if (_this.ui) _this.ui.deleteNode();

    _this.device.closePort();
  };

  this.onconnect = function () {};

  this.ondisconnect = function () {};

  this.addControls = function () {
    var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
    var id = Math.floor(Math.random() * 10000); //prevents any possible overlap with other elements

    var template = function template() {
      return "\n            ";
    };

    var setup = function setup() {};

    _this.ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
  };

  this.atlas = null;
  this.mode = mode;
  this.device = null; //Invoke a device class here if needed

  this.filters = [];
  this.onconnect = onconnect;
  this.ondisconnect = ondisconnect;
};
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/webgazerPlugin.js
function webgazerPlugin_toConsumableArray(arr) { return webgazerPlugin_arrayWithoutHoles(arr) || webgazerPlugin_iterableToArray(arr) || webgazerPlugin_unsupportedIterableToArray(arr) || webgazerPlugin_nonIterableSpread(); }

function webgazerPlugin_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function webgazerPlugin_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return webgazerPlugin_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return webgazerPlugin_arrayLikeToArray(o, minLen); }

function webgazerPlugin_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function webgazerPlugin_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return webgazerPlugin_arrayLikeToArray(arr); }

function webgazerPlugin_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function webgazerPlugin_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { webgazerPlugin_typeof = function _typeof(obj) { return typeof obj; }; } else { webgazerPlugin_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return webgazerPlugin_typeof(obj); }

function webgazerPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function webgazerPlugin_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { webgazerPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { webgazerPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function webgazerPlugin_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

//Template system to feed into the deviceStream class for creating possible configurations. 
//Just fill out the template functions accordingly and add this class (with a unique name) to the list of usable devices.


 //import webgazer from 'webgazer'

var webgazer;
var webgazerPlugin = function webgazerPlugin(mode) {
  var _this = this;

  var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onconnect;
  var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.ondisconnect;

  webgazerPlugin_classCallCheck(this, webgazerPlugin);

  this.init = /*#__PURE__*/function () {
    var _ref = webgazerPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(info, pipeToAtlas) {
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              info.deviceType = 'eyetracker';

              _this._onConnected = function () {
                _this.setupAtlas(info, pipeToAtlas);
              };

              _this.info = info;

            case 3:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }();

  this.setupAtlas = function (info, pipeToAtlas) {
    if (pipeToAtlas === true) {
      var config = 'eyetracker';
      _this.atlas = new DataAtlas(location + ":" + _this.mode, undefined, config, true, true, info.analysis);
      info.deviceNum = _this.atlas.data.heg.length - 1;
      info.useAtlas = true;
      info.deviceNum = _this.atlas.data.eyetracker.length - 1;
    } else if (webgazerPlugin_typeof(pipeToAtlas) === 'object') {
      _this.atlas = pipeToAtlas; //External atlas reference

      info.deviceNum = _this.atlas.data.eyetracker.length;

      _this.atlas.addEyeTracker(_this.atlas.data.eyetracker.length);

      _this.atlas.settings.eyetracker = true;
      info.useAtlas = true;

      if (info.analysis.length > 0) {
        var _this$atlas$settings$;

        (_this$atlas$settings$ = _this.atlas.settings.analysis).push.apply(_this$atlas$settings$, webgazerPlugin_toConsumableArray(info.analysis));

        if (!_this.atlas.settings.analyzing) {
          _this.atlas.settings.analyzing = true;

          _this.atlas.analyzer();
        }
      }
    }
  };

  this._onConnected = function () {};

  this.connect = function () {
    _this._onConnected();

    _this.atlas.settings.deviceConnected = true;
    webgazer.setGazeListener(function (data, elapsedTime) {
      if (data == null) {
        return;
      }

      var x = data.x;
      var y = data.y;

      if (_this.info.useAtlas === true) {
        var o = _this.atlas.data.eyetracker[_this.info.deviceNum];

        if (o.times.length === 0) {
          o.startTime = Date.now();
        }

        o.times.push(Date.now());
        o.x.push(data.x);
        o.y.push(data.y);

        if (o.x.length > 10) {
          //10 sample moving average (to smooth things out)
          o.smax.push(o.x.slice(o.x.length - 10).reduce(function (a, b) {
            return a + b;
          }) / 10);
          o.smay.push(o.y.slice(o.y.length - 10).reduce(function (a, b) {
            return a + b;
          }) / 10);
        } else {
          o.smax.push(o.x.slice(0).reduce(function (a, b) {
            return a + b;
          }) / o.x.length);
          o.smay.push(o.y.slice(0).reduce(function (a, b) {
            return a + b;
          }) / o.y.length);
        }
      }
    }).begin();

    _this.onconnect();
  };

  this.disconnect = function () {
    if (_this.ui) _this.ui.deleteNode();
    webgazer.end();
    _this.atlas.settings.deviceConnected = false;

    _this.ondisconnect();
  };

  this.onconnect = function () {};

  this.ondisconnect = function () {};

  this.addControls = function () {
    var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
    var id = Math.floor(Math.random() * 10000); //prevents any possible overlap with other elements

    var template = function template() {
      return "\n            ";
    };

    var setup = function setup() {};

    _this.ui = new DOMFragment(template, parentNode, undefined, setup);
  };

  this.atlas = null;
  this.mode = mode;
  this.device = null; //Invoke a device class here if needed

  this.filters = [];
  this.info;
  this.onconnect = onconnect;
  this.ondisconnect = ondisconnect;
};
// EXTERNAL MODULE: ./node_modules/rxjs/Subject.js
var Subject = __webpack_require__(8314);
// EXTERNAL MODULE: ./node_modules/rxjs/BehaviorSubject.js
var BehaviorSubject = __webpack_require__(9122);
// EXTERNAL MODULE: ./node_modules/rxjs/operators/tap.js
var tap = __webpack_require__(9890);
// EXTERNAL MODULE: ./node_modules/rxjs/operators/map.js
var map = __webpack_require__(2068);
// EXTERNAL MODULE: ./node_modules/rxjs/operators/first.js
var first = __webpack_require__(173);
// EXTERNAL MODULE: ./node_modules/rxjs/operators/filter.js
var filter = __webpack_require__(8111);
// EXTERNAL MODULE: ./node_modules/rxjs/operators/takeUntil.js
var takeUntil = __webpack_require__(8120);
// EXTERNAL MODULE: ./node_modules/rxjs/operators/mergeMap.js
var mergeMap = __webpack_require__(904);
// EXTERNAL MODULE: ./node_modules/rxjs/observable/fromEvent.js
var fromEvent = __webpack_require__(9126);
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/ganglion/ganglion-ble-master/src/openbci_constants.js
/* provided dependency */ var Buffer = __webpack_require__(8764)["Buffer"];
/**
* Created by ajk on 12/16/15.
* Purpose: This file folds all the constants for the
*     OpenBCI Board
*/
 //import { Buffer } from 'buffer/';

/** Turning channels off */

function openbci_constants_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { openbci_constants_typeof = function _typeof(obj) { return typeof obj; }; } else { openbci_constants_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return openbci_constants_typeof(obj); }

var obciChannelOff1 = '1';
var obciChannelOff2 = '2';
var obciChannelOff3 = '3';
var obciChannelOff4 = '4';
var obciChannelOff5 = '5';
var obciChannelOff6 = '6';
var obciChannelOff7 = '7';
var obciChannelOff8 = '8';
var obciChannelOff9 = 'q';
var obciChannelOff10 = 'w';
var obciChannelOff11 = 'e';
var obciChannelOff12 = 'r';
var obciChannelOff13 = 't';
var obciChannelOff14 = 'y';
var obciChannelOff15 = 'u';
var obciChannelOff16 = 'i';
/** Turn channels on */

var obciChannelOn1 = '!';
var obciChannelOn2 = '@';
var obciChannelOn3 = '#';
var obciChannelOn4 = '$';
var obciChannelOn5 = '%';
var obciChannelOn6 = '^';
var obciChannelOn7 = '&';
var obciChannelOn8 = '*';
var obciChannelOn9 = 'Q';
var obciChannelOn10 = 'W';
var obciChannelOn11 = 'E';
var obciChannelOn12 = 'R';
var obciChannelOn13 = 'T';
var obciChannelOn14 = 'Y';
var obciChannelOn15 = 'U';
var obciChannelOn16 = 'I';
/** Test Signal Control Commands
* 1x - Voltage will be 1 * (VREFP - VREFN) / 2.4 mV
* 2x - Voltage will be 2 * (VREFP - VREFN) / 2.4 mV
*/

var obciTestSignalConnectToDC = 'p';
var obciTestSignalConnectToGround = '0';
var obciTestSignalConnectToPulse1xFast = '=';
var obciTestSignalConnectToPulse1xSlow = '-';
var obciTestSignalConnectToPulse2xFast = ']';
var obciTestSignalConnectToPulse2xSlow = '[';
/** Channel Setting Commands */

var obciChannelCmdADCNormal = '0';
var obciChannelCmdADCShorted = '1';
var obciChannelCmdADCBiasDRP = '6';
var obciChannelCmdADCBiasDRN = '7';
var obciChannelCmdADCBiasMethod = '2';
var obciChannelCmdADCMVDD = '3';
var obciChannelCmdADCTemp = '4';
var obciChannelCmdADCTestSig = '5';
var obciChannelCmdBiasInclude = '1';
var obciChannelCmdBiasRemove = '0';
var obciChannelCmdChannel1 = '1';
var obciChannelCmdChannel2 = '2';
var obciChannelCmdChannel3 = '3';
var obciChannelCmdChannel4 = '4';
var obciChannelCmdChannel5 = '5';
var obciChannelCmdChannel6 = '6';
var obciChannelCmdChannel7 = '7';
var obciChannelCmdChannel8 = '8';
var obciChannelCmdChannel9 = 'Q';
var obciChannelCmdChannel10 = 'W';
var obciChannelCmdChannel11 = 'E';
var obciChannelCmdChannel12 = 'R';
var obciChannelCmdChannel13 = 'T';
var obciChannelCmdChannel14 = 'Y';
var obciChannelCmdChannel15 = 'U';
var obciChannelCmdChannel16 = 'I';
var obciChannelCmdGain1 = '0';
var obciChannelCmdGain2 = '1';
var obciChannelCmdGain4 = '2';
var obciChannelCmdGain6 = '3';
var obciChannelCmdGain8 = '4';
var obciChannelCmdGain12 = '5';
var obciChannelCmdGain24 = '6';
var obciChannelCmdLatch = 'X';
var obciChannelCmdPowerOff = '1';
var obciChannelCmdPowerOn = '0';
var obciChannelCmdSet = 'x';
var obciChannelCmdSRB1Connect = '1';
var obciChannelCmdSRB1Diconnect = '0';
var obciChannelCmdSRB2Connect = '1';
var obciChannelCmdSRB2Diconnect = '0';
/** Channel Setting Helper Strings */

var obciStringADCNormal = 'normal';
var obciStringADCShorted = 'shorted';
var obciStringADCBiasMethod = 'biasMethod';
var obciStringADCMvdd = 'mvdd';
var obciStringADCTemp = 'temp';
var obciStringADCTestSig = 'testSig';
var obciStringADCBiasDrp = 'biasDrp';
var obciStringADCBiasDrn = 'biasDrn';
/** Default Channel Settings */

var obciChannelDefaultAllSet = 'd';
var obciChannelDefaultAllGet = 'D';
/** LeadOff Impedance Commands */

var obciChannelImpedanceLatch = 'Z';
var obciChannelImpedanceSet = 'z';
var obciChannelImpedanceTestSignalApplied = '1';
var obciChannelImpedanceTestSignalAppliedNot = '0';
/** SD card Commands */

var obciSDLogForHour1 = 'G';
var obciSDLogForHour2 = 'H';
var obciSDLogForHour4 = 'J';
var obciSDLogForHour12 = 'K';
var obciSDLogForHour24 = 'L';
var obciSDLogForMin5 = 'A';
var obciSDLogForMin15 = 'S';
var obciSDLogForMin30 = 'F';
var obciSDLogForSec14 = 'a';
var obciSDLogStop = 'j';
/** SD Card String Commands */

var obciStringSDHour1 = '1hour';
var obciStringSDHour2 = '2hour';
var obciStringSDHour4 = '4hour';
var obciStringSDHour12 = '12hour';
var obciStringSDHour24 = '24hour';
var obciStringSDMin5 = '5min';
var obciStringSDMin15 = '15min';
var obciStringSDMin30 = '30min';
var obciStringSDSec14 = '14sec';
/** Stream Data Commands */

var obciStreamStart = 'b';
var obciStreamStop = 's';
/** Miscellaneous */

var obciMiscQueryRegisterSettings = '?';
var obciMiscQueryRegisterSettingsChannel1 = 'CH1SET';
var obciMiscQueryRegisterSettingsChannel2 = 'CH2SET';
var obciMiscQueryRegisterSettingsChannel3 = 'CH3SET';
var obciMiscQueryRegisterSettingsChannel4 = 'CH4SET';
var obciMiscQueryRegisterSettingsChannel5 = 'CH5SET';
var obciMiscQueryRegisterSettingsChannel6 = 'CH6SET';
var obciMiscQueryRegisterSettingsChannel7 = 'CH7SET';
var obciMiscQueryRegisterSettingsChannel8 = 'CH8SET';
var obciMiscSoftReset = 'v';
/** 16 Channel Commands */

var obciChannelMaxNumber8 = 'c';
var obciChannelMaxNumber16 = 'C';
var obciChannelMaxNumber8NoDaisyToRemove = '';
var obciChannelMaxNumber8SuccessDaisyRemoved = 'daisy removed';
var obciChannelMaxNumber16DaisyAlreadyAttached = '16';
var obciChannelMaxNumber16DaisyAttached = 'daisy attached16';
var obciChannelMaxNumber16NoDaisyAttached = 'no daisy to attach!8';
/** 60Hz line filter */

var obciFilterDisable = 'g';
var obciFilterEnable = 'f';
/** Triggers */

var obciTrigger = '`';
/** Sync Clocks */

var obciSyncTimeSet = '<';
var obciSyncTimeSent = ',';
/** Set board mode */

var obciBoardModeSet = '/';
var obciBoardModeCmdDefault = '0';
var obciBoardModeCmdDebug = '1';
var obciBoardModeCmdAnalog = '2';
var obciBoardModeCmdDigital = '3';
var obciBoardModeCmdGetCur = '/';
var obciBoardModeAnalog = 'analog';
var obciBoardModeDefault = 'default';
var obciBoardModeDebug = 'debug';
var obciBoardModeDigital = 'digital';
/** Set sample rate */

var obciSampleRateSet = '~';
var obciSampleRateCmdCyton16000 = '0';
var obciSampleRateCmdCyton8000 = '1';
var obciSampleRateCmdCyton4000 = '2';
var obciSampleRateCmdCyton2000 = '3';
var obciSampleRateCmdCyton1000 = '4';
var obciSampleRateCmdCyton500 = '5';
var obciSampleRateCmdCyton250 = '6';
var obciSampleRateCmdGang25600 = '0';
var obciSampleRateCmdGang12800 = '1';
var obciSampleRateCmdGang6400 = '2';
var obciSampleRateCmdGang3200 = '3';
var obciSampleRateCmdGang1600 = '4';
var obciSampleRateCmdGang800 = '5';
var obciSampleRateCmdGang400 = '6';
var obciSampleRateCmdGang200 = '7';
var obciSampleRateCmdaGetCur = '~';
/** Accel enable/disable commands */

var obciAccelStart = 'n';
var obciAccelStop = 'N';
/** Wifi Stuff */

var obciWifiAttach = '{';
var obciWifiRemove = '}';
var obciWifiReset = ';';
var obciWifiStatus = ':';
/** Radio Key */

var obciRadioKey = 0xF0;
/** Radio Commands */

var obciRadioCmdChannelGet = 0x00;
var obciRadioCmdChannelSet = 0x01;
var obciRadioCmdChannelSetOverride = 0x02;
var obciRadioCmdPollTimeGet = 0x03;
var obciRadioCmdPollTimeSet = 0x04;
var obciRadioCmdBaudRateSetDefault = 0x05;
var obciRadioCmdBaudRateSetFast = 0x06;
var obciRadioCmdSystemStatus = 0x07;
/** Possible number of channels */

var obciNumberOfChannelsCyton = 8;
var obciNumberOfChannelsCytonBLE = 2;
var obciNumberOfChannelsDaisy = 16;
var obciNumberOfChannelsDefault = obciNumberOfChannelsCyton;
var obciNumberOfChannelsGanglion = 4;
/** Possible OpenBCI board types */

var obciBoardCyton = 'cyton';
var obciBoardCytonBLE = 'cytonBLE';
var obciBoardDaisy = 'daisy';
var obciBoardDefault = 'default';
var obciBoardGanglion = 'ganglion';
var obciBoardNone = 'none';
/** Possible Simulator Line Noise injections */

var obciSimulatorLineNoiseHz60 = '60Hz';
var obciSimulatorLineNoiseHz50 = '50Hz';
var obciSimulatorLineNoiseNone = 'none';
/** Possible Simulator Fragmentation modes */

var obciSimulatorFragmentationRandom = 'random';
var obciSimulatorFragmentationFullBuffers = 'fullBuffers';
var obciSimulatorFragmentationOneByOne = 'oneByOne';
var obciSimulatorFragmentationNone = 'none';
/** Possible Sample Rates */

var obciSampleRate1000 = 1000;
var obciSampleRate125 = 125;
var obciSampleRate12800 = 12800;
var obciSampleRate1600 = 1600;
var obciSampleRate16000 = 16000;
var obciSampleRate200 = 200;
var obciSampleRate2000 = 2000;
var obciSampleRate250 = 250;
var obciSampleRate25600 = 25600;
var obciSampleRate3200 = 3200;
var obciSampleRate400 = 400;
var obciSampleRate4000 = 4000;
var obciSampleRate500 = 500;
var obciSampleRate6400 = 6400;
var obciSampleRate800 = 800;
var obciSampleRate8000 = 8000;
/** Max sample number */

var obciSampleNumberMax = 255;
/** Packet Size */

var obciPacketSize = 33;
var obciPacketSizeBLECyton = 20;
var obciPacketSizeBLERaw = 12;
/** OpenBCI V3 Standard Packet Positions */

/**
* 0:[startByte] | 1:[sampleNumber] | 2:[Channel-1.1] | 3:[Channel-1.2] | 4:[Channel-1.3] | 5:[Channel-2.1] | 6:[Channel-2.2] | 7:[Channel-2.3] | 8:[Channel-3.1] | 9:[Channel-3.2] | 10:[Channel-3.3] | 11:[Channel-4.1] | 12:[Channel-4.2] | 13:[Channel-4.3] | 14:[Channel-5.1] | 15:[Channel-5.2] | 16:[Channel-5.3] | 17:[Channel-6.1] | 18:[Channel-6.2] | 19:[Channel-6.3] | 20:[Channel-7.1] | 21:[Channel-7.2] | 22:[Channel-7.3] | 23:[Channel-8.1] | 24:[Channel-8.2] | 25:[Channel-8.3] | 26:[Aux-1.1] | 27:[Aux-1.2] | 28:[Aux-2.1] | 29:[Aux-2.2] | 30:[Aux-3.1] | 31:[Aux-3.2] | 32:StopByte
*/

var obciPacketPositionChannelDataStart = 2; // 0:startByte | 1:sampleNumber | [2:4] | [5:7] | [8:10] | [11:13] | [14:16] | [17:19] | [21:23] | [24:26]

var obciPacketPositionChannelDataStop = 25; // 24 bytes for channel data

var obciPacketPositionSampleNumber = 1;
var obciPacketPositionStartByte = 0; // first byte

var obciPacketPositionStopByte = 32; // [32]

var obciPacketPositionStartAux = 26; // [26,27]:Aux 1 | [28,29]:Aux 2 | [30,31]:Aux 3

var obciPacketPositionStopAux = 31; // - - - [30,31]:Aux 3 | 32: Stop byte

var obciPacketPositionTimeSyncAuxStart = 26;
var obciPacketPositionTimeSyncAuxStop = 28;
var obciPacketPositionTimeSyncTimeStart = 28;
var obciPacketPositionTimeSyncTimeStop = 32;
/** Notable Bytes */

var obciByteStart = 0xA0;
var obciByteStop = 0xC0;
/** Errors */

var errorInvalidByteLength = 'Invalid Packet Byte Length';
var errorInvalidByteStart = 'Invalid Start Byte';
var errorInvalidByteStop = 'Invalid Stop Byte';
var errorInvalidData = 'Invalid data - try again';
var errorInvalidType = 'Invalid type - check comments for input type';
var errorMissingRegisterSetting = 'Missing register setting';
var errorMissingRequiredProperty = 'Missing property in JSON';
var errorNobleAlreadyScanning = 'Scan already under way';
var errorNobleNotAlreadyScanning = 'No scan started';
var errorNobleNotInPoweredOnState = 'Please turn blue tooth on.';
var errorTimeSyncIsNull = "'this.sync.curSyncObj' must not be null";
var errorTimeSyncNoComma = 'Missed the time sync sent confirmation. Try sync again';
var errorUndefinedOrNullInput = 'Undefined or Null Input';
/** Max Master Buffer Size */

var obciMasterBufferSize = 4096;
/** Impedance Calculation Variables */

var obciLeadOffDriveInAmps = 0.000000006;
var obciLeadOffFrequencyHz = 31.5;
/** Command send delay */

var obciWriteIntervalDelayMSLong = 50;
var obciWriteIntervalDelayMSNone = 0;
var obciWriteIntervalDelayMSShort = 10;
/** Impedance */

var obciImpedanceTextBad = 'bad';
var obciImpedanceTextNone = 'none';
var obciImpedanceTextGood = 'good';
var obciImpedanceTextInit = 'init';
var obciImpedanceTextOk = 'ok';
var obciImpedanceThresholdGoodMin = 0;
var obciImpedanceThresholdGoodMax = 5000;
var obciImpedanceThresholdOkMin = 5001;
var obciImpedanceThresholdOkMax = 10000;
var obciImpedanceThresholdBadMin = 10001;
var obciImpedanceThresholdBadMax = 1000000;
var obciImpedanceSeriesResistor = 2200; // There is a 2.2 k Ohm series resistor that must be subtracted

/** Simulator */

var obciSimulatorPortName = 'OpenBCISimulator';
/**
* Stream packet types/codes
*/

var obciStreamPacketStandardAccel = 0; // 0000

var obciStreamPacketStandardRawAux = 1; // 0001

var obciStreamPacketUserDefinedType = 2; // 0010

var obciStreamPacketAccelTimeSyncSet = 3; // 0011

var obciStreamPacketAccelTimeSynced = 4; // 0100

var obciStreamPacketRawAuxTimeSyncSet = 5; // 0101

var obciStreamPacketRawAuxTimeSynced = 6; // 0110

var obciStreamPacketImpedance = 7; // 0111

/** Time from board */

var obciStreamPacketTimeByteSize = 4;
/** Time synced with accel packet */

var obciAccelAxisX = 7;
var obciAccelAxisY = 8;
var obciAccelAxisZ = 9;
/** Firmware version indicator */

var obciFirmwareV1 = 'v1';
var obciFirmwareV2 = 'v2';
var obciFirmwareV3 = 'v3';
/** Parse */

var obciParseDaisy = 'Daisy';
var obciParseFirmware = 'v2';
var obciParseFailure = 'Failure';
var obciParseEOT = '$$$';
var obciParseSuccess = 'Success';
/** Used in parsing incoming serial data */

var obciParsingChannelSettings = 2;
var obciParsingEOT = 4;
var obciParsingNormal = 3;
var obciParsingReset = 0;
var obciParsingTimeSyncSent = 1;
/** Timeouts */

var obciTimeoutProcessBytes = 500; // 0.5 seconds

/** Simulator Board Configurations */

var obciSimulatorRawAux = 'rawAux';
var obciSimulatorStandard = 'standard';
/** OpenBCI Radio Limits */

var obciRadioChannelMax = 25;
var obciRadioChannelMin = 1;
var obciRadioPollTimeMax = 255;
var obciRadioPollTimeMin = 0;
/** Time sync stuff */

var obciTimeSyncArraySize = 10;
var obciTimeSyncMultiplierWithSyncConf = 0.9;
var obciTimeSyncMultiplierWithoutSyncConf = 0.75;
var obciTimeSyncThresholdTransFailureMS = 10; // ms

/** Baud Rates */

var obciRadioBaudRateDefault = 115200;
var obciRadioBaudRateDefaultStr = 'default';
var obciRadioBaudRateFast = 230400;
var obciRadioBaudRateFastStr = 'fast';
/** Emitters */

var obciEmitterAccelerometer = 'accelerometer';
var obciEmitterBlePoweredUp = 'blePoweredOn';
var obciEmitterClose = 'close';
var obciEmitterDroppedPacket = 'droppedPacket';
var obciEmitterEot = 'eot';
var obciEmitterError = 'error';
var obciEmitterGanglionFound = 'ganglionFound';
var obciEmitterHardSet = 'hardSet';
var obciEmitterImpedance = 'impedance';
var obciEmitterImpedanceArray = 'impedanceArray';
var obciEmitterMessage = 'message';
var obciEmitterQuery = 'query';
var obciEmitterRawDataPacket = 'rawDataPacket';
var obciEmitterReady = 'ready';
var obciEmitterRFduino = 'rfduino';
var obciEmitterSample = 'sample';
var obciEmitterScanStopped = 'scanStopped';
var obciEmitterSynced = 'synced';
var obciEmitterWifiShield = 'wifiShield';
/** Accel packets */

var obciGanglionAccelAxisX = 1;
var obciGanglionAccelAxisY = 2;
var obciGanglionAccelAxisZ = 3;
/** Accel scale factor */

var obciGanglionAccelScaleFactor = 0.016; // mG per count

/** Ganglion */

var obciGanglionBleSearchTime = 20000; // ms

var obciGanglionByteIdUncompressed = 0;
var obciGanglionByteId18Bit = {
  max: 100,
  min: 1
};
var obciGanglionByteId19Bit = {
  max: 200,
  min: 101
};
var obciGanglionByteIdImpedanceChannel1 = 201;
var obciGanglionByteIdImpedanceChannel2 = 202;
var obciGanglionByteIdImpedanceChannel3 = 203;
var obciGanglionByteIdImpedanceChannel4 = 204;
var obciGanglionByteIdImpedanceChannelReference = 205;
var obciGanglionByteIdMultiPacket = 206;
var obciGanglionByteIdMultiPacketStop = 207;
var obciGanglionPacketSize = 20;
var obciGanglionSamplesPerPacket = 2;
var obciGanglionPacket18Bit = {
  auxByte: 20,
  byteId: 0,
  dataStart: 1,
  dataStop: 19
};
var obciGanglionPacket19Bit = {
  byteId: 0,
  dataStart: 1,
  dataStop: 20
};
var obciGanglionMCP3912Gain = 51.0; // assumed gain setting for MCP3912.  NEEDS TO BE ADJUSTABLE JM

var obciGanglionMCP3912Vref = 1.2; // reference voltage for ADC in MCP3912 set in hardware

var obciGanglionPrefix = 'Ganglion';
var obciGanglionSyntheticDataEnable = 't';
var obciGanglionSyntheticDataDisable = 'T';
var obciGanglionImpedanceStart = 'z';
var obciGanglionImpedanceStop = 'Z';
var obciGanglionScaleFactorPerCountVolts = obciGanglionMCP3912Vref / (8388607.0 * obciGanglionMCP3912Gain * 1.5);
/** Simblee */

var simbleeUuidService = 'fe84';
var simbleeUuidReceive = '2d30c082f39f4ce6923f3484ea480596';
var simbleeUuidSend = '2d30c083f39f4ce6923f3484ea480596';
var simbleeUuidDisconnect = '2d30c084f39f4ce6923f3484ea480596';
/** RFduino BLE UUID */

var rfduinoUuidService = '2220';
var rfduinoUuidReceive = '2221';
var rfduinoUuidSend = '2222';
var rfduinoUuidSendTwo = '2223';
/** Cyton BLE */

var obciCytonBLESamplesPerPacket = 3;
/** Noble */

var obciNobleEmitterPeripheralConnect = 'connect';
var obciNobleEmitterPeripheralDisconnect = 'disconnect';
var obciNobleEmitterPeripheralDiscover = 'discover';
var obciNobleEmitterPeripheralServicesDiscover = 'servicesDiscover';
var obciNobleEmitterServiceCharacteristicsDiscover = 'characteristicsDiscover';
var obciNobleEmitterServiceRead = 'read';
var obciNobleEmitterDiscover = 'discover';
var obciNobleEmitterScanStart = 'scanStart';
var obciNobleEmitterScanStop = 'scanStop';
var obciNobleEmitterStateChange = 'stateChange';
var obciNobleStatePoweredOn = 'poweredOn';
/** Protocols */

var obciProtocolBLE = 'ble';
var obciProtocolSerial = 'serial';
var obciProtocolWifi = 'wifi';
/** Register Query on Cyton */

var obciRegisterQueryAccelerometerFirmwareV1 = '\nLIS3DH Registers\n0x07.0\n0x08.0\n0x09.0\n0x0A.0\n0x0B.0\n0x0C.0\n0x0D.0\n0x0E.0\n0x0F.33\n\n0x1F.0\n0x20.8\n0x21.0\n0x22.0\n0x23.18\n0x24.0\n0x25.0\n0x26.0\n0x27.0\n0x28.0\n0x29.0\n0x2A.0\n0x2B.0\n0x2C.0\n0x2D.0\n0x2E.0\n0x2F.20\n0x30.0\n0x31.0\n0x32.0\n0x33.0\n\n0x38.0\n0x39.0\n0x3A.0\n0x3B.0\n0x3C.0\n0x3D.0\n';
var obciRegisterQueryAccelerometerFirmwareV3 = '\nLIS3DH Registers\n0x07 00\n0x08 00\n0x09 00\n0x0A 00\n0x0B 00\n0x0C 00\n0x0D 00\n0x0E 00\n0x0F 33\n\n0x1F 00\n0x20 08\n0x21 00\n0x22 00\n0x23 18\n0x24 00\n0x25 00\n0x26 00\n0x27 00\n0x28 00\n0x29 00\n0x2A 00\n0x2B 00\n0x2C 00\n0x2D 00\n0x2E 00\n0x2F 20\n0x30 00\n0x31 00\n0x32 00\n0x33 00\n\n0x38 00\n0x39 00\n0x3A 00\n0x3B 00\n0x3C 00\n0x3D 00\n';
var obciRegisterQueryCyton = '\nBoard ADS Registers\nADS_ID, 00, 3E, 0, 0, 1, 1, 1, 1, 1, 0\nCONFIG1, 01, 96, 1, 0, 0, 1, 0, 1, 1, 0\nCONFIG2, 02, C0, 1, 1, 0, 0, 0, 0, 0, 0\nCONFIG3, 03, EC, 1, 1, 1, 0, 1, 1, 0, 0\nLOFF, 04, 02, 0, 0, 0, 0, 0, 0, 1, 0\nCH1SET, 05, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH2SET, 06, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH3SET, 07, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH4SET, 08, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH5SET, 09, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH6SET, 0A, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH7SET, 0B, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH8SET, 0C, 68, 0, 1, 1, 0, 1, 0, 0, 0\nBIAS_SENSP, 0D, FF, 1, 1, 1, 1, 1, 1, 1, 1\nBIAS_SENSN, 0E, FF, 1, 1, 1, 1, 1, 1, 1, 1\nLOFF_SENSP, 0F, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_SENSN, 10, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_FLIP, 11, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_STATP, 12, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_STATN, 13, 00, 0, 0, 0, 0, 0, 0, 0, 0\nGPIO, 14, 0F, 0, 0, 0, 0, 1, 1, 1, 1\nMISC1, 15, 00, 0, 0, 0, 0, 0, 0, 0, 0\nMISC2, 16, 00, 0, 0, 0, 0, 0, 0, 0, 0\nCONFIG4, 17, 00, 0, 0, 0, 0, 0, 0, 0, 0\n';
var obciRegisterQueryCytonDaisy = '\nDaisy ADS Registers\nADS_ID, 00, 3E, 0, 0, 1, 1, 1, 1, 1, 0\nCONFIG1, 01, 96, 1, 0, 0, 1, 0, 1, 1, 0\nCONFIG2, 02, C0, 1, 1, 0, 0, 0, 0, 0, 0\nCONFIG3, 03, EC, 1, 1, 1, 0, 1, 1, 0, 0\nLOFF, 04, 02, 0, 0, 0, 0, 0, 0, 1, 0\nCH1SET, 05, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH2SET, 06, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH3SET, 07, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH4SET, 08, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH5SET, 09, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH6SET, 0A, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH7SET, 0B, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH8SET, 0C, 68, 0, 1, 1, 0, 1, 0, 0, 0\nBIAS_SENSP, 0D, FF, 1, 1, 1, 1, 1, 1, 1, 1\nBIAS_SENSN, 0E, FF, 1, 1, 1, 1, 1, 1, 1, 1\nLOFF_SENSP, 0F, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_SENSN, 10, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_FLIP, 11, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_STATP, 12, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_STATN, 13, 00, 0, 0, 0, 0, 0, 0, 0, 0\nGPIO, 14, 0F, 0, 0, 0, 0, 1, 1, 1, 1\nMISC1, 15, 00, 0, 0, 0, 0, 0, 0, 0, 0\nMISC2, 16, 00, 0, 0, 0, 0, 0, 0, 0, 0\nCONFIG4, 17, 00, 0, 0, 0, 0, 0, 0, 0, 0\n';
var obciRegisterQueryNameMISC1 = 'MISC1';
var obciRegisterQueryNameBIASSENSP = 'BIAS_SENSP';
var obciRegisterQueryNameCHnSET = ['CH1SET', 'CH2SET', 'CH3SET', 'CH4SET', 'CH5SET', 'CH6SET', 'CH7SET', 'CH8SET'];
var obciRegisterQuerySizeCytonFirmwareV1 = obciRegisterQueryCyton.length + obciRegisterQueryAccelerometerFirmwareV1.length;
var obciRegisterQuerySizeCytonDaisyFirmwareV1 = obciRegisterQueryCyton.length + obciRegisterQueryCytonDaisy.length + obciRegisterQueryAccelerometerFirmwareV1.length;
var obciRegisterQuerySizeCytonFirmwareV3 = obciRegisterQueryCyton.length + obciRegisterQueryAccelerometerFirmwareV3.length;
var obciRegisterQuerySizeCytonDaisyFirmwareV3 = obciRegisterQueryCyton.length + obciRegisterQueryCytonDaisy.length + obciRegisterQueryAccelerometerFirmwareV3.length;
var constantsModule = {
  /** Turning channels off */
  OBCIChannelOff1: obciChannelOff1,
  OBCIChannelOff2: obciChannelOff2,
  OBCIChannelOff3: obciChannelOff3,
  OBCIChannelOff4: obciChannelOff4,
  OBCIChannelOff5: obciChannelOff5,
  OBCIChannelOff6: obciChannelOff6,
  OBCIChannelOff7: obciChannelOff7,
  OBCIChannelOff8: obciChannelOff8,
  OBCIChannelOff9: obciChannelOff9,
  OBCIChannelOff10: obciChannelOff10,
  OBCIChannelOff11: obciChannelOff11,
  OBCIChannelOff12: obciChannelOff12,
  OBCIChannelOff13: obciChannelOff13,
  OBCIChannelOff14: obciChannelOff14,
  OBCIChannelOff15: obciChannelOff15,
  OBCIChannelOff16: obciChannelOff16,

  /**
  * Purpose: To get the proper command to turn a channel off
  * @param channelNumber - A number (1-16) of the desired channel
  * @returns {Promise}
  */
  commandChannelOff: function commandChannelOff(channelNumber) {
    return new Promise(function (resolve, reject) {
      switch (channelNumber) {
        case 1:
          resolve(obciChannelOff1);
          break;

        case 2:
          resolve(obciChannelOff2);
          break;

        case 3:
          resolve(obciChannelOff3);
          break;

        case 4:
          resolve(obciChannelOff4);
          break;

        case 5:
          resolve(obciChannelOff5);
          break;

        case 6:
          resolve(obciChannelOff6);
          break;

        case 7:
          resolve(obciChannelOff7);
          break;

        case 8:
          resolve(obciChannelOff8);
          break;

        case 9:
          resolve(obciChannelOff9);
          break;

        case 10:
          resolve(obciChannelOff10);
          break;

        case 11:
          resolve(obciChannelOff11);
          break;

        case 12:
          resolve(obciChannelOff12);
          break;

        case 13:
          resolve(obciChannelOff13);
          break;

        case 14:
          resolve(obciChannelOff14);
          break;

        case 15:
          resolve(obciChannelOff15);
          break;

        case 16:
          resolve(obciChannelOff16);
          break;

        default:
          reject(Error('Error [commandChannelOff]: Invalid Channel Number'));
          break;
      }
    });
  },

  /** Turning channels on */
  OBCIChannelOn1: obciChannelOn1,
  OBCIChannelOn2: obciChannelOn2,
  OBCIChannelOn3: obciChannelOn3,
  OBCIChannelOn4: obciChannelOn4,
  OBCIChannelOn5: obciChannelOn5,
  OBCIChannelOn6: obciChannelOn6,
  OBCIChannelOn7: obciChannelOn7,
  OBCIChannelOn8: obciChannelOn8,
  OBCIChannelOn9: obciChannelOn9,
  OBCIChannelOn10: obciChannelOn10,
  OBCIChannelOn11: obciChannelOn11,
  OBCIChannelOn12: obciChannelOn12,
  OBCIChannelOn13: obciChannelOn13,
  OBCIChannelOn14: obciChannelOn14,
  OBCIChannelOn15: obciChannelOn15,
  OBCIChannelOn16: obciChannelOn16,
  commandChannelOn: function commandChannelOn(channelNumber) {
    return new Promise(function (resolve, reject) {
      switch (channelNumber) {
        case 1:
          resolve(obciChannelOn1);
          break;

        case 2:
          resolve(obciChannelOn2);
          break;

        case 3:
          resolve(obciChannelOn3);
          break;

        case 4:
          resolve(obciChannelOn4);
          break;

        case 5:
          resolve(obciChannelOn5);
          break;

        case 6:
          resolve(obciChannelOn6);
          break;

        case 7:
          resolve(obciChannelOn7);
          break;

        case 8:
          resolve(obciChannelOn8);
          break;

        case 9:
          resolve(obciChannelOn9);
          break;

        case 10:
          resolve(obciChannelOn10);
          break;

        case 11:
          resolve(obciChannelOn11);
          break;

        case 12:
          resolve(obciChannelOn12);
          break;

        case 13:
          resolve(obciChannelOn13);
          break;

        case 14:
          resolve(obciChannelOn14);
          break;

        case 15:
          resolve(obciChannelOn15);
          break;

        case 16:
          resolve(obciChannelOn16);
          break;

        default:
          reject(Error('Error [commandChannelOn]: Invalid Channel Number'));
          break;
      }
    });
  },

  /** Test Signal Control Commands */
  OBCITestSignalConnectToDC: obciTestSignalConnectToDC,
  OBCITestSignalConnectToGround: obciTestSignalConnectToGround,
  OBCITestSignalConnectToPulse1xFast: obciTestSignalConnectToPulse1xFast,
  OBCITestSignalConnectToPulse1xSlow: obciTestSignalConnectToPulse1xSlow,
  OBCITestSignalConnectToPulse2xFast: obciTestSignalConnectToPulse2xFast,
  OBCITestSignalConnectToPulse2xSlow: obciTestSignalConnectToPulse2xSlow,
  getTestSignalCommand: function getTestSignalCommand(signal) {
    return new Promise(function (resolve, reject) {
      switch (signal) {
        case 'dc':
          resolve(obciTestSignalConnectToDC);
          break;

        case 'ground':
          resolve(obciTestSignalConnectToGround);
          break;

        case 'pulse1xFast':
          resolve(obciTestSignalConnectToPulse1xFast);
          break;

        case 'pulse1xSlow':
          resolve(obciTestSignalConnectToPulse1xSlow);
          break;

        case 'pulse2xFast':
          resolve(obciTestSignalConnectToPulse2xFast);
          break;

        case 'pulse2xSlow':
          resolve(obciTestSignalConnectToPulse2xSlow);
          break;

        case 'none':
          resolve(obciChannelDefaultAllSet);
          break;

        default:
          reject(Error('Invalid selection! Check your spelling.'));
          break;
      }
    });
  },

  /** Channel Setting Commands */
  OBCIChannelCmdADCNormal: obciChannelCmdADCNormal,
  OBCIChannelCmdADCShorted: obciChannelCmdADCShorted,
  OBCIChannelCmdADCBiasDRP: obciChannelCmdADCBiasDRP,
  OBCIChannelCmdADCBiasDRN: obciChannelCmdADCBiasDRN,
  OBCIChannelCmdADCBiasMethod: obciChannelCmdADCBiasMethod,
  OBCIChannelCmdADCMVDD: obciChannelCmdADCMVDD,
  OBCIChannelCmdADCTemp: obciChannelCmdADCTemp,
  OBCIChannelCmdADCTestSig: obciChannelCmdADCTestSig,
  OBCIChannelCmdBiasInclude: obciChannelCmdBiasInclude,
  OBCIChannelCmdBiasRemove: obciChannelCmdBiasRemove,
  OBCIChannelCmdChannel1: obciChannelCmdChannel1,
  OBCIChannelCmdChannel2: obciChannelCmdChannel2,
  OBCIChannelCmdChannel3: obciChannelCmdChannel3,
  OBCIChannelCmdChannel4: obciChannelCmdChannel4,
  OBCIChannelCmdChannel5: obciChannelCmdChannel5,
  OBCIChannelCmdChannel6: obciChannelCmdChannel6,
  OBCIChannelCmdChannel7: obciChannelCmdChannel7,
  OBCIChannelCmdChannel8: obciChannelCmdChannel8,
  OBCIChannelCmdChannel9: obciChannelCmdChannel9,
  OBCIChannelCmdChannel10: obciChannelCmdChannel10,
  OBCIChannelCmdChannel11: obciChannelCmdChannel11,
  OBCIChannelCmdChannel12: obciChannelCmdChannel12,
  OBCIChannelCmdChannel13: obciChannelCmdChannel13,
  OBCIChannelCmdChannel14: obciChannelCmdChannel14,
  OBCIChannelCmdChannel15: obciChannelCmdChannel15,
  OBCIChannelCmdChannel16: obciChannelCmdChannel16,
  commandChannelForCmd: commandChannelForCmd,
  OBCIChannelCmdGain1: obciChannelCmdGain1,
  OBCIChannelCmdGain2: obciChannelCmdGain2,
  OBCIChannelCmdGain4: obciChannelCmdGain4,
  OBCIChannelCmdGain6: obciChannelCmdGain6,
  OBCIChannelCmdGain8: obciChannelCmdGain8,
  OBCIChannelCmdGain12: obciChannelCmdGain12,
  OBCIChannelCmdGain24: obciChannelCmdGain24,
  commandForGain: commandForGain,
  gainForCommand: gainForCommand,
  OBCIChannelCmdLatch: obciChannelCmdLatch,
  OBCIChannelCmdPowerOff: obciChannelCmdPowerOff,
  OBCIChannelCmdPowerOn: obciChannelCmdPowerOn,
  OBCIChannelCmdSet: obciChannelCmdSet,
  OBCIChannelCmdSRB1Connect: obciChannelCmdSRB1Connect,
  OBCIChannelCmdSRB1Diconnect: obciChannelCmdSRB1Diconnect,
  OBCIChannelCmdSRB2Connect: obciChannelCmdSRB2Connect,
  OBCIChannelCmdSRB2Diconnect: obciChannelCmdSRB2Diconnect,

  /** Channel Settings Object */
  channelSettingsObjectDefault: channelSettingsObjectDefault,

  /**
   * @param numberOfChannels {Number}
   * @returns {Array}
   */
  channelSettingsArrayInit: function channelSettingsArrayInit(numberOfChannels) {
    var newChannelSettingsArray = [];

    for (var i = 0; i < numberOfChannels; i++) {
      newChannelSettingsArray.push(channelSettingsObjectDefault(i));
    }

    return newChannelSettingsArray;
  },

  /** Channel Setting Helper Strings */
  OBCIStringADCNormal: obciStringADCNormal,
  OBCIStringADCShorted: obciStringADCShorted,
  OBCIStringADCBiasMethod: obciStringADCBiasMethod,
  OBCIStringADCMvdd: obciStringADCMvdd,
  OBCIStringADCTemp: obciStringADCTemp,
  OBCIStringADCTestSig: obciStringADCTestSig,
  OBCIStringADCBiasDrp: obciStringADCBiasDrp,
  OBCIStringADCBiasDrn: obciStringADCBiasDrn,

  /**
  * @description To convert a string like 'normal' to the correct command (i.e. '1')
  * @param adcString
  * @returns {Promise}
  * @author AJ Keller (@pushtheworldllc)
  */
  commandForADCString: commandForADCString,
  inputTypeForCommand: inputTypeForCommand,

  /** Default Channel Settings */
  OBCIChannelDefaultAllSet: obciChannelDefaultAllSet,
  OBCIChannelDefaultAllGet: obciChannelDefaultAllGet,

  /** LeadOff Impedance Commands */
  OBCIChannelImpedanceLatch: obciChannelImpedanceLatch,
  OBCIChannelImpedanceSet: obciChannelImpedanceSet,
  OBCIChannelImpedanceTestSignalApplied: obciChannelImpedanceTestSignalApplied,
  OBCIChannelImpedanceTestSignalAppliedNot: obciChannelImpedanceTestSignalAppliedNot,

  /** SD card Commands */
  OBCISDLogForHour1: obciSDLogForHour1,
  OBCISDLogForHour2: obciSDLogForHour2,
  OBCISDLogForHour4: obciSDLogForHour4,
  OBCISDLogForHour12: obciSDLogForHour12,
  OBCISDLogForHour24: obciSDLogForHour24,
  OBCISDLogForMin5: obciSDLogForMin5,
  OBCISDLogForMin15: obciSDLogForMin15,
  OBCISDLogForMin30: obciSDLogForMin30,
  OBCISDLogForSec14: obciSDLogForSec14,
  OBCISDLogStop: obciSDLogStop,

  /** SD Card String Commands */
  OBCIStringSDHour1: obciStringSDHour1,
  OBCIStringSDHour2: obciStringSDHour2,
  OBCIStringSDHour4: obciStringSDHour4,
  OBCIStringSDHour12: obciStringSDHour12,
  OBCIStringSDHour24: obciStringSDHour24,
  OBCIStringSDMin5: obciStringSDMin5,
  OBCIStringSDMin15: obciStringSDMin15,
  OBCIStringSDMin30: obciStringSDMin30,
  OBCIStringSDSec14: obciStringSDSec14,

  /**
  * @description Converts a sd string into the proper setting.
  * @param stringCommand {String} - The length of time you want to record to the SD for.
  * @returns {Promise} The command to send to the Board, returns an error on improper `stringCommand`
  */
  sdSettingForString: function sdSettingForString(stringCommand) {
    return new Promise(function (resolve, reject) {
      switch (stringCommand) {
        case obciStringSDHour1:
          resolve(obciSDLogForHour1);
          break;

        case obciStringSDHour2:
          resolve(obciSDLogForHour2);
          break;

        case obciStringSDHour4:
          resolve(obciSDLogForHour4);
          break;

        case obciStringSDHour12:
          resolve(obciSDLogForHour12);
          break;

        case obciStringSDHour24:
          resolve(obciSDLogForHour24);
          break;

        case obciStringSDMin5:
          resolve(obciSDLogForMin5);
          break;

        case obciStringSDMin15:
          resolve(obciSDLogForMin15);
          break;

        case obciStringSDMin30:
          resolve(obciSDLogForMin30);
          break;

        case obciStringSDSec14:
          resolve(obciSDLogForSec14);
          break;

        default:
          reject(Error(TypeError));
          break;
      }
    });
  },

  /** Stream Data Commands */
  OBCIStreamStart: obciStreamStart,
  OBCIStreamStop: obciStreamStop,

  /** Accel enable/disable commands */
  OBCIAccelStart: obciAccelStart,
  OBCIAccelStop: obciAccelStop,

  /** Miscellaneous */
  OBCIMiscQueryRegisterSettings: obciMiscQueryRegisterSettings,
  OBCIMiscQueryRegisterSettingsChannel1: obciMiscQueryRegisterSettingsChannel1,
  OBCIMiscQueryRegisterSettingsChannel2: obciMiscQueryRegisterSettingsChannel2,
  OBCIMiscQueryRegisterSettingsChannel3: obciMiscQueryRegisterSettingsChannel3,
  OBCIMiscQueryRegisterSettingsChannel4: obciMiscQueryRegisterSettingsChannel4,
  OBCIMiscQueryRegisterSettingsChannel5: obciMiscQueryRegisterSettingsChannel5,
  OBCIMiscQueryRegisterSettingsChannel6: obciMiscQueryRegisterSettingsChannel6,
  OBCIMiscQueryRegisterSettingsChannel7: obciMiscQueryRegisterSettingsChannel7,
  OBCIMiscQueryRegisterSettingsChannel8: obciMiscQueryRegisterSettingsChannel8,
  channelSettingsKeyForChannel: function channelSettingsKeyForChannel(channelNumber) {
    return new Promise(function (resolve, reject) {
      switch (channelNumber) {
        case 1:
          resolve(new Buffer(obciMiscQueryRegisterSettingsChannel1));
          break;

        case 2:
          resolve(new Buffer(obciMiscQueryRegisterSettingsChannel2));
          break;

        case 3:
          resolve(new Buffer(obciMiscQueryRegisterSettingsChannel3));
          break;

        case 4:
          resolve(new Buffer(obciMiscQueryRegisterSettingsChannel4));
          break;

        case 5:
          resolve(new Buffer(obciMiscQueryRegisterSettingsChannel5));
          break;

        case 6:
          resolve(new Buffer(obciMiscQueryRegisterSettingsChannel6));
          break;

        case 7:
          resolve(new Buffer(obciMiscQueryRegisterSettingsChannel7));
          break;

        case 8:
          resolve(new Buffer(obciMiscQueryRegisterSettingsChannel8));
          break;

        default:
          reject(Error('Invalid channel number'));
          break;
      }
    });
  },
  OBCIMiscSoftReset: obciMiscSoftReset,

  /** 16 Channel Commands */
  OBCIChannelMaxNumber8: obciChannelMaxNumber8,
  OBCIChannelMaxNumber16: obciChannelMaxNumber16,
  OBCIChannelMaxNumber8NoDaisyToRemove: obciChannelMaxNumber8NoDaisyToRemove,
  OBCIChannelMaxNumber8SuccessDaisyRemoved: obciChannelMaxNumber8SuccessDaisyRemoved,
  OBCIChannelMaxNumber16DaisyAlreadyAttached: obciChannelMaxNumber16DaisyAlreadyAttached,
  OBCIChannelMaxNumber16DaisyAttached: obciChannelMaxNumber16DaisyAttached,
  OBCIChannelMaxNumber16NoDaisyAttached: obciChannelMaxNumber16NoDaisyAttached,

  /** Filters */
  OBCIFilterDisable: obciFilterDisable,
  OBCIFilterEnable: obciFilterEnable,

  /** Triggers */
  OBCITrigger: obciTrigger,

  /** Possible number of channels */
  OBCINumberOfChannelsCyton: obciNumberOfChannelsCyton,
  OBCINumberOfChannelsCytonBLE: obciNumberOfChannelsCytonBLE,
  OBCINumberOfChannelsDaisy: obciNumberOfChannelsDaisy,
  OBCINumberOfChannelsDefault: obciNumberOfChannelsDefault,
  OBCINumberOfChannelsGanglion: obciNumberOfChannelsGanglion,

  /** Possible OpenBCI board types */
  OBCIBoardCyton: obciBoardCyton,
  OBCIBoardCytonBLE: obciBoardCytonBLE,
  OBCIBoardDaisy: obciBoardDaisy,
  OBCIBoardDefault: obciBoardDefault,
  OBCIBoardGanglion: obciBoardGanglion,
  OBCIBoardNone: obciBoardNone,
  numberOfChannelsForBoardType: function numberOfChannelsForBoardType(boardType) {
    switch (boardType) {
      case obciBoardDaisy:
        return obciNumberOfChannelsDaisy;

      case obciBoardGanglion:
        return obciNumberOfChannelsGanglion;

      case obciBoardNone:
        return 0;

      case obciBoardCytonBLE:
        return obciNumberOfChannelsCytonBLE;

      case obciBoardCyton:
      default:
        return obciNumberOfChannelsDefault;
    }
  },
  boardTypeForNumberOfChannels: function boardTypeForNumberOfChannels(numberOfChannels) {
    switch (numberOfChannels) {
      case obciNumberOfChannelsDaisy:
        return obciBoardDaisy;

      case obciNumberOfChannelsGanglion:
        return obciBoardGanglion;

      case 0:
        return obciBoardNone;

      case obciNumberOfChannelsCytonBLE:
        return obciBoardCytonBLE;

      case obciNumberOfChannelsDefault:
      default:
        return obciBoardCyton;
    }
  },

  /** Possible Sample Rates */
  OBCISampleRate1000: obciSampleRate1000,
  OBCISampleRate125: obciSampleRate125,
  OBCISampleRate12800: obciSampleRate12800,
  OBCISampleRate1600: obciSampleRate1600,
  OBCISampleRate16000: obciSampleRate16000,
  OBCISampleRate200: obciSampleRate200,
  OBCISampleRate2000: obciSampleRate2000,
  OBCISampleRate250: obciSampleRate250,
  OBCISampleRate25600: obciSampleRate25600,
  OBCISampleRate3200: obciSampleRate3200,
  OBCISampleRate400: obciSampleRate400,
  OBCISampleRate4000: obciSampleRate4000,
  OBCISampleRate500: obciSampleRate500,
  OBCISampleRate6400: obciSampleRate6400,
  OBCISampleRate800: obciSampleRate800,
  OBCISampleRate8000: obciSampleRate8000,

  /** Max sample number */
  OBCISampleNumberMax: obciSampleNumberMax,

  /** Packet Size */
  OBCIPacketSize: obciPacketSize,
  OBCIPacketSizeBLECyton: obciPacketSizeBLECyton,
  OBCIPacketSizeBLERaw: obciPacketSizeBLERaw,

  /** Notable Bytes */
  OBCIByteStart: obciByteStart,
  OBCIByteStop: obciByteStop,

  /** Errors */
  OBCIErrorInvalidByteLength: errorInvalidByteLength,
  OBCIErrorInvalidByteStart: errorInvalidByteStart,
  OBCIErrorInvalidByteStop: errorInvalidByteStop,
  OBCIErrorInvalidData: errorInvalidData,
  OBCIErrorInvalidType: errorInvalidType,
  OBCIErrorMissingRegisterSetting: errorMissingRegisterSetting,
  OBCIErrorMissingRequiredProperty: errorMissingRequiredProperty,
  OBCIErrorNobleAlreadyScanning: errorNobleAlreadyScanning,
  OBCIErrorNobleNotAlreadyScanning: errorNobleNotAlreadyScanning,
  OBCIErrorNobleNotInPoweredOnState: errorNobleNotInPoweredOnState,
  OBCIErrorTimeSyncIsNull: errorTimeSyncIsNull,
  OBCIErrorTimeSyncNoComma: errorTimeSyncNoComma,
  OBCIErrorUndefinedOrNullInput: errorUndefinedOrNullInput,

  /** Max Master Buffer Size */
  OBCIMasterBufferSize: obciMasterBufferSize,

  /** Impedance Calculation Variables */
  OBCILeadOffDriveInAmps: obciLeadOffDriveInAmps,
  OBCILeadOffFrequencyHz: obciLeadOffFrequencyHz,

  /** Channel Setter Maker */
  getChannelSetter: channelSetter,

  /** Impedance Setter Maker */
  getImpedanceSetter: impedanceSetter,

  /** Sample Rate Setter Maker */
  getSampleRateSetter: sampleRateSetter,

  /** Board Mode Setter Maker */
  getBoardModeSetter: boardModeSetter,

  /** Command send delay */
  OBCIWriteIntervalDelayMSLong: obciWriteIntervalDelayMSLong,
  OBCIWriteIntervalDelayMSNone: obciWriteIntervalDelayMSNone,
  OBCIWriteIntervalDelayMSShort: obciWriteIntervalDelayMSShort,

  /** Sync Clocks */
  OBCISyncTimeSent: obciSyncTimeSent,
  OBCISyncTimeSet: obciSyncTimeSet,

  /** Radio Key */
  OBCIRadioKey: obciRadioKey,

  /** Radio Commands */
  OBCIRadioCmdChannelGet: obciRadioCmdChannelGet,
  OBCIRadioCmdChannelSet: obciRadioCmdChannelSet,
  OBCIRadioCmdChannelSetOverride: obciRadioCmdChannelSetOverride,
  OBCIRadioCmdPollTimeGet: obciRadioCmdPollTimeGet,
  OBCIRadioCmdPollTimeSet: obciRadioCmdPollTimeSet,
  OBCIRadioCmdBaudRateSetDefault: obciRadioCmdBaudRateSetDefault,
  OBCIRadioCmdBaudRateSetFast: obciRadioCmdBaudRateSetFast,
  OBCIRadioCmdSystemStatus: obciRadioCmdSystemStatus,

  /** Impedance */
  OBCIImpedanceTextBad: obciImpedanceTextBad,
  OBCIImpedanceTextGood: obciImpedanceTextGood,
  OBCIImpedanceTextInit: obciImpedanceTextInit,
  OBCIImpedanceTextOk: obciImpedanceTextOk,
  OBCIImpedanceTextNone: obciImpedanceTextNone,
  OBCIImpedanceThresholdBadMax: obciImpedanceThresholdBadMax,
  OBCIImpedanceSeriesResistor: obciImpedanceSeriesResistor,
  getTextForRawImpedance: function getTextForRawImpedance(value) {
    if (value > obciImpedanceThresholdGoodMin && value < obciImpedanceThresholdGoodMax) {
      return obciImpedanceTextGood;
    } else if (value > obciImpedanceThresholdOkMin && value < obciImpedanceThresholdOkMax) {
      return obciImpedanceTextOk;
    } else if (value > obciImpedanceThresholdBadMin && value < obciImpedanceThresholdBadMax) {
      return obciImpedanceTextBad;
    } else {
      return obciImpedanceTextNone;
    }
  },

  /** Simulator */
  OBCISimulatorPortName: obciSimulatorPortName,

  /**
  * Stream packet types/codes
  */
  OBCIStreamPacketStandardAccel: obciStreamPacketStandardAccel,
  OBCIStreamPacketStandardRawAux: obciStreamPacketStandardRawAux,
  OBCIStreamPacketUserDefinedType: obciStreamPacketUserDefinedType,
  OBCIStreamPacketAccelTimeSyncSet: obciStreamPacketAccelTimeSyncSet,
  OBCIStreamPacketAccelTimeSynced: obciStreamPacketAccelTimeSynced,
  OBCIStreamPacketRawAuxTimeSyncSet: obciStreamPacketRawAuxTimeSyncSet,
  OBCIStreamPacketRawAuxTimeSynced: obciStreamPacketRawAuxTimeSynced,
  OBCIStreamPacketImpedance: obciStreamPacketImpedance,

  /** fun funcs */
  isNumber: isNumber,
  isBoolean: isBoolean,
  isString: isString,
  isUndefined: isUndefined,
  isNull: isNull,

  /** OpenBCI V3 Standard Packet Positions */
  OBCIPacketPositionStartByte: obciPacketPositionStartByte,
  OBCIPacketPositionStopByte: obciPacketPositionStopByte,
  OBCIPacketPositionStartAux: obciPacketPositionStartAux,
  OBCIPacketPositionStopAux: obciPacketPositionStopAux,
  OBCIPacketPositionChannelDataStart: obciPacketPositionChannelDataStart,
  OBCIPacketPositionChannelDataStop: obciPacketPositionChannelDataStop,
  OBCIPacketPositionSampleNumber: obciPacketPositionSampleNumber,
  OBCIPacketPositionTimeSyncAuxStart: obciPacketPositionTimeSyncAuxStart,
  OBCIPacketPositionTimeSyncAuxStop: obciPacketPositionTimeSyncAuxStop,
  OBCIPacketPositionTimeSyncTimeStart: obciPacketPositionTimeSyncTimeStart,
  OBCIPacketPositionTimeSyncTimeStop: obciPacketPositionTimeSyncTimeStop,

  /** Possible Simulator Line Noise injections */
  OBCISimulatorLineNoiseHz60: obciSimulatorLineNoiseHz60,
  OBCISimulatorLineNoiseHz50: obciSimulatorLineNoiseHz50,
  OBCISimulatorLineNoiseNone: obciSimulatorLineNoiseNone,

  /** Possible Simulator Fragmentation modes */
  OBCISimulatorFragmentationRandom: obciSimulatorFragmentationRandom,
  OBCISimulatorFragmentationFullBuffers: obciSimulatorFragmentationFullBuffers,
  OBCISimulatorFragmentationOneByOne: obciSimulatorFragmentationOneByOne,
  OBCISimulatorFragmentationNone: obciSimulatorFragmentationNone,

  /** Firmware version indicator */
  OBCIFirmwareV1: obciFirmwareV1,
  OBCIFirmwareV2: obciFirmwareV2,
  OBCIFirmwareV3: obciFirmwareV3,

  /** Time synced accel packet */
  OBCIAccelAxisX: obciAccelAxisX,
  OBCIAccelAxisY: obciAccelAxisY,
  OBCIAccelAxisZ: obciAccelAxisZ,

  /** Time from board */
  OBCIStreamPacketTimeByteSize: obciStreamPacketTimeByteSize,

  /** Parse */
  OBCIParseDaisy: obciParseDaisy,
  OBCIParseFailure: obciParseFailure,
  OBCIParseFirmware: obciParseFirmware,
  OBCIParseEOT: obciParseEOT,
  OBCIParseSuccess: obciParseSuccess,

  /** Used in parsing incoming serial data */
  OBCIParsingChannelSettings: obciParsingChannelSettings,
  OBCIParsingEOT: obciParsingEOT,
  OBCIParsingNormal: obciParsingNormal,
  OBCIParsingReset: obciParsingReset,
  OBCIParsingTimeSyncSent: obciParsingTimeSyncSent,

  /** Timeouts */
  OBCITimeoutProcessBytes: obciTimeoutProcessBytes,

  /** Simulator Board Configurations */
  OBCISimulatorRawAux: obciSimulatorRawAux,
  OBCISimulatorStandard: obciSimulatorStandard,

  /** Radio Channel Limits */
  OBCIRadioChannelMax: obciRadioChannelMax,
  OBCIRadioChannelMin: obciRadioChannelMin,
  OBCIRadioPollTimeMax: obciRadioPollTimeMax,
  OBCIRadioPollTimeMin: obciRadioPollTimeMin,

  /** Time sync stuff */
  OBCITimeSyncArraySize: obciTimeSyncArraySize,
  OBCITimeSyncMultiplierWithSyncConf: obciTimeSyncMultiplierWithSyncConf,
  OBCITimeSyncMultiplierWithoutSyncConf: obciTimeSyncMultiplierWithoutSyncConf,
  OBCITimeSyncThresholdTransFailureMS: obciTimeSyncThresholdTransFailureMS,

  /** Set board mode */
  OBCIBoardModeSet: obciBoardModeSet,
  OBCIBoardModeCmdDefault: obciBoardModeCmdDefault,
  OBCIBoardModeCmdDebug: obciBoardModeCmdDebug,
  OBCIBoardModeCmdAnalog: obciBoardModeCmdAnalog,
  OBCIBoardModeCmdDigital: obciBoardModeCmdDigital,
  OBCIBoardModeCmdGetCur: obciBoardModeCmdGetCur,
  OBCIBoardModeAnalog: obciBoardModeAnalog,
  OBCIBoardModeDefault: obciBoardModeDefault,
  OBCIBoardModeDebug: obciBoardModeDebug,
  OBCIBoardModeDigital: obciBoardModeDigital,

  /** Set sample rate */
  OBCISampleRateSet: obciSampleRateSet,
  OBCISampleRateCmdCyton16000: obciSampleRateCmdCyton16000,
  OBCISampleRateCmdCyton8000: obciSampleRateCmdCyton8000,
  OBCISampleRateCmdCyton4000: obciSampleRateCmdCyton4000,
  OBCISampleRateCmdCyton2000: obciSampleRateCmdCyton2000,
  OBCISampleRateCmdCyton1000: obciSampleRateCmdCyton1000,
  OBCISampleRateCmdCyton500: obciSampleRateCmdCyton500,
  OBCISampleRateCmdCyton250: obciSampleRateCmdCyton250,
  OBCISampleRateCmdGang25600: obciSampleRateCmdGang25600,
  OBCISampleRateCmdGang12800: obciSampleRateCmdGang12800,
  OBCISampleRateCmdGang6400: obciSampleRateCmdGang6400,
  OBCISampleRateCmdGang3200: obciSampleRateCmdGang3200,
  OBCISampleRateCmdGang1600: obciSampleRateCmdGang1600,
  OBCISampleRateCmdGang800: obciSampleRateCmdGang800,
  OBCISampleRateCmdGang400: obciSampleRateCmdGang400,
  OBCISampleRateCmdGang200: obciSampleRateCmdGang200,
  OBCISampleRateCmdGetCur: obciSampleRateCmdaGetCur,

  /** Wifi Stuff */
  OBCIWifiAttach: obciWifiAttach,
  OBCIWifiRemove: obciWifiRemove,
  OBCIWifiReset: obciWifiReset,
  OBCIWifiStatus: obciWifiStatus,

  /** Baud Rates */
  OBCIRadioBaudRateDefault: obciRadioBaudRateDefault,
  OBCIRadioBaudRateDefaultStr: obciRadioBaudRateDefaultStr,
  OBCIRadioBaudRateFast: obciRadioBaudRateFast,
  OBCIRadioBaudRateFastStr: obciRadioBaudRateFastStr,

  /** Emitters */
  OBCIEmitterAccelerometer: obciEmitterAccelerometer,
  OBCIEmitterBlePoweredUp: obciEmitterBlePoweredUp,
  OBCIEmitterClose: obciEmitterClose,
  OBCIEmitterDroppedPacket: obciEmitterDroppedPacket,
  OBCIEmitterEot: obciEmitterEot,
  OBCIEmitterError: obciEmitterError,
  OBCIEmitterGanglionFound: obciEmitterGanglionFound,
  OBCIEmitterHardSet: obciEmitterHardSet,
  OBCIEmitterImpedance: obciEmitterImpedance,
  OBCIEmitterImpedanceArray: obciEmitterImpedanceArray,
  OBCIEmitterMessage: obciEmitterMessage,
  OBCIEmitterQuery: obciEmitterQuery,
  OBCIEmitterRawDataPacket: obciEmitterRawDataPacket,
  OBCIEmitterReady: obciEmitterReady,
  OBCIEmitterRFduino: obciEmitterRFduino,
  OBCIEmitterSample: obciEmitterSample,
  OBCIEmitterScanStopped: obciEmitterScanStopped,
  OBCIEmitterSynced: obciEmitterSynced,
  OBCIEmitterWifiShield: obciEmitterWifiShield,

  /** Emitters */

  /** Accel packets */
  OBCIGanglionAccelAxisX: obciGanglionAccelAxisX,
  OBCIGanglionAccelAxisY: obciGanglionAccelAxisY,
  OBCIGanglionAccelAxisZ: obciGanglionAccelAxisZ,

  /** Ganglion */
  OBCIGanglionBleSearchTime: obciGanglionBleSearchTime,
  OBCIGanglionByteIdUncompressed: obciGanglionByteIdUncompressed,
  OBCIGanglionByteId18Bit: obciGanglionByteId18Bit,
  OBCIGanglionByteId19Bit: obciGanglionByteId19Bit,
  OBCIGanglionByteIdImpedanceChannel1: obciGanglionByteIdImpedanceChannel1,
  OBCIGanglionByteIdImpedanceChannel2: obciGanglionByteIdImpedanceChannel2,
  OBCIGanglionByteIdImpedanceChannel3: obciGanglionByteIdImpedanceChannel3,
  OBCIGanglionByteIdImpedanceChannel4: obciGanglionByteIdImpedanceChannel4,
  OBCIGanglionByteIdImpedanceChannelReference: obciGanglionByteIdImpedanceChannelReference,
  OBCIGanglionByteIdMultiPacket: obciGanglionByteIdMultiPacket,
  OBCIGanglionByteIdMultiPacketStop: obciGanglionByteIdMultiPacketStop,
  OBCIGanglionMCP3912Gain: obciGanglionMCP3912Gain,
  // assumed gain setting for MCP3912.  NEEDS TO BE ADJUSTABLE JM
  OBCIGanglionMCP3912Vref: obciGanglionMCP3912Vref,
  // reference voltage for ADC in MCP3912 set in hardware
  OBCIGanglionPacketSize: obciGanglionPacketSize,
  OBCIGanglionPacket18Bit: obciGanglionPacket18Bit,
  OBCIGanglionPacket19Bit: obciGanglionPacket19Bit,
  OBCIGanglionPrefix: obciGanglionPrefix,
  OBCIGanglionSamplesPerPacket: obciGanglionSamplesPerPacket,
  OBCIGanglionSyntheticDataEnable: obciGanglionSyntheticDataEnable,
  OBCIGanglionSyntheticDataDisable: obciGanglionSyntheticDataDisable,
  OBCIGanglionImpedanceStart: obciGanglionImpedanceStart,
  OBCIGanglionImpedanceStop: obciGanglionImpedanceStop,
  OBCIGanglionScaleFactorPerCountVolts: obciGanglionScaleFactorPerCountVolts,

  /** Simblee */
  SimbleeUuidService: simbleeUuidService,
  SimbleeUuidReceive: simbleeUuidReceive,
  SimbleeUuidSend: simbleeUuidSend,
  SimbleeUuidDisconnect: simbleeUuidDisconnect,

  /** RFduino BLE UUID */
  RFduinoUuidService: rfduinoUuidService,
  RFduinoUuidReceive: rfduinoUuidReceive,
  RFduinoUuidSend: rfduinoUuidSend,
  RFduinoUuidSendTwo: rfduinoUuidSendTwo,

  /** Cyton BLE */
  OBCICytonBLESamplesPerPacket: obciCytonBLESamplesPerPacket,

  /** Accel scale factor */
  OBCIGanglionAccelScaleFactor: obciGanglionAccelScaleFactor,

  /** Noble */
  OBCINobleEmitterPeripheralConnect: obciNobleEmitterPeripheralConnect,
  OBCINobleEmitterPeripheralDisconnect: obciNobleEmitterPeripheralDisconnect,
  OBCINobleEmitterPeripheralDiscover: obciNobleEmitterPeripheralDiscover,
  OBCINobleEmitterPeripheralServicesDiscover: obciNobleEmitterPeripheralServicesDiscover,
  OBCINobleEmitterServiceCharacteristicsDiscover: obciNobleEmitterServiceCharacteristicsDiscover,
  OBCINobleEmitterServiceRead: obciNobleEmitterServiceRead,
  OBCINobleEmitterDiscover: obciNobleEmitterDiscover,
  OBCINobleEmitterScanStart: obciNobleEmitterScanStart,
  OBCINobleEmitterScanStop: obciNobleEmitterScanStop,
  OBCINobleEmitterStateChange: obciNobleEmitterStateChange,
  OBCINobleStatePoweredOn: obciNobleStatePoweredOn,
  getPeripheralLocalNames: getPeripheralLocalNames,
  getPeripheralWithLocalName: getPeripheralWithLocalName,
  getVersionNumber: getVersionNumber,
  isPeripheralGanglion: isPeripheralGanglion,
  commandSampleRateForCmdCyton: commandSampleRateForCmdCyton,
  commandSampleRateForCmdGanglion: commandSampleRateForCmdGanglion,
  commandBoardModeForMode: commandBoardModeForMode,
  rawDataToSampleObjectDefault: rawDataToSampleObjectDefault,

  /** Protocols */
  OBCIProtocolBLE: obciProtocolBLE,
  OBCIProtocolSerial: obciProtocolSerial,
  OBCIProtocolWifi: obciProtocolWifi,

  /** Register Query for Cyton */
  OBCIRegisterQueryAccelerometerFirmwareV1: obciRegisterQueryAccelerometerFirmwareV1,
  OBCIRegisterQueryAccelerometerFirmwareV3: obciRegisterQueryAccelerometerFirmwareV3,
  OBCIRegisterQueryCyton: obciRegisterQueryCyton,
  OBCIRegisterQueryCytonDaisy: obciRegisterQueryCytonDaisy,
  OBCIRegisterQueryNameMISC1: obciRegisterQueryNameMISC1,
  OBCIRegisterQueryNameBIASSENSP: obciRegisterQueryNameBIASSENSP,
  OBCIRegisterQueryNameCHnSET: obciRegisterQueryNameCHnSET,
  OBCIRegisterQuerySizeCytonFirmwareV1: obciRegisterQuerySizeCytonFirmwareV1,
  OBCIRegisterQuerySizeCytonDaisyFirmwareV1: obciRegisterQuerySizeCytonDaisyFirmwareV1,
  OBCIRegisterQuerySizeCytonFirmwareV3: obciRegisterQuerySizeCytonFirmwareV3,
  OBCIRegisterQuerySizeCytonDaisyFirmwareV3: obciRegisterQuerySizeCytonDaisyFirmwareV3
};
/**
* @description To add a usability abstraction layer above channel setting commands. Due to the
*          extensive and highly specific nature of the channel setting command chain, this
*          will take several different human readable inputs and merge to one array filled
*          with the correct commands, prime for sending directly to the write command.
* @param channelNumber - Number (1-16)
* @param powerDown - Bool (true -> OFF, false -> ON (default))
*          turns the channel on or off
* @param gain - Number (1,2,4,6,8,12,24(default))
*          sets the gain for the channel
* @param inputType - String (normal,shorted,biasMethod,mvdd,temp,testsig,biasDrp,biasDrn)
*          selects the ADC channel input source
* @param bias - Bool (true -> Include in bias (default), false -> remove from bias)
*          selects to include the channel input in bias generation
* @param srb2 - Bool (true -> Connect this input to SRB2 (default),
*                     false -> Disconnect this input from SRB2)
*          Select to connect (true) this channel's P input to the SRB2 pin. This closes
*              a switch between P input and SRB2 for the given channel, and allows the
*              P input to also remain connected to the ADC.
* @param srb1 - Bool (true -> connect all N inputs to SRB1,
*                     false -> Disconnect all N inputs from SRB1 (default))
*          Select to connect (true) all channels' N inputs to SRB1. This effects all pins,
*              and disconnects all N inputs from the ADC.
* @returns {Promise} resolves {commandArray: array of commands to be sent,
                               newChannelSettingsObject: an updated channel settings object
                                                         to be stored in openBCIBoard.channelSettingsArray},
                     rejects on bad input or no board
*/

function channelSetter(channelNumber, powerDown, gain, inputType, bias, srb2, srb1) {
  // Used to store and assemble the commands
  var cmdPowerDown, cmdBias, cmdSrb2, cmdSrb1;
  return new Promise(function (resolve, reject) {
    // Validate the input
    if (!isNumber(channelNumber)) reject(Error("channelNumber must be of type 'number' "));
    if (!isBoolean(powerDown)) reject(Error("powerDown must be of type 'boolean' "));
    if (!isNumber(gain)) reject(Error("gain must be of type 'number' "));
    if (!isString(inputType)) reject(Error("inputType must be of type 'string' "));
    if (!isBoolean(bias)) reject(Error("bias must be of type 'boolean' "));
    if (!isBoolean(srb2)) reject(Error("srb1 must be of type 'boolean' "));
    if (!isBoolean(srb1)) reject(Error("srb2 must be of type 'boolean' ")); // Set Channel Number

    var p1 = commandChannelForCmd(channelNumber)["catch"](function (err) {
      return reject(err);
    }); // Set POWER_DOWN

    cmdPowerDown = powerDown ? obciChannelCmdPowerOff : obciChannelCmdPowerOn; // Set Gain

    var p2 = commandForGain(gain)["catch"](function (err) {
      return reject(err);
    }); // Set ADC string

    var p3 = commandForADCString(inputType)["catch"](function (err) {
      return reject(err);
    }); // Set BIAS

    cmdBias = bias ? obciChannelCmdBiasInclude : obciChannelCmdBiasRemove; // Set SRB2

    cmdSrb2 = srb2 ? obciChannelCmdSRB2Connect : obciChannelCmdSRB2Diconnect; // Set SRB1

    cmdSrb1 = srb1 ? obciChannelCmdSRB1Connect : obciChannelCmdSRB1Diconnect;
    var newChannelSettingsObject = {
      channelNumber: channelNumber,
      powerDown: powerDown,
      gain: gain,
      inputType: inputType,
      bias: bias,
      srb2: srb2,
      srb1: srb1
    };
    Promise.all([p1, p2, p3]).then(function (values) {
      var outputArray = [obciChannelCmdSet, values[0], cmdPowerDown, values[1], values[2], cmdBias, cmdSrb2, cmdSrb1, obciChannelCmdLatch];
      resolve({
        commandArray: outputArray,
        newChannelSettingsObject: newChannelSettingsObject
      });
    });
  });
}
/**
* @description To build the array of commands to send to the board to measure impedance
* @param channelNumber
* @param pInputApplied - Bool (true -> Test Signal Applied, false -> Test Signal Not Applied (default))
*          applies the test signal to the P input
* @param nInputApplied - Bool (true -> Test Signal Applied, false -> Test Signal Not Applied (default))
*          applies the test signal to the N input
* @returns {Promise} - fulfilled will contain an array of comamnds
*/


function impedanceSetter(channelNumber, pInputApplied, nInputApplied) {
  var cmdNInputApplied, cmdPInputApplied;
  return new Promise(function (resolve, reject) {
    // validate inputs
    if (!isNumber(channelNumber)) reject(Error("channelNumber must be of type 'number' "));
    if (!isBoolean(pInputApplied)) reject(Error("pInputApplied must be of type 'boolean' "));
    if (!isBoolean(nInputApplied)) reject(Error("nInputApplied must be of type 'boolean' ")); // Set pInputApplied

    cmdPInputApplied = pInputApplied ? obciChannelImpedanceTestSignalApplied : obciChannelImpedanceTestSignalAppliedNot; // Set nInputApplied

    cmdNInputApplied = nInputApplied ? obciChannelImpedanceTestSignalApplied : obciChannelImpedanceTestSignalAppliedNot; // Set Channel Number

    commandChannelForCmd(channelNumber).then(function (command) {
      var outputArray = [obciChannelImpedanceSet, command, cmdPInputApplied, cmdNInputApplied, obciChannelImpedanceLatch]; // console.log(outputArray)

      resolve(outputArray);
    })["catch"](function (err) {
      return reject(err);
    });
  });
}
/**
 * @description To build the array of commands to send to the board to set the sample rate
 * @param boardType {String} - The type of board, either cyton or ganglion. Default is Cyton
 * @param sampleRate {Number} - The sample rate you want to set to. Please see docs for possible sample rates.
 * @returns {Promise} - fulfilled will contain an array of commands
 */


function sampleRateSetter(boardType, sampleRate) {
  return new Promise(function (resolve, reject) {
    // validate inputs
    if (!isString(boardType)) return reject(Error("board type must be of type 'string' "));
    if (!isNumber(sampleRate)) return reject(Error("sampleRate must be of type 'number' "));
    sampleRate = Math.floor(sampleRate);
    var func;

    if (boardType === obciBoardCyton || boardType === obciBoardDaisy) {
      func = commandSampleRateForCmdCyton;
    } else if (boardType === obciBoardGanglion) {
      func = commandSampleRateForCmdGanglion;
    } else {
      return reject(Error("boardType must be either ".concat(obciBoardCyton, " or ").concat(obciBoardGanglion)));
    } // Set Channel Number


    func(sampleRate).then(function (command) {
      var outputArray = [obciSampleRateSet, command]; // console.log(outputArray)

      resolve(outputArray);
    })["catch"](function (err) {
      return reject(err);
    });
  });
}
/**
 * @description To build the array of commands to send to the board t
 * @param boardMode {String} - The type of board mode:
 *  `default`: Board will use Accel
 *  `
 * @returns {Promise} - fulfilled will contain an array of commands
 */


function boardModeSetter(boardMode) {
  return new Promise(function (resolve, reject) {
    // validate inputs
    if (!isString(boardMode)) return reject(Error("board mode must be of type 'string' ")); // Set Channel Number

    commandBoardModeForMode(boardMode).then(function (command) {
      var outputArray = [obciBoardModeSet, command]; // console.log(outputArray)

      resolve(outputArray);
    })["catch"](function (err) {
      return reject(err);
    });
  });
}

function isNumber(input) {
  return typeof input === 'number';
}

function isBoolean(input) {
  return typeof input === 'boolean';
}

function isString(input) {
  return typeof input === 'string';
}

function isUndefined(input) {
  return typeof input === 'undefined';
}

function isNull(input) {
  return input === null;
}

function commandForADCString(adcString) {
  return new Promise(function (resolve, reject) {
    switch (adcString) {
      case obciStringADCNormal:
        resolve(obciChannelCmdADCNormal);
        break;

      case obciStringADCShorted:
        resolve(obciChannelCmdADCShorted);
        break;

      case obciStringADCBiasMethod:
        resolve(obciChannelCmdADCBiasMethod);
        break;

      case obciStringADCMvdd:
        resolve(obciChannelCmdADCMVDD);
        break;

      case obciStringADCTemp:
        resolve(obciChannelCmdADCTemp);
        break;

      case obciStringADCTestSig:
        resolve(obciChannelCmdADCTestSig);
        break;

      case obciStringADCBiasDrp:
        resolve(obciChannelCmdADCBiasDRP);
        break;

      case obciStringADCBiasDrn:
        resolve(obciChannelCmdADCBiasDRN);
        break;

      default:
        reject(Error('Invalid ADC string'));
        break;
    }
  });
}
/**
 * Returns the input type for the given command
 * @param cmd {Number} The command
 * @returns {String}
 */


function inputTypeForCommand(cmd) {
  switch (String(cmd)) {
    case obciChannelCmdADCNormal:
      return obciStringADCNormal;

    case obciChannelCmdADCShorted:
      return obciStringADCShorted;

    case obciChannelCmdADCBiasMethod:
      return obciStringADCBiasMethod;

    case obciChannelCmdADCMVDD:
      return obciStringADCMvdd;

    case obciChannelCmdADCTemp:
      return obciStringADCTemp;

    case obciChannelCmdADCTestSig:
      return obciStringADCTestSig;

    case obciChannelCmdADCBiasDRP:
      return obciStringADCBiasDrp;

    case obciChannelCmdADCBiasDRN:
      return obciStringADCBiasDrn;

    default:
      throw new Error('Invalid input type, must be less than 8');
  }
}

function commandForGain(gainSetting) {
  return new Promise(function (resolve, reject) {
    switch (gainSetting) {
      case 1:
        resolve(obciChannelCmdGain1);
        break;

      case 2:
        resolve(obciChannelCmdGain2);
        break;

      case 4:
        resolve(obciChannelCmdGain4);
        break;

      case 6:
        resolve(obciChannelCmdGain6);
        break;

      case 8:
        resolve(obciChannelCmdGain8);
        break;

      case 12:
        resolve(obciChannelCmdGain12);
        break;

      case 24:
        resolve(obciChannelCmdGain24);
        break;

      default:
        reject(Error('Invalid gain setting of ' + gainSetting + ' gain must be (1,2,4,6,8,12,24)'));
        break;
    }
  });
}
/**
 * Get the gain
 * @param cmd {Number}
 * @returns {Number}
 */


function gainForCommand(cmd) {
  switch (String(cmd)) {
    case obciChannelCmdGain1:
      return 1;

    case obciChannelCmdGain2:
      return 2;

    case obciChannelCmdGain4:
      return 4;

    case obciChannelCmdGain6:
      return 6;

    case obciChannelCmdGain8:
      return 8;

    case obciChannelCmdGain12:
      return 12;

    case obciChannelCmdGain24:
      return 24;

    default:
      throw new Error("Invalid gain setting of ".concat(cmd, " gain must be (0,1,2,3,4,5,6)"));
  }
}

function commandChannelForCmd(channelNumber) {
  return new Promise(function (resolve, reject) {
    switch (channelNumber) {
      case 1:
        resolve(obciChannelCmdChannel1);
        break;

      case 2:
        resolve(obciChannelCmdChannel2);
        break;

      case 3:
        resolve(obciChannelCmdChannel3);
        break;

      case 4:
        resolve(obciChannelCmdChannel4);
        break;

      case 5:
        resolve(obciChannelCmdChannel5);
        break;

      case 6:
        resolve(obciChannelCmdChannel6);
        break;

      case 7:
        resolve(obciChannelCmdChannel7);
        break;

      case 8:
        resolve(obciChannelCmdChannel8);
        break;

      case 9:
        resolve(obciChannelCmdChannel9);
        break;

      case 10:
        resolve(obciChannelCmdChannel10);
        break;

      case 11:
        resolve(obciChannelCmdChannel11);
        break;

      case 12:
        resolve(obciChannelCmdChannel12);
        break;

      case 13:
        resolve(obciChannelCmdChannel13);
        break;

      case 14:
        resolve(obciChannelCmdChannel14);
        break;

      case 15:
        resolve(obciChannelCmdChannel15);
        break;

      case 16:
        resolve(obciChannelCmdChannel16);
        break;

      default:
        reject(Error('Invalid channel number'));
        break;
    }
  });
}
/**
 * @typedef {Object} ChannelSettingsObject - See page 50 of the ads1299.pdf
 * @property {Number} channelNumber - The channel number of this object
 * @property {Boolean} powerDown - Power-down: - This boolean determines the channel power mode for the
 *                      corresponding channel. `false` for normal operation, channel is on, and `true` for channel
 *                      power-down, channel is off. (Default is `false`)
 * @property {Number} gain - PGA gain: This number determines the PGA gain setting. Can be either 1, 2, 4, 6, 8, 12, 24
 *                      (Default is 24)
 * @property {String} inputType - Channel input: This string is used to determine the channel input selection.
 *                      Can be:
 *                        'normal' - Normal electrode input (Default)
 *                        'shorted' - Input shorted (for offset or noise measurements)
 *                        'biasMethod' - Used in conjunction with BIAS_MEAS bit for BIAS measurements.
 *                        'mvdd' - MVDD for supply measurement
 *                        'temp' - Temperature sensor
 *                        'testsig' - Test signal
 *                        'biasDrp' - BIAS_DRP (positive electrode is the driver)
 *                        'biasDrn' - BIAS_DRN (negative electrode is the driver)
 * @property {Boolean} bias - BIAS: Is the channel included in the bias? If `true` or yes, this channel has both P
 *                      and N channels connected to the bias. (Default is `true`)
 * @property {Boolean} srb2 - SRB2 connection: This boolean determines the SRB2 connection for the corresponding
 *                      channel. `false` for open, not connected to channel, and `true` for closed, connected to the
 *                      channel. (Default is `true`)
 * @property {Boolean} srb1 - Stimulus, reference, and bias 1: This boolean connects the SRB2 to all 4, 6, or 8
 *                      channels inverting inputs. `false` when switches open, disconnected, and `true` when switches
 *                      closed, or connected. (Default is `false`)
 */

/**
 * Get an object of default board settings.
 * @param channelNumber
 * @returns {ChannelSettingsObject}
 */


function channelSettingsObjectDefault(channelNumber) {
  return {
    channelNumber: channelNumber,
    powerDown: false,
    gain: 24,
    inputType: obciStringADCNormal,
    bias: true,
    srb2: true,
    srb1: false
  };
}
/**
 * @description RawDataToSample default object creation
 * @param numChannels {Number} - The number of channels
 * @returns {RawDataToSample} - A new object
 */


function rawDataToSampleObjectDefault(numChannels) {
  if (numChannels === undefined) numChannels = obciNumberOfChannelsDefault;
  return {
    accelArray: [0, 0, 0],
    channelSettings: constantsModule.channelSettingsArrayInit(numChannels),
    decompressedSamples: decompressedSamplesInit(numChannels),
    lastSampleNumber: 0,
    rawDataPacket: Buffer.alloc(33),
    rawDataPackets: [],
    scale: true,
    sendCounts: false,
    timeOffset: 0,
    verbose: false
  };
}

function decompressedSamplesInit(numChannels) {
  var output = [];

  for (var i = 0; i < 3; i++) {
    output.push(new Array(numChannels));
  }

  return output;
}
/**
 * Get's the command for sample rate Cyton
 * @param sampleRate {Number} - The desired sample rate
 * @return {Promise}
 */


function commandSampleRateForCmdCyton(sampleRate) {
  return new Promise(function (resolve, reject) {
    switch (sampleRate) {
      case obciSampleRate16000:
        resolve(obciSampleRateCmdCyton16000);
        break;

      case obciSampleRate8000:
        resolve(obciSampleRateCmdCyton8000);
        break;

      case obciSampleRate4000:
        resolve(obciSampleRateCmdCyton4000);
        break;

      case obciSampleRate2000:
        resolve(obciSampleRateCmdCyton2000);
        break;

      case obciSampleRate1000:
        resolve(obciSampleRateCmdCyton1000);
        break;

      case obciSampleRate500:
        resolve(obciSampleRateCmdCyton500);
        break;

      case obciSampleRate250:
        resolve(obciSampleRateCmdCyton250);
        break;

      default:
        reject(Error('Invalid sample rate'));
        break;
    }
  });
}
/**
 * Get's the command for sample rate Cyton
 * @param sampleRate {Number} - The desired sample rate
 * @return {Promise}
 */


function commandSampleRateForCmdGanglion(sampleRate) {
  return new Promise(function (resolve, reject) {
    switch (sampleRate) {
      case obciSampleRate25600:
        resolve(obciSampleRateCmdGang25600);
        break;

      case obciSampleRate12800:
        resolve(obciSampleRateCmdGang12800);
        break;

      case obciSampleRate6400:
        resolve(obciSampleRateCmdGang6400);
        break;

      case obciSampleRate3200:
        resolve(obciSampleRateCmdGang3200);
        break;

      case obciSampleRate1600:
        resolve(obciSampleRateCmdGang1600);
        break;

      case obciSampleRate800:
        resolve(obciSampleRateCmdGang800);
        break;

      case obciSampleRate400:
        resolve(obciSampleRateCmdGang400);
        break;

      case obciSampleRate200:
        resolve(obciSampleRateCmdGang200);
        break;

      default:
        reject(Error('Invalid sample rate'));
        break;
    }
  });
}
/**
 * Get's the command for sample rate Cyton
 * @param boardMode {String} - The desired sample rate
 * @return {Promise}
 */


function commandBoardModeForMode(boardMode) {
  return new Promise(function (resolve, reject) {
    switch (boardMode) {
      case obciBoardModeDefault:
        resolve(obciBoardModeCmdDefault);
        break;

      case obciBoardModeDebug:
        resolve(obciBoardModeCmdDebug);
        break;

      case obciBoardModeAnalog:
        resolve(obciBoardModeCmdAnalog);
        break;

      case obciBoardModeDigital:
        resolve(obciBoardModeCmdDigital);
        break;

      default:
        reject(Error('Invalid sample rate'));
        break;
    }
  });
}
/**
 * @description Get a list of local names from an array of peripherals
 */


function getPeripheralLocalNames(pArray) {
  return new Promise(function (resolve, reject) {
    var list = [];
    pArray.forEach(function (perif) {
      list.push(perif.advertisement.localName);
    });

    if (list.length > 0) {
      return resolve(list);
    } else {
      return reject(Error("No peripherals discovered with prefix equal to ".concat(obciGanglionPrefix)));
    }
  });
}
/**
 * @description Get a peripheral with a local name
 * @param `pArray` {Array} - Array of peripherals
 * @param `localName` {String} - The local name of the BLE device.
 */


function getPeripheralWithLocalName(pArray, localName) {
  return new Promise(function (resolve, reject) {
    if (openbci_constants_typeof(pArray) !== 'object') return reject(Error("pArray must be of type Object"));
    pArray.forEach(function (perif) {
      if (perif.advertisement.hasOwnProperty('localName')) {
        if (perif.advertisement.localName === localName) {
          return resolve(perif);
        }
      }
    });
    return reject(Error("No peripheral found with localName: ".concat(localName)));
  });
}
/**
 * @description This function is used to extract the major version from a github
 *  version string.
 * @returns {Number} The major version number
 */


function getVersionNumber(versionStr) {
  return Number(versionStr[1]);
}
/**
 * @description Very safely checks to see if the noble peripheral is a
 *  ganglion by way of checking the local name property.
 */


function isPeripheralGanglion(peripheral) {
  if (peripheral) {
    if (peripheral.hasOwnProperty('advertisement')) {
      if (peripheral.advertisement !== null && peripheral.advertisement.hasOwnProperty('localName')) {
        if (peripheral.advertisement.localName !== undefined && peripheral.advertisement.localName !== null) {
          if (peripheral.advertisement.localName.indexOf(obciGanglionPrefix) > -1) {
            return true;
          }
        }
      }
    }
  }

  return false;
}

/* harmony default export */ const openbci_constants = (constantsModule);
// EXTERNAL MODULE: ./node_modules/gaussian/lib/gaussian.js
var gaussian = __webpack_require__(1481);
var gaussian_default = /*#__PURE__*/__webpack_require__.n(gaussian);
// EXTERNAL MODULE: ./node_modules/streamsearch/lib/sbmh.js
var sbmh = __webpack_require__(1301);
var sbmh_default = /*#__PURE__*/__webpack_require__.n(sbmh);
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/ganglion/ganglion-ble-master/src/utilities.js




 // import { Uint8Array } from 'buffer/';

/** Constants for interpreting the EEG data */
// Reference voltage for ADC in ADS1299.
//   Set by its hardware.

var ADS1299_VREF = 4.5; // Scale factor for aux data

var SCALE_FACTOR_ACCEL = 0.002 / Math.pow(2, 4); // X, Y, Z

var ACCEL_NUMBER_AXIS = 3; // Default ADS1299 gains array

var utilitiesModule = {
  /**
   * @typedef {Object} ProcessedBuffer
   * @property {Uint8Array|SafeBuffer|Buffer2} buffer The remaining buffer. Can be null.
   * @property {Array} rawDataPackets The extracted raw data packets
   */

  /**
   * @typedef {Object} Sample
   * @property {Array} accelData of floats of accel data. not always present in object.
   * @property {Number} sampleNumber The sample number
   * @property {Array} channelData The extracted channel data
   * @property {Uint8Array} rawDataPacket The raw data packet
   * @property {Boolean} valid If the sample is valid
   */

  /**
   * @typedef {Object} Impedance
   * @property {Number} channelNumber The channel number
   * @property {Number} impedanceValue The impedance in ohms
   */

  /**
   * @typedef {Object} RawDataToSample
   * @property {Array} rawDataPackets - An array of rawDataPackets
   * @property {Uint8Array} rawDataPacket - A single raw data packet
   * @property {Uint8Array} multiPacketBuffer - This buffer is used to build up multiple messages over ble and emit them at once
   * @property {Array} channelSettings - The channel settings array
   * @property {Number} timeOffset (optional) for non time stamp use cases i.e. 0xC0 or 0xC1 (default and raw aux)
   * @property {Array} accelArray (optional) for non time stamp use cases
   * @property {Boolean} verbose (optional) for verbose output
   * @property {Number} lastSampleNumber (optional) - The last sample number
   * @property {Boolean} scale (optional) Default `true`. A gain of 24 for Cyton will be used and 51 for ganglion by default.
   * @property {Array} decompressedSamples - An array to hold delta compression items
   * @property {Boolean} sendCounts - True if you want raw A/D counts or scaled counts in samples
   */

  /**
   * @description Used to extract samples out of a buffer of unknown length
   * @param dataBuffer {Uint8Array} - A buffer to parse for samples
   * @returns {ProcessedBuffer} - Object with parsed raw packets and remaining buffer. Calling function shall maintain
   *  the buffer in it's scope.
   * @author AJ Keller (@aj-ptw)
   */
  extractRawDataPackets: function extractRawDataPackets(dataBuffer) {
    if (!dataBuffer) {
      return {
        'buffer': dataBuffer,
        'rawDataPackets': []
      };
    }

    var bytesToParse = dataBuffer.length;
    var rawDataPackets = []; // Exit if we have a buffer with less data than a packet

    if (bytesToParse < openbci_constants.OBCIPacketSize) {
      return {
        'buffer': dataBuffer,
        'rawDataPackets': rawDataPackets
      };
    }

    var parsePosition = 0; // Begin parseing

    while (parsePosition <= bytesToParse - openbci_constants.OBCIPacketSize) {
      // Is the current byte a head byte that looks like 0xA0
      if (dataBuffer[parsePosition] === openbci_constants.OBCIByteStart) {
        // Now that we know the first is a head byte, let's see if the last one is a
        //  tail byte 0xCx where x is the set of numbers from 0-F (hex)
        if (isStopByte(dataBuffer[parsePosition + openbci_constants.OBCIPacketSize - 1])) {
          // console.log(dataBuffer[parsePosition+1]);

          /** We just qualified a raw packet */
          // This could be a time set packet!
          // this.timeOfPacketArrival = this.time();
          // Grab the raw packet, make a copy of it.
          var rawPacket = void 0;
          rawPacket = Uint8Array.from(dataBuffer.slice(parsePosition, parsePosition + openbci_constants.OBCIPacketSize)); // Emit that buffer
          // this.emit('rawDataPacket', rawPacket);

          rawDataPackets.push(rawPacket); // Submit the packet for processing
          // this._processQualifiedPacket(rawPacket);
          // Overwrite the dataBuffer with a new buffer

          var tempBuf = void 0;

          if (parsePosition > 0) {
            tempBuf = Uint8Array.concat([Uint8Array.from(dataBuffer.slice(0, parsePosition)), Uint8Array.from(dataBuffer.slice(parsePosition + openbci_constants.OBCIPacketSize))]);
          } else {
            tempBuf = Uint8Array.from(dataBuffer.slice(openbci_constants.OBCIPacketSize));
          }

          if (tempBuf.length === 0) {
            dataBuffer = null;
          } else {
            dataBuffer = Uint8Array.from(tempBuf);
          } // Move the parse position up one packet


          parsePosition = -1;
          bytesToParse -= openbci_constants.OBCIPacketSize;
        }
      }

      parsePosition++;
    }

    return {
      'buffer': dataBuffer,
      'rawDataPackets': rawDataPackets
    };
  },
  extractRawBLEDataPackets: function extractRawBLEDataPackets(dataBuffer) {
    var rawDataPackets = [];
    if (openbci_constants.isNull(dataBuffer)) return rawDataPackets; // Verify the packet is of length 20

    if (dataBuffer.byteLength !== openbci_constants.OBCIPacketSizeBLECyton) return rawDataPackets;
    var sampleNumbers = [0, 0, 0];
    sampleNumbers[0] = dataBuffer[1];
    sampleNumbers[1] = sampleNumbers[0] + 1;
    if (sampleNumbers[1] > 255) sampleNumbers[1] -= 256;
    sampleNumbers[2] = sampleNumbers[1] + 1;
    if (sampleNumbers[2] > 255) sampleNumbers[2] -= 256;

    for (var i = 0; i < openbci_constants.OBCICytonBLESamplesPerPacket; i++) {
      var rawDataPacket = utilitiesModule.samplePacketZero(sampleNumbers[i]);
      rawDataPacket[0] = openbci_constants.OBCIByteStart;
      rawDataPacket[openbci_constants.OBCIPacketPositionStopByte] = dataBuffer[0];
      dataBuffer.copy(rawDataPacket, openbci_constants.OBCIPacketPositionChannelDataStart, openbci_constants.OBCIPacketPositionChannelDataStart + i * 6, openbci_constants.OBCIPacketPositionChannelDataStart + 6 + i * 6);
      rawDataPackets.push(rawDataPacket);
    }

    return rawDataPackets;
  },
  transformRawDataPacketToSample: transformRawDataPacketToSample,
  transformRawDataPacketsToSample: transformRawDataPacketsToSample,
  convertGanglionArrayToBuffer: convertGanglionArrayToBuffer,
  getRawPacketType: getRawPacketType,
  getFromTimePacketAccel: getFromTimePacketAccel,
  getFromTimePacketTime: getFromTimePacketTime,
  getFromTimePacketRawAux: getFromTimePacketRawAux,
  ganglionFillRawDataPacket: ganglionFillRawDataPacket,
  parsePacketStandardAccel: parsePacketStandardAccel,
  parsePacketStandardRawAux: parsePacketStandardRawAux,
  parsePacketTimeSyncedAccel: parsePacketTimeSyncedAccel,
  parsePacketTimeSyncedRawAux: parsePacketTimeSyncedRawAux,
  parsePacketImpedance: parsePacketImpedance,

  /**
  * @description Mainly used by the simulator to convert a randomly generated sample into a std OpenBCI V3 Packet
  * @param sample - A sample object
  * @returns {Uint8Array}
  */
  convertSampleToPacketStandard: function convertSampleToPacketStandard(sample) {
    var packetBuffer = new Uint8Array(openbci_constants.OBCIPacketSize);
    packetBuffer.fill(0); // start byte

    packetBuffer[0] = openbci_constants.OBCIByteStart; // sample number

    packetBuffer[1] = sample.sampleNumber; // channel data

    for (var i = 0; i < openbci_constants.OBCINumberOfChannelsDefault; i++) {
      var threeByteBuffer = floatTo3ByteBuffer(sample.channelData[i]);
      threeByteBuffer.copy(packetBuffer, 2 + i * 3);
    }

    for (var j = 0; j < 3; j++) {
      var twoByteBuffer = floatTo2ByteBuffer(sample.auxData[j]);
      twoByteBuffer.copy(packetBuffer, openbci_constants.OBCIPacketSize - 1 - 6 + j * 2);
    } // stop byte


    packetBuffer[openbci_constants.OBCIPacketSize - 1] = openbci_constants.OBCIByteStop;
    return packetBuffer;
  },

  /**
  * @description Mainly used by the simulator to convert a randomly generated sample into a std OpenBCI V3 Packet
  * @param sample - A sample object
  * @param rawAux {Uint8Array} - A 6 byte long buffer to insert into raw buffer
  * @returns {Uint8Array} - A 33 byte long buffer
  */
  convertSampleToPacketRawAux: function convertSampleToPacketRawAux(sample, rawAux) {
    var packetBuffer = new Uint8Array(openbci_constants.OBCIPacketSize);
    packetBuffer.fill(0); // start byte

    packetBuffer[0] = openbci_constants.OBCIByteStart; // sample number

    packetBuffer[1] = sample.sampleNumber; // channel data

    for (var i = 0; i < openbci_constants.OBCINumberOfChannelsDefault; i++) {
      var threeByteBuffer = floatTo3ByteBuffer(sample.channelData[i]);
      threeByteBuffer.copy(packetBuffer, 2 + i * 3);
    } // Write the raw aux bytes


    rawAux.copy(packetBuffer, 26); // stop byte

    packetBuffer[openbci_constants.OBCIPacketSize - 1] = makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketStandardRawAux);
    return packetBuffer;
  },

  /**
  * @description Mainly used by the simulator to convert a randomly generated sample into an accel time sync set buffer
  * @param sample {Uint8Array} - A sample object
  * @param time {Number} - The time to inject into the sample.
  * @returns {Uint8Array} - A time sync accel packet
  */
  convertSampleToPacketAccelTimeSyncSet: function convertSampleToPacketAccelTimeSyncSet(sample, time) {
    var buf = convertSampleToPacketAccelTimeSynced(sample, time);
    buf[openbci_constants.OBCIPacketPositionStopByte] = makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketAccelTimeSyncSet);
    return buf;
  },

  /**
  * @description Mainly used by the simulator to convert a randomly generated sample into an accel time synced buffer
  * @param sample {Uint8Array} - A sample object
  * @param time {Number} - The time to inject into the sample.
  * @returns {Uint8Array} - A time sync accel packet
  */
  convertSampleToPacketAccelTimeSynced: convertSampleToPacketAccelTimeSynced,

  /**
  * @description Mainly used by the simulator to convert a randomly generated sample into a raw aux time sync set packet
  * @param sample {Uint8Array} - A sample object
  * @param time {Number} - The time to inject into the sample.
  * @param rawAux {Uint8Array} - 2 byte buffer to inject into sample
  * @returns {Uint8Array} - A time sync raw aux packet
  */
  convertSampleToPacketRawAuxTimeSyncSet: function convertSampleToPacketRawAuxTimeSyncSet(sample, time, rawAux) {
    var buf = convertSampleToPacketRawAuxTimeSynced(sample, time, rawAux);
    buf[openbci_constants.OBCIPacketPositionStopByte] = makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketRawAuxTimeSyncSet);
    return buf;
  },
  convertSampleToPacketRawAuxTimeSynced: convertSampleToPacketRawAuxTimeSynced,
  debugPrettyPrint: function debugPrettyPrint(sample) {
    if (sample === null || sample === undefined) {
      console.log('== Sample is undefined ==');
    } else {
      console.log('-- Sample --');
      console.log('---- Start Byte: ' + sample.startByte);
      console.log('---- Sample Number: ' + sample.sampleNumber);

      for (var i = 0; i < 8; i++) {
        console.log('---- Channel Data ' + (i + 1) + ': ' + sample.channelData[i]);
      }

      if (sample.accelData) {
        for (var j = 0; j < 3; j++) {
          console.log('---- Accel Data ' + j + ': ' + sample.accelData[j]);
        }
      }

      if (sample.auxData) {
        console.log('---- Aux Data ' + sample.auxData);
      }

      console.log('---- Stop Byte: ' + sample.stopByte);
    }
  },
  samplePrintHeader: function samplePrintHeader() {
    return 'All voltages in Volts!' + 'sampleNumber, channel1, channel2, channel3, channel4, channel5, channel6, channel7, channel8, aux1, aux2, aux3\n';
  },
  samplePrintLine: function samplePrintLine(sample) {
    return new Promise(function (resolve, reject) {
      if (sample === null || sample === undefined) reject(Error('undefined sample'));
      resolve(sample.sampleNumber + ',' + sample.channelData[0].toFixed(8) + ',' + sample.channelData[1].toFixed(8) + ',' + sample.channelData[2].toFixed(8) + ',' + sample.channelData[3].toFixed(8) + ',' + sample.channelData[4].toFixed(8) + ',' + sample.channelData[5].toFixed(8) + ',' + sample.channelData[6].toFixed(8) + ',' + sample.channelData[7].toFixed(8) + ',' + sample.auxData[0].toFixed(8) + ',' + sample.auxData[1].toFixed(8) + ',' + sample.auxData[2].toFixed(8) + '\n');
    });
  },
  floatTo3ByteBuffer: floatTo3ByteBuffer,
  floatTo2ByteBuffer: floatTo2ByteBuffer,

  /**
  * @description Calculate the impedance for one channel only.
  * @param sampleObject - Standard OpenBCI sample object
  * @param channelNumber - Number, the channel you want to calculate impedance for.
  * @returns {Promise} - Fulfilled with impedance value for the specified channel.
  * @author AJ Keller
  */
  impedanceCalculationForChannel: function impedanceCalculationForChannel(sampleObject, channelNumber) {
    var sqrt2 = Math.sqrt(2);
    return new Promise(function (resolve, reject) {
      if (sampleObject === undefined || sampleObject === null) reject(Error('Sample Object cannot be null or undefined'));
      if (sampleObject.channelData === undefined || sampleObject.channelData === null) reject(Error('Channel cannot be null or undefined'));
      if (channelNumber < 1 || channelNumber > openbci_constants.OBCINumberOfChannelsDefault) reject(Error('Channel number invalid.'));
      var index = channelNumber - 1;

      if (sampleObject.channelData[index] < 0) {
        sampleObject.channelData[index] *= -1;
      }

      var impedance = sqrt2 * sampleObject.channelData[index] / openbci_constants.OBCILeadOffDriveInAmps; // if (index === 0) console.log("Voltage: " + (sqrt2*sampleObject.channelData[index]) + " leadoff amps: " + k.OBCILeadOffDriveInAmps + " impedance: " + impedance)

      resolve(impedance);
    });
  },

  /**
  * @description Calculate the impedance for all channels.
  * @param sampleObject - Standard OpenBCI sample object
  * @returns {Promise} - Fulfilled with impedances for the sample
  * @author AJ Keller
  */
  impedanceCalculationForAllChannels: function impedanceCalculationForAllChannels(sampleObject) {
    var sqrt2 = Math.sqrt(2);
    return new Promise(function (resolve, reject) {
      if (sampleObject === undefined || sampleObject === null) reject(Error('Sample Object cannot be null or undefined'));
      if (sampleObject.channelData === undefined || sampleObject.channelData === null) reject(Error('Channel cannot be null or undefined'));
      var sampleImpedances = [];
      var numChannels = sampleObject.channelData.length;

      for (var index = 0; index < numChannels; index++) {
        if (sampleObject.channelData[index] < 0) {
          sampleObject.channelData[index] *= -1;
        }

        var impedance = sqrt2 * sampleObject.channelData[index] / openbci_constants.OBCILeadOffDriveInAmps;
        sampleImpedances.push(impedance); // if (index === 0) console.log("Voltage: " + (sqrt2*sampleObject.channelData[index]) + " leadoff amps: " + k.OBCILeadOffDriveInAmps + " impedance: " + impedance)
      }

      sampleObject.impedances = sampleImpedances;
      resolve(sampleObject);
    });
  },
  interpret16bitAsInt32: function interpret16bitAsInt32(twoByteBuffer) {
    var prefix = 0;

    if (twoByteBuffer[0] > 127) {
      // console.log('\t\tNegative number')
      prefix = 65535; // 0xFFFF
    }

    return prefix << 16 | twoByteBuffer[0] << 8 | twoByteBuffer[1];
  },
  interpret24bitAsInt32: function interpret24bitAsInt32(threeByteBuffer) {
    var prefix = 0;

    if (threeByteBuffer[0] > 127) {
      // console.log('\t\tNegative number')
      prefix = 255;
    }

    return prefix << 24 | threeByteBuffer[0] << 16 | threeByteBuffer[1] << 8 | threeByteBuffer[2];
  },
  impedanceArray: function impedanceArray(numberOfChannels) {
    var impedanceArray = [];

    for (var i = 0; i < numberOfChannels; i++) {
      impedanceArray.push(newImpedanceObject(i + 1));
    }

    return impedanceArray;
  },
  impedanceObject: newImpedanceObject,
  impedanceSummarize: function impedanceSummarize(singleInputObject) {
    if (singleInputObject.raw > openbci_constants.OBCIImpedanceThresholdBadMax) {
      // The case for no load (super high impedance)
      singleInputObject.text = openbci_constants.OBCIImpedanceTextNone;
    } else {
      singleInputObject.text = openbci_constants.getTextForRawImpedance(singleInputObject.raw); // Get textual impedance
    }
  },
  newSample: newSample,
  newSampleNoScale: newSampleNoScale,

  /**
  * @description Create a configurable function to return samples for a simulator. This implements 1/f filtering injection to create more brain like data.
  * @param numberOfChannels {Number} - The number of channels in the sample... either 8 or 16
  * @param sampleRateHz {Number} - The sample rate
  * @param injectAlpha {Boolean} (optional) - True if you want to inject noise
  * @param lineNoise {String} (optional) - A string that can be either:
  *              `60Hz` - 60Hz line noise (Default) (ex. __United States__)
  *              `50Hz` - 50Hz line noise (ex. __Europe__)
  *              `none` - Do not inject line noise.
  *
  * @returns {Function}
  */
  randomSample: function randomSample(numberOfChannels, sampleRateHz, injectAlpha, lineNoise) {
    var distribution = gaussian_default()(0, 1);
    var sineWaveFreqHz10 = 10;
    var sineWaveFreqHz50 = 50;
    var sineWaveFreqHz60 = 60;
    var uVolts = 1000000;
    var sinePhaseRad = new Array(numberOfChannels + 1); // prevent index error with '+1'

    sinePhaseRad.fill(0);
    var auxData = [0, 0, 0];
    var accelCounter = 0; // With 250Hz, every 10 samples, with 125Hz, every 5...

    var samplesPerAccelRate = Math.floor(sampleRateHz / 25); // best to make this an integer

    if (samplesPerAccelRate < 1) samplesPerAccelRate = 1; // Init arrays to hold coefficients for each channel and init to 0
    //  This gives the 1/f filter memory on each iteration

    var b0 = new Array(numberOfChannels).fill(0);
    var b1 = new Array(numberOfChannels).fill(0);
    var b2 = new Array(numberOfChannels).fill(0);
    /**
    * @description Use a 1/f filter
    * @param previousSampleNumber {Number} - The previous sample number
    */

    return function (previousSampleNumber) {
      var sample = newSample();
      var whiteNoise;

      for (var i = 0; i < numberOfChannels; i++) {
        // channels are 0 indexed
        // This produces white noise
        whiteNoise = distribution.ppf(Math.random()) * Math.sqrt(sampleRateHz / 2) / uVolts;

        switch (i) {
          case 0: // Add 10Hz signal to channel 1... brainy

          case 1:
            if (injectAlpha) {
              sinePhaseRad[i] += 2 * Math.PI * sineWaveFreqHz10 / sampleRateHz;

              if (sinePhaseRad[i] > 2 * Math.PI) {
                sinePhaseRad[i] -= 2 * Math.PI;
              }

              whiteNoise += 5 * Math.SQRT2 * Math.sin(sinePhaseRad[i]) / uVolts;
            }

            break;

          default:
            if (lineNoise === openbci_constants.OBCISimulatorLineNoiseHz60) {
              // If we're in murica we want to add 60Hz line noise
              sinePhaseRad[i] += 2 * Math.PI * sineWaveFreqHz60 / sampleRateHz;

              if (sinePhaseRad[i] > 2 * Math.PI) {
                sinePhaseRad[i] -= 2 * Math.PI;
              }

              whiteNoise += 8 * Math.SQRT2 * Math.sin(sinePhaseRad[i]) / uVolts;
            } else if (lineNoise === openbci_constants.OBCISimulatorLineNoiseHz50) {
              // add 50Hz line noise if we are not in america
              sinePhaseRad[i] += 2 * Math.PI * sineWaveFreqHz50 / sampleRateHz;

              if (sinePhaseRad[i] > 2 * Math.PI) {
                sinePhaseRad[i] -= 2 * Math.PI;
              }

              whiteNoise += 8 * Math.SQRT2 * Math.sin(sinePhaseRad[i]) / uVolts;
            }

        }
        /**
        * See http://www.firstpr.com.au/dsp/pink-noise/ section "Filtering white noise to make it pink"
        */


        b0[i] = 0.99765 * b0[i] + whiteNoise * 0.0990460;
        b1[i] = 0.96300 * b1[i] + whiteNoise * 0.2965164;
        b2[i] = 0.57000 * b2[i] + whiteNoise * 1.0526913;
        sample.channelData[i] = b0[i] + b1[i] + b2[i] + whiteNoise * 0.1848;
      }

      if (previousSampleNumber === 255) {
        sample.sampleNumber = 0;
      } else {
        sample.sampleNumber = previousSampleNumber + 1;
      }
      /**
      * Sample rate of accelerometer is 25Hz... when the accelCounter hits the relative sample rate of the accel
      *  we will output a new accel value. The approach will be to consider that Z should be about 1 and X and Y
      *  should be somewhere around 0.
      */


      if (accelCounter === samplesPerAccelRate) {
        // Initialize a new array
        var accelArray = [0, 0, 0]; // Calculate X

        accelArray[0] = Math.random() * 0.1 * (Math.random() > 0.5 ? -1 : 1); // Calculate Y

        accelArray[1] = Math.random() * 0.1 * (Math.random() > 0.5 ? -1 : 1); // Calculate Z, this is around 1

        accelArray[2] = 1 - Math.random() * 0.4 * (Math.random() > 0.5 ? -1 : 1); // Store the newly calculated value

        sample.auxData = accelArray; // Reset the counter

        accelCounter = 0;
      } else {
        // Increment counter
        accelCounter++; // Store the default value

        sample.auxData = auxData;
      }

      return sample;
    };
  },
  scaleFactorAux: SCALE_FACTOR_ACCEL,

  /**
   * Calculate the impedance
   * @param sample {Object} - Standard sample
   * @param impedanceTest {Object} - Impedance Object from openBCIBoard.js
   * @return {null | Object} - Null if not enough samples have passed to calculate an accurate
   */
  impedanceCalculateArray: function impedanceCalculateArray(sample, impedanceTest) {
    impedanceTest.buffer.push(sample.channelData);
    impedanceTest.count++;

    if (impedanceTest.count >= impedanceTest.window) {
      var output = [];

      for (var i = 0; i < sample.channelData.length; i++) {
        var max = 0.0; // sumSquared

        for (var j = 0; j < impedanceTest.window; j++) {
          if (impedanceTest.buffer[i][j] > max) {
            max = impedanceTest.buffer[i][j];
          }
        }

        var min = 0.0;

        for (var _j = 0; _j < impedanceTest.window; _j++) {
          if (impedanceTest.buffer[i][_j] < min) {
            min = impedanceTest.buffer[i][_j];
          }
        }

        var vP2P = max - min; // peak to peak

        output.push(vP2P / 2 / openbci_constants.OBCILeadOffDriveInAmps);
      }

      impedanceTest.count = 0;
      return output;
    }

    return null;
  },
  impedanceTestObjDefault: function impedanceTestObjDefault(impedanceTestObj) {
    var newObj = impedanceTestObj || {};
    newObj['active'] = false;
    newObj['buffer'] = [];
    newObj['count'] = 0;
    newObj['isTestingPInput'] = false;
    newObj['isTestingNInput'] = false;
    newObj['onChannel'] = 0;
    newObj['sampleNumber'] = 0;
    newObj['continuousMode'] = false;
    newObj['impedanceForChannel'] = 0;
    newObj['window'] = 40;
    return newObj;
  },
  samplePacket: function samplePacket(sampleNumber) {
    return new Uint8Array([0xA0, sampleNumberNormalize(sampleNumber), 0, 0, 1, 0, 0, 2, 0, 0, 3, 0, 0, 4, 0, 0, 5, 0, 0, 6, 0, 0, 7, 0, 0, 8, 0, 0, 0, 1, 0, 2, makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketStandardAccel)]);
  },
  samplePacketZero: function samplePacketZero(sampleNumber) {
    return new Uint8Array([0xA0, sampleNumberNormalize(sampleNumber), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketStandardAccel)]);
  },
  samplePacketReal: function samplePacketReal(sampleNumber) {
    return new Uint8Array([0xA0, sampleNumberNormalize(sampleNumber), 0x8F, 0xF2, 0x40, 0x8F, 0xDF, 0xF4, 0x90, 0x2B, 0xB6, 0x8F, 0xBF, 0xBF, 0x7F, 0xFF, 0xFF, 0x7F, 0xFF, 0xFF, 0x94, 0x25, 0x34, 0x20, 0xB6, 0x7D, 0, 0xE0, 0, 0xE0, 0x0F, 0x70, makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketStandardAccel)]);
  },
  samplePacketStandardRawAux: function samplePacketStandardRawAux(sampleNumber) {
    return new Uint8Array([0xA0, sampleNumberNormalize(sampleNumber), 0, 0, 1, 0, 0, 2, 0, 0, 3, 0, 0, 4, 0, 0, 5, 0, 0, 6, 0, 0, 7, 0, 0, 8, 0, 1, 2, 3, 4, 5, makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketStandardRawAux)]);
  },
  samplePacketAccelTimeSyncSet: function samplePacketAccelTimeSyncSet(sampleNumber) {
    return new Uint8Array([0xA0, sampleNumberNormalize(sampleNumber), 0, 0, 1, 0, 0, 2, 0, 0, 3, 0, 0, 4, 0, 0, 5, 0, 0, 6, 0, 0, 7, 0, 0, 8, 0, 1, 0, 0, 0, 1, makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketAccelTimeSyncSet)]);
  },
  samplePacketAccelTimeSynced: function samplePacketAccelTimeSynced(sampleNumber) {
    return new Uint8Array([0xA0, sampleNumberNormalize(sampleNumber), 0, 0, 1, 0, 0, 2, 0, 0, 3, 0, 0, 4, 0, 0, 5, 0, 0, 6, 0, 0, 7, 0, 0, 8, 0, 1, 0, 0, 0, 1, makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketAccelTimeSynced)]);
  },
  samplePacketRawAuxTimeSyncSet: function samplePacketRawAuxTimeSyncSet(sampleNumber) {
    return new Uint8Array([0xA0, sampleNumberNormalize(sampleNumber), 0, 0, 1, 0, 0, 2, 0, 0, 3, 0, 0, 4, 0, 0, 5, 0, 0, 6, 0, 0, 7, 0, 0, 8, 0x00, 0x01, 0, 0, 0, 1, makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketRawAuxTimeSyncSet)]);
  },
  samplePacketRawAuxTimeSynced: function samplePacketRawAuxTimeSynced(sampleNumber) {
    return new Uint8Array([0xA0, sampleNumberNormalize(sampleNumber), 0, 0, 1, 0, 0, 2, 0, 0, 3, 0, 0, 4, 0, 0, 5, 0, 0, 6, 0, 0, 7, 0, 0, 8, 0x00, 0x01, 0, 0, 0, 1, makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketRawAuxTimeSynced)]);
  },
  samplePacketImpedance: function samplePacketImpedance(channelNumber) {
    return new Uint8Array([0xA0, channelNumber, 54, 52, 49, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketImpedance)]);
  },
  samplePacketUserDefined: function samplePacketUserDefined() {
    return new Uint8Array([0xA0, 0x00, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketUserDefinedType)]);
  },
  samplePacketCytonBLE: function samplePacketCytonBLE(sampleNumber) {
    return new Uint8Array([0xC0, sampleNumberNormalize(sampleNumber), 0, 0, 1, 0, 0, 2, 0, 0, 10, 0, 0, 20, 0, 0, 100, 0, 0, 200]);
  },
  countADSPresent: countADSPresent,
  doesBufferHaveEOT: doesBufferHaveEOT,
  getBiasSetFromADSRegisterQuery: getBiasSetFromADSRegisterQuery,
  getBooleanFromRegisterQuery: getBooleanFromRegisterQuery,
  getChannelDataArray: getChannelDataArray,
  getChannelDataArrayNoScale: getChannelDataArrayNoScale,
  getDataArrayAccel: getDataArrayAccel,
  getDataArrayAccelNoScale: getDataArrayAccelNoScale,
  getFirmware: getFirmware,
  getSRB1FromADSRegisterQuery: getSRB1FromADSRegisterQuery,
  getNumFromThreeCSVADSRegisterQuery: getNumFromThreeCSVADSRegisterQuery,
  isEven: isEven,
  isFailureInBuffer: isFailureInBuffer,
  isOdd: isOdd,
  isStopByte: isStopByte,
  isSuccessInBuffer: isSuccessInBuffer,
  isTimeSyncSetConfirmationInBuffer: isTimeSyncSetConfirmationInBuffer,
  makeDaisySampleObject: makeDaisySampleObject,
  makeDaisySampleObjectWifi: makeDaisySampleObjectWifi,
  makeTailByteFromPacketType: makeTailByteFromPacketType,
  newSyncObject: newSyncObject,
  setChSetFromADSRegisterQuery: setChSetFromADSRegisterQuery,
  stripToEOTBuffer: stripToEOTBuffer,
  syncChannelSettingsWithRawData: syncChannelSettingsWithRawData,

  /**
  * @description Checks to make sure the previous sample number is one less
  *  then the new sample number. Takes into account sample numbers wrapping
  *  around at 255.
  * @param `previousSampleNumber` {Number} - An integer number of the previous
  *  sample number.
  * @param `newSampleNumber` {Number} - An integer number of the new sample
  *  number.
  * @returns {Array} - Returns null if there is no dropped packets, otherwise,
  *  or on a missed packet, an array of their packet numbers is returned.
  */
  droppedPacketCheck: function droppedPacketCheck(previousSampleNumber, newSampleNumber) {
    if (previousSampleNumber === openbci_constants.OBCISampleNumberMax && newSampleNumber === 0) {
      return null;
    }

    if (newSampleNumber - previousSampleNumber === 1) {
      return null;
    }

    var missedPacketArray = [];

    if (previousSampleNumber > newSampleNumber) {
      var numMised = openbci_constants.OBCISampleNumberMax - previousSampleNumber;

      for (var i = 0; i < numMised; i++) {
        missedPacketArray.push(previousSampleNumber + i + 1);
      }

      previousSampleNumber = -1;
    }

    for (var j = 1; j < newSampleNumber - previousSampleNumber; j++) {
      missedPacketArray.push(previousSampleNumber + j);
    }

    return missedPacketArray;
  },
  convert18bitAsInt32: convert18bitAsInt32,
  convert19bitAsInt32: convert19bitAsInt32,
  decompressDeltas18Bit: decompressDeltas18Bit,
  decompressDeltas19Bit: decompressDeltas19Bit,
  sampleCompressedData: function sampleCompressedData(sampleNumber) {
    return new Uint8Array([sampleNumber, // 0
    0, // 0
    0, // 1
    0, // 2
    0, // 3
    8, // 4
    0, // 5
    5, // 6
    0, // 7
    0, // 8
    72, // 9
    0, // 10
    9, // 11
    240, // 12
    1, // 13
    176, // 14
    0, // 15
    48, // 16
    0, // 17
    8 // 18
    ]);
  },
  sampleBLERaw: function sampleBLERaw() {
    return new Uint8Array([0, 0, 1, 0, 0, 2, 0, 0, 3, 0, 0, 4]);
  },
  sampleImpedanceChannel1: function sampleImpedanceChannel1() {
    return new Uint8Array([openbci_constants.OBCIGanglionByteIdImpedanceChannel1, 0, 0, 1]);
  },
  sampleImpedanceChannel2: function sampleImpedanceChannel2() {
    return new Uint8Array([openbci_constants.OBCIGanglionByteIdImpedanceChannel2, 0, 0, 1]);
  },
  sampleImpedanceChannel3: function sampleImpedanceChannel3() {
    return new Uint8Array([openbci_constants.OBCIGanglionByteIdImpedanceChannel3, 0, 0, 1]);
  },
  sampleImpedanceChannel4: function sampleImpedanceChannel4() {
    return new Uint8Array([openbci_constants.OBCIGanglionByteIdImpedanceChannel4, 0, 0, 1]);
  },
  sampleImpedanceChannelReference: function sampleImpedanceChannelReference() {
    return new Uint8Array([openbci_constants.OBCIGanglionByteIdImpedanceChannelReference, 0, 0, 1]);
  },
  sampleMultiBytePacket: function sampleMultiBytePacket(data) {
    var bufPre = new Uint8Array([openbci_constants.OBCIGanglionByteIdMultiPacket]);
    return Uint8Array.concat([bufPre, data]);
  },
  sampleMultiBytePacketStop: function sampleMultiBytePacketStop(data) {
    var bufPre = new Uint8Array([openbci_constants.OBCIGanglionByteIdMultiPacketStop]);
    return Uint8Array.concat([bufPre, data]);
  },
  sampleOtherData: function sampleOtherData(data) {
    var bufPre = new Uint8Array([255]);
    return Uint8Array.concat([bufPre, data]);
  },
  sampleUncompressedData: function sampleUncompressedData() {
    return new Uint8Array([0, // 0
    0, // 1
    0, // 2
    1, // 3
    0, // 4
    0, // 5
    2, // 6
    0, // 7
    0, // 8
    3, // 9
    0, // 10
    0, // 11
    4, // 12
    1, // 13
    2, // 14
    3, // 15
    4, // 16
    5, // 17
    6, // 18
    7 // 19
    ]);
  },
  parseGanglion: parseGanglion,
  processMultiBytePacket: utilities_processMultiBytePacket,
  processMultiBytePacketStop: utilities_processMultiBytePacketStop
};
/**
 * @description Used transform raw data packets into fully qualified packets
 * @param o {RawDataToSample} - Used to hold data and configuration settings
 * @return {Array} samples An array of {Sample}
 * @author AJ Keller (@aj-ptw)
 */

function parseGanglion(o) {
  var byteId = parseInt(o.rawDataPacket[0]);

  if (byteId <= openbci_constants.OBCIGanglionByteId19Bit.max) {
    return processRouteSampleData(o);
  } else {
    switch (byteId) {
      case openbci_constants.OBCIGanglionByteIdMultiPacket:
        return utilities_processMultiBytePacket(o);

      case openbci_constants.OBCIGanglionByteIdMultiPacketStop:
        return utilities_processMultiBytePacketStop(o);

      case openbci_constants.OBCIGanglionByteIdImpedanceChannel1:
      case openbci_constants.OBCIGanglionByteIdImpedanceChannel2:
      case openbci_constants.OBCIGanglionByteIdImpedanceChannel3:
      case openbci_constants.OBCIGanglionByteIdImpedanceChannel4:
      case openbci_constants.OBCIGanglionByteIdImpedanceChannelReference:
        return utilities_processImpedanceData(o);

      default:
        return null;
    }
  }
}
/**
 * Process an compressed packet of data.
 * @param o {RawDataToSample} - Used to hold data and configuration settings
 * @private
 */


function processCompressedData(o) {
  // Save the packet counter
  o.lastSampleNumber = parseInt(o.rawDataPacket[0]);
  var samples = []; // Decompress the buffer into array

  if (o.lastSampleNumber <= openbci_constants.OBCIGanglionByteId18Bit.max) {
    decompressSamples(o, decompressDeltas18Bit(o.rawDataPacket.slice(openbci_constants.OBCIGanglionPacket18Bit.dataStart, openbci_constants.OBCIGanglionPacket18Bit.dataStop)));
    samples.push(buildSample(o.lastSampleNumber * 2 - 1, o.decompressedSamples[1], o.sendCounts));
    samples.push(buildSample(o.lastSampleNumber * 2, o.decompressedSamples[2], o.sendCounts));

    switch (o.lastSampleNumber % 10) {
      case openbci_constants.OBCIGanglionAccelAxisX:
        o.accelArray[0] = o.sendCounts ? o.rawDataPacket.readInt8(openbci_constants.OBCIGanglionPacket18Bit.auxByte - 1) : o.rawDataPacket.readInt8(openbci_constants.OBCIGanglionPacket18Bit.auxByte - 1) * openbci_constants.OBCIGanglionAccelScaleFactor;
        break;

      case openbci_constants.OBCIGanglionAccelAxisY:
        o.accelArray[1] = o.sendCounts ? o.rawDataPacket.readInt8(openbci_constants.OBCIGanglionPacket18Bit.auxByte - 1) : o.rawDataPacket.readInt8(openbci_constants.OBCIGanglionPacket18Bit.auxByte - 1) * openbci_constants.OBCIGanglionAccelScaleFactor;
        break;

      case openbci_constants.OBCIGanglionAccelAxisZ:
        o.accelArray[2] = o.sendCounts ? o.rawDataPacket.readInt8(openbci_constants.OBCIGanglionPacket18Bit.auxByte - 1) : o.rawDataPacket.readInt8(openbci_constants.OBCIGanglionPacket18Bit.auxByte - 1) * openbci_constants.OBCIGanglionAccelScaleFactor;

        if (o.sendCounts) {
          samples[0].accelData = o.accelArray;
        } else {
          samples[0].accelDataCounts = o.accelArray;
        }

        break;

      default:
        break;
    }
  } else {
    decompressSamples(o, decompressDeltas19Bit(o.rawDataPacket.slice(openbci_constants.OBCIGanglionPacket19Bit.dataStart, openbci_constants.OBCIGanglionPacket19Bit.dataStop)));
    samples.push(buildSample((o.lastSampleNumber - 100) * 2 - 1, o.decompressedSamples[1], o.sendCounts));
    samples.push(buildSample((o.lastSampleNumber - 100) * 2, o.decompressedSamples[2], o.sendCounts));
  } // Rotate the 0 position for next time


  for (var i = 0; i < openbci_constants.OBCINumberOfChannelsGanglion; i++) {
    o.decompressedSamples[0][i] = o.decompressedSamples[2][i];
  }

  return samples;
}
/**
 * Process and emit an impedance value
 * @param o {RawDataToSample} - Used to hold data and configuration settings
 * @private
 */


function utilities_processImpedanceData(o) {
  var byteId = parseInt(o.rawDataPacket[0]);
  var channelNumber;

  switch (byteId) {
    case openbci_constants.OBCIGanglionByteIdImpedanceChannel1:
      channelNumber = 1;
      break;

    case openbci_constants.OBCIGanglionByteIdImpedanceChannel2:
      channelNumber = 2;
      break;

    case openbci_constants.OBCIGanglionByteIdImpedanceChannel3:
      channelNumber = 3;
      break;

    case openbci_constants.OBCIGanglionByteIdImpedanceChannel4:
      channelNumber = 4;
      break;

    case openbci_constants.OBCIGanglionByteIdImpedanceChannelReference:
      channelNumber = 0;
      break;
  }

  var output = {
    channelNumber: channelNumber,
    impedanceValue: 0
  };
  var end = o.rawDataPacket.length;

  while (Number.isNaN(Number(o.rawDataPacket.slice(1, end))) && end !== 0) {
    end--;
  }

  if (end !== 0) {
    output.impedanceValue = Number(o.rawDataPacket.slice(1, end));
  }

  return output;
}
/**
 * Used to stack multi packet buffers into the multi packet buffer. This is finally emitted when a stop packet byte id
 *  is received.
 * @param o {RawDataToSample} - Used to hold data and configuration settings
 * @private
 */


function utilities_processMultiBytePacket(o) {
  if (o.multiPacketBuffer) {
    o.multiPacketBuffer = Uint8Array.concat([Uint8Array.from(o.multiPacketBuffer), Uint8Array.from(o.rawDataPacket.slice(openbci_constants.OBCIGanglionPacket19Bit.dataStart, openbci_constants.OBCIGanglionPacket19Bit.dataStop))]);
  } else {
    o.multiPacketBuffer = o.rawDataPacket.slice(openbci_constants.OBCIGanglionPacket19Bit.dataStart, openbci_constants.OBCIGanglionPacket19Bit.dataStop);
  }
}
/**
 * Adds the `data` buffer to the multi packet buffer and emits the buffer as 'message'
 * @param o {RawDataToSample} - Used to hold data and configuration settings
 * @private
 */


function utilities_processMultiBytePacketStop(o) {
  utilities_processMultiBytePacket(o);
  var str = o.multiPacketBuffer.toString();
  o.multiPacketBuffer = null;
  return {
    'message': str
  };
}
/**
 * Utilize `receivedDeltas` to get actual count values.
 * @param receivedDeltas {Array} - An array of deltas
 *  of shape 2x4 (2 samples per packet and 4 channels per sample.)
 * @private
 */


function decompressSamples(o, receivedDeltas) {
  // add the delta to the previous value
  for (var i = 1; i < 3; i++) {
    for (var j = 0; j < 4; j++) {
      o.decompressedSamples[i][j] = o.decompressedSamples[i - 1][j] - receivedDeltas[i - 1][j];
    }
  }
}
/**
 * Builds a sample object from an array and sample number.
 * @param o {RawDataToSample} - Used to hold data and configuration settings
 * @return {Array}
 * @private
 */


function buildSample(sampleNumber, rawData, sendCounts) {
  var sample;

  if (sendCounts) {
    sample = newSampleNoScale(sampleNumber);
    sample.channelDataCounts = rawData;
  } else {
    sample = newSample(sampleNumber);

    for (var j = 0; j < openbci_constants.OBCINumberOfChannelsGanglion; j++) {
      sample.channelData.push(rawData[j] * openbci_constants.OBCIGanglionScaleFactorPerCountVolts);
    }
  }

  sample.timestamp = Date.now();
  return sample;
}
/**
 * Used to route samples for Ganglion
 * @param o {RawDataToSample} - Used to hold data and configuration settings
 * @returns {*}
 */


function processRouteSampleData(o) {
  if (parseInt(o.rawDataPacket[0]) === openbci_constants.OBCIGanglionByteIdUncompressed) {
    return processUncompressedData(o);
  } else {
    return processCompressedData(o);
  }
}
/**
 * Process an uncompressed packet of data.
 * @param o {RawDataToSample} - Used to hold data and configuration settings
 * @private
 */

function processUncompressedData(o) {
  // Resets the packet counter back to zero
  o.lastSampleNumber = openbci_constants.OBCIGanglionByteIdUncompressed; // used to find dropped packets

  for (var i = 0; i < 4; i++) {
    o.decompressedSamples[0][i] = utilitiesModule.interpret24bitAsInt32(o.rawDataPacket.slice(1 + i * 3, 1 + i * 3 + 3)); // seed the decompressor
  }

  return [buildSample(0, o.decompressedSamples[0], o.sendCounts)];
}
/**
 * Converts a special ganglion 18 bit compressed number
 *  The compressions uses the LSB, bit 1, as the signed bit, instead of using
 *  the MSB. Therefore you must not look to the MSB for a sign extension, one
 *  must look to the LSB, and the same rules applies, if it's a 1, then it's a
 *  negative and if it's 0 then it's a positive number.
 * @param threeByteBuffer {Uint8Array}
 *  A 3-byte buffer with only 18 bits of actual data.
 * @return {number} A signed integer.
 */


function convert18bitAsInt32(threeByteBuffer) {
  var prefix = 0;

  if (threeByteBuffer[2] & 0x01 > 0) {
    // console.log('\t\tNegative number')
    prefix = 16383;
  }

  return prefix << 18 | threeByteBuffer[0] << 16 | threeByteBuffer[1] << 8 | threeByteBuffer[2];
}
/**
 * Converts a special ganglion 19 bit compressed number
 *  The compressions uses the LSB, bit 1, as the signed bit, instead of using
 *  the MSB. Therefore you must not look to the MSB for a sign extension, one
 *  must look to the LSB, and the same rules applies, if it's a 1, then it's a
 *  negative and if it's 0 then it's a positive number.
 * @param threeByteBuffer {Uint8Array}
 *  A 3-byte buffer with only 19 bits of actual data.
 * @return {number} A signed integer.
 */


function convert19bitAsInt32(threeByteBuffer) {
  var prefix = 0;

  if (threeByteBuffer[2] & 0x01 > 0) {
    // console.log('\t\tNegative number')
    prefix = 8191;
  }

  return prefix << 19 | threeByteBuffer[0] << 16 | threeByteBuffer[1] << 8 | threeByteBuffer[2];
}
/**
 * Called to when a compressed packet is received.
 * @param buffer {Uint8Array} Just the data portion of the sample. So 18 bytes.
 * @return {Array} - An array of deltas of shape 2x4 (2 samples per packet
 *  and 4 channels per sample.)
 * @private
 */


function decompressDeltas18Bit(buffer) {
  var D = new Array(openbci_constants.OBCIGanglionSamplesPerPacket); // 2

  D[0] = [0, 0, 0, 0];
  D[1] = [0, 0, 0, 0];
  var receivedDeltas = [];

  for (var i = 0; i < openbci_constants.OBCIGanglionSamplesPerPacket; i++) {
    receivedDeltas.push([0, 0, 0, 0]);
  }

  var miniBuf; // Sample 1 - Channel 1

  miniBuf = new Uint8Array([buffer[0] >> 6, (buffer[0] & 0x3F) << 2 | buffer[1] >> 6, (buffer[1] & 0x3F) << 2 | buffer[2] >> 6]);
  receivedDeltas[0][0] = convert18bitAsInt32(miniBuf); // Sample 1 - Channel 2

  miniBuf = new Uint8Array([(buffer[2] & 0x3F) >> 4, buffer[2] << 4 | buffer[3] >> 4, buffer[3] << 4 | buffer[4] >> 4]); // miniBuf = new Uint8Array([(buffer[2] & 0x1F), buffer[3], buffer[4] >> 2]);

  receivedDeltas[0][1] = convert18bitAsInt32(miniBuf); // Sample 1 - Channel 3

  miniBuf = new Uint8Array([(buffer[4] & 0x0F) >> 2, buffer[4] << 6 | buffer[5] >> 2, buffer[5] << 6 | buffer[6] >> 2]);
  receivedDeltas[0][2] = convert18bitAsInt32(miniBuf); // Sample 1 - Channel 4

  miniBuf = new Uint8Array([buffer[6] & 0x03, buffer[7], buffer[8]]);
  receivedDeltas[0][3] = convert18bitAsInt32(miniBuf); // Sample 2 - Channel 1

  miniBuf = new Uint8Array([buffer[9] >> 6, (buffer[9] & 0x3F) << 2 | buffer[10] >> 6, (buffer[10] & 0x3F) << 2 | buffer[11] >> 6]);
  receivedDeltas[1][0] = convert18bitAsInt32(miniBuf); // Sample 2 - Channel 2

  miniBuf = new Uint8Array([(buffer[11] & 0x3F) >> 4, buffer[11] << 4 | buffer[12] >> 4, buffer[12] << 4 | buffer[13] >> 4]);
  receivedDeltas[1][1] = convert18bitAsInt32(miniBuf); // Sample 2 - Channel 3

  miniBuf = new Uint8Array([(buffer[13] & 0x0F) >> 2, buffer[13] << 6 | buffer[14] >> 2, buffer[14] << 6 | buffer[15] >> 2]);
  receivedDeltas[1][2] = convert18bitAsInt32(miniBuf); // Sample 2 - Channel 4

  miniBuf = new Uint8Array([buffer[15] & 0x03, buffer[16], buffer[17]]);
  receivedDeltas[1][3] = convert18bitAsInt32(miniBuf);
  return receivedDeltas;
}
/**
 * Called to when a compressed packet is received.
 * @param buffer {Uint8Array} Just the data portion of the sample. So 19 bytes.
 * @return {Array} - An array of deltas of shape 2x4 (2 samples per packet
 *  and 4 channels per sample.)
 * @private
 */


function decompressDeltas19Bit(buffer) {
  var D = new Array(openbci_constants.OBCIGanglionSamplesPerPacket); // 2

  D[0] = [0, 0, 0, 0];
  D[1] = [0, 0, 0, 0];
  var receivedDeltas = [];

  for (var i = 0; i < openbci_constants.OBCIGanglionSamplesPerPacket; i++) {
    receivedDeltas.push([0, 0, 0, 0]);
  }

  var miniBuf; // Sample 1 - Channel 1

  miniBuf = new Uint8Array([buffer[0] >> 5, (buffer[0] & 0x1F) << 3 | buffer[1] >> 5, (buffer[1] & 0x1F) << 3 | buffer[2] >> 5]);
  receivedDeltas[0][0] = convert19bitAsInt32(miniBuf); // Sample 1 - Channel 2

  miniBuf = new Uint8Array([(buffer[2] & 0x1F) >> 2, buffer[2] << 6 | buffer[3] >> 2, buffer[3] << 6 | buffer[4] >> 2]); // miniBuf = new Uint8Array([(buffer[2] & 0x1F), buffer[3], buffer[4] >> 2]);

  receivedDeltas[0][1] = convert19bitAsInt32(miniBuf); // Sample 1 - Channel 3

  miniBuf = new Uint8Array([(buffer[4] & 0x03) << 1 | buffer[5] >> 7, (buffer[5] & 0x7F) << 1 | buffer[6] >> 7, (buffer[6] & 0x7F) << 1 | buffer[7] >> 7]);
  receivedDeltas[0][2] = convert19bitAsInt32(miniBuf); // Sample 1 - Channel 4

  miniBuf = new Uint8Array([(buffer[7] & 0x7F) >> 4, (buffer[7] & 0x0F) << 4 | buffer[8] >> 4, (buffer[8] & 0x0F) << 4 | buffer[9] >> 4]);
  receivedDeltas[0][3] = convert19bitAsInt32(miniBuf); // Sample 2 - Channel 1

  miniBuf = new Uint8Array([(buffer[9] & 0x0F) >> 1, buffer[9] << 7 | buffer[10] >> 1, buffer[10] << 7 | buffer[11] >> 1]);
  receivedDeltas[1][0] = convert19bitAsInt32(miniBuf); // Sample 2 - Channel 2

  miniBuf = new Uint8Array([(buffer[11] & 0x01) << 2 | buffer[12] >> 6, buffer[12] << 2 | buffer[13] >> 6, buffer[13] << 2 | buffer[14] >> 6]);
  receivedDeltas[1][1] = convert19bitAsInt32(miniBuf); // Sample 2 - Channel 3

  miniBuf = new Uint8Array([(buffer[14] & 0x38) >> 3, (buffer[14] & 0x07) << 5 | (buffer[15] & 0xF8) >> 3, (buffer[15] & 0x07) << 5 | (buffer[16] & 0xF8) >> 3]);
  receivedDeltas[1][2] = convert19bitAsInt32(miniBuf); // Sample 2 - Channel 4

  miniBuf = new Uint8Array([buffer[16] & 0x07, buffer[17], buffer[18]]);
  receivedDeltas[1][3] = convert19bitAsInt32(miniBuf);
  return receivedDeltas;
}

function newImpedanceObject(channelNumber) {
  return {
    channel: channelNumber,
    P: {
      raw: -1,
      text: openbci_constants.OBCIImpedanceTextInit
    },
    N: {
      raw: -1,
      text: openbci_constants.OBCIImpedanceTextInit
    }
  };
}

function newSyncObject() {
  return {
    boardTime: 0,
    correctedTransmissionTime: false,
    error: null,
    timeSyncSent: 0,
    timeSyncSentConfirmation: 0,
    timeSyncSetPacket: 0,
    timeRoundTrip: 0,
    timeTransmission: 0,
    timeOffset: 0,
    timeOffsetMaster: 0,
    valid: false
  };
}
/**
 * @description Used transform raw data packets into fully qualified packets
 * @param o {RawDataToSample} - Used to hold data and configuration settings
 * @return {Array} samples An array of {Sample}
 * @author AJ Keller (@aj-ptw)
 */


function transformRawDataPacketsToSample(o) {
  var samples = [];

  for (var i = 0; i < o.rawDataPackets.length; i++) {
    o.rawDataPacket = o.rawDataPackets[i];
    var sample = transformRawDataPacketToSample(o);
    samples.push(sample);

    if (sample.hasOwnProperty('sampleNumber')) {
      o['lastSampleNumber'] = sample.sampleNumber;
    } else if (!sample.hasOwnProperty('impedanceValue')) {
      o['lastSampleNumber'] = o.rawDataPacket[openbci_constants.OBCIPacketPositionSampleNumber];
    }
  }

  return samples;
}
/**
 * @description Used transform raw data packets into fully qualified packets
 * @param o {RawDataToSample} - Used to hold data and configuration settings
 * @return {Array} samples An array of {Sample}
 * @author AJ Keller (@aj-ptw)
 */


function transformRawDataPacketToSample(o) {
  var sample;

  try {
    var packetType = getRawPacketType(o.rawDataPacket[openbci_constants.OBCIPacketPositionStopByte]);

    switch (packetType) {
      case openbci_constants.OBCIStreamPacketStandardAccel:
        sample = utilitiesModule.parsePacketStandardAccel(o);
        break;

      case openbci_constants.OBCIStreamPacketStandardRawAux:
        sample = utilitiesModule.parsePacketStandardRawAux(o);
        break;

      case openbci_constants.OBCIStreamPacketAccelTimeSyncSet:
      case openbci_constants.OBCIStreamPacketAccelTimeSynced:
        sample = utilitiesModule.parsePacketTimeSyncedAccel(o);
        break;

      case openbci_constants.OBCIStreamPacketRawAuxTimeSyncSet:
      case openbci_constants.OBCIStreamPacketRawAuxTimeSynced:
        sample = utilitiesModule.parsePacketTimeSyncedRawAux(o);
        break;

      case openbci_constants.OBCIStreamPacketImpedance:
        sample = utilitiesModule.parsePacketImpedance(o);
        break;

      default:
        // Don't do anything if the packet is not defined
        sample = {
          error: "bad stop byte ".concat(o.rawDataPacket.slice(32, 33).toString('hex')),
          valid: false,
          rawDataPacket: o.rawDataPacket
        };
        if (o.verbose) console.log(sample.error);
        break;
    }
  } catch (err) {
    sample = {
      error: err,
      valid: false,
      rawDataPacket: o.rawDataPacket
    };
    if (o.verbose) console.log(err);
  }

  return sample;
}
/**
 * Used to convert a ganglions decompressed back into a buffer
 * @param arr {Array} - An array of four numbers
 * @param data {Uint8Array} - A buffer to store into
 */


function convertGanglionArrayToBuffer(arr, data) {
  for (var i = 0; i < openbci_constants.OBCINumberOfChannelsGanglion; i++) {
    data.writeInt16BE(arr[i] >> 8, i * 3);
    data.writeInt8(arr[i] & 255, i * 3 + 2);
  }
}
/**
 * @description This function takes a raw data buffer of 4 3-byte signed integers for ganglion
 * @param o {Object} - The input object
 * @param o.data {Uint8Array} - An allocated and filled buffer of length 12
 * @param o.rawDataPacket {Uint8Array} - An allocated buffer of length 33
 * @param o.sampleNumber {Number} - The sample number to load into the `rawDataPacket`
 */


function ganglionFillRawDataPacket(o) {
  // Check to make sure data is not null.
  if (openbci_constants.isUndefined(o) || openbci_constants.isUndefined(o.rawDataPacket) || openbci_constants.isNull(o.rawDataPacket) || openbci_constants.isUndefined(o.data) || openbci_constants.isNull(o.data)) throw new Error(openbci_constants.OBCIErrorUndefinedOrNullInput); // Check to make sure sampleNumber is inside object

  if (!o.hasOwnProperty('sampleNumber')) throw new Error(openbci_constants.OBCIErrorUndefinedOrNullInput); // Check to make sure the rawDataPacket buffer is the right size.

  if (o.rawDataPacket.byteLength !== openbci_constants.OBCIPacketSize) throw new Error(openbci_constants.OBCIErrorInvalidByteLength); // Check to make sure the rawDataPacket buffer is the right size.

  if (o.data.byteLength !== openbci_constants.OBCIPacketSizeBLERaw) throw new Error(openbci_constants.OBCIErrorInvalidByteLength);
  o.data.copy(o.rawDataPacket, openbci_constants.OBCIPacketPositionChannelDataStart);
  o.rawDataPacket[openbci_constants.OBCIPacketPositionSampleNumber] = o.sampleNumber;
  o.rawDataPacket[openbci_constants.OBCIPacketPositionStartByte] = openbci_constants.OBCIByteStart;
  o.rawDataPacket[openbci_constants.OBCIPacketPositionStopByte] = openbci_constants.OBCIStreamPacketStandardRawAux;
}
/**
 * @description This method parses a 33 byte OpenBCI V3 packet and converts to a sample object
 * @param o {Object} - The input object
 * @param o.rawDataPacket {Uint8Array} - The 33byte raw packet
 * @param o.channelSettings {Array} - An array of channel settings that is an Array that has shape similar to the one
 *                  calling k.channelSettingsArrayInit(). The most important rule here is that it is
 *                  Array of objects that have key-value pair {gain:NUMBER}
 * @param o.scale {Boolean} - Do you want to scale the results? Default true
 * @param o.lastSampleNumber {Number} - The last sample number
 * @returns {Sample} - A sample object. NOTE: Only has accelData if this is a Z axis packet.
 */


function parsePacketStandardAccel(o) {
  // Check to make sure data is not null.
  if (openbci_constants.isUndefined(o) || openbci_constants.isUndefined(o.rawDataPacket) || openbci_constants.isNull(o.rawDataPacket)) throw new Error(openbci_constants.OBCIErrorUndefinedOrNullInput); // Check to make sure the buffer is the right size.

  if (o.rawDataPacket.byteLength !== openbci_constants.OBCIPacketSize) throw new Error(openbci_constants.OBCIErrorInvalidByteLength); // Verify the correct stop byte.

  if (o.rawDataPacket[0] !== openbci_constants.OBCIByteStart) throw new Error(openbci_constants.OBCIErrorInvalidByteStart);
  var sampleObject = {};
  if (openbci_constants.isUndefined(o.scale) || openbci_constants.isNull(o.scale)) o.scale = true;
  if (o.scale) sampleObject.accelData = getDataArrayAccel(o.rawDataPacket.slice(openbci_constants.OBCIPacketPositionStartAux, openbci_constants.OBCIPacketPositionStopAux + 1));else sampleObject.accelDataCounts = getDataArrayAccelNoScale(o.rawDataPacket.slice(openbci_constants.OBCIPacketPositionStartAux, openbci_constants.OBCIPacketPositionStopAux + 1));
  if (o.scale) sampleObject.channelData = getChannelDataArray(o);else sampleObject.channelDataCounts = getChannelDataArrayNoScale(o);
  sampleObject.auxData = Uint8Array.from(o.rawDataPacket.slice(openbci_constants.OBCIPacketPositionStartAux, openbci_constants.OBCIPacketPositionStopAux + 1)); // Get the sample number

  sampleObject.sampleNumber = o.rawDataPacket[openbci_constants.OBCIPacketPositionSampleNumber]; // Get the start byte

  sampleObject.startByte = o.rawDataPacket[0]; // Get the stop byte

  sampleObject.stopByte = o.rawDataPacket[openbci_constants.OBCIPacketPositionStopByte];
  sampleObject.valid = true;
  sampleObject.timestamp = Date.now();
  sampleObject.boardTime = 0;
  return sampleObject;
}
/**
 * @description This method parses a 33 byte OpenBCI V3 packet and converts to a sample object
 * @param o {Object} - The input object
 * @param o.rawDataPacket {Uint8Array} - The 33byte raw packet
 * @param o.channelSettings {Array} - An array of channel settings that is an Array that has shape similar to the one
 *                  calling k.channelSettingsArrayInit(). The most important rule here is that it is
 *                  Array of objects that have key-value pair {gain:NUMBER}
 * @param o.scale {Boolean} - Do you want to scale the results? Default is true
 * @param o.lastSampleNumber {Number} - The last sample number
 * @returns {Sample} - A sample object. NOTE: Only has accelData if this is a Z axis packet.
 */


function parsePacketStandardRawAux(o) {
  // Check to make sure data is not null.
  if (openbci_constants.isUndefined(o) || openbci_constants.isUndefined(o.rawDataPacket) || openbci_constants.isNull(o.rawDataPacket)) throw new Error(openbci_constants.OBCIErrorUndefinedOrNullInput); // Check to make sure the buffer is the right size.

  if (o.rawDataPacket.byteLength !== openbci_constants.OBCIPacketSize) throw new Error(openbci_constants.OBCIErrorInvalidByteLength); // Verify the correct stop byte.

  if (o.rawDataPacket[0] !== openbci_constants.OBCIByteStart) throw new Error(openbci_constants.OBCIErrorInvalidByteStart);
  var sampleObject = {}; // Store the channel data

  if (openbci_constants.isUndefined(o.scale) || openbci_constants.isNull(o.scale)) o.scale = true;
  if (o.scale) sampleObject.channelData = getChannelDataArray(o);else sampleObject.channelDataCounts = getChannelDataArrayNoScale(o); // Slice the buffer for the aux data

  sampleObject.auxData = Uint8Array.from(o.rawDataPacket.slice(openbci_constants.OBCIPacketPositionStartAux, openbci_constants.OBCIPacketPositionStopAux + 1)); // Get the sample number

  sampleObject.sampleNumber = o.rawDataPacket[openbci_constants.OBCIPacketPositionSampleNumber]; // Get the start byte

  sampleObject.startByte = o.rawDataPacket[0]; // Get the stop byte

  sampleObject.stopByte = o.rawDataPacket[openbci_constants.OBCIPacketPositionStopByte];
  sampleObject.valid = true;
  sampleObject.timestamp = Date.now();
  sampleObject.boardTime = 0;
  return sampleObject;
}
/**
 * @description Grabs an accel value from a raw but time synced packet. Important that this utilizes the fact that:
 *      X axis data is sent with every sampleNumber % 10 === 0
 *      Y axis data is sent with every sampleNumber % 10 === 1
 *      Z axis data is sent with every sampleNumber % 10 === 2
 * @param o {Object} - The input object
 * @param o.rawDataPacket {Uint8Array} - The 33byte raw time synced accel packet
 * @param o.channelSettings {Array} - An array of channel settings that is an Array that has shape similar to the one
 *                  calling OpenBCIConstans.channelSettingsArrayInit(). The most important rule here is that it is
 *                  Array of objects that have key-value pair {gain:NUMBER}
 * @param o.timeOffset {Number} - The difference between board time and current time calculated with sync methods.
 * @param o.accelArray {Array} - A 3 element array that allows us to have inter packet memory of x and y axis data and emit only on the z axis packets.
 * @param o.scale {Boolean} - Do you want to scale the results? Default is true
 * @returns {Sample} - A sample object. NOTE: Only has accelData if this is a Z axis packet.
 */


function parsePacketTimeSyncedAccel(o) {
  // Ths packet has 'A0','00'....,'AA','AA','FF','FF','FF','FF','C4'
  //  where the 'AA's form an accel 16bit num and 'FF's form a 32 bit time in ms
  // The sample object we are going to build
  // Check to make sure data is not null.
  if (openbci_constants.isUndefined(o) || openbci_constants.isUndefined(o.rawDataPacket) || openbci_constants.isNull(o.rawDataPacket)) throw new Error(openbci_constants.OBCIErrorUndefinedOrNullInput); // Check to make sure the buffer is the right size.

  if (o.rawDataPacket.byteLength !== openbci_constants.OBCIPacketSize) throw new Error(openbci_constants.OBCIErrorInvalidByteLength); // Verify the correct stop byte.

  if (o.rawDataPacket[0] !== openbci_constants.OBCIByteStart) throw new Error(openbci_constants.OBCIErrorInvalidByteStart);
  var sampleObject = {}; // Get the sample number

  sampleObject.sampleNumber = o.rawDataPacket[openbci_constants.OBCIPacketPositionSampleNumber]; // Get the start byte

  sampleObject.startByte = o.rawDataPacket[0]; // Get the stop byte

  sampleObject.stopByte = o.rawDataPacket[openbci_constants.OBCIPacketPositionStopByte]; // Get the board time

  sampleObject.boardTime = getFromTimePacketTime(o.rawDataPacket);

  if (o.hasOwnProperty('timeOffset')) {
    sampleObject.timestamp = sampleObject.boardTime + o.timeOffset;
  } else {
    sampleObject.timestamp = Date.now();
  } // Extract the aux data


  sampleObject.auxData = getFromTimePacketRawAux(o.rawDataPacket);
  if (openbci_constants.isUndefined(o.scale) || openbci_constants.isNull(o.scale)) o.scale = true;
  if (o.scale) sampleObject.channelData = getChannelDataArray(o);else sampleObject.channelDataCounts = getChannelDataArrayNoScale(o); // Grab the accelData only if `getFromTimePacketAccel` returns true.

  if (getFromTimePacketAccel(o)) {
    if (o.scale) sampleObject.accelData = o.accelArray;else sampleObject.accelDataCounts = o.accelArray;
  }

  sampleObject.valid = true;
  return sampleObject;
}
/**
 * @description Raw aux
 * @param o {Object} - The input object
 * @param o.rawDataPacket {Uint8Array} - The 33byte raw time synced accel packet
 * @param o.channelSettings {Array} - An array of channel settings that is an Array that has shape similar to the one
 *                  calling k.channelSettingsArrayInit(). The most important rule here is that it is
 *                  Array of objects that have key-value pair {gain:NUMBER}
 * @param o.timeOffset {Number} - The difference between board time and current time calculated with sync methods.
 * @param o.scale {Boolean} - Do you want to scale the results? Default is true
 * @param o.lastSampleNumber {Number} - The last sample number
 * @returns {Sample} - A sample object. NOTE: The aux data is placed in a 2 byte buffer
 */


function parsePacketTimeSyncedRawAux(o) {
  // Ths packet has 'A0','00'....,'AA','AA','FF','FF','FF','FF','C4'
  //  where the 'AA's form an accel 16bit num and 'FF's form a 32 bit time in ms
  // Check to make sure data is not null.
  if (openbci_constants.isUndefined(o) || openbci_constants.isUndefined(o.rawDataPacket) || openbci_constants.isNull(o.rawDataPacket)) throw new Error(openbci_constants.OBCIErrorUndefinedOrNullInput); // Check to make sure the buffer is the right size.

  if (o.rawDataPacket.byteLength !== openbci_constants.OBCIPacketSize) throw new Error(openbci_constants.OBCIErrorInvalidByteLength); // Verify the correct stop byte.

  if (o.rawDataPacket[0] !== openbci_constants.OBCIByteStart) throw new Error(openbci_constants.OBCIErrorInvalidByteStart); // The sample object we are going to build

  var sampleObject = {}; // Get the sample number

  sampleObject.sampleNumber = o.rawDataPacket[openbci_constants.OBCIPacketPositionSampleNumber]; // Get the start byte

  sampleObject.startByte = o.rawDataPacket[0]; // Get the stop byte

  sampleObject.stopByte = o.rawDataPacket[openbci_constants.OBCIPacketPositionStopByte]; // Get the board time

  sampleObject.boardTime = getFromTimePacketTime(o.rawDataPacket);

  if (o.hasOwnProperty('timeOffset')) {
    sampleObject.timestamp = sampleObject.boardTime + o.timeOffset;
  } else {
    sampleObject.timestamp = Date.now();
  } // Extract the aux data


  sampleObject.auxData = getFromTimePacketRawAux(o.rawDataPacket); // Grab the channel data.

  if (openbci_constants.isUndefined(o.scale) || openbci_constants.isNull(o.scale)) o.scale = true;
  if (o.scale) sampleObject.channelData = getChannelDataArray(o);else sampleObject.channelDataCounts = getChannelDataArrayNoScale(o);
  sampleObject.valid = true;
  return sampleObject;
}
/**
 * @description Raw aux
 * @param o {Object} - The input object
 * @param o.rawDataPacket {Uint8Array} - The 33byte raw time synced accel packet
 * @returns {Impedance} - An impedance object.
 */


function parsePacketImpedance(o) {
  // Ths packet has 'A0','00'....,'AA','AA','FF','FF','FF','FF','C4'
  //  where the 'AA's form an accel 16bit num and 'FF's form a 32 bit time in ms
  // Check to make sure data is not null.
  if (openbci_constants.isUndefined(o) || openbci_constants.isUndefined(o.rawDataPacket) || openbci_constants.isNull(o.rawDataPacket)) throw new Error(openbci_constants.OBCIErrorUndefinedOrNullInput); // Check to make sure the buffer is the right size.

  if (o.rawDataPacket.byteLength !== openbci_constants.OBCIPacketSize) throw new Error(openbci_constants.OBCIErrorInvalidByteLength);
  var impedanceObject = {};
  impedanceObject.channelNumber = o.rawDataPacket[1];

  if (impedanceObject.channelNumber === 5) {
    impedanceObject.channelNumber = 0;
  }

  impedanceObject.impedanceValue = Number(o.rawDataPacket.toString().match(/\d+/)[0]);
  return impedanceObject;
}
/**
 * Use reg ex to parse a `str` register query for a boolean `offset` from index. Throws errors
 * @param str {String} - The string to search
 * @param regEx {RegExp} - The key to match to
 * @param offset {Number} - The number of bytes to offset from the index of the reg ex hit
 * @returns {boolean} The converted and parsed value from `str`
 */


function getBooleanFromRegisterQuery(str, regEx, offset) {
  var regExArr = str.match(regEx);

  if (regExArr) {
    var num = parseInt(str.charAt(regExArr.index + offset));

    if (!Number.isNaN(num)) {
      return Boolean(num);
    } else {
      throw new Error(openbci_constants.OBCIErrorInvalidData);
    }
  } else {
    throw new Error(openbci_constants.OBCIErrorMissingRegisterSetting);
  }
}
/**
 * Used to get the truth value fo srb1 within the system
 * @param str {String} - The raw query data
 * @returns {boolean}
 */


function getSRB1FromADSRegisterQuery(str) {
  return getBooleanFromRegisterQuery(str, openbci_constants.OBCIRegisterQueryNameMISC1, 21);
}
/**
 * Used to get bias setting from raw query
 * @param str {String} - The raw query data
 * @param channelNumber {Number} - Zero indexed, please send `channelNumber` directly to this function.
 * @returns {boolean}
 */


function getBiasSetFromADSRegisterQuery(str, channelNumber) {
  return getBooleanFromRegisterQuery(str, openbci_constants.OBCIRegisterQueryNameBIASSENSP, 20 + channelNumber * 3);
}
/**
 * Used to get a number from the raw query data
 * @param str {String} - The raw query data
 * @param regEx {RegExp} - The regular expression to index off of
 * @param offset {Number} - The number of bytes offset from index to start
 */


function getNumFromThreeCSVADSRegisterQuery(str, regEx, offset) {
  var regExArr = str.match(regEx);

  if (regExArr) {
    var bit2 = parseInt(str.charAt(regExArr.index + offset));
    var bit1 = parseInt(str.charAt(regExArr.index + offset + 3));
    var bit0 = parseInt(str.charAt(regExArr.index + offset + 6));

    if (!Number.isNaN(bit2) && !Number.isNaN(bit1) && !Number.isNaN(bit0)) {
      return bit2 << 2 | bit1 << 1 | bit0;
    } else {
      throw new Error(openbci_constants.OBCIErrorInvalidData);
    }
  } else {
    throw new Error(openbci_constants.OBCIErrorMissingRegisterSetting);
  }
}
/**
 * Used to get bias setting from raw query
 * @param str {String} - The raw query data
 * @param channelSettings {ChannelSettingsObject} - Just your standard channel setting object
 * @returns {boolean}
 */


function setChSetFromADSRegisterQuery(str, channelSettings) {
  var key = openbci_constants.OBCIRegisterQueryNameCHnSET[channelSettings.channelNumber];
  if (key === undefined) key = openbci_constants.OBCIRegisterQueryNameCHnSET[channelSettings.channelNumber - openbci_constants.OBCINumberOfChannelsCyton];
  channelSettings.powerDown = getBooleanFromRegisterQuery(str, key, 16);
  channelSettings.gain = openbci_constants.gainForCommand(getNumFromThreeCSVADSRegisterQuery(str, key, 19));
  channelSettings.inputType = openbci_constants.inputTypeForCommand(getNumFromThreeCSVADSRegisterQuery(str, key, 31));
  channelSettings.srb2 = getBooleanFromRegisterQuery(str, key, 28);
}
/**
 *
 * @param o {Object}
 * @param o.channelSettings {Array} - The standard channel settings object
 * @param o.data {Uint8Array} - The buffer of raw query data
 */


function syncChannelSettingsWithRawData(o) {
  // Check to make sure data is not null.
  if (openbci_constants.isUndefined(o) || openbci_constants.isUndefined(o.channelSettings) || openbci_constants.isNull(o.channelSettings) || openbci_constants.isUndefined(o.data) || openbci_constants.isNull(o.data)) throw new Error(openbci_constants.OBCIErrorUndefinedOrNullInput); // Check to make sure channel settings is array

  if (!Array.isArray(o.channelSettings)) throw new Error("".concat(openbci_constants.OBCIErrorInvalidType, " channelSettings")); // Check to make sure the rawDataPacket buffer is the right size.

  if (o.channelSettings.length === openbci_constants.OBCINumberOfChannelsCyton) {
    if (o.data.toString().match(/Daisy ADS/)) throw new Error('raw data mismatch - expected only cyton register info but also found daisy');
    if (o.data.toString().match(/Board ADS/) == null) throw new Error(openbci_constants.OBCIErrorInvalidData);
  } else {
    if (o.data.toString().match(/Daisy ADS/) == null) throw new Error('raw data mismatch - expected daisy register info but none found');
    if (o.data.toString().match(/Board ADS/) == null) throw new Error('no Board ADS info found');
  }

  o.channelSettings.forEach(function (cs) {
    if (!cs.hasOwnProperty('channelNumber') || !cs.hasOwnProperty('powerDown') || !cs.hasOwnProperty('gain') || !cs.hasOwnProperty('inputType') || !cs.hasOwnProperty('bias') || !cs.hasOwnProperty('srb2') || !cs.hasOwnProperty('srb1')) {
      throw new Error(openbci_constants.OBCIErrorMissingRequiredProperty);
    }
  });
  var adsDaisy = null;
  var usingSRB1Cyton = false;
  var usingSRB1Daisy = false;
  var regExArr = o.data.toString().match(/Board ADS/);
  var adsCyton = o.data.toString().slice(regExArr.index, openbci_constants.OBCIRegisterQueryCyton.length);

  if (getSRB1FromADSRegisterQuery(adsCyton)) {
    usingSRB1Cyton = true;
  }

  if (o.channelSettings.length > openbci_constants.OBCINumberOfChannelsCyton) {
    var regExArrDaisy = o.data.toString().match(/Daisy ADS/);
    adsDaisy = o.data.toString().slice(regExArrDaisy.index, regExArrDaisy.index + openbci_constants.OBCIRegisterQueryCytonDaisy.length);

    if (getSRB1FromADSRegisterQuery(adsCyton)) {
      usingSRB1Daisy = true;
    }
  }

  o.channelSettings.forEach(
  /**
   * Set each channel
   * @param cs {ChannelSettingsObject}
   */
  function (cs) {
    if (cs.channelNumber < openbci_constants.OBCINumberOfChannelsCyton) {
      setChSetFromADSRegisterQuery(adsCyton, cs);
      cs.bias = getBiasSetFromADSRegisterQuery(adsCyton, cs.channelNumber);
      cs.srb1 = usingSRB1Cyton;
    } else {
      setChSetFromADSRegisterQuery(adsDaisy, cs);
      cs.bias = getBiasSetFromADSRegisterQuery(adsDaisy, cs.channelNumber - openbci_constants.OBCINumberOfChannelsCyton);
      cs.srb1 = usingSRB1Daisy;
    }
  });
}
/**
* @description Extract a time from a time packet in ms.
* @param dataBuf - A raw packet with 33 bytes of data
* @returns {Number} - Board time in milli seconds
* @author AJ Keller (@aj-ptw)
*/


function getFromTimePacketTime(dataBuf) {
  // Ths packet has 'A0','00'....,'00','00','FF','FF','FF','FF','C3' where the 'FF's are times
  var lastBytePosition = openbci_constants.OBCIPacketSize - 1; // This is 33, but 0 indexed would be 32 minus 1 for the stop byte and another two for the aux channel or the

  if (dataBuf.byteLength !== openbci_constants.OBCIPacketSize) {
    throw new Error(openbci_constants.OBCIErrorInvalidByteLength);
  } else {
    // Grab the time from the packet
    return dataBuf.readUInt32BE(lastBytePosition - openbci_constants.OBCIStreamPacketTimeByteSize);
  }
}
/**
 * @description Grabs an accel value from a raw but time synced packet. Important that this utilizes the fact that:
 *      X axis data is sent with every sampleNumber % 10 === 7
 *      Y axis data is sent with every sampleNumber % 10 === 8
 *      Z axis data is sent with every sampleNumber % 10 === 9
 * @param o {Object}
 * @param o.accelArray {Array} - A 3 element array that allows us to have inter packet memory of x and y axis data and emit only on the z axis packets.
 * @param o.rawDataPacket {Uint8Array} - The 33byte raw time synced accel packet
 * @param o.scale {Boolean} - Do you want to scale the results? Default is true
 * @returns {boolean} - A boolean that is true only when the accel array is ready to be emitted... i.e. when this is a Z axis packet
 */


function getFromTimePacketAccel(o) {
  var accelNumBytes = 2;
  var lastBytePosition = openbci_constants.OBCIPacketSize - 1 - openbci_constants.OBCIStreamPacketTimeByteSize - accelNumBytes; // This is 33, but 0 indexed would be 32 minus

  if (o.rawDataPacket.byteLength !== openbci_constants.OBCIPacketSize) {
    throw new Error(openbci_constants.OBCIErrorInvalidByteLength);
  }

  var sampleNumber = o.rawDataPacket[openbci_constants.OBCIPacketPositionSampleNumber];
  var accelCountValue = utilitiesModule.interpret16bitAsInt32(o.rawDataPacket.slice(lastBytePosition, lastBytePosition + 2));

  switch (sampleNumber % 10) {
    // The accelerometer is on a 25Hz sample rate, so every ten channel samples, we can get new data
    case openbci_constants.OBCIAccelAxisX:
      o.accelArray[0] = o.scale ? accelCountValue * SCALE_FACTOR_ACCEL : accelCountValue; // slice is not inclusive on the right

      return false;

    case openbci_constants.OBCIAccelAxisY:
      o.accelArray[1] = o.scale ? accelCountValue * SCALE_FACTOR_ACCEL : accelCountValue; // slice is not inclusive on the right

      return false;

    case openbci_constants.OBCIAccelAxisZ:
      o.accelArray[2] = o.scale ? accelCountValue * SCALE_FACTOR_ACCEL : accelCountValue; // slice is not inclusive on the right

      return true;

    default:
      return false;
  }
}
/**
* @description Grabs a raw aux value from a raw but time synced packet.
* @param dataBuf {Uint8Array} - The 33byte raw time synced raw aux packet
* @returns {Uint8Array|SafeBuffer|Buffer2} - Fulfills a 2 byte buffer
*/


function getFromTimePacketRawAux(dataBuf) {
  if (dataBuf.byteLength !== openbci_constants.OBCIPacketSize) {
    throw new Error(openbci_constants.OBCIErrorInvalidByteLength);
  }

  return Uint8Array.from(dataBuf.slice(openbci_constants.OBCIPacketPositionTimeSyncAuxStart, openbci_constants.OBCIPacketPositionTimeSyncAuxStop));
}
/**
* @description Takes a buffer filled with 3 16 bit integers from an OpenBCI device and converts based on settings
*                  of the MPU, values are in ?
* @param dataBuf - Uint8Array that is 6 bytes long
* @returns {Array} - Array of floats 3 elements long
* @author AJ Keller (@aj-ptw)
*/


function getDataArrayAccel(dataBuf) {
  var accelData = [];

  for (var i = 0; i < ACCEL_NUMBER_AXIS; i++) {
    var index = i * 2;
    accelData.push(utilitiesModule.interpret16bitAsInt32(dataBuf.slice(index, index + 2)) * SCALE_FACTOR_ACCEL);
  }

  return accelData;
}
/**
 * @description Takes a buffer filled with 3 16 bit integers from an OpenBCI device and converts based on settings
 *                  to an int
 * @param dataBuf - Uint8Array that is 6 bytes long
 * @returns {Array} - Array of floats 3 elements long
 * @author AJ Keller (@aj-ptw)
 */


function getDataArrayAccelNoScale(dataBuf) {
  var accelData = [];

  for (var i = 0; i < ACCEL_NUMBER_AXIS; i++) {
    var index = i * 2;
    accelData.push(utilitiesModule.interpret16bitAsInt32(dataBuf.slice(index, index + 2)));
  }

  return accelData;
}
/**
 * @description Takes a buffer filled with 24 bit signed integers from an OpenBCI device with gain settings in
 *                  channelSettingsArray[index].gain and converts based on settings of ADS1299... spits out an
 *                  array of floats in VOLTS
 * @param o {Object} - The input object
 * @param o.rawDataPacket {Uint8Array} - The 33byte raw time synced accel packet
 * @param o.channelSettings {Array} - An array of channel settings that is an Array that has shape similar to the one
 *                  calling k.channelSettingsArrayInit(). The most important rule here is that it is
 *                  Array of objects that have key-value pair {gain:NUMBER}
 * @param o.scale {Boolean} - Do you want to scale the results? Default is true
 * @param o.lastSampleNumber {Number} - The last sample number
 * @param o.protocol {String} - Either `Serial` or `Wifi` (Default is `Wifi`)
 * @returns {Array} - Array filled with floats for each channel's voltage in VOLTS
 * @author AJ Keller (@aj-ptw)
 */


function getChannelDataArray(o) {
  if (!Array.isArray(o.channelSettings)) {
    throw new Error('Error [getChannelDataArray]: Channel Settings must be an array!');
  }

  if (!o.hasOwnProperty('protocol')) {
    o.protocol = openbci_constants.OBCIProtocolSerial;
  }

  var channelData = []; // Grab the sample number from the buffer

  var numChannels = o.channelSettings.length;
  var sampleNumber = o.rawDataPacket[openbci_constants.OBCIPacketPositionSampleNumber];
  var daisy = numChannels === openbci_constants.OBCINumberOfChannelsDaisy;
  var channelsInPacket = openbci_constants.OBCINumberOfChannelsCyton;
  if (!daisy) channelsInPacket = o.channelSettings.length; // Channel data arrays are always 8 long

  for (var i = 0; i < channelsInPacket; i++) {
    if (!o.channelSettings[i].hasOwnProperty('gain')) {
      throw new Error("Error [getChannelDataArray]: Invalid channel settings object at index ".concat(i));
    }

    if (!openbci_constants.isNumber(o.channelSettings[i].gain)) {
      throw new Error('Error [getChannelDataArray]: Property gain of channelSettingsObject not or type Number');
    }

    var scaleFactor = 0;

    if (o.protocol === openbci_constants.OBCIProtocolSerial) {
      if (isEven(sampleNumber) && daisy) {
        scaleFactor = ADS1299_VREF / o.channelSettings[i + openbci_constants.OBCINumberOfChannelsDefault].gain / (Math.pow(2, 23) - 1);
      } else {
        scaleFactor = ADS1299_VREF / o.channelSettings[i].gain / (Math.pow(2, 23) - 1);
      }
    } else if (o.protocol === openbci_constants.OBCIProtocolWifi) {
      if (daisy) {
        if (o.lastSampleNumber === sampleNumber) {
          scaleFactor = ADS1299_VREF / o.channelSettings[i + openbci_constants.OBCINumberOfChannelsDefault].gain / (Math.pow(2, 23) - 1);
        } else {
          scaleFactor = ADS1299_VREF / o.channelSettings[i].gain / (Math.pow(2, 23) - 1);
        }
      } else if (o.channelSettings.length === openbci_constants.OBCINumberOfChannelsCyton) {
        scaleFactor = ADS1299_VREF / o.channelSettings[i].gain / (Math.pow(2, 23) - 1);
      } else {
        scaleFactor = openbci_constants.OBCIGanglionScaleFactorPerCountVolts;
      }
    } else if (o.protocol === openbci_constants.OBCIProtocolBLE) {
      // For cyton ble not ganglion
      scaleFactor = ADS1299_VREF / o.channelSettings[i].gain / (Math.pow(2, 23) - 1);
    } else {
      throw new Error('Error [getChannelDataArray]: Invalid protocol must be wifi or serial');
    } // Convert the three byte signed integer and convert it


    channelData.push(scaleFactor * utilitiesModule.interpret24bitAsInt32(o.rawDataPacket.slice(i * 3 + openbci_constants.OBCIPacketPositionChannelDataStart, i * 3 + openbci_constants.OBCIPacketPositionChannelDataStart + 3)));
  }

  return channelData;
}
/**
 * @description Takes a buffer filled with 24 bit signed integers from an OpenBCI device converts to array of counts
 * @param o {Object} - The input object
 * @param o.rawDataPacket {Uint8Array} - The 33byte raw time synced accel packet
 * @param o.channelSettings {Array} - An array of channel settings that is an Array that has shape similar to the one
 *                  calling k.channelSettingsArrayInit(). The most important rule here is that it is
 *                  Array of objects that have key-value pair {gain:NUMBER}
 * @returns {Array} - Array filled with floats for each channel's voltage in VOLTS
 * @author AJ Keller (@aj-ptw)
 */


function getChannelDataArrayNoScale(o) {
  if (!Array.isArray(o.channelSettings)) {
    throw new Error('Error [getChannelDataArrayNoScale]: Channel Settings must be an array!');
  }

  var channelData = [];
  var numChannels = o.channelSettings.length;

  if (numChannels > openbci_constants.OBCINumberOfChannelsDefault) {
    numChannels = openbci_constants.OBCINumberOfChannelsDefault;
  } // Channel data arrays cannot be more than 8


  for (var i = 0; i < numChannels; i++) {
    // Convert the three byte signed integer and convert it
    channelData.push(utilitiesModule.interpret24bitAsInt32(o.rawDataPacket.slice(i * 3 + openbci_constants.OBCIPacketPositionChannelDataStart, i * 3 + openbci_constants.OBCIPacketPositionChannelDataStart + 3)));
  }

  return channelData;
}

function getRawPacketType(stopByte) {
  return stopByte & 0xF;
}
/**
* @description This method is useful for normalizing sample numbers for fake sample packets. This is intended to be
*      useful for the simulator and automated testing.
* @param sampleNumber {Number} - The sample number you want to assign to the packet
* @returns {Number} - The normalized input `sampleNumber` between 0-255
*/


function sampleNumberNormalize(sampleNumber) {
  if (sampleNumber || sampleNumber === 0) {
    if (sampleNumber > 255) {
      sampleNumber = 255;
    }
  } else {
    sampleNumber = 0x45;
  }

  return sampleNumber;
}

function newSample(sampleNumber) {
  if (sampleNumber || sampleNumber === 0) {
    if (sampleNumber > 255) {
      sampleNumber = 255;
    }
  } else {
    sampleNumber = 0;
  }

  return {
    startByte: openbci_constants.OBCIByteStart,
    sampleNumber: sampleNumber,
    channelData: [],
    accelData: [],
    auxData: null,
    stopByte: openbci_constants.OBCIByteStop,
    boardTime: 0,
    timestamp: 0,
    valid: true
  };
}

function newSampleNoScale(sampleNumber) {
  if (sampleNumber || sampleNumber === 0) {
    if (sampleNumber > 255) {
      sampleNumber = 255;
    }
  } else {
    sampleNumber = 0;
  }

  return {
    startByte: openbci_constants.OBCIByteStart,
    sampleNumber: sampleNumber,
    channelDataCounts: [],
    accelDataCounts: [],
    auxData: null,
    stopByte: openbci_constants.OBCIByteStop,
    boardTime: 0,
    timestamp: 0,
    valid: true
  };
}
/**
* @description Convert float number into three byte buffer. This is the opposite of .interpret24bitAsInt32()
* @param float - The number you want to convert
* @returns {Uint8Array} - 3-byte buffer containing the float
*/


function floatTo3ByteBuffer(_float) {
  var intBuf = new Uint8Array(3); // 3 bytes for 24 bits

  intBuf.fill(0); // Fill the buffer with 0s

  var temp = _float / (ADS1299_VREF / 24 / (Math.pow(2, 23) - 1)); // Convert to counts


  temp = Math.floor(temp); // Truncate counts number
  // Move into buffer

  intBuf[2] = temp & 255;
  intBuf[1] = (temp & 255 << 8) >> 8;
  intBuf[0] = (temp & 255 << 16) >> 16;
  return intBuf;
}
/**
* @description Convert float number into three byte buffer. This is the opposite of .interpret24bitAsInt32()
* @param float - The number you want to convert
* @returns {buffer} - 3-byte buffer containing the float
*/


function floatTo2ByteBuffer(_float2) {
  var intBuf = new Uint8Array(2); // 2 bytes for 16 bits

  intBuf.fill(0); // Fill the buffer with 0s

  var temp = _float2 / SCALE_FACTOR_ACCEL; // Convert to counts

  temp = Math.floor(temp); // Truncate counts number
  // console.log('Num: ' + temp)
  // Move into buffer

  intBuf[1] = temp & 255;
  intBuf[0] = (temp & 255 << 8) >> 8;
  return intBuf;
}
/**
* @description Used to make one sample object from two sample objects. The sample number of the new daisy sample will
*      be the upperSampleObject's sample number divded by 2. This allows us to preserve consecutive sample numbers that
*      flip over at 127 instead of 255 for an 8 channel. The daisySampleObject will also have one `channelData` array
*      with 16 elements inside it, with the lowerSampleObject in the lower indices and the upperSampleObject in the
*      upper set of indices. The auxData from both channels shall be captured in an object called `auxData` which
*      contains two arrays referenced by keys `lower` and `upper` for the `lowerSampleObject` and `upperSampleObject`,
*      respectively. The timestamps shall be averaged and moved into an object called `timestamp`. Further, the
*      un-averaged timestamps from the `lowerSampleObject` and `upperSampleObject` shall be placed into an object called
*      `_timestamps` which shall contain two keys `lower` and `upper` which contain the original timestamps for their
*      respective sampleObjects.
* @param lowerSampleObject {Object} - Lower 8 channels with odd sample number
* @param upperSampleObject {Object} - Upper 8 channels with even sample number
* @returns {Object} - The new merged daisy sample object
*/


function makeDaisySampleObject(lowerSampleObject, upperSampleObject) {
  var daisySampleObject = {};

  if (lowerSampleObject.hasOwnProperty('channelData')) {
    daisySampleObject.channelData = lowerSampleObject.channelData.concat(upperSampleObject.channelData);
  }

  if (lowerSampleObject.hasOwnProperty('channelDataCounts')) {
    daisySampleObject.channelDataCounts = lowerSampleObject.channelDataCounts.concat(upperSampleObject.channelDataCounts);
  }

  daisySampleObject.sampleNumber = Math.floor(upperSampleObject.sampleNumber / 2);
  daisySampleObject.auxData = {
    'lower': lowerSampleObject.auxData,
    'upper': upperSampleObject.auxData
  };
  daisySampleObject.stopByte = lowerSampleObject.stopByte;
  daisySampleObject.timestamp = (lowerSampleObject.timestamp + upperSampleObject.timestamp) / 2;
  daisySampleObject['_timestamps'] = {
    'lower': lowerSampleObject.timestamp,
    'upper': upperSampleObject.timestamp
  };

  if (lowerSampleObject.hasOwnProperty('accelData')) {
    if (lowerSampleObject.accelData[0] > 0 || lowerSampleObject.accelData[1] > 0 || lowerSampleObject.accelData[2] > 0) {
      daisySampleObject.accelData = lowerSampleObject.accelData;
    } else {
      daisySampleObject.accelData = upperSampleObject.accelData;
    }
  }

  if (lowerSampleObject.hasOwnProperty('accelDataCounts')) {
    if (lowerSampleObject.accelDataCounts[0] > 0 || lowerSampleObject.accelDataCounts[1] > 0 || lowerSampleObject.accelDataCounts[2] > 0) {
      daisySampleObject.accelDataCounts = lowerSampleObject.accelDataCounts;
    } else {
      daisySampleObject.accelDataCounts = upperSampleObject.accelDataCounts;
    }
  }

  daisySampleObject.valid = true;
  return daisySampleObject;
}
/**
 * @description Used to make one sample object from two sample objects. The sample number of the new daisy sample will
 *      be the upperSampleObject's sample number divded by 2. This allows us to preserve consecutive sample numbers that
 *      flip over at 127 instead of 255 for an 8 channel. The daisySampleObject will also have one `channelData` array
 *      with 16 elements inside it, with the lowerSampleObject in the lower indices and the upperSampleObject in the
 *      upper set of indices. The auxData from both channels shall be captured in an object called `auxData` which
 *      contains two arrays referenced by keys `lower` and `upper` for the `lowerSampleObject` and `upperSampleObject`,
 *      respectively. The timestamps shall be averaged and moved into an object called `timestamp`. Further, the
 *      un-averaged timestamps from the `lowerSampleObject` and `upperSampleObject` shall be placed into an object called
 *      `_timestamps` which shall contain two keys `lower` and `upper` which contain the original timestamps for their
 *      respective sampleObjects.
 * @param lowerSampleObject {Object} - Lower 8 channels with odd sample number
 * @param upperSampleObject {Object} - Upper 8 channels with even sample number
 * @returns {Object} - The new merged daisy sample object
 */


function makeDaisySampleObjectWifi(lowerSampleObject, upperSampleObject) {
  var daisySampleObject = {};

  if (lowerSampleObject.hasOwnProperty('channelData')) {
    daisySampleObject['channelData'] = lowerSampleObject.channelData.concat(upperSampleObject.channelData);
  }

  if (lowerSampleObject.hasOwnProperty('channelDataCounts')) {
    daisySampleObject['channelDataCounts'] = lowerSampleObject.channelDataCounts.concat(upperSampleObject.channelDataCounts);
  }

  daisySampleObject['sampleNumber'] = upperSampleObject.sampleNumber;
  daisySampleObject['auxData'] = {
    'lower': lowerSampleObject.auxData,
    'upper': upperSampleObject.auxData
  };

  if (lowerSampleObject.hasOwnProperty('timestamp')) {
    daisySampleObject['timestamp'] = lowerSampleObject.timestamp;
  }

  daisySampleObject.stopByte = lowerSampleObject.stopByte;
  daisySampleObject['_timestamps'] = {
    'lower': lowerSampleObject.timestamp,
    'upper': upperSampleObject.timestamp
  };

  if (lowerSampleObject.hasOwnProperty('accelData')) {
    if (lowerSampleObject.accelData[0] > 0 || lowerSampleObject.accelData[1] > 0 || lowerSampleObject.accelData[2] > 0) {
      daisySampleObject.accelData = lowerSampleObject.accelData;
    } else {
      daisySampleObject.accelData = upperSampleObject.accelData;
    }
  }

  if (lowerSampleObject.hasOwnProperty('accelDataCounts')) {
    if (lowerSampleObject.accelDataCounts[0] > 0 || lowerSampleObject.accelDataCounts[1] > 0 || lowerSampleObject.accelDataCounts[2] > 0) {
      daisySampleObject.accelDataCounts = lowerSampleObject.accelDataCounts;
    } else {
      daisySampleObject.accelDataCounts = upperSampleObject.accelDataCounts;
    }
  }

  daisySampleObject['valid'] = true;
  return daisySampleObject;
}
/**
* @description Used to test a number to see if it is even
* @param a {Number} - The number to test
* @returns {boolean} - True if `a` is even
*/


function isEven(a) {
  return a % 2 === 0;
}
/**
* @description Used to test a number to see if it is odd
* @param a {Number} - The number to test
* @returns {boolean} - True if `a` is odd
*/


function isOdd(a) {
  return a % 2 === 1;
}
/**
* @description Since we know exactly what this input will look like (See the hardware firmware) we can program this
*      function with prior knowledge.
* @param dataBuffer {Uint8Array} - The buffer you want to parse.
* @return {Number} - The number of "ADS1299" present in the `dataBuffer`
*/


function countADSPresent(dataBuffer) {
  var s = new (sbmh_default())(new Uint8Array('ADS1299')); // Clear the buffer

  s.reset(); // Push the new data buffer. This runs the search.

  s.push(dataBuffer); // Check and see if there is a match

  return s.matches;
}
/**
* @description Searchs the buffer for a "$$$" or as we call an EOT
* @param dataBuffer - The buffer of some length to parse
* @returns {boolean} - True if the `$$$` was found.
*/
// TODO: StreamSearch is optimized to search incoming chunks of data, streaming in,
//       but a new search is constructed here with every call.  This is not making use
//       of StreamSearch's optimizations; the object should be preserved between chunks,
//       and only fed the new data.  TODO: also check other uses of StreamSearch


function doesBufferHaveEOT(dataBuffer) {
  var s = new (sbmh_default())(new Uint8Array(openbci_constants.OBCIParseEOT)); // Clear the buffer

  s.reset(); // Push the new data buffer. This runs the search.

  s.push(dataBuffer); // Check and see if there is a match

  return s.matches >= 1;
}
/**
 * Used to extract the major version from
 * @param dataBuffer
 * @return {*}
 */


function getFirmware(dataBuffer) {
  var regexPattern = /v\d.\d*.\d*/;
  var ret = dataBuffer.toString().match(regexPattern);

  if (ret) {
    var elems = ret[0].split('.');
    return {
      major: Number(elems[0][1]),
      minor: Number(elems[1]),
      patch: Number(elems[2]),
      raw: ret[0]
    };
  } else return ret;
}
/**
* @description Used to parse a buffer for the word `Failure` that is acked back after private radio msg on failure
* @param dataBuffer {Uint8Array} - The buffer of some length to parse
* @returns {boolean} - True if `Failure` was found.
*/


function isFailureInBuffer(dataBuffer) {
  var s = new (sbmh_default())(new Uint8Array(openbci_constants.OBCIParseFailure)); // Clear the buffer

  s.reset(); // Push the new data buffer. This runs the search.

  s.push(dataBuffer); // Check and see if there is a match

  return s.matches >= 1;
}
/**
* @description Used to parse a buffer for the word `Success` that is acked back after private radio msg on success
* @param dataBuffer {Uint8Array} - The buffer of some length to parse
* @returns {boolean} - True if `Success` was found.
*/


function isSuccessInBuffer(dataBuffer) {
  var s = new (sbmh_default())(new Uint8Array(openbci_constants.OBCIParseSuccess)); // Clear the buffer

  s.reset(); // Push the new data buffer. This runs the search.

  s.push(dataBuffer); // Check and see if there is a match

  return s.matches >= 1;
}
/**
 * @description Used to slice a buffer for the EOT '$$$'.
 * @param dataBuffer {Uint8Array} - The buffer of some length to parse
 * @returns {Uint8Array} - The remaining buffer.
 */


function stripToEOTBuffer(dataBuffer) {
  var indexOfEOT = dataBuffer.indexOf(openbci_constants.OBCIParseEOT);

  if (indexOfEOT >= 0) {
    indexOfEOT += openbci_constants.OBCIParseEOT.length;
  } else {
    return dataBuffer;
  }

  if (indexOfEOT < dataBuffer.byteLength) {
    return Uint8Array.from(dataBuffer.slice(indexOfEOT));
  } else {
    return null;
  }
}
/**
* @description Used to parse a buffer for the `,` character that is acked back after a time sync request is sent
* @param dataBuffer {Uint8Array} - The buffer of some length to parse
* @returns {boolean} - True if the `,` was found.
*/


function isTimeSyncSetConfirmationInBuffer(dataBuffer) {
  if (dataBuffer) {
    var bufferLength = dataBuffer.length;

    switch (bufferLength) {
      case 0:
        return false;

      case 1:
        return dataBuffer[0] === openbci_constants.OBCISyncTimeSent.charCodeAt(0);

      case 2:
        // HEAD Byte at End
        if (dataBuffer[1] === openbci_constants.OBCIByteStart) {
          return dataBuffer[0] === openbci_constants.OBCISyncTimeSent.charCodeAt(0); // TAIL byte in front
        } else if (isStopByte(dataBuffer[0])) {
          return dataBuffer[1] === openbci_constants.OBCISyncTimeSent.charCodeAt(0);
        } else {
          return false;
        }

      default:
        if (dataBuffer[0] === openbci_constants.OBCISyncTimeSent.charCodeAt(0) && dataBuffer[1] === openbci_constants.OBCIByteStart) {
          return true;
        }

        for (var i = 1; i < bufferLength; i++) {
          // The base case (last one)
          // console.log(i)
          if (i === bufferLength - 1) {
            if (isStopByte(dataBuffer[i - 1])) {
              return dataBuffer[i] === openbci_constants.OBCISyncTimeSent.charCodeAt(0);
            }
          } else {
            // Wedged
            if (isStopByte(dataBuffer[i - 1]) && dataBuffer[i + 1] === openbci_constants.OBCIByteStart) {
              return dataBuffer[i] === openbci_constants.OBCISyncTimeSent.charCodeAt(0); // TAIL byte in front
            }
          }
        }

        return false;
    }
  }
}
/**
* @description Mainly used by the simulator to convert a randomly generated sample into a std OpenBCI V3 Packet
* @param sample {Object} - A sample object
* @param time {Number} - The time to inject into the sample.
* @param rawAux {Uint8Array} - 2 byte buffer to inject into sample
* @returns {Uint8Array} - A time sync raw aux packet
*/


function convertSampleToPacketRawAuxTimeSynced(sample, time, rawAux) {
  var packetBuffer = new Uint8Array(openbci_constants.OBCIPacketSize);
  packetBuffer.fill(0); // start byte

  packetBuffer[0] = openbci_constants.OBCIByteStart; // sample number

  packetBuffer[1] = sample.sampleNumber; // channel data

  for (var i = 0; i < openbci_constants.OBCINumberOfChannelsDefault; i++) {
    var threeByteBuffer = floatTo3ByteBuffer(sample.channelData[i]);
    threeByteBuffer.copy(packetBuffer, 2 + i * 3);
  } // Write the raw aux bytes


  rawAux.copy(packetBuffer, 26); // Write the time

  packetBuffer.writeInt32BE(time, 28); // stop byte

  packetBuffer[openbci_constants.OBCIPacketSize - 1] = makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketRawAuxTimeSynced);
  return packetBuffer;
}
/**
* @description Mainly used by the simulator to convert a randomly generated sample into a std OpenBCI V3 Packet
* @param sample {Object} - A sample object
* @param time {Number} - The time to inject into the sample.
* @returns {Uint8Array} - A time sync accel packet
*/


function convertSampleToPacketAccelTimeSynced(sample, time) {
  var packetBuffer = new Uint8Array(openbci_constants.OBCIPacketSize);
  packetBuffer.fill(0); // start byte

  packetBuffer[0] = openbci_constants.OBCIByteStart; // sample number

  packetBuffer[1] = sample.sampleNumber; // channel data

  for (var i = 0; i < openbci_constants.OBCINumberOfChannelsDefault; i++) {
    var threeByteBuffer = floatTo3ByteBuffer(sample.channelData[i]);
    threeByteBuffer.copy(packetBuffer, 2 + i * 3);
  }

  packetBuffer.writeInt32BE(time, 28); // stop byte

  packetBuffer[openbci_constants.OBCIPacketSize - 1] = makeTailByteFromPacketType(openbci_constants.OBCIStreamPacketAccelTimeSynced);
  return packetBuffer;
}
/**
* @description Converts a packet type {Number} into a OpenBCI stop byte
* @param type {Number} - The number to smash on to the stop byte. Must be 0-15,
*          out of bounds input will result in a 0
* @return {Number} - A properly formatted OpenBCI stop byte
*/


function makeTailByteFromPacketType(type) {
  if (type < 0 || type > 15) {
    type = 0;
  }

  return openbci_constants.OBCIByteStop | type;
}
/**
* @description Used to check and see if a byte adheres to the stop byte structure of 0xCx where x is the set of
*      numbers from 0-F in hex of 0-15 in decimal.
* @param byte {Number} - The number to test
* @returns {boolean} - True if `byte` follows the correct form
* @author AJ Keller (@aj-ptw)
*/


function isStopByte(_byte) {
  return (_byte & 0xF0) === openbci_constants.OBCIByteStop;
}

/* harmony default export */ const utilities = ((/* unused pure expression or super */ null && (utilitiesModule)));
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/ganglion/ganglion-ble-master/src/utils/index.js
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { utils_defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function utils_defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }

function _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }

var renameDataProp = function renameDataProp(_ref) {
  var channelData = _ref.channelData,
      sample = _objectWithoutProperties(_ref, ["channelData"]);

  return _objectSpread(_objectSpread({}, sample), {}, {
    data: channelData
  });
};
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/ganglion/ganglion-ble-master/src/constants/index.js
var GANGLION_SERVICE_ID = 0xfe84;
var BOARD_NAME = 'ganglion';
var CHARACTERISTICS = {
  reader: '2d30c082-f39f-4ce6-923f-3484ea480596',
  writer: '2d30c083-f39f-4ce6-923f-3484ea480596',
  connection: '2d30c084-f39f-4ce6-923f-3484ea480596'
};
var CHARACTERISTIC_EVENT = 'characteristicvaluechanged';
var DISCONNECTED_EVENT = 'gattserverdisconnected';
var DEVICE_OPTIONS = {
  filters: [{
    namePrefix: 'Ganglion-'
  }],
  optionalServices: [GANGLION_SERVICE_ID]
};
var COMMAND_STRINGS = {
  start: 'b',
  accelData: 'n'
};
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/ganglion/ganglion-ble-master/src/index.js
function src_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function src_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { src_ownKeys(Object(source), true).forEach(function (key) { src_defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { src_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function src_defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || src_unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function src_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return src_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return src_arrayLikeToArray(o, minLen); }

function src_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { var _i = arr && (typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]); if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function src_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function src_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { src_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { src_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function src_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function src_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function src_createClass(Constructor, protoProps, staticProps) { if (protoProps) src_defineProperties(Constructor.prototype, protoProps); if (staticProps) src_defineProperties(Constructor, staticProps); return Constructor; }















function src_parseGanglion(o) {
  var byteId = parseInt(o.rawDataPacket[0]);

  if (byteId <= openbci_constants.OBCIGanglionByteId19Bit.max) {
    return processRouteSampleData(o);
  } else {
    switch (byteId) {
      case openbci_constants.OBCIGanglionByteIdMultiPacket:
        return processMultiBytePacket(o);

      case openbci_constants.OBCIGanglionByteIdMultiPacketStop:
        return processMultiBytePacketStop(o);

      case openbci_constants.OBCIGanglionByteIdImpedanceChannel1:
      case openbci_constants.OBCIGanglionByteIdImpedanceChannel2:
      case openbci_constants.OBCIGanglionByteIdImpedanceChannel3:
      case openbci_constants.OBCIGanglionByteIdImpedanceChannel4:
      case openbci_constants.OBCIGanglionByteIdImpedanceChannelReference:
        return processImpedanceData(o);

      default:
        return null;
    }
  }
}

var Ganglion = /*#__PURE__*/function () {
  function Ganglion() {
    var _this = this;

    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    src_classCallCheck(this, Ganglion);

    this.options = options;
    this.gatt = null;
    this.device = null;
    this.deviceName = null;
    this.service = null;
    this.characteristics = null;
    this.onDisconnect$ = new Subject.Subject();
    this.boardName = BOARD_NAME;
    this.channelSize = 4;

    function channelSettingsObjectDefault(channelNumber) {
      return {
        channelNumber: channelNumber,
        powerDown: false,
        gain: 24,
        inputType: 'normal',
        bias: true,
        srb2: true,
        srb1: false
      };
    }

    var channelSettingsArrayInit = function channelSettingsArrayInit(numberOfChannels) {
      var newChannelSettingsArray = [];

      for (var i = 0; i < numberOfChannels; i++) {
        newChannelSettingsArray.push(channelSettingsObjectDefault(i));
      }

      return newChannelSettingsArray;
    };

    function decompressedSamplesInit(numChannels) {
      var output = [];

      for (var i = 0; i < 3; i++) {
        output.push(new Array(numChannels));
      }

      return output;
    }

    this.rawDataPacketToSample = {
      accelArray: [0, 0, 0],
      channelSettings: channelSettingsArrayInit(4),
      decompressedSamples: decompressedSamplesInit(4),
      lastSampleNumber: 0,
      rawDataPacket: new Uint8Array(33).buffer,
      rawDataPackets: [],
      scale: true,
      sendCounts: false,
      timeOffset: 0,
      verbose: false
    };
    this.connectionStatus = new BehaviorSubject.BehaviorSubject(false);
    this.stream = new Subject.Subject().pipe((0,map.map)(function (event) {
      return _this.eventToBufferMapper(event);
    }), (0,tap.tap)(function (buffer) {
      return _this.setRawDataPacket(buffer);
    }), (0,map.map)(function () {
      return src_parseGanglion(_this.rawDataPacketToSample);
    }), (0,mergeMap.mergeMap)(function (x) {
      return x;
    }), (0,map.map)(renameDataProp), (0,takeUntil.takeUntil)(this.onDisconnect$));
    this.accelData = this.stream.pipe((0,filter.filter)(function (sample) {
      return sample.accelData.length;
    }));
  }

  src_createClass(Ganglion, [{
    key: "eventToBufferMapper",
    value: function eventToBufferMapper(event) {
      return new Uint8Array(event.target.value.buffer);
    }
  }, {
    key: "setRawDataPacket",
    value: function setRawDataPacket(buffer) {
      this.rawDataPacketToSample.rawDataPacket = buffer;
    }
  }, {
    key: "connect",
    value: function () {
      var _connect = src_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                _context.next = 2;
                return navigator.bluetooth.requestDevice(DEVICE_OPTIONS);

              case 2:
                this.device = _context.sent;
                this.addDisconnectedEvent();
                _context.next = 6;
                return this.device.gatt.connect();

              case 6:
                this.gatt = _context.sent;
                this.deviceName = this.gatt.device.name;
                _context.next = 10;
                return this.gatt.getPrimaryService(GANGLION_SERVICE_ID);

              case 10:
                this.service = _context.sent;
                _context.t0 = this;
                _context.next = 14;
                return this.service.getCharacteristics();

              case 14:
                _context.t1 = _context.sent;

                _context.t0.setCharacteristics.call(_context.t0, _context.t1);

                this.connectionStatus.next(true);

              case 17:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this);
      }));

      function connect() {
        return _connect.apply(this, arguments);
      }

      return connect;
    }()
  }, {
    key: "setCharacteristics",
    value: function setCharacteristics(characteristics) {
      this.characteristics = Object.entries(CHARACTERISTICS).reduce(function (map, _ref) {
        var _ref2 = _slicedToArray(_ref, 2),
            name = _ref2[0],
            uuid = _ref2[1];

        return src_objectSpread(src_objectSpread({}, map), {}, src_defineProperty({}, name, characteristics.find(function (c) {
          return c.uuid === uuid;
        })));
      }, {});
    }
  }, {
    key: "start",
    value: function () {
      var _start = src_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
        var _this2 = this;

        var _this$characteristics, reader, writer, commands;

        return regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _this$characteristics = this.characteristics, reader = _this$characteristics.reader, writer = _this$characteristics.writer;
                commands = Object.entries(COMMAND_STRINGS).reduce(function (acc, _ref3) {
                  var _ref4 = _slicedToArray(_ref3, 2),
                      key = _ref4[0],
                      command = _ref4[1];

                  return src_objectSpread(src_objectSpread({}, acc), {}, src_defineProperty({}, key, new TextEncoder().encode(command)));
                }, {});
                reader.startNotifications();
                reader.addEventListener(CHARACTERISTIC_EVENT, function (event) {
                  _this2.stream.next(event);
                });

                if (!this.options.accelData) {
                  _context2.next = 8;
                  break;
                }

                _context2.next = 7;
                return writer.writeValue(commands.accelData);

              case 7:
                reader.readValue();

              case 8:
                _context2.next = 10;
                return writer.writeValue(commands.start);

              case 10:
                reader.readValue();

              case 11:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function start() {
        return _start.apply(this, arguments);
      }

      return start;
    }()
  }, {
    key: "addDisconnectedEvent",
    value: function addDisconnectedEvent() {
      var _this3 = this;

      (0,fromEvent.fromEvent)(this.device, DISCONNECTED_EVENT).pipe((0,first.first)()).subscribe(function () {
        _this3.gatt = null;
        _this3.device = null;
        _this3.deviceName = null;
        _this3.service = null;
        _this3.characteristics = null;

        _this3.connectionStatus.next(false);
      });
    }
  }, {
    key: "disconnect",
    value: function disconnect() {
      if (!this.gatt) {
        return;
      }

      ;
      this.onDisconnect$.next();
      this.gatt.disconnect();
    }
  }]);

  return Ganglion;
}();
/* harmony default export */ const src = ((/* unused pure expression or super */ null && (Ganglion)));
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/ganglion/ganglionPlugin.js
function ganglionPlugin_toConsumableArray(arr) { return ganglionPlugin_arrayWithoutHoles(arr) || ganglionPlugin_iterableToArray(arr) || ganglionPlugin_unsupportedIterableToArray(arr) || ganglionPlugin_nonIterableSpread(); }

function ganglionPlugin_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function ganglionPlugin_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return ganglionPlugin_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return ganglionPlugin_arrayLikeToArray(o, minLen); }

function ganglionPlugin_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function ganglionPlugin_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return ganglionPlugin_arrayLikeToArray(arr); }

function ganglionPlugin_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function ganglionPlugin_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { ganglionPlugin_typeof = function _typeof(obj) { return typeof obj; }; } else { ganglionPlugin_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return ganglionPlugin_typeof(obj); }

function ganglionPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function ganglionPlugin_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { ganglionPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { ganglionPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function ganglionPlugin_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

//Template system to feed into the deviceStream class for creating possible configurations. 
//Just fill out the template functions accordingly and add this class (with a unique name) to the list of usable devices.




var ganglionPlugin = function ganglionPlugin(mode) {
  var _this = this;

  var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onconnect;
  var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.ondisconnect;

  ganglionPlugin_classCallCheck(this, ganglionPlugin);

  this.init = /*#__PURE__*/function () {
    var _ref = ganglionPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(info, pipeToAtlas) {
      var uvPerStep;
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _this.info = info;
              _this.info.sps = 200;
              _this.info.deviceType = 'eeg';
              uvPerStep = 1e6;
              _this.info.eegChannelTags = [{
                ch: 0,
                tag: "FP1",
                analyze: true
              }, {
                ch: 1,
                tag: "FP2",
                analyze: true
              }, {
                ch: 2,
                tag: "C3",
                analyze: true
              }, {
                ch: 3,
                tag: "C4",
                analyze: true
              }];

            case 5:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }();

  this.setupAtlas = function () {
    var pipeToAtlas = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
    var info = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _this.info;

    _this._onConnected = function () {
      _this.setupAtlas(pipeToAtlas, info);
    };

    if (_this.info.useFilters === true) {
      _this.info.eegChannelTags.forEach(function (row, i) {
        if (row.tag !== 'other') {
          _this.filters.push(new BiquadChannelFilterer(row.ch, _this.info.sps, true, uvPerStep));
        } else {
          _this.filters.push(new BiquadChannelFilterer(row.ch, _this.info.sps, false, uvPerStep));
        }

        _this.filters[_this.filters.length - 1].useScaling = true;

        _this.filters[_this.filters.length - 1].notch60.pop();
      });
    }

    if (pipeToAtlas === true) {
      //New Atlas
      var config = '10_20';
      _this.atlas = new DataAtlas_DataAtlas(location + ":" + _this.mode, {
        eegshared: {
          eegChannelTags: _this.info.eegChannelTags,
          sps: _this.info.sps
        }
      }, config, true, true, _this.info.analysis);
      _this.info.useAtlas = true;
    } else if (ganglionPlugin_typeof(pipeToAtlas) === 'object') {
      //Reusing an atlas
      _this.atlas = pipeToAtlas; //External atlas reference

      _this.atlas.data.eegshared.eegChannelTags = _this.info.eegChannelTags;
      _this.atlas.data.eegshared.sps = _this.info.sps;
      _this.atlas.data.eegshared.frequencies = _this.atlas.bandpassWindow(0, 128, _this.info.sps * 0.5);
      _this.atlas.data.eegshared.bandFreqs = _this.atlas.getBandFreqs(_this.atlas.data.eegshared.frequencies);
      _this.atlas.data.eeg = _this.atlas.gen10_20Atlas();
      _this.atlas.data.coherence = _this.atlas.genCoherenceMap(_this.info.eegChannelTags);

      _this.atlas.data.eegshared.eegChannelTags.forEach(function (row, i) {
        if (_this.atlas.getEEGDataByTag(row.tag) === undefined) {
          _this.atlas.addEEGCoord(row.ch);
        }
      });

      _this.atlas.settings.coherence = true;
      _this.atlas.settings.eeg = true;
      _this.info.useAtlas = true;

      if (info.analysis.length > 0) {
        var _this$atlas$settings$;

        (_this$atlas$settings$ = _this.atlas.settings.analysis).push.apply(_this$atlas$settings$, ganglionPlugin_toConsumableArray(_this.info.analysis));

        if (!_this.atlas.settings.analyzing) {
          _this.atlas.settings.analyzing = true;

          _this.atlas.analyzer();
        }
      }
    }
  };

  this._onConnected = function () {};

  this.connect = /*#__PURE__*/ganglionPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
    return regeneratorRuntime.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            _this.device = new Ganglion();
            _context2.next = 3;
            return _this.device.connect();

          case 3:
            _context2.next = 5;
            return _this.device.start();

          case 5:
            _this._onConnected();

            _this.device.stream.subscribe(function (sample) {
              if (_this.info.useAtlas) {
                var time = sample.timestamp;
                sample.data.forEach(function (datum, i) {
                  var coord = _this.atlas.getEEGDataByChannel(i);

                  coord.times.push(time);
                  coord.raw.push(datum);
                  coord.count++;

                  if (_this.info.useFilters === true) {
                    var latestFiltered = 0;

                    if (_this.filters[i] !== undefined) {
                      latestFiltered = _this.filters[i].apply(datum);
                    }

                    coord.filtered.push(latestFiltered);
                  }
                });
              }
            });

            if (_this.info.useAtlas === true) {
              _this.atlas.data.eegshared.startTime = Date.now();

              if (_this.atlas.settings.analyzing !== true && _this.info.analysis.length > 0) {
                _this.atlas.settings.analyzing = true;
                setTimeout(function () {
                  _this.atlas.analyzer();
                }, 1200);
              }
            }

            _this.atlas.settings.deviceConnected = true;

            _this.onconnect(); //onconnected: this.atlas.settings.deviceConnected = true;


          case 10:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  }));

  this.disconnect = function () {
    _this.device.disconnect();

    _this.atlas.settings.analyzing = false;
    _this.atlas.settings.deviceConnected = false;
    if (_this.ui) _this.ui.deleteNode();

    _this.ondisconnect(); //ondisconnected: this.atlas.settings.deviceConnected = false;

  };

  this.onconnect = function () {};

  this.ondisconnect = function () {};

  this.addControls = function () {
    var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
    var id = Math.floor(Math.random() * 10000); //prevents any possible overlap with other elements

    var template = function template() {
      return "\n            ";
    };

    var setup = function setup() {};

    _this.ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
  };

  this.atlas = null;
  this.mode = mode;
  this.device = null; //Invoke a device class here if needed

  this.filters = [];
  this.onconnect = onconnect;
  this.ondisconnect = ondisconnect;
};
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/neosensory/Buzz.js
function Buzz_toConsumableArray(arr) { return Buzz_arrayWithoutHoles(arr) || Buzz_iterableToArray(arr) || Buzz_unsupportedIterableToArray(arr) || Buzz_nonIterableSpread(); }

function Buzz_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function Buzz_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return Buzz_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return Buzz_arrayLikeToArray(o, minLen); }

function Buzz_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function Buzz_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return Buzz_arrayLikeToArray(arr); }

function Buzz_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function Buzz_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function Buzz_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { Buzz_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { Buzz_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function Buzz_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function Buzz_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function Buzz_createClass(Constructor, protoProps, staticProps) { if (protoProps) Buzz_defineProperties(Constructor.prototype, protoProps); if (staticProps) Buzz_defineProperties(Constructor, staticProps); return Constructor; }

// Garrett Flynn, Apache 2.0 License
 //For async functions on node\\

/** @module neosensory 
 * @description A JavaScript SDK to help streamline controlling Neosensory devices over Bluetooth Low Energy.
 * 
*/

var Buzz = /*#__PURE__*/function () {
  /** @constructor 
   * @alias module:neosensory.Buzz 
   * @description A class to manage connections to the Neosensory Buzz
   * @param {callback} ondata Callback function to handle app logic
  */
  function Buzz() {
    var _this = this;

    var ondata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};

    Buzz_classCallCheck(this, Buzz);

    this.sendCommand = function () {
      var command = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';

      // return new Promise(async (resolve, reject) => {
      _this["interface"].sendMessage(command); // })

    };

    this.requestAuthorization = function () {
      _this.sendCommand('auth as developer\n');
    };

    this.acceptTerms = function () {
      _this.sendCommand('accept\n');

      _this.pauseDeviceAlgorithm();
    };

    this.pauseDeviceAlgorithm = function () {
      _this.stopAudio();

      _this.enableMotors();

      _this.clearMotorQueue();
    };

    this.resumeDeviceAlgorithm = function () {
      _this.startAudio();
    };

    this.battery = function () {
      _this.sendCommand('device battery_soc\n');
    };

    this.info = function () {
      _this.sendCommand('device info\n');
    };

    this.connect = /*#__PURE__*/Buzz_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
      var res;
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return _this["interface"].connect();

            case 2:
              res = _context.sent;
              return _context.abrupt("return", res);

            case 4:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    this.disconnect = function () {
      _this["interface"].disconnect();
    };

    this.startAudio = function () {
      _this.sendCommand('audio start\n');
    };

    this.stopAudio = function () {
      _this.sendCommand('audio stop\n');
    };

    this.clearMotorQueue = function () {
      _this.sendCommand('motors clear_queue\n');
    };

    this.enableMotors = function () {
      _this.sendCommand('motors start\n');
    };

    this.disableMotors = function () {
      _this.sendCommand('motors stop\n');
    };

    this.vibrateMotors = function (controlFrames) {
      var base64String = btoa(String.fromCharCode.apply(String, Buzz_toConsumableArray(new Uint8Array(controlFrames.flat()))));

      _this.sendCommand("motors vibrate ".concat(base64String, "\n"));
    };

    this.setThreshold = function (feedbackType) {
      var threshold = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
      if (feedbackType == 'default') feedbackType = 0;
      if (feedbackType == 'always') feedbackType = 1;
      if (feedbackType == 'threshold') feedbackType = 2;

      _this.sendCommand("motors config_threshold ".concat(feedbackType, " ").concat(threshold, "\n"));
    };

    this.getThreshold = function () {
      _this.sendCommand("motors get_threshold\n");
    };

    this.setLRA = function (mode) {
      if (mode == 'open') mode = 0;
      if (mode == 'closed') mode = 1;

      _this.sendCommand("motors config_lra_mode ".concat(mode, "\n"));
    };

    this.getLRA = function () {
      _this.sendCommand("motors get_lra_mode ".concat(mode, "\n"));
    };

    this.getLEDs = function () {
      _this.sendCommand('leds get\n');
    };

    this.setLEDs = function () {
      var colors = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
      var intensities = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];

      var rgbToHex = function rgbToHex(r, g, b) {
        return "0x" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
      };

      colors = colors.map(function (c) {
        return c = rgbToHex.apply(void 0, Buzz_toConsumableArray(c));
      });

      _this.sendCommand("leds set ".concat(colors.join(' '), " ").concat(intensities.map(function (i) {
        return i * 50;
      }).join(' '), "\n"));
    };

    this.setButton = function (feedback, sensitivity) {
      if (feedback == true || feedback == 'true') feedback = 1;
      if (feedback == false || feedback == 'false') feedback = 0;
      if (sensitivity == true || sensitivity == 'true') sensitivity = 1;
      if (sensitivity == false || sensitivity == 'false') sensitivity = 0;

      _this.sendCommand("set_buttons_response ".concat(feedback, " ").concat(sensitivity, "\n"));
    };

    this["interface"] = null;
    this.minIntensity = 15;
    this.maxIntensity = 255;
    this["interface"] = new BuzzBLE();

    this["interface"].onNotificationCallback = function (e) {
      ondata(e);
    };

    var disconnectOnRefresh = function disconnectOnRefresh() {
      _this.disconnect();

      window.removeEventListener('beforeunload', disconnectOnRefresh);
    };

    window.addEventListener('beforeunload', disconnectOnRefresh);
  }
  /**
   * @method module:neosensory.Buzz.sendCommand
   * @alias sendCommand
   * @description A function to encode command strings and send to the device
   * @params {string} Command to send to the device
   */


  Buzz_createClass(Buzz, [{
    key: "getIllusionActivations",
    value: // Advanced Methods

    /**
     * @method module:neosensory.Buzz.getIllusionActivations
     * @alias getIllusionActivations
     * @description Get activations. Requires users to [requestAuthorization()]{@link module:neosensory.Buzz.requestAuthorization} and [acceptTerms()]{@link module:neosensory.Buzz.acceptTerms}.
    * @param {float} linearIntensity Between 0-1 
    * @param {float} location Between 0-1 
     */
    function getIllusionActivations(linearIntensity, location) {
      var motorIntensity = this.getMotorIntensity(linearIntensity, this.minIntensity, this.maxIntensity);
      var motor1 = Math.floor(location / .25);
      var motor2 = Math.ceil(location / .25);
      var ratio = 4 * (location % 0.25);
      var values = Array(4).fill(0);
      values[motor1] = 255 * motorIntensity * Math.sqrt(1 - ratio);
      values[motor2] = 255 * motorIntensity * Math.sqrt(ratio);
      return values;
    }
    /**
     * @method module:neosensory.Buzz.getMotorIntensity
     * @alias getMotorIntensity
     * @description Get motor intensity. Requires users to [requestAuthorization()]{@link module:neosensory.Buzz.requestAuthorization} and [acceptTerms()]{@link module:neosensory.Buzz.acceptTerms}.
    * @param {float} linearIntensity Between 0-1 
    * @param {float} minIntensity Between 0-255
    * @param {float} maxIntensity Between 0-255
     */

  }, {
    key: "getMotorIntensity",
    value: function getMotorIntensity(linearIntensity, minIntensity, maxIntensity) {
      if (linearIntensity <= 0) return minIntensity;
      if (linearIntensity >= 1) return maxIntensity;
      return Math.expm1(linearIntensity) / (Math.E - 1) * (maxIntensity - minIntensity) + minIntensity;
    }
  }, {
    key: "mapFrequencies",
    value: function mapFrequencies(fft) {
      function indexOfMax(arr) {
        if (arr.length === 0) {
          return -1;
        }

        var max = arr[0];
        var maxIndex = 0;

        for (var i = 1; i < arr.length; i++) {
          if (arr[i] > max) {
            maxIndex = i;
            max = arr[i];
          }
        }

        return maxIndex;
      } // Store running mean


      var i = indexOfMax(fft);
      var location = i / fft.length;
      return this.getIllusionActivations(1, location);
    }
  }]);

  return Buzz;
}();
var BuzzBLE = //This is formatted for the way the Neosensory Buzz sends/receives information. Other BLE devices will likely need changes to this to be interactive.
function BuzzBLE() // serviceUUID = '6E400001-B5A3-F393-E0A9-E50E24DCCA9E', rxUUID = '6E400002-B5A3-F393-E0A9-E50E24DCCA9E', txUUID = '6E400003-B5A3-F393-E0A9-E50E24DCCA9E', async = false 
{
  var serviceUUID = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
  var rxUUID = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '6e400002-b5a3-f393-e0a9-e50e24dcca9e';
  var txUUID = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '6e400003-b5a3-f393-e0a9-e50e24dcca9e';

  Buzz_classCallCheck(this, BuzzBLE);

  Buzz_initialiseProps.call(this);

  this.serviceUUID = serviceUUID;
  this.rxUUID = rxUUID; //characteristic that can receive input from this device

  this.txUUID = txUUID; //characteristic that can transmit input to this device

  this.encoder = new TextEncoder("utf-8");
  this.decoder = new TextDecoder("utf-8");
  this.device = null;
  this.server = null;
  this.service = null;
  this.rxchar = null; //receiver on the BLE device (write to this)

  this.txchar = null; //transmitter on the BLE device (read from this)

  this.queue = [];
  this.readBuffer = [];
  this.android = navigator.userAgent.toLowerCase().indexOf("android") > -1; //Use fast mode on android (lower MTU throughput)

  this.n; //nsamples  
} //Typical web BLE calls
;

var Buzz_initialiseProps = function _initialiseProps() {
  var _this2 = this;

  this.connect = /*#__PURE__*/Buzz_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {
    var serviceUUID,
        rxUUID,
        txUUID,
        _args3 = arguments;
    return regeneratorRuntime.wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            serviceUUID = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : _this2.serviceUUID;
            rxUUID = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : _this2.rxUUID;
            txUUID = _args3.length > 2 && _args3[2] !== undefined ? _args3[2] : _this2.txUUID;
            _context3.next = 5;
            return navigator.bluetooth.requestDevice({
              filters: [{
                services: [serviceUUID]
              }, {
                namePrefix: 'Buzz'
              }],
              optionalServices: [serviceUUID]
            }).then( /*#__PURE__*/function () {
              var _ref3 = Buzz_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(device) {
                return regeneratorRuntime.wrap(function _callee2$(_context2) {
                  while (1) {
                    switch (_context2.prev = _context2.next) {
                      case 0:
                        _this2.device = device;
                        _context2.next = 3;
                        return _this2.device.gatt.connect();

                      case 3:
                        _this2.server = _context2.sent;
                        _context2.next = 6;
                        return _this2.server.getPrimaryService(serviceUUID);

                      case 6:
                        _this2.service = _context2.sent;
                        _context2.next = 9;
                        return _this2.service.getCharacteristic(rxUUID);

                      case 9:
                        _this2.rxchar = _context2.sent;
                        _context2.next = 12;
                        return _this2.service.getCharacteristic(txUUID);

                      case 12:
                        _this2.txchar = _context2.sent;

                        // Get stream source
                        _this2.txchar.startNotifications().then(function () {
                          _this2.txchar.addEventListener('characteristicvaluechanged', _this2._onNotificationCallback);
                        }); // Subscribe to stream


                        // Subscribe to stream
                        _this2.onConnectedCallback();

                        return _context2.abrupt("return", _this2.device);

                      case 16:
                      case "end":
                        return _context2.stop();
                    }
                  }
                }, _callee2);
              }));

              return function (_x) {
                return _ref3.apply(this, arguments);
              };
            }())["catch"](function (err) {
              console.error(err);

              _this2.onErrorCallback(err);
            });

          case 5:
            return _context3.abrupt("return", _context3.sent);

          case 6:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3);
  }));

  this.onNotificationCallback = function (e) {};

  this._onNotificationCallback = function (e) {
    // Ensure that there is no GATT write overlap
    var res = _this2.decoder.decode(e.target.value);

    var completed = _this2.parseResponse(res);

    var noQueueItem = 'motor queue full';

    if (completed && (completed.data != null || !completed.message.includes(noQueueItem))) {
      // Only run on completed responses
      var lastItem = _this2.queue.shift();

      if (lastItem) {
        lastItem.callback();

        if (_this2.queue.length !== 0) {
          var nextItem = _this2.queue.slice(0, 1)[0];

          _this2.writeValue(nextItem.msg);
        }
      } else {// console.log(completed.command)
      }

      _this2.onNotificationCallback(completed);
    } else {
      var _completed$message;

      if (completed && completed !== null && completed !== void 0 && (_completed$message = completed.message) !== null && _completed$message !== void 0 && _completed$message.includes(noQueueItem)) console.log(noQueueItem);
    }
  };

  this.writeValue = function (val) {
    return new Promise(function (resolve) {
      _this2.rxchar.writeValue(_this2.encoder.encode(val));

      resolve();
      setTimeout(function () {
        resolve();
      }, 50); // Throttle Write Commands
    });
  };

  this.parseResponse = function (response) {
    var complete = false;

    if (response.indexOf("{") != -1 && _this2.readBuffer.length == 0) {
      _this2.lastCommand = response.slice(0, response.indexOf("{"));

      if (response.lastIndexOf("}") != -1) {
        _this2.readBuffer.push(response.substring(response.indexOf("{"), response.lastIndexOf("}") + 1));

        complete = true;
      } else {
        _this2.readBuffer.push(response.substring(response.indexOf("{")));
      }
    } else {
      if (response.lastIndexOf("}") != -1) {
        _this2.readBuffer.push(response.substring(0, response.lastIndexOf("}") + 1));

        complete = true;
      } else if (_this2.readBuffer.length != 0) {
        _this2.readBuffer.push(response);
      }
    }

    if (complete) {
      var joinedBuffer = _this2.readBuffer.join('');

      _this2.readBuffer = [];
      response = JSON.parse(joinedBuffer);
      response.command = _this2.lastCommand;
      _this2.readBuffer = [];
      return response;
    }
  };

  this.onConnectedCallback = function () {};

  this.onErrorCallback = function () {};

  this.sendMessage = function (msg) {
    var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};
    if (msg[msg.length - 2] != '\n') msg += '\n';
    var noResponseExpected = 'motors vibrate';
    if (!msg.includes(noResponseExpected)) _this2.queue.push({
      msg: msg,
      callback: callback
    });

    if (_this2.queue.length <= 1 || msg.includes(noResponseExpected)) {
      _this2.writeValue(msg);
    }
  };

  this.disconnect = function () {
    _this2.queue = [];
    setTimeout(function () {
      _this2.sendMessage('audio start\n', function () {
        _this2.device.gatt.disconnect();

        _this2.onDisconnectedCallback();
      });
    }, 50); // Resume device algorithm
  };

  this.onDisconnectedCallback = function () {};
};
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/neosensory/buzzPlugin.js
function buzzPlugin_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { buzzPlugin_typeof = function _typeof(obj) { return typeof obj; }; } else { buzzPlugin_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return buzzPlugin_typeof(obj); }

function buzzPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function buzzPlugin_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { buzzPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { buzzPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function buzzPlugin_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function buzzPlugin_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function buzzPlugin_createClass(Constructor, protoProps, staticProps) { if (protoProps) buzzPlugin_defineProperties(Constructor.prototype, protoProps); if (staticProps) buzzPlugin_defineProperties(Constructor, staticProps); return Constructor; }

//Template system to feed into the deviceStream class for creating possible configurations. 
//Just fill out the template functions accordingly and add this class (with a unique name) to the list of usable devices.


 // import * as neosensory from 'neosensory'

var buzzPlugin = /*#__PURE__*/function () {
  function buzzPlugin(mode) {
    var _this = this;

    var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};
    var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};

    buzzPlugin_classCallCheck(this, buzzPlugin);

    this.init = /*#__PURE__*/function () {
      var _ref = buzzPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(info, pipeToAtlas) {
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                info.deviceType = 'other';
                _this.device = new Buzz(function (res) {
                  if (res) {
                    if (res.command.includes('auth as developer')) {
                      var display = document.getElementById("neosensory-termsDisplay");
                      if (display) display.innerHTML = "To use your Neosensory Buzz on The Brains@Play Platform, please agree to Neosensory Inc's Developer Terms and Conditions, which can be viewed at <a href='https://neosensory.com/legal/dev-terms-service'>https://neosensory.com/legal/dev-terms-service</a>";
                    }
                  }
                });

                _this._onConnected = function () {
                  _this.setupAtlas(info, pipeToAtlas);
                };

              case 3:
              case "end":
                return _context.stop();
            }
          }
        }, _callee);
      }));

      return function (_x, _x2) {
        return _ref.apply(this, arguments);
      };
    }();

    this.connect = function () {
      return new Promise( /*#__PURE__*/function () {
        var _ref2 = buzzPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(resolve, reject) {
          var device, res;
          return regeneratorRuntime.wrap(function _callee2$(_context2) {
            while (1) {
              switch (_context2.prev = _context2.next) {
                case 0:
                  _context2.next = 2;
                  return _this.device.connect();

                case 2:
                  device = _context2.sent;

                  if (!device) {
                    _context2.next = 10;
                    break;
                  }

                  _context2.next = 6;
                  return _this.agreeToTerms();

                case 6:
                  res = _context2.sent;

                  if (res) {
                    _this._onConnected();

                    _this.onconnect();

                    resolve(true);
                  } else {
                    _this.device.disconnect();

                    reject('Did not agree to Neosensory Developer Terms.');
                  }

                  _context2.next = 11;
                  break;

                case 10:
                  reject('Device failed to connect.');

                case 11:
                case "end":
                  return _context2.stop();
              }
            }
          }, _callee2);
        }));

        return function (_x3, _x4) {
          return _ref2.apply(this, arguments);
        };
      }());
    };

    this.disconnect = function () {
      if (_this.ui != null) _this.ui.deleteNode();

      _this.device.disconnect();

      _this.ondisconnect();

      _this.atlas.settings.deviceConnected = false;
    };

    this.onconnect = function () {};

    this.ondisconnect = function () {};

    this.addControls = function () {
      var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
      var id = Math.floor(Math.random() * 10000); //prevents any possible overlap with other elements

      var template = function template() {
        return "\n            <br>\n            <div id='" + id + "buzzControls'>\n                <h3>Control Panel</h3>\n                <hr>\n                <div style=\"display: flex; flex-wrap: wrap;\">\n                    <input id='" + id + "buzzcmd' type='text' placeholder='device info'></input><button id='" + id + "sendcmd'>Send</button>\n                </div>\n            </div>\n            ";
      };

      var setup = function setup() {
        document.getElementById(id + 'sendcmd').onclick = function () {
          _this.device.sendCommand(document.getElementById(id + 'buzzcmd').value);
        };
      };

      _this.ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
    };

    this.agreeToTerms = function () {
      return new Promise( /*#__PURE__*/function () {
        var _ref3 = buzzPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(resolve, reject) {
          var id, template, setup;
          return regeneratorRuntime.wrap(function _callee3$(_context3) {
            while (1) {
              switch (_context3.prev = _context3.next) {
                case 0:
                  id = Math.floor(Math.random() * 10000); //prevents any possible overlap with other elements

                  template = function template() {
                    return "\n            <div id='" + id + "buzzTerms' style=\"position: absolute; width: 100vw; height: 100vh; z-index: 10000; padding: 50px; background: rgba(0,0,0,0.7)\">\n                <h3>Agree To Terms</h3>\n                <hr>\n                <div id='neosensory-termsDisplay' style=\"padding: 25px;\"></div>\n                <div style=\"display: flex; flex-wrap: wrap;\">\n                    <button id='" + id + "accept' class=\"brainsatplay-default-button\">Accept</button>\n                    <button id='" + id + "deny' class=\"brainsatplay-default-button\">Deny</button>\n                </div>\n            </div>\n            ";
                  };

                  setup = function setup() {
                    _this.device.requestAuthorization();

                    document.getElementById(id + 'accept').onclick = function () {
                      _this.device.acceptTerms();

                      _this.terms.deleteNode();

                      resolve(true);
                    };

                    document.getElementById(id + 'deny').onclick = function () {
                      _this.terms.deleteNode();

                      resolve(false);
                    };
                  };

                  _this.terms = new DOMFragment_DOMFragment(template, document.body, undefined, setup);

                case 4:
                case "end":
                  return _context3.stop();
              }
            }
          }, _callee3);
        }));

        return function (_x5, _x6) {
          return _ref3.apply(this, arguments);
        };
      }());
    };

    this.mode = mode;
    this.atlas = null;
    this.device = null;
    this.filters = [];
    this.ui = null;
    this.onconnect = onconnect;
    this.ondisconnect = ondisconnect;
  }

  buzzPlugin_createClass(buzzPlugin, [{
    key: "setupAtlas",
    value: function setupAtlas(info, pipeToAtlas) {
      if (pipeToAtlas === true) {
        var config = 'neosensory_buzz';
        this.atlas = new DataAtlas_DataAtlas(location + ":" + this.mode, {}, config, false, true, info.analysis);
        info.useAtlas = true;
      } else if (buzzPlugin_typeof(pipeToAtlas) === 'object') {
        this.atlas = pipeToAtlas; //External atlas reference

        info.useAtlas = true;
      }

      this.atlas.settings.deviceConnected = true;
    }
  }]);

  return buzzPlugin;
}();
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/synthetic/syntheticPlugin.js
function syntheticPlugin_toConsumableArray(arr) { return syntheticPlugin_arrayWithoutHoles(arr) || syntheticPlugin_iterableToArray(arr) || syntheticPlugin_unsupportedIterableToArray(arr) || syntheticPlugin_nonIterableSpread(); }

function syntheticPlugin_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function syntheticPlugin_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return syntheticPlugin_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return syntheticPlugin_arrayLikeToArray(o, minLen); }

function syntheticPlugin_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function syntheticPlugin_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return syntheticPlugin_arrayLikeToArray(arr); }

function syntheticPlugin_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function syntheticPlugin_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { syntheticPlugin_typeof = function _typeof(obj) { return typeof obj; }; } else { syntheticPlugin_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return syntheticPlugin_typeof(obj); }

function syntheticPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function syntheticPlugin_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { syntheticPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { syntheticPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function syntheticPlugin_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function syntheticPlugin_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function syntheticPlugin_createClass(Constructor, protoProps, staticProps) { if (protoProps) syntheticPlugin_defineProperties(Constructor.prototype, protoProps); if (staticProps) syntheticPlugin_defineProperties(Constructor, staticProps); return Constructor; }

//Template system to feed into the deviceStream class for creating possible configurations. 
//Just fill out the template functions accordingly and add this class (with a unique name) to the list of usable devices.



var syntheticPlugin = /*#__PURE__*/function () {
  function syntheticPlugin(mode) {
    var _this = this;

    var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onconnect;
    var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.ondisconnect;

    syntheticPlugin_classCallCheck(this, syntheticPlugin);

    this.init = /*#__PURE__*/function () {
      var _ref = syntheticPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(info, pipeToAtlas) {
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                info.sps = 256;
                info.deviceType = 'eeg';
                info.eegChannelTags = '8';
                _this.info = info;

                _this._onConnected = function () {
                  _this.setupAtlas(pipeToAtlas, info);
                };

              case 5:
              case "end":
                return _context.stop();
            }
          }
        }, _callee);
      }));

      return function (_x, _x2) {
        return _ref.apply(this, arguments);
      };
    }();

    this.setupAtlas = function () {
      var pipeToAtlas = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
      var info = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _this.info;

      if (pipeToAtlas === true) {
        //New Atlas
        var config = '10_20';
        _this.atlas = new DataAtlas_DataAtlas(location + ":" + _this.mode, {
          eegshared: {
            eegChannelTags: info.eegChannelTags,
            sps: info.sps
          }
        }, config, true, true, info.analysis);
        info.useAtlas = true;
      } else if (syntheticPlugin_typeof(pipeToAtlas) === 'object') {
        //Reusing an atlas
        _this.atlas = pipeToAtlas; //External atlas reference

        _this.atlas.data.eegshared.sps = info.sps;
        _this.atlas.data.eegshared.frequencies = _this.atlas.bandpassWindow(0, 128, info.sps * 0.5);
        _this.atlas.data.eegshared.bandFreqs = _this.atlas.getBandFreqs(_this.atlas.data.eegshared.frequencies);
        _this.atlas.data.eeg = _this.atlas.gen10_20Atlas(info.eegChannelTags); // Populate EEG Channel Tags

        info.eegChannelTags = [];

        _this.atlas.data.eeg.forEach(function (d, i) {
          info.eegChannelTags.push({
            ch: i,
            tag: d.tag,
            analyze: true
          });
        });

        if (_this.atlas.data.eegshared.eegChannelTags == null) _this.atlas.data.eegshared.eegChannelTags = info.eegChannelTags;
        _this.atlas.data.coherence = _this.atlas.genCoherenceMap(info.eegChannelTags);
        _this.atlas.settings.coherence = true;
        _this.atlas.settings.eeg = true;
        info.useAtlas = true;

        if (info.analysis.length > 0) {
          var _this$atlas$settings$;

          (_this$atlas$settings$ = _this.atlas.settings.analysis).push.apply(_this$atlas$settings$, syntheticPlugin_toConsumableArray(info.analysis));

          if (!_this.atlas.settings.analyzing) {
            _this.atlas.settings.analyzing = true;

            _this.atlas.analyzer();
          }
        }
      }

      if (!Array.isArray(info.eegChannelTags)) info.eegChannelTags = _this.atlas.data.eegshared.eegChannelTags;

      if (info.useFilters === true) {
        info.eegChannelTags.forEach(function (row, i) {
          if (row.tag !== 'other') {
            _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, true, 1));
          } else {
            _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, false, 1));
          } //this.filters[this.filters.length-1].useBp1 = true;

        });
      }
    };

    this._onConnected = function () {};

    this.connect = function () {
      _this._onConnected();

      _this.atlas.data.eegshared.startTime = Date.now();
      _this.atlas.settings.deviceConnected = true;

      if (_this.atlas.settings.analyzing !== true && _this.info.analysis.length > 0) {
        _this.atlas.settings.analyzing = true;
        setTimeout(function () {
          _this.atlas.analyzer();
        }, 1200);
      }

      _this.onconnect();

      _this.simulateData();
    };

    this.disconnect = function () {
      _this.ondisconnect();

      if (_this.ui) _this.ui.deleteNode();
      _this.atlas.settings.deviceConnected = false;

      if ((typeof window === "undefined" ? "undefined" : syntheticPlugin_typeof(window)) != undefined) {
        window.cancelAnimationFrame(_this.loop);
      }

      _this.looping = false;
    };

    this.onconnect = function () {};

    this.ondisconnect = function () {};

    this.addControls = function () {
      var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
      var id = Math.floor(Math.random() * 10000); //prevents any possible overlap with other elements

      if (_this.mode === 'replay') {
        var template = function template() {
          return "\n                ";
        };

        var setup = function setup() {};

        _this.ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
      }
    };

    this.timeCorrection = function (coord, data, timestamp) {
      // Update Sampling Rate for New Data
      var prevTime = coord.times[coord.times.length - 1];
      if (prevTime == null) prevTime = timestamp - data.length / _this.info.sps;
      var timeToSample = (timestamp - prevTime) / data.length;
      _this.info.sps = 1000 / timeToSample; // In Seconds
      // Calculate Time Vector through Linear interpolation

      var time = Array(data.length).fill(timestamp);
      time = time.map(function (t, i) {
        return t - timeToSample * (time.length - i);
      }); // Forward

      return time;
    };

    this.simulateData = function () {
      var delay = 100;

      var simulate = function simulate() {
        if (_this.looping) {
          if (_this.info.useAtlas) {
            var nCh = _this.info.eegChannelTags.length;

            _this.info.eegChannelTags.forEach(function (o, i) {
              var _coord$times, _coord$raw;

              var coord = _this.atlas.getEEGDataByTag(o.tag);

              var prevTime = coord.times[coord.times.length - 1];
              if (isNaN(prevTime)) prevTime = Date.now() - delay;
              var n = Math.floor(_this.info.sps * (Date.now() - prevTime) / 1000);
              var time = Array(n).fill(Date.now());
              time = time.map(function (t, i) {
                return t - _this.info.sps / 1000 * (time.length - i);
              }); // Forward

              var samples = [];
              var minFreq = 1;
              var maxFreq = 40;
              time.forEach(function (t) {
                var f = Math.floor(minFreq + (maxFreq - minFreq) * (i / nCh));
                samples.push(200 * Math.sin(2 * Math.PI * f * t / 1000));
              });

              (_coord$times = coord.times).push.apply(_coord$times, syntheticPlugin_toConsumableArray(time));

              (_coord$raw = coord.raw).push.apply(_coord$raw, samples);

              coord.count += samples.length; // if(this.info.useFilters === true) {                
              //     let latestFiltered = new Array(samples.length).fill(0);
              //     if(this.filters[o.tag] !== undefined) {
              //         samples.forEach((sample,k) => { 
              //             latestFiltered[k] = this.filters[o.tag].apply(sample); 
              //         });
              //     }
              //     console.log(latestFiltered)
              //     coord.filtered.push(...latestFiltered);
              // }
            });
          }

          if (typeof window === 'undefined') {
            setTimeout(function () {
              _this.simulateData;
            }, delay);
          } else {
            setTimeout(_this.loop = requestAnimationFrame(_this.simulateData), delay);
          }
        }
      };

      simulate();
    };

    this.atlas = null;
    this.mode = mode; //syntheticeeg, syntheticheg, replay

    this.device = null; //Invoke a device class here if needed

    this.filters = [];
    this.onconnect = onconnect;
    this.ondisconnect = ondisconnect;
    this.loop;
    this.looping = true;
  }

  syntheticPlugin_createClass(syntheticPlugin, [{
    key: "replayData",
    value: function replayData() {}
  }, {
    key: "addControls",
    value: function addControls() {}
  }]);

  return syntheticPlugin;
}();
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/brainstorm/brainflow.js
function brainflow_toConsumableArray(arr) { return brainflow_arrayWithoutHoles(arr) || brainflow_iterableToArray(arr) || brainflow_unsupportedIterableToArray(arr) || brainflow_nonIterableSpread(); }

function brainflow_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function brainflow_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return brainflow_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return brainflow_arrayLikeToArray(o, minLen); }

function brainflow_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function brainflow_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return brainflow_arrayLikeToArray(arr); }

function brainflow_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

var brainflow = function brainflow(plugin, data) {
  plugin.info.eegChannelTags.forEach(function (o, i) {
    var _coord$raw, _coord$times;

    var coord = plugin.atlas.getEEGDataByChannel(o.ch);
    var currentData = data.raw[i];

    (_coord$raw = coord.raw).push.apply(_coord$raw, brainflow_toConsumableArray(currentData));

    (_coord$times = coord.times).push.apply(_coord$times, brainflow_toConsumableArray(data.times));

    if (plugin.info.useFilters === true) {
      var _coord$filtered;

      var latestFiltered = new Array(currentData.length).fill(0);

      if (plugin.filters[o.ch] !== undefined) {
        currentData.forEach(function (sample, k) {
          latestFiltered[k] = plugin.filters[o.ch].apply(sample);
        });
      }

      (_coord$filtered = coord.filtered).push.apply(_coord$filtered, brainflow_toConsumableArray(latestFiltered));
    }
  });
};
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/brainstorm/brainstormPlugin.js
function brainstormPlugin_toConsumableArray(arr) { return brainstormPlugin_arrayWithoutHoles(arr) || brainstormPlugin_iterableToArray(arr) || brainstormPlugin_unsupportedIterableToArray(arr) || brainstormPlugin_nonIterableSpread(); }

function brainstormPlugin_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function brainstormPlugin_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return brainstormPlugin_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return brainstormPlugin_arrayLikeToArray(o, minLen); }

function brainstormPlugin_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function brainstormPlugin_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return brainstormPlugin_arrayLikeToArray(arr); }

function brainstormPlugin_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function brainstormPlugin_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { brainstormPlugin_typeof = function _typeof(obj) { return typeof obj; }; } else { brainstormPlugin_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return brainstormPlugin_typeof(obj); }

function brainstormPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function brainstormPlugin_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { brainstormPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { brainstormPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function brainstormPlugin_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

//Template system to feed into the deviceStream class for creating possible configurations. 
//Just fill out the template functions accordingly and add this class (with a unique name) to the list of usable devices.




var brainstormPlugin = function brainstormPlugin(mode, session) {
  var _this = this;

  var onconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.onconnect;
  var ondisconnect = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : this.ondisconnect;

  brainstormPlugin_classCallCheck(this, brainstormPlugin);

  this.init = /*#__PURE__*/function () {
    var _ref = brainstormPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(info, pipeToAtlas) {
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _this.info = info;
              return _context.abrupt("return", new Promise(function (resolve, reject) {
                var onAuth = function onAuth() {
                  _this.session.createBrainstormBrowser(document.body, function (userData) {
                    _this.subscription = userData;

                    _this.setupAtlas(info, pipeToAtlas);

                    resolve(true);
                  });
                };

                if (!_this.session.info.auth.authenticated) {
                  _this.session.promptLogin(document.body, onAuth);
                } else {
                  onAuth();
                }
              }));

            case 2:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }();

  this.connect = /*#__PURE__*/brainstormPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
    var animate;
    return regeneratorRuntime.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            // Set Loop to Grab Data
            animate = function animate() {
              // Grab Data
              var data = _this.session.getBrainstormData(_this.subscription.username, 'user');

              if (_this.info.useAtlas) {
                if (data.length > 0) {
                  data.forEach(function (d) {
                    _this.dataHandlers[d.format](_this, d);
                  });
                }
              }

              _this.animation = requestAnimationFrame(animate);
            };

            animate();
            _this.atlas.settings.deviceConnected = true;
            _this.atlas.data.eegshared.startTime = Date.now();
            _this.atlas.settings.deviceConnected = true;

            if (_this.atlas.settings.analyzing !== true && _this.info.analysis.length > 0) {
              _this.atlas.settings.analyzing = true;
              setTimeout(function () {
                _this.atlas.analyzer();
              }, 1200);
            }

            _this.onconnect();

          case 7:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  }));

  this.disconnect = function () {
    _this.ondisconnect();

    if (_this.ui) _this.ui.deleteNode();

    _this.session.unsubscribeFromUser(_this.subscription.username);

    window.cancelAnimationFrame(_this.animation);
    _this.atlas.settings.deviceConnected = false;
  };

  this.setupAtlas = function (info, pipeToAtlas) {
    info.sps = _this.subscription.props.sps;
    info.deviceType = _this.subscription.props.deviceType;
    info.eegChannelTags = _this.subscription.props.eegChannelTags;
    console.log(info.eegChannelTags); // FOR EEG ONLY

    if (pipeToAtlas === true) {
      //New Atlas
      var config = '10_20';
      _this.atlas = new DataAtlas_DataAtlas(location + ":" + _this.mode, {
        eegshared: {
          eegChannelTags: info.eegChannelTags,
          sps: info.sps
        }
      }, config, true, true, info.analysis);
      info.useAtlas = true;
    } else if (brainstormPlugin_typeof(pipeToAtlas) === 'object') {
      //Reusing an atlas
      _this.atlas = pipeToAtlas; //External atlas reference

      _this.atlas.data.eegshared.sps = info.sps;
      _this.atlas.data.eegshared.frequencies = _this.atlas.bandpassWindow(0, 128, info.sps * 0.5);
      _this.atlas.data.eegshared.bandFreqs = _this.atlas.getBandFreqs(_this.atlas.data.eegshared.frequencies);
      _this.atlas.data.eeg = _this.atlas.gen10_20Atlas(info.eegChannelTags);
      _this.atlas.data.coherence = _this.atlas.genCoherenceMap(info.eegChannelTags);
      _this.atlas.settings.coherence = true;
      _this.atlas.settings.eeg = true;
      info.useAtlas = true;

      if (info.analysis.length > 0) {
        var _this$atlas$settings$;

        (_this$atlas$settings$ = _this.atlas.settings.analysis).push.apply(_this$atlas$settings$, brainstormPlugin_toConsumableArray(info.analysis));

        if (!_this.atlas.settings.analyzing) {
          _this.atlas.settings.analyzing = true;

          _this.atlas.analyzer();
        }
      }
    }

    if (info.useFilters === true) {
      info.eegChannelTags.forEach(function (row, i) {
        if (row.tag !== 'other') {
          _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, true, 1));
        } else {
          _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, false, 1));
        }
      });
    }
  };

  this.onconnect = function () {};

  this.ondisconnect = function () {};

  this.addControls = function () {// this.uiid = Math.floor(Math.random()*10000); //prevents any possible overlap with other elements
    // let template = () => {
    //     return `
    //     `;
    // }
    // let setup = () => {
    // }
    // this.ui = new DOMFragment(
    //     template,
    //     parentNode,
    //     undefined,
    //     setup
    // )

    var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
  };

  this.atlas = null;
  this.mode = mode;
  this.session = session;
  this.subscription;
  this.dataHandlers = {
    brainflow: brainflow
  };
  this.device = null; //Invoke a device class here if needed

  this.filters = [];
  this.onconnect = onconnect;
  this.ondisconnect = ondisconnect;
};
// EXTERNAL MODULE: ./node_modules/bci2k/dist/index.js
var dist = __webpack_require__(942);
var dist_default = /*#__PURE__*/__webpack_require__.n(dist);
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/bci2000/bci2000Plugin.js
function bci2000Plugin_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { bci2000Plugin_typeof = function _typeof(obj) { return typeof obj; }; } else { bci2000Plugin_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return bci2000Plugin_typeof(obj); }

function bci2000Plugin_toConsumableArray(arr) { return bci2000Plugin_arrayWithoutHoles(arr) || bci2000Plugin_iterableToArray(arr) || bci2000Plugin_unsupportedIterableToArray(arr) || bci2000Plugin_nonIterableSpread(); }

function bci2000Plugin_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function bci2000Plugin_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return bci2000Plugin_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return bci2000Plugin_arrayLikeToArray(o, minLen); }

function bci2000Plugin_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function bci2000Plugin_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return bci2000Plugin_arrayLikeToArray(arr); }

function bci2000Plugin_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function bci2000Plugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function bci2000Plugin_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { bci2000Plugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { bci2000Plugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function bci2000Plugin_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

//Template system to feed into the deviceStream class for creating possible configurations. 
//Just fill out the template functions accordingly and add this class (with a unique name) to the list of usable devices.




var bci2000Plugin = function bci2000Plugin(mode) {
  var _this = this;

  var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onconnect;
  var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.ondisconnect;

  bci2000Plugin_classCallCheck(this, bci2000Plugin);

  this.init = /*#__PURE__*/function () {
    var _ref = bci2000Plugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(info, pipeToAtlas) {
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              info.sps = 256; // Arbitrary

              info.deviceType = 'eeg';
              _this.info = info;
              return _context.abrupt("return", new Promise(function (resolve, reject) {
                if (_this.mode === 'bci2k_Operator') {
                  var script = "";
                  script += "Reset System; ";
                  script += "Startup System localhost; ";
                  script += "Add State StimulusCode 4 0; ";
                  script += "Add State BrainClick 1 0; ";
                  script += "Add State Baseline 1 0; ";
                  script += "Add State TrialStart 1 0; ";
                  script += "Start executable SignalGenerator; ";
                  script += "Start executable DummyApplication; ";
                  script += "Start executable DummySignalProcessing; ";
                  script += "Set Parameter WSSourceServer *:20100; ";
                  script += "Wait for connected; ";
                  script += "Set Config; ";
                  script += "Start; ";

                  _this.operator.connect("ws://127.0.0.1").then(function () {
                    console.log("Connected to Operator layer through NodeJS server");

                    _this.operator.execute(script);

                    _this.connectToDataLayer(info, pipeToAtlas).then(function (res) {
                      resolve(res);
                    });
                  });
                } else if (_this.mode === 'bci2k_Data') {
                  _this.connectToDataLayer(info, pipeToAtlas).then(function (res) {
                    resolve(res);
                  });
                }
              }));

            case 4:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }();

  this.timeCorrection = function (coord, data, timestamp) {
    var direction = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 'back';
    // Update Sampling Rate for New Data
    var prevTime = coord.times[coord.times.length - 1];
    if (prevTime == null) prevTime = timestamp - data.length / _this.info.sps;
    var timeToSample = (timestamp - prevTime) / data.length;
    _this.info.sps = 1000 / timeToSample; // In Seconds
    // Calculate Time Vector through Linear interpolation

    var time = Array(data.length).fill(timestamp);
    if (direction === 'back') time = time.map(function (t, i) {
      return t - timeToSample * (time.length - i);
    }); // Back
    else time = time.map(function (t, i) {
        return t + timeToSample * i;
      }); // Forward

    return time;
  };

  this.connectToDataLayer = /*#__PURE__*/function () {
    var _ref2 = bci2000Plugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(info, pipeToAtlas) {
      return regeneratorRuntime.wrap(function _callee3$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              return _context3.abrupt("return", new Promise( /*#__PURE__*/function () {
                var _ref3 = bci2000Plugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(resolve, reject) {
                  return regeneratorRuntime.wrap(function _callee2$(_context2) {
                    while (1) {
                      switch (_context2.prev = _context2.next) {
                        case 0:
                          _this.device = new (dist_default()).bciData();

                          _this.device.connect("ws://127.0.0.1:20100").then(function (x) {
                            // Create Event Handlers
                            _this.device.onGenericSignal = function (raw) {
                              if (_this.info.useAtlas) {
                                raw.forEach(function (chData, i) {
                                  var _coord$times, _coord$raw;

                                  var coord = _this.atlas.getEEGDataByChannel(i);

                                  var time = _this.timeCorrection(coord, raw, Date.now(), 'back');

                                  (_coord$times = coord.times).push.apply(_coord$times, bci2000Plugin_toConsumableArray(time));

                                  (_coord$raw = coord.raw).push.apply(_coord$raw, bci2000Plugin_toConsumableArray(chData));

                                  coord.count += chData.length; // if(this.info.useFilters === true) {                
                                  //     let latestFiltered = new Array(chData.length).fill(0);
                                  //     if(this.filters[this.info] !== undefined) {
                                  //         chData.forEach((sample,k) => { 
                                  //             latestFiltered[k] = this.filters[i].apply(sample); 
                                  //         });
                                  //     }
                                  //     coord.filtered.push(...latestFiltered);
                                  // }
                                  // console.log(coord.filtered);
                                });
                              }
                            };

                            _this.device.onStateFormat = function (data) {
                              return console.log(data);
                            };

                            _this.device.onSignalProperties = function (data) {
                              // Check if already created (websocket tends to close and reopen...)
                              if (_this.atlas == null) {
                                // let eegChannelTags = []
                                // data.channels.forEach((t,i) => {
                                //     eegChannelTags.push({ch: i, tag: t, analyze: true})
                                // })
                                _this.info.eegChannelTags = data.channels.length; //eegChannelTags
                                // Create Data Atlas Given Signal Properties

                                //eegChannelTags
                                // Create Data Atlas Given Signal Properties
                                _this.setupAtlas(_this.info, pipeToAtlas); // Validate Connection


                                // Validate Connection
                                _this.onconnect();
                              }

                              resolve(true);
                            };
                          });

                        case 2:
                        case "end":
                          return _context2.stop();
                      }
                    }
                  }, _callee2);
                }));

                return function (_x5, _x6) {
                  return _ref3.apply(this, arguments);
                };
              }()));

            case 1:
            case "end":
              return _context3.stop();
          }
        }
      }, _callee3);
    }));

    return function (_x3, _x4) {
      return _ref2.apply(this, arguments);
    };
  }();

  this.setupAtlas = function (info, pipeToAtlas) {
    if (pipeToAtlas === true) {
      //New Atlas
      var config = '10_20';
      _this.atlas = new DataAtlas_DataAtlas(location + ":" + _this.mode, {
        eegshared: {
          eegChannelTags: info.eegChannelTags,
          sps: info.sps
        }
      }, config, true, true, info.analysis);
      info.useAtlas = true;
    } else if (bci2000Plugin_typeof(pipeToAtlas) === 'object') {
      //Reusing an atlas
      _this.atlas = pipeToAtlas; //External atlas reference

      _this.atlas.data.eegshared.eegChannelTags = info.eegChannelTags;
      _this.atlas.data.eegshared.sps = info.sps;
      _this.atlas.data.eegshared.frequencies = _this.atlas.bandpassWindow(0, 128, info.sps * 0.5);
      _this.atlas.data.eegshared.bandFreqs = _this.atlas.getBandFreqs(_this.atlas.data.eegshared.frequencies);
      _this.atlas.data.eeg = _this.atlas.genMuseAtlas();
      _this.atlas.data.coherence = _this.atlas.genCoherenceMap(info.eegChannelTags);
      _this.atlas.settings.coherence = true;
      _this.atlas.settings.eeg = true;
      info.useAtlas = true;

      if (info.analysis.length > 0) {
        var _this$atlas$settings$;

        (_this$atlas$settings$ = _this.atlas.settings.analysis).push.apply(_this$atlas$settings$, bci2000Plugin_toConsumableArray(info.analysis));

        if (!_this.atlas.settings.analyzing) {
          _this.atlas.settings.analyzing = true;

          _this.atlas.analyzer();
        }
      }
    } // Auto-assign channel tags


    if (!Array.isArray(info.eegChannelTags)) info.eegChannelTags = _this.atlas.data.eegshared.eegChannelTags;
    console.log(info.eegChannelTags); // Create Filters

    if (info.useFilters === true) {
      info.eegChannelTags.forEach(function (row, i) {
        _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, true, 1));
      });
    }

    _this.atlas.data.eegshared.startTime = Date.now();
    _this.atlas.settings.deviceConnected = true;

    if (_this.atlas.settings.analyzing !== true && _this.info.analysis.length > 0) {
      _this.atlas.settings.analyzing = true;
      setTimeout(function () {
        _this.atlas.analyzer();
      }, 1200);
    }
  };

  this._onConnected = function () {};

  this.connect = function () {};

  this.disconnect = function () {
    if (_this.ui) _this.ui.deleteNode();

    _this.ondisconnect(); //ondisconnected: this.atlas.settings.deviceConnected = false;

  };

  this.onconnect = function () {};

  this.ondisconnect = function () {};

  this.addControls = function () {
    var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
    var id = Math.floor(Math.random() * 10000); //prevents any possible overlap with other elements

    var template = function template() {
      return "\n            ";
    };

    var setup = function setup() {};

    _this.ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
  };

  this.atlas = null;
  this.mode = mode;
  this.operator = new (dist_default()).bciOperator(); //Invoke a device class here if needed

  this.filters = [];
  this.onconnect = onconnect;
  this.ondisconnect = ondisconnect;
};
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/8ch_prototype/8ch_prototype.js
function _8ch_prototype_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _8ch_prototype_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { _8ch_prototype_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { _8ch_prototype_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function _8ch_prototype_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _8ch_prototype_typeof = function _typeof(obj) { return typeof obj; }; } else { _8ch_prototype_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _8ch_prototype_typeof(obj); }

function _8ch_prototype_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _8ch_prototype_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _8ch_prototype_createClass(Constructor, protoProps, staticProps) { if (protoProps) _8ch_prototype_defineProperties(Constructor.prototype, protoProps); if (staticProps) _8ch_prototype_defineProperties(Constructor, staticProps); return Constructor; }

//Joshua Brewster, GPL (copyleft)
 //For async functions on node\\

var industryKiller = /*#__PURE__*/function () {
  //Contains structs and necessary functions/API calls to analyze serial data for the FreeEEG32
  function industryKiller() {
    var onDecodedCallback = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.onDecodedCallback;
    var onConnectedCallback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onConnectedCallback;
    var onDisconnectedCallback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.onDisconnectedCallback;
    var CustomDecoder = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : this.decode;
    var baudrate = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 10000000;

    _8ch_prototype_classCallCheck(this, industryKiller);

    this.onDecodedCallback = onDecodedCallback;
    this.onConnectedCallback = onConnectedCallback;
    this.onDisconnectedCallback = onDisconnectedCallback;
    this.decode = CustomDecoder; //Free EEG 32 data structure:

    /*
        [stop byte, start byte, counter byte, 32x3 channel data bytes (24 bit), 3x2 accelerometer data bytes, stop byte, start byte...] Gyroscope not enabled yet but would be printed after the accelerometer..
        Total = 105 bytes/line
    */

    this.connected = false;
    this.subscribed = false;
    this.buffer = "";
    this.startByte = 160; // Start byte value

    this.stopByte = 192; // Stop byte value

    this.searchString = new Uint8Array([this.stopByte, this.startByte]); //Byte search string

    this.readRate = 1; //Throttle EEG read speed. (1.953ms/sample min @103 bytes/line)

    this.readBufferSize = 2000; //Serial read buffer size, increase for slower read speeds (~1030bytes every 20ms) to keep up with the stream (or it will crash)

    this.decoder = new TextDecoder();
    this.sps = 500; // Sample rate

    this.nChannels = 32;
    this.nPeripheralChannels = 6; // accelerometer and gyroscope (2 bytes * 3 coordinates each)

    this.updateMs = 1000 / this.sps; //even spacing

    this.stepSize = 1 / Math.pow(2, 24);
    this.vref = 1.20; //2.5V voltage ref +/- 250nV

    this.gain = 32;
    this.vscale = this.vref / this.gain * this.stepSize; //volts per step.

    this.uVperStep = 1000000 * (this.vref / this.gain * this.stepSize); //uV per step.

    this.scalar = 1 / (1000000 / (this.vref / this.gain * this.stepSize)); //steps per uV.

    this.maxBufferedSamples = this.sps * 60 * 2; //max samples in buffer this.sps*60*nMinutes = max minutes of data

    this.data = {
      //Data object to keep our head from exploding. Get current data with e.g. this.data.A0[this.data.count-1]
      count: 0,
      startms: 0,
      ms: [],
      'A0': [],
      'A1': [],
      'A2': [],
      'A3': [],
      'A4': [],
      'A5': [],
      'A6': [],
      'A7': [] //ADC 0

    };
    this.resetDataBuffers(); //navigator.serial utils

    if (!navigator.serial) {
      console.error("`navigator.serial not found! Enable #enable-experimental-web-platform-features in chrome://flags (search 'experimental')");
    }

    this.port = null;
    this.reader = null;
    this.baudrate = baudrate;
  }

  _8ch_prototype_createClass(industryKiller, [{
    key: "resetDataBuffers",
    value: function resetDataBuffers() {
      this.data.count = 0;
      this.data.startms = 0;

      for (var prop in this.data) {
        if (_8ch_prototype_typeof(this.data[prop]) === "object") {
          this.data[prop] = new Array(this.maxBufferedSamples).fill(0);
        }
      }
    }
  }, {
    key: "setScalar",
    value: function setScalar() {
      var gain = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 24;
      var stepSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1 / (Math.pow(2, 23) - 1);
      var vref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 4.50;
      this.stepSize = stepSize;
      this.vref = vref; //2.5V voltage ref +/- 250nV

      this.gain = gain;
      this.vscale = this.vref / this.gain * this.stepSize; //volts per step.

      this.uVperStep = 1000000 * (this.vref / this.gain * this.stepSize); //uV per step.

      this.scalar = 1 / (1000000 / (this.vref / this.gain * this.stepSize)); //steps per uV.
    }
  }, {
    key: "getLatestData",
    value: function getLatestData() {
      var channel = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "A0";
      var count = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      //Return slice of specified size of the latest data from the specified channel
      var ct = count;

      if (ct <= 1) {
        return this.data[channel][this.data.count - 1];
      } else {
        if (ct > this.data.count) {
          ct = this.data.count;
        }

        return this.data[channel].slice(this.data.count - ct, this.data.count);
      }
    }
  }, {
    key: "bytesToInt16",
    value: function bytesToInt16(x0, x1) {
      return x0 * 256 + x1;
    }
  }, {
    key: "int16ToBytes",
    value: function int16ToBytes(y) {
      //Turns a 24 bit int into a 3 byte sequence
      return [y & 0xFF, y >> 8 & 0xFF];
    }
  }, {
    key: "bytesToInt24",
    value: function bytesToInt24(x0, x1, x2) {
      //Turns a 3 byte sequence into a 24 bit int
      return x0 * 65536 + x1 * 256 + x2;
    }
  }, {
    key: "int24ToBytes",
    value: function int24ToBytes(y) {
      //Turns a 24 bit int into a 3 byte sequence
      return [y & 0xFF, y >> 8 & 0xFF, y >> 16 & 0xFF];
    } // onReceiveAsync(value) {
    //     this.encodedBuffer += this.decoder.decode(value);
    //     var index;
    //     while ((index = this.encodedBuffer.indexOf('\n')) >= 0) {
    //         var line = this.encodedBuffer.substr(0, index + 1);
    //         if(this.recordData == true) {
    //             this.recorded.push(line);
    //         }
    //         if(this.monitoring = true){
    //             this.newSamples++;
    //             this.monitorData.push(line);
    //         }
    //         this.onReadLine(line);
    //         this.encodedBuffer = this.encodedBuffer.substr(index + 1);
    //     }
    // }

  }, {
    key: "decode",
    value: function decode() {
      //returns true if successful, returns false if not
      var index;

      while ((index = this.buffer.indexOf('\n')) >= 0) {
        var line = this.buffer.substr(0, index + 1).split('|');

        if (line.length > 6) {
          this.data.count++;
          this.data.ms[this.data.count - 1] = parseInt(line[8]);
          if (this.startms === 0) this.startms = this.data.ms[0];
          this.data.A0[this.data.count - 1] = parseInt(line[0]);
          this.data.A1[this.data.count - 1] = parseInt(line[1]);
          this.data.A2[this.data.count - 1] = parseInt(line[2]);
          this.data.A3[this.data.count - 1] = parseInt(line[3]);
          this.data.A4[this.data.count - 1] = parseInt(line[4]);
          this.data.A5[this.data.count - 1] = parseInt(line[5]);
          this.data.A6[this.data.count - 1] = parseInt(line[6]);
          this.data.A7[this.data.count - 1] = parseInt(line[7]);

          if (this.data.count > this.maxBufferedSamples) {
            for (var prop in this.data) {
              if (Array.isArray(this.data[prop])) {
                this.data[prop].splice(0, 5120);
                this.data[prop].push(new Array(5120).fill(0));
              }
            }

            this.data.count -= 5120;
          }

          this.onDecodedCallback(this.data.count);
        }

        this.buffer = this.buffer.substr(index + 1);
      } //console.log(this.data.count,this.data.A0);

    } //Callbacks

  }, {
    key: "onDecodedCallback",
    value: function onDecodedCallback(newLinesInt) {//console.log("new samples:", newLinesInt);
    }
  }, {
    key: "onConnectedCallback",
    value: function onConnectedCallback() {
      console.log("port connected!");
    }
  }, {
    key: "onDisconnectedCallback",
    value: function onDisconnectedCallback() {
      console.log("port disconnected!");
    }
  }, {
    key: "onReceive",
    value: function onReceive(value) {
      this.buffer += this.decoder.decode(value);
      this.decode();
    }
  }, {
    key: "onPortSelected",
    value: function () {
      var _onPortSelected = _8ch_prototype_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(port) {
        var baud,
            _args = arguments;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                baud = _args.length > 1 && _args[1] !== undefined ? _args[1] : this.baudrate;
                _context.prev = 1;
                _context.prev = 2;
                _context.next = 5;
                return port.open({
                  baudRate: baud,
                  bufferSize: this.readBufferSize
                });

              case 5:
                this.onConnectedCallback();
                this.connected = true;
                this.subscribed = true;
                this.subscribe(port); //this.subscribeSafe(port);

                _context.next = 19;
                break;

              case 11:
                _context.prev = 11;
                _context.t0 = _context["catch"](2);
                _context.next = 15;
                return port.open({
                  baudrate: baud,
                  buffersize: this.readBufferSize
                });

              case 15:
                this.onConnectedCallback();
                this.connected = true;
                this.subscribed = true;
                this.subscribe(port); //this.subscribeSafe(port);

              case 19:
                _context.next = 25;
                break;

              case 21:
                _context.prev = 21;
                _context.t1 = _context["catch"](1);
                console.log(_context.t1);
                this.connected = false;

              case 25:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[1, 21], [2, 11]]);
      }));

      function onPortSelected(_x) {
        return _onPortSelected.apply(this, arguments);
      }

      return onPortSelected;
    }()
  }, {
    key: "subscribe",
    value: function () {
      var _subscribe = _8ch_prototype_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5(port) {
        var _this = this;

        var streamData;
        return regeneratorRuntime.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                if (this.port.readable && this.subscribed === true) {
                  this.reader = port.readable.getReader();

                  streamData = /*#__PURE__*/function () {
                    var _ref = _8ch_prototype_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {
                      var _yield$_this$reader$r, value, done;

                      return regeneratorRuntime.wrap(function _callee4$(_context4) {
                        while (1) {
                          switch (_context4.prev = _context4.next) {
                            case 0:
                              _context4.prev = 0;
                              _context4.next = 3;
                              return _this.reader.read();

                            case 3:
                              _yield$_this$reader$r = _context4.sent;
                              value = _yield$_this$reader$r.value;
                              done = _yield$_this$reader$r.done;

                              if (!(done || _this.subscribed === false)) {
                                _context4.next = 9;
                                break;
                              }

                              _context4.next = 9;
                              return _this.reader.releaseLock();

                            case 9:
                              if (value) {
                                //console.log(value.length);
                                try {
                                  _this.onReceive(value);
                                } catch (err) {
                                  console.log(err);
                                } //console.log("new Read");
                                //console.log(this.decoder.decode(value));

                              }

                              if (_this.subscribed === true) {
                                setTimeout(function () {
                                  streamData();
                                }, _this.readRate); //Throttled read 1/512sps = 1.953ms/sample @ 103 bytes / line or 1030bytes every 20ms
                              }

                              _context4.next = 17;
                              break;

                            case 13:
                              _context4.prev = 13;
                              _context4.t0 = _context4["catch"](0);
                              console.log(_context4.t0); // TODO: Handle non-fatal read error.

                              if (_context4.t0.message.includes('framing') || _context4.t0.message.includes('overflow') || _context4.t0.message.includes('overrun') || _context4.t0.message.includes('Overflow') || _context4.t0.message.includes('break')) {
                                _this.subscribed = false;
                                setTimeout( /*#__PURE__*/_8ch_prototype_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
                                  return regeneratorRuntime.wrap(function _callee2$(_context2) {
                                    while (1) {
                                      switch (_context2.prev = _context2.next) {
                                        case 0:
                                          if (!_this.reader) {
                                            _context2.next = 4;
                                            break;
                                          }

                                          _context2.next = 3;
                                          return _this.reader.releaseLock();

                                        case 3:
                                          _this.reader = null;

                                        case 4:
                                          _this.subscribed = true;

                                          _this.subscribe(port); //if that fails then close port and reopen it


                                        case 6:
                                        case "end":
                                          return _context2.stop();
                                      }
                                    }
                                  }, _callee2);
                                })), 30); //try to resubscribe 
                              } else if (_context4.t0.message.includes('parity') || _context4.t0.message.includes('Parity')) {
                                if (_this.port) {
                                  _this.subscribed = false;
                                  setTimeout( /*#__PURE__*/_8ch_prototype_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {
                                    return regeneratorRuntime.wrap(function _callee3$(_context3) {
                                      while (1) {
                                        switch (_context3.prev = _context3.next) {
                                          case 0:
                                            if (!_this.reader) {
                                              _context3.next = 4;
                                              break;
                                            }

                                            _context3.next = 3;
                                            return _this.reader.releaseLock();

                                          case 3:
                                            _this.reader = null;

                                          case 4:
                                            _context3.next = 6;
                                            return port.close();

                                          case 6:
                                            //this.port = null;
                                            _this.connected = false;
                                            setTimeout(function () {
                                              _this.onPortSelected(_this.port);
                                            }, 100); //close the port and reopen

                                          case 8:
                                          case "end":
                                            return _context3.stop();
                                        }
                                      }
                                    }, _callee3);
                                  })), 50);
                                }
                              } else {
                                _this.closePort();
                              }

                            case 17:
                            case "end":
                              return _context4.stop();
                          }
                        }
                      }, _callee4, null, [[0, 13]]);
                    }));

                    return function streamData() {
                      return _ref.apply(this, arguments);
                    };
                  }();

                  streamData();
                }

              case 1:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function subscribe(_x2) {
        return _subscribe.apply(this, arguments);
      }

      return subscribe;
    }() //Unfinished

  }, {
    key: "subscribeSafe",
    value: function () {
      var _subscribeSafe = _8ch_prototype_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6(port) {
        var _this2 = this;

        var readable;
        return regeneratorRuntime.wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                //Using promises instead of async/await to cure hangs when the serial update does not meet tick requirements
                readable = new Promise(function (resolve, reject) {
                  while (_this2.port.readable && _this2.subscribed === true) {
                    _this2.reader = port.readable.getReader();
                    var looper = true;
                    var prom1 = new Promise(function (resolve, reject) {
                      return _this2.reader.read();
                    });
                    var prom2 = new Promise(function (resolve, reject) {
                      setTimeout(resolve, 100, "readfail");
                    });

                    while (looper === true) {
                      //console.log("reading...");
                      Promise.race([prom1, prom2]).then(function (result) {
                        console.log("newpromise");

                        if (result === "readfail") {
                          console.log(result);
                        } else {
                          var value = result.value,
                              done = result.done;

                          if (done === true || _this2.subscribed === true) {
                            var donezo = new Promise(function (resolve, reject) {
                              resolve(_this2.reader.releaseLock());
                            }).then(function () {
                              looper = false;
                              return;
                            });
                          } else {
                            _this2.onReceive(value);
                          }
                        }
                      });
                    }
                  }

                  resolve("not readable");
                });

              case 1:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6);
      }));

      function subscribeSafe(_x3) {
        return _subscribeSafe.apply(this, arguments);
      }

      return subscribeSafe;
    }()
  }, {
    key: "closePort",
    value: function () {
      var _closePort = _8ch_prototype_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee8() {
        var _this3 = this;

        var port,
            _args8 = arguments;
        return regeneratorRuntime.wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                port = _args8.length > 0 && _args8[0] !== undefined ? _args8[0] : this.port;

                //if(this.reader) {this.reader.releaseLock();}
                if (this.port) {
                  this.subscribed = false;
                  setTimeout( /*#__PURE__*/_8ch_prototype_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7() {
                    return regeneratorRuntime.wrap(function _callee7$(_context7) {
                      while (1) {
                        switch (_context7.prev = _context7.next) {
                          case 0:
                            if (!_this3.reader) {
                              _context7.next = 4;
                              break;
                            }

                            _context7.next = 3;
                            return _this3.reader.releaseLock();

                          case 3:
                            _this3.reader = null;

                          case 4:
                            _context7.next = 6;
                            return port.close();

                          case 6:
                            _this3.port = null;
                            _this3.connected = false;

                            _this3.onDisconnectedCallback();

                          case 9:
                          case "end":
                            return _context7.stop();
                        }
                      }
                    }, _callee7);
                  })), 100);
                }

              case 2:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function closePort() {
        return _closePort.apply(this, arguments);
      }

      return closePort;
    }()
  }, {
    key: "setupSerialAsync",
    value: function () {
      var _setupSerialAsync = _8ch_prototype_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee9() {
        var _this4 = this;

        var baudrate,
            filters,
            _args9 = arguments;
        return regeneratorRuntime.wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                baudrate = _args9.length > 0 && _args9[0] !== undefined ? _args9[0] : this.baudrate;
                //You can specify baudrate just in case
                filters = [{
                  usbVendorId: 0x10c4,
                  usbProductId: 0x0043
                } //CP2102 filter (e.g. for UART via ESP32)
                ];
                _context9.next = 4;
                return navigator.serial.requestPort();

              case 4:
                this.port = _context9.sent;
                navigator.serial.addEventListener("disconnect", function (e) {
                  _this4.closePort(_this4.port);
                });
                this.onPortSelected(this.port, baudrate); //navigator.serial.addEventListener("onReceive", (e) => {console.log(e)});//this.onReceive(e));

              case 7:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function setupSerialAsync() {
        return _setupSerialAsync.apply(this, arguments);
      }

      return setupSerialAsync;
    }() //Boyer Moore fast byte search method copied from https://codereview.stackexchange.com/questions/20136/uint8array-indexof-method-that-allows-to-search-for-byte-sequences

  }, {
    key: "asUint8Array",
    value: function asUint8Array(input) {
      if (input instanceof Uint8Array) {
        return input;
      } else if (typeof input === 'string') {
        // This naive transform only supports ASCII patterns. UTF-8 support
        // not necessary for the intended use case here.
        var arr = new Uint8Array(input.length);

        for (var i = 0; i < input.length; i++) {
          var c = input.charCodeAt(i);

          if (c > 127) {
            throw new TypeError("Only ASCII patterns are supported");
          }

          arr[i] = c;
        }

        return arr;
      } else {
        // Assume that it's already something that can be coerced.
        return new Uint8Array(input);
      }
    }
  }, {
    key: "boyerMoore",
    value: function boyerMoore(patternBuffer) {
      var _this5 = this;

      // Implementation of Boyer-Moore substring search ported from page 772 of
      // Algorithms Fourth Edition (Sedgewick, Wayne)
      // http://algs4.cs.princeton.edu/53substring/BoyerMoore.java.html

      /*
      USAGE:
      	// needle should be ASCII string, ArrayBuffer, or Uint8Array
      	// haystack should be an ArrayBuffer or Uint8Array
      	var search = boyerMoore(needle);
      	var skip = search.byteLength;
      	var indices = [];
      	for (var i = search(haystack); i !== -1; i = search(haystack, i + skip)) {
      		indices.push(i);
      	}
      */
      var pattern = this.asUint8Array(patternBuffer);
      var M = pattern.length;

      if (M === 0) {
        throw new TypeError("patternBuffer must be at least 1 byte long");
      } // radix


      var R = 256;
      var rightmost_positions = new Int32Array(R); // position of the rightmost occurrence of the byte c in the pattern

      for (var c = 0; c < R; c++) {
        // -1 for bytes not in pattern
        rightmost_positions[c] = -1;
      }

      for (var j = 0; j < M; j++) {
        // rightmost position for bytes in pattern
        rightmost_positions[pattern[j]] = j;
      }

      var boyerMooreSearch = function boyerMooreSearch(txtBuffer, start, end) {
        // Return offset of first match, -1 if no match.
        var txt = _this5.asUint8Array(txtBuffer);

        if (start === undefined) start = 0;
        if (end === undefined) end = txt.length;
        var pat = pattern;
        var right = rightmost_positions;
        var lastIndex = end - pat.length;
        var lastPatIndex = pat.length - 1;
        var skip;

        for (var i = start; i <= lastIndex; i += skip) {
          skip = 0;

          for (var j = lastPatIndex; j >= 0; j--) {
            var c = txt[i + j];

            if (pat[j] !== c) {
              skip = Math.max(1, j - right[c]);
              break;
            }
          }

          if (skip === 0) {
            return i;
          }
        }

        return -1;
      };

      boyerMooreSearch.byteLength = pattern.byteLength;
      return boyerMooreSearch;
    } //---------------------end copy/pasted solution------------------------

  }]);

  return industryKiller;
}();
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/8ch_prototype/8chPlugin.js
function _8chPlugin_toConsumableArray(arr) { return _8chPlugin_arrayWithoutHoles(arr) || _8chPlugin_iterableToArray(arr) || _8chPlugin_unsupportedIterableToArray(arr) || _8chPlugin_nonIterableSpread(); }

function _8chPlugin_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _8chPlugin_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _8chPlugin_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _8chPlugin_arrayLikeToArray(o, minLen); }

function _8chPlugin_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function _8chPlugin_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _8chPlugin_arrayLikeToArray(arr); }

function _8chPlugin_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _8chPlugin_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _8chPlugin_typeof = function _typeof(obj) { return typeof obj; }; } else { _8chPlugin_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _8chPlugin_typeof(obj); }

function _8chPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _8chPlugin_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { _8chPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { _8chPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function _8chPlugin_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

//Template system to feed into the deviceStream class for creating possible configurations. 
//Just fill out the template functions accordingly and add this class (with a unique name) to the list of usable devices.




var Prototype8Plugin = function Prototype8Plugin(mode) {
  var _this = this;

  var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onconnect;
  var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.ondisconnect;

  _8chPlugin_classCallCheck(this, Prototype8Plugin);

  this.init = /*#__PURE__*/function () {
    var _ref = _8chPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(info, pipeToAtlas) {
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              info.sps = 500;
              info.deviceType = 'eeg'; //this._onConnected = () => { this.setupAtlas(info,pipeToAtlas); }

              info.eegChannelTags = [{
                ch: 0,
                tag: "FP1",
                analyze: true
              }, {
                ch: 1,
                tag: "FP2",
                analyze: true
              }, {
                ch: 2,
                tag: "FZ",
                analyze: true
              }, {
                ch: 3,
                tag: "C3",
                analyze: true
              }, {
                ch: 5,
                tag: "C4",
                analyze: true
              }, {
                ch: 6,
                tag: "O1",
                analyze: true
              }, {
                ch: 7,
                tag: "O2",
                analyze: true
              }];
              _this.device = new industryKiller(function (ct) {
                if (ct) {
                  _this.atlas.data.eegshared.eegChannelTags.forEach(function (o, i) {
                    var latest = _this.device.getLatestData("A" + o.ch, 1);

                    var latestFiltered = 0;

                    if (o.tag !== "other" && info.useFilters === true) {
                      _this.filters.find(function (f, j) {
                        if (f.channel === o.ch) {
                          latestFiltered = f.apply(latest);
                          return true;
                        }
                      });

                      if (info.useAtlas === true) {
                        var coord;

                        if (o.tag !== null) {
                          coord = _this.atlas.getEEGDataByTag(o.tag);
                        } else {
                          coord = _this.atlas.getEEGDataByChannel(o.ch);
                        }

                        coord.count++;
                        coord.times.push(_this.device.data.ms[ct]);
                        coord.filtered.push(latestFiltered);
                        coord.raw.push(latest);
                      }
                    } else {
                      if (info.useAtlas === true) {
                        var _coord = _this.atlas.getEEGDataByChannel(o.ch);

                        _coord.count += newLinesInt;

                        _coord.times.push(_this.device.data.ms[ct]);

                        _coord.raw.push(latest);
                      }
                    }
                  });
                }
              }, function () {
                _this.setupAtlas(pipeToAtlas, info);

                if (info.useAtlas === true) {
                  _this.atlas.data.eegshared.startTime = Date.now();

                  if (_this.atlas.settings.analyzing !== true && info.analysis.length > 0) {
                    _this.atlas.settings.analyzing = true;
                    _this.atlas.settings.deviceConnected = true;
                    setTimeout(function () {
                      _this.atlas.analyzer();
                    }, 1200);
                  }

                  _this.onconnect();
                }
              }, function () {
                _this.atlas.settings.analyzing = false;

                _this.ondisconnect();
              });

            case 4:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }();

  this.setupAtlas = function (pipeToAtlas, info) {
    if (info.useFilters === true) {
      info.eegChannelTags.forEach(function (row, i) {
        if (row.tag !== 'other') {
          _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, true, _this.device.uVperStep));
        } else {
          _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, false, _this.device.uVperStep));
        }

        _this.filters[_this.filters.length - 1].useScaling = true; //this.filters[this.filters.length-1].useBp1 = true;
      });
    }

    if (pipeToAtlas === true) {
      var config = '10_20';
      _this.atlas = new DataAtlas_DataAtlas(location + ":" + _this.mode, {
        eegshared: {
          eegChannelTags: info.eegChannelTags,
          sps: info.sps
        }
      }, config, true, true, info.analysis);
      info.useAtlas = true;
    } else if (_8chPlugin_typeof(pipeToAtlas) === 'object') {
      _this.atlas = pipeToAtlas; //External atlas reference

      _this.atlas.data.eegshared.eegChannelTags = info.eegChannelTags;
      _this.atlas.data.eegshared.sps = info.sps;
      _this.atlas.data.eegshared.frequencies = _this.atlas.bandpassWindow(0, 128, info.sps * 0.5);
      _this.atlas.data.eegshared.bandFreqs = _this.atlas.getBandFreqs(_this.atlas.data.eegshared.frequencies);
      _this.atlas.data.eeg = _this.atlas.gen10_20Atlas();
      _this.atlas.data.coherence = _this.atlas.genCoherenceMap(info.eegChannelTags);

      _this.atlas.data.eegshared.eegChannelTags.forEach(function (row, i) {
        if (_this.atlas.getEEGDataByTag(row.tag) === undefined) {
          _this.atlas.addEEGCoord(row.ch);
        }
      });

      _this.atlas.settings.coherence = true;
      _this.atlas.settings.eeg = true;
      info.useAtlas = true;

      if (info.analysis.length > 0) {
        var _this$atlas$settings$;

        (_this$atlas$settings$ = _this.atlas.settings.analysis).push.apply(_this$atlas$settings$, _8chPlugin_toConsumableArray(info.analysis));

        if (!_this.atlas.settings.analyzing) {
          _this.atlas.settings.analyzing = true;

          _this.atlas.analyzer();
        }
      }
    }
  };

  this._onConnected = function () {};

  this.connect = function () {
    //Insert connection protocols here...
    _this.device.setupSerialAsync(1000000); //Setup Atlas via this callback AFTER connection is confirmed, you may need to move this or create an additional callback
    //this._onConnected();
    //run callbacks
    //this.onconnect();
    //onconnected: this.atlas.settings.deviceConnected = true;

  };

  this.disconnect = function () {
    _this.device.closePort(); //this.ondisconnect();
    //ondisconnected: this.atlas.settings.deviceConnected = false;

  };

  this.onconnect = function () {};

  this.ondisconnect = function () {};

  this.addControls = function () {
    var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
    var id = Math.floor(Math.random() * 10000); //prevents any possible overlap with other elements

    var template = function template() {
      return "\n            ";
    };

    var setup = function setup() {};

    _this.ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
  };

  this.atlas = null;
  this.mode = mode;
  this.device = null; //Invoke a device class here if needed

  this.filters = [];
  this.onconnect = onconnect;
  this.ondisconnect = ondisconnect;
};
// EXTERNAL MODULE: ./node_modules/@neurosity/notion/dist/browser/notion.js
var notion = __webpack_require__(9954);
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/neurosity/notionPlugin.js
function notionPlugin_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = notionPlugin_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }

function notionPlugin_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { notionPlugin_typeof = function _typeof(obj) { return typeof obj; }; } else { notionPlugin_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return notionPlugin_typeof(obj); }

function notionPlugin_toConsumableArray(arr) { return notionPlugin_arrayWithoutHoles(arr) || notionPlugin_iterableToArray(arr) || notionPlugin_unsupportedIterableToArray(arr) || notionPlugin_nonIterableSpread(); }

function notionPlugin_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function notionPlugin_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return notionPlugin_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return notionPlugin_arrayLikeToArray(o, minLen); }

function notionPlugin_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function notionPlugin_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return notionPlugin_arrayLikeToArray(arr); }

function notionPlugin_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function notionPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function notionPlugin_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { notionPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { notionPlugin_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function notionPlugin_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

//Template system to feed into the deviceStream class for creating possible configurations. 
//Just fill out the template functions accordingly and add this class (with a unique name) to the list of usable devices.




var notionPlugin = function notionPlugin(mode) {
  var _this = this;

  var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.onconnect;
  var ondisconnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.ondisconnect;

  notionPlugin_classCallCheck(this, notionPlugin);

  this.init = /*#__PURE__*/function () {
    var _ref = notionPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(info, pipeToAtlas) {
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              // NEUROSITY
              _this.device = new notion.Notion({
                autoSelectDevice: false
              });
              _this.info = info;
              return _context.abrupt("return", new Promise(function (resolve, reject) {
                var onAuth = function onAuth(success) {
                  _this.setupAtlas(info, pipeToAtlas).then(function () {
                    resolve(true);
                  });
                };

                _this.promptLogin(document.body, onAuth);
              }));

            case 3:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }();

  this.timeCorrection = function (coord, data, timestamp) {
    var direction = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 'back';
    // Update Sampling Rate for New Data
    var prevTime = coord.times[coord.times.length - 1];
    if (prevTime == null) prevTime = timestamp - data.length / _this.info.sps;
    var timeToSample = (timestamp - prevTime) / data.length;
    _this.info.sps = 1000 / timeToSample; // In Seconds
    // Calculate Time Vector through Linear interpolation

    var time = Array(data.length).fill(timestamp);
    if (direction === 'back') time = time.map(function (t, i) {
      return t - timeToSample * (time.length - i);
    }); // Back
    else time = time.map(function (t, i) {
        return t + timeToSample * i;
      }); // Forward

    return time;
  };

  this.connect = /*#__PURE__*/notionPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
    return regeneratorRuntime.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            _this.device.brainwaves('raw').subscribe(function (brainwaves) {
              console.log(brainwaves);
              var raw = brainwaves.data;

              if (_this.info.useAtlas) {
                raw.forEach(function (data, i) {
                  var _coord$times, _coord$raw;

                  var coord = _this.atlas.getEEGDataByChannel(i);

                  var time = _this.timeCorrection(coord, data, brainwaves.info.startTime); // Push to Atlas


                  (_coord$times = coord.times).push.apply(_coord$times, notionPlugin_toConsumableArray(time));

                  (_coord$raw = coord.raw).push.apply(_coord$raw, notionPlugin_toConsumableArray(data));

                  coord.count += data.length; // Filter Data

                  if (_this.info.useFilters === true) {
                    var _coord$filtered;

                    var latestFiltered = new Array(data.length).fill(0);

                    if (_this.filters[i] !== undefined) {
                      data.forEach(function (sample, k) {
                        latestFiltered[k] = _this.filters[i].apply(sample);
                      });
                    }

                    (_coord$filtered = coord.filtered).push.apply(_coord$filtered, notionPlugin_toConsumableArray(latestFiltered));
                  }
                });
              }
            }); // // Calm
            // this.device.calm().subscribe(({probability}) => {
            //     console.log('calm', probability)
            // });
            // // Focus
            // this.device.focus().subscribe(({probability}) => {
            //     console.log('focus', probability);
            // });
            // // Kinesis
            // this.device.kinesis("rightArm").subscribe(intent => {
            //     console.log(intent);
            // });
            // Signal Quality
            // notion.signalQuality().subscribe(signalQuality => {
            //     console.log(signalQuality);
            // });


            _this.atlas.data.eegshared.startTime = Date.now();
            _this.atlas.settings.deviceConnected = true;

            if (_this.atlas.settings.analyzing !== true && _this.info.analysis.length > 0) {
              _this.atlas.settings.analyzing = true;
              setTimeout(function () {
                _this.atlas.analyzer();
              }, 1200);
            }

            _this.onconnect();

          case 5:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  }));

  this.disconnect = function () {
    _this.device.disconnect();

    _this.device.logout().then(function () {
      console.log('logged out');
    })["catch"](function (error) {
      console.error("Log out error", error);
    });

    if (_this.connected) {
      document.getElementById("brainsatplay-header-".concat(_this.mode.split('_')[0])).innerHTML = 'Notion';

      _this.ondisconnect();

      if (_this.ui) _this.ui.deleteNode();
      _this.atlas.settings.deviceConnected = false;
    }
  };

  this.setupAtlas = /*#__PURE__*/function () {
    var _ref3 = notionPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(info, pipeToAtlas) {
      var notionInfo, config, _this$atlas$settings$;

      return regeneratorRuntime.wrap(function _callee3$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              _context3.next = 2;
              return _this.device.getInfo();

            case 2:
              notionInfo = _context3.sent;
              info.sps = notionInfo.samplingRate;
              info.deviceType = 'eeg';
              info.eegChannelTags = [];
              notionInfo.channelNames.forEach(function (t, i) {
                info.eegChannelTags.push({
                  tag: t,
                  ch: i,
                  analyze: true
                });
              }); // FOR EEG ONLY

              if (pipeToAtlas === true) {
                //New Atlas
                config = '10_20';
                _this.atlas = new DataAtlas_DataAtlas(location + ":" + _this.mode, {
                  eegshared: {
                    eegChannelTags: info.eegChannelTags,
                    sps: info.sps
                  }
                }, config, true, true, info.analysis);
                info.useAtlas = true;
              } else if (notionPlugin_typeof(pipeToAtlas) === 'object') {
                //Reusing an atlas
                _this.atlas = pipeToAtlas; //External atlas reference

                _this.atlas.data.eegshared.sps = info.sps;
                _this.atlas.data.eegshared.frequencies = _this.atlas.bandpassWindow(0, 128, info.sps * 0.5);
                _this.atlas.data.eegshared.bandFreqs = _this.atlas.getBandFreqs(_this.atlas.data.eegshared.frequencies);
                _this.atlas.data.eeg = _this.atlas.gen10_20Atlas(info.eegChannelTags);
                _this.atlas.data.coherence = _this.atlas.genCoherenceMap(info.eegChannelTags);
                _this.atlas.settings.coherence = true;
                _this.atlas.settings.eeg = true;
                info.useAtlas = true;

                if (info.analysis.length > 0) {
                  (_this$atlas$settings$ = _this.atlas.settings.analysis).push.apply(_this$atlas$settings$, notionPlugin_toConsumableArray(info.analysis));

                  if (!_this.atlas.settings.analyzing) {
                    _this.atlas.settings.analyzing = true;

                    _this.atlas.analyzer();
                  }
                }
              }

              if (info.useFilters === true) {
                info.eegChannelTags.forEach(function (row, i) {
                  if (row.tag !== 'other') {
                    _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, true, 1));
                  } else {
                    _this.filters.push(new BiquadChannelFilterer(row.ch, info.sps, false, 1));
                  }
                });
              }

              return _context3.abrupt("return", _this.atlas);

            case 10:
            case "end":
              return _context3.stop();
          }
        }
      }, _callee3);
    }));

    return function (_x3, _x4) {
      return _ref3.apply(this, arguments);
    };
  }();

  this.onconnect = function () {};

  this.ondisconnect = function () {};

  this.addControls = function () {// this.uiid = Math.floor(Math.random()*10000); //prevents any possible overlap with other elements
    // let template = () => {
    //     return `
    //     `;
    // }
    // let setup = () => {
    // }
    // this.ui = new DOMFragment(
    //     template,
    //     parentNode,
    //     undefined,
    //     setup
    // )

    var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
  };

  this.selectDevice = function (devices) {
    var parentNode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.body;
    var onsuccess = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};
    return new Promise(function (resolve, reject) {
      var t = 1;

      var template = function template() {
        return "\n\t\t\t<div id=\"".concat(_this.id, "-deviceBrowser\" style=\"z-index: 1000; background: black; width:100%; height: 100%; position: absolute; top: 0; left: 0; display:flex; align-items: center; justify-content: center; opacity: 0;\">\n\t\t\t\t<div id=\"").concat(_this.id, "-choiceDisplay\" style=\"flex-grow: 1;\">\n\t\t\t\t\t<h1>Select your Device</h1>\n\t\t\t\t\t<div style=\"display: flex;\">\n\t\t\t\t\t\t<div id=\"").concat(_this.id, "-deviceDiv\" style=\"flex-grow: 1; overflow-y: scroll; border: 1px solid white;\">\n\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<button id=\"").concat(_this.id, "-exitBrowser\" class=\"brainsatplay-default-button\" style=\"position: absolute; bottom:25px; right: 25px;\">Go Back</button>\n\t\t\t</div>");
      };

      var setup = function setup() {
        var browser = document.getElementById("".concat(_this.id, "-deviceBrowser"));
        var userDiv = browser.querySelector("[id='".concat(_this.id, "-deviceDiv']"));

        var closeUI = function closeUI() {
          browser.style.opacity = '0';
          window.removeEventListener('resize', resizeDisplay);
          setTimeout(function () {
            ui.deleteNode();
          }, t * 1000);
        };

        var resizeDisplay = function resizeDisplay() {
          var browser = document.getElementById("".concat(_this.id, "-deviceBrowser"));
          var display = browser.querySelector("[id='".concat(_this.id, "-choiceDisplay']"));
          var userDiv = browser.querySelector("[id='".concat(_this.id, "-deviceDiv']"));
          var padding = 50;
          browser.style.padding = "".concat(padding, "px");
          userDiv.style.height = "".concat(window.innerHeight - 2 * padding - (display.offsetHeight - userDiv.offsetHeight), "px");
        };

        var exitBrowser = browser.querySelector("[id='".concat(_this.id, "-exitBrowser']"));
        exitBrowser.onclick = closeUI;
        resizeDisplay();
        window.addEventListener('resize', resizeDisplay);
        browser.style.transition = "opacity ".concat(t, "s");
        browser.style.opacity = '1';

        var updateDisplay = function updateDisplay() {
          userDiv.innerHTML = '';
          var deviceStyle = "\n\t\t\t\tbackground: rgb(20,20,20);\n\t\t\t\tpadding: 25px;\n\t\t\t\tborder: 1px solid black;\n\t\t\t\ttransition: 0.5s;\n\t\t\t";

          var onMouseOver = function onMouseOver() {
            _this.style.background = 'rgb(35,35,35)';
            _this.style.cursor = 'pointer';
          };

          var onMouseOut = function onMouseOut() {
            _this.style.background = 'rgb(20,20,20)';
            _this.style.cursor = 'default';
          };

          devices.forEach(function (o) {
            userDiv.innerHTML += "\n                    <div  id=\"".concat(_this.id, "-device-").concat(o.deviceId, "\" class=\"neurosity-device\" style=\"").concat(deviceStyle, "\" onMouseOver=\"(").concat(onMouseOver, ")()\" onMouseOut=\"(").concat(onMouseOut, ")()\">\n                    <p style=\"font-size: 60%;\">").concat(o.model, "</p>\n                    <p>").concat(o.deviceNickname, "</p>\n                    <p style=\"font-size: 80%;\">").concat(o.deviceId, "</p>\n                    </div>");
          });
          var divs = userDiv.querySelectorAll(".neurosity-device");
          var headerDiv = document.getElementById("brainsatplay-header-".concat(_this.mode.split('_')[0]));

          var _iterator = notionPlugin_createForOfIteratorHelper(divs),
              _step;

          try {
            var _loop = function _loop() {
              var div = _step.value;
              var id = div.id.split("".concat(_this.id, "-device-"))[1];

              div.onclick = /*#__PURE__*/function () {
                var _ref4 = notionPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4(e) {
                  var device;
                  return regeneratorRuntime.wrap(function _callee4$(_context4) {
                    while (1) {
                      switch (_context4.prev = _context4.next) {
                        case 0:
                          _context4.next = 2;
                          return _this.device.selectDevice(function (devices) {
                            return devices.find(function (device) {
                              return device.deviceId === id;
                            });
                          });

                        case 2:
                          device = _context4.sent;
                          headerDiv.innerHTML = device.deviceNickname;
                          _this.connected = true;
                          resolve(device);
                          onsuccess();
                          closeUI();

                        case 8:
                        case "end":
                          return _context4.stop();
                      }
                    }
                  }, _callee4);
                }));

                return function (_x5) {
                  return _ref4.apply(this, arguments);
                };
              }();
            };

            for (_iterator.s(); !(_step = _iterator.n()).done;) {
              _loop();
            }
          } catch (err) {
            _iterator.e(err);
          } finally {
            _iterator.f();
          }
        };

        updateDisplay();
      };

      var ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
    });
  };

  this.promptLogin = /*#__PURE__*/notionPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6() {
    var parentNode,
        callback,
        returned,
        _args6 = arguments;
    return regeneratorRuntime.wrap(function _callee6$(_context6) {
      while (1) {
        switch (_context6.prev = _context6.next) {
          case 0:
            parentNode = _args6.length > 0 && _args6[0] !== undefined ? _args6[0] : document.body;
            callback = _args6.length > 1 && _args6[1] !== undefined ? _args6[1] : function () {};
            returned = new Promise(function (resolve, reject) {
              var template = function template() {
                return "\n\t\t<div id=\"".concat(_this.id, "login-page\" class=\"brainsatplay-default-container\" style=\"z-index: 1000; opacity: 0; transition: opacity 1s;\">\n\t\t\t<div>\n\t\t\t\t<h2>Access Notion Data</h2>\n\t\t\t\t<div id=\"").concat(_this.id, "login-container\" class=\"brainsatplay-form-container\">\n\t\t\t\t\t<div id=\"").concat(_this.id, "login\" class=\"brainsatplay-form-context\">\n\t\t\t\t\t\t<p id=\"").concat(_this.id, "login-message\" class=\"small\"></p>\n\t\t\t\t\t\t<div class='flex'>\n\t\t\t\t\t\t\t<form id=\"").concat(_this.id, "login-form\" class=\"brainsatplay-form\" action=\"\">\n                                <div class=\"brainsatplay-login-element\" style=\"margin-left: 0px; margin-right: 0px\">\n                                    <input type=\"text\" name=\"email\" autocomplete=\"off\" placeholder=\"Enter your email\"/>\n                                    <br>\n                                    <input type=\"password\" name=\"password\" autocomplete=\"off\" placeholder=\"Enter your password\"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"brainsatplay-login-buttons\" style=\"justify-content: flex-start;\">\n\t\t\t\t\t\t\t<div id=\"").concat(_this.id, "login-button\" class=\"brainsatplay-default-button\">Sign In</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t");
              };

              var setup = function setup() {
                var loginPage = document.getElementById("".concat(_this.id, "login-page"));
                var loginButton = loginPage.querySelector("[id='".concat(_this.id, "login-button']"));
                var form = loginPage.querySelector("[id='".concat(_this.id, "login-form']"));
                var usernameInput = form.querySelector('input');
                form.addEventListener("keyup", function (event) {
                  if (event.keyCode === 13) {
                    event.preventDefault();
                  }
                });
                usernameInput.addEventListener("keyup", function (event) {
                  if (event.keyCode === 13) {
                    event.preventDefault();
                    loginButton.click();
                  }
                });

                loginButton.onclick = function () {
                  var formDict = {};
                  var formData = new FormData(form);

                  var _iterator2 = notionPlugin_createForOfIteratorHelper(formData.entries()),
                      _step2;

                  try {
                    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
                      var pair = _step2.value;
                      formDict[pair[0]] = pair[1];
                    }
                  } catch (err) {
                    _iterator2.e(err);
                  } finally {
                    _iterator2.f();
                  }

                  _this.device.login(formDict).then(function (res) {
                    console.log(res);
                  })["catch"](function (error) {
                    console.error(error);
                  })["finally"]( /*#__PURE__*/function () {
                    var _ref6 = notionPlugin_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5(res) {
                      var devices;
                      return regeneratorRuntime.wrap(function _callee5$(_context5) {
                        while (1) {
                          switch (_context5.prev = _context5.next) {
                            case 0:
                              console.log(res);
                              _context5.next = 3;
                              return _this.device.getDevices();

                            case 3:
                              devices = _context5.sent;
                              _context5.next = 6;
                              return _this.selectDevice(devices, document.body);

                            case 6:
                              resolve(true);
                              callback();
                              loginPage.style.opacity = '0';
                              setTimeout(function () {
                                ui.deleteNode();
                              }, 1000);

                            case 10:
                            case "end":
                              return _context5.stop();
                          }
                        }
                      }, _callee5);
                    }));

                    return function (_x6) {
                      return _ref6.apply(this, arguments);
                    };
                  }());
                };

                loginPage.style.transition = 'opacity 1s';
                loginPage.style.opacity = '1';
              };

              var ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
            });
            return _context6.abrupt("return", returned);

          case 4:
          case "end":
            return _context6.stop();
        }
      }
    }, _callee6);
  }));
  this.atlas = null;
  this.mode = mode;
  this.connected = false;
  this.device = null; //Invoke a device class here if needed

  this.filters = [];
  this.onconnect = onconnect;
  this.ondisconnect = ondisconnect;

  var disconnectOnRefresh = function disconnectOnRefresh() {
    _this.disconnect();

    window.removeEventListener('beforeunload', disconnectOnRefresh);
  };

  window.addEventListener('beforeunload', disconnectOnRefresh);
};
;// CONCATENATED MODULE: ./src/libraries/js/src/devices/deviceList.js












var deviceList = [{
  'name': 'Synthetic',
  id: 'synthetic',
  company: 'Brains@Play',
  analysis: ['eegcoherence'],
  cls: syntheticPlugin
}, {
  'name': 'Brainstorm',
  id: 'brainstorm',
  company: 'Brains@Play',
  analysis: ['eegcoherence'],
  cls: brainstormPlugin
}, {
  'name': 'Notion',
  id: 'notion',
  company: 'Neurosity',
  analysis: ['eegcoherence'],
  cls: notionPlugin
}, {
  'name': 'Muse 2',
  id: 'muse',
  company: 'InteraXon',
  analysis: ['eegcoherence'],
  variants: ['', 'Aux'],
  cls: musePlugin
}, {
  'name': 'Muse S',
  id: 'muse',
  company: 'InteraXon',
  analysis: ['eegcoherence'],
  variants: [''],
  cls: musePlugin
}, {
  'name': 'Ganglion',
  id: 'ganglion',
  company: 'OpenBCI',
  analysis: ['eegcoherence'],
  cls: ganglionPlugin
}, {
  'name': 'Cyton',
  id: 'cyton',
  company: 'OpenBCI',
  analysis: ['eegcoherence'],
  variants: ['', 'Daisy'],
  cls: cytonPlugin
}, {
  'name': 'HEGduino',
  id: 'hegduino',
  company: 'HEGAlpha',
  analysis: [],
  variants: ['USB', 'Bluetooth'],
  cls: hegduinoPlugin
}, {
  'name': 'FreeEEG32',
  id: 'freeeg32',
  company: 'Neuroidss',
  analysis: ['eegcoherence'],
  variants: ['2', '19'],
  cls: eeg32Plugin
}, {
  'name': 'Buzz',
  id: 'buzz',
  company: 'Neosensory',
  analysis: [],
  cls: buzzPlugin
}, {
  'name': 'BCI2000',
  id: 'bci2k',
  company: 'BCI2000',
  analysis: ['eegcoherence'],
  variants: ['Operator', 'Data'],
  cls: bci2000Plugin
}, {
  'name': '8 Channel Proto',
  id: '8chproto',
  company: 'Brains@Play',
  analysis: ['eegcoherence'],
  cls: Prototype8Plugin
}];
;// CONCATENATED MODULE: ./node_modules/three/examples/jsm/libs/dat.gui.module.js
/**
 * dat-gui JavaScript Controller Library
 * http://code.google.com/p/dat-gui
 *
 * Copyright 2011 Data Arts Team, Google Creative Lab
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */

function ___$insertStyle( css ) {

	if ( ! css ) {

		return;

	}
	if ( typeof window === 'undefined' ) {

		return;

	}

	var style = document.createElement( 'style' );

	style.setAttribute( 'type', 'text/css' );
	style.innerHTML = css;
	document.head.appendChild( style );

	return css;

}

function colorToString( color, forceCSSHex ) {

	var colorFormat = color.__state.conversionName.toString();
	var r = Math.round( color.r );
	var g = Math.round( color.g );
	var b = Math.round( color.b );
	var a = color.a;
	var h = Math.round( color.h );
	var s = color.s.toFixed( 1 );
	var v = color.v.toFixed( 1 );
	if ( forceCSSHex || colorFormat === 'THREE_CHAR_HEX' || colorFormat === 'SIX_CHAR_HEX' ) {

		var str = color.hex.toString( 16 );
		while ( str.length < 6 ) {

			str = '0' + str;

		}
		return '#' + str;

	} else if ( colorFormat === 'CSS_RGB' ) {

		return 'rgb(' + r + ',' + g + ',' + b + ')';

	} else if ( colorFormat === 'CSS_RGBA' ) {

		return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';

	} else if ( colorFormat === 'HEX' ) {

		return '0x' + color.hex.toString( 16 );

	} else if ( colorFormat === 'RGB_ARRAY' ) {

		return '[' + r + ',' + g + ',' + b + ']';

	} else if ( colorFormat === 'RGBA_ARRAY' ) {

		return '[' + r + ',' + g + ',' + b + ',' + a + ']';

	} else if ( colorFormat === 'RGB_OBJ' ) {

		return '{r:' + r + ',g:' + g + ',b:' + b + '}';

	} else if ( colorFormat === 'RGBA_OBJ' ) {

		return '{r:' + r + ',g:' + g + ',b:' + b + ',a:' + a + '}';

	} else if ( colorFormat === 'HSV_OBJ' ) {

		return '{h:' + h + ',s:' + s + ',v:' + v + '}';

	} else if ( colorFormat === 'HSVA_OBJ' ) {

		return '{h:' + h + ',s:' + s + ',v:' + v + ',a:' + a + '}';

	}
	return 'unknown format';

}

var ARR_EACH = Array.prototype.forEach;
var ARR_SLICE = Array.prototype.slice;
var Common = {
	BREAK: {},
	extend: function extend( target ) {

		this.each( ARR_SLICE.call( arguments, 1 ), function ( obj ) {

			var keys = this.isObject( obj ) ? Object.keys( obj ) : [];
			keys.forEach( function ( key ) {

				if ( ! this.isUndefined( obj[ key ] ) ) {

					target[ key ] = obj[ key ];

				}

			}.bind( this ) );

		}, this );
		return target;

	},
	defaults: function defaults( target ) {

		this.each( ARR_SLICE.call( arguments, 1 ), function ( obj ) {

			var keys = this.isObject( obj ) ? Object.keys( obj ) : [];
			keys.forEach( function ( key ) {

				if ( this.isUndefined( target[ key ] ) ) {

					target[ key ] = obj[ key ];

				}

			}.bind( this ) );

		}, this );
		return target;

	},
	compose: function compose() {

		var toCall = ARR_SLICE.call( arguments );
		return function () {

			var args = ARR_SLICE.call( arguments );
			for ( var i = toCall.length - 1; i >= 0; i -- ) {

				args = [ toCall[ i ].apply( this, args ) ];

			}
			return args[ 0 ];

		};

	},
	each: function each( obj, itr, scope ) {

		if ( ! obj ) {

			return;

		}
		if ( ARR_EACH && obj.forEach && obj.forEach === ARR_EACH ) {

			obj.forEach( itr, scope );

		} else if ( obj.length === obj.length + 0 ) {

			var key = void 0;
			var l = void 0;
			for ( key = 0, l = obj.length; key < l; key ++ ) {

				if ( key in obj && itr.call( scope, obj[ key ], key ) === this.BREAK ) {

					return;

				}

			}

		} else {

			for ( var _key in obj ) {

				if ( itr.call( scope, obj[ _key ], _key ) === this.BREAK ) {

					return;

				}

			}

		}

	},
	defer: function defer( fnc ) {

		setTimeout( fnc, 0 );

	},
	debounce: function debounce( func, threshold, callImmediately ) {

		var timeout = void 0;
		return function () {

			var obj = this;
			var args = arguments;
			function delayed() {

				timeout = null;
				if ( ! callImmediately ) func.apply( obj, args );

			}
			var callNow = callImmediately || ! timeout;
			clearTimeout( timeout );
			timeout = setTimeout( delayed, threshold );
			if ( callNow ) {

				func.apply( obj, args );

			}

		};

	},
	toArray: function toArray( obj ) {

		if ( obj.toArray ) return obj.toArray();
		return ARR_SLICE.call( obj );

	},
	isUndefined: function isUndefined( obj ) {

		return obj === undefined;

	},
	isNull: function isNull( obj ) {

		return obj === null;

	},
	isNaN: function ( _isNaN ) {

		function isNaN() {

			return _isNaN.apply( this, arguments );

		}
		isNaN.toString = function () {

			return _isNaN.toString();

		};
		return isNaN;

	}( function ( obj ) {

		return isNaN( obj );

	} ),
	isArray: Array.isArray || function ( obj ) {

		return obj.constructor === Array;

	},
	isObject: function isObject( obj ) {

		return obj === Object( obj );

	},
	isNumber: function isNumber( obj ) {

		return obj === obj + 0;

	},
	isString: function isString( obj ) {

		return obj === obj + '';

	},
	isBoolean: function isBoolean( obj ) {

		return obj === false || obj === true;

	},
	isFunction: function isFunction( obj ) {

		return obj instanceof Function;

	}
};

var INTERPRETATIONS = [
	{
		litmus: Common.isString,
		conversions: {
			THREE_CHAR_HEX: {
				read: function read( original ) {

					var test = original.match( /^#([A-F0-9])([A-F0-9])([A-F0-9])$/i );
					if ( test === null ) {

						return false;

					}
					return {
						space: 'HEX',
						hex: parseInt( '0x' + test[ 1 ].toString() + test[ 1 ].toString() + test[ 2 ].toString() + test[ 2 ].toString() + test[ 3 ].toString() + test[ 3 ].toString(), 0 )
					};

				},
				write: colorToString
			},
			SIX_CHAR_HEX: {
				read: function read( original ) {

					var test = original.match( /^#([A-F0-9]{6})$/i );
					if ( test === null ) {

						return false;

					}
					return {
						space: 'HEX',
						hex: parseInt( '0x' + test[ 1 ].toString(), 0 )
					};

				},
				write: colorToString
			},
			CSS_RGB: {
				read: function read( original ) {

					var test = original.match( /^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/ );
					if ( test === null ) {

						return false;

					}
					return {
						space: 'RGB',
						r: parseFloat( test[ 1 ] ),
						g: parseFloat( test[ 2 ] ),
						b: parseFloat( test[ 3 ] )
					};

				},
				write: colorToString
			},
			CSS_RGBA: {
				read: function read( original ) {

					var test = original.match( /^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/ );
					if ( test === null ) {

						return false;

					}
					return {
						space: 'RGB',
						r: parseFloat( test[ 1 ] ),
						g: parseFloat( test[ 2 ] ),
						b: parseFloat( test[ 3 ] ),
						a: parseFloat( test[ 4 ] )
					};

				},
				write: colorToString
			}
		}
	},
	{
		litmus: Common.isNumber,
		conversions: {
			HEX: {
				read: function read( original ) {

					return {
						space: 'HEX',
						hex: original,
						conversionName: 'HEX'
					};

				},
				write: function write( color ) {

					return color.hex;

				}
			}
		}
	},
	{
		litmus: Common.isArray,
		conversions: {
			RGB_ARRAY: {
				read: function read( original ) {

					if ( original.length !== 3 ) {

						return false;

					}
					return {
						space: 'RGB',
						r: original[ 0 ],
						g: original[ 1 ],
						b: original[ 2 ]
					};

				},
				write: function write( color ) {

					return [ color.r, color.g, color.b ];

				}
			},
			RGBA_ARRAY: {
				read: function read( original ) {

					if ( original.length !== 4 ) return false;
					return {
						space: 'RGB',
						r: original[ 0 ],
						g: original[ 1 ],
						b: original[ 2 ],
						a: original[ 3 ]
					};

				},
				write: function write( color ) {

					return [ color.r, color.g, color.b, color.a ];

				}
			}
		}
	},
	{
		litmus: Common.isObject,
		conversions: {
			RGBA_OBJ: {
				read: function read( original ) {

					if ( Common.isNumber( original.r ) && Common.isNumber( original.g ) && Common.isNumber( original.b ) && Common.isNumber( original.a ) ) {

						return {
							space: 'RGB',
							r: original.r,
							g: original.g,
							b: original.b,
							a: original.a
						};

					}
					return false;

				},
				write: function write( color ) {

					return {
						r: color.r,
						g: color.g,
						b: color.b,
						a: color.a
					};

				}
			},
			RGB_OBJ: {
				read: function read( original ) {

					if ( Common.isNumber( original.r ) && Common.isNumber( original.g ) && Common.isNumber( original.b ) ) {

						return {
							space: 'RGB',
							r: original.r,
							g: original.g,
							b: original.b
						};

					}
					return false;

				},
				write: function write( color ) {

					return {
						r: color.r,
						g: color.g,
						b: color.b
					};

				}
			},
			HSVA_OBJ: {
				read: function read( original ) {

					if ( Common.isNumber( original.h ) && Common.isNumber( original.s ) && Common.isNumber( original.v ) && Common.isNumber( original.a ) ) {

						return {
							space: 'HSV',
							h: original.h,
							s: original.s,
							v: original.v,
							a: original.a
						};

					}
					return false;

				},
				write: function write( color ) {

					return {
						h: color.h,
						s: color.s,
						v: color.v,
						a: color.a
					};

				}
			},
			HSV_OBJ: {
				read: function read( original ) {

					if ( Common.isNumber( original.h ) && Common.isNumber( original.s ) && Common.isNumber( original.v ) ) {

						return {
							space: 'HSV',
							h: original.h,
							s: original.s,
							v: original.v
						};

					}
					return false;

				},
				write: function write( color ) {

					return {
						h: color.h,
						s: color.s,
						v: color.v
					};

				}
			}
		}
	} ];
var result = void 0;
var toReturn = void 0;
var interpret = function interpret() {

	toReturn = false;
	var original = arguments.length > 1 ? Common.toArray( arguments ) : arguments[ 0 ];
	Common.each( INTERPRETATIONS, function ( family ) {

		if ( family.litmus( original ) ) {

			Common.each( family.conversions, function ( conversion, conversionName ) {

				result = conversion.read( original );
				if ( toReturn === false && result !== false ) {

					toReturn = result;
					result.conversionName = conversionName;
					result.conversion = conversion;
					return Common.BREAK;

				}

			} );
			return Common.BREAK;

		}

	} );
	return toReturn;

};

var tmpComponent = void 0;
var ColorMath = {
	hsv_to_rgb: function hsv_to_rgb( h, s, v ) {

		var hi = Math.floor( h / 60 ) % 6;
		var f = h / 60 - Math.floor( h / 60 );
		var p = v * ( 1.0 - s );
		var q = v * ( 1.0 - f * s );
		var t = v * ( 1.0 - ( 1.0 - f ) * s );
		var c = [[ v, t, p ], [ q, v, p ], [ p, v, t ], [ p, q, v ], [ t, p, v ], [ v, p, q ]][ hi ];
		return {
			r: c[ 0 ] * 255,
			g: c[ 1 ] * 255,
			b: c[ 2 ] * 255
		};

	},
	rgb_to_hsv: function rgb_to_hsv( r, g, b ) {

		var min = Math.min( r, g, b );
		var max = Math.max( r, g, b );
		var delta = max - min;
		var h = void 0;
		var s = void 0;
		if ( max !== 0 ) {

			s = delta / max;

		} else {

			return {
				h: NaN,
				s: 0,
				v: 0
			};

		}
		if ( r === max ) {

			h = ( g - b ) / delta;

		} else if ( g === max ) {

			h = 2 + ( b - r ) / delta;

		} else {

			h = 4 + ( r - g ) / delta;

		}
		h /= 6;
		if ( h < 0 ) {

			h += 1;

		}
		return {
			h: h * 360,
			s: s,
			v: max / 255
		};

	},
	rgb_to_hex: function rgb_to_hex( r, g, b ) {

		var hex = this.hex_with_component( 0, 2, r );
		hex = this.hex_with_component( hex, 1, g );
		hex = this.hex_with_component( hex, 0, b );
		return hex;

	},
	component_from_hex: function component_from_hex( hex, componentIndex ) {

		return hex >> componentIndex * 8 & 0xFF;

	},
	hex_with_component: function hex_with_component( hex, componentIndex, value ) {

		return value << ( tmpComponent = componentIndex * 8 ) | hex & ~ ( 0xFF << tmpComponent );

	}
};

var dat_gui_module_typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function ( obj ) {

	return typeof obj;

} : function ( obj ) {

	return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;

};











var classCallCheck = function ( instance, Constructor ) {

	if ( ! ( instance instanceof Constructor ) ) {

		throw new TypeError( "Cannot call a class as a function" );

	}

};

var createClass = function () {

	function defineProperties( target, props ) {

		for ( var i = 0; i < props.length; i ++ ) {

			var descriptor = props[ i ];
			descriptor.enumerable = descriptor.enumerable || false;
			descriptor.configurable = true;
			if ( "value" in descriptor ) descriptor.writable = true;
			Object.defineProperty( target, descriptor.key, descriptor );

		}

	}

	return function ( Constructor, protoProps, staticProps ) {

		if ( protoProps ) defineProperties( Constructor.prototype, protoProps );
		if ( staticProps ) defineProperties( Constructor, staticProps );
		return Constructor;

	};

}();







var get = function get( object, property, receiver ) {

	if ( object === null ) object = Function.prototype;
	var desc = Object.getOwnPropertyDescriptor( object, property );

	if ( desc === undefined ) {

		var parent = Object.getPrototypeOf( object );

		if ( parent === null ) {

			return undefined;

		} else {

			return get( parent, property, receiver );

		}

	} else if ( "value" in desc ) {

		return desc.value;

	} else {

		var getter = desc.get;

		if ( getter === undefined ) {

			return undefined;

		}

		return getter.call( receiver );

	}

};

var inherits = function ( subClass, superClass ) {

	if ( typeof superClass !== "function" && superClass !== null ) {

		throw new TypeError( "Super expression must either be null or a function, not " + typeof superClass );

	}

	subClass.prototype = Object.create( superClass && superClass.prototype, {
		constructor: {
			value: subClass,
			enumerable: false,
			writable: true,
			configurable: true
		}
	} );
	if ( superClass ) Object.setPrototypeOf ? Object.setPrototypeOf( subClass, superClass ) : subClass.__proto__ = superClass;

};











var possibleConstructorReturn = function ( self, call ) {

	if ( ! self ) {

		throw new ReferenceError( "this hasn't been initialised - super() hasn't been called" );

	}

	return call && ( typeof call === "object" || typeof call === "function" ) ? call : self;

};

var Color = function () {

	function Color() {

		classCallCheck( this, Color );
		this.__state = interpret.apply( this, arguments );
		if ( this.__state === false ) {

			throw new Error( 'Failed to interpret color arguments' );

		}
		this.__state.a = this.__state.a || 1;

	}
	createClass( Color, [ {
		key: 'toString',
		value: function toString() {

			return colorToString( this );

		}
	}, {
		key: 'toHexString',
		value: function toHexString() {

			return colorToString( this, true );

		}
	}, {
		key: 'toOriginal',
		value: function toOriginal() {

			return this.__state.conversion.write( this );

		}
	} ] );
	return Color;

}();
function defineRGBComponent( target, component, componentHexIndex ) {

	Object.defineProperty( target, component, {
		get: function get$$1() {

			if ( this.__state.space === 'RGB' ) {

				return this.__state[ component ];

			}
			Color.recalculateRGB( this, component, componentHexIndex );
			return this.__state[ component ];

		},
		set: function set$$1( v ) {

			if ( this.__state.space !== 'RGB' ) {

				Color.recalculateRGB( this, component, componentHexIndex );
				this.__state.space = 'RGB';

			}
			this.__state[ component ] = v;

		}
	} );

}
function defineHSVComponent( target, component ) {

	Object.defineProperty( target, component, {
		get: function get$$1() {

			if ( this.__state.space === 'HSV' ) {

				return this.__state[ component ];

			}
			Color.recalculateHSV( this );
			return this.__state[ component ];

		},
		set: function set$$1( v ) {

			if ( this.__state.space !== 'HSV' ) {

				Color.recalculateHSV( this );
				this.__state.space = 'HSV';

			}
			this.__state[ component ] = v;

		}
	} );

}
Color.recalculateRGB = function ( color, component, componentHexIndex ) {

	if ( color.__state.space === 'HEX' ) {

		color.__state[ component ] = ColorMath.component_from_hex( color.__state.hex, componentHexIndex );

	} else if ( color.__state.space === 'HSV' ) {

		Common.extend( color.__state, ColorMath.hsv_to_rgb( color.__state.h, color.__state.s, color.__state.v ) );

	} else {

		throw new Error( 'Corrupted color state' );

	}

};
Color.recalculateHSV = function ( color ) {

	var result = ColorMath.rgb_to_hsv( color.r, color.g, color.b );
	Common.extend( color.__state, {
		s: result.s,
		v: result.v
	} );
	if ( ! Common.isNaN( result.h ) ) {

		color.__state.h = result.h;

	} else if ( Common.isUndefined( color.__state.h ) ) {

		color.__state.h = 0;

	}

};
Color.COMPONENTS = [ 'r', 'g', 'b', 'h', 's', 'v', 'hex', 'a' ];
defineRGBComponent( Color.prototype, 'r', 2 );
defineRGBComponent( Color.prototype, 'g', 1 );
defineRGBComponent( Color.prototype, 'b', 0 );
defineHSVComponent( Color.prototype, 'h' );
defineHSVComponent( Color.prototype, 's' );
defineHSVComponent( Color.prototype, 'v' );
Object.defineProperty( Color.prototype, 'a', {
	get: function get$$1() {

		return this.__state.a;

	},
	set: function set$$1( v ) {

		this.__state.a = v;

	}
} );
Object.defineProperty( Color.prototype, 'hex', {
	get: function get$$1() {

		if ( this.__state.space !== 'HEX' ) {

			this.__state.hex = ColorMath.rgb_to_hex( this.r, this.g, this.b );
			this.__state.space = 'HEX';

		}
		return this.__state.hex;

	},
	set: function set$$1( v ) {

		this.__state.space = 'HEX';
		this.__state.hex = v;

	}
} );

var Controller = function () {

	function Controller( object, property ) {

		classCallCheck( this, Controller );
		this.initialValue = object[ property ];
		this.domElement = document.createElement( 'div' );
		this.object = object;
		this.property = property;
		this.__onChange = undefined;
		this.__onFinishChange = undefined;

	}
	createClass( Controller, [ {
		key: 'onChange',
		value: function onChange( fnc ) {

			this.__onChange = fnc;
			return this;

		}
	}, {
		key: 'onFinishChange',
		value: function onFinishChange( fnc ) {

			this.__onFinishChange = fnc;
			return this;

		}
	}, {
		key: 'setValue',
		value: function setValue( newValue ) {

			this.object[ this.property ] = newValue;
			if ( this.__onChange ) {

				this.__onChange.call( this, newValue );

			}
			this.updateDisplay();
			return this;

		}
	}, {
		key: 'getValue',
		value: function getValue() {

			return this.object[ this.property ];

		}
	}, {
		key: 'updateDisplay',
		value: function updateDisplay() {

			return this;

		}
	}, {
		key: 'isModified',
		value: function isModified() {

			return this.initialValue !== this.getValue();

		}
	} ] );
	return Controller;

}();

var EVENT_MAP = {
	HTMLEvents: [ 'change' ],
	MouseEvents: [ 'click', 'mousemove', 'mousedown', 'mouseup', 'mouseover' ],
	KeyboardEvents: [ 'keydown' ]
};
var EVENT_MAP_INV = {};
Common.each( EVENT_MAP, function ( v, k ) {

	Common.each( v, function ( e ) {

		EVENT_MAP_INV[ e ] = k;

	} );

} );
var CSS_VALUE_PIXELS = /(\d+(\.\d+)?)px/;
function cssValueToPixels( val ) {

	if ( val === '0' || Common.isUndefined( val ) ) {

		return 0;

	}
	var match = val.match( CSS_VALUE_PIXELS );
	if ( ! Common.isNull( match ) ) {

		return parseFloat( match[ 1 ] );

	}
	return 0;

}
var dom = {
	makeSelectable: function makeSelectable( elem, selectable ) {

		if ( elem === undefined || elem.style === undefined ) return;
		elem.onselectstart = selectable ? function () {

			return false;

		} : function () {};
		elem.style.MozUserSelect = selectable ? 'auto' : 'none';
		elem.style.KhtmlUserSelect = selectable ? 'auto' : 'none';
		elem.unselectable = selectable ? 'on' : 'off';

	},
	makeFullscreen: function makeFullscreen( elem, hor, vert ) {

		var vertical = vert;
		var horizontal = hor;
		if ( Common.isUndefined( horizontal ) ) {

			horizontal = true;

		}
		if ( Common.isUndefined( vertical ) ) {

			vertical = true;

		}
		elem.style.position = 'absolute';
		if ( horizontal ) {

			elem.style.left = 0;
			elem.style.right = 0;

		}
		if ( vertical ) {

			elem.style.top = 0;
			elem.style.bottom = 0;

		}

	},
	fakeEvent: function fakeEvent( elem, eventType, pars, aux ) {

		var params = pars || {};
		var className = EVENT_MAP_INV[ eventType ];
		if ( ! className ) {

			throw new Error( 'Event type ' + eventType + ' not supported.' );

		}
		var evt = document.createEvent( className );
		switch ( className ) {

			case 'MouseEvents':
			{

				var clientX = params.x || params.clientX || 0;
				var clientY = params.y || params.clientY || 0;
				evt.initMouseEvent( eventType, params.bubbles || false, params.cancelable || true, window, params.clickCount || 1, 0,
					0,
					clientX,
					clientY,
					false, false, false, false, 0, null );
				break;

			}
			case 'KeyboardEvents':
			{

				var init = evt.initKeyboardEvent || evt.initKeyEvent;
				Common.defaults( params, {
					cancelable: true,
					ctrlKey: false,
					altKey: false,
					shiftKey: false,
					metaKey: false,
					keyCode: undefined,
					charCode: undefined
				} );
				init( eventType, params.bubbles || false, params.cancelable, window, params.ctrlKey, params.altKey, params.shiftKey, params.metaKey, params.keyCode, params.charCode );
				break;

			}
			default:
			{

				evt.initEvent( eventType, params.bubbles || false, params.cancelable || true );
				break;

			}

		}
		Common.defaults( evt, aux );
		elem.dispatchEvent( evt );

	},
	bind: function bind( elem, event, func, newBool ) {

		var bool = newBool || false;
		if ( elem.addEventListener ) {

			elem.addEventListener( event, func, bool );

		} else if ( elem.attachEvent ) {

			elem.attachEvent( 'on' + event, func );

		}
		return dom;

	},
	unbind: function unbind( elem, event, func, newBool ) {

		var bool = newBool || false;
		if ( elem.removeEventListener ) {

			elem.removeEventListener( event, func, bool );

		} else if ( elem.detachEvent ) {

			elem.detachEvent( 'on' + event, func );

		}
		return dom;

	},
	addClass: function addClass( elem, className ) {

		if ( elem.className === undefined ) {

			elem.className = className;

		} else if ( elem.className !== className ) {

			var classes = elem.className.split( / +/ );
			if ( classes.indexOf( className ) === - 1 ) {

				classes.push( className );
				elem.className = classes.join( ' ' ).replace( /^\s+/, '' ).replace( /\s+$/, '' );

			}

		}
		return dom;

	},
	removeClass: function removeClass( elem, className ) {

		if ( className ) {

			if ( elem.className === className ) {

				elem.removeAttribute( 'class' );

			} else {

				var classes = elem.className.split( / +/ );
				var index = classes.indexOf( className );
				if ( index !== - 1 ) {

					classes.splice( index, 1 );
					elem.className = classes.join( ' ' );

				}

			}

		} else {

			elem.className = undefined;

		}
		return dom;

	},
	hasClass: function hasClass( elem, className ) {

		return new RegExp( '(?:^|\\s+)' + className + '(?:\\s+|$)' ).test( elem.className ) || false;

	},
	getWidth: function getWidth( elem ) {

		var style = getComputedStyle( elem );
		return cssValueToPixels( style[ 'border-left-width' ] ) + cssValueToPixels( style[ 'border-right-width' ] ) + cssValueToPixels( style[ 'padding-left' ] ) + cssValueToPixels( style[ 'padding-right' ] ) + cssValueToPixels( style.width );

	},
	getHeight: function getHeight( elem ) {

		var style = getComputedStyle( elem );
		return cssValueToPixels( style[ 'border-top-width' ] ) + cssValueToPixels( style[ 'border-bottom-width' ] ) + cssValueToPixels( style[ 'padding-top' ] ) + cssValueToPixels( style[ 'padding-bottom' ] ) + cssValueToPixels( style.height );

	},
	getOffset: function getOffset( el ) {

		var elem = el;
		var offset = { left: 0, top: 0 };
		if ( elem.offsetParent ) {

			do {

				offset.left += elem.offsetLeft;
				offset.top += elem.offsetTop;
				elem = elem.offsetParent;

			} while ( elem );

		}
		return offset;

	},
	isActive: function isActive( elem ) {

		return elem === document.activeElement && ( elem.type || elem.href );

	}
};

var BooleanController = function ( _Controller ) {

	inherits( BooleanController, _Controller );
	function BooleanController( object, property ) {

		classCallCheck( this, BooleanController );
		var _this2 = possibleConstructorReturn( this, ( BooleanController.__proto__ || Object.getPrototypeOf( BooleanController ) ).call( this, object, property ) );
		var _this = _this2;
		_this2.__prev = _this2.getValue();
		_this2.__checkbox = document.createElement( 'input' );
		_this2.__checkbox.setAttribute( 'type', 'checkbox' );
		function onChange() {

			_this.setValue( ! _this.__prev );

		}
		dom.bind( _this2.__checkbox, 'change', onChange, false );
		_this2.domElement.appendChild( _this2.__checkbox );
		_this2.updateDisplay();
		return _this2;

	}
	createClass( BooleanController, [ {
		key: 'setValue',
		value: function setValue( v ) {

			var toReturn = get( BooleanController.prototype.__proto__ || Object.getPrototypeOf( BooleanController.prototype ), 'setValue', this ).call( this, v );
			if ( this.__onFinishChange ) {

				this.__onFinishChange.call( this, this.getValue() );

			}
			this.__prev = this.getValue();
			return toReturn;

		}
	}, {
		key: 'updateDisplay',
		value: function updateDisplay() {

			if ( this.getValue() === true ) {

				this.__checkbox.setAttribute( 'checked', 'checked' );
				this.__checkbox.checked = true;
				this.__prev = true;

			} else {

				this.__checkbox.checked = false;
				this.__prev = false;

			}
			return get( BooleanController.prototype.__proto__ || Object.getPrototypeOf( BooleanController.prototype ), 'updateDisplay', this ).call( this );

		}
	} ] );
	return BooleanController;

}( Controller );

var OptionController = function ( _Controller ) {

	inherits( OptionController, _Controller );
	function OptionController( object, property, opts ) {

		classCallCheck( this, OptionController );
		var _this2 = possibleConstructorReturn( this, ( OptionController.__proto__ || Object.getPrototypeOf( OptionController ) ).call( this, object, property ) );
		var options = opts;
		var _this = _this2;
		_this2.__select = document.createElement( 'select' );
		if ( Common.isArray( options ) ) {

			var map = {};
			Common.each( options, function ( element ) {

				map[ element ] = element;

			} );
			options = map;

		}
		Common.each( options, function ( value, key ) {

			var opt = document.createElement( 'option' );
			opt.innerHTML = key;
			opt.setAttribute( 'value', value );
			_this.__select.appendChild( opt );

		} );
		_this2.updateDisplay();
		dom.bind( _this2.__select, 'change', function () {

			var desiredValue = this.options[ this.selectedIndex ].value;
			_this.setValue( desiredValue );

		} );
		_this2.domElement.appendChild( _this2.__select );
		return _this2;

	}
	createClass( OptionController, [ {
		key: 'setValue',
		value: function setValue( v ) {

			var toReturn = get( OptionController.prototype.__proto__ || Object.getPrototypeOf( OptionController.prototype ), 'setValue', this ).call( this, v );
			if ( this.__onFinishChange ) {

				this.__onFinishChange.call( this, this.getValue() );

			}
			return toReturn;

		}
	}, {
		key: 'updateDisplay',
		value: function updateDisplay() {

			if ( dom.isActive( this.__select ) ) return this;
			this.__select.value = this.getValue();
			return get( OptionController.prototype.__proto__ || Object.getPrototypeOf( OptionController.prototype ), 'updateDisplay', this ).call( this );

		}
	} ] );
	return OptionController;

}( Controller );

var StringController = function ( _Controller ) {

	inherits( StringController, _Controller );
	function StringController( object, property ) {

		classCallCheck( this, StringController );
		var _this2 = possibleConstructorReturn( this, ( StringController.__proto__ || Object.getPrototypeOf( StringController ) ).call( this, object, property ) );
		var _this = _this2;
		function onChange() {

			_this.setValue( _this.__input.value );

		}
		function onBlur() {

			if ( _this.__onFinishChange ) {

				_this.__onFinishChange.call( _this, _this.getValue() );

			}

		}
		_this2.__input = document.createElement( 'input' );
		_this2.__input.setAttribute( 'type', 'text' );
		dom.bind( _this2.__input, 'keyup', onChange );
		dom.bind( _this2.__input, 'change', onChange );
		dom.bind( _this2.__input, 'blur', onBlur );
		dom.bind( _this2.__input, 'keydown', function ( e ) {

			if ( e.keyCode === 13 ) {

				this.blur();

			}

		} );
		_this2.updateDisplay();
		_this2.domElement.appendChild( _this2.__input );
		return _this2;

	}
	createClass( StringController, [ {
		key: 'updateDisplay',
		value: function updateDisplay() {

			if ( ! dom.isActive( this.__input ) ) {

				this.__input.value = this.getValue();

			}
			return get( StringController.prototype.__proto__ || Object.getPrototypeOf( StringController.prototype ), 'updateDisplay', this ).call( this );

		}
	} ] );
	return StringController;

}( Controller );

function numDecimals( x ) {

	var _x = x.toString();
	if ( _x.indexOf( '.' ) > - 1 ) {

		return _x.length - _x.indexOf( '.' ) - 1;

	}
	return 0;

}
var NumberController = function ( _Controller ) {

	inherits( NumberController, _Controller );
	function NumberController( object, property, params ) {

		classCallCheck( this, NumberController );
		var _this = possibleConstructorReturn( this, ( NumberController.__proto__ || Object.getPrototypeOf( NumberController ) ).call( this, object, property ) );
		var _params = params || {};
		_this.__min = _params.min;
		_this.__max = _params.max;
		_this.__step = _params.step;
		if ( Common.isUndefined( _this.__step ) ) {

			if ( _this.initialValue === 0 ) {

				_this.__impliedStep = 1;

			} else {

				_this.__impliedStep = Math.pow( 10, Math.floor( Math.log( Math.abs( _this.initialValue ) ) / Math.LN10 ) ) / 10;

			}

		} else {

			_this.__impliedStep = _this.__step;

		}
		_this.__precision = numDecimals( _this.__impliedStep );
		return _this;

	}
	createClass( NumberController, [ {
		key: 'setValue',
		value: function setValue( v ) {

			var _v = v;
			if ( this.__min !== undefined && _v < this.__min ) {

				_v = this.__min;

			} else if ( this.__max !== undefined && _v > this.__max ) {

				_v = this.__max;

			}
			if ( this.__step !== undefined && _v % this.__step !== 0 ) {

				_v = Math.round( _v / this.__step ) * this.__step;

			}
			return get( NumberController.prototype.__proto__ || Object.getPrototypeOf( NumberController.prototype ), 'setValue', this ).call( this, _v );

		}
	}, {
		key: 'min',
		value: function min( minValue ) {

			this.__min = minValue;
			return this;

		}
	}, {
		key: 'max',
		value: function max( maxValue ) {

			this.__max = maxValue;
			return this;

		}
	}, {
		key: 'step',
		value: function step( stepValue ) {

			this.__step = stepValue;
			this.__impliedStep = stepValue;
			this.__precision = numDecimals( stepValue );
			return this;

		}
	} ] );
	return NumberController;

}( Controller );

function roundToDecimal( value, decimals ) {

	var tenTo = Math.pow( 10, decimals );
	return Math.round( value * tenTo ) / tenTo;

}
var NumberControllerBox = function ( _NumberController ) {

	inherits( NumberControllerBox, _NumberController );
	function NumberControllerBox( object, property, params ) {

		classCallCheck( this, NumberControllerBox );
		var _this2 = possibleConstructorReturn( this, ( NumberControllerBox.__proto__ || Object.getPrototypeOf( NumberControllerBox ) ).call( this, object, property, params ) );
		_this2.__truncationSuspended = false;
		var _this = _this2;
		var prevY = void 0;
		function onChange() {

			var attempted = parseFloat( _this.__input.value );
			if ( ! Common.isNaN( attempted ) ) {

				_this.setValue( attempted );

			}

		}
		function onFinish() {

			if ( _this.__onFinishChange ) {

				_this.__onFinishChange.call( _this, _this.getValue() );

			}

		}
		function onBlur() {

			onFinish();

		}
		function onMouseDrag( e ) {

			var diff = prevY - e.clientY;
			_this.setValue( _this.getValue() + diff * _this.__impliedStep );
			prevY = e.clientY;

		}
		function onMouseUp() {

			dom.unbind( window, 'mousemove', onMouseDrag );
			dom.unbind( window, 'mouseup', onMouseUp );
			onFinish();

		}
		function onMouseDown( e ) {

			dom.bind( window, 'mousemove', onMouseDrag );
			dom.bind( window, 'mouseup', onMouseUp );
			prevY = e.clientY;

		}
		_this2.__input = document.createElement( 'input' );
		_this2.__input.setAttribute( 'type', 'text' );
		dom.bind( _this2.__input, 'change', onChange );
		dom.bind( _this2.__input, 'blur', onBlur );
		dom.bind( _this2.__input, 'mousedown', onMouseDown );
		dom.bind( _this2.__input, 'keydown', function ( e ) {

			if ( e.keyCode === 13 ) {

				_this.__truncationSuspended = true;
				this.blur();
				_this.__truncationSuspended = false;
				onFinish();

			}

		} );
		_this2.updateDisplay();
		_this2.domElement.appendChild( _this2.__input );
		return _this2;

	}
	createClass( NumberControllerBox, [ {
		key: 'updateDisplay',
		value: function updateDisplay() {

			this.__input.value = this.__truncationSuspended ? this.getValue() : roundToDecimal( this.getValue(), this.__precision );
			return get( NumberControllerBox.prototype.__proto__ || Object.getPrototypeOf( NumberControllerBox.prototype ), 'updateDisplay', this ).call( this );

		}
	} ] );
	return NumberControllerBox;

}( NumberController );

function dat_gui_module_map( v, i1, i2, o1, o2 ) {

	return o1 + ( o2 - o1 ) * ( ( v - i1 ) / ( i2 - i1 ) );

}
var NumberControllerSlider = function ( _NumberController ) {

	inherits( NumberControllerSlider, _NumberController );
	function NumberControllerSlider( object, property, min, max, step ) {

		classCallCheck( this, NumberControllerSlider );
		var _this2 = possibleConstructorReturn( this, ( NumberControllerSlider.__proto__ || Object.getPrototypeOf( NumberControllerSlider ) ).call( this, object, property, { min: min, max: max, step: step } ) );
		var _this = _this2;
		_this2.__background = document.createElement( 'div' );
		_this2.__foreground = document.createElement( 'div' );
		dom.bind( _this2.__background, 'mousedown', onMouseDown );
		dom.bind( _this2.__background, 'touchstart', onTouchStart );
		dom.addClass( _this2.__background, 'slider' );
		dom.addClass( _this2.__foreground, 'slider-fg' );
		function onMouseDown( e ) {

			document.activeElement.blur();
			dom.bind( window, 'mousemove', onMouseDrag );
			dom.bind( window, 'mouseup', onMouseUp );
			onMouseDrag( e );

		}
		function onMouseDrag( e ) {

			e.preventDefault();
			var bgRect = _this.__background.getBoundingClientRect();
			_this.setValue( dat_gui_module_map( e.clientX, bgRect.left, bgRect.right, _this.__min, _this.__max ) );
			return false;

		}
		function onMouseUp() {

			dom.unbind( window, 'mousemove', onMouseDrag );
			dom.unbind( window, 'mouseup', onMouseUp );
			if ( _this.__onFinishChange ) {

				_this.__onFinishChange.call( _this, _this.getValue() );

			}

		}
		function onTouchStart( e ) {

			if ( e.touches.length !== 1 ) {

				return;

			}
			dom.bind( window, 'touchmove', onTouchMove );
			dom.bind( window, 'touchend', onTouchEnd );
			onTouchMove( e );

		}
		function onTouchMove( e ) {

			var clientX = e.touches[ 0 ].clientX;
			var bgRect = _this.__background.getBoundingClientRect();
			_this.setValue( dat_gui_module_map( clientX, bgRect.left, bgRect.right, _this.__min, _this.__max ) );

		}
		function onTouchEnd() {

			dom.unbind( window, 'touchmove', onTouchMove );
			dom.unbind( window, 'touchend', onTouchEnd );
			if ( _this.__onFinishChange ) {

				_this.__onFinishChange.call( _this, _this.getValue() );

			}

		}
		_this2.updateDisplay();
		_this2.__background.appendChild( _this2.__foreground );
		_this2.domElement.appendChild( _this2.__background );
		return _this2;

	}
	createClass( NumberControllerSlider, [ {
		key: 'updateDisplay',
		value: function updateDisplay() {

			var pct = ( this.getValue() - this.__min ) / ( this.__max - this.__min );
			this.__foreground.style.width = pct * 100 + '%';
			return get( NumberControllerSlider.prototype.__proto__ || Object.getPrototypeOf( NumberControllerSlider.prototype ), 'updateDisplay', this ).call( this );

		}
	} ] );
	return NumberControllerSlider;

}( NumberController );

var FunctionController = function ( _Controller ) {

	inherits( FunctionController, _Controller );
	function FunctionController( object, property, text ) {

		classCallCheck( this, FunctionController );
		var _this2 = possibleConstructorReturn( this, ( FunctionController.__proto__ || Object.getPrototypeOf( FunctionController ) ).call( this, object, property ) );
		var _this = _this2;
		_this2.__button = document.createElement( 'div' );
		_this2.__button.innerHTML = text === undefined ? 'Fire' : text;
		dom.bind( _this2.__button, 'click', function ( e ) {

			e.preventDefault();
			_this.fire();
			return false;

		} );
		dom.addClass( _this2.__button, 'button' );
		_this2.domElement.appendChild( _this2.__button );
		return _this2;

	}
	createClass( FunctionController, [ {
		key: 'fire',
		value: function fire() {

			if ( this.__onChange ) {

				this.__onChange.call( this );

			}
			this.getValue().call( this.object );
			if ( this.__onFinishChange ) {

				this.__onFinishChange.call( this, this.getValue() );

			}

		}
	} ] );
	return FunctionController;

}( Controller );

var ColorController = function ( _Controller ) {

	inherits( ColorController, _Controller );
	function ColorController( object, property ) {

		classCallCheck( this, ColorController );
		var _this2 = possibleConstructorReturn( this, ( ColorController.__proto__ || Object.getPrototypeOf( ColorController ) ).call( this, object, property ) );
		_this2.__color = new Color( _this2.getValue() );
		_this2.__temp = new Color( 0 );
		var _this = _this2;
		_this2.domElement = document.createElement( 'div' );
		dom.makeSelectable( _this2.domElement, false );
		_this2.__selector = document.createElement( 'div' );
		_this2.__selector.className = 'selector';
		_this2.__saturation_field = document.createElement( 'div' );
		_this2.__saturation_field.className = 'saturation-field';
		_this2.__field_knob = document.createElement( 'div' );
		_this2.__field_knob.className = 'field-knob';
		_this2.__field_knob_border = '2px solid ';
		_this2.__hue_knob = document.createElement( 'div' );
		_this2.__hue_knob.className = 'hue-knob';
		_this2.__hue_field = document.createElement( 'div' );
		_this2.__hue_field.className = 'hue-field';
		_this2.__input = document.createElement( 'input' );
		_this2.__input.type = 'text';
		_this2.__input_textShadow = '0 1px 1px ';
		dom.bind( _this2.__input, 'keydown', function ( e ) {

			if ( e.keyCode === 13 ) {

				onBlur.call( this );

			}

		} );
		dom.bind( _this2.__input, 'blur', onBlur );
		dom.bind( _this2.__selector, 'mousedown', function () {

			dom.addClass( this, 'drag' ).bind( window, 'mouseup', function () {

				dom.removeClass( _this.__selector, 'drag' );

			} );

		} );
		dom.bind( _this2.__selector, 'touchstart', function () {

			dom.addClass( this, 'drag' ).bind( window, 'touchend', function () {

				dom.removeClass( _this.__selector, 'drag' );

			} );

		} );
		var valueField = document.createElement( 'div' );
		Common.extend( _this2.__selector.style, {
			width: '122px',
			height: '102px',
			padding: '3px',
			backgroundColor: '#222',
			boxShadow: '0px 1px 3px rgba(0,0,0,0.3)'
		} );
		Common.extend( _this2.__field_knob.style, {
			position: 'absolute',
			width: '12px',
			height: '12px',
			border: _this2.__field_knob_border + ( _this2.__color.v < 0.5 ? '#fff' : '#000' ),
			boxShadow: '0px 1px 3px rgba(0,0,0,0.5)',
			borderRadius: '12px',
			zIndex: 1
		} );
		Common.extend( _this2.__hue_knob.style, {
			position: 'absolute',
			width: '15px',
			height: '2px',
			borderRight: '4px solid #fff',
			zIndex: 1
		} );
		Common.extend( _this2.__saturation_field.style, {
			width: '100px',
			height: '100px',
			border: '1px solid #555',
			marginRight: '3px',
			display: 'inline-block',
			cursor: 'pointer'
		} );
		Common.extend( valueField.style, {
			width: '100%',
			height: '100%',
			background: 'none'
		} );
		linearGradient( valueField, 'top', 'rgba(0,0,0,0)', '#000' );
		Common.extend( _this2.__hue_field.style, {
			width: '15px',
			height: '100px',
			border: '1px solid #555',
			cursor: 'ns-resize',
			position: 'absolute',
			top: '3px',
			right: '3px'
		} );
		hueGradient( _this2.__hue_field );
		Common.extend( _this2.__input.style, {
			outline: 'none',
			textAlign: 'center',
			color: '#fff',
			border: 0,
			fontWeight: 'bold',
			textShadow: _this2.__input_textShadow + 'rgba(0,0,0,0.7)'
		} );
		dom.bind( _this2.__saturation_field, 'mousedown', fieldDown );
		dom.bind( _this2.__saturation_field, 'touchstart', fieldDown );
		dom.bind( _this2.__field_knob, 'mousedown', fieldDown );
		dom.bind( _this2.__field_knob, 'touchstart', fieldDown );
		dom.bind( _this2.__hue_field, 'mousedown', fieldDownH );
		dom.bind( _this2.__hue_field, 'touchstart', fieldDownH );
		function fieldDown( e ) {

			setSV( e );
			dom.bind( window, 'mousemove', setSV );
			dom.bind( window, 'touchmove', setSV );
			dom.bind( window, 'mouseup', fieldUpSV );
			dom.bind( window, 'touchend', fieldUpSV );

		}
		function fieldDownH( e ) {

			setH( e );
			dom.bind( window, 'mousemove', setH );
			dom.bind( window, 'touchmove', setH );
			dom.bind( window, 'mouseup', fieldUpH );
			dom.bind( window, 'touchend', fieldUpH );

		}
		function fieldUpSV() {

			dom.unbind( window, 'mousemove', setSV );
			dom.unbind( window, 'touchmove', setSV );
			dom.unbind( window, 'mouseup', fieldUpSV );
			dom.unbind( window, 'touchend', fieldUpSV );
			onFinish();

		}
		function fieldUpH() {

			dom.unbind( window, 'mousemove', setH );
			dom.unbind( window, 'touchmove', setH );
			dom.unbind( window, 'mouseup', fieldUpH );
			dom.unbind( window, 'touchend', fieldUpH );
			onFinish();

		}
		function onBlur() {

			var i = interpret( this.value );
			if ( i !== false ) {

				_this.__color.__state = i;
				_this.setValue( _this.__color.toOriginal() );

			} else {

				this.value = _this.__color.toString();

			}

		}
		function onFinish() {

			if ( _this.__onFinishChange ) {

				_this.__onFinishChange.call( _this, _this.__color.toOriginal() );

			}

		}
		_this2.__saturation_field.appendChild( valueField );
		_this2.__selector.appendChild( _this2.__field_knob );
		_this2.__selector.appendChild( _this2.__saturation_field );
		_this2.__selector.appendChild( _this2.__hue_field );
		_this2.__hue_field.appendChild( _this2.__hue_knob );
		_this2.domElement.appendChild( _this2.__input );
		_this2.domElement.appendChild( _this2.__selector );
		_this2.updateDisplay();
		function setSV( e ) {

			if ( e.type.indexOf( 'touch' ) === - 1 ) {

				e.preventDefault();

			}
			var fieldRect = _this.__saturation_field.getBoundingClientRect();
			var _ref = e.touches && e.touches[ 0 ] || e,
				clientX = _ref.clientX,
				clientY = _ref.clientY;
			var s = ( clientX - fieldRect.left ) / ( fieldRect.right - fieldRect.left );
			var v = 1 - ( clientY - fieldRect.top ) / ( fieldRect.bottom - fieldRect.top );
			if ( v > 1 ) {

				v = 1;

			} else if ( v < 0 ) {

				v = 0;

			}
			if ( s > 1 ) {

				s = 1;

			} else if ( s < 0 ) {

				s = 0;

			}
			_this.__color.v = v;
			_this.__color.s = s;
			_this.setValue( _this.__color.toOriginal() );
			return false;

		}
		function setH( e ) {

			if ( e.type.indexOf( 'touch' ) === - 1 ) {

				e.preventDefault();

			}
			var fieldRect = _this.__hue_field.getBoundingClientRect();
			var _ref2 = e.touches && e.touches[ 0 ] || e,
				clientY = _ref2.clientY;
			var h = 1 - ( clientY - fieldRect.top ) / ( fieldRect.bottom - fieldRect.top );
			if ( h > 1 ) {

				h = 1;

			} else if ( h < 0 ) {

				h = 0;

			}
			_this.__color.h = h * 360;
			_this.setValue( _this.__color.toOriginal() );
			return false;

		}
		return _this2;

	}
	createClass( ColorController, [ {
		key: 'updateDisplay',
		value: function updateDisplay() {

			var i = interpret( this.getValue() );
			if ( i !== false ) {

				var mismatch = false;
				Common.each( Color.COMPONENTS, function ( component ) {

					if ( ! Common.isUndefined( i[ component ] ) && ! Common.isUndefined( this.__color.__state[ component ] ) && i[ component ] !== this.__color.__state[ component ] ) {

						mismatch = true;
						return {};

					}

				}, this );
				if ( mismatch ) {

					Common.extend( this.__color.__state, i );

				}

			}
			Common.extend( this.__temp.__state, this.__color.__state );
			this.__temp.a = 1;
			var flip = this.__color.v < 0.5 || this.__color.s > 0.5 ? 255 : 0;
			var _flip = 255 - flip;
			Common.extend( this.__field_knob.style, {
				marginLeft: 100 * this.__color.s - 7 + 'px',
				marginTop: 100 * ( 1 - this.__color.v ) - 7 + 'px',
				backgroundColor: this.__temp.toHexString(),
				border: this.__field_knob_border + 'rgb(' + flip + ',' + flip + ',' + flip + ')'
			} );
			this.__hue_knob.style.marginTop = ( 1 - this.__color.h / 360 ) * 100 + 'px';
			this.__temp.s = 1;
			this.__temp.v = 1;
			linearGradient( this.__saturation_field, 'left', '#fff', this.__temp.toHexString() );
			this.__input.value = this.__color.toString();
			Common.extend( this.__input.style, {
				backgroundColor: this.__color.toHexString(),
				color: 'rgb(' + flip + ',' + flip + ',' + flip + ')',
				textShadow: this.__input_textShadow + 'rgba(' + _flip + ',' + _flip + ',' + _flip + ',.7)'
			} );

		}
	} ] );
	return ColorController;

}( Controller );
var vendors = [ '-moz-', '-o-', '-webkit-', '-ms-', '' ];
function linearGradient( elem, x, a, b ) {

	elem.style.background = '';
	Common.each( vendors, function ( vendor ) {

		elem.style.cssText += 'background: ' + vendor + 'linear-gradient(' + x + ', ' + a + ' 0%, ' + b + ' 100%); ';

	} );

}
function hueGradient( elem ) {

	elem.style.background = '';
	elem.style.cssText += 'background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';
	elem.style.cssText += 'background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';
	elem.style.cssText += 'background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';
	elem.style.cssText += 'background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';
	elem.style.cssText += 'background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';

}

var css = {
	load: function load( url, indoc ) {

		var doc = indoc || document;
		var link = doc.createElement( 'link' );
		link.type = 'text/css';
		link.rel = 'stylesheet';
		link.href = url;
		doc.getElementsByTagName( 'head' )[ 0 ].appendChild( link );

	},
	inject: function inject( cssContent, indoc ) {

		var doc = indoc || document;
		var injected = document.createElement( 'style' );
		injected.type = 'text/css';
		injected.innerHTML = cssContent;
		var head = doc.getElementsByTagName( 'head' )[ 0 ];
		try {

			head.appendChild( injected );

		} catch ( e ) {
		}

	}
};

var saveDialogContents = "<div id=\"dg-save\" class=\"dg dialogue\">\n\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\n\n  <textarea id=\"dg-new-constructor\"></textarea>\n\n  <div id=\"dg-save-locally\">\n\n    <input id=\"dg-local-storage\" type=\"checkbox\"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id=\"dg-local-explain\">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>";

var ControllerFactory = function ControllerFactory( object, property ) {

	var initialValue = object[ property ];
	if ( Common.isArray( arguments[ 2 ] ) || Common.isObject( arguments[ 2 ] ) ) {

		return new OptionController( object, property, arguments[ 2 ] );

	}
	if ( Common.isNumber( initialValue ) ) {

		if ( Common.isNumber( arguments[ 2 ] ) && Common.isNumber( arguments[ 3 ] ) ) {

			if ( Common.isNumber( arguments[ 4 ] ) ) {

				return new NumberControllerSlider( object, property, arguments[ 2 ], arguments[ 3 ], arguments[ 4 ] );

			}
			return new NumberControllerSlider( object, property, arguments[ 2 ], arguments[ 3 ] );

		}
		if ( Common.isNumber( arguments[ 4 ] ) ) {

			return new NumberControllerBox( object, property, { min: arguments[ 2 ], max: arguments[ 3 ], step: arguments[ 4 ] } );

		}
		return new NumberControllerBox( object, property, { min: arguments[ 2 ], max: arguments[ 3 ] } );

	}
	if ( Common.isString( initialValue ) ) {

		return new StringController( object, property );

	}
	if ( Common.isFunction( initialValue ) ) {

		return new FunctionController( object, property, '' );

	}
	if ( Common.isBoolean( initialValue ) ) {

		return new BooleanController( object, property );

	}
	return null;

};

function dat_gui_module_requestAnimationFrame( callback ) {

	setTimeout( callback, 1000 / 60 );

}
var requestAnimationFrame$1 = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || dat_gui_module_requestAnimationFrame;

var CenteredDiv = function () {

	function CenteredDiv() {

		classCallCheck( this, CenteredDiv );
		this.backgroundElement = document.createElement( 'div' );
		Common.extend( this.backgroundElement.style, {
			backgroundColor: 'rgba(0,0,0,0.8)',
			top: 0,
			left: 0,
			display: 'none',
			zIndex: '1000',
			opacity: 0,
			WebkitTransition: 'opacity 0.2s linear',
			transition: 'opacity 0.2s linear'
		} );
		dom.makeFullscreen( this.backgroundElement );
		this.backgroundElement.style.position = 'fixed';
		this.domElement = document.createElement( 'div' );
		Common.extend( this.domElement.style, {
			position: 'fixed',
			display: 'none',
			zIndex: '1001',
			opacity: 0,
			WebkitTransition: '-webkit-transform 0.2s ease-out, opacity 0.2s linear',
			transition: 'transform 0.2s ease-out, opacity 0.2s linear'
		} );
		document.body.appendChild( this.backgroundElement );
		document.body.appendChild( this.domElement );
		var _this = this;
		dom.bind( this.backgroundElement, 'click', function () {

			_this.hide();

		} );

	}
	createClass( CenteredDiv, [ {
		key: 'show',
		value: function show() {

			var _this = this;
			this.backgroundElement.style.display = 'block';
			this.domElement.style.display = 'block';
			this.domElement.style.opacity = 0;
			this.domElement.style.webkitTransform = 'scale(1.1)';
			this.layout();
			Common.defer( function () {

				_this.backgroundElement.style.opacity = 1;
				_this.domElement.style.opacity = 1;
				_this.domElement.style.webkitTransform = 'scale(1)';

			} );

		}
	}, {
		key: 'hide',
		value: function hide() {

			var _this = this;
			var hide = function hide() {

				_this.domElement.style.display = 'none';
				_this.backgroundElement.style.display = 'none';
				dom.unbind( _this.domElement, 'webkitTransitionEnd', hide );
				dom.unbind( _this.domElement, 'transitionend', hide );
				dom.unbind( _this.domElement, 'oTransitionEnd', hide );

			};
			dom.bind( this.domElement, 'webkitTransitionEnd', hide );
			dom.bind( this.domElement, 'transitionend', hide );
			dom.bind( this.domElement, 'oTransitionEnd', hide );
			this.backgroundElement.style.opacity = 0;
			this.domElement.style.opacity = 0;
			this.domElement.style.webkitTransform = 'scale(1.1)';

		}
	}, {
		key: 'layout',
		value: function layout() {

			this.domElement.style.left = window.innerWidth / 2 - dom.getWidth( this.domElement ) / 2 + 'px';
			this.domElement.style.top = window.innerHeight / 2 - dom.getHeight( this.domElement ) / 2 + 'px';

		}
	} ] );
	return CenteredDiv;

}();

var styleSheet = ___$insertStyle( ".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n" );

css.inject( styleSheet );
var CSS_NAMESPACE = 'dg';
var HIDE_KEY_CODE = 72;
var CLOSE_BUTTON_HEIGHT = 20;
var DEFAULT_DEFAULT_PRESET_NAME = 'Default';
var SUPPORTS_LOCAL_STORAGE = function () {

	try {

		return !! window.localStorage;

	} catch ( e ) {

		return false;

	}

}();
var SAVE_DIALOGUE = void 0;
var autoPlaceVirgin = true;
var autoPlaceContainer = void 0;
var hide = false;
var hideableGuis = [];
var GUI = function GUI( pars ) {

	var _this = this;
	var params = pars || {};
	this.domElement = document.createElement( 'div' );
	this.__ul = document.createElement( 'ul' );
	this.domElement.appendChild( this.__ul );
	dom.addClass( this.domElement, CSS_NAMESPACE );
	this.__folders = {};
	this.__controllers = [];
	this.__rememberedObjects = [];
	this.__rememberedObjectIndecesToControllers = [];
	this.__listening = [];
	params = Common.defaults( params, {
		closeOnTop: false,
		autoPlace: true,
		width: GUI.DEFAULT_WIDTH
	} );
	params = Common.defaults( params, {
		resizable: params.autoPlace,
		hideable: params.autoPlace
	} );
	if ( ! Common.isUndefined( params.load ) ) {

		if ( params.preset ) {

			params.load.preset = params.preset;

		}

	} else {

		params.load = { preset: DEFAULT_DEFAULT_PRESET_NAME };

	}
	if ( Common.isUndefined( params.parent ) && params.hideable ) {

		hideableGuis.push( this );

	}
	params.resizable = Common.isUndefined( params.parent ) && params.resizable;
	if ( params.autoPlace && Common.isUndefined( params.scrollable ) ) {

		params.scrollable = true;

	}
	var useLocalStorage = SUPPORTS_LOCAL_STORAGE && localStorage.getItem( getLocalStorageHash( this, 'isLocal' ) ) === 'true';
	var saveToLocalStorage = void 0;
	var titleRow = void 0;
	Object.defineProperties( this,
		{
			parent: {
				get: function get$$1() {

					return params.parent;

				}
			},
			scrollable: {
				get: function get$$1() {

					return params.scrollable;

				}
			},
			autoPlace: {
				get: function get$$1() {

					return params.autoPlace;

				}
			},
			closeOnTop: {
				get: function get$$1() {

					return params.closeOnTop;

				}
			},
			preset: {
				get: function get$$1() {

					if ( _this.parent ) {

						return _this.getRoot().preset;

					}
					return params.load.preset;

				},
				set: function set$$1( v ) {

					if ( _this.parent ) {

						_this.getRoot().preset = v;

					} else {

						params.load.preset = v;

					}
					setPresetSelectIndex( this );
					_this.revert();

				}
			},
			width: {
				get: function get$$1() {

					return params.width;

				},
				set: function set$$1( v ) {

					params.width = v;
					setWidth( _this, v );

				}
			},
			name: {
				get: function get$$1() {

					return params.name;

				},
				set: function set$$1( v ) {

					params.name = v;
					if ( titleRow ) {

						titleRow.innerHTML = params.name;

					}

				}
			},
			closed: {
				get: function get$$1() {

					return params.closed;

				},
				set: function set$$1( v ) {

					params.closed = v;
					if ( params.closed ) {

						dom.addClass( _this.__ul, GUI.CLASS_CLOSED );

					} else {

						dom.removeClass( _this.__ul, GUI.CLASS_CLOSED );

					}
					this.onResize();
					if ( _this.__closeButton ) {

						_this.__closeButton.innerHTML = v ? GUI.TEXT_OPEN : GUI.TEXT_CLOSED;

					}

				}
			},
			load: {
				get: function get$$1() {

					return params.load;

				}
			},
			useLocalStorage: {
				get: function get$$1() {

					return useLocalStorage;

				},
				set: function set$$1( bool ) {

					if ( SUPPORTS_LOCAL_STORAGE ) {

						useLocalStorage = bool;
						if ( bool ) {

							dom.bind( window, 'unload', saveToLocalStorage );

						} else {

							dom.unbind( window, 'unload', saveToLocalStorage );

						}
						localStorage.setItem( getLocalStorageHash( _this, 'isLocal' ), bool );

					}

				}
			}
		} );
	if ( Common.isUndefined( params.parent ) ) {

		this.closed = params.closed || false;
		dom.addClass( this.domElement, GUI.CLASS_MAIN );
		dom.makeSelectable( this.domElement, false );
		if ( SUPPORTS_LOCAL_STORAGE ) {

			if ( useLocalStorage ) {

				_this.useLocalStorage = true;
				var savedGui = localStorage.getItem( getLocalStorageHash( this, 'gui' ) );
				if ( savedGui ) {

					params.load = JSON.parse( savedGui );

				}

			}

		}
		this.__closeButton = document.createElement( 'div' );
		this.__closeButton.innerHTML = GUI.TEXT_CLOSED;
		dom.addClass( this.__closeButton, GUI.CLASS_CLOSE_BUTTON );
		if ( params.closeOnTop ) {

			dom.addClass( this.__closeButton, GUI.CLASS_CLOSE_TOP );
			this.domElement.insertBefore( this.__closeButton, this.domElement.childNodes[ 0 ] );

		} else {

			dom.addClass( this.__closeButton, GUI.CLASS_CLOSE_BOTTOM );
			this.domElement.appendChild( this.__closeButton );

		}
		dom.bind( this.__closeButton, 'click', function () {

			_this.closed = ! _this.closed;

		} );

	} else {

		if ( params.closed === undefined ) {

			params.closed = true;

		}
		var titleRowName = document.createTextNode( params.name );
		dom.addClass( titleRowName, 'controller-name' );
		titleRow = addRow( _this, titleRowName );
		var onClickTitle = function onClickTitle( e ) {

			e.preventDefault();
			_this.closed = ! _this.closed;
			return false;

		};
		dom.addClass( this.__ul, GUI.CLASS_CLOSED );
		dom.addClass( titleRow, 'title' );
		dom.bind( titleRow, 'click', onClickTitle );
		if ( ! params.closed ) {

			this.closed = false;

		}

	}
	if ( params.autoPlace ) {

		if ( Common.isUndefined( params.parent ) ) {

			if ( autoPlaceVirgin ) {

				autoPlaceContainer = document.createElement( 'div' );
				dom.addClass( autoPlaceContainer, CSS_NAMESPACE );
				dom.addClass( autoPlaceContainer, GUI.CLASS_AUTO_PLACE_CONTAINER );
				document.body.appendChild( autoPlaceContainer );
				autoPlaceVirgin = false;

			}
			autoPlaceContainer.appendChild( this.domElement );
			dom.addClass( this.domElement, GUI.CLASS_AUTO_PLACE );

		}
		if ( ! this.parent ) {

			setWidth( _this, params.width );

		}

	}
	this.__resizeHandler = function () {

		_this.onResizeDebounced();

	};
	dom.bind( window, 'resize', this.__resizeHandler );
	dom.bind( this.__ul, 'webkitTransitionEnd', this.__resizeHandler );
	dom.bind( this.__ul, 'transitionend', this.__resizeHandler );
	dom.bind( this.__ul, 'oTransitionEnd', this.__resizeHandler );
	this.onResize();
	if ( params.resizable ) {

		addResizeHandle( this );

	}
	saveToLocalStorage = function saveToLocalStorage() {

		if ( SUPPORTS_LOCAL_STORAGE && localStorage.getItem( getLocalStorageHash( _this, 'isLocal' ) ) === 'true' ) {

			localStorage.setItem( getLocalStorageHash( _this, 'gui' ), JSON.stringify( _this.getSaveObject() ) );

		}

	};
	this.saveToLocalStorageIfPossible = saveToLocalStorage;
	function resetWidth() {

		var root = _this.getRoot();
		root.width += 1;
		Common.defer( function () {

			root.width -= 1;

		} );

	}
	if ( ! params.parent ) {

		resetWidth();

	}

};
GUI.toggleHide = function () {

	hide = ! hide;
	Common.each( hideableGuis, function ( gui ) {

		gui.domElement.style.display = hide ? 'none' : '';

	} );

};
GUI.CLASS_AUTO_PLACE = 'a';
GUI.CLASS_AUTO_PLACE_CONTAINER = 'ac';
GUI.CLASS_MAIN = 'main';
GUI.CLASS_CONTROLLER_ROW = 'cr';
GUI.CLASS_TOO_TALL = 'taller-than-window';
GUI.CLASS_CLOSED = 'closed';
GUI.CLASS_CLOSE_BUTTON = 'close-button';
GUI.CLASS_CLOSE_TOP = 'close-top';
GUI.CLASS_CLOSE_BOTTOM = 'close-bottom';
GUI.CLASS_DRAG = 'drag';
GUI.DEFAULT_WIDTH = 245;
GUI.TEXT_CLOSED = 'Close Controls';
GUI.TEXT_OPEN = 'Open Controls';
GUI._keydownHandler = function ( e ) {

	if ( document.activeElement.type !== 'text' && ( e.which === HIDE_KEY_CODE || e.keyCode === HIDE_KEY_CODE ) ) {

		GUI.toggleHide();

	}

};
dom.bind( window, 'keydown', GUI._keydownHandler, false );
Common.extend( GUI.prototype,
	{
		add: function add( object, property ) {

			return _add( this, object, property, {
				factoryArgs: Array.prototype.slice.call( arguments, 2 )
			} );

		},
		addColor: function addColor( object, property ) {

			return _add( this, object, property, {
				color: true
			} );

		},
		remove: function remove( controller ) {

			this.__ul.removeChild( controller.__li );
			this.__controllers.splice( this.__controllers.indexOf( controller ), 1 );
			var _this = this;
			Common.defer( function () {

				_this.onResize();

			} );

		},
		destroy: function destroy() {

			if ( this.parent ) {

				throw new Error( 'Only the root GUI should be removed with .destroy(). ' + 'For subfolders, use gui.removeFolder(folder) instead.' );

			}
			if ( this.autoPlace ) {

				autoPlaceContainer.removeChild( this.domElement );

			}
			var _this = this;
			Common.each( this.__folders, function ( subfolder ) {

				_this.removeFolder( subfolder );

			} );
			dom.unbind( window, 'keydown', GUI._keydownHandler, false );
			removeListeners( this );

		},
		addFolder: function addFolder( name ) {

			if ( this.__folders[ name ] !== undefined ) {

				throw new Error( 'You already have a folder in this GUI by the' + ' name "' + name + '"' );

			}
			var newGuiParams = { name: name, parent: this };
			newGuiParams.autoPlace = this.autoPlace;
			if ( this.load &&
    this.load.folders &&
    this.load.folders[ name ] ) {

				newGuiParams.closed = this.load.folders[ name ].closed;
				newGuiParams.load = this.load.folders[ name ];

			}
			var gui = new GUI( newGuiParams );
			this.__folders[ name ] = gui;
			var li = addRow( this, gui.domElement );
			dom.addClass( li, 'folder' );
			return gui;

		},
		removeFolder: function removeFolder( folder ) {

			this.__ul.removeChild( folder.domElement.parentElement );
			delete this.__folders[ folder.name ];
			if ( this.load &&
    this.load.folders &&
    this.load.folders[ folder.name ] ) {

				delete this.load.folders[ folder.name ];

			}
			removeListeners( folder );
			var _this = this;
			Common.each( folder.__folders, function ( subfolder ) {

				folder.removeFolder( subfolder );

			} );
			Common.defer( function () {

				_this.onResize();

			} );

		},
		open: function open() {

			this.closed = false;

		},
		close: function close() {

			this.closed = true;

		},
		hide: function hide() {

			this.domElement.style.display = 'none';

		},
		show: function show() {

			this.domElement.style.display = '';

		},
		onResize: function onResize() {

			var root = this.getRoot();
			if ( root.scrollable ) {

				var top = dom.getOffset( root.__ul ).top;
				var h = 0;
				Common.each( root.__ul.childNodes, function ( node ) {

					if ( ! ( root.autoPlace && node === root.__save_row ) ) {

						h += dom.getHeight( node );

					}

				} );
				if ( window.innerHeight - top - CLOSE_BUTTON_HEIGHT < h ) {

					dom.addClass( root.domElement, GUI.CLASS_TOO_TALL );
					root.__ul.style.height = window.innerHeight - top - CLOSE_BUTTON_HEIGHT + 'px';

				} else {

					dom.removeClass( root.domElement, GUI.CLASS_TOO_TALL );
					root.__ul.style.height = 'auto';

				}

			}
			if ( root.__resize_handle ) {

				Common.defer( function () {

					root.__resize_handle.style.height = root.__ul.offsetHeight + 'px';

				} );

			}
			if ( root.__closeButton ) {

				root.__closeButton.style.width = root.width + 'px';

			}

		},
		onResizeDebounced: Common.debounce( function () {

			this.onResize();

		}, 50 ),
		remember: function remember() {

			if ( Common.isUndefined( SAVE_DIALOGUE ) ) {

				SAVE_DIALOGUE = new CenteredDiv();
				SAVE_DIALOGUE.domElement.innerHTML = saveDialogContents;

			}
			if ( this.parent ) {

				throw new Error( 'You can only call remember on a top level GUI.' );

			}
			var _this = this;
			Common.each( Array.prototype.slice.call( arguments ), function ( object ) {

				if ( _this.__rememberedObjects.length === 0 ) {

					addSaveMenu( _this );

				}
				if ( _this.__rememberedObjects.indexOf( object ) === - 1 ) {

					_this.__rememberedObjects.push( object );

				}

			} );
			if ( this.autoPlace ) {

				setWidth( this, this.width );

			}

		},
		getRoot: function getRoot() {

			var gui = this;
			while ( gui.parent ) {

				gui = gui.parent;

			}
			return gui;

		},
		getSaveObject: function getSaveObject() {

			var toReturn = this.load;
			toReturn.closed = this.closed;
			if ( this.__rememberedObjects.length > 0 ) {

				toReturn.preset = this.preset;
				if ( ! toReturn.remembered ) {

					toReturn.remembered = {};

				}
				toReturn.remembered[ this.preset ] = getCurrentPreset( this );

			}
			toReturn.folders = {};
			Common.each( this.__folders, function ( element, key ) {

				toReturn.folders[ key ] = element.getSaveObject();

			} );
			return toReturn;

		},
		save: function save() {

			if ( ! this.load.remembered ) {

				this.load.remembered = {};

			}
			this.load.remembered[ this.preset ] = getCurrentPreset( this );
			markPresetModified( this, false );
			this.saveToLocalStorageIfPossible();

		},
		saveAs: function saveAs( presetName ) {

			if ( ! this.load.remembered ) {

				this.load.remembered = {};
				this.load.remembered[ DEFAULT_DEFAULT_PRESET_NAME ] = getCurrentPreset( this, true );

			}
			this.load.remembered[ presetName ] = getCurrentPreset( this );
			this.preset = presetName;
			addPresetOption( this, presetName, true );
			this.saveToLocalStorageIfPossible();

		},
		revert: function revert( gui ) {

			Common.each( this.__controllers, function ( controller ) {

				if ( ! this.getRoot().load.remembered ) {

					controller.setValue( controller.initialValue );

				} else {

					recallSavedValue( gui || this.getRoot(), controller );

				}
				if ( controller.__onFinishChange ) {

					controller.__onFinishChange.call( controller, controller.getValue() );

				}

			}, this );
			Common.each( this.__folders, function ( folder ) {

				folder.revert( folder );

			} );
			if ( ! gui ) {

				markPresetModified( this.getRoot(), false );

			}

		},
		listen: function listen( controller ) {

			var init = this.__listening.length === 0;
			this.__listening.push( controller );
			if ( init ) {

				updateDisplays( this.__listening );

			}

		},
		updateDisplay: function updateDisplay() {

			Common.each( this.__controllers, function ( controller ) {

				controller.updateDisplay();

			} );
			Common.each( this.__folders, function ( folder ) {

				folder.updateDisplay();

			} );

		}
	} );
function addRow( gui, newDom, liBefore ) {

	var li = document.createElement( 'li' );
	if ( newDom ) {

		li.appendChild( newDom );

	}
	if ( liBefore ) {

		gui.__ul.insertBefore( li, liBefore );

	} else {

		gui.__ul.appendChild( li );

	}
	gui.onResize();
	return li;

}
function removeListeners( gui ) {

	dom.unbind( window, 'resize', gui.__resizeHandler );
	if ( gui.saveToLocalStorageIfPossible ) {

		dom.unbind( window, 'unload', gui.saveToLocalStorageIfPossible );

	}

}
function markPresetModified( gui, modified ) {

	var opt = gui.__preset_select[ gui.__preset_select.selectedIndex ];
	if ( modified ) {

		opt.innerHTML = opt.value + '*';

	} else {

		opt.innerHTML = opt.value;

	}

}
function augmentController( gui, li, controller ) {

	controller.__li = li;
	controller.__gui = gui;
	Common.extend( controller, {
		options: function options( _options ) {

			if ( arguments.length > 1 ) {

				var nextSibling = controller.__li.nextElementSibling;
				controller.remove();
				return _add( gui, controller.object, controller.property, {
					before: nextSibling,
					factoryArgs: [ Common.toArray( arguments ) ]
				} );

			}
			if ( Common.isArray( _options ) || Common.isObject( _options ) ) {

				var _nextSibling = controller.__li.nextElementSibling;
				controller.remove();
				return _add( gui, controller.object, controller.property, {
					before: _nextSibling,
					factoryArgs: [ _options ]
				} );

			}

		},
		name: function name( _name ) {

			controller.__li.firstElementChild.firstElementChild.innerHTML = _name;
			return controller;

		},
		listen: function listen() {

			controller.__gui.listen( controller );
			return controller;

		},
		remove: function remove() {

			controller.__gui.remove( controller );
			return controller;

		}
	} );
	if ( controller instanceof NumberControllerSlider ) {

		var box = new NumberControllerBox( controller.object, controller.property, { min: controller.__min, max: controller.__max, step: controller.__step } );
		Common.each( [ 'updateDisplay', 'onChange', 'onFinishChange', 'step', 'min', 'max' ], function ( method ) {

			var pc = controller[ method ];
			var pb = box[ method ];
			controller[ method ] = box[ method ] = function () {

				var args = Array.prototype.slice.call( arguments );
				pb.apply( box, args );
				return pc.apply( controller, args );

			};

		} );
		dom.addClass( li, 'has-slider' );
		controller.domElement.insertBefore( box.domElement, controller.domElement.firstElementChild );

	} else if ( controller instanceof NumberControllerBox ) {

		var r = function r( returned ) {

			if ( Common.isNumber( controller.__min ) && Common.isNumber( controller.__max ) ) {

				var oldName = controller.__li.firstElementChild.firstElementChild.innerHTML;
				var wasListening = controller.__gui.__listening.indexOf( controller ) > - 1;
				controller.remove();
				var newController = _add( gui, controller.object, controller.property, {
					before: controller.__li.nextElementSibling,
					factoryArgs: [ controller.__min, controller.__max, controller.__step ]
				} );
				newController.name( oldName );
				if ( wasListening ) newController.listen();
				return newController;

			}
			return returned;

		};
		controller.min = Common.compose( r, controller.min );
		controller.max = Common.compose( r, controller.max );

	} else if ( controller instanceof BooleanController ) {

		dom.bind( li, 'click', function () {

			dom.fakeEvent( controller.__checkbox, 'click' );

		} );
		dom.bind( controller.__checkbox, 'click', function ( e ) {

			e.stopPropagation();

		} );

	} else if ( controller instanceof FunctionController ) {

		dom.bind( li, 'click', function () {

			dom.fakeEvent( controller.__button, 'click' );

		} );
		dom.bind( li, 'mouseover', function () {

			dom.addClass( controller.__button, 'hover' );

		} );
		dom.bind( li, 'mouseout', function () {

			dom.removeClass( controller.__button, 'hover' );

		} );

	} else if ( controller instanceof ColorController ) {

		dom.addClass( li, 'color' );
		controller.updateDisplay = Common.compose( function ( val ) {

			li.style.borderLeftColor = controller.__color.toString();
			return val;

		}, controller.updateDisplay );
		controller.updateDisplay();

	}
	controller.setValue = Common.compose( function ( val ) {

		if ( gui.getRoot().__preset_select && controller.isModified() ) {

			markPresetModified( gui.getRoot(), true );

		}
		return val;

	}, controller.setValue );

}
function recallSavedValue( gui, controller ) {

	var root = gui.getRoot();
	var matchedIndex = root.__rememberedObjects.indexOf( controller.object );
	if ( matchedIndex !== - 1 ) {

		var controllerMap = root.__rememberedObjectIndecesToControllers[ matchedIndex ];
		if ( controllerMap === undefined ) {

			controllerMap = {};
			root.__rememberedObjectIndecesToControllers[ matchedIndex ] = controllerMap;

		}
		controllerMap[ controller.property ] = controller;
		if ( root.load && root.load.remembered ) {

			var presetMap = root.load.remembered;
			var preset = void 0;
			if ( presetMap[ gui.preset ] ) {

				preset = presetMap[ gui.preset ];

			} else if ( presetMap[ DEFAULT_DEFAULT_PRESET_NAME ] ) {

				preset = presetMap[ DEFAULT_DEFAULT_PRESET_NAME ];

			} else {

				return;

			}
			if ( preset[ matchedIndex ] && preset[ matchedIndex ][ controller.property ] !== undefined ) {

				var value = preset[ matchedIndex ][ controller.property ];
				controller.initialValue = value;
				controller.setValue( value );

			}

		}

	}

}
function _add( gui, object, property, params ) {

	if ( object[ property ] === undefined ) {

		throw new Error( 'Object "' + object + '" has no property "' + property + '"' );

	}
	var controller = void 0;
	if ( params.color ) {

		controller = new ColorController( object, property );

	} else {

		var factoryArgs = [ object, property ].concat( params.factoryArgs );
		controller = ControllerFactory.apply( gui, factoryArgs );

	}
	if ( params.before instanceof Controller ) {

		params.before = params.before.__li;

	}
	recallSavedValue( gui, controller );
	dom.addClass( controller.domElement, 'c' );
	var name = document.createElement( 'span' );
	dom.addClass( name, 'property-name' );
	name.innerHTML = controller.property;
	var container = document.createElement( 'div' );
	container.appendChild( name );
	container.appendChild( controller.domElement );
	var li = addRow( gui, container, params.before );
	dom.addClass( li, GUI.CLASS_CONTROLLER_ROW );
	if ( controller instanceof ColorController ) {

		dom.addClass( li, 'color' );

	} else {

		dom.addClass( li, dat_gui_module_typeof( controller.getValue() ) );

	}
	augmentController( gui, li, controller );
	gui.__controllers.push( controller );
	return controller;

}
function getLocalStorageHash( gui, key ) {

	return document.location.href + '.' + key;

}
function addPresetOption( gui, name, setSelected ) {

	var opt = document.createElement( 'option' );
	opt.innerHTML = name;
	opt.value = name;
	gui.__preset_select.appendChild( opt );
	if ( setSelected ) {

		gui.__preset_select.selectedIndex = gui.__preset_select.length - 1;

	}

}
function showHideExplain( gui, explain ) {

	explain.style.display = gui.useLocalStorage ? 'block' : 'none';

}
function addSaveMenu( gui ) {

	var div = gui.__save_row = document.createElement( 'li' );
	dom.addClass( gui.domElement, 'has-save' );
	gui.__ul.insertBefore( div, gui.__ul.firstChild );
	dom.addClass( div, 'save-row' );
	var gears = document.createElement( 'span' );
	gears.innerHTML = '&nbsp;';
	dom.addClass( gears, 'button gears' );
	var button = document.createElement( 'span' );
	button.innerHTML = 'Save';
	dom.addClass( button, 'button' );
	dom.addClass( button, 'save' );
	var button2 = document.createElement( 'span' );
	button2.innerHTML = 'New';
	dom.addClass( button2, 'button' );
	dom.addClass( button2, 'save-as' );
	var button3 = document.createElement( 'span' );
	button3.innerHTML = 'Revert';
	dom.addClass( button3, 'button' );
	dom.addClass( button3, 'revert' );
	var select = gui.__preset_select = document.createElement( 'select' );
	if ( gui.load && gui.load.remembered ) {

		Common.each( gui.load.remembered, function ( value, key ) {

			addPresetOption( gui, key, key === gui.preset );

		} );

	} else {

		addPresetOption( gui, DEFAULT_DEFAULT_PRESET_NAME, false );

	}
	dom.bind( select, 'change', function () {

		for ( var index = 0; index < gui.__preset_select.length; index ++ ) {

			gui.__preset_select[ index ].innerHTML = gui.__preset_select[ index ].value;

		}
		gui.preset = this.value;

	} );
	div.appendChild( select );
	div.appendChild( gears );
	div.appendChild( button );
	div.appendChild( button2 );
	div.appendChild( button3 );
	if ( SUPPORTS_LOCAL_STORAGE ) {

		var explain = document.getElementById( 'dg-local-explain' );
		var localStorageCheckBox = document.getElementById( 'dg-local-storage' );
		var saveLocally = document.getElementById( 'dg-save-locally' );
		saveLocally.style.display = 'block';
		if ( localStorage.getItem( getLocalStorageHash( gui, 'isLocal' ) ) === 'true' ) {

			localStorageCheckBox.setAttribute( 'checked', 'checked' );

		}
		showHideExplain( gui, explain );
		dom.bind( localStorageCheckBox, 'change', function () {

			gui.useLocalStorage = ! gui.useLocalStorage;
			showHideExplain( gui, explain );

		} );

	}
	var newConstructorTextArea = document.getElementById( 'dg-new-constructor' );
	dom.bind( newConstructorTextArea, 'keydown', function ( e ) {

		if ( e.metaKey && ( e.which === 67 || e.keyCode === 67 ) ) {

			SAVE_DIALOGUE.hide();

		}

	} );
	dom.bind( gears, 'click', function () {

		newConstructorTextArea.innerHTML = JSON.stringify( gui.getSaveObject(), undefined, 2 );
		SAVE_DIALOGUE.show();
		newConstructorTextArea.focus();
		newConstructorTextArea.select();

	} );
	dom.bind( button, 'click', function () {

		gui.save();

	} );
	dom.bind( button2, 'click', function () {

		var presetName = prompt( 'Enter a new preset name.' );
		if ( presetName ) {

			gui.saveAs( presetName );

		}

	} );
	dom.bind( button3, 'click', function () {

		gui.revert();

	} );

}
function addResizeHandle( gui ) {

	var pmouseX = void 0;
	gui.__resize_handle = document.createElement( 'div' );
	Common.extend( gui.__resize_handle.style, {
		width: '6px',
		marginLeft: '-3px',
		height: '200px',
		cursor: 'ew-resize',
		position: 'absolute'
	} );
	function drag( e ) {

		e.preventDefault();
		gui.width += pmouseX - e.clientX;
		gui.onResize();
		pmouseX = e.clientX;
		return false;

	}
	function dragStop() {

		dom.removeClass( gui.__closeButton, GUI.CLASS_DRAG );
		dom.unbind( window, 'mousemove', drag );
		dom.unbind( window, 'mouseup', dragStop );

	}
	function dragStart( e ) {

		e.preventDefault();
		pmouseX = e.clientX;
		dom.addClass( gui.__closeButton, GUI.CLASS_DRAG );
		dom.bind( window, 'mousemove', drag );
		dom.bind( window, 'mouseup', dragStop );
		return false;

	}
	dom.bind( gui.__resize_handle, 'mousedown', dragStart );
	dom.bind( gui.__closeButton, 'mousedown', dragStart );
	gui.domElement.insertBefore( gui.__resize_handle, gui.domElement.firstElementChild );

}
function setWidth( gui, w ) {

	gui.domElement.style.width = w + 'px';
	if ( gui.__save_row && gui.autoPlace ) {

		gui.__save_row.style.width = w + 'px';

	}
	if ( gui.__closeButton ) {

		gui.__closeButton.style.width = w + 'px';

	}

}
function getCurrentPreset( gui, useInitialValues ) {

	var toReturn = {};
	Common.each( gui.__rememberedObjects, function ( val, index ) {

		var savedValues = {};
		var controllerMap = gui.__rememberedObjectIndecesToControllers[ index ];
		Common.each( controllerMap, function ( controller, property ) {

			savedValues[ property ] = useInitialValues ? controller.initialValue : controller.getValue();

		} );
		toReturn[ index ] = savedValues;

	} );
	return toReturn;

}
function setPresetSelectIndex( gui ) {

	for ( var index = 0; index < gui.__preset_select.length; index ++ ) {

		if ( gui.__preset_select[ index ].value === gui.preset ) {

			gui.__preset_select.selectedIndex = index;

		}

	}

}
function updateDisplays( controllerArray ) {

	if ( controllerArray.length !== 0 ) {

		requestAnimationFrame$1.call( window, function () {

			updateDisplays( controllerArray );

		} );

	}
	Common.each( controllerArray, function ( c ) {

		c.updateDisplay();

	} );

}

var color = {
	Color: Color,
	math: ColorMath,
	interpret: interpret
};
var controllers = {
	Controller: Controller,
	BooleanController: BooleanController,
	OptionController: OptionController,
	StringController: StringController,
	NumberController: NumberController,
	NumberControllerBox: NumberControllerBox,
	NumberControllerSlider: NumberControllerSlider,
	FunctionController: FunctionController,
	ColorController: ColorController
};
var dom$1 = { dom: dom };
var gui = { GUI: GUI };
var GUI$1 = GUI;
var index = {
	color: color,
	controllers: controllers,
	dom: dom$1,
	gui: gui,
	GUI: GUI$1
};


/* harmony default export */ const dat_gui_module = ((/* unused pure expression or super */ null && (index)));

;// CONCATENATED MODULE: ./src/libraries/js/src/PluginManager.js
function PluginManager_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { PluginManager_typeof = function _typeof(obj) { return typeof obj; }; } else { PluginManager_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return PluginManager_typeof(obj); }

function PluginManager_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function PluginManager_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function PluginManager_createClass(Constructor, protoProps, staticProps) { if (protoProps) PluginManager_defineProperties(Constructor.prototype, protoProps); if (staticProps) PluginManager_defineProperties(Constructor, staticProps); return Constructor; }

// Managers


var PluginManager = /*#__PURE__*/function () {
  function PluginManager(session) {
    var _this = this;

    PluginManager_classCallCheck(this, PluginManager);

    this.session = session;
    this.applets = {};
    this.registry = {
      local: {},
      brainstorm: {}
    };
    this.state = new StateManager(); // For graphs

    this.gui = new GUI$1({
      autoPlace: false
    });
    document.body.innerHTML += "<div class='guiContainer' style=\"position:absolute; top: 0px; right: 25px; z-index: 999;\"></div>";
    document.body.querySelector('.guiContainer').appendChild(this.gui.domElement);
    document.body.querySelector('.guiContainer').style.display = 'none'; // Listen for Added/Removed States

    this.session.state.addToState('update', this.session.state.update, function (update) {
      if (update.added) {
        var _loop = function _loop(s) {
          var label = _this.registry.local[s].label;
          update.buffer.forEach(function (k) {
            if (_this.registry.brainstorm[k] == null) {
              if (k.includes(label) && k !== label) {
                _this.registry.brainstorm[k] = {
                  count: 1,
                  id: _this.session.state.subscribe(k, _this.registry.local[s].callback),
                  callback: _this.registry.local[s].callback
                };

                _this.registry.brainstorm[k].callback();
              }
            }
          });
        };

        // Apply Proper Stream Callback
        for (var s in _this.registry.local) {
          _loop(s);
        }
      }

      if (update.removed) {
        update.buffer.forEach(function (k) {
          if (_this.registry.brainstorm[k] != null) {
            _this.session.state.unsubscribe(k, _this.registry.brainstorm[k].id);

            _this.registry.brainstorm[k].callback();

            delete _this.registry.brainstorm[k];
          }
        });
      }

      update.added = '';
      update.removed = '';
      update.buffer.clear();
    });
  }

  PluginManager_createClass(PluginManager, [{
    key: "add",
    value: function add(id, name, graphs) {
      var _this2 = this;

      var streams = new Set();
      var outputs = {};
      var subscriptions = {
        session: {},
        local: {}
      };
      var nodes = {};
      var edges = [];
      graphs.forEach(function (g) {
        g.edges.forEach(function (e) {
          edges.push(e);
        });
        g.nodes.forEach(function (nodeInfo) {
          if (nodes[nodeInfo.id] == null) {
            nodes[nodeInfo.id] = nodeInfo;
            var node = new nodeInfo["class"](nodeInfo.id, _this2.session, nodeInfo.params); // Set Default Parameters

            for (var param in node.paramOptions) {
              if (node.params[param] == null) node.params[param] = node.paramOptions[param]["default"];
            }

            nodes[nodeInfo.id].instance = node;
          }
        });
      }); // Declare Applet Info

      if (this.applets[id] == null) this.applets[id] = {
        nodes: nodes,
        edges: edges,
        name: name,
        streams: streams,
        outputs: outputs,
        subscriptions: subscriptions
      };
    }
  }, {
    key: "addToGUI",
    value: function addToGUI(nodeInfo) {
      // Add GUI Element for Newly Created Nodes
      var node = nodeInfo.instance;
      var paramsMenu;

      if (node.paramOptions) {
        var paramKeys = Object.keys(node.paramOptions);

        if (paramKeys.length > 0 && !(paramKeys.length === 1 && node.paramOptions[paramKeys[0]].show === false)) {
          if (!Object.keys(this.gui.__folders).includes(node.label)) {
            var guiContainer = document.body.querySelector('.guiContainer');
            if (guiContainer.style.display === 'none') guiContainer.style.display = 'block';
            this.gui.addFolder(node.label);
            this.registry.local[nodeInfo["class"].id].gui[node.label] = []; // Capitalize Display Name

            var folderName = node.label[0].toUpperCase() + node.label.slice(1);
            this.gui.__folders[node.label].name = folderName;
          }

          paramsMenu = this.gui.__folders[node.label];
        }

        for (var param in node.paramOptions) {
          if (PluginManager_typeof(node.paramOptions[param]) === 'object' && node.params[param] != null && node.paramOptions[param].show !== false) {
            // Numbers and Text
            if (node.paramOptions[param].options == null) {
              this.registry.local[nodeInfo["class"].id].gui[node.label].push(paramsMenu.add(node.params, param, node.paramOptions[param].min, node.paramOptions[param].max, node.paramOptions[param].step));
            } // Selector
            else if (node.paramOptions[param].options.length > 1) {
                this.registry.local[nodeInfo["class"].id].gui[node.label].push(paramsMenu.add(node.params, param, node.paramOptions[param].options));
              }
          }
        }
      }
    }
  }, {
    key: "start",
    value: function start(appId) {
      var _this3 = this;

      var applet = this.applets[appId];
      applet.streams = new Set();
      applet.classInstances = {};
      var uiArray = [];
      var uiParams = {
        HTMLtemplate: '',
        setupHTML: []
      };
      var initializedNodes = []; // Get UI Components from Nodes

      var _loop2 = function _loop2(id) {
        var node = applet.nodes[id];

        if (!initializedNodes.includes(node.id)) {
          var ui = node.instance.init(node.params);

          if (ui != null) {
            // Pass Empty User Dictionary as Final Setup Call (overrides plugin defaults)
            cachedSetup = ui.setupHTML;

            ui.setupHTML = function (app) {
              cachedSetup(app);
              var defaultInput = [{}];

              for (var port in node.instance.ports) {
                if (node.instance.ports[port].defaults.input) defaultInput = node.instance.ports[port].defaults.input;
                node.instance[port](defaultInput);
              }
            }; // Push to UI Array


            uiArray.push(ui);
          }

          initializedNodes.push(node.id);
        }
      };

      for (var id in applet.nodes) {
        var cachedSetup;

        _loop2(id);
      }

      uiArray.forEach(function (o) {
        if (o.HTMLtemplate instanceof Function) o.HTMLtemplate = o.HTMLtemplate();
        uiParams.HTMLtemplate += o.HTMLtemplate;
        uiParams.setupHTML.push(o.setupHTML);
      }); // Register All Nodes

      for (var _id in applet.nodes) {
        var nodeInfo = applet.nodes[_id];
        var node = nodeInfo.instance; // Add Default State

        node.state = {
          value: null
        }; // Add to Registry

        if (this.registry.local[nodeInfo["class"].id] == null) {
          this.registry.local[nodeInfo["class"].id] = {
            label: node.label,
            count: 0,
            state: null,
            gui: {},
            callback: function callback() {}
          };
          this.registry.local[nodeInfo["class"].id].state = node.state;
          this.addToGUI(nodeInfo);
        }

        if (applet.classInstances[nodeInfo["class"].id] == null) applet.classInstances[nodeInfo["class"].id] = [node.label]; // Keep track of streams to pass to the Brainstorm
        else applet.classInstances[nodeInfo["class"].id].push(node.label);
        this.registry.local[nodeInfo["class"].id].count++;
      } // Start Graphs


      applet.edges.forEach(function (e, i) {
        var splitSource = e.source.split(':');
        var sourceName = splitSource[0];
        var sourcePort = splitSource[1];
        var sourceInfo = applet.nodes[sourceName];
        var source = sourceInfo.instance;
        var splitTarget = e.target.split(':');
        var targetName = splitTarget[0];
        var targetPort = splitTarget[1];
        var target = applet.nodes[targetName].instance;

        var callback = function callback(input) {
          // Package Single User
          if (!Array.isArray(input) && (input.value[0] == null || PluginManager_typeof(input.value[0]) !== 'object' || input.value[0].username == null)) {
            var dict = {
              username: _this3.session.info.auth.username
            };
            dict.value = input.value;
            dict.label = source.label;
            input = [dict];
          } // Unfold Appropriately


          if (input.timestamp != null) {
            input = input.value;
          } else if (Array.isArray(input[0].value)) {
            if (PluginManager_typeof(input[0].value[0]) === 'object') {
              if (input[0].value[0].username != null) {
                input = input.map(function (o) {
                  return o[0].value;
                });
              }
            }
          } else if (input[0].value != null && PluginManager_typeof(input[0].value) === 'object' && input[0].value.username != null) {
            input = input.map(function (o) {
              return o.value;
            });
          } // }
          // Send to Proper Port


          var result;
          if (targetPort != null) result = target[targetPort](input);else if (target["default"]) result = target["default"](input);else console.log('no return'); // Update State
          // try {
          //     console.log(this.session.state)
          // }

          if (result != null && Array.isArray(result) && result.length === 1) {
            target.state.value = result[0];
          } else target.state.value = result; // Update State Externally


          target.state.timestamp = Date.now();
          return result;
        }; // Pass Output From Brainstorm (and automatically stream this input)


        if (sourcePort == 'brainstorm') {
          if (sourceInfo.loop) uiParams.setupHTML.push(_this3._addStream(sourceInfo, appId, source["default"], [callback])); // Add stream function
          else uiParams.setupHTML.push(_this3._addData(sourceInfo, appId, [callback])); // Add data to listen to
          // Add to Stream List

          if (source.label != null) applet.streams.add(source.label); // Keep track of streams to pass to the Brainstorm
        } // Otherwise Just Listen for Local Changes
        else {
            if (source.label && source.state) {
              _this3.state.data[source.label] = source.state;
              if (applet.subscriptions.local[source.label] == null) applet.subscriptions.local[source.label] = [];

              if (sourceInfo.loop) {
                // Check if Already Streaming
                var found = _this3.findStreamFunction(source.label); // If Already Streaming, Subscribe to Stream


                if (found) {
                  if (_this3.session.state[source.label]) applet.subscriptions.local[source.label].push(_this3.session.state.subscribe(source.label, callback));else applet.subscriptions.local[source.label].push(_this3.state.subscribe(source.label, callback)); // console.log(this.session.state[data][source.label])

                  uiParams.setupHTML.push(function () {
                    return callback(_this3.session.state[data][source.label]);
                  });
                } // Otherwise Create Local Stream and Subscribe Locally
                else {
                    _this3.session.addStreamFunc(source.label, source["default"], _this3.state, false);

                    applet.subscriptions.local[source.label].push(_this3.state.subscribe(source.label, callback));
                  }
              } else {
                applet.subscriptions.local[source.label].push(_this3.state.subscribe(source.label, callback));
              }
            }
          }
      });
      return {
        uiParams: uiParams,
        streams: this.applets[appId].streams
      };
    }
  }, {
    key: "findStreamFunction",
    value: function findStreamFunction(prop) {
      return this.session.streamObj.streamTable.find(function (d) {
        if (d.prop === prop) {
          return d;
        }
      });
    }
  }, {
    key: "stop",
    value: function stop(appId) {
      var _this4 = this;

      var applet = this.applets[appId]; // Remove Listeners

      Object.keys(applet.classInstances).forEach(function (classId) {
        var labels = applet.classInstances[classId]; // Increment the Registry for Each Separate Label (of a particular class)

        labels.forEach(function (label) {
          _this4.registry.local[classId].count--;

          if (_this4.registry.local[classId].count == 0) {
            // Remove GUI
            for (var fname in _this4.registry.local[classId].gui) {
              var folder = _this4.registry.local[classId].gui[fname];
              folder.forEach(function (o) {
                o.remove();
              });
              var guiFolder = _this4.gui.__folders[fname];
              guiFolder.close();

              _this4.gui.__ul.removeChild(guiFolder.domElement.parentNode);

              delete _this4.gui.__folders[fname];
            } // Hide GUI When Not Required


            var guiContainer = document.body.querySelector('.guiContainer');

            if (Object.keys(_this4.gui.__folders).length) {
              if (guiContainer.style.display !== 'none') guiContainer.style.display = 'none';
            } // Remove Streaming


            delete _this4.registry.local[classId];

            _this4.session.removeStreaming(label);

            _this4.session.removeStreaming(label, null, _this4.state);
          } else {
            // Remove Subscriptions
            var sessionSubs = applet.subscriptions.session[label];
            var localSubs = applet.subscriptions.local[label];

            if (sessionSubs != null) {
              applet.subscriptions.session[label].forEach(function (id) {
                _this4.session.removeStreaming(label, id);
              });
            }

            if (localSubs != null) {
              applet.subscriptions.local[label].forEach(function (id) {
                _this4.session.removeStreaming(label, id, _this4.state);
              });
            }
          }
        });
      }); // Deinit Plugins

      for (var key in this.applets[appId].nodes) {
        this.applets[appId].nodes[key].instance.deinit();
      }

      delete this.applets[appId];
    } // Internal Methods

  }, {
    key: "_addData",
    value: function _addData(nodeInfo, appletId, callbacks) {
      var _this5 = this;

      var applet = this.applets[appletId];
      var id = nodeInfo.instance.label;
      var found = this.findStreamFunction(id);
      if (applet.subscriptions.session[id] == null) applet.subscriptions.session[id] = [];

      this.registry.local[nodeInfo["class"].id].callback = function () {
        if (_this5.session.state.data[id] != null) {
          if (callbacks) {
            var propData = _this5.session.getBrainstormData(applet.name, [id], 'app', 'plugin'); // console.log(propData, this.session.state.data)


            callbacks.forEach(function (f) {
              if (f instanceof Function) f(propData);
            });
          }
        }
      };

      if (found == null) {
        applet.subscriptions.session[id].push(this.session.streamAppData(id, this.registry.local[nodeInfo["class"].id].state, this.registry.local[nodeInfo["class"].id].callback));
      } else {
        applet.subscriptions.session[id].push(this.session.state.subscribe(id, this.registry.local[nodeInfo["class"].id].callback));
      } // Pass Callback to Send Existing Session Data


      return function () {
        _this5.registry.local[nodeInfo["class"].id].callback(_this5.session.state.data[id]);
      };
    }
  }, {
    key: "_addStream",
    value: function _addStream(nodeInfo, appletId, callback, callbacks) {
      var _this6 = this;

      var applet = this.applets[appletId];
      var id = nodeInfo.instance.label;
      if (applet.subscriptions.session[id] == null) applet.subscriptions.session[id] = [];
      var found = this.findStreamFunction(id);

      if (found == null) {
        this.session.addStreamFunc(id, callback);
      }

      this.registry.local[nodeInfo["class"].id].callback = function () {
        if (_this6.session.state.data[id] != null) {
          if (callbacks) {
            var propData = _this6.session.getBrainstormData(applet.name, [id], 'app', 'plugin');

            callbacks.forEach(function (f) {
              if (f instanceof Function) f(propData);
            });
          }
        }
      };

      applet.subscriptions.session[id].push(this.session.state.subscribe(id, this.registry.local[nodeInfo["class"].id].callback)); // Pass Callback to Send Existing Stream Data

      return function () {
        _this6.registry.local[nodeInfo["class"].id].callback(_this6.session.state.data[id]);
      };
    }
  }]);

  return PluginManager;
}();
;// CONCATENATED MODULE: ./node_modules/realm-web/node_modules/bson/dist/bson.browser.esm.js
/* provided dependency */ var bson_browser_esm_Buffer = __webpack_require__(1407)["Buffer"];
var commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof __webpack_require__.g !== 'undefined' ? __webpack_require__.g : typeof self !== 'undefined' ? self : {};

function unwrapExports (x) {
	return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;
}

function createCommonjsModule(fn, module) {
	return module = { exports: {} }, fn(module, module.exports), module.exports;
}

var byteLength_1 = byteLength;
var toByteArray_1 = toByteArray;
var fromByteArray_1 = fromByteArray;
var lookup = [];
var revLookup = [];
var Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array;
var code$1 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';

for (var bson_browser_esm_i = 0, len = code$1.length; bson_browser_esm_i < len; ++bson_browser_esm_i) {
  lookup[bson_browser_esm_i] = code$1[bson_browser_esm_i];
  revLookup[code$1.charCodeAt(bson_browser_esm_i)] = bson_browser_esm_i;
} // Support decoding URL-safe base64 strings, as Node.js does.
// See: https://en.wikipedia.org/wiki/Base64#URL_applications


revLookup['-'.charCodeAt(0)] = 62;
revLookup['_'.charCodeAt(0)] = 63;

function getLens(b64) {
  var len = b64.length;

  if (len % 4 > 0) {
    throw new Error('Invalid string. Length must be a multiple of 4');
  } // Trim off extra bytes after placeholder bytes are found
  // See: https://github.com/beatgammit/base64-js/issues/42


  var validLen = b64.indexOf('=');
  if (validLen === -1) validLen = len;
  var placeHoldersLen = validLen === len ? 0 : 4 - validLen % 4;
  return [validLen, placeHoldersLen];
} // base64 is 4/3 + up to two characters of the original data


function byteLength(b64) {
  var lens = getLens(b64);
  var validLen = lens[0];
  var placeHoldersLen = lens[1];
  return (validLen + placeHoldersLen) * 3 / 4 - placeHoldersLen;
}

function _byteLength(b64, validLen, placeHoldersLen) {
  return (validLen + placeHoldersLen) * 3 / 4 - placeHoldersLen;
}

function toByteArray(b64) {
  var tmp;
  var lens = getLens(b64);
  var validLen = lens[0];
  var placeHoldersLen = lens[1];
  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen));
  var curByte = 0; // if there are placeholders, only get up to the last complete 4 chars

  var len = placeHoldersLen > 0 ? validLen - 4 : validLen;
  var i;

  for (i = 0; i < len; i += 4) {
    tmp = revLookup[b64.charCodeAt(i)] << 18 | revLookup[b64.charCodeAt(i + 1)] << 12 | revLookup[b64.charCodeAt(i + 2)] << 6 | revLookup[b64.charCodeAt(i + 3)];
    arr[curByte++] = tmp >> 16 & 0xFF;
    arr[curByte++] = tmp >> 8 & 0xFF;
    arr[curByte++] = tmp & 0xFF;
  }

  if (placeHoldersLen === 2) {
    tmp = revLookup[b64.charCodeAt(i)] << 2 | revLookup[b64.charCodeAt(i + 1)] >> 4;
    arr[curByte++] = tmp & 0xFF;
  }

  if (placeHoldersLen === 1) {
    tmp = revLookup[b64.charCodeAt(i)] << 10 | revLookup[b64.charCodeAt(i + 1)] << 4 | revLookup[b64.charCodeAt(i + 2)] >> 2;
    arr[curByte++] = tmp >> 8 & 0xFF;
    arr[curByte++] = tmp & 0xFF;
  }

  return arr;
}

function tripletToBase64(num) {
  return lookup[num >> 18 & 0x3F] + lookup[num >> 12 & 0x3F] + lookup[num >> 6 & 0x3F] + lookup[num & 0x3F];
}

function encodeChunk(uint8, start, end) {
  var tmp;
  var output = [];

  for (var i = start; i < end; i += 3) {
    tmp = (uint8[i] << 16 & 0xFF0000) + (uint8[i + 1] << 8 & 0xFF00) + (uint8[i + 2] & 0xFF);
    output.push(tripletToBase64(tmp));
  }

  return output.join('');
}

function fromByteArray(uint8) {
  var tmp;
  var len = uint8.length;
  var extraBytes = len % 3; // if we have 1 byte left, pad 2 bytes

  var parts = [];
  var maxChunkLength = 16383; // must be multiple of 3
  // go through the array every three bytes, we'll deal with trailing stuff later

  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {
    parts.push(encodeChunk(uint8, i, i + maxChunkLength > len2 ? len2 : i + maxChunkLength));
  } // pad the end with zeros, but make sure to not forget the extra bytes


  if (extraBytes === 1) {
    tmp = uint8[len - 1];
    parts.push(lookup[tmp >> 2] + lookup[tmp << 4 & 0x3F] + '==');
  } else if (extraBytes === 2) {
    tmp = (uint8[len - 2] << 8) + uint8[len - 1];
    parts.push(lookup[tmp >> 10] + lookup[tmp >> 4 & 0x3F] + lookup[tmp << 2 & 0x3F] + '=');
  }

  return parts.join('');
}

var base64Js = {
  byteLength: byteLength_1,
  toByteArray: toByteArray_1,
  fromByteArray: fromByteArray_1
};

/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
var read = function read(buffer, offset, isLE, mLen, nBytes) {
  var e, m;
  var eLen = nBytes * 8 - mLen - 1;
  var eMax = (1 << eLen) - 1;
  var eBias = eMax >> 1;
  var nBits = -7;
  var i = isLE ? nBytes - 1 : 0;
  var d = isLE ? -1 : 1;
  var s = buffer[offset + i];
  i += d;
  e = s & (1 << -nBits) - 1;
  s >>= -nBits;
  nBits += eLen;

  for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8) {}

  m = e & (1 << -nBits) - 1;
  e >>= -nBits;
  nBits += mLen;

  for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8) {}

  if (e === 0) {
    e = 1 - eBias;
  } else if (e === eMax) {
    return m ? NaN : (s ? -1 : 1) * Infinity;
  } else {
    m = m + Math.pow(2, mLen);
    e = e - eBias;
  }

  return (s ? -1 : 1) * m * Math.pow(2, e - mLen);
};

var write = function write(buffer, value, offset, isLE, mLen, nBytes) {
  var e, m, c;
  var eLen = nBytes * 8 - mLen - 1;
  var eMax = (1 << eLen) - 1;
  var eBias = eMax >> 1;
  var rt = mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0;
  var i = isLE ? 0 : nBytes - 1;
  var d = isLE ? 1 : -1;
  var s = value < 0 || value === 0 && 1 / value < 0 ? 1 : 0;
  value = Math.abs(value);

  if (isNaN(value) || value === Infinity) {
    m = isNaN(value) ? 1 : 0;
    e = eMax;
  } else {
    e = Math.floor(Math.log(value) / Math.LN2);

    if (value * (c = Math.pow(2, -e)) < 1) {
      e--;
      c *= 2;
    }

    if (e + eBias >= 1) {
      value += rt / c;
    } else {
      value += rt * Math.pow(2, 1 - eBias);
    }

    if (value * c >= 2) {
      e++;
      c /= 2;
    }

    if (e + eBias >= eMax) {
      m = 0;
      e = eMax;
    } else if (e + eBias >= 1) {
      m = (value * c - 1) * Math.pow(2, mLen);
      e = e + eBias;
    } else {
      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen);
      e = 0;
    }
  }

  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}

  e = e << mLen | m;
  eLen += mLen;

  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}

  buffer[offset + i - d] |= s * 128;
};

var ieee754 = {
  read: read,
  write: write
};

var buffer = createCommonjsModule(function (module, exports) {

  var customInspectSymbol = typeof Symbol === 'function' && typeof Symbol['for'] === 'function' ? // eslint-disable-line dot-notation
  Symbol['for']('nodejs.util.inspect.custom') // eslint-disable-line dot-notation
  : null;
  exports.Buffer = Buffer;
  exports.SlowBuffer = SlowBuffer;
  exports.INSPECT_MAX_BYTES = 50;
  var K_MAX_LENGTH = 0x7fffffff;
  exports.kMaxLength = K_MAX_LENGTH;
  /**
   * If `Buffer.TYPED_ARRAY_SUPPORT`:
   *   === true    Use Uint8Array implementation (fastest)
   *   === false   Print warning and recommend using `buffer` v4.x which has an Object
   *               implementation (most compatible, even IE6)
   *
   * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,
   * Opera 11.6+, iOS 4.2+.
   *
   * We report that the browser does not support typed arrays if the are not subclassable
   * using __proto__. Firefox 4-29 lacks support for adding new properties to `Uint8Array`
   * (See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438). IE 10 lacks support
   * for __proto__ and has a buggy typed array implementation.
   */

  Buffer.TYPED_ARRAY_SUPPORT = typedArraySupport();

  if (!Buffer.TYPED_ARRAY_SUPPORT && typeof console !== 'undefined' && typeof console.error === 'function') {
    console.error('This browser lacks typed array (Uint8Array) support which is required by ' + '`buffer` v5.x. Use `buffer` v4.x if you require old browser support.');
  }

  function typedArraySupport() {
    // Can typed array instances can be augmented?
    try {
      var arr = new Uint8Array(1);
      var proto = {
        foo: function foo() {
          return 42;
        }
      };
      Object.setPrototypeOf(proto, Uint8Array.prototype);
      Object.setPrototypeOf(arr, proto);
      return arr.foo() === 42;
    } catch (e) {
      return false;
    }
  }

  Object.defineProperty(Buffer.prototype, 'parent', {
    enumerable: true,
    get: function get() {
      if (!Buffer.isBuffer(this)) return undefined;
      return this.buffer;
    }
  });
  Object.defineProperty(Buffer.prototype, 'offset', {
    enumerable: true,
    get: function get() {
      if (!Buffer.isBuffer(this)) return undefined;
      return this.byteOffset;
    }
  });

  function createBuffer(length) {
    if (length > K_MAX_LENGTH) {
      throw new RangeError('The value "' + length + '" is invalid for option "size"');
    } // Return an augmented `Uint8Array` instance


    var buf = new Uint8Array(length);
    Object.setPrototypeOf(buf, Buffer.prototype);
    return buf;
  }
  /**
   * The Buffer constructor returns instances of `Uint8Array` that have their
   * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of
   * `Uint8Array`, so the returned instances will have all the node `Buffer` methods
   * and the `Uint8Array` methods. Square bracket notation works as expected -- it
   * returns a single octet.
   *
   * The `Uint8Array` prototype remains unmodified.
   */


  function Buffer(arg, encodingOrOffset, length) {
    // Common case.
    if (typeof arg === 'number') {
      if (typeof encodingOrOffset === 'string') {
        throw new TypeError('The "string" argument must be of type string. Received type number');
      }

      return allocUnsafe(arg);
    }

    return from(arg, encodingOrOffset, length);
  }

  Buffer.poolSize = 8192; // not used by this implementation

  function from(value, encodingOrOffset, length) {
    if (typeof value === 'string') {
      return fromString(value, encodingOrOffset);
    }

    if (ArrayBuffer.isView(value)) {
      return fromArrayView(value);
    }

    if (value == null) {
      throw new TypeError('The first argument must be one of type string, Buffer, ArrayBuffer, Array, ' + 'or Array-like Object. Received type ' + babelHelpers["typeof"](value));
    }

    if (isInstance(value, ArrayBuffer) || value && isInstance(value.buffer, ArrayBuffer)) {
      return fromArrayBuffer(value, encodingOrOffset, length);
    }

    if (typeof SharedArrayBuffer !== 'undefined' && (isInstance(value, SharedArrayBuffer) || value && isInstance(value.buffer, SharedArrayBuffer))) {
      return fromArrayBuffer(value, encodingOrOffset, length);
    }

    if (typeof value === 'number') {
      throw new TypeError('The "value" argument must not be of type number. Received type number');
    }

    var valueOf = value.valueOf && value.valueOf();

    if (valueOf != null && valueOf !== value) {
      return Buffer.from(valueOf, encodingOrOffset, length);
    }

    var b = fromObject(value);
    if (b) return b;

    if (typeof Symbol !== 'undefined' && Symbol.toPrimitive != null && typeof value[Symbol.toPrimitive] === 'function') {
      return Buffer.from(value[Symbol.toPrimitive]('string'), encodingOrOffset, length);
    }

    throw new TypeError('The first argument must be one of type string, Buffer, ArrayBuffer, Array, ' + 'or Array-like Object. Received type ' + babelHelpers["typeof"](value));
  }
  /**
   * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError
   * if value is a number.
   * Buffer.from(str[, encoding])
   * Buffer.from(array)
   * Buffer.from(buffer)
   * Buffer.from(arrayBuffer[, byteOffset[, length]])
   **/


  Buffer.from = function (value, encodingOrOffset, length) {
    return from(value, encodingOrOffset, length);
  }; // Note: Change prototype *after* Buffer.from is defined to workaround Chrome bug:
  // https://github.com/feross/buffer/pull/148


  Object.setPrototypeOf(Buffer.prototype, Uint8Array.prototype);
  Object.setPrototypeOf(Buffer, Uint8Array);

  function assertSize(size) {
    if (typeof size !== 'number') {
      throw new TypeError('"size" argument must be of type number');
    } else if (size < 0) {
      throw new RangeError('The value "' + size + '" is invalid for option "size"');
    }
  }

  function alloc(size, fill, encoding) {
    assertSize(size);

    if (size <= 0) {
      return createBuffer(size);
    }

    if (fill !== undefined) {
      // Only pay attention to encoding if it's a string. This
      // prevents accidentally sending in a number that would
      // be interpreted as a start offset.
      return typeof encoding === 'string' ? createBuffer(size).fill(fill, encoding) : createBuffer(size).fill(fill);
    }

    return createBuffer(size);
  }
  /**
   * Creates a new filled Buffer instance.
   * alloc(size[, fill[, encoding]])
   **/


  Buffer.alloc = function (size, fill, encoding) {
    return alloc(size, fill, encoding);
  };

  function allocUnsafe(size) {
    assertSize(size);
    return createBuffer(size < 0 ? 0 : checked(size) | 0);
  }
  /**
   * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.
   * */


  Buffer.allocUnsafe = function (size) {
    return allocUnsafe(size);
  };
  /**
   * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.
   */


  Buffer.allocUnsafeSlow = function (size) {
    return allocUnsafe(size);
  };

  function fromString(string, encoding) {
    if (typeof encoding !== 'string' || encoding === '') {
      encoding = 'utf8';
    }

    if (!Buffer.isEncoding(encoding)) {
      throw new TypeError('Unknown encoding: ' + encoding);
    }

    var length = byteLength(string, encoding) | 0;
    var buf = createBuffer(length);
    var actual = buf.write(string, encoding);

    if (actual !== length) {
      // Writing a hex string, for example, that contains invalid characters will
      // cause everything after the first invalid character to be ignored. (e.g.
      // 'abxxcd' will be treated as 'ab')
      buf = buf.slice(0, actual);
    }

    return buf;
  }

  function fromArrayLike(array) {
    var length = array.length < 0 ? 0 : checked(array.length) | 0;
    var buf = createBuffer(length);

    for (var i = 0; i < length; i += 1) {
      buf[i] = array[i] & 255;
    }

    return buf;
  }

  function fromArrayView(arrayView) {
    if (isInstance(arrayView, Uint8Array)) {
      var copy = new Uint8Array(arrayView);
      return fromArrayBuffer(copy.buffer, copy.byteOffset, copy.byteLength);
    }

    return fromArrayLike(arrayView);
  }

  function fromArrayBuffer(array, byteOffset, length) {
    if (byteOffset < 0 || array.byteLength < byteOffset) {
      throw new RangeError('"offset" is outside of buffer bounds');
    }

    if (array.byteLength < byteOffset + (length || 0)) {
      throw new RangeError('"length" is outside of buffer bounds');
    }

    var buf;

    if (byteOffset === undefined && length === undefined) {
      buf = new Uint8Array(array);
    } else if (length === undefined) {
      buf = new Uint8Array(array, byteOffset);
    } else {
      buf = new Uint8Array(array, byteOffset, length);
    } // Return an augmented `Uint8Array` instance


    Object.setPrototypeOf(buf, Buffer.prototype);
    return buf;
  }

  function fromObject(obj) {
    if (Buffer.isBuffer(obj)) {
      var len = checked(obj.length) | 0;
      var buf = createBuffer(len);

      if (buf.length === 0) {
        return buf;
      }

      obj.copy(buf, 0, 0, len);
      return buf;
    }

    if (obj.length !== undefined) {
      if (typeof obj.length !== 'number' || numberIsNaN(obj.length)) {
        return createBuffer(0);
      }

      return fromArrayLike(obj);
    }

    if (obj.type === 'Buffer' && Array.isArray(obj.data)) {
      return fromArrayLike(obj.data);
    }
  }

  function checked(length) {
    // Note: cannot use `length < K_MAX_LENGTH` here because that fails when
    // length is NaN (which is otherwise coerced to zero.)
    if (length >= K_MAX_LENGTH) {
      throw new RangeError('Attempt to allocate Buffer larger than maximum ' + 'size: 0x' + K_MAX_LENGTH.toString(16) + ' bytes');
    }

    return length | 0;
  }

  function SlowBuffer(length) {
    if (+length != length) {
      // eslint-disable-line eqeqeq
      length = 0;
    }

    return Buffer.alloc(+length);
  }

  Buffer.isBuffer = function isBuffer(b) {
    return b != null && b._isBuffer === true && b !== Buffer.prototype; // so Buffer.isBuffer(Buffer.prototype) will be false
  };

  Buffer.compare = function compare(a, b) {
    if (isInstance(a, Uint8Array)) a = Buffer.from(a, a.offset, a.byteLength);
    if (isInstance(b, Uint8Array)) b = Buffer.from(b, b.offset, b.byteLength);

    if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {
      throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');
    }

    if (a === b) return 0;
    var x = a.length;
    var y = b.length;

    for (var i = 0, len = Math.min(x, y); i < len; ++i) {
      if (a[i] !== b[i]) {
        x = a[i];
        y = b[i];
        break;
      }
    }

    if (x < y) return -1;
    if (y < x) return 1;
    return 0;
  };

  Buffer.isEncoding = function isEncoding(encoding) {
    switch (String(encoding).toLowerCase()) {
      case 'hex':
      case 'utf8':
      case 'utf-8':
      case 'ascii':
      case 'latin1':
      case 'binary':
      case 'base64':
      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return true;

      default:
        return false;
    }
  };

  Buffer.concat = function concat(list, length) {
    if (!Array.isArray(list)) {
      throw new TypeError('"list" argument must be an Array of Buffers');
    }

    if (list.length === 0) {
      return Buffer.alloc(0);
    }

    var i;

    if (length === undefined) {
      length = 0;

      for (i = 0; i < list.length; ++i) {
        length += list[i].length;
      }
    }

    var buffer = Buffer.allocUnsafe(length);
    var pos = 0;

    for (i = 0; i < list.length; ++i) {
      var buf = list[i];

      if (isInstance(buf, Uint8Array)) {
        if (pos + buf.length > buffer.length) {
          Buffer.from(buf).copy(buffer, pos);
        } else {
          Uint8Array.prototype.set.call(buffer, buf, pos);
        }
      } else if (!Buffer.isBuffer(buf)) {
        throw new TypeError('"list" argument must be an Array of Buffers');
      } else {
        buf.copy(buffer, pos);
      }

      pos += buf.length;
    }

    return buffer;
  };

  function byteLength(string, encoding) {
    if (Buffer.isBuffer(string)) {
      return string.length;
    }

    if (ArrayBuffer.isView(string) || isInstance(string, ArrayBuffer)) {
      return string.byteLength;
    }

    if (typeof string !== 'string') {
      throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. ' + 'Received type ' + babelHelpers["typeof"](string));
    }

    var len = string.length;
    var mustMatch = arguments.length > 2 && arguments[2] === true;
    if (!mustMatch && len === 0) return 0; // Use a for loop to avoid recursion

    var loweredCase = false;

    for (;;) {
      switch (encoding) {
        case 'ascii':
        case 'latin1':
        case 'binary':
          return len;

        case 'utf8':
        case 'utf-8':
          return utf8ToBytes(string).length;

        case 'ucs2':
        case 'ucs-2':
        case 'utf16le':
        case 'utf-16le':
          return len * 2;

        case 'hex':
          return len >>> 1;

        case 'base64':
          return base64ToBytes(string).length;

        default:
          if (loweredCase) {
            return mustMatch ? -1 : utf8ToBytes(string).length; // assume utf8
          }

          encoding = ('' + encoding).toLowerCase();
          loweredCase = true;
      }
    }
  }

  Buffer.byteLength = byteLength;

  function slowToString(encoding, start, end) {
    var loweredCase = false; // No need to verify that "this.length <= MAX_UINT32" since it's a read-only
    // property of a typed array.
    // This behaves neither like String nor Uint8Array in that we set start/end
    // to their upper/lower bounds if the value passed is out of range.
    // undefined is handled specially as per ECMA-262 6th Edition,
    // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.

    if (start === undefined || start < 0) {
      start = 0;
    } // Return early if start > this.length. Done here to prevent potential uint32
    // coercion fail below.


    if (start > this.length) {
      return '';
    }

    if (end === undefined || end > this.length) {
      end = this.length;
    }

    if (end <= 0) {
      return '';
    } // Force coercion to uint32. This will also coerce falsey/NaN values to 0.


    end >>>= 0;
    start >>>= 0;

    if (end <= start) {
      return '';
    }

    if (!encoding) encoding = 'utf8';

    while (true) {
      switch (encoding) {
        case 'hex':
          return hexSlice(this, start, end);

        case 'utf8':
        case 'utf-8':
          return utf8Slice(this, start, end);

        case 'ascii':
          return asciiSlice(this, start, end);

        case 'latin1':
        case 'binary':
          return latin1Slice(this, start, end);

        case 'base64':
          return base64Slice(this, start, end);

        case 'ucs2':
        case 'ucs-2':
        case 'utf16le':
        case 'utf-16le':
          return utf16leSlice(this, start, end);

        default:
          if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding);
          encoding = (encoding + '').toLowerCase();
          loweredCase = true;
      }
    }
  } // This property is used by `Buffer.isBuffer` (and the `is-buffer` npm package)
  // to detect a Buffer instance. It's not possible to use `instanceof Buffer`
  // reliably in a browserify context because there could be multiple different
  // copies of the 'buffer' package in use. This method works even for Buffer
  // instances that were created from another copy of the `buffer` package.
  // See: https://github.com/feross/buffer/issues/154


  Buffer.prototype._isBuffer = true;

  function swap(b, n, m) {
    var i = b[n];
    b[n] = b[m];
    b[m] = i;
  }

  Buffer.prototype.swap16 = function swap16() {
    var len = this.length;

    if (len % 2 !== 0) {
      throw new RangeError('Buffer size must be a multiple of 16-bits');
    }

    for (var i = 0; i < len; i += 2) {
      swap(this, i, i + 1);
    }

    return this;
  };

  Buffer.prototype.swap32 = function swap32() {
    var len = this.length;

    if (len % 4 !== 0) {
      throw new RangeError('Buffer size must be a multiple of 32-bits');
    }

    for (var i = 0; i < len; i += 4) {
      swap(this, i, i + 3);
      swap(this, i + 1, i + 2);
    }

    return this;
  };

  Buffer.prototype.swap64 = function swap64() {
    var len = this.length;

    if (len % 8 !== 0) {
      throw new RangeError('Buffer size must be a multiple of 64-bits');
    }

    for (var i = 0; i < len; i += 8) {
      swap(this, i, i + 7);
      swap(this, i + 1, i + 6);
      swap(this, i + 2, i + 5);
      swap(this, i + 3, i + 4);
    }

    return this;
  };

  Buffer.prototype.toString = function toString() {
    var length = this.length;
    if (length === 0) return '';
    if (arguments.length === 0) return utf8Slice(this, 0, length);
    return slowToString.apply(this, arguments);
  };

  Buffer.prototype.toLocaleString = Buffer.prototype.toString;

  Buffer.prototype.equals = function equals(b) {
    if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer');
    if (this === b) return true;
    return Buffer.compare(this, b) === 0;
  };

  Buffer.prototype.inspect = function inspect() {
    var str = '';
    var max = exports.INSPECT_MAX_BYTES;
    str = this.toString('hex', 0, max).replace(/(.{2})/g, '$1 ').trim();
    if (this.length > max) str += ' ... ';
    return '<Buffer ' + str + '>';
  };

  if (customInspectSymbol) {
    Buffer.prototype[customInspectSymbol] = Buffer.prototype.inspect;
  }

  Buffer.prototype.compare = function compare(target, start, end, thisStart, thisEnd) {
    if (isInstance(target, Uint8Array)) {
      target = Buffer.from(target, target.offset, target.byteLength);
    }

    if (!Buffer.isBuffer(target)) {
      throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. ' + 'Received type ' + babelHelpers["typeof"](target));
    }

    if (start === undefined) {
      start = 0;
    }

    if (end === undefined) {
      end = target ? target.length : 0;
    }

    if (thisStart === undefined) {
      thisStart = 0;
    }

    if (thisEnd === undefined) {
      thisEnd = this.length;
    }

    if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {
      throw new RangeError('out of range index');
    }

    if (thisStart >= thisEnd && start >= end) {
      return 0;
    }

    if (thisStart >= thisEnd) {
      return -1;
    }

    if (start >= end) {
      return 1;
    }

    start >>>= 0;
    end >>>= 0;
    thisStart >>>= 0;
    thisEnd >>>= 0;
    if (this === target) return 0;
    var x = thisEnd - thisStart;
    var y = end - start;
    var len = Math.min(x, y);
    var thisCopy = this.slice(thisStart, thisEnd);
    var targetCopy = target.slice(start, end);

    for (var i = 0; i < len; ++i) {
      if (thisCopy[i] !== targetCopy[i]) {
        x = thisCopy[i];
        y = targetCopy[i];
        break;
      }
    }

    if (x < y) return -1;
    if (y < x) return 1;
    return 0;
  }; // Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,
  // OR the last index of `val` in `buffer` at offset <= `byteOffset`.
  //
  // Arguments:
  // - buffer - a Buffer to search
  // - val - a string, Buffer, or number
  // - byteOffset - an index into `buffer`; will be clamped to an int32
  // - encoding - an optional encoding, relevant is val is a string
  // - dir - true for indexOf, false for lastIndexOf


  function bidirectionalIndexOf(buffer, val, byteOffset, encoding, dir) {
    // Empty buffer means no match
    if (buffer.length === 0) return -1; // Normalize byteOffset

    if (typeof byteOffset === 'string') {
      encoding = byteOffset;
      byteOffset = 0;
    } else if (byteOffset > 0x7fffffff) {
      byteOffset = 0x7fffffff;
    } else if (byteOffset < -0x80000000) {
      byteOffset = -0x80000000;
    }

    byteOffset = +byteOffset; // Coerce to Number.

    if (numberIsNaN(byteOffset)) {
      // byteOffset: it it's undefined, null, NaN, "foo", etc, search whole buffer
      byteOffset = dir ? 0 : buffer.length - 1;
    } // Normalize byteOffset: negative offsets start from the end of the buffer


    if (byteOffset < 0) byteOffset = buffer.length + byteOffset;

    if (byteOffset >= buffer.length) {
      if (dir) return -1;else byteOffset = buffer.length - 1;
    } else if (byteOffset < 0) {
      if (dir) byteOffset = 0;else return -1;
    } // Normalize val


    if (typeof val === 'string') {
      val = Buffer.from(val, encoding);
    } // Finally, search either indexOf (if dir is true) or lastIndexOf


    if (Buffer.isBuffer(val)) {
      // Special case: looking for empty string/buffer always fails
      if (val.length === 0) {
        return -1;
      }

      return arrayIndexOf(buffer, val, byteOffset, encoding, dir);
    } else if (typeof val === 'number') {
      val = val & 0xFF; // Search for a byte value [0-255]

      if (typeof Uint8Array.prototype.indexOf === 'function') {
        if (dir) {
          return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset);
        } else {
          return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset);
        }
      }

      return arrayIndexOf(buffer, [val], byteOffset, encoding, dir);
    }

    throw new TypeError('val must be string, number or Buffer');
  }

  function arrayIndexOf(arr, val, byteOffset, encoding, dir) {
    var indexSize = 1;
    var arrLength = arr.length;
    var valLength = val.length;

    if (encoding !== undefined) {
      encoding = String(encoding).toLowerCase();

      if (encoding === 'ucs2' || encoding === 'ucs-2' || encoding === 'utf16le' || encoding === 'utf-16le') {
        if (arr.length < 2 || val.length < 2) {
          return -1;
        }

        indexSize = 2;
        arrLength /= 2;
        valLength /= 2;
        byteOffset /= 2;
      }
    }

    function read(buf, i) {
      if (indexSize === 1) {
        return buf[i];
      } else {
        return buf.readUInt16BE(i * indexSize);
      }
    }

    var i;

    if (dir) {
      var foundIndex = -1;

      for (i = byteOffset; i < arrLength; i++) {
        if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {
          if (foundIndex === -1) foundIndex = i;
          if (i - foundIndex + 1 === valLength) return foundIndex * indexSize;
        } else {
          if (foundIndex !== -1) i -= i - foundIndex;
          foundIndex = -1;
        }
      }
    } else {
      if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength;

      for (i = byteOffset; i >= 0; i--) {
        var found = true;

        for (var j = 0; j < valLength; j++) {
          if (read(arr, i + j) !== read(val, j)) {
            found = false;
            break;
          }
        }

        if (found) return i;
      }
    }

    return -1;
  }

  Buffer.prototype.includes = function includes(val, byteOffset, encoding) {
    return this.indexOf(val, byteOffset, encoding) !== -1;
  };

  Buffer.prototype.indexOf = function indexOf(val, byteOffset, encoding) {
    return bidirectionalIndexOf(this, val, byteOffset, encoding, true);
  };

  Buffer.prototype.lastIndexOf = function lastIndexOf(val, byteOffset, encoding) {
    return bidirectionalIndexOf(this, val, byteOffset, encoding, false);
  };

  function hexWrite(buf, string, offset, length) {
    offset = Number(offset) || 0;
    var remaining = buf.length - offset;

    if (!length) {
      length = remaining;
    } else {
      length = Number(length);

      if (length > remaining) {
        length = remaining;
      }
    }

    var strLen = string.length;

    if (length > strLen / 2) {
      length = strLen / 2;
    }

    for (var i = 0; i < length; ++i) {
      var parsed = parseInt(string.substr(i * 2, 2), 16);
      if (numberIsNaN(parsed)) return i;
      buf[offset + i] = parsed;
    }

    return i;
  }

  function utf8Write(buf, string, offset, length) {
    return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length);
  }

  function asciiWrite(buf, string, offset, length) {
    return blitBuffer(asciiToBytes(string), buf, offset, length);
  }

  function base64Write(buf, string, offset, length) {
    return blitBuffer(base64ToBytes(string), buf, offset, length);
  }

  function ucs2Write(buf, string, offset, length) {
    return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length);
  }

  Buffer.prototype.write = function write(string, offset, length, encoding) {
    // Buffer#write(string)
    if (offset === undefined) {
      encoding = 'utf8';
      length = this.length;
      offset = 0; // Buffer#write(string, encoding)
    } else if (length === undefined && typeof offset === 'string') {
      encoding = offset;
      length = this.length;
      offset = 0; // Buffer#write(string, offset[, length][, encoding])
    } else if (isFinite(offset)) {
      offset = offset >>> 0;

      if (isFinite(length)) {
        length = length >>> 0;
        if (encoding === undefined) encoding = 'utf8';
      } else {
        encoding = length;
        length = undefined;
      }
    } else {
      throw new Error('Buffer.write(string, encoding, offset[, length]) is no longer supported');
    }

    var remaining = this.length - offset;
    if (length === undefined || length > remaining) length = remaining;

    if (string.length > 0 && (length < 0 || offset < 0) || offset > this.length) {
      throw new RangeError('Attempt to write outside buffer bounds');
    }

    if (!encoding) encoding = 'utf8';
    var loweredCase = false;

    for (;;) {
      switch (encoding) {
        case 'hex':
          return hexWrite(this, string, offset, length);

        case 'utf8':
        case 'utf-8':
          return utf8Write(this, string, offset, length);

        case 'ascii':
        case 'latin1':
        case 'binary':
          return asciiWrite(this, string, offset, length);

        case 'base64':
          // Warning: maxLength not taken into account in base64Write
          return base64Write(this, string, offset, length);

        case 'ucs2':
        case 'ucs-2':
        case 'utf16le':
        case 'utf-16le':
          return ucs2Write(this, string, offset, length);

        default:
          if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding);
          encoding = ('' + encoding).toLowerCase();
          loweredCase = true;
      }
    }
  };

  Buffer.prototype.toJSON = function toJSON() {
    return {
      type: 'Buffer',
      data: Array.prototype.slice.call(this._arr || this, 0)
    };
  };

  function base64Slice(buf, start, end) {
    if (start === 0 && end === buf.length) {
      return base64Js.fromByteArray(buf);
    } else {
      return base64Js.fromByteArray(buf.slice(start, end));
    }
  }

  function utf8Slice(buf, start, end) {
    end = Math.min(buf.length, end);
    var res = [];
    var i = start;

    while (i < end) {
      var firstByte = buf[i];
      var codePoint = null;
      var bytesPerSequence = firstByte > 0xEF ? 4 : firstByte > 0xDF ? 3 : firstByte > 0xBF ? 2 : 1;

      if (i + bytesPerSequence <= end) {
        var secondByte, thirdByte, fourthByte, tempCodePoint;

        switch (bytesPerSequence) {
          case 1:
            if (firstByte < 0x80) {
              codePoint = firstByte;
            }

            break;

          case 2:
            secondByte = buf[i + 1];

            if ((secondByte & 0xC0) === 0x80) {
              tempCodePoint = (firstByte & 0x1F) << 0x6 | secondByte & 0x3F;

              if (tempCodePoint > 0x7F) {
                codePoint = tempCodePoint;
              }
            }

            break;

          case 3:
            secondByte = buf[i + 1];
            thirdByte = buf[i + 2];

            if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {
              tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | thirdByte & 0x3F;

              if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {
                codePoint = tempCodePoint;
              }
            }

            break;

          case 4:
            secondByte = buf[i + 1];
            thirdByte = buf[i + 2];
            fourthByte = buf[i + 3];

            if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {
              tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | fourthByte & 0x3F;

              if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {
                codePoint = tempCodePoint;
              }
            }

        }
      }

      if (codePoint === null) {
        // we did not generate a valid codePoint so insert a
        // replacement char (U+FFFD) and advance only 1 byte
        codePoint = 0xFFFD;
        bytesPerSequence = 1;
      } else if (codePoint > 0xFFFF) {
        // encode to utf16 (surrogate pair dance)
        codePoint -= 0x10000;
        res.push(codePoint >>> 10 & 0x3FF | 0xD800);
        codePoint = 0xDC00 | codePoint & 0x3FF;
      }

      res.push(codePoint);
      i += bytesPerSequence;
    }

    return decodeCodePointsArray(res);
  } // Based on http://stackoverflow.com/a/22747272/680742, the browser with
  // the lowest limit is Chrome, with 0x10000 args.
  // We go 1 magnitude less, for safety


  var MAX_ARGUMENTS_LENGTH = 0x1000;

  function decodeCodePointsArray(codePoints) {
    var len = codePoints.length;

    if (len <= MAX_ARGUMENTS_LENGTH) {
      return String.fromCharCode.apply(String, codePoints); // avoid extra slice()
    } // Decode in chunks to avoid "call stack size exceeded".


    var res = '';
    var i = 0;

    while (i < len) {
      res += String.fromCharCode.apply(String, codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH));
    }

    return res;
  }

  function asciiSlice(buf, start, end) {
    var ret = '';
    end = Math.min(buf.length, end);

    for (var i = start; i < end; ++i) {
      ret += String.fromCharCode(buf[i] & 0x7F);
    }

    return ret;
  }

  function latin1Slice(buf, start, end) {
    var ret = '';
    end = Math.min(buf.length, end);

    for (var i = start; i < end; ++i) {
      ret += String.fromCharCode(buf[i]);
    }

    return ret;
  }

  function hexSlice(buf, start, end) {
    var len = buf.length;
    if (!start || start < 0) start = 0;
    if (!end || end < 0 || end > len) end = len;
    var out = '';

    for (var i = start; i < end; ++i) {
      out += hexSliceLookupTable[buf[i]];
    }

    return out;
  }

  function utf16leSlice(buf, start, end) {
    var bytes = buf.slice(start, end);
    var res = ''; // If bytes.length is odd, the last 8 bits must be ignored (same as node.js)

    for (var i = 0; i < bytes.length - 1; i += 2) {
      res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256);
    }

    return res;
  }

  Buffer.prototype.slice = function slice(start, end) {
    var len = this.length;
    start = ~~start;
    end = end === undefined ? len : ~~end;

    if (start < 0) {
      start += len;
      if (start < 0) start = 0;
    } else if (start > len) {
      start = len;
    }

    if (end < 0) {
      end += len;
      if (end < 0) end = 0;
    } else if (end > len) {
      end = len;
    }

    if (end < start) end = start;
    var newBuf = this.subarray(start, end); // Return an augmented `Uint8Array` instance

    Object.setPrototypeOf(newBuf, Buffer.prototype);
    return newBuf;
  };
  /*
   * Need to make sure that buffer isn't trying to write out of bounds.
   */


  function checkOffset(offset, ext, length) {
    if (offset % 1 !== 0 || offset < 0) throw new RangeError('offset is not uint');
    if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length');
  }

  Buffer.prototype.readUintLE = Buffer.prototype.readUIntLE = function readUIntLE(offset, byteLength, noAssert) {
    offset = offset >>> 0;
    byteLength = byteLength >>> 0;
    if (!noAssert) checkOffset(offset, byteLength, this.length);
    var val = this[offset];
    var mul = 1;
    var i = 0;

    while (++i < byteLength && (mul *= 0x100)) {
      val += this[offset + i] * mul;
    }

    return val;
  };

  Buffer.prototype.readUintBE = Buffer.prototype.readUIntBE = function readUIntBE(offset, byteLength, noAssert) {
    offset = offset >>> 0;
    byteLength = byteLength >>> 0;

    if (!noAssert) {
      checkOffset(offset, byteLength, this.length);
    }

    var val = this[offset + --byteLength];
    var mul = 1;

    while (byteLength > 0 && (mul *= 0x100)) {
      val += this[offset + --byteLength] * mul;
    }

    return val;
  };

  Buffer.prototype.readUint8 = Buffer.prototype.readUInt8 = function readUInt8(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 1, this.length);
    return this[offset];
  };

  Buffer.prototype.readUint16LE = Buffer.prototype.readUInt16LE = function readUInt16LE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 2, this.length);
    return this[offset] | this[offset + 1] << 8;
  };

  Buffer.prototype.readUint16BE = Buffer.prototype.readUInt16BE = function readUInt16BE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 2, this.length);
    return this[offset] << 8 | this[offset + 1];
  };

  Buffer.prototype.readUint32LE = Buffer.prototype.readUInt32LE = function readUInt32LE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 4, this.length);
    return (this[offset] | this[offset + 1] << 8 | this[offset + 2] << 16) + this[offset + 3] * 0x1000000;
  };

  Buffer.prototype.readUint32BE = Buffer.prototype.readUInt32BE = function readUInt32BE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 4, this.length);
    return this[offset] * 0x1000000 + (this[offset + 1] << 16 | this[offset + 2] << 8 | this[offset + 3]);
  };

  Buffer.prototype.readIntLE = function readIntLE(offset, byteLength, noAssert) {
    offset = offset >>> 0;
    byteLength = byteLength >>> 0;
    if (!noAssert) checkOffset(offset, byteLength, this.length);
    var val = this[offset];
    var mul = 1;
    var i = 0;

    while (++i < byteLength && (mul *= 0x100)) {
      val += this[offset + i] * mul;
    }

    mul *= 0x80;
    if (val >= mul) val -= Math.pow(2, 8 * byteLength);
    return val;
  };

  Buffer.prototype.readIntBE = function readIntBE(offset, byteLength, noAssert) {
    offset = offset >>> 0;
    byteLength = byteLength >>> 0;
    if (!noAssert) checkOffset(offset, byteLength, this.length);
    var i = byteLength;
    var mul = 1;
    var val = this[offset + --i];

    while (i > 0 && (mul *= 0x100)) {
      val += this[offset + --i] * mul;
    }

    mul *= 0x80;
    if (val >= mul) val -= Math.pow(2, 8 * byteLength);
    return val;
  };

  Buffer.prototype.readInt8 = function readInt8(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 1, this.length);
    if (!(this[offset] & 0x80)) return this[offset];
    return (0xff - this[offset] + 1) * -1;
  };

  Buffer.prototype.readInt16LE = function readInt16LE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 2, this.length);
    var val = this[offset] | this[offset + 1] << 8;
    return val & 0x8000 ? val | 0xFFFF0000 : val;
  };

  Buffer.prototype.readInt16BE = function readInt16BE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 2, this.length);
    var val = this[offset + 1] | this[offset] << 8;
    return val & 0x8000 ? val | 0xFFFF0000 : val;
  };

  Buffer.prototype.readInt32LE = function readInt32LE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 4, this.length);
    return this[offset] | this[offset + 1] << 8 | this[offset + 2] << 16 | this[offset + 3] << 24;
  };

  Buffer.prototype.readInt32BE = function readInt32BE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 4, this.length);
    return this[offset] << 24 | this[offset + 1] << 16 | this[offset + 2] << 8 | this[offset + 3];
  };

  Buffer.prototype.readFloatLE = function readFloatLE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 4, this.length);
    return ieee754.read(this, offset, true, 23, 4);
  };

  Buffer.prototype.readFloatBE = function readFloatBE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 4, this.length);
    return ieee754.read(this, offset, false, 23, 4);
  };

  Buffer.prototype.readDoubleLE = function readDoubleLE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 8, this.length);
    return ieee754.read(this, offset, true, 52, 8);
  };

  Buffer.prototype.readDoubleBE = function readDoubleBE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 8, this.length);
    return ieee754.read(this, offset, false, 52, 8);
  };

  function checkInt(buf, value, offset, ext, max, min) {
    if (!Buffer.isBuffer(buf)) throw new TypeError('"buffer" argument must be a Buffer instance');
    if (value > max || value < min) throw new RangeError('"value" argument is out of bounds');
    if (offset + ext > buf.length) throw new RangeError('Index out of range');
  }

  Buffer.prototype.writeUintLE = Buffer.prototype.writeUIntLE = function writeUIntLE(value, offset, byteLength, noAssert) {
    value = +value;
    offset = offset >>> 0;
    byteLength = byteLength >>> 0;

    if (!noAssert) {
      var maxBytes = Math.pow(2, 8 * byteLength) - 1;
      checkInt(this, value, offset, byteLength, maxBytes, 0);
    }

    var mul = 1;
    var i = 0;
    this[offset] = value & 0xFF;

    while (++i < byteLength && (mul *= 0x100)) {
      this[offset + i] = value / mul & 0xFF;
    }

    return offset + byteLength;
  };

  Buffer.prototype.writeUintBE = Buffer.prototype.writeUIntBE = function writeUIntBE(value, offset, byteLength, noAssert) {
    value = +value;
    offset = offset >>> 0;
    byteLength = byteLength >>> 0;

    if (!noAssert) {
      var maxBytes = Math.pow(2, 8 * byteLength) - 1;
      checkInt(this, value, offset, byteLength, maxBytes, 0);
    }

    var i = byteLength - 1;
    var mul = 1;
    this[offset + i] = value & 0xFF;

    while (--i >= 0 && (mul *= 0x100)) {
      this[offset + i] = value / mul & 0xFF;
    }

    return offset + byteLength;
  };

  Buffer.prototype.writeUint8 = Buffer.prototype.writeUInt8 = function writeUInt8(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0);
    this[offset] = value & 0xff;
    return offset + 1;
  };

  Buffer.prototype.writeUint16LE = Buffer.prototype.writeUInt16LE = function writeUInt16LE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0);
    this[offset] = value & 0xff;
    this[offset + 1] = value >>> 8;
    return offset + 2;
  };

  Buffer.prototype.writeUint16BE = Buffer.prototype.writeUInt16BE = function writeUInt16BE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0);
    this[offset] = value >>> 8;
    this[offset + 1] = value & 0xff;
    return offset + 2;
  };

  Buffer.prototype.writeUint32LE = Buffer.prototype.writeUInt32LE = function writeUInt32LE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0);
    this[offset + 3] = value >>> 24;
    this[offset + 2] = value >>> 16;
    this[offset + 1] = value >>> 8;
    this[offset] = value & 0xff;
    return offset + 4;
  };

  Buffer.prototype.writeUint32BE = Buffer.prototype.writeUInt32BE = function writeUInt32BE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0);
    this[offset] = value >>> 24;
    this[offset + 1] = value >>> 16;
    this[offset + 2] = value >>> 8;
    this[offset + 3] = value & 0xff;
    return offset + 4;
  };

  Buffer.prototype.writeIntLE = function writeIntLE(value, offset, byteLength, noAssert) {
    value = +value;
    offset = offset >>> 0;

    if (!noAssert) {
      var limit = Math.pow(2, 8 * byteLength - 1);
      checkInt(this, value, offset, byteLength, limit - 1, -limit);
    }

    var i = 0;
    var mul = 1;
    var sub = 0;
    this[offset] = value & 0xFF;

    while (++i < byteLength && (mul *= 0x100)) {
      if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {
        sub = 1;
      }

      this[offset + i] = (value / mul >> 0) - sub & 0xFF;
    }

    return offset + byteLength;
  };

  Buffer.prototype.writeIntBE = function writeIntBE(value, offset, byteLength, noAssert) {
    value = +value;
    offset = offset >>> 0;

    if (!noAssert) {
      var limit = Math.pow(2, 8 * byteLength - 1);
      checkInt(this, value, offset, byteLength, limit - 1, -limit);
    }

    var i = byteLength - 1;
    var mul = 1;
    var sub = 0;
    this[offset + i] = value & 0xFF;

    while (--i >= 0 && (mul *= 0x100)) {
      if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {
        sub = 1;
      }

      this[offset + i] = (value / mul >> 0) - sub & 0xFF;
    }

    return offset + byteLength;
  };

  Buffer.prototype.writeInt8 = function writeInt8(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80);
    if (value < 0) value = 0xff + value + 1;
    this[offset] = value & 0xff;
    return offset + 1;
  };

  Buffer.prototype.writeInt16LE = function writeInt16LE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000);
    this[offset] = value & 0xff;
    this[offset + 1] = value >>> 8;
    return offset + 2;
  };

  Buffer.prototype.writeInt16BE = function writeInt16BE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000);
    this[offset] = value >>> 8;
    this[offset + 1] = value & 0xff;
    return offset + 2;
  };

  Buffer.prototype.writeInt32LE = function writeInt32LE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000);
    this[offset] = value & 0xff;
    this[offset + 1] = value >>> 8;
    this[offset + 2] = value >>> 16;
    this[offset + 3] = value >>> 24;
    return offset + 4;
  };

  Buffer.prototype.writeInt32BE = function writeInt32BE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000);
    if (value < 0) value = 0xffffffff + value + 1;
    this[offset] = value >>> 24;
    this[offset + 1] = value >>> 16;
    this[offset + 2] = value >>> 8;
    this[offset + 3] = value & 0xff;
    return offset + 4;
  };

  function checkIEEE754(buf, value, offset, ext, max, min) {
    if (offset + ext > buf.length) throw new RangeError('Index out of range');
    if (offset < 0) throw new RangeError('Index out of range');
  }

  function writeFloat(buf, value, offset, littleEndian, noAssert) {
    value = +value;
    offset = offset >>> 0;

    if (!noAssert) {
      checkIEEE754(buf, value, offset, 4);
    }

    ieee754.write(buf, value, offset, littleEndian, 23, 4);
    return offset + 4;
  }

  Buffer.prototype.writeFloatLE = function writeFloatLE(value, offset, noAssert) {
    return writeFloat(this, value, offset, true, noAssert);
  };

  Buffer.prototype.writeFloatBE = function writeFloatBE(value, offset, noAssert) {
    return writeFloat(this, value, offset, false, noAssert);
  };

  function writeDouble(buf, value, offset, littleEndian, noAssert) {
    value = +value;
    offset = offset >>> 0;

    if (!noAssert) {
      checkIEEE754(buf, value, offset, 8);
    }

    ieee754.write(buf, value, offset, littleEndian, 52, 8);
    return offset + 8;
  }

  Buffer.prototype.writeDoubleLE = function writeDoubleLE(value, offset, noAssert) {
    return writeDouble(this, value, offset, true, noAssert);
  };

  Buffer.prototype.writeDoubleBE = function writeDoubleBE(value, offset, noAssert) {
    return writeDouble(this, value, offset, false, noAssert);
  }; // copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)


  Buffer.prototype.copy = function copy(target, targetStart, start, end) {
    if (!Buffer.isBuffer(target)) throw new TypeError('argument should be a Buffer');
    if (!start) start = 0;
    if (!end && end !== 0) end = this.length;
    if (targetStart >= target.length) targetStart = target.length;
    if (!targetStart) targetStart = 0;
    if (end > 0 && end < start) end = start; // Copy 0 bytes; we're done

    if (end === start) return 0;
    if (target.length === 0 || this.length === 0) return 0; // Fatal error conditions

    if (targetStart < 0) {
      throw new RangeError('targetStart out of bounds');
    }

    if (start < 0 || start >= this.length) throw new RangeError('Index out of range');
    if (end < 0) throw new RangeError('sourceEnd out of bounds'); // Are we oob?

    if (end > this.length) end = this.length;

    if (target.length - targetStart < end - start) {
      end = target.length - targetStart + start;
    }

    var len = end - start;

    if (this === target && typeof Uint8Array.prototype.copyWithin === 'function') {
      // Use built-in when available, missing from IE11
      this.copyWithin(targetStart, start, end);
    } else {
      Uint8Array.prototype.set.call(target, this.subarray(start, end), targetStart);
    }

    return len;
  }; // Usage:
  //    buffer.fill(number[, offset[, end]])
  //    buffer.fill(buffer[, offset[, end]])
  //    buffer.fill(string[, offset[, end]][, encoding])


  Buffer.prototype.fill = function fill(val, start, end, encoding) {
    // Handle string cases:
    if (typeof val === 'string') {
      if (typeof start === 'string') {
        encoding = start;
        start = 0;
        end = this.length;
      } else if (typeof end === 'string') {
        encoding = end;
        end = this.length;
      }

      if (encoding !== undefined && typeof encoding !== 'string') {
        throw new TypeError('encoding must be a string');
      }

      if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {
        throw new TypeError('Unknown encoding: ' + encoding);
      }

      if (val.length === 1) {
        var code = val.charCodeAt(0);

        if (encoding === 'utf8' && code < 128 || encoding === 'latin1') {
          // Fast path: If `val` fits into a single byte, use that numeric value.
          val = code;
        }
      }
    } else if (typeof val === 'number') {
      val = val & 255;
    } else if (typeof val === 'boolean') {
      val = Number(val);
    } // Invalid ranges are not set to a default, so can range check early.


    if (start < 0 || this.length < start || this.length < end) {
      throw new RangeError('Out of range index');
    }

    if (end <= start) {
      return this;
    }

    start = start >>> 0;
    end = end === undefined ? this.length : end >>> 0;
    if (!val) val = 0;
    var i;

    if (typeof val === 'number') {
      for (i = start; i < end; ++i) {
        this[i] = val;
      }
    } else {
      var bytes = Buffer.isBuffer(val) ? val : Buffer.from(val, encoding);
      var len = bytes.length;

      if (len === 0) {
        throw new TypeError('The value "' + val + '" is invalid for argument "value"');
      }

      for (i = 0; i < end - start; ++i) {
        this[i + start] = bytes[i % len];
      }
    }

    return this;
  }; // HELPER FUNCTIONS
  // ================


  var INVALID_BASE64_RE = /[^+/0-9A-Za-z-_]/g;

  function base64clean(str) {
    // Node takes equal signs as end of the Base64 encoding
    str = str.split('=')[0]; // Node strips out invalid characters like \n and \t from the string, base64-js does not

    str = str.trim().replace(INVALID_BASE64_RE, ''); // Node converts strings with length < 2 to ''

    if (str.length < 2) return ''; // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not

    while (str.length % 4 !== 0) {
      str = str + '=';
    }

    return str;
  }

  function utf8ToBytes(string, units) {
    units = units || Infinity;
    var codePoint;
    var length = string.length;
    var leadSurrogate = null;
    var bytes = [];

    for (var i = 0; i < length; ++i) {
      codePoint = string.charCodeAt(i); // is surrogate component

      if (codePoint > 0xD7FF && codePoint < 0xE000) {
        // last char was a lead
        if (!leadSurrogate) {
          // no lead yet
          if (codePoint > 0xDBFF) {
            // unexpected trail
            if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD);
            continue;
          } else if (i + 1 === length) {
            // unpaired lead
            if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD);
            continue;
          } // valid lead


          leadSurrogate = codePoint;
          continue;
        } // 2 leads in a row


        if (codePoint < 0xDC00) {
          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD);
          leadSurrogate = codePoint;
          continue;
        } // valid surrogate pair


        codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000;
      } else if (leadSurrogate) {
        // valid bmp char, but last char was a lead
        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD);
      }

      leadSurrogate = null; // encode utf8

      if (codePoint < 0x80) {
        if ((units -= 1) < 0) break;
        bytes.push(codePoint);
      } else if (codePoint < 0x800) {
        if ((units -= 2) < 0) break;
        bytes.push(codePoint >> 0x6 | 0xC0, codePoint & 0x3F | 0x80);
      } else if (codePoint < 0x10000) {
        if ((units -= 3) < 0) break;
        bytes.push(codePoint >> 0xC | 0xE0, codePoint >> 0x6 & 0x3F | 0x80, codePoint & 0x3F | 0x80);
      } else if (codePoint < 0x110000) {
        if ((units -= 4) < 0) break;
        bytes.push(codePoint >> 0x12 | 0xF0, codePoint >> 0xC & 0x3F | 0x80, codePoint >> 0x6 & 0x3F | 0x80, codePoint & 0x3F | 0x80);
      } else {
        throw new Error('Invalid code point');
      }
    }

    return bytes;
  }

  function asciiToBytes(str) {
    var byteArray = [];

    for (var i = 0; i < str.length; ++i) {
      // Node's code seems to be doing this and not & 0x7F..
      byteArray.push(str.charCodeAt(i) & 0xFF);
    }

    return byteArray;
  }

  function utf16leToBytes(str, units) {
    var c, hi, lo;
    var byteArray = [];

    for (var i = 0; i < str.length; ++i) {
      if ((units -= 2) < 0) break;
      c = str.charCodeAt(i);
      hi = c >> 8;
      lo = c % 256;
      byteArray.push(lo);
      byteArray.push(hi);
    }

    return byteArray;
  }

  function base64ToBytes(str) {
    return base64Js.toByteArray(base64clean(str));
  }

  function blitBuffer(src, dst, offset, length) {
    for (var i = 0; i < length; ++i) {
      if (i + offset >= dst.length || i >= src.length) break;
      dst[i + offset] = src[i];
    }

    return i;
  } // ArrayBuffer or Uint8Array objects from other contexts (i.e. iframes) do not pass
  // the `instanceof` check but they should be treated as of that type.
  // See: https://github.com/feross/buffer/issues/166


  function isInstance(obj, type) {
    return obj instanceof type || obj != null && obj.constructor != null && obj.constructor.name != null && obj.constructor.name === type.name;
  }

  function numberIsNaN(obj) {
    // For IE11 support
    return obj !== obj; // eslint-disable-line no-self-compare
  } // Create lookup table for `toString('hex')`
  // See: https://github.com/feross/buffer/issues/219


  var hexSliceLookupTable = function () {
    var alphabet = '0123456789abcdef';
    var table = new Array(256);

    for (var i = 0; i < 16; ++i) {
      var i16 = i * 16;

      for (var j = 0; j < 16; ++j) {
        table[i16 + j] = alphabet[i] + alphabet[j];
      }
    }

    return table;
  }();
});
buffer.Buffer;
buffer.SlowBuffer;
buffer.INSPECT_MAX_BYTES;
buffer.kMaxLength;

var require$$0 = {};

var bson_browser_esm_inherits;

if (typeof Object.create === 'function') {
  bson_browser_esm_inherits = function inherits(ctor, superCtor) {
    // implementation from standard node.js 'util' module
    ctor.super_ = superCtor;
    ctor.prototype = Object.create(superCtor.prototype, {
      constructor: {
        value: ctor,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
  };
} else {
  bson_browser_esm_inherits = function inherits(ctor, superCtor) {
    ctor.super_ = superCtor;

    var TempCtor = function TempCtor() {};

    TempCtor.prototype = superCtor.prototype;
    ctor.prototype = new TempCtor();
    ctor.prototype.constructor = ctor;
  };
}

var inherits$1 = bson_browser_esm_inherits;

// Copyright Joyent, Inc. and other Node contributors.
var formatRegExp = /%[sdj%]/g;
function format(f) {
  if (!bson_browser_esm_isString(f)) {
    var objects = [];

    for (var i = 0; i < arguments.length; i++) {
      objects.push(inspect(arguments[i]));
    }

    return objects.join(' ');
  }

  var i = 1;
  var args = arguments;
  var len = args.length;
  var str = String(f).replace(formatRegExp, function (x) {
    if (x === '%%') return '%';
    if (i >= len) return x;

    switch (x) {
      case '%s':
        return String(args[i++]);

      case '%d':
        return Number(args[i++]);

      case '%j':
        try {
          return JSON.stringify(args[i++]);
        } catch (_) {
          return '[Circular]';
        }

      default:
        return x;
    }
  });

  for (var x = args[i]; i < len; x = args[++i]) {
    if (bson_browser_esm_isNull(x) || !isObject(x)) {
      str += ' ' + x;
    } else {
      str += ' ' + inspect(x);
    }
  }

  return str;
}
// Returns a modified function which warns once by default.
// If --no-deprecation is set, then it is a no-op.

function deprecate(fn, msg) {
  // Allow for deprecating things in the process of starting up.
  if (bson_browser_esm_isUndefined(__webpack_require__.g.process)) {
    return function () {
      return deprecate(fn, msg).apply(this, arguments);
    };
  }

  var warned = false;

  function deprecated() {
    if (!warned) {
      {
        console.error(msg);
      }

      warned = true;
    }

    return fn.apply(this, arguments);
  }

  return deprecated;
}
var debugs = {};
var debugEnviron;
function debuglog(set) {
  if (bson_browser_esm_isUndefined(debugEnviron)) debugEnviron = '';
  set = set.toUpperCase();

  if (!debugs[set]) {
    if (new RegExp('\\b' + set + '\\b', 'i').test(debugEnviron)) {
      var pid = 0;

      debugs[set] = function () {
        var msg = format.apply(null, arguments);
        console.error('%s %d: %s', set, pid, msg);
      };
    } else {
      debugs[set] = function () {};
    }
  }

  return debugs[set];
}
/**
 * Echos the value of a value. Trys to print the value out
 * in the best way possible given the different types.
 *
 * @param {Object} obj The object to print out.
 * @param {Object} opts Optional options object that alters the output.
 */

/* legacy: obj, showHidden, depth, colors*/

function inspect(obj, opts) {
  // default options
  var ctx = {
    seen: [],
    stylize: stylizeNoColor
  }; // legacy...

  if (arguments.length >= 3) ctx.depth = arguments[2];
  if (arguments.length >= 4) ctx.colors = arguments[3];

  if (bson_browser_esm_isBoolean(opts)) {
    // legacy...
    ctx.showHidden = opts;
  } else if (opts) {
    // got an "options" object
    _extend(ctx, opts);
  } // set default options


  if (bson_browser_esm_isUndefined(ctx.showHidden)) ctx.showHidden = false;
  if (bson_browser_esm_isUndefined(ctx.depth)) ctx.depth = 2;
  if (bson_browser_esm_isUndefined(ctx.colors)) ctx.colors = false;
  if (bson_browser_esm_isUndefined(ctx.customInspect)) ctx.customInspect = true;
  if (ctx.colors) ctx.stylize = stylizeWithColor;
  return formatValue(ctx, obj, ctx.depth);
} // http://en.wikipedia.org/wiki/ANSI_escape_code#graphics

inspect.colors = {
  'bold': [1, 22],
  'italic': [3, 23],
  'underline': [4, 24],
  'inverse': [7, 27],
  'white': [37, 39],
  'grey': [90, 39],
  'black': [30, 39],
  'blue': [34, 39],
  'cyan': [36, 39],
  'green': [32, 39],
  'magenta': [35, 39],
  'red': [31, 39],
  'yellow': [33, 39]
}; // Don't use 'blue' not visible on cmd.exe

inspect.styles = {
  'special': 'cyan',
  'number': 'yellow',
  'boolean': 'yellow',
  'undefined': 'grey',
  'null': 'bold',
  'string': 'green',
  'date': 'magenta',
  // "name": intentionally not styling
  'regexp': 'red'
};

function stylizeWithColor(str, styleType) {
  var style = inspect.styles[styleType];

  if (style) {
    return "\x1B[" + inspect.colors[style][0] + 'm' + str + "\x1B[" + inspect.colors[style][1] + 'm';
  } else {
    return str;
  }
}

function stylizeNoColor(str, styleType) {
  return str;
}

function arrayToHash(array) {
  var hash = {};
  array.forEach(function (val, idx) {
    hash[val] = true;
  });
  return hash;
}

function formatValue(ctx, value, recurseTimes) {
  // Provide a hook for user-specified inspect functions.
  // Check that value is an object with an inspect function on it
  if (ctx.customInspect && value && isFunction(value.inspect) && // Filter out the util module, it's inspect function is special
  value.inspect !== inspect && // Also filter out any prototype objects using the circular check.
  !(value.constructor && value.constructor.prototype === value)) {
    var ret = value.inspect(recurseTimes, ctx);

    if (!bson_browser_esm_isString(ret)) {
      ret = formatValue(ctx, ret, recurseTimes);
    }

    return ret;
  } // Primitive types cannot have properties


  var primitive = formatPrimitive(ctx, value);

  if (primitive) {
    return primitive;
  } // Look up the keys of the object.


  var keys = Object.keys(value);
  var visibleKeys = arrayToHash(keys);

  if (ctx.showHidden) {
    keys = Object.getOwnPropertyNames(value);
  } // IE doesn't make error fields non-enumerable
  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx


  if (isError(value) && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {
    return formatError(value);
  } // Some type of object without properties can be shortcutted.


  if (keys.length === 0) {
    if (isFunction(value)) {
      var name = value.name ? ': ' + value.name : '';
      return ctx.stylize('[Function' + name + ']', 'special');
    }

    if (isRegExp(value)) {
      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');
    }

    if (isDate(value)) {
      return ctx.stylize(Date.prototype.toString.call(value), 'date');
    }

    if (isError(value)) {
      return formatError(value);
    }
  }

  var base = '',
      array = false,
      braces = ['{', '}']; // Make Array say that they are Array

  if (isArray(value)) {
    array = true;
    braces = ['[', ']'];
  } // Make functions say that they are functions


  if (isFunction(value)) {
    var n = value.name ? ': ' + value.name : '';
    base = ' [Function' + n + ']';
  } // Make RegExps say that they are RegExps


  if (isRegExp(value)) {
    base = ' ' + RegExp.prototype.toString.call(value);
  } // Make dates with properties first say the date


  if (isDate(value)) {
    base = ' ' + Date.prototype.toUTCString.call(value);
  } // Make error with message first say the error


  if (isError(value)) {
    base = ' ' + formatError(value);
  }

  if (keys.length === 0 && (!array || value.length == 0)) {
    return braces[0] + base + braces[1];
  }

  if (recurseTimes < 0) {
    if (isRegExp(value)) {
      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');
    } else {
      return ctx.stylize('[Object]', 'special');
    }
  }

  ctx.seen.push(value);
  var output;

  if (array) {
    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);
  } else {
    output = keys.map(function (key) {
      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);
    });
  }

  ctx.seen.pop();
  return reduceToSingleString(output, base, braces);
}

function formatPrimitive(ctx, value) {
  if (bson_browser_esm_isUndefined(value)) return ctx.stylize('undefined', 'undefined');

  if (bson_browser_esm_isString(value)) {
    var simple = '\'' + JSON.stringify(value).replace(/^"|"$/g, '').replace(/'/g, "\\'").replace(/\\"/g, '"') + '\'';
    return ctx.stylize(simple, 'string');
  }

  if (bson_browser_esm_isNumber(value)) return ctx.stylize('' + value, 'number');
  if (bson_browser_esm_isBoolean(value)) return ctx.stylize('' + value, 'boolean'); // For some reason typeof null is "object", so special case here.

  if (bson_browser_esm_isNull(value)) return ctx.stylize('null', 'null');
}

function formatError(value) {
  return '[' + Error.prototype.toString.call(value) + ']';
}

function formatArray(ctx, value, recurseTimes, visibleKeys, keys) {
  var output = [];

  for (var i = 0, l = value.length; i < l; ++i) {
    if (bson_browser_esm_hasOwnProperty(value, String(i))) {
      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys, String(i), true));
    } else {
      output.push('');
    }
  }

  keys.forEach(function (key) {
    if (!key.match(/^\d+$/)) {
      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys, key, true));
    }
  });
  return output;
}

function formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {
  var name, str, desc;
  desc = Object.getOwnPropertyDescriptor(value, key) || {
    value: value[key]
  };

  if (desc.get) {
    if (desc.set) {
      str = ctx.stylize('[Getter/Setter]', 'special');
    } else {
      str = ctx.stylize('[Getter]', 'special');
    }
  } else {
    if (desc.set) {
      str = ctx.stylize('[Setter]', 'special');
    }
  }

  if (!bson_browser_esm_hasOwnProperty(visibleKeys, key)) {
    name = '[' + key + ']';
  }

  if (!str) {
    if (ctx.seen.indexOf(desc.value) < 0) {
      if (bson_browser_esm_isNull(recurseTimes)) {
        str = formatValue(ctx, desc.value, null);
      } else {
        str = formatValue(ctx, desc.value, recurseTimes - 1);
      }

      if (str.indexOf('\n') > -1) {
        if (array) {
          str = str.split('\n').map(function (line) {
            return '  ' + line;
          }).join('\n').substr(2);
        } else {
          str = '\n' + str.split('\n').map(function (line) {
            return '   ' + line;
          }).join('\n');
        }
      }
    } else {
      str = ctx.stylize('[Circular]', 'special');
    }
  }

  if (bson_browser_esm_isUndefined(name)) {
    if (array && key.match(/^\d+$/)) {
      return str;
    }

    name = JSON.stringify('' + key);

    if (name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)) {
      name = name.substr(1, name.length - 2);
      name = ctx.stylize(name, 'name');
    } else {
      name = name.replace(/'/g, "\\'").replace(/\\"/g, '"').replace(/(^"|"$)/g, "'");
      name = ctx.stylize(name, 'string');
    }
  }

  return name + ': ' + str;
}

function reduceToSingleString(output, base, braces) {
  var length = output.reduce(function (prev, cur) {
    if (cur.indexOf('\n') >= 0) ;
    return prev + cur.replace(/\u001b\[\d\d?m/g, '').length + 1;
  }, 0);

  if (length > 60) {
    return braces[0] + (base === '' ? '' : base + '\n ') + ' ' + output.join(',\n  ') + ' ' + braces[1];
  }

  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];
} // NOTE: These type checking functions intentionally don't use `instanceof`
// because it is fragile and can be easily faked with `Object.create()`.


function isArray(ar) {
  return Array.isArray(ar);
}
function bson_browser_esm_isBoolean(arg) {
  return typeof arg === 'boolean';
}
function bson_browser_esm_isNull(arg) {
  return arg === null;
}
function isNullOrUndefined(arg) {
  return arg == null;
}
function bson_browser_esm_isNumber(arg) {
  return typeof arg === 'number';
}
function bson_browser_esm_isString(arg) {
  return typeof arg === 'string';
}
function isSymbol(arg) {
  return babelHelpers["typeof"](arg) === 'symbol';
}
function bson_browser_esm_isUndefined(arg) {
  return arg === void 0;
}
function isRegExp(re) {
  return isObject(re) && objectToString(re) === '[object RegExp]';
}
function isObject(arg) {
  return babelHelpers["typeof"](arg) === 'object' && arg !== null;
}
function isDate(d) {
  return isObject(d) && objectToString(d) === '[object Date]';
}
function isError(e) {
  return isObject(e) && (objectToString(e) === '[object Error]' || e instanceof Error);
}
function isFunction(arg) {
  return typeof arg === 'function';
}
function isPrimitive(arg) {
  return arg === null || typeof arg === 'boolean' || typeof arg === 'number' || typeof arg === 'string' || babelHelpers["typeof"](arg) === 'symbol' || // ES6 symbol
  typeof arg === 'undefined';
}
function isBuffer(maybeBuf) {
  return bson_browser_esm_Buffer.isBuffer(maybeBuf);
}

function objectToString(o) {
  return Object.prototype.toString.call(o);
}

function pad(n) {
  return n < 10 ? '0' + n.toString(10) : n.toString(10);
}

var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']; // 26 Feb 16:19:34

function timestamp$1() {
  var d = new Date();
  var time = [pad(d.getHours()), pad(d.getMinutes()), pad(d.getSeconds())].join(':');
  return [d.getDate(), months[d.getMonth()], time].join(' ');
} // log is just a thin wrapper to console.log that prepends a timestamp


function log() {
  console.log('%s - %s', timestamp$1(), format.apply(null, arguments));
}
function _extend(origin, add) {
  // Don't do anything if add isn't an object
  if (!add || !isObject(add)) return origin;
  var keys = Object.keys(add);
  var i = keys.length;

  while (i--) {
    origin[keys[i]] = add[keys[i]];
  }

  return origin;
}

function bson_browser_esm_hasOwnProperty(obj, prop) {
  return Object.prototype.hasOwnProperty.call(obj, prop);
}

var require$$1 = {
  inherits: inherits$1,
  _extend: _extend,
  log: log,
  isBuffer: isBuffer,
  isPrimitive: isPrimitive,
  isFunction: isFunction,
  isError: isError,
  isDate: isDate,
  isObject: isObject,
  isRegExp: isRegExp,
  isUndefined: bson_browser_esm_isUndefined,
  isSymbol: isSymbol,
  isString: bson_browser_esm_isString,
  isNumber: bson_browser_esm_isNumber,
  isNullOrUndefined: isNullOrUndefined,
  isNull: bson_browser_esm_isNull,
  isBoolean: bson_browser_esm_isBoolean,
  isArray: isArray,
  inspect: inspect,
  deprecate: deprecate,
  format: format,
  debuglog: debuglog
};

var utils = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.deprecate = exports.isObjectLike = exports.isDate = exports.isBuffer = exports.haveBuffer = exports.isBigUInt64Array = exports.isBigInt64Array = exports.isUint8Array = exports.randomBytes = exports.normalizedFunctionString = void 0;

/**
 * Normalizes our expected stringified form of a function across versions of node
 * @param fn - The function to stringify
 */
function normalizedFunctionString(fn) {
    return fn.toString().replace('function(', 'function (');
}
exports.normalizedFunctionString = normalizedFunctionString;
var isReactNative = typeof commonjsGlobal.navigator === 'object' && commonjsGlobal.navigator.product === 'ReactNative';
var insecureWarning = isReactNative
    ? 'BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.'
    : 'BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.';
var insecureRandomBytes = function insecureRandomBytes(size) {
    console.warn(insecureWarning);
    var result = buffer.Buffer.alloc(size);
    for (var i = 0; i < size; ++i)
        result[i] = Math.floor(Math.random() * 256);
    return result;
};
var detectRandomBytes = function () {
    if (typeof window !== 'undefined') {
        // browser crypto implementation(s)
        var target_1 = window.crypto || window.msCrypto; // allow for IE11
        if (target_1 && target_1.getRandomValues) {
            return function (size) { return target_1.getRandomValues(buffer.Buffer.alloc(size)); };
        }
    }
    if (typeof commonjsGlobal !== 'undefined' && commonjsGlobal.crypto && commonjsGlobal.crypto.getRandomValues) {
        // allow for RN packages such as https://www.npmjs.com/package/react-native-get-random-values to populate global
        return function (size) { return commonjsGlobal.crypto.getRandomValues(buffer.Buffer.alloc(size)); };
    }
    var requiredRandomBytes;
    try {
        // eslint-disable-next-line @typescript-eslint/no-var-requires
        requiredRandomBytes = require$$0.randomBytes;
    }
    catch (e) {
        // keep the fallback
    }
    // NOTE: in transpiled cases the above require might return null/undefined
    return requiredRandomBytes || insecureRandomBytes;
};
exports.randomBytes = detectRandomBytes();
function isUint8Array(value) {
    return Object.prototype.toString.call(value) === '[object Uint8Array]';
}
exports.isUint8Array = isUint8Array;
function isBigInt64Array(value) {
    return Object.prototype.toString.call(value) === '[object BigInt64Array]';
}
exports.isBigInt64Array = isBigInt64Array;
function isBigUInt64Array(value) {
    return Object.prototype.toString.call(value) === '[object BigUint64Array]';
}
exports.isBigUInt64Array = isBigUInt64Array;
/** Call to check if your environment has `Buffer` */
function haveBuffer() {
    return typeof commonjsGlobal !== 'undefined' && typeof commonjsGlobal.Buffer !== 'undefined';
}
exports.haveBuffer = haveBuffer;
/** Callable in any environment to check if value is a Buffer */
function isBuffer(value) {
    var _a;
    return typeof value === 'object' && ((_a = value === null || value === void 0 ? void 0 : value.constructor) === null || _a === void 0 ? void 0 : _a.name) === 'Buffer';
}
exports.isBuffer = isBuffer;
// To ensure that 0.4 of node works correctly
function isDate(d) {
    return isObjectLike(d) && Object.prototype.toString.call(d) === '[object Date]';
}
exports.isDate = isDate;
/**
 * @internal
 * this is to solve the `'someKey' in x` problem where x is unknown.
 * https://github.com/typescript-eslint/typescript-eslint/issues/1071#issuecomment-541955753
 */
function isObjectLike(candidate) {
    return typeof candidate === 'object' && candidate !== null;
}
exports.isObjectLike = isObjectLike;
function deprecate(fn, message) {
    if (typeof window === 'undefined' && typeof self === 'undefined') {
        // eslint-disable-next-line @typescript-eslint/no-var-requires
        return require$$1.deprecate(fn, message);
    }
    var warned = false;
    function deprecated() {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (!warned) {
            console.warn(message);
            warned = true;
        }
        return fn.apply(this, args);
    }
    return deprecated;
}
exports.deprecate = deprecate;
//# sourceMappingURL=utils.js.map
});

unwrapExports(utils);
utils.deprecate;
utils.isObjectLike;
utils.isDate;
utils.isBuffer;
utils.haveBuffer;
utils.isBigUInt64Array;
utils.isBigInt64Array;
utils.isUint8Array;
utils.randomBytes;
utils.normalizedFunctionString;

var ensure_buffer = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.ensureBuffer = void 0;


/**
 * Makes sure that, if a Uint8Array is passed in, it is wrapped in a Buffer.
 *
 * @param potentialBuffer - The potential buffer
 * @returns Buffer the input if potentialBuffer is a buffer, or a buffer that
 * wraps a passed in Uint8Array
 * @throws TypeError If anything other than a Buffer or Uint8Array is passed in
 */
function ensureBuffer(potentialBuffer) {
    if (utils.isBuffer(potentialBuffer)) {
        return potentialBuffer;
    }
    if (ArrayBuffer.isView(potentialBuffer)) {
        return buffer.Buffer.from(potentialBuffer.buffer);
    }
    if (potentialBuffer instanceof ArrayBuffer) {
        return buffer.Buffer.from(potentialBuffer);
    }
    throw new TypeError('Must use either Buffer or TypedArray');
}
exports.ensureBuffer = ensureBuffer;
//# sourceMappingURL=ensure_buffer.js.map
});

unwrapExports(ensure_buffer);
ensure_buffer.ensureBuffer;

var uuid_utils = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.bufferToUuidHexString = exports.uuidHexStringToBuffer = exports.uuidValidateString = void 0;

// Validation regex for v4 uuid (validates with or without dashes)
var VALIDATION_REGEX = /^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i;
var uuidValidateString = function (str) {
    return typeof str === 'string' && VALIDATION_REGEX.test(str);
};
exports.uuidValidateString = uuidValidateString;
var uuidHexStringToBuffer = function (hexString) {
    if (!exports.uuidValidateString(hexString)) {
        throw new TypeError('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');
    }
    var sanitizedHexString = hexString.replace(/-/g, '');
    return buffer.Buffer.from(sanitizedHexString, 'hex');
};
exports.uuidHexStringToBuffer = uuidHexStringToBuffer;
var bufferToUuidHexString = function (buffer, includeDashes) {
    if (includeDashes === void 0) { includeDashes = true; }
    return includeDashes
        ? buffer.toString('hex', 0, 4) +
            '-' +
            buffer.toString('hex', 4, 6) +
            '-' +
            buffer.toString('hex', 6, 8) +
            '-' +
            buffer.toString('hex', 8, 10) +
            '-' +
            buffer.toString('hex', 10, 16)
        : buffer.toString('hex');
};
exports.bufferToUuidHexString = bufferToUuidHexString;
//# sourceMappingURL=uuid_utils.js.map
});

unwrapExports(uuid_utils);
uuid_utils.bufferToUuidHexString;
uuid_utils.uuidHexStringToBuffer;
uuid_utils.uuidValidateString;

var uuid = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.UUID = void 0;





var BYTE_LENGTH = 16;
var kId = Symbol('id');
/**
 * A class representation of the BSON UUID type.
 * @public
 */
var UUID = /** @class */ (function () {
    /**
     * Create an UUID type
     *
     * @param input - Can be a 32 or 36 character hex string (dashes excluded/included) or a 16 byte binary Buffer.
     */
    function UUID(input) {
        if (typeof input === 'undefined') {
            // The most common use case (blank id, new UUID() instance)
            this.id = UUID.generate();
        }
        else if (input instanceof UUID) {
            this[kId] = buffer.Buffer.from(input.id);
            this.__id = input.__id;
        }
        else if ((buffer.Buffer.isBuffer(input) || ArrayBuffer.isView(input)) &&
            input.byteLength === BYTE_LENGTH) {
            this.id = ensure_buffer.ensureBuffer(input);
        }
        else if (typeof input === 'string') {
            this.id = uuid_utils.uuidHexStringToBuffer(input);
        }
        else {
            throw new TypeError('Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).');
        }
    }
    Object.defineProperty(UUID.prototype, "id", {
        /**
         * The UUID bytes
         * @readonly
         */
        get: function () {
            return this[kId];
        },
        set: function (value) {
            this[kId] = value;
            if (UUID.cacheHexString) {
                this.__id = uuid_utils.bufferToUuidHexString(value);
            }
        },
        enumerable: false,
        configurable: true
    });
    /**
     * Generate a 16 byte uuid v4 buffer used in UUIDs
     */
    /**
     * Returns the UUID id as a 32 or 36 character hex string representation, excluding/including dashes (defaults to 36 character dash separated)
     * @param includeDashes - should the string exclude dash-separators.
     * */
    UUID.prototype.toHexString = function (includeDashes) {
        if (includeDashes === void 0) { includeDashes = true; }
        if (UUID.cacheHexString && this.__id) {
            return this.__id;
        }
        var uuidHexString = uuid_utils.bufferToUuidHexString(this.id, includeDashes);
        if (UUID.cacheHexString) {
            this.__id = uuidHexString;
        }
        return uuidHexString;
    };
    /**
     * Converts the id into a 36 character (dashes included) hex string, unless a encoding is specified.
     * @internal
     */
    UUID.prototype.toString = function (encoding) {
        return encoding ? this.id.toString(encoding) : this.toHexString();
    };
    /**
     * Converts the id into its JSON string representation. A 36 character (dashes included) hex string in the format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
     * @internal
     */
    UUID.prototype.toJSON = function () {
        return this.toHexString();
    };
    /**
     * Compares the equality of this UUID with `otherID`.
     *
     * @param otherId - UUID instance to compare against.
     */
    UUID.prototype.equals = function (otherId) {
        if (!otherId) {
            return false;
        }
        if (otherId instanceof UUID) {
            return otherId.id.equals(this.id);
        }
        try {
            return new UUID(otherId).id.equals(this.id);
        }
        catch (_a) {
            return false;
        }
    };
    /**
     * Creates a Binary instance from the current UUID.
     */
    UUID.prototype.toBinary = function () {
        return new binary.Binary(this.id, binary.Binary.SUBTYPE_UUID);
    };
    /**
     * Generates a populated buffer containing a v4 uuid
     */
    UUID.generate = function () {
        var bytes = utils.randomBytes(BYTE_LENGTH);
        // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`
        // Kindly borrowed from https://github.com/uuidjs/uuid/blob/master/src/v4.js
        bytes[6] = (bytes[6] & 0x0f) | 0x40;
        bytes[8] = (bytes[8] & 0x3f) | 0x80;
        return buffer.Buffer.from(bytes);
    };
    /**
     * Checks if a value is a valid bson UUID
     * @param input - UUID, string or Buffer to validate.
     */
    UUID.isValid = function (input) {
        if (!input) {
            return false;
        }
        if (input instanceof UUID) {
            return true;
        }
        if (typeof input === 'string') {
            return uuid_utils.uuidValidateString(input);
        }
        if (buffer.Buffer.isBuffer(input)) {
            // check for length & uuid version (https://tools.ietf.org/html/rfc4122#section-4.1.3)
            if (input.length !== BYTE_LENGTH) {
                return false;
            }
            try {
                // get this byte as hex:             xxxxxxxx-xxxx-XXxx-xxxx-xxxxxxxxxxxx
                // check first part as uuid version: xxxxxxxx-xxxx-Xxxx-xxxx-xxxxxxxxxxxx
                return parseInt(input[6].toString(16)[0], 10) === binary.Binary.SUBTYPE_UUID;
            }
            catch (_a) {
                return false;
            }
        }
        return false;
    };
    /**
     * Creates an UUID from a hex string representation of an UUID.
     * @param hexString - 32 or 36 character hex string (dashes excluded/included).
     */
    UUID.createFromHexString = function (hexString) {
        var buffer = uuid_utils.uuidHexStringToBuffer(hexString);
        return new UUID(buffer);
    };
    /**
     * Converts to a string representation of this Id.
     *
     * @returns return the 36 character hex string representation.
     * @internal
     */
    UUID.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    UUID.prototype.inspect = function () {
        return "new UUID(\"" + this.toHexString() + "\")";
    };
    return UUID;
}());
exports.UUID = UUID;
Object.defineProperty(UUID.prototype, '_bsontype', { value: 'UUID' });
//# sourceMappingURL=uuid.js.map
});

unwrapExports(uuid);
uuid.UUID;

var binary = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.Binary = void 0;




/**
 * A class representation of the BSON Binary type.
 * @public
 */
var Binary = /** @class */ (function () {
    /**
     * @param buffer - a buffer object containing the binary data.
     * @param subType - the option binary type.
     */
    function Binary(buffer$1, subType) {
        if (!(this instanceof Binary))
            return new Binary(buffer$1, subType);
        if (!(buffer$1 == null) &&
            !(typeof buffer$1 === 'string') &&
            !ArrayBuffer.isView(buffer$1) &&
            !(buffer$1 instanceof ArrayBuffer) &&
            !Array.isArray(buffer$1)) {
            throw new TypeError('Binary can only be constructed from string, Buffer, TypedArray, or Array<number>');
        }
        this.sub_type = subType !== null && subType !== void 0 ? subType : Binary.BSON_BINARY_SUBTYPE_DEFAULT;
        if (buffer$1 == null) {
            // create an empty binary buffer
            this.buffer = buffer.Buffer.alloc(Binary.BUFFER_SIZE);
            this.position = 0;
        }
        else {
            if (typeof buffer$1 === 'string') {
                // string
                this.buffer = buffer.Buffer.from(buffer$1, 'binary');
            }
            else if (Array.isArray(buffer$1)) {
                // number[]
                this.buffer = buffer.Buffer.from(buffer$1);
            }
            else {
                // Buffer | TypedArray | ArrayBuffer
                this.buffer = ensure_buffer.ensureBuffer(buffer$1);
            }
            this.position = this.buffer.byteLength;
        }
    }
    /**
     * Updates this binary with byte_value.
     *
     * @param byteValue - a single byte we wish to write.
     */
    Binary.prototype.put = function (byteValue) {
        // If it's a string and a has more than one character throw an error
        if (typeof byteValue === 'string' && byteValue.length !== 1) {
            throw new TypeError('only accepts single character String');
        }
        else if (typeof byteValue !== 'number' && byteValue.length !== 1)
            throw new TypeError('only accepts single character Uint8Array or Array');
        // Decode the byte value once
        var decodedByte;
        if (typeof byteValue === 'string') {
            decodedByte = byteValue.charCodeAt(0);
        }
        else if (typeof byteValue === 'number') {
            decodedByte = byteValue;
        }
        else {
            decodedByte = byteValue[0];
        }
        if (decodedByte < 0 || decodedByte > 255) {
            throw new TypeError('only accepts number in a valid unsigned byte range 0-255');
        }
        if (this.buffer.length > this.position) {
            this.buffer[this.position++] = decodedByte;
        }
        else {
            var buffer$1 = buffer.Buffer.alloc(Binary.BUFFER_SIZE + this.buffer.length);
            // Combine the two buffers together
            this.buffer.copy(buffer$1, 0, 0, this.buffer.length);
            this.buffer = buffer$1;
            this.buffer[this.position++] = decodedByte;
        }
    };
    /**
     * Writes a buffer or string to the binary.
     *
     * @param sequence - a string or buffer to be written to the Binary BSON object.
     * @param offset - specify the binary of where to write the content.
     */
    Binary.prototype.write = function (sequence, offset) {
        offset = typeof offset === 'number' ? offset : this.position;
        // If the buffer is to small let's extend the buffer
        if (this.buffer.length < offset + sequence.length) {
            var buffer$1 = buffer.Buffer.alloc(this.buffer.length + sequence.length);
            this.buffer.copy(buffer$1, 0, 0, this.buffer.length);
            // Assign the new buffer
            this.buffer = buffer$1;
        }
        if (ArrayBuffer.isView(sequence)) {
            this.buffer.set(ensure_buffer.ensureBuffer(sequence), offset);
            this.position =
                offset + sequence.byteLength > this.position ? offset + sequence.length : this.position;
        }
        else if (typeof sequence === 'string') {
            this.buffer.write(sequence, offset, sequence.length, 'binary');
            this.position =
                offset + sequence.length > this.position ? offset + sequence.length : this.position;
        }
    };
    /**
     * Reads **length** bytes starting at **position**.
     *
     * @param position - read from the given position in the Binary.
     * @param length - the number of bytes to read.
     */
    Binary.prototype.read = function (position, length) {
        length = length && length > 0 ? length : this.position;
        // Let's return the data based on the type we have
        return this.buffer.slice(position, position + length);
    };
    /**
     * Returns the value of this binary as a string.
     * @param asRaw - Will skip converting to a string
     * @remarks
     * This is handy when calling this function conditionally for some key value pairs and not others
     */
    Binary.prototype.value = function (asRaw) {
        asRaw = !!asRaw;
        // Optimize to serialize for the situation where the data == size of buffer
        if (asRaw && this.buffer.length === this.position) {
            return this.buffer;
        }
        // If it's a node.js buffer object
        if (asRaw) {
            return this.buffer.slice(0, this.position);
        }
        return this.buffer.toString('binary', 0, this.position);
    };
    /** the length of the binary sequence */
    Binary.prototype.length = function () {
        return this.position;
    };
    /** @internal */
    Binary.prototype.toJSON = function () {
        return this.buffer.toString('base64');
    };
    /** @internal */
    Binary.prototype.toString = function (format) {
        return this.buffer.toString(format);
    };
    /** @internal */
    Binary.prototype.toExtendedJSON = function (options) {
        options = options || {};
        var base64String = this.buffer.toString('base64');
        var subType = Number(this.sub_type).toString(16);
        if (options.legacy) {
            return {
                $binary: base64String,
                $type: subType.length === 1 ? '0' + subType : subType
            };
        }
        return {
            $binary: {
                base64: base64String,
                subType: subType.length === 1 ? '0' + subType : subType
            }
        };
    };
    /** @internal */
    Binary.prototype.toUUID = function () {
        if (this.sub_type === Binary.SUBTYPE_UUID) {
            return new uuid.UUID(this.buffer.slice(0, this.position));
        }
        throw new Error("Binary sub_type \"" + this.sub_type + "\" is not supported for converting to UUID. Only \"" + Binary.SUBTYPE_UUID + "\" is currently supported.");
    };
    /** @internal */
    Binary.fromExtendedJSON = function (doc, options) {
        options = options || {};
        var data;
        var type;
        if ('$binary' in doc) {
            if (options.legacy && typeof doc.$binary === 'string' && '$type' in doc) {
                type = doc.$type ? parseInt(doc.$type, 16) : 0;
                data = buffer.Buffer.from(doc.$binary, 'base64');
            }
            else {
                if (typeof doc.$binary !== 'string') {
                    type = doc.$binary.subType ? parseInt(doc.$binary.subType, 16) : 0;
                    data = buffer.Buffer.from(doc.$binary.base64, 'base64');
                }
            }
        }
        else if ('$uuid' in doc) {
            type = 4;
            data = uuid_utils.uuidHexStringToBuffer(doc.$uuid);
        }
        if (!data) {
            throw new TypeError("Unexpected Binary Extended JSON format " + JSON.stringify(doc));
        }
        return new Binary(data, type);
    };
    /** @internal */
    Binary.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    Binary.prototype.inspect = function () {
        var asBuffer = this.value(true);
        return "new Binary(Buffer.from(\"" + asBuffer.toString('hex') + "\", \"hex\"), " + this.sub_type + ")";
    };
    /**
     * Binary default subtype
     * @internal
     */
    Binary.BSON_BINARY_SUBTYPE_DEFAULT = 0;
    /** Initial buffer default size */
    Binary.BUFFER_SIZE = 256;
    /** Default BSON type */
    Binary.SUBTYPE_DEFAULT = 0;
    /** Function BSON type */
    Binary.SUBTYPE_FUNCTION = 1;
    /** Byte Array BSON type */
    Binary.SUBTYPE_BYTE_ARRAY = 2;
    /** Deprecated UUID BSON type @deprecated Please use SUBTYPE_UUID */
    Binary.SUBTYPE_UUID_OLD = 3;
    /** UUID BSON type */
    Binary.SUBTYPE_UUID = 4;
    /** MD5 BSON type */
    Binary.SUBTYPE_MD5 = 5;
    /** User BSON type */
    Binary.SUBTYPE_USER_DEFINED = 128;
    return Binary;
}());
exports.Binary = Binary;
Object.defineProperty(Binary.prototype, '_bsontype', { value: 'Binary' });
//# sourceMappingURL=binary.js.map
});

unwrapExports(binary);
binary.Binary;

var code = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.Code = void 0;
/**
 * A class representation of the BSON Code type.
 * @public
 */
var Code = /** @class */ (function () {
    /**
     * @param code - a string or function.
     * @param scope - an optional scope for the function.
     */
    function Code(code, scope) {
        if (!(this instanceof Code))
            return new Code(code, scope);
        this.code = code;
        this.scope = scope;
    }
    /** @internal */
    Code.prototype.toJSON = function () {
        return { code: this.code, scope: this.scope };
    };
    /** @internal */
    Code.prototype.toExtendedJSON = function () {
        if (this.scope) {
            return { $code: this.code, $scope: this.scope };
        }
        return { $code: this.code };
    };
    /** @internal */
    Code.fromExtendedJSON = function (doc) {
        return new Code(doc.$code, doc.$scope);
    };
    /** @internal */
    Code.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    Code.prototype.inspect = function () {
        var codeJson = this.toJSON();
        return "new Code(\"" + codeJson.code + "\"" + (codeJson.scope ? ", " + JSON.stringify(codeJson.scope) : '') + ")";
    };
    return Code;
}());
exports.Code = Code;
Object.defineProperty(Code.prototype, '_bsontype', { value: 'Code' });
//# sourceMappingURL=code.js.map
});

unwrapExports(code);
code.Code;

var db_ref = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.DBRef = exports.isDBRefLike = void 0;

/** @internal */
function isDBRefLike(value) {
    return utils.isObjectLike(value) && value['$id'] != null && value['$ref'] != null;
}
exports.isDBRefLike = isDBRefLike;
/**
 * A class representation of the BSON DBRef type.
 * @public
 */
var DBRef = /** @class */ (function () {
    /**
     * @param collection - the collection name.
     * @param oid - the reference ObjectId.
     * @param db - optional db name, if omitted the reference is local to the current db.
     */
    function DBRef(collection, oid, db, fields) {
        if (!(this instanceof DBRef))
            return new DBRef(collection, oid, db, fields);
        // check if namespace has been provided
        var parts = collection.split('.');
        if (parts.length === 2) {
            db = parts.shift();
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            collection = parts.shift();
        }
        this.collection = collection;
        this.oid = oid;
        this.db = db;
        this.fields = fields || {};
    }
    Object.defineProperty(DBRef.prototype, "namespace", {
        // Property provided for compatibility with the 1.x parser
        // the 1.x parser used a "namespace" property, while 4.x uses "collection"
        /** @internal */
        get: function () {
            return this.collection;
        },
        set: function (value) {
            this.collection = value;
        },
        enumerable: false,
        configurable: true
    });
    /** @internal */
    DBRef.prototype.toJSON = function () {
        var o = Object.assign({
            $ref: this.collection,
            $id: this.oid
        }, this.fields);
        if (this.db != null)
            o.$db = this.db;
        return o;
    };
    /** @internal */
    DBRef.prototype.toExtendedJSON = function (options) {
        options = options || {};
        var o = {
            $ref: this.collection,
            $id: this.oid
        };
        if (options.legacy) {
            return o;
        }
        if (this.db)
            o.$db = this.db;
        o = Object.assign(o, this.fields);
        return o;
    };
    /** @internal */
    DBRef.fromExtendedJSON = function (doc) {
        var copy = Object.assign({}, doc);
        delete copy.$ref;
        delete copy.$id;
        delete copy.$db;
        return new DBRef(doc.$ref, doc.$id, doc.$db, copy);
    };
    /** @internal */
    DBRef.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    DBRef.prototype.inspect = function () {
        // NOTE: if OID is an ObjectId class it will just print the oid string.
        var oid = this.oid === undefined || this.oid.toString === undefined ? this.oid : this.oid.toString();
        return "new DBRef(\"" + this.namespace + "\", new ObjectId(\"" + oid + "\")" + (this.db ? ", \"" + this.db + "\"" : '') + ")";
    };
    return DBRef;
}());
exports.DBRef = DBRef;
Object.defineProperty(DBRef.prototype, '_bsontype', { value: 'DBRef' });
//# sourceMappingURL=db_ref.js.map
});

unwrapExports(db_ref);
db_ref.DBRef;
db_ref.isDBRefLike;

var long_1 = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.Long = void 0;

/**
 * wasm optimizations, to do native i64 multiplication and divide
 */
var wasm = undefined;
try {
    wasm = new WebAssembly.Instance(new WebAssembly.Module(
    // prettier-ignore
    new Uint8Array([0, 97, 115, 109, 1, 0, 0, 0, 1, 13, 2, 96, 0, 1, 127, 96, 4, 127, 127, 127, 127, 1, 127, 3, 7, 6, 0, 1, 1, 1, 1, 1, 6, 6, 1, 127, 1, 65, 0, 11, 7, 50, 6, 3, 109, 117, 108, 0, 1, 5, 100, 105, 118, 95, 115, 0, 2, 5, 100, 105, 118, 95, 117, 0, 3, 5, 114, 101, 109, 95, 115, 0, 4, 5, 114, 101, 109, 95, 117, 0, 5, 8, 103, 101, 116, 95, 104, 105, 103, 104, 0, 0, 10, 191, 1, 6, 4, 0, 35, 0, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 126, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 127, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 128, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 129, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 130, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11])), {}).exports;
}
catch (_a) {
    // no wasm support
}
var TWO_PWR_16_DBL = 1 << 16;
var TWO_PWR_24_DBL = 1 << 24;
var TWO_PWR_32_DBL = TWO_PWR_16_DBL * TWO_PWR_16_DBL;
var TWO_PWR_64_DBL = TWO_PWR_32_DBL * TWO_PWR_32_DBL;
var TWO_PWR_63_DBL = TWO_PWR_64_DBL / 2;
/** A cache of the Long representations of small integer values. */
var INT_CACHE = {};
/** A cache of the Long representations of small unsigned integer values. */
var UINT_CACHE = {};
/**
 * A class representing a 64-bit integer
 * @public
 * @remarks
 * The internal representation of a long is the two given signed, 32-bit values.
 * We use 32-bit pieces because these are the size of integers on which
 * Javascript performs bit-operations.  For operations like addition and
 * multiplication, we split each number into 16 bit pieces, which can easily be
 * multiplied within Javascript's floating-point representation without overflow
 * or change in sign.
 * In the algorithms below, we frequently reduce the negative case to the
 * positive case by negating the input(s) and then post-processing the result.
 * Note that we must ALWAYS check specially whether those values are MIN_VALUE
 * (-2^63) because -MIN_VALUE == MIN_VALUE (since 2^63 cannot be represented as
 * a positive number, it overflows back into a negative).  Not handling this
 * case would often result in infinite recursion.
 * Common constant values ZERO, ONE, NEG_ONE, etc. are found as static properties on this class.
 */
var Long = /** @class */ (function () {
    /**
     * Constructs a 64 bit two's-complement integer, given its low and high 32 bit values as *signed* integers.
     *  See the from* functions below for more convenient ways of constructing Longs.
     * @param low - The low (signed) 32 bits of the long
     * @param high - The high (signed) 32 bits of the long
     * @param unsigned - Whether unsigned or not, defaults to signed
     */
    function Long(low, high, unsigned) {
        if (low === void 0) { low = 0; }
        if (high === void 0) { high = 0; }
        if (!(this instanceof Long))
            return new Long(low, high, unsigned);
        this.low = low | 0;
        this.high = high | 0;
        this.unsigned = !!unsigned;
        Object.defineProperty(this, '__isLong__', {
            value: true,
            configurable: false,
            writable: false,
            enumerable: false
        });
    }
    /**
     * Returns a Long representing the 64 bit integer that comes by concatenating the given low and high bits.
     * Each is assumed to use 32 bits.
     * @param lowBits - The low 32 bits
     * @param highBits - The high 32 bits
     * @param unsigned - Whether unsigned or not, defaults to signed
     * @returns The corresponding Long value
     */
    Long.fromBits = function (lowBits, highBits, unsigned) {
        return new Long(lowBits, highBits, unsigned);
    };
    /**
     * Returns a Long representing the given 32 bit integer value.
     * @param value - The 32 bit integer in question
     * @param unsigned - Whether unsigned or not, defaults to signed
     * @returns The corresponding Long value
     */
    Long.fromInt = function (value, unsigned) {
        var obj, cachedObj, cache;
        if (unsigned) {
            value >>>= 0;
            if ((cache = 0 <= value && value < 256)) {
                cachedObj = UINT_CACHE[value];
                if (cachedObj)
                    return cachedObj;
            }
            obj = Long.fromBits(value, (value | 0) < 0 ? -1 : 0, true);
            if (cache)
                UINT_CACHE[value] = obj;
            return obj;
        }
        else {
            value |= 0;
            if ((cache = -128 <= value && value < 128)) {
                cachedObj = INT_CACHE[value];
                if (cachedObj)
                    return cachedObj;
            }
            obj = Long.fromBits(value, value < 0 ? -1 : 0, false);
            if (cache)
                INT_CACHE[value] = obj;
            return obj;
        }
    };
    /**
     * Returns a Long representing the given value, provided that it is a finite number. Otherwise, zero is returned.
     * @param value - The number in question
     * @param unsigned - Whether unsigned or not, defaults to signed
     * @returns The corresponding Long value
     */
    Long.fromNumber = function (value, unsigned) {
        if (isNaN(value))
            return unsigned ? Long.UZERO : Long.ZERO;
        if (unsigned) {
            if (value < 0)
                return Long.UZERO;
            if (value >= TWO_PWR_64_DBL)
                return Long.MAX_UNSIGNED_VALUE;
        }
        else {
            if (value <= -TWO_PWR_63_DBL)
                return Long.MIN_VALUE;
            if (value + 1 >= TWO_PWR_63_DBL)
                return Long.MAX_VALUE;
        }
        if (value < 0)
            return Long.fromNumber(-value, unsigned).neg();
        return Long.fromBits(value % TWO_PWR_32_DBL | 0, (value / TWO_PWR_32_DBL) | 0, unsigned);
    };
    /**
     * Returns a Long representing the given value, provided that it is a finite number. Otherwise, zero is returned.
     * @param value - The number in question
     * @param unsigned - Whether unsigned or not, defaults to signed
     * @returns The corresponding Long value
     */
    Long.fromBigInt = function (value, unsigned) {
        return Long.fromString(value.toString(), unsigned);
    };
    /**
     * Returns a Long representation of the given string, written using the specified radix.
     * @param str - The textual representation of the Long
     * @param unsigned - Whether unsigned or not, defaults to signed
     * @param radix - The radix in which the text is written (2-36), defaults to 10
     * @returns The corresponding Long value
     */
    Long.fromString = function (str, unsigned, radix) {
        if (str.length === 0)
            throw Error('empty string');
        if (str === 'NaN' || str === 'Infinity' || str === '+Infinity' || str === '-Infinity')
            return Long.ZERO;
        if (typeof unsigned === 'number') {
            // For goog.math.long compatibility
            (radix = unsigned), (unsigned = false);
        }
        else {
            unsigned = !!unsigned;
        }
        radix = radix || 10;
        if (radix < 2 || 36 < radix)
            throw RangeError('radix');
        var p;
        if ((p = str.indexOf('-')) > 0)
            throw Error('interior hyphen');
        else if (p === 0) {
            return Long.fromString(str.substring(1), unsigned, radix).neg();
        }
        // Do several (8) digits each time through the loop, so as to
        // minimize the calls to the very expensive emulated div.
        var radixToPower = Long.fromNumber(Math.pow(radix, 8));
        var result = Long.ZERO;
        for (var i = 0; i < str.length; i += 8) {
            var size = Math.min(8, str.length - i), value = parseInt(str.substring(i, i + size), radix);
            if (size < 8) {
                var power = Long.fromNumber(Math.pow(radix, size));
                result = result.mul(power).add(Long.fromNumber(value));
            }
            else {
                result = result.mul(radixToPower);
                result = result.add(Long.fromNumber(value));
            }
        }
        result.unsigned = unsigned;
        return result;
    };
    /**
     * Creates a Long from its byte representation.
     * @param bytes - Byte representation
     * @param unsigned - Whether unsigned or not, defaults to signed
     * @param le - Whether little or big endian, defaults to big endian
     * @returns The corresponding Long value
     */
    Long.fromBytes = function (bytes, unsigned, le) {
        return le ? Long.fromBytesLE(bytes, unsigned) : Long.fromBytesBE(bytes, unsigned);
    };
    /**
     * Creates a Long from its little endian byte representation.
     * @param bytes - Little endian byte representation
     * @param unsigned - Whether unsigned or not, defaults to signed
     * @returns The corresponding Long value
     */
    Long.fromBytesLE = function (bytes, unsigned) {
        return new Long(bytes[0] | (bytes[1] << 8) | (bytes[2] << 16) | (bytes[3] << 24), bytes[4] | (bytes[5] << 8) | (bytes[6] << 16) | (bytes[7] << 24), unsigned);
    };
    /**
     * Creates a Long from its big endian byte representation.
     * @param bytes - Big endian byte representation
     * @param unsigned - Whether unsigned or not, defaults to signed
     * @returns The corresponding Long value
     */
    Long.fromBytesBE = function (bytes, unsigned) {
        return new Long((bytes[4] << 24) | (bytes[5] << 16) | (bytes[6] << 8) | bytes[7], (bytes[0] << 24) | (bytes[1] << 16) | (bytes[2] << 8) | bytes[3], unsigned);
    };
    /**
     * Tests if the specified object is a Long.
     */
    // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types
    Long.isLong = function (value) {
        return utils.isObjectLike(value) && value['__isLong__'] === true;
    };
    /**
     * Converts the specified value to a Long.
     * @param unsigned - Whether unsigned or not, defaults to signed
     */
    Long.fromValue = function (val, unsigned) {
        if (typeof val === 'number')
            return Long.fromNumber(val, unsigned);
        if (typeof val === 'string')
            return Long.fromString(val, unsigned);
        // Throws for non-objects, converts non-instanceof Long:
        return Long.fromBits(val.low, val.high, typeof unsigned === 'boolean' ? unsigned : val.unsigned);
    };
    /** Returns the sum of this and the specified Long. */
    Long.prototype.add = function (addend) {
        if (!Long.isLong(addend))
            addend = Long.fromValue(addend);
        // Divide each number into 4 chunks of 16 bits, and then sum the chunks.
        var a48 = this.high >>> 16;
        var a32 = this.high & 0xffff;
        var a16 = this.low >>> 16;
        var a00 = this.low & 0xffff;
        var b48 = addend.high >>> 16;
        var b32 = addend.high & 0xffff;
        var b16 = addend.low >>> 16;
        var b00 = addend.low & 0xffff;
        var c48 = 0, c32 = 0, c16 = 0, c00 = 0;
        c00 += a00 + b00;
        c16 += c00 >>> 16;
        c00 &= 0xffff;
        c16 += a16 + b16;
        c32 += c16 >>> 16;
        c16 &= 0xffff;
        c32 += a32 + b32;
        c48 += c32 >>> 16;
        c32 &= 0xffff;
        c48 += a48 + b48;
        c48 &= 0xffff;
        return Long.fromBits((c16 << 16) | c00, (c48 << 16) | c32, this.unsigned);
    };
    /**
     * Returns the sum of this and the specified Long.
     * @returns Sum
     */
    Long.prototype.and = function (other) {
        if (!Long.isLong(other))
            other = Long.fromValue(other);
        return Long.fromBits(this.low & other.low, this.high & other.high, this.unsigned);
    };
    /**
     * Compares this Long's value with the specified's.
     * @returns 0 if they are the same, 1 if the this is greater and -1 if the given one is greater
     */
    Long.prototype.compare = function (other) {
        if (!Long.isLong(other))
            other = Long.fromValue(other);
        if (this.eq(other))
            return 0;
        var thisNeg = this.isNegative(), otherNeg = other.isNegative();
        if (thisNeg && !otherNeg)
            return -1;
        if (!thisNeg && otherNeg)
            return 1;
        // At this point the sign bits are the same
        if (!this.unsigned)
            return this.sub(other).isNegative() ? -1 : 1;
        // Both are positive if at least one is unsigned
        return other.high >>> 0 > this.high >>> 0 ||
            (other.high === this.high && other.low >>> 0 > this.low >>> 0)
            ? -1
            : 1;
    };
    /** This is an alias of {@link Long.compare} */
    Long.prototype.comp = function (other) {
        return this.compare(other);
    };
    /**
     * Returns this Long divided by the specified. The result is signed if this Long is signed or unsigned if this Long is unsigned.
     * @returns Quotient
     */
    Long.prototype.divide = function (divisor) {
        if (!Long.isLong(divisor))
            divisor = Long.fromValue(divisor);
        if (divisor.isZero())
            throw Error('division by zero');
        // use wasm support if present
        if (wasm) {
            // guard against signed division overflow: the largest
            // negative number / -1 would be 1 larger than the largest
            // positive number, due to two's complement.
            if (!this.unsigned &&
                this.high === -0x80000000 &&
                divisor.low === -1 &&
                divisor.high === -1) {
                // be consistent with non-wasm code path
                return this;
            }
            var low = (this.unsigned ? wasm.div_u : wasm.div_s)(this.low, this.high, divisor.low, divisor.high);
            return Long.fromBits(low, wasm.get_high(), this.unsigned);
        }
        if (this.isZero())
            return this.unsigned ? Long.UZERO : Long.ZERO;
        var approx, rem, res;
        if (!this.unsigned) {
            // This section is only relevant for signed longs and is derived from the
            // closure library as a whole.
            if (this.eq(Long.MIN_VALUE)) {
                if (divisor.eq(Long.ONE) || divisor.eq(Long.NEG_ONE))
                    return Long.MIN_VALUE;
                // recall that -MIN_VALUE == MIN_VALUE
                else if (divisor.eq(Long.MIN_VALUE))
                    return Long.ONE;
                else {
                    // At this point, we have |other| >= 2, so |this/other| < |MIN_VALUE|.
                    var halfThis = this.shr(1);
                    approx = halfThis.div(divisor).shl(1);
                    if (approx.eq(Long.ZERO)) {
                        return divisor.isNegative() ? Long.ONE : Long.NEG_ONE;
                    }
                    else {
                        rem = this.sub(divisor.mul(approx));
                        res = approx.add(rem.div(divisor));
                        return res;
                    }
                }
            }
            else if (divisor.eq(Long.MIN_VALUE))
                return this.unsigned ? Long.UZERO : Long.ZERO;
            if (this.isNegative()) {
                if (divisor.isNegative())
                    return this.neg().div(divisor.neg());
                return this.neg().div(divisor).neg();
            }
            else if (divisor.isNegative())
                return this.div(divisor.neg()).neg();
            res = Long.ZERO;
        }
        else {
            // The algorithm below has not been made for unsigned longs. It's therefore
            // required to take special care of the MSB prior to running it.
            if (!divisor.unsigned)
                divisor = divisor.toUnsigned();
            if (divisor.gt(this))
                return Long.UZERO;
            if (divisor.gt(this.shru(1)))
                // 15 >>> 1 = 7 ; with divisor = 8 ; true
                return Long.UONE;
            res = Long.UZERO;
        }
        // Repeat the following until the remainder is less than other:  find a
        // floating-point that approximates remainder / other *from below*, add this
        // into the result, and subtract it from the remainder.  It is critical that
        // the approximate value is less than or equal to the real value so that the
        // remainder never becomes negative.
        rem = this;
        while (rem.gte(divisor)) {
            // Approximate the result of division. This may be a little greater or
            // smaller than the actual value.
            approx = Math.max(1, Math.floor(rem.toNumber() / divisor.toNumber()));
            // We will tweak the approximate result by changing it in the 48-th digit or
            // the smallest non-fractional digit, whichever is larger.
            var log2 = Math.ceil(Math.log(approx) / Math.LN2);
            var delta = log2 <= 48 ? 1 : Math.pow(2, log2 - 48);
            // Decrease the approximation until it is smaller than the remainder.  Note
            // that if it is too large, the product overflows and is negative.
            var approxRes = Long.fromNumber(approx);
            var approxRem = approxRes.mul(divisor);
            while (approxRem.isNegative() || approxRem.gt(rem)) {
                approx -= delta;
                approxRes = Long.fromNumber(approx, this.unsigned);
                approxRem = approxRes.mul(divisor);
            }
            // We know the answer can't be zero... and actually, zero would cause
            // infinite recursion since we would make no progress.
            if (approxRes.isZero())
                approxRes = Long.ONE;
            res = res.add(approxRes);
            rem = rem.sub(approxRem);
        }
        return res;
    };
    /**This is an alias of {@link Long.divide} */
    Long.prototype.div = function (divisor) {
        return this.divide(divisor);
    };
    /**
     * Tests if this Long's value equals the specified's.
     * @param other - Other value
     */
    Long.prototype.equals = function (other) {
        if (!Long.isLong(other))
            other = Long.fromValue(other);
        if (this.unsigned !== other.unsigned && this.high >>> 31 === 1 && other.high >>> 31 === 1)
            return false;
        return this.high === other.high && this.low === other.low;
    };
    /** This is an alias of {@link Long.equals} */
    Long.prototype.eq = function (other) {
        return this.equals(other);
    };
    /** Gets the high 32 bits as a signed integer. */
    Long.prototype.getHighBits = function () {
        return this.high;
    };
    /** Gets the high 32 bits as an unsigned integer. */
    Long.prototype.getHighBitsUnsigned = function () {
        return this.high >>> 0;
    };
    /** Gets the low 32 bits as a signed integer. */
    Long.prototype.getLowBits = function () {
        return this.low;
    };
    /** Gets the low 32 bits as an unsigned integer. */
    Long.prototype.getLowBitsUnsigned = function () {
        return this.low >>> 0;
    };
    /** Gets the number of bits needed to represent the absolute value of this Long. */
    Long.prototype.getNumBitsAbs = function () {
        if (this.isNegative()) {
            // Unsigned Longs are never negative
            return this.eq(Long.MIN_VALUE) ? 64 : this.neg().getNumBitsAbs();
        }
        var val = this.high !== 0 ? this.high : this.low;
        var bit;
        for (bit = 31; bit > 0; bit--)
            if ((val & (1 << bit)) !== 0)
                break;
        return this.high !== 0 ? bit + 33 : bit + 1;
    };
    /** Tests if this Long's value is greater than the specified's. */
    Long.prototype.greaterThan = function (other) {
        return this.comp(other) > 0;
    };
    /** This is an alias of {@link Long.greaterThan} */
    Long.prototype.gt = function (other) {
        return this.greaterThan(other);
    };
    /** Tests if this Long's value is greater than or equal the specified's. */
    Long.prototype.greaterThanOrEqual = function (other) {
        return this.comp(other) >= 0;
    };
    /** This is an alias of {@link Long.greaterThanOrEqual} */
    Long.prototype.gte = function (other) {
        return this.greaterThanOrEqual(other);
    };
    /** This is an alias of {@link Long.greaterThanOrEqual} */
    Long.prototype.ge = function (other) {
        return this.greaterThanOrEqual(other);
    };
    /** Tests if this Long's value is even. */
    Long.prototype.isEven = function () {
        return (this.low & 1) === 0;
    };
    /** Tests if this Long's value is negative. */
    Long.prototype.isNegative = function () {
        return !this.unsigned && this.high < 0;
    };
    /** Tests if this Long's value is odd. */
    Long.prototype.isOdd = function () {
        return (this.low & 1) === 1;
    };
    /** Tests if this Long's value is positive. */
    Long.prototype.isPositive = function () {
        return this.unsigned || this.high >= 0;
    };
    /** Tests if this Long's value equals zero. */
    Long.prototype.isZero = function () {
        return this.high === 0 && this.low === 0;
    };
    /** Tests if this Long's value is less than the specified's. */
    Long.prototype.lessThan = function (other) {
        return this.comp(other) < 0;
    };
    /** This is an alias of {@link Long#lessThan}. */
    Long.prototype.lt = function (other) {
        return this.lessThan(other);
    };
    /** Tests if this Long's value is less than or equal the specified's. */
    Long.prototype.lessThanOrEqual = function (other) {
        return this.comp(other) <= 0;
    };
    /** This is an alias of {@link Long.lessThanOrEqual} */
    Long.prototype.lte = function (other) {
        return this.lessThanOrEqual(other);
    };
    /** Returns this Long modulo the specified. */
    Long.prototype.modulo = function (divisor) {
        if (!Long.isLong(divisor))
            divisor = Long.fromValue(divisor);
        // use wasm support if present
        if (wasm) {
            var low = (this.unsigned ? wasm.rem_u : wasm.rem_s)(this.low, this.high, divisor.low, divisor.high);
            return Long.fromBits(low, wasm.get_high(), this.unsigned);
        }
        return this.sub(this.div(divisor).mul(divisor));
    };
    /** This is an alias of {@link Long.modulo} */
    Long.prototype.mod = function (divisor) {
        return this.modulo(divisor);
    };
    /** This is an alias of {@link Long.modulo} */
    Long.prototype.rem = function (divisor) {
        return this.modulo(divisor);
    };
    /**
     * Returns the product of this and the specified Long.
     * @param multiplier - Multiplier
     * @returns Product
     */
    Long.prototype.multiply = function (multiplier) {
        if (this.isZero())
            return Long.ZERO;
        if (!Long.isLong(multiplier))
            multiplier = Long.fromValue(multiplier);
        // use wasm support if present
        if (wasm) {
            var low = wasm.mul(this.low, this.high, multiplier.low, multiplier.high);
            return Long.fromBits(low, wasm.get_high(), this.unsigned);
        }
        if (multiplier.isZero())
            return Long.ZERO;
        if (this.eq(Long.MIN_VALUE))
            return multiplier.isOdd() ? Long.MIN_VALUE : Long.ZERO;
        if (multiplier.eq(Long.MIN_VALUE))
            return this.isOdd() ? Long.MIN_VALUE : Long.ZERO;
        if (this.isNegative()) {
            if (multiplier.isNegative())
                return this.neg().mul(multiplier.neg());
            else
                return this.neg().mul(multiplier).neg();
        }
        else if (multiplier.isNegative())
            return this.mul(multiplier.neg()).neg();
        // If both longs are small, use float multiplication
        if (this.lt(Long.TWO_PWR_24) && multiplier.lt(Long.TWO_PWR_24))
            return Long.fromNumber(this.toNumber() * multiplier.toNumber(), this.unsigned);
        // Divide each long into 4 chunks of 16 bits, and then add up 4x4 products.
        // We can skip products that would overflow.
        var a48 = this.high >>> 16;
        var a32 = this.high & 0xffff;
        var a16 = this.low >>> 16;
        var a00 = this.low & 0xffff;
        var b48 = multiplier.high >>> 16;
        var b32 = multiplier.high & 0xffff;
        var b16 = multiplier.low >>> 16;
        var b00 = multiplier.low & 0xffff;
        var c48 = 0, c32 = 0, c16 = 0, c00 = 0;
        c00 += a00 * b00;
        c16 += c00 >>> 16;
        c00 &= 0xffff;
        c16 += a16 * b00;
        c32 += c16 >>> 16;
        c16 &= 0xffff;
        c16 += a00 * b16;
        c32 += c16 >>> 16;
        c16 &= 0xffff;
        c32 += a32 * b00;
        c48 += c32 >>> 16;
        c32 &= 0xffff;
        c32 += a16 * b16;
        c48 += c32 >>> 16;
        c32 &= 0xffff;
        c32 += a00 * b32;
        c48 += c32 >>> 16;
        c32 &= 0xffff;
        c48 += a48 * b00 + a32 * b16 + a16 * b32 + a00 * b48;
        c48 &= 0xffff;
        return Long.fromBits((c16 << 16) | c00, (c48 << 16) | c32, this.unsigned);
    };
    /** This is an alias of {@link Long.multiply} */
    Long.prototype.mul = function (multiplier) {
        return this.multiply(multiplier);
    };
    /** Returns the Negation of this Long's value. */
    Long.prototype.negate = function () {
        if (!this.unsigned && this.eq(Long.MIN_VALUE))
            return Long.MIN_VALUE;
        return this.not().add(Long.ONE);
    };
    /** This is an alias of {@link Long.negate} */
    Long.prototype.neg = function () {
        return this.negate();
    };
    /** Returns the bitwise NOT of this Long. */
    Long.prototype.not = function () {
        return Long.fromBits(~this.low, ~this.high, this.unsigned);
    };
    /** Tests if this Long's value differs from the specified's. */
    Long.prototype.notEquals = function (other) {
        return !this.equals(other);
    };
    /** This is an alias of {@link Long.notEquals} */
    Long.prototype.neq = function (other) {
        return this.notEquals(other);
    };
    /** This is an alias of {@link Long.notEquals} */
    Long.prototype.ne = function (other) {
        return this.notEquals(other);
    };
    /**
     * Returns the bitwise OR of this Long and the specified.
     */
    Long.prototype.or = function (other) {
        if (!Long.isLong(other))
            other = Long.fromValue(other);
        return Long.fromBits(this.low | other.low, this.high | other.high, this.unsigned);
    };
    /**
     * Returns this Long with bits shifted to the left by the given amount.
     * @param numBits - Number of bits
     * @returns Shifted Long
     */
    Long.prototype.shiftLeft = function (numBits) {
        if (Long.isLong(numBits))
            numBits = numBits.toInt();
        if ((numBits &= 63) === 0)
            return this;
        else if (numBits < 32)
            return Long.fromBits(this.low << numBits, (this.high << numBits) | (this.low >>> (32 - numBits)), this.unsigned);
        else
            return Long.fromBits(0, this.low << (numBits - 32), this.unsigned);
    };
    /** This is an alias of {@link Long.shiftLeft} */
    Long.prototype.shl = function (numBits) {
        return this.shiftLeft(numBits);
    };
    /**
     * Returns this Long with bits arithmetically shifted to the right by the given amount.
     * @param numBits - Number of bits
     * @returns Shifted Long
     */
    Long.prototype.shiftRight = function (numBits) {
        if (Long.isLong(numBits))
            numBits = numBits.toInt();
        if ((numBits &= 63) === 0)
            return this;
        else if (numBits < 32)
            return Long.fromBits((this.low >>> numBits) | (this.high << (32 - numBits)), this.high >> numBits, this.unsigned);
        else
            return Long.fromBits(this.high >> (numBits - 32), this.high >= 0 ? 0 : -1, this.unsigned);
    };
    /** This is an alias of {@link Long.shiftRight} */
    Long.prototype.shr = function (numBits) {
        return this.shiftRight(numBits);
    };
    /**
     * Returns this Long with bits logically shifted to the right by the given amount.
     * @param numBits - Number of bits
     * @returns Shifted Long
     */
    Long.prototype.shiftRightUnsigned = function (numBits) {
        if (Long.isLong(numBits))
            numBits = numBits.toInt();
        numBits &= 63;
        if (numBits === 0)
            return this;
        else {
            var high = this.high;
            if (numBits < 32) {
                var low = this.low;
                return Long.fromBits((low >>> numBits) | (high << (32 - numBits)), high >>> numBits, this.unsigned);
            }
            else if (numBits === 32)
                return Long.fromBits(high, 0, this.unsigned);
            else
                return Long.fromBits(high >>> (numBits - 32), 0, this.unsigned);
        }
    };
    /** This is an alias of {@link Long.shiftRightUnsigned} */
    Long.prototype.shr_u = function (numBits) {
        return this.shiftRightUnsigned(numBits);
    };
    /** This is an alias of {@link Long.shiftRightUnsigned} */
    Long.prototype.shru = function (numBits) {
        return this.shiftRightUnsigned(numBits);
    };
    /**
     * Returns the difference of this and the specified Long.
     * @param subtrahend - Subtrahend
     * @returns Difference
     */
    Long.prototype.subtract = function (subtrahend) {
        if (!Long.isLong(subtrahend))
            subtrahend = Long.fromValue(subtrahend);
        return this.add(subtrahend.neg());
    };
    /** This is an alias of {@link Long.subtract} */
    Long.prototype.sub = function (subtrahend) {
        return this.subtract(subtrahend);
    };
    /** Converts the Long to a 32 bit integer, assuming it is a 32 bit integer. */
    Long.prototype.toInt = function () {
        return this.unsigned ? this.low >>> 0 : this.low;
    };
    /** Converts the Long to a the nearest floating-point representation of this value (double, 53 bit mantissa). */
    Long.prototype.toNumber = function () {
        if (this.unsigned)
            return (this.high >>> 0) * TWO_PWR_32_DBL + (this.low >>> 0);
        return this.high * TWO_PWR_32_DBL + (this.low >>> 0);
    };
    /** Converts the Long to a BigInt (arbitrary precision). */
    Long.prototype.toBigInt = function () {
        return BigInt(this.toString());
    };
    /**
     * Converts this Long to its byte representation.
     * @param le - Whether little or big endian, defaults to big endian
     * @returns Byte representation
     */
    Long.prototype.toBytes = function (le) {
        return le ? this.toBytesLE() : this.toBytesBE();
    };
    /**
     * Converts this Long to its little endian byte representation.
     * @returns Little endian byte representation
     */
    Long.prototype.toBytesLE = function () {
        var hi = this.high, lo = this.low;
        return [
            lo & 0xff,
            (lo >>> 8) & 0xff,
            (lo >>> 16) & 0xff,
            lo >>> 24,
            hi & 0xff,
            (hi >>> 8) & 0xff,
            (hi >>> 16) & 0xff,
            hi >>> 24
        ];
    };
    /**
     * Converts this Long to its big endian byte representation.
     * @returns Big endian byte representation
     */
    Long.prototype.toBytesBE = function () {
        var hi = this.high, lo = this.low;
        return [
            hi >>> 24,
            (hi >>> 16) & 0xff,
            (hi >>> 8) & 0xff,
            hi & 0xff,
            lo >>> 24,
            (lo >>> 16) & 0xff,
            (lo >>> 8) & 0xff,
            lo & 0xff
        ];
    };
    /**
     * Converts this Long to signed.
     */
    Long.prototype.toSigned = function () {
        if (!this.unsigned)
            return this;
        return Long.fromBits(this.low, this.high, false);
    };
    /**
     * Converts the Long to a string written in the specified radix.
     * @param radix - Radix (2-36), defaults to 10
     * @throws RangeError If `radix` is out of range
     */
    Long.prototype.toString = function (radix) {
        radix = radix || 10;
        if (radix < 2 || 36 < radix)
            throw RangeError('radix');
        if (this.isZero())
            return '0';
        if (this.isNegative()) {
            // Unsigned Longs are never negative
            if (this.eq(Long.MIN_VALUE)) {
                // We need to change the Long value before it can be negated, so we remove
                // the bottom-most digit in this base and then recurse to do the rest.
                var radixLong = Long.fromNumber(radix), div = this.div(radixLong), rem1 = div.mul(radixLong).sub(this);
                return div.toString(radix) + rem1.toInt().toString(radix);
            }
            else
                return '-' + this.neg().toString(radix);
        }
        // Do several (6) digits each time through the loop, so as to
        // minimize the calls to the very expensive emulated div.
        var radixToPower = Long.fromNumber(Math.pow(radix, 6), this.unsigned);
        // eslint-disable-next-line @typescript-eslint/no-this-alias
        var rem = this;
        var result = '';
        // eslint-disable-next-line no-constant-condition
        while (true) {
            var remDiv = rem.div(radixToPower);
            var intval = rem.sub(remDiv.mul(radixToPower)).toInt() >>> 0;
            var digits = intval.toString(radix);
            rem = remDiv;
            if (rem.isZero()) {
                return digits + result;
            }
            else {
                while (digits.length < 6)
                    digits = '0' + digits;
                result = '' + digits + result;
            }
        }
    };
    /** Converts this Long to unsigned. */
    Long.prototype.toUnsigned = function () {
        if (this.unsigned)
            return this;
        return Long.fromBits(this.low, this.high, true);
    };
    /** Returns the bitwise XOR of this Long and the given one. */
    Long.prototype.xor = function (other) {
        if (!Long.isLong(other))
            other = Long.fromValue(other);
        return Long.fromBits(this.low ^ other.low, this.high ^ other.high, this.unsigned);
    };
    /** This is an alias of {@link Long.isZero} */
    Long.prototype.eqz = function () {
        return this.isZero();
    };
    /** This is an alias of {@link Long.lessThanOrEqual} */
    Long.prototype.le = function (other) {
        return this.lessThanOrEqual(other);
    };
    /*
     ****************************************************************
     *                  BSON SPECIFIC ADDITIONS                     *
     ****************************************************************
     */
    Long.prototype.toExtendedJSON = function (options) {
        if (options && options.relaxed)
            return this.toNumber();
        return { $numberLong: this.toString() };
    };
    Long.fromExtendedJSON = function (doc, options) {
        var result = Long.fromString(doc.$numberLong);
        return options && options.relaxed ? result.toNumber() : result;
    };
    /** @internal */
    Long.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    Long.prototype.inspect = function () {
        return "new Long(\"" + this.toString() + "\")";
    };
    Long.TWO_PWR_24 = Long.fromInt(TWO_PWR_24_DBL);
    /** Maximum unsigned value. */
    Long.MAX_UNSIGNED_VALUE = Long.fromBits(0xffffffff | 0, 0xffffffff | 0, true);
    /** Signed zero */
    Long.ZERO = Long.fromInt(0);
    /** Unsigned zero. */
    Long.UZERO = Long.fromInt(0, true);
    /** Signed one. */
    Long.ONE = Long.fromInt(1);
    /** Unsigned one. */
    Long.UONE = Long.fromInt(1, true);
    /** Signed negative one. */
    Long.NEG_ONE = Long.fromInt(-1);
    /** Maximum signed value. */
    Long.MAX_VALUE = Long.fromBits(0xffffffff | 0, 0x7fffffff | 0, false);
    /** Minimum signed value. */
    Long.MIN_VALUE = Long.fromBits(0, 0x80000000 | 0, false);
    return Long;
}());
exports.Long = Long;
Object.defineProperty(Long.prototype, '__isLong__', { value: true });
Object.defineProperty(Long.prototype, '_bsontype', { value: 'Long' });
//# sourceMappingURL=long.js.map
});

unwrapExports(long_1);
long_1.Long;

var decimal128 = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.Decimal128 = void 0;


var PARSE_STRING_REGEXP = /^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/;
var PARSE_INF_REGEXP = /^(\+|-)?(Infinity|inf)$/i;
var PARSE_NAN_REGEXP = /^(\+|-)?NaN$/i;
var EXPONENT_MAX = 6111;
var EXPONENT_MIN = -6176;
var EXPONENT_BIAS = 6176;
var MAX_DIGITS = 34;
// Nan value bits as 32 bit values (due to lack of longs)
var NAN_BUFFER = [
    0x7c,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00
].reverse();
// Infinity value bits 32 bit values (due to lack of longs)
var INF_NEGATIVE_BUFFER = [
    0xf8,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00
].reverse();
var INF_POSITIVE_BUFFER = [
    0x78,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00
].reverse();
var EXPONENT_REGEX = /^([-+])?(\d+)?$/;
// Extract least significant 5 bits
var COMBINATION_MASK = 0x1f;
// Extract least significant 14 bits
var EXPONENT_MASK = 0x3fff;
// Value of combination field for Inf
var COMBINATION_INFINITY = 30;
// Value of combination field for NaN
var COMBINATION_NAN = 31;
// Detect if the value is a digit
function isDigit(value) {
    return !isNaN(parseInt(value, 10));
}
// Divide two uint128 values
function divideu128(value) {
    var DIVISOR = long_1.Long.fromNumber(1000 * 1000 * 1000);
    var _rem = long_1.Long.fromNumber(0);
    if (!value.parts[0] && !value.parts[1] && !value.parts[2] && !value.parts[3]) {
        return { quotient: value, rem: _rem };
    }
    for (var i = 0; i <= 3; i++) {
        // Adjust remainder to match value of next dividend
        _rem = _rem.shiftLeft(32);
        // Add the divided to _rem
        _rem = _rem.add(new long_1.Long(value.parts[i], 0));
        value.parts[i] = _rem.div(DIVISOR).low;
        _rem = _rem.modulo(DIVISOR);
    }
    return { quotient: value, rem: _rem };
}
// Multiply two Long values and return the 128 bit value
function multiply64x2(left, right) {
    if (!left && !right) {
        return { high: long_1.Long.fromNumber(0), low: long_1.Long.fromNumber(0) };
    }
    var leftHigh = left.shiftRightUnsigned(32);
    var leftLow = new long_1.Long(left.getLowBits(), 0);
    var rightHigh = right.shiftRightUnsigned(32);
    var rightLow = new long_1.Long(right.getLowBits(), 0);
    var productHigh = leftHigh.multiply(rightHigh);
    var productMid = leftHigh.multiply(rightLow);
    var productMid2 = leftLow.multiply(rightHigh);
    var productLow = leftLow.multiply(rightLow);
    productHigh = productHigh.add(productMid.shiftRightUnsigned(32));
    productMid = new long_1.Long(productMid.getLowBits(), 0)
        .add(productMid2)
        .add(productLow.shiftRightUnsigned(32));
    productHigh = productHigh.add(productMid.shiftRightUnsigned(32));
    productLow = productMid.shiftLeft(32).add(new long_1.Long(productLow.getLowBits(), 0));
    // Return the 128 bit result
    return { high: productHigh, low: productLow };
}
function lessThan(left, right) {
    // Make values unsigned
    var uhleft = left.high >>> 0;
    var uhright = right.high >>> 0;
    // Compare high bits first
    if (uhleft < uhright) {
        return true;
    }
    else if (uhleft === uhright) {
        var ulleft = left.low >>> 0;
        var ulright = right.low >>> 0;
        if (ulleft < ulright)
            return true;
    }
    return false;
}
function invalidErr(string, message) {
    throw new TypeError("\"" + string + "\" is not a valid Decimal128 string - " + message);
}
/**
 * A class representation of the BSON Decimal128 type.
 * @public
 */
var Decimal128 = /** @class */ (function () {
    /** @param bytes - a buffer containing the raw Decimal128 bytes in little endian order */
    function Decimal128(bytes) {
        if (!(this instanceof Decimal128))
            return new Decimal128(bytes);
        this.bytes = bytes;
    }
    /**
     * Create a Decimal128 instance from a string representation
     *
     * @param representation - a numeric string representation.
     */
    Decimal128.fromString = function (representation) {
        // Parse state tracking
        var isNegative = false;
        var sawRadix = false;
        var foundNonZero = false;
        // Total number of significant digits (no leading or trailing zero)
        var significantDigits = 0;
        // Total number of significand digits read
        var nDigitsRead = 0;
        // Total number of digits (no leading zeros)
        var nDigits = 0;
        // The number of the digits after radix
        var radixPosition = 0;
        // The index of the first non-zero in *str*
        var firstNonZero = 0;
        // Digits Array
        var digits = [0];
        // The number of digits in digits
        var nDigitsStored = 0;
        // Insertion pointer for digits
        var digitsInsert = 0;
        // The index of the first non-zero digit
        var firstDigit = 0;
        // The index of the last digit
        var lastDigit = 0;
        // Exponent
        var exponent = 0;
        // loop index over array
        var i = 0;
        // The high 17 digits of the significand
        var significandHigh = new long_1.Long(0, 0);
        // The low 17 digits of the significand
        var significandLow = new long_1.Long(0, 0);
        // The biased exponent
        var biasedExponent = 0;
        // Read index
        var index = 0;
        // Naively prevent against REDOS attacks.
        // TODO: implementing a custom parsing for this, or refactoring the regex would yield
        //       further gains.
        if (representation.length >= 7000) {
            throw new TypeError('' + representation + ' not a valid Decimal128 string');
        }
        // Results
        var stringMatch = representation.match(PARSE_STRING_REGEXP);
        var infMatch = representation.match(PARSE_INF_REGEXP);
        var nanMatch = representation.match(PARSE_NAN_REGEXP);
        // Validate the string
        if ((!stringMatch && !infMatch && !nanMatch) || representation.length === 0) {
            throw new TypeError('' + representation + ' not a valid Decimal128 string');
        }
        if (stringMatch) {
            // full_match = stringMatch[0]
            // sign = stringMatch[1]
            var unsignedNumber = stringMatch[2];
            // stringMatch[3] is undefined if a whole number (ex "1", 12")
            // but defined if a number w/ decimal in it (ex "1.0, 12.2")
            var e = stringMatch[4];
            var expSign = stringMatch[5];
            var expNumber = stringMatch[6];
            // they provided e, but didn't give an exponent number. for ex "1e"
            if (e && expNumber === undefined)
                invalidErr(representation, 'missing exponent power');
            // they provided e, but didn't give a number before it. for ex "e1"
            if (e && unsignedNumber === undefined)
                invalidErr(representation, 'missing exponent base');
            if (e === undefined && (expSign || expNumber)) {
                invalidErr(representation, 'missing e before exponent');
            }
        }
        // Get the negative or positive sign
        if (representation[index] === '+' || representation[index] === '-') {
            isNegative = representation[index++] === '-';
        }
        // Check if user passed Infinity or NaN
        if (!isDigit(representation[index]) && representation[index] !== '.') {
            if (representation[index] === 'i' || representation[index] === 'I') {
                return new Decimal128(buffer.Buffer.from(isNegative ? INF_NEGATIVE_BUFFER : INF_POSITIVE_BUFFER));
            }
            else if (representation[index] === 'N') {
                return new Decimal128(buffer.Buffer.from(NAN_BUFFER));
            }
        }
        // Read all the digits
        while (isDigit(representation[index]) || representation[index] === '.') {
            if (representation[index] === '.') {
                if (sawRadix)
                    invalidErr(representation, 'contains multiple periods');
                sawRadix = true;
                index = index + 1;
                continue;
            }
            if (nDigitsStored < 34) {
                if (representation[index] !== '0' || foundNonZero) {
                    if (!foundNonZero) {
                        firstNonZero = nDigitsRead;
                    }
                    foundNonZero = true;
                    // Only store 34 digits
                    digits[digitsInsert++] = parseInt(representation[index], 10);
                    nDigitsStored = nDigitsStored + 1;
                }
            }
            if (foundNonZero)
                nDigits = nDigits + 1;
            if (sawRadix)
                radixPosition = radixPosition + 1;
            nDigitsRead = nDigitsRead + 1;
            index = index + 1;
        }
        if (sawRadix && !nDigitsRead)
            throw new TypeError('' + representation + ' not a valid Decimal128 string');
        // Read exponent if exists
        if (representation[index] === 'e' || representation[index] === 'E') {
            // Read exponent digits
            var match = representation.substr(++index).match(EXPONENT_REGEX);
            // No digits read
            if (!match || !match[2])
                return new Decimal128(buffer.Buffer.from(NAN_BUFFER));
            // Get exponent
            exponent = parseInt(match[0], 10);
            // Adjust the index
            index = index + match[0].length;
        }
        // Return not a number
        if (representation[index])
            return new Decimal128(buffer.Buffer.from(NAN_BUFFER));
        // Done reading input
        // Find first non-zero digit in digits
        firstDigit = 0;
        if (!nDigitsStored) {
            firstDigit = 0;
            lastDigit = 0;
            digits[0] = 0;
            nDigits = 1;
            nDigitsStored = 1;
            significantDigits = 0;
        }
        else {
            lastDigit = nDigitsStored - 1;
            significantDigits = nDigits;
            if (significantDigits !== 1) {
                while (representation[firstNonZero + significantDigits - 1] === '0') {
                    significantDigits = significantDigits - 1;
                }
            }
        }
        // Normalization of exponent
        // Correct exponent based on radix position, and shift significand as needed
        // to represent user input
        // Overflow prevention
        if (exponent <= radixPosition && radixPosition - exponent > 1 << 14) {
            exponent = EXPONENT_MIN;
        }
        else {
            exponent = exponent - radixPosition;
        }
        // Attempt to normalize the exponent
        while (exponent > EXPONENT_MAX) {
            // Shift exponent to significand and decrease
            lastDigit = lastDigit + 1;
            if (lastDigit - firstDigit > MAX_DIGITS) {
                // Check if we have a zero then just hard clamp, otherwise fail
                var digitsString = digits.join('');
                if (digitsString.match(/^0+$/)) {
                    exponent = EXPONENT_MAX;
                    break;
                }
                invalidErr(representation, 'overflow');
            }
            exponent = exponent - 1;
        }
        while (exponent < EXPONENT_MIN || nDigitsStored < nDigits) {
            // Shift last digit. can only do this if < significant digits than # stored.
            if (lastDigit === 0 && significantDigits < nDigitsStored) {
                exponent = EXPONENT_MIN;
                significantDigits = 0;
                break;
            }
            if (nDigitsStored < nDigits) {
                // adjust to match digits not stored
                nDigits = nDigits - 1;
            }
            else {
                // adjust to round
                lastDigit = lastDigit - 1;
            }
            if (exponent < EXPONENT_MAX) {
                exponent = exponent + 1;
            }
            else {
                // Check if we have a zero then just hard clamp, otherwise fail
                var digitsString = digits.join('');
                if (digitsString.match(/^0+$/)) {
                    exponent = EXPONENT_MAX;
                    break;
                }
                invalidErr(representation, 'overflow');
            }
        }
        // Round
        // We've normalized the exponent, but might still need to round.
        if (lastDigit - firstDigit + 1 < significantDigits) {
            var endOfString = nDigitsRead;
            // If we have seen a radix point, 'string' is 1 longer than we have
            // documented with ndigits_read, so inc the position of the first nonzero
            // digit and the position that digits are read to.
            if (sawRadix) {
                firstNonZero = firstNonZero + 1;
                endOfString = endOfString + 1;
            }
            // if negative, we need to increment again to account for - sign at start.
            if (isNegative) {
                firstNonZero = firstNonZero + 1;
                endOfString = endOfString + 1;
            }
            var roundDigit = parseInt(representation[firstNonZero + lastDigit + 1], 10);
            var roundBit = 0;
            if (roundDigit >= 5) {
                roundBit = 1;
                if (roundDigit === 5) {
                    roundBit = digits[lastDigit] % 2 === 1 ? 1 : 0;
                    for (i = firstNonZero + lastDigit + 2; i < endOfString; i++) {
                        if (parseInt(representation[i], 10)) {
                            roundBit = 1;
                            break;
                        }
                    }
                }
            }
            if (roundBit) {
                var dIdx = lastDigit;
                for (; dIdx >= 0; dIdx--) {
                    if (++digits[dIdx] > 9) {
                        digits[dIdx] = 0;
                        // overflowed most significant digit
                        if (dIdx === 0) {
                            if (exponent < EXPONENT_MAX) {
                                exponent = exponent + 1;
                                digits[dIdx] = 1;
                            }
                            else {
                                return new Decimal128(buffer.Buffer.from(isNegative ? INF_NEGATIVE_BUFFER : INF_POSITIVE_BUFFER));
                            }
                        }
                    }
                }
            }
        }
        // Encode significand
        // The high 17 digits of the significand
        significandHigh = long_1.Long.fromNumber(0);
        // The low 17 digits of the significand
        significandLow = long_1.Long.fromNumber(0);
        // read a zero
        if (significantDigits === 0) {
            significandHigh = long_1.Long.fromNumber(0);
            significandLow = long_1.Long.fromNumber(0);
        }
        else if (lastDigit - firstDigit < 17) {
            var dIdx = firstDigit;
            significandLow = long_1.Long.fromNumber(digits[dIdx++]);
            significandHigh = new long_1.Long(0, 0);
            for (; dIdx <= lastDigit; dIdx++) {
                significandLow = significandLow.multiply(long_1.Long.fromNumber(10));
                significandLow = significandLow.add(long_1.Long.fromNumber(digits[dIdx]));
            }
        }
        else {
            var dIdx = firstDigit;
            significandHigh = long_1.Long.fromNumber(digits[dIdx++]);
            for (; dIdx <= lastDigit - 17; dIdx++) {
                significandHigh = significandHigh.multiply(long_1.Long.fromNumber(10));
                significandHigh = significandHigh.add(long_1.Long.fromNumber(digits[dIdx]));
            }
            significandLow = long_1.Long.fromNumber(digits[dIdx++]);
            for (; dIdx <= lastDigit; dIdx++) {
                significandLow = significandLow.multiply(long_1.Long.fromNumber(10));
                significandLow = significandLow.add(long_1.Long.fromNumber(digits[dIdx]));
            }
        }
        var significand = multiply64x2(significandHigh, long_1.Long.fromString('100000000000000000'));
        significand.low = significand.low.add(significandLow);
        if (lessThan(significand.low, significandLow)) {
            significand.high = significand.high.add(long_1.Long.fromNumber(1));
        }
        // Biased exponent
        biasedExponent = exponent + EXPONENT_BIAS;
        var dec = { low: long_1.Long.fromNumber(0), high: long_1.Long.fromNumber(0) };
        // Encode combination, exponent, and significand.
        if (significand.high.shiftRightUnsigned(49).and(long_1.Long.fromNumber(1)).equals(long_1.Long.fromNumber(1))) {
            // Encode '11' into bits 1 to 3
            dec.high = dec.high.or(long_1.Long.fromNumber(0x3).shiftLeft(61));
            dec.high = dec.high.or(long_1.Long.fromNumber(biasedExponent).and(long_1.Long.fromNumber(0x3fff).shiftLeft(47)));
            dec.high = dec.high.or(significand.high.and(long_1.Long.fromNumber(0x7fffffffffff)));
        }
        else {
            dec.high = dec.high.or(long_1.Long.fromNumber(biasedExponent & 0x3fff).shiftLeft(49));
            dec.high = dec.high.or(significand.high.and(long_1.Long.fromNumber(0x1ffffffffffff)));
        }
        dec.low = significand.low;
        // Encode sign
        if (isNegative) {
            dec.high = dec.high.or(long_1.Long.fromString('9223372036854775808'));
        }
        // Encode into a buffer
        var buffer$1 = buffer.Buffer.alloc(16);
        index = 0;
        // Encode the low 64 bits of the decimal
        // Encode low bits
        buffer$1[index++] = dec.low.low & 0xff;
        buffer$1[index++] = (dec.low.low >> 8) & 0xff;
        buffer$1[index++] = (dec.low.low >> 16) & 0xff;
        buffer$1[index++] = (dec.low.low >> 24) & 0xff;
        // Encode high bits
        buffer$1[index++] = dec.low.high & 0xff;
        buffer$1[index++] = (dec.low.high >> 8) & 0xff;
        buffer$1[index++] = (dec.low.high >> 16) & 0xff;
        buffer$1[index++] = (dec.low.high >> 24) & 0xff;
        // Encode the high 64 bits of the decimal
        // Encode low bits
        buffer$1[index++] = dec.high.low & 0xff;
        buffer$1[index++] = (dec.high.low >> 8) & 0xff;
        buffer$1[index++] = (dec.high.low >> 16) & 0xff;
        buffer$1[index++] = (dec.high.low >> 24) & 0xff;
        // Encode high bits
        buffer$1[index++] = dec.high.high & 0xff;
        buffer$1[index++] = (dec.high.high >> 8) & 0xff;
        buffer$1[index++] = (dec.high.high >> 16) & 0xff;
        buffer$1[index++] = (dec.high.high >> 24) & 0xff;
        // Return the new Decimal128
        return new Decimal128(buffer$1);
    };
    /** Create a string representation of the raw Decimal128 value */
    Decimal128.prototype.toString = function () {
        // Note: bits in this routine are referred to starting at 0,
        // from the sign bit, towards the coefficient.
        // decoded biased exponent (14 bits)
        var biased_exponent;
        // the number of significand digits
        var significand_digits = 0;
        // the base-10 digits in the significand
        var significand = new Array(36);
        for (var i = 0; i < significand.length; i++)
            significand[i] = 0;
        // read pointer into significand
        var index = 0;
        // true if the number is zero
        var is_zero = false;
        // the most significant significand bits (50-46)
        var significand_msb;
        // temporary storage for significand decoding
        var significand128 = { parts: [0, 0, 0, 0] };
        // indexing variables
        var j, k;
        // Output string
        var string = [];
        // Unpack index
        index = 0;
        // Buffer reference
        var buffer = this.bytes;
        // Unpack the low 64bits into a long
        // bits 96 - 127
        var low = buffer[index++] | (buffer[index++] << 8) | (buffer[index++] << 16) | (buffer[index++] << 24);
        // bits 64 - 95
        var midl = buffer[index++] | (buffer[index++] << 8) | (buffer[index++] << 16) | (buffer[index++] << 24);
        // Unpack the high 64bits into a long
        // bits 32 - 63
        var midh = buffer[index++] | (buffer[index++] << 8) | (buffer[index++] << 16) | (buffer[index++] << 24);
        // bits 0 - 31
        var high = buffer[index++] | (buffer[index++] << 8) | (buffer[index++] << 16) | (buffer[index++] << 24);
        // Unpack index
        index = 0;
        // Create the state of the decimal
        var dec = {
            low: new long_1.Long(low, midl),
            high: new long_1.Long(midh, high)
        };
        if (dec.high.lessThan(long_1.Long.ZERO)) {
            string.push('-');
        }
        // Decode combination field and exponent
        // bits 1 - 5
        var combination = (high >> 26) & COMBINATION_MASK;
        if (combination >> 3 === 3) {
            // Check for 'special' values
            if (combination === COMBINATION_INFINITY) {
                return string.join('') + 'Infinity';
            }
            else if (combination === COMBINATION_NAN) {
                return 'NaN';
            }
            else {
                biased_exponent = (high >> 15) & EXPONENT_MASK;
                significand_msb = 0x08 + ((high >> 14) & 0x01);
            }
        }
        else {
            significand_msb = (high >> 14) & 0x07;
            biased_exponent = (high >> 17) & EXPONENT_MASK;
        }
        // unbiased exponent
        var exponent = biased_exponent - EXPONENT_BIAS;
        // Create string of significand digits
        // Convert the 114-bit binary number represented by
        // (significand_high, significand_low) to at most 34 decimal
        // digits through modulo and division.
        significand128.parts[0] = (high & 0x3fff) + ((significand_msb & 0xf) << 14);
        significand128.parts[1] = midh;
        significand128.parts[2] = midl;
        significand128.parts[3] = low;
        if (significand128.parts[0] === 0 &&
            significand128.parts[1] === 0 &&
            significand128.parts[2] === 0 &&
            significand128.parts[3] === 0) {
            is_zero = true;
        }
        else {
            for (k = 3; k >= 0; k--) {
                var least_digits = 0;
                // Perform the divide
                var result = divideu128(significand128);
                significand128 = result.quotient;
                least_digits = result.rem.low;
                // We now have the 9 least significant digits (in base 2).
                // Convert and output to string.
                if (!least_digits)
                    continue;
                for (j = 8; j >= 0; j--) {
                    // significand[k * 9 + j] = Math.round(least_digits % 10);
                    significand[k * 9 + j] = least_digits % 10;
                    // least_digits = Math.round(least_digits / 10);
                    least_digits = Math.floor(least_digits / 10);
                }
            }
        }
        // Output format options:
        // Scientific - [-]d.dddE(+/-)dd or [-]dE(+/-)dd
        // Regular    - ddd.ddd
        if (is_zero) {
            significand_digits = 1;
            significand[index] = 0;
        }
        else {
            significand_digits = 36;
            while (!significand[index]) {
                significand_digits = significand_digits - 1;
                index = index + 1;
            }
        }
        // the exponent if scientific notation is used
        var scientific_exponent = significand_digits - 1 + exponent;
        // The scientific exponent checks are dictated by the string conversion
        // specification and are somewhat arbitrary cutoffs.
        //
        // We must check exponent > 0, because if this is the case, the number
        // has trailing zeros.  However, we *cannot* output these trailing zeros,
        // because doing so would change the precision of the value, and would
        // change stored data if the string converted number is round tripped.
        if (scientific_exponent >= 34 || scientific_exponent <= -7 || exponent > 0) {
            // Scientific format
            // if there are too many significant digits, we should just be treating numbers
            // as + or - 0 and using the non-scientific exponent (this is for the "invalid
            // representation should be treated as 0/-0" spec cases in decimal128-1.json)
            if (significand_digits > 34) {
                string.push("" + 0);
                if (exponent > 0)
                    string.push('E+' + exponent);
                else if (exponent < 0)
                    string.push('E' + exponent);
                return string.join('');
            }
            string.push("" + significand[index++]);
            significand_digits = significand_digits - 1;
            if (significand_digits) {
                string.push('.');
            }
            for (var i = 0; i < significand_digits; i++) {
                string.push("" + significand[index++]);
            }
            // Exponent
            string.push('E');
            if (scientific_exponent > 0) {
                string.push('+' + scientific_exponent);
            }
            else {
                string.push("" + scientific_exponent);
            }
        }
        else {
            // Regular format with no decimal place
            if (exponent >= 0) {
                for (var i = 0; i < significand_digits; i++) {
                    string.push("" + significand[index++]);
                }
            }
            else {
                var radix_position = significand_digits + exponent;
                // non-zero digits before radix
                if (radix_position > 0) {
                    for (var i = 0; i < radix_position; i++) {
                        string.push("" + significand[index++]);
                    }
                }
                else {
                    string.push('0');
                }
                string.push('.');
                // add leading zeros after radix
                while (radix_position++ < 0) {
                    string.push('0');
                }
                for (var i = 0; i < significand_digits - Math.max(radix_position - 1, 0); i++) {
                    string.push("" + significand[index++]);
                }
            }
        }
        return string.join('');
    };
    Decimal128.prototype.toJSON = function () {
        return { $numberDecimal: this.toString() };
    };
    /** @internal */
    Decimal128.prototype.toExtendedJSON = function () {
        return { $numberDecimal: this.toString() };
    };
    /** @internal */
    Decimal128.fromExtendedJSON = function (doc) {
        return Decimal128.fromString(doc.$numberDecimal);
    };
    /** @internal */
    Decimal128.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    Decimal128.prototype.inspect = function () {
        return "Decimal128.fromString(\"" + this.toString() + "\")";
    };
    return Decimal128;
}());
exports.Decimal128 = Decimal128;
Object.defineProperty(Decimal128.prototype, '_bsontype', { value: 'Decimal128' });
//# sourceMappingURL=decimal128.js.map
});

unwrapExports(decimal128);
decimal128.Decimal128;

var double_1 = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.Double = void 0;
/**
 * A class representation of the BSON Double type.
 * @public
 */
var Double = /** @class */ (function () {
    /**
     * Create a Double type
     *
     * @param value - the number we want to represent as a double.
     */
    function Double(value) {
        if (!(this instanceof Double))
            return new Double(value);
        if (value instanceof Number) {
            value = value.valueOf();
        }
        this.value = +value;
    }
    /**
     * Access the number value.
     *
     * @returns returns the wrapped double number.
     */
    Double.prototype.valueOf = function () {
        return this.value;
    };
    /** @internal */
    Double.prototype.toJSON = function () {
        return this.value;
    };
    /** @internal */
    Double.prototype.toExtendedJSON = function (options) {
        if (options && (options.legacy || (options.relaxed && isFinite(this.value)))) {
            return this.value;
        }
        // NOTE: JavaScript has +0 and -0, apparently to model limit calculations. If a user
        // explicitly provided `-0` then we need to ensure the sign makes it into the output
        if (Object.is(Math.sign(this.value), -0)) {
            return { $numberDouble: "-" + this.value.toFixed(1) };
        }
        var $numberDouble;
        if (Number.isInteger(this.value)) {
            $numberDouble = this.value.toFixed(1);
            if ($numberDouble.length >= 13) {
                $numberDouble = this.value.toExponential(13).toUpperCase();
            }
        }
        else {
            $numberDouble = this.value.toString();
        }
        return { $numberDouble: $numberDouble };
    };
    /** @internal */
    Double.fromExtendedJSON = function (doc, options) {
        var doubleValue = parseFloat(doc.$numberDouble);
        return options && options.relaxed ? doubleValue : new Double(doubleValue);
    };
    /** @internal */
    Double.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    Double.prototype.inspect = function () {
        var eJSON = this.toExtendedJSON();
        return "new Double(" + eJSON.$numberDouble + ")";
    };
    return Double;
}());
exports.Double = Double;
Object.defineProperty(Double.prototype, '_bsontype', { value: 'Double' });
//# sourceMappingURL=double.js.map
});

unwrapExports(double_1);
double_1.Double;

var int_32 = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.Int32 = void 0;
/**
 * A class representation of a BSON Int32 type.
 * @public
 */
var Int32 = /** @class */ (function () {
    /**
     * Create an Int32 type
     *
     * @param value - the number we want to represent as an int32.
     */
    function Int32(value) {
        if (!(this instanceof Int32))
            return new Int32(value);
        if (value instanceof Number) {
            value = value.valueOf();
        }
        this.value = +value;
    }
    /**
     * Access the number value.
     *
     * @returns returns the wrapped int32 number.
     */
    Int32.prototype.valueOf = function () {
        return this.value;
    };
    /** @internal */
    Int32.prototype.toJSON = function () {
        return this.value;
    };
    /** @internal */
    Int32.prototype.toExtendedJSON = function (options) {
        if (options && (options.relaxed || options.legacy))
            return this.value;
        return { $numberInt: this.value.toString() };
    };
    /** @internal */
    Int32.fromExtendedJSON = function (doc, options) {
        return options && options.relaxed ? parseInt(doc.$numberInt, 10) : new Int32(doc.$numberInt);
    };
    /** @internal */
    Int32.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    Int32.prototype.inspect = function () {
        return "new Int32(" + this.valueOf() + ")";
    };
    return Int32;
}());
exports.Int32 = Int32;
Object.defineProperty(Int32.prototype, '_bsontype', { value: 'Int32' });
//# sourceMappingURL=int_32.js.map
});

unwrapExports(int_32);
int_32.Int32;

var max_key = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.MaxKey = void 0;
/**
 * A class representation of the BSON MaxKey type.
 * @public
 */
var MaxKey = /** @class */ (function () {
    function MaxKey() {
        if (!(this instanceof MaxKey))
            return new MaxKey();
    }
    /** @internal */
    MaxKey.prototype.toExtendedJSON = function () {
        return { $maxKey: 1 };
    };
    /** @internal */
    MaxKey.fromExtendedJSON = function () {
        return new MaxKey();
    };
    /** @internal */
    MaxKey.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    MaxKey.prototype.inspect = function () {
        return 'new MaxKey()';
    };
    return MaxKey;
}());
exports.MaxKey = MaxKey;
Object.defineProperty(MaxKey.prototype, '_bsontype', { value: 'MaxKey' });
//# sourceMappingURL=max_key.js.map
});

unwrapExports(max_key);
max_key.MaxKey;

var min_key = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.MinKey = void 0;
/**
 * A class representation of the BSON MinKey type.
 * @public
 */
var MinKey = /** @class */ (function () {
    function MinKey() {
        if (!(this instanceof MinKey))
            return new MinKey();
    }
    /** @internal */
    MinKey.prototype.toExtendedJSON = function () {
        return { $minKey: 1 };
    };
    /** @internal */
    MinKey.fromExtendedJSON = function () {
        return new MinKey();
    };
    /** @internal */
    MinKey.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    MinKey.prototype.inspect = function () {
        return 'new MinKey()';
    };
    return MinKey;
}());
exports.MinKey = MinKey;
Object.defineProperty(MinKey.prototype, '_bsontype', { value: 'MinKey' });
//# sourceMappingURL=min_key.js.map
});

unwrapExports(min_key);
min_key.MinKey;

var objectid = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.ObjectId = void 0;



// constants
var PROCESS_UNIQUE = utils.randomBytes(5);
// Regular expression that checks for hex value
var checkForHexRegExp = new RegExp('^[0-9a-fA-F]{24}$');
// Precomputed hex table enables speedy hex string conversion
var hexTable = [];
for (var i_1 = 0; i_1 < 256; i_1++) {
    hexTable[i_1] = (i_1 <= 15 ? '0' : '') + i_1.toString(16);
}
// Lookup tables
var decodeLookup = [];
var i = 0;
while (i < 10)
    decodeLookup[0x30 + i] = i++;
while (i < 16)
    decodeLookup[0x41 - 10 + i] = decodeLookup[0x61 - 10 + i] = i++;
var kId = Symbol('id');
/**
 * A class representation of the BSON ObjectId type.
 * @public
 */
var ObjectId = /** @class */ (function () {
    /**
     * Create an ObjectId type
     *
     * @param id - Can be a 24 character hex string, 12 byte binary Buffer, or a number.
     */
    function ObjectId(id) {
        if (!(this instanceof ObjectId))
            return new ObjectId(id);
        // Duck-typing to support ObjectId from different npm packages
        if (id instanceof ObjectId) {
            this[kId] = id.id;
            this.__id = id.__id;
        }
        if (typeof id === 'object' && id && 'id' in id) {
            if ('toHexString' in id && typeof id.toHexString === 'function') {
                this[kId] = buffer.Buffer.from(id.toHexString(), 'hex');
            }
            else {
                this[kId] = typeof id.id === 'string' ? buffer.Buffer.from(id.id) : id.id;
            }
        }
        // The most common use case (blank id, new objectId instance)
        if (id == null || typeof id === 'number') {
            // Generate a new id
            this[kId] = ObjectId.generate(typeof id === 'number' ? id : undefined);
            // If we are caching the hex string
            if (ObjectId.cacheHexString) {
                this.__id = this.id.toString('hex');
            }
        }
        if (ArrayBuffer.isView(id) && id.byteLength === 12) {
            this[kId] = ensure_buffer.ensureBuffer(id);
        }
        if (typeof id === 'string') {
            if (id.length === 12) {
                var bytes = buffer.Buffer.from(id);
                if (bytes.byteLength === 12) {
                    this[kId] = bytes;
                }
            }
            else if (id.length === 24 && checkForHexRegExp.test(id)) {
                this[kId] = buffer.Buffer.from(id, 'hex');
            }
            else {
                throw new TypeError('Argument passed in must be a Buffer or string of 12 bytes or a string of 24 hex characters');
            }
        }
        if (ObjectId.cacheHexString) {
            this.__id = this.id.toString('hex');
        }
    }
    Object.defineProperty(ObjectId.prototype, "id", {
        /**
         * The ObjectId bytes
         * @readonly
         */
        get: function () {
            return this[kId];
        },
        set: function (value) {
            this[kId] = value;
            if (ObjectId.cacheHexString) {
                this.__id = value.toString('hex');
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(ObjectId.prototype, "generationTime", {
        /**
         * The generation time of this ObjectId instance
         * @deprecated Please use getTimestamp / createFromTime which returns an int32 epoch
         */
        get: function () {
            return this.id.readInt32BE(0);
        },
        set: function (value) {
            // Encode time into first 4 bytes
            this.id.writeUInt32BE(value, 0);
        },
        enumerable: false,
        configurable: true
    });
    /** Returns the ObjectId id as a 24 character hex string representation */
    ObjectId.prototype.toHexString = function () {
        if (ObjectId.cacheHexString && this.__id) {
            return this.__id;
        }
        var hexString = this.id.toString('hex');
        if (ObjectId.cacheHexString && !this.__id) {
            this.__id = hexString;
        }
        return hexString;
    };
    /**
     * Update the ObjectId index
     * @privateRemarks
     * Used in generating new ObjectId's on the driver
     * @internal
     */
    ObjectId.getInc = function () {
        return (ObjectId.index = (ObjectId.index + 1) % 0xffffff);
    };
    /**
     * Generate a 12 byte id buffer used in ObjectId's
     *
     * @param time - pass in a second based timestamp.
     */
    ObjectId.generate = function (time) {
        if ('number' !== typeof time) {
            time = ~~(Date.now() / 1000);
        }
        var inc = ObjectId.getInc();
        var buffer$1 = buffer.Buffer.alloc(12);
        // 4-byte timestamp
        buffer$1.writeUInt32BE(time, 0);
        // 5-byte process unique
        buffer$1[4] = PROCESS_UNIQUE[0];
        buffer$1[5] = PROCESS_UNIQUE[1];
        buffer$1[6] = PROCESS_UNIQUE[2];
        buffer$1[7] = PROCESS_UNIQUE[3];
        buffer$1[8] = PROCESS_UNIQUE[4];
        // 3-byte counter
        buffer$1[11] = inc & 0xff;
        buffer$1[10] = (inc >> 8) & 0xff;
        buffer$1[9] = (inc >> 16) & 0xff;
        return buffer$1;
    };
    /**
     * Converts the id into a 24 character hex string for printing
     *
     * @param format - The Buffer toString format parameter.
     * @internal
     */
    ObjectId.prototype.toString = function (format) {
        // Is the id a buffer then use the buffer toString method to return the format
        if (format)
            return this.id.toString(format);
        return this.toHexString();
    };
    /**
     * Converts to its JSON the 24 character hex string representation.
     * @internal
     */
    ObjectId.prototype.toJSON = function () {
        return this.toHexString();
    };
    /**
     * Compares the equality of this ObjectId with `otherID`.
     *
     * @param otherId - ObjectId instance to compare against.
     */
    ObjectId.prototype.equals = function (otherId) {
        if (otherId === undefined || otherId === null) {
            return false;
        }
        if (otherId instanceof ObjectId) {
            return this.toString() === otherId.toString();
        }
        if (typeof otherId === 'string' &&
            ObjectId.isValid(otherId) &&
            otherId.length === 12 &&
            buffer.Buffer.isBuffer(this.id)) {
            return otherId === this.id.toString('binary');
        }
        if (typeof otherId === 'string' && ObjectId.isValid(otherId) && otherId.length === 24) {
            return otherId.toLowerCase() === this.toHexString();
        }
        if (typeof otherId === 'string' && ObjectId.isValid(otherId) && otherId.length === 12) {
            return buffer.Buffer.from(otherId).equals(this.id);
        }
        if (typeof otherId === 'object' &&
            'toHexString' in otherId &&
            typeof otherId.toHexString === 'function') {
            return otherId.toHexString() === this.toHexString();
        }
        return false;
    };
    /** Returns the generation date (accurate up to the second) that this ID was generated. */
    ObjectId.prototype.getTimestamp = function () {
        var timestamp = new Date();
        var time = this.id.readUInt32BE(0);
        timestamp.setTime(Math.floor(time) * 1000);
        return timestamp;
    };
    /** @internal */
    ObjectId.createPk = function () {
        return new ObjectId();
    };
    /**
     * Creates an ObjectId from a second based number, with the rest of the ObjectId zeroed out. Used for comparisons or sorting the ObjectId.
     *
     * @param time - an integer number representing a number of seconds.
     */
    ObjectId.createFromTime = function (time) {
        var buffer$1 = buffer.Buffer.from([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);
        // Encode time into first 4 bytes
        buffer$1.writeUInt32BE(time, 0);
        // Return the new objectId
        return new ObjectId(buffer$1);
    };
    /**
     * Creates an ObjectId from a hex string representation of an ObjectId.
     *
     * @param hexString - create a ObjectId from a passed in 24 character hexstring.
     */
    ObjectId.createFromHexString = function (hexString) {
        // Throw an error if it's not a valid setup
        if (typeof hexString === 'undefined' || (hexString != null && hexString.length !== 24)) {
            throw new TypeError('Argument passed in must be a single String of 12 bytes or a string of 24 hex characters');
        }
        return new ObjectId(buffer.Buffer.from(hexString, 'hex'));
    };
    /**
     * Checks if a value is a valid bson ObjectId
     *
     * @param id - ObjectId instance to validate.
     */
    ObjectId.isValid = function (id) {
        if (id == null)
            return false;
        if (typeof id === 'number') {
            return true;
        }
        if (typeof id === 'string') {
            return id.length === 12 || (id.length === 24 && checkForHexRegExp.test(id));
        }
        if (id instanceof ObjectId) {
            return true;
        }
        if (buffer.Buffer.isBuffer(id) && id.length === 12) {
            return true;
        }
        // Duck-Typing detection of ObjectId like objects
        if (typeof id === 'object' && 'toHexString' in id && typeof id.toHexString === 'function') {
            if (typeof id.id === 'string') {
                return id.id.length === 12;
            }
            return id.toHexString().length === 24 && checkForHexRegExp.test(id.id.toString('hex'));
        }
        return false;
    };
    /** @internal */
    ObjectId.prototype.toExtendedJSON = function () {
        if (this.toHexString)
            return { $oid: this.toHexString() };
        return { $oid: this.toString('hex') };
    };
    /** @internal */
    ObjectId.fromExtendedJSON = function (doc) {
        return new ObjectId(doc.$oid);
    };
    /**
     * Converts to a string representation of this Id.
     *
     * @returns return the 24 character hex string representation.
     * @internal
     */
    ObjectId.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    ObjectId.prototype.inspect = function () {
        return "new ObjectId(\"" + this.toHexString() + "\")";
    };
    /** @internal */
    ObjectId.index = ~~(Math.random() * 0xffffff);
    return ObjectId;
}());
exports.ObjectId = ObjectId;
// Deprecated methods
Object.defineProperty(ObjectId.prototype, 'generate', {
    value: utils.deprecate(function (time) { return ObjectId.generate(time); }, 'Please use the static `ObjectId.generate(time)` instead')
});
Object.defineProperty(ObjectId.prototype, 'getInc', {
    value: utils.deprecate(function () { return ObjectId.getInc(); }, 'Please use the static `ObjectId.getInc()` instead')
});
Object.defineProperty(ObjectId.prototype, 'get_inc', {
    value: utils.deprecate(function () { return ObjectId.getInc(); }, 'Please use the static `ObjectId.getInc()` instead')
});
Object.defineProperty(ObjectId, 'get_inc', {
    value: utils.deprecate(function () { return ObjectId.getInc(); }, 'Please use the static `ObjectId.getInc()` instead')
});
Object.defineProperty(ObjectId.prototype, '_bsontype', { value: 'ObjectID' });
//# sourceMappingURL=objectid.js.map
});

unwrapExports(objectid);
objectid.ObjectId;

var regexp = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.BSONRegExp = void 0;
function alphabetize(str) {
    return str.split('').sort().join('');
}
/**
 * A class representation of the BSON RegExp type.
 * @public
 */
var BSONRegExp = /** @class */ (function () {
    /**
     * @param pattern - The regular expression pattern to match
     * @param options - The regular expression options
     */
    function BSONRegExp(pattern, options) {
        if (!(this instanceof BSONRegExp))
            return new BSONRegExp(pattern, options);
        this.pattern = pattern;
        this.options = options !== null && options !== void 0 ? options : '';
        // Execute
        alphabetize(this.options);
        // Validate options
        for (var i = 0; i < this.options.length; i++) {
            if (!(this.options[i] === 'i' ||
                this.options[i] === 'm' ||
                this.options[i] === 'x' ||
                this.options[i] === 'l' ||
                this.options[i] === 's' ||
                this.options[i] === 'u')) {
                throw new Error("The regular expression option [" + this.options[i] + "] is not supported");
            }
        }
    }
    BSONRegExp.parseOptions = function (options) {
        return options ? options.split('').sort().join('') : '';
    };
    /** @internal */
    BSONRegExp.prototype.toExtendedJSON = function (options) {
        options = options || {};
        if (options.legacy) {
            return { $regex: this.pattern, $options: this.options };
        }
        return { $regularExpression: { pattern: this.pattern, options: this.options } };
    };
    /** @internal */
    BSONRegExp.fromExtendedJSON = function (doc) {
        if ('$regex' in doc) {
            if (typeof doc.$regex !== 'string') {
                // This is for $regex query operators that have extended json values.
                if (doc.$regex._bsontype === 'BSONRegExp') {
                    return doc;
                }
            }
            else {
                return new BSONRegExp(doc.$regex, BSONRegExp.parseOptions(doc.$options));
            }
        }
        if ('$regularExpression' in doc) {
            return new BSONRegExp(doc.$regularExpression.pattern, BSONRegExp.parseOptions(doc.$regularExpression.options));
        }
        throw new TypeError("Unexpected BSONRegExp EJSON object form: " + JSON.stringify(doc));
    };
    return BSONRegExp;
}());
exports.BSONRegExp = BSONRegExp;
Object.defineProperty(BSONRegExp.prototype, '_bsontype', { value: 'BSONRegExp' });
//# sourceMappingURL=regexp.js.map
});

unwrapExports(regexp);
regexp.BSONRegExp;

var symbol = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.BSONSymbol = void 0;
/**
 * A class representation of the BSON Symbol type.
 * @public
 */
var BSONSymbol = /** @class */ (function () {
    /**
     * @param value - the string representing the symbol.
     */
    function BSONSymbol(value) {
        if (!(this instanceof BSONSymbol))
            return new BSONSymbol(value);
        this.value = value;
    }
    /** Access the wrapped string value. */
    BSONSymbol.prototype.valueOf = function () {
        return this.value;
    };
    /** @internal */
    BSONSymbol.prototype.toString = function () {
        return this.value;
    };
    /** @internal */
    BSONSymbol.prototype.inspect = function () {
        return "new BSONSymbol(\"" + this.value + "\")";
    };
    /** @internal */
    BSONSymbol.prototype.toJSON = function () {
        return this.value;
    };
    /** @internal */
    BSONSymbol.prototype.toExtendedJSON = function () {
        return { $symbol: this.value };
    };
    /** @internal */
    BSONSymbol.fromExtendedJSON = function (doc) {
        return new BSONSymbol(doc.$symbol);
    };
    /** @internal */
    BSONSymbol.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    return BSONSymbol;
}());
exports.BSONSymbol = BSONSymbol;
Object.defineProperty(BSONSymbol.prototype, '_bsontype', { value: 'Symbol' });
//# sourceMappingURL=symbol.js.map
});

unwrapExports(symbol);
symbol.BSONSymbol;

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

/* global Reflect, Promise */
var _extendStatics = function extendStatics(d, b) {
  _extendStatics = Object.setPrototypeOf || {
    __proto__: []
  } instanceof Array && function (d, b) {
    d.__proto__ = b;
  } || function (d, b) {
    for (var p in b) {
      if (b.hasOwnProperty(p)) d[p] = b[p];
    }
  };

  return _extendStatics(d, b);
};

function __extends(d, b) {
  _extendStatics(d, b);

  function __() {
    this.constructor = d;
  }

  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var _assign = function __assign() {
  _assign = Object.assign || function __assign(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) {
        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
      }
    }

    return t;
  };

  return _assign.apply(this, arguments);
};
function __rest(s, e) {
  var t = {};

  for (var p in s) {
    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];
  }

  if (s != null && typeof Object.getOwnPropertySymbols === "function") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];
  }
  return t;
}
function __decorate(decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if ((typeof Reflect === "undefined" ? "undefined" : babelHelpers["typeof"](Reflect)) === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {
    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  }
  return c > 3 && r && Object.defineProperty(target, key, r), r;
}
function __param(paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
}
function __metadata(metadataKey, metadataValue) {
  if ((typeof Reflect === "undefined" ? "undefined" : babelHelpers["typeof"](Reflect)) === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(metadataKey, metadataValue);
}
function __awaiter(thisArg, _arguments, P, generator) {
  function adopt(value) {
    return value instanceof P ? value : new P(function (resolve) {
      resolve(value);
    });
  }

  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
}
function __generator(thisArg, body) {
  var _ = {
    label: 0,
    sent: function sent() {
      if (t[0] & 1) throw t[1];
      return t[1];
    },
    trys: [],
    ops: []
  },
      f,
      y,
      t,
      g;
  return g = {
    next: verb(0),
    "throw": verb(1),
    "return": verb(2)
  }, typeof Symbol === "function" && (g[Symbol.iterator] = function () {
    return this;
  }), g;

  function verb(n) {
    return function (v) {
      return step([n, v]);
    };
  }

  function step(op) {
    if (f) throw new TypeError("Generator is already executing.");

    while (_) {
      try {
        if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
        if (y = 0, t) op = [op[0] & 2, t.value];

        switch (op[0]) {
          case 0:
          case 1:
            t = op;
            break;

          case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

          case 5:
            _.label++;
            y = op[1];
            op = [0];
            continue;

          case 7:
            op = _.ops.pop();

            _.trys.pop();

            continue;

          default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {
              _ = 0;
              continue;
            }

            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }

            if (op[0] === 6 && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }

            if (t && _.label < t[2]) {
              _.label = t[2];

              _.ops.push(op);

              break;
            }

            if (t[2]) _.ops.pop();

            _.trys.pop();

            continue;
        }

        op = body.call(thisArg, _);
      } catch (e) {
        op = [6, e];
        y = 0;
      } finally {
        f = t = 0;
      }
    }

    if (op[0] & 5) throw op[1];
    return {
      value: op[0] ? op[1] : void 0,
      done: true
    };
  }
}
function __createBinding(o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  o[k2] = m[k];
}
function __exportStar(m, exports) {
  for (var p in m) {
    if (p !== "default" && !exports.hasOwnProperty(p)) exports[p] = m[p];
  }
}
function __values(o) {
  var s = typeof Symbol === "function" && Symbol.iterator,
      m = s && o[s],
      i = 0;
  if (m) return m.call(o);
  if (o && typeof o.length === "number") return {
    next: function next() {
      if (o && i >= o.length) o = void 0;
      return {
        value: o && o[i++],
        done: !o
      };
    }
  };
  throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
}
function __read(o, n) {
  var m = typeof Symbol === "function" && o[Symbol.iterator];
  if (!m) return o;
  var i = m.call(o),
      r,
      ar = [],
      e;

  try {
    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {
      ar.push(r.value);
    }
  } catch (error) {
    e = {
      error: error
    };
  } finally {
    try {
      if (r && !r.done && (m = i["return"])) m.call(i);
    } finally {
      if (e) throw e.error;
    }
  }

  return ar;
}
function __spread() {
  for (var ar = [], i = 0; i < arguments.length; i++) {
    ar = ar.concat(__read(arguments[i]));
  }

  return ar;
}
function __spreadArrays() {
  for (var s = 0, i = 0, il = arguments.length; i < il; i++) {
    s += arguments[i].length;
  }

  for (var r = Array(s), k = 0, i = 0; i < il; i++) {
    for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) {
      r[k] = a[j];
    }
  }

  return r;
}
function __await(v) {
  return this instanceof __await ? (this.v = v, this) : new __await(v);
}
function __asyncGenerator(thisArg, _arguments, generator) {
  if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
  var g = generator.apply(thisArg, _arguments || []),
      i,
      q = [];
  return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () {
    return this;
  }, i;

  function verb(n) {
    if (g[n]) i[n] = function (v) {
      return new Promise(function (a, b) {
        q.push([n, v, a, b]) > 1 || resume(n, v);
      });
    };
  }

  function resume(n, v) {
    try {
      step(g[n](v));
    } catch (e) {
      settle(q[0][3], e);
    }
  }

  function step(r) {
    r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);
  }

  function fulfill(value) {
    resume("next", value);
  }

  function reject(value) {
    resume("throw", value);
  }

  function settle(f, v) {
    if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]);
  }
}
function __asyncDelegator(o) {
  var i, p;
  return i = {}, verb("next"), verb("throw", function (e) {
    throw e;
  }), verb("return"), i[Symbol.iterator] = function () {
    return this;
  }, i;

  function verb(n, f) {
    i[n] = o[n] ? function (v) {
      return (p = !p) ? {
        value: __await(o[n](v)),
        done: n === "return"
      } : f ? f(v) : v;
    } : f;
  }
}
function __asyncValues(o) {
  if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
  var m = o[Symbol.asyncIterator],
      i;
  return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () {
    return this;
  }, i);

  function verb(n) {
    i[n] = o[n] && function (v) {
      return new Promise(function (resolve, reject) {
        v = o[n](v), settle(resolve, reject, v.done, v.value);
      });
    };
  }

  function settle(resolve, reject, d, v) {
    Promise.resolve(v).then(function (v) {
      resolve({
        value: v,
        done: d
      });
    }, reject);
  }
}
function __makeTemplateObject(cooked, raw) {
  if (Object.defineProperty) {
    Object.defineProperty(cooked, "raw", {
      value: raw
    });
  } else {
    cooked.raw = raw;
  }

  return cooked;
}
function __importStar(mod) {
  if (mod && mod.__esModule) return mod;
  var result = {};
  if (mod != null) for (var k in mod) {
    if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
  }
  result["default"] = mod;
  return result;
}
function __importDefault(mod) {
  return mod && mod.__esModule ? mod : {
    "default": mod
  };
}
function __classPrivateFieldGet(receiver, privateMap) {
  if (!privateMap.has(receiver)) {
    throw new TypeError("attempted to get private field on non-instance");
  }

  return privateMap.get(receiver);
}
function __classPrivateFieldSet(receiver, privateMap, value) {
  if (!privateMap.has(receiver)) {
    throw new TypeError("attempted to set private field on non-instance");
  }

  privateMap.set(receiver, value);
  return value;
}

var tslib_es6 = /*#__PURE__*/Object.freeze({
	__proto__: null,
	__extends: __extends,
	get __assign () { return _assign; },
	__rest: __rest,
	__decorate: __decorate,
	__param: __param,
	__metadata: __metadata,
	__awaiter: __awaiter,
	__generator: __generator,
	__createBinding: __createBinding,
	__exportStar: __exportStar,
	__values: __values,
	__read: __read,
	__spread: __spread,
	__spreadArrays: __spreadArrays,
	__await: __await,
	__asyncGenerator: __asyncGenerator,
	__asyncDelegator: __asyncDelegator,
	__asyncValues: __asyncValues,
	__makeTemplateObject: __makeTemplateObject,
	__importStar: __importStar,
	__importDefault: __importDefault,
	__classPrivateFieldGet: __classPrivateFieldGet,
	__classPrivateFieldSet: __classPrivateFieldSet
});

var timestamp = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.Timestamp = exports.LongWithoutOverridesClass = void 0;


/** @public */
exports.LongWithoutOverridesClass = long_1.Long;
/** @public */
var Timestamp = /** @class */ (function (_super) {
    tslib_es6.__extends(Timestamp, _super);
    function Timestamp(low, high) {
        var _this = this;
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        ///@ts-expect-error
        if (!(_this instanceof Timestamp))
            return new Timestamp(low, high);
        if (long_1.Long.isLong(low)) {
            _this = _super.call(this, low.low, low.high, true) || this;
        }
        else {
            _this = _super.call(this, low, high, true) || this;
        }
        Object.defineProperty(_this, '_bsontype', {
            value: 'Timestamp',
            writable: false,
            configurable: false,
            enumerable: false
        });
        return _this;
    }
    Timestamp.prototype.toJSON = function () {
        return {
            $timestamp: this.toString()
        };
    };
    /** Returns a Timestamp represented by the given (32-bit) integer value. */
    Timestamp.fromInt = function (value) {
        return new Timestamp(long_1.Long.fromInt(value, true));
    };
    /** Returns a Timestamp representing the given number value, provided that it is a finite number. Otherwise, zero is returned. */
    Timestamp.fromNumber = function (value) {
        return new Timestamp(long_1.Long.fromNumber(value, true));
    };
    /**
     * Returns a Timestamp for the given high and low bits. Each is assumed to use 32 bits.
     *
     * @param lowBits - the low 32-bits.
     * @param highBits - the high 32-bits.
     */
    Timestamp.fromBits = function (lowBits, highBits) {
        return new Timestamp(lowBits, highBits);
    };
    /**
     * Returns a Timestamp from the given string, optionally using the given radix.
     *
     * @param str - the textual representation of the Timestamp.
     * @param optRadix - the radix in which the text is written.
     */
    Timestamp.fromString = function (str, optRadix) {
        return new Timestamp(long_1.Long.fromString(str, true, optRadix));
    };
    /** @internal */
    Timestamp.prototype.toExtendedJSON = function () {
        return { $timestamp: { t: this.high >>> 0, i: this.low >>> 0 } };
    };
    /** @internal */
    Timestamp.fromExtendedJSON = function (doc) {
        return new Timestamp(doc.$timestamp.i, doc.$timestamp.t);
    };
    /** @internal */
    Timestamp.prototype[Symbol.for('nodejs.util.inspect.custom')] = function () {
        return this.inspect();
    };
    Timestamp.prototype.inspect = function () {
        return "new Timestamp(" + this.getLowBits().toString() + ", " + this.getHighBits().toString() + ")";
    };
    Timestamp.MAX_VALUE = long_1.Long.MAX_UNSIGNED_VALUE;
    return Timestamp;
}(exports.LongWithoutOverridesClass));
exports.Timestamp = Timestamp;
//# sourceMappingURL=timestamp.js.map
});

unwrapExports(timestamp);
timestamp.Timestamp;
timestamp.LongWithoutOverridesClass;

var extended_json = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.EJSON = exports.isBSONType = void 0;














function isBSONType(value) {
    return (utils.isObjectLike(value) && Reflect.has(value, '_bsontype') && typeof value._bsontype === 'string');
}
exports.isBSONType = isBSONType;
// INT32 boundaries
var BSON_INT32_MAX = 0x7fffffff;
var BSON_INT32_MIN = -0x80000000;
// INT64 boundaries
var BSON_INT64_MAX = 0x7fffffffffffffff;
var BSON_INT64_MIN = -0x8000000000000000;
// all the types where we don't need to do any special processing and can just pass the EJSON
//straight to type.fromExtendedJSON
var keysToCodecs = {
    $oid: objectid.ObjectId,
    $binary: binary.Binary,
    $uuid: binary.Binary,
    $symbol: symbol.BSONSymbol,
    $numberInt: int_32.Int32,
    $numberDecimal: decimal128.Decimal128,
    $numberDouble: double_1.Double,
    $numberLong: long_1.Long,
    $minKey: min_key.MinKey,
    $maxKey: max_key.MaxKey,
    $regex: regexp.BSONRegExp,
    $regularExpression: regexp.BSONRegExp,
    $timestamp: timestamp.Timestamp
};
// eslint-disable-next-line @typescript-eslint/no-explicit-any
function deserializeValue(value, options) {
    if (options === void 0) { options = {}; }
    if (typeof value === 'number') {
        if (options.relaxed || options.legacy) {
            return value;
        }
        // if it's an integer, should interpret as smallest BSON integer
        // that can represent it exactly. (if out of range, interpret as double.)
        if (Math.floor(value) === value) {
            if (value >= BSON_INT32_MIN && value <= BSON_INT32_MAX)
                return new int_32.Int32(value);
            if (value >= BSON_INT64_MIN && value <= BSON_INT64_MAX)
                return long_1.Long.fromNumber(value);
        }
        // If the number is a non-integer or out of integer range, should interpret as BSON Double.
        return new double_1.Double(value);
    }
    // from here on out we're looking for bson types, so bail if its not an object
    if (value == null || typeof value !== 'object')
        return value;
    // upgrade deprecated undefined to null
    if (value.$undefined)
        return null;
    var keys = Object.keys(value).filter(function (k) { return k.startsWith('$') && value[k] != null; });
    for (var i = 0; i < keys.length; i++) {
        var c = keysToCodecs[keys[i]];
        if (c)
            return c.fromExtendedJSON(value, options);
    }
    if (value.$date != null) {
        var d = value.$date;
        var date = new Date();
        if (options.legacy) {
            if (typeof d === 'number')
                date.setTime(d);
            else if (typeof d === 'string')
                date.setTime(Date.parse(d));
        }
        else {
            if (typeof d === 'string')
                date.setTime(Date.parse(d));
            else if (long_1.Long.isLong(d))
                date.setTime(d.toNumber());
            else if (typeof d === 'number' && options.relaxed)
                date.setTime(d);
        }
        return date;
    }
    if (value.$code != null) {
        var copy = Object.assign({}, value);
        if (value.$scope) {
            copy.$scope = deserializeValue(value.$scope);
        }
        return code.Code.fromExtendedJSON(value);
    }
    if (value.$ref != null || value.$dbPointer != null) {
        var v = value.$ref ? value : value.$dbPointer;
        // we run into this in a "degenerate EJSON" case (with $id and $ref order flipped)
        // because of the order JSON.parse goes through the document
        if (v instanceof db_ref.DBRef)
            return v;
        var dollarKeys = Object.keys(v).filter(function (k) { return k.startsWith('$'); });
        var valid_1 = true;
        dollarKeys.forEach(function (k) {
            if (['$ref', '$id', '$db'].indexOf(k) === -1)
                valid_1 = false;
        });
        // only make DBRef if $ keys are all valid
        if (valid_1)
            return db_ref.DBRef.fromExtendedJSON(v);
    }
    return value;
}
// eslint-disable-next-line @typescript-eslint/no-explicit-any
function serializeArray(array, options) {
    return array.map(function (v) { return serializeValue(v, options); });
}
function getISOString(date) {
    var isoStr = date.toISOString();
    // we should only show milliseconds in timestamp if they're non-zero
    return date.getUTCMilliseconds() !== 0 ? isoStr : isoStr.slice(0, -5) + 'Z';
}
// eslint-disable-next-line @typescript-eslint/no-explicit-any
function serializeValue(value, options) {
    if (Array.isArray(value))
        return serializeArray(value, options);
    if (value === undefined)
        return null;
    if (value instanceof Date) {
        var dateNum = value.getTime(), 
        // is it in year range 1970-9999?
        inRange = dateNum > -1 && dateNum < 253402318800000;
        if (options.legacy) {
            return options.relaxed && inRange
                ? { $date: value.getTime() }
                : { $date: getISOString(value) };
        }
        return options.relaxed && inRange
            ? { $date: getISOString(value) }
            : { $date: { $numberLong: value.getTime().toString() } };
    }
    if (typeof value === 'number' && !options.relaxed) {
        // it's an integer
        if (Math.floor(value) === value) {
            var int32Range = value >= BSON_INT32_MIN && value <= BSON_INT32_MAX, int64Range = value >= BSON_INT64_MIN && value <= BSON_INT64_MAX;
            // interpret as being of the smallest BSON integer type that can represent the number exactly
            if (int32Range)
                return { $numberInt: value.toString() };
            if (int64Range)
                return { $numberLong: value.toString() };
        }
        return { $numberDouble: value.toString() };
    }
    if (value instanceof RegExp) {
        var flags = value.flags;
        if (flags === undefined) {
            var match = value.toString().match(/[gimuy]*$/);
            if (match) {
                flags = match[0];
            }
        }
        var rx = new regexp.BSONRegExp(value.source, flags);
        return rx.toExtendedJSON(options);
    }
    if (value != null && typeof value === 'object')
        return serializeDocument(value, options);
    return value;
}
var BSON_TYPE_MAPPINGS = {
    Binary: function (o) { return new binary.Binary(o.value(), o.sub_type); },
    Code: function (o) { return new code.Code(o.code, o.scope); },
    DBRef: function (o) { return new db_ref.DBRef(o.collection || o.namespace, o.oid, o.db, o.fields); },
    Decimal128: function (o) { return new decimal128.Decimal128(o.bytes); },
    Double: function (o) { return new double_1.Double(o.value); },
    Int32: function (o) { return new int_32.Int32(o.value); },
    Long: function (o) {
        return long_1.Long.fromBits(
        // underscore variants for 1.x backwards compatibility
        o.low != null ? o.low : o.low_, o.low != null ? o.high : o.high_, o.low != null ? o.unsigned : o.unsigned_);
    },
    MaxKey: function () { return new max_key.MaxKey(); },
    MinKey: function () { return new min_key.MinKey(); },
    ObjectID: function (o) { return new objectid.ObjectId(o); },
    ObjectId: function (o) { return new objectid.ObjectId(o); },
    BSONRegExp: function (o) { return new regexp.BSONRegExp(o.pattern, o.options); },
    Symbol: function (o) { return new symbol.BSONSymbol(o.value); },
    Timestamp: function (o) { return timestamp.Timestamp.fromBits(o.low, o.high); }
};
// eslint-disable-next-line @typescript-eslint/no-explicit-any
function serializeDocument(doc, options) {
    if (doc == null || typeof doc !== 'object')
        throw new Error('not an object instance');
    var bsontype = doc._bsontype;
    if (typeof bsontype === 'undefined') {
        // It's a regular object. Recursively serialize its property values.
        var _doc = {};
        for (var name in doc) {
            _doc[name] = serializeValue(doc[name], options);
        }
        return _doc;
    }
    else if (isBSONType(doc)) {
        // the "document" is really just a BSON type object
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        var outDoc = doc;
        if (typeof outDoc.toExtendedJSON !== 'function') {
            // There's no EJSON serialization function on the object. It's probably an
            // object created by a previous version of this library (or another library)
            // that's duck-typing objects to look like they were generated by this library).
            // Copy the object into this library's version of that type.
            var mapper = BSON_TYPE_MAPPINGS[doc._bsontype];
            if (!mapper) {
                throw new TypeError('Unrecognized or invalid _bsontype: ' + doc._bsontype);
            }
            outDoc = mapper(outDoc);
        }
        // Two BSON types may have nested objects that may need to be serialized too
        if (bsontype === 'Code' && outDoc.scope) {
            outDoc = new code.Code(outDoc.code, serializeValue(outDoc.scope, options));
        }
        else if (bsontype === 'DBRef' && outDoc.oid) {
            outDoc = new db_ref.DBRef(outDoc.collection, serializeValue(outDoc.oid, options), outDoc.db, outDoc.fields);
        }
        return outDoc.toExtendedJSON(options);
    }
    else {
        throw new Error('_bsontype must be a string, but was: ' + typeof bsontype);
    }
}
(function (EJSON) {
    /**
     * Parse an Extended JSON string, constructing the JavaScript value or object described by that
     * string.
     *
     * @example
     * ```js
     * const { EJSON } = require('bson');
     * const text = '{ "int32": { "$numberInt": "10" } }';
     *
     * // prints { int32: { [String: '10'] _bsontype: 'Int32', value: '10' } }
     * console.log(EJSON.parse(text, { relaxed: false }));
     *
     * // prints { int32: 10 }
     * console.log(EJSON.parse(text));
     * ```
     */
    function parse(text, options) {
        var finalOptions = Object.assign({}, { relaxed: true, legacy: false }, options);
        // relaxed implies not strict
        if (typeof finalOptions.relaxed === 'boolean')
            finalOptions.strict = !finalOptions.relaxed;
        if (typeof finalOptions.strict === 'boolean')
            finalOptions.relaxed = !finalOptions.strict;
        return JSON.parse(text, function (_key, value) { return deserializeValue(value, finalOptions); });
    }
    EJSON.parse = parse;
    /**
     * Converts a BSON document to an Extended JSON string, optionally replacing values if a replacer
     * function is specified or optionally including only the specified properties if a replacer array
     * is specified.
     *
     * @param value - The value to convert to extended JSON
     * @param replacer - A function that alters the behavior of the stringification process, or an array of String and Number objects that serve as a whitelist for selecting/filtering the properties of the value object to be included in the JSON string. If this value is null or not provided, all properties of the object are included in the resulting JSON string
     * @param space - A String or Number object that's used to insert white space into the output JSON string for readability purposes.
     * @param options - Optional settings
     *
     * @example
     * ```js
     * const { EJSON } = require('bson');
     * const Int32 = require('mongodb').Int32;
     * const doc = { int32: new Int32(10) };
     *
     * // prints '{"int32":{"$numberInt":"10"}}'
     * console.log(EJSON.stringify(doc, { relaxed: false }));
     *
     * // prints '{"int32":10}'
     * console.log(EJSON.stringify(doc));
     * ```
     */
    function stringify(value, 
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    replacer, space, options) {
        if (space != null && typeof space === 'object') {
            options = space;
            space = 0;
        }
        if (replacer != null && typeof replacer === 'object' && !Array.isArray(replacer)) {
            options = replacer;
            replacer = undefined;
            space = 0;
        }
        options = Object.assign({}, { relaxed: true, legacy: false }, options);
        var doc = serializeValue(value, options);
        return JSON.stringify(doc, replacer, space);
    }
    EJSON.stringify = stringify;
    /**
     * Serializes an object to an Extended JSON string, and reparse it as a JavaScript object.
     *
     * @param value - The object to serialize
     * @param options - Optional settings passed to the `stringify` function
     */
    function serialize(value, options) {
        options = options || {};
        return JSON.parse(stringify(value, options));
    }
    EJSON.serialize = serialize;
    /**
     * Deserializes an Extended JSON object into a plain JavaScript object with native/BSON types
     *
     * @param ejson - The Extended JSON object to deserialize
     * @param options - Optional settings passed to the parse method
     */
    function deserialize(ejson, options) {
        options = options || {};
        return parse(JSON.stringify(ejson), options);
    }
    EJSON.deserialize = deserialize;
})(exports.EJSON || (exports.EJSON = {}));
//# sourceMappingURL=extended_json.js.map
});

unwrapExports(extended_json);
extended_json.EJSON;
extended_json.isBSONType;

var bson_browser_esm_map = createCommonjsModule(function (module, exports) {
/* eslint-disable @typescript-eslint/no-explicit-any */
// We have an ES6 Map available, return the native instance
Object.defineProperty(exports, "__esModule", { value: true });
exports.Map = void 0;
/** @public */
var bsonMap;
exports.Map = bsonMap;
var check = function (potentialGlobal) {
    // eslint-disable-next-line eqeqeq
    return potentialGlobal && potentialGlobal.Math == Math && potentialGlobal;
};
// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028
function getGlobal() {
    // eslint-disable-next-line no-undef
    return (check(typeof globalThis === 'object' && globalThis) ||
        check(typeof window === 'object' && window) ||
        check(typeof self === 'object' && self) ||
        check(typeof commonjsGlobal === 'object' && commonjsGlobal) ||
        Function('return this')());
}
var bsonGlobal = getGlobal();
if (Object.prototype.hasOwnProperty.call(bsonGlobal, 'Map')) {
    exports.Map = bsonMap = bsonGlobal.Map;
}
else {
    // We will return a polyfill
    exports.Map = bsonMap = /** @class */ (function () {
        function Map(array) {
            if (array === void 0) { array = []; }
            this._keys = [];
            this._values = {};
            for (var i = 0; i < array.length; i++) {
                if (array[i] == null)
                    continue; // skip null and undefined
                var entry = array[i];
                var key = entry[0];
                var value = entry[1];
                // Add the key to the list of keys in order
                this._keys.push(key);
                // Add the key and value to the values dictionary with a point
                // to the location in the ordered keys list
                this._values[key] = { v: value, i: this._keys.length - 1 };
            }
        }
        Map.prototype.clear = function () {
            this._keys = [];
            this._values = {};
        };
        Map.prototype.delete = function (key) {
            var value = this._values[key];
            if (value == null)
                return false;
            // Delete entry
            delete this._values[key];
            // Remove the key from the ordered keys list
            this._keys.splice(value.i, 1);
            return true;
        };
        Map.prototype.entries = function () {
            var _this = this;
            var index = 0;
            return {
                next: function () {
                    var key = _this._keys[index++];
                    return {
                        value: key !== undefined ? [key, _this._values[key].v] : undefined,
                        done: key !== undefined ? false : true
                    };
                }
            };
        };
        Map.prototype.forEach = function (callback, self) {
            self = self || this;
            for (var i = 0; i < this._keys.length; i++) {
                var key = this._keys[i];
                // Call the forEach callback
                callback.call(self, this._values[key].v, key, self);
            }
        };
        Map.prototype.get = function (key) {
            return this._values[key] ? this._values[key].v : undefined;
        };
        Map.prototype.has = function (key) {
            return this._values[key] != null;
        };
        Map.prototype.keys = function () {
            var _this = this;
            var index = 0;
            return {
                next: function () {
                    var key = _this._keys[index++];
                    return {
                        value: key !== undefined ? key : undefined,
                        done: key !== undefined ? false : true
                    };
                }
            };
        };
        Map.prototype.set = function (key, value) {
            if (this._values[key]) {
                this._values[key].v = value;
                return this;
            }
            // Add the key to the list of keys in order
            this._keys.push(key);
            // Add the key and value to the values dictionary with a point
            // to the location in the ordered keys list
            this._values[key] = { v: value, i: this._keys.length - 1 };
            return this;
        };
        Map.prototype.values = function () {
            var _this = this;
            var index = 0;
            return {
                next: function () {
                    var key = _this._keys[index++];
                    return {
                        value: key !== undefined ? _this._values[key].v : undefined,
                        done: key !== undefined ? false : true
                    };
                }
            };
        };
        Object.defineProperty(Map.prototype, "size", {
            get: function () {
                return this._keys.length;
            },
            enumerable: false,
            configurable: true
        });
        return Map;
    }());
}
//# sourceMappingURL=map.js.map
});

unwrapExports(bson_browser_esm_map);
bson_browser_esm_map.Map;

var constants = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.BSON_BINARY_SUBTYPE_USER_DEFINED = exports.BSON_BINARY_SUBTYPE_MD5 = exports.BSON_BINARY_SUBTYPE_UUID_NEW = exports.BSON_BINARY_SUBTYPE_UUID = exports.BSON_BINARY_SUBTYPE_BYTE_ARRAY = exports.BSON_BINARY_SUBTYPE_FUNCTION = exports.BSON_BINARY_SUBTYPE_DEFAULT = exports.BSON_DATA_MAX_KEY = exports.BSON_DATA_MIN_KEY = exports.BSON_DATA_DECIMAL128 = exports.BSON_DATA_LONG = exports.BSON_DATA_TIMESTAMP = exports.BSON_DATA_INT = exports.BSON_DATA_CODE_W_SCOPE = exports.BSON_DATA_SYMBOL = exports.BSON_DATA_CODE = exports.BSON_DATA_DBPOINTER = exports.BSON_DATA_REGEXP = exports.BSON_DATA_NULL = exports.BSON_DATA_DATE = exports.BSON_DATA_BOOLEAN = exports.BSON_DATA_OID = exports.BSON_DATA_UNDEFINED = exports.BSON_DATA_BINARY = exports.BSON_DATA_ARRAY = exports.BSON_DATA_OBJECT = exports.BSON_DATA_STRING = exports.BSON_DATA_NUMBER = exports.JS_INT_MIN = exports.JS_INT_MAX = exports.BSON_INT64_MIN = exports.BSON_INT64_MAX = exports.BSON_INT32_MIN = exports.BSON_INT32_MAX = void 0;
/** @internal */
exports.BSON_INT32_MAX = 0x7fffffff;
/** @internal */
exports.BSON_INT32_MIN = -0x80000000;
/** @internal */
exports.BSON_INT64_MAX = Math.pow(2, 63) - 1;
/** @internal */
exports.BSON_INT64_MIN = -Math.pow(2, 63);
/**
 * Any integer up to 2^53 can be precisely represented by a double.
 * @internal
 */
exports.JS_INT_MAX = Math.pow(2, 53);
/**
 * Any integer down to -2^53 can be precisely represented by a double.
 * @internal
 */
exports.JS_INT_MIN = -Math.pow(2, 53);
/** Number BSON Type @internal */
exports.BSON_DATA_NUMBER = 1;
/** String BSON Type @internal */
exports.BSON_DATA_STRING = 2;
/** Object BSON Type @internal */
exports.BSON_DATA_OBJECT = 3;
/** Array BSON Type @internal */
exports.BSON_DATA_ARRAY = 4;
/** Binary BSON Type @internal */
exports.BSON_DATA_BINARY = 5;
/** Binary BSON Type @internal */
exports.BSON_DATA_UNDEFINED = 6;
/** ObjectId BSON Type @internal */
exports.BSON_DATA_OID = 7;
/** Boolean BSON Type @internal */
exports.BSON_DATA_BOOLEAN = 8;
/** Date BSON Type @internal */
exports.BSON_DATA_DATE = 9;
/** null BSON Type @internal */
exports.BSON_DATA_NULL = 10;
/** RegExp BSON Type @internal */
exports.BSON_DATA_REGEXP = 11;
/** Code BSON Type @internal */
exports.BSON_DATA_DBPOINTER = 12;
/** Code BSON Type @internal */
exports.BSON_DATA_CODE = 13;
/** Symbol BSON Type @internal */
exports.BSON_DATA_SYMBOL = 14;
/** Code with Scope BSON Type @internal */
exports.BSON_DATA_CODE_W_SCOPE = 15;
/** 32 bit Integer BSON Type @internal */
exports.BSON_DATA_INT = 16;
/** Timestamp BSON Type @internal */
exports.BSON_DATA_TIMESTAMP = 17;
/** Long BSON Type @internal */
exports.BSON_DATA_LONG = 18;
/** Decimal128 BSON Type @internal */
exports.BSON_DATA_DECIMAL128 = 19;
/** MinKey BSON Type @internal */
exports.BSON_DATA_MIN_KEY = 0xff;
/** MaxKey BSON Type @internal */
exports.BSON_DATA_MAX_KEY = 0x7f;
/** Binary Default Type @internal */
exports.BSON_BINARY_SUBTYPE_DEFAULT = 0;
/** Binary Function Type @internal */
exports.BSON_BINARY_SUBTYPE_FUNCTION = 1;
/** Binary Byte Array Type @internal */
exports.BSON_BINARY_SUBTYPE_BYTE_ARRAY = 2;
/** Binary Deprecated UUID Type @deprecated Please use BSON_BINARY_SUBTYPE_UUID_NEW @internal */
exports.BSON_BINARY_SUBTYPE_UUID = 3;
/** Binary UUID Type @internal */
exports.BSON_BINARY_SUBTYPE_UUID_NEW = 4;
/** Binary MD5 Type @internal */
exports.BSON_BINARY_SUBTYPE_MD5 = 5;
/** Binary User Defined Type @internal */
exports.BSON_BINARY_SUBTYPE_USER_DEFINED = 128;
//# sourceMappingURL=constants.js.map
});

unwrapExports(constants);
constants.BSON_BINARY_SUBTYPE_USER_DEFINED;
constants.BSON_BINARY_SUBTYPE_MD5;
constants.BSON_BINARY_SUBTYPE_UUID_NEW;
constants.BSON_BINARY_SUBTYPE_UUID;
constants.BSON_BINARY_SUBTYPE_BYTE_ARRAY;
constants.BSON_BINARY_SUBTYPE_FUNCTION;
constants.BSON_BINARY_SUBTYPE_DEFAULT;
constants.BSON_DATA_MAX_KEY;
constants.BSON_DATA_MIN_KEY;
constants.BSON_DATA_DECIMAL128;
constants.BSON_DATA_LONG;
constants.BSON_DATA_TIMESTAMP;
constants.BSON_DATA_INT;
constants.BSON_DATA_CODE_W_SCOPE;
constants.BSON_DATA_SYMBOL;
constants.BSON_DATA_CODE;
constants.BSON_DATA_DBPOINTER;
constants.BSON_DATA_REGEXP;
constants.BSON_DATA_NULL;
constants.BSON_DATA_DATE;
constants.BSON_DATA_BOOLEAN;
constants.BSON_DATA_OID;
constants.BSON_DATA_UNDEFINED;
constants.BSON_DATA_BINARY;
constants.BSON_DATA_ARRAY;
constants.BSON_DATA_OBJECT;
constants.BSON_DATA_STRING;
constants.BSON_DATA_NUMBER;
constants.JS_INT_MIN;
constants.JS_INT_MAX;
constants.BSON_INT64_MIN;
constants.BSON_INT64_MAX;
constants.BSON_INT32_MIN;
constants.BSON_INT32_MAX;

var calculate_size = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateObjectSize = void 0;




function calculateObjectSize(object, serializeFunctions, ignoreUndefined) {
    var totalLength = 4 + 1;
    if (Array.isArray(object)) {
        for (var i = 0; i < object.length; i++) {
            totalLength += calculateElement(i.toString(), object[i], serializeFunctions, true, ignoreUndefined);
        }
    }
    else {
        // If we have toBSON defined, override the current object
        if (object.toBSON) {
            object = object.toBSON();
        }
        // Calculate size
        for (var key in object) {
            totalLength += calculateElement(key, object[key], serializeFunctions, false, ignoreUndefined);
        }
    }
    return totalLength;
}
exports.calculateObjectSize = calculateObjectSize;
/** @internal */
function calculateElement(name, 
// eslint-disable-next-line @typescript-eslint/no-explicit-any
value, serializeFunctions, isArray, ignoreUndefined) {
    if (serializeFunctions === void 0) { serializeFunctions = false; }
    if (isArray === void 0) { isArray = false; }
    if (ignoreUndefined === void 0) { ignoreUndefined = false; }
    // If we have toBSON defined, override the current object
    if (value && value.toBSON) {
        value = value.toBSON();
    }
    switch (typeof value) {
        case 'string':
            return 1 + buffer.Buffer.byteLength(name, 'utf8') + 1 + 4 + buffer.Buffer.byteLength(value, 'utf8') + 1;
        case 'number':
            if (Math.floor(value) === value &&
                value >= constants.JS_INT_MIN &&
                value <= constants.JS_INT_MAX) {
                if (value >= constants.BSON_INT32_MIN && value <= constants.BSON_INT32_MAX) {
                    // 32 bit
                    return (name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) + (4 + 1);
                }
                else {
                    return (name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) + (8 + 1);
                }
            }
            else {
                // 64 bit
                return (name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) + (8 + 1);
            }
        case 'undefined':
            if (isArray || !ignoreUndefined)
                return (name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) + 1;
            return 0;
        case 'boolean':
            return (name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) + (1 + 1);
        case 'object':
            if (value == null || value['_bsontype'] === 'MinKey' || value['_bsontype'] === 'MaxKey') {
                return (name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) + 1;
            }
            else if (value['_bsontype'] === 'ObjectId' || value['_bsontype'] === 'ObjectID') {
                return (name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) + (12 + 1);
            }
            else if (value instanceof Date || utils.isDate(value)) {
                return (name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) + (8 + 1);
            }
            else if (ArrayBuffer.isView(value) || value instanceof ArrayBuffer) {
                return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) + (1 + 4 + 1) + value.byteLength);
            }
            else if (value['_bsontype'] === 'Long' ||
                value['_bsontype'] === 'Double' ||
                value['_bsontype'] === 'Timestamp') {
                return (name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) + (8 + 1);
            }
            else if (value['_bsontype'] === 'Decimal128') {
                return (name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) + (16 + 1);
            }
            else if (value['_bsontype'] === 'Code') {
                // Calculate size depending on the availability of a scope
                if (value.scope != null && Object.keys(value.scope).length > 0) {
                    return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) +
                        1 +
                        4 +
                        4 +
                        buffer.Buffer.byteLength(value.code.toString(), 'utf8') +
                        1 +
                        calculateObjectSize(value.scope, serializeFunctions, ignoreUndefined));
                }
                else {
                    return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) +
                        1 +
                        4 +
                        buffer.Buffer.byteLength(value.code.toString(), 'utf8') +
                        1);
                }
            }
            else if (value['_bsontype'] === 'Binary') {
                // Check what kind of subtype we have
                if (value.sub_type === binary.Binary.SUBTYPE_BYTE_ARRAY) {
                    return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) +
                        (value.position + 1 + 4 + 1 + 4));
                }
                else {
                    return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) + (value.position + 1 + 4 + 1));
                }
            }
            else if (value['_bsontype'] === 'Symbol') {
                return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) +
                    buffer.Buffer.byteLength(value.value, 'utf8') +
                    4 +
                    1 +
                    1);
            }
            else if (value['_bsontype'] === 'DBRef') {
                // Set up correct object for serialization
                var ordered_values = Object.assign({
                    $ref: value.collection,
                    $id: value.oid
                }, value.fields);
                // Add db reference if it exists
                if (value.db != null) {
                    ordered_values['$db'] = value.db;
                }
                return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) +
                    1 +
                    calculateObjectSize(ordered_values, serializeFunctions, ignoreUndefined));
            }
            else if (value instanceof RegExp ||
                Object.prototype.toString.call(value) === '[object RegExp]') {
                return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) +
                    1 +
                    buffer.Buffer.byteLength(value.source, 'utf8') +
                    1 +
                    (value.global ? 1 : 0) +
                    (value.ignoreCase ? 1 : 0) +
                    (value.multiline ? 1 : 0) +
                    1);
            }
            else if (value['_bsontype'] === 'BSONRegExp') {
                return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) +
                    1 +
                    buffer.Buffer.byteLength(value.pattern, 'utf8') +
                    1 +
                    buffer.Buffer.byteLength(value.options, 'utf8') +
                    1);
            }
            else {
                return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) +
                    calculateObjectSize(value, serializeFunctions, ignoreUndefined) +
                    1);
            }
        case 'function':
            // WTF for 0.4.X where typeof /someregexp/ === 'function'
            if (value instanceof RegExp ||
                Object.prototype.toString.call(value) === '[object RegExp]' ||
                String.call(value) === '[object RegExp]') {
                return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) +
                    1 +
                    buffer.Buffer.byteLength(value.source, 'utf8') +
                    1 +
                    (value.global ? 1 : 0) +
                    (value.ignoreCase ? 1 : 0) +
                    (value.multiline ? 1 : 0) +
                    1);
            }
            else {
                if (serializeFunctions && value.scope != null && Object.keys(value.scope).length > 0) {
                    return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) +
                        1 +
                        4 +
                        4 +
                        buffer.Buffer.byteLength(utils.normalizedFunctionString(value), 'utf8') +
                        1 +
                        calculateObjectSize(value.scope, serializeFunctions, ignoreUndefined));
                }
                else if (serializeFunctions) {
                    return ((name != null ? buffer.Buffer.byteLength(name, 'utf8') + 1 : 0) +
                        1 +
                        4 +
                        buffer.Buffer.byteLength(utils.normalizedFunctionString(value), 'utf8') +
                        1);
                }
            }
    }
    return 0;
}
//# sourceMappingURL=calculate_size.js.map
});

unwrapExports(calculate_size);
calculate_size.calculateObjectSize;

var validate_utf8 = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateUtf8 = void 0;
var FIRST_BIT = 0x80;
var FIRST_TWO_BITS = 0xc0;
var FIRST_THREE_BITS = 0xe0;
var FIRST_FOUR_BITS = 0xf0;
var FIRST_FIVE_BITS = 0xf8;
var TWO_BIT_CHAR = 0xc0;
var THREE_BIT_CHAR = 0xe0;
var FOUR_BIT_CHAR = 0xf0;
var CONTINUING_CHAR = 0x80;
/**
 * Determines if the passed in bytes are valid utf8
 * @param bytes - An array of 8-bit bytes. Must be indexable and have length property
 * @param start - The index to start validating
 * @param end - The index to end validating
 */
function validateUtf8(bytes, start, end) {
    var continuation = 0;
    for (var i = start; i < end; i += 1) {
        var byte = bytes[i];
        if (continuation) {
            if ((byte & FIRST_TWO_BITS) !== CONTINUING_CHAR) {
                return false;
            }
            continuation -= 1;
        }
        else if (byte & FIRST_BIT) {
            if ((byte & FIRST_THREE_BITS) === TWO_BIT_CHAR) {
                continuation = 1;
            }
            else if ((byte & FIRST_FOUR_BITS) === THREE_BIT_CHAR) {
                continuation = 2;
            }
            else if ((byte & FIRST_FIVE_BITS) === FOUR_BIT_CHAR) {
                continuation = 3;
            }
            else {
                return false;
            }
        }
    }
    return !continuation;
}
exports.validateUtf8 = validateUtf8;
//# sourceMappingURL=validate_utf8.js.map
});

unwrapExports(validate_utf8);
validate_utf8.validateUtf8;

var deserializer = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.deserialize = void 0;
















// Internal long versions
var JS_INT_MAX_LONG = long_1.Long.fromNumber(constants.JS_INT_MAX);
var JS_INT_MIN_LONG = long_1.Long.fromNumber(constants.JS_INT_MIN);
var functionCache = {};
function deserialize(buffer, options, isArray) {
    options = options == null ? {} : options;
    var index = options && options.index ? options.index : 0;
    // Read the document size
    var size = buffer[index] |
        (buffer[index + 1] << 8) |
        (buffer[index + 2] << 16) |
        (buffer[index + 3] << 24);
    if (size < 5) {
        throw new Error("bson size must be >= 5, is " + size);
    }
    if (options.allowObjectSmallerThanBufferSize && buffer.length < size) {
        throw new Error("buffer length " + buffer.length + " must be >= bson size " + size);
    }
    if (!options.allowObjectSmallerThanBufferSize && buffer.length !== size) {
        throw new Error("buffer length " + buffer.length + " must === bson size " + size);
    }
    if (size + index > buffer.byteLength) {
        throw new Error("(bson size " + size + " + options.index " + index + " must be <= buffer length " + buffer.byteLength + ")");
    }
    // Illegal end value
    if (buffer[index + size - 1] !== 0) {
        throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");
    }
    // Start deserializtion
    return deserializeObject(buffer, index, options, isArray);
}
exports.deserialize = deserialize;
function deserializeObject(buffer$1, index, options, isArray) {
    if (isArray === void 0) { isArray = false; }
    var evalFunctions = options['evalFunctions'] == null ? false : options['evalFunctions'];
    var cacheFunctions = options['cacheFunctions'] == null ? false : options['cacheFunctions'];
    var fieldsAsRaw = options['fieldsAsRaw'] == null ? null : options['fieldsAsRaw'];
    // Return raw bson buffer instead of parsing it
    var raw = options['raw'] == null ? false : options['raw'];
    // Return BSONRegExp objects instead of native regular expressions
    var bsonRegExp = typeof options['bsonRegExp'] === 'boolean' ? options['bsonRegExp'] : false;
    // Controls the promotion of values vs wrapper classes
    var promoteBuffers = options['promoteBuffers'] == null ? false : options['promoteBuffers'];
    var promoteLongs = options['promoteLongs'] == null ? true : options['promoteLongs'];
    var promoteValues = options['promoteValues'] == null ? true : options['promoteValues'];
    // Set the start index
    var startIndex = index;
    // Validate that we have at least 4 bytes of buffer
    if (buffer$1.length < 5)
        throw new Error('corrupt bson message < 5 bytes long');
    // Read the document size
    var size = buffer$1[index++] | (buffer$1[index++] << 8) | (buffer$1[index++] << 16) | (buffer$1[index++] << 24);
    // Ensure buffer is valid size
    if (size < 5 || size > buffer$1.length)
        throw new Error('corrupt bson message');
    // Create holding object
    var object = isArray ? [] : {};
    // Used for arrays to skip having to perform utf8 decoding
    var arrayIndex = 0;
    var done = false;
    // While we have more left data left keep parsing
    while (!done) {
        // Read the type
        var elementType = buffer$1[index++];
        // If we get a zero it's the last byte, exit
        if (elementType === 0)
            break;
        // Get the start search index
        var i = index;
        // Locate the end of the c string
        while (buffer$1[i] !== 0x00 && i < buffer$1.length) {
            i++;
        }
        // If are at the end of the buffer there is a problem with the document
        if (i >= buffer$1.byteLength)
            throw new Error('Bad BSON Document: illegal CString');
        var name = isArray ? arrayIndex++ : buffer$1.toString('utf8', index, i);
        index = i + 1;
        if (elementType === constants.BSON_DATA_STRING) {
            var stringSize = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            if (stringSize <= 0 ||
                stringSize > buffer$1.length - index ||
                buffer$1[index + stringSize - 1] !== 0)
                throw new Error('bad string length in bson');
            if (!validate_utf8.validateUtf8(buffer$1, index, index + stringSize - 1)) {
                throw new Error('Invalid UTF-8 string in BSON document');
            }
            var s = buffer$1.toString('utf8', index, index + stringSize - 1);
            object[name] = s;
            index = index + stringSize;
        }
        else if (elementType === constants.BSON_DATA_OID) {
            var oid = buffer.Buffer.alloc(12);
            buffer$1.copy(oid, 0, index, index + 12);
            object[name] = new objectid.ObjectId(oid);
            index = index + 12;
        }
        else if (elementType === constants.BSON_DATA_INT && promoteValues === false) {
            object[name] = new int_32.Int32(buffer$1[index++] | (buffer$1[index++] << 8) | (buffer$1[index++] << 16) | (buffer$1[index++] << 24));
        }
        else if (elementType === constants.BSON_DATA_INT) {
            object[name] =
                buffer$1[index++] |
                    (buffer$1[index++] << 8) |
                    (buffer$1[index++] << 16) |
                    (buffer$1[index++] << 24);
        }
        else if (elementType === constants.BSON_DATA_NUMBER && promoteValues === false) {
            object[name] = new double_1.Double(buffer$1.readDoubleLE(index));
            index = index + 8;
        }
        else if (elementType === constants.BSON_DATA_NUMBER) {
            object[name] = buffer$1.readDoubleLE(index);
            index = index + 8;
        }
        else if (elementType === constants.BSON_DATA_DATE) {
            var lowBits = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            var highBits = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            object[name] = new Date(new long_1.Long(lowBits, highBits).toNumber());
        }
        else if (elementType === constants.BSON_DATA_BOOLEAN) {
            if (buffer$1[index] !== 0 && buffer$1[index] !== 1)
                throw new Error('illegal boolean type value');
            object[name] = buffer$1[index++] === 1;
        }
        else if (elementType === constants.BSON_DATA_OBJECT) {
            var _index = index;
            var objectSize = buffer$1[index] |
                (buffer$1[index + 1] << 8) |
                (buffer$1[index + 2] << 16) |
                (buffer$1[index + 3] << 24);
            if (objectSize <= 0 || objectSize > buffer$1.length - index)
                throw new Error('bad embedded document length in bson');
            // We have a raw value
            if (raw) {
                object[name] = buffer$1.slice(index, index + objectSize);
            }
            else {
                object[name] = deserializeObject(buffer$1, _index, options, false);
            }
            index = index + objectSize;
        }
        else if (elementType === constants.BSON_DATA_ARRAY) {
            var _index = index;
            var objectSize = buffer$1[index] |
                (buffer$1[index + 1] << 8) |
                (buffer$1[index + 2] << 16) |
                (buffer$1[index + 3] << 24);
            var arrayOptions = options;
            // Stop index
            var stopIndex = index + objectSize;
            // All elements of array to be returned as raw bson
            if (fieldsAsRaw && fieldsAsRaw[name]) {
                arrayOptions = {};
                for (var n in options) {
                    arrayOptions[n] = options[n];
                }
                arrayOptions['raw'] = true;
            }
            object[name] = deserializeObject(buffer$1, _index, arrayOptions, true);
            index = index + objectSize;
            if (buffer$1[index - 1] !== 0)
                throw new Error('invalid array terminator byte');
            if (index !== stopIndex)
                throw new Error('corrupted array bson');
        }
        else if (elementType === constants.BSON_DATA_UNDEFINED) {
            object[name] = undefined;
        }
        else if (elementType === constants.BSON_DATA_NULL) {
            object[name] = null;
        }
        else if (elementType === constants.BSON_DATA_LONG) {
            // Unpack the low and high bits
            var lowBits = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            var highBits = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            var long = new long_1.Long(lowBits, highBits);
            // Promote the long if possible
            if (promoteLongs && promoteValues === true) {
                object[name] =
                    long.lessThanOrEqual(JS_INT_MAX_LONG) && long.greaterThanOrEqual(JS_INT_MIN_LONG)
                        ? long.toNumber()
                        : long;
            }
            else {
                object[name] = long;
            }
        }
        else if (elementType === constants.BSON_DATA_DECIMAL128) {
            // Buffer to contain the decimal bytes
            var bytes = buffer.Buffer.alloc(16);
            // Copy the next 16 bytes into the bytes buffer
            buffer$1.copy(bytes, 0, index, index + 16);
            // Update index
            index = index + 16;
            // Assign the new Decimal128 value
            var decimal128$1 = new decimal128.Decimal128(bytes);
            // If we have an alternative mapper use that
            if ('toObject' in decimal128$1 && typeof decimal128$1.toObject === 'function') {
                object[name] = decimal128$1.toObject();
            }
            else {
                object[name] = decimal128$1;
            }
        }
        else if (elementType === constants.BSON_DATA_BINARY) {
            var binarySize = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            var totalBinarySize = binarySize;
            var subType = buffer$1[index++];
            // Did we have a negative binary size, throw
            if (binarySize < 0)
                throw new Error('Negative binary type element size found');
            // Is the length longer than the document
            if (binarySize > buffer$1.byteLength)
                throw new Error('Binary type size larger than document size');
            // Decode as raw Buffer object if options specifies it
            if (buffer$1['slice'] != null) {
                // If we have subtype 2 skip the 4 bytes for the size
                if (subType === binary.Binary.SUBTYPE_BYTE_ARRAY) {
                    binarySize =
                        buffer$1[index++] |
                            (buffer$1[index++] << 8) |
                            (buffer$1[index++] << 16) |
                            (buffer$1[index++] << 24);
                    if (binarySize < 0)
                        throw new Error('Negative binary type element size found for subtype 0x02');
                    if (binarySize > totalBinarySize - 4)
                        throw new Error('Binary type with subtype 0x02 contains too long binary size');
                    if (binarySize < totalBinarySize - 4)
                        throw new Error('Binary type with subtype 0x02 contains too short binary size');
                }
                if (promoteBuffers && promoteValues) {
                    object[name] = buffer$1.slice(index, index + binarySize);
                }
                else {
                    object[name] = new binary.Binary(buffer$1.slice(index, index + binarySize), subType);
                }
            }
            else {
                var _buffer = buffer.Buffer.alloc(binarySize);
                // If we have subtype 2 skip the 4 bytes for the size
                if (subType === binary.Binary.SUBTYPE_BYTE_ARRAY) {
                    binarySize =
                        buffer$1[index++] |
                            (buffer$1[index++] << 8) |
                            (buffer$1[index++] << 16) |
                            (buffer$1[index++] << 24);
                    if (binarySize < 0)
                        throw new Error('Negative binary type element size found for subtype 0x02');
                    if (binarySize > totalBinarySize - 4)
                        throw new Error('Binary type with subtype 0x02 contains too long binary size');
                    if (binarySize < totalBinarySize - 4)
                        throw new Error('Binary type with subtype 0x02 contains too short binary size');
                }
                // Copy the data
                for (i = 0; i < binarySize; i++) {
                    _buffer[i] = buffer$1[index + i];
                }
                if (promoteBuffers && promoteValues) {
                    object[name] = _buffer;
                }
                else {
                    object[name] = new binary.Binary(_buffer, subType);
                }
            }
            // Update the index
            index = index + binarySize;
        }
        else if (elementType === constants.BSON_DATA_REGEXP && bsonRegExp === false) {
            // Get the start search index
            i = index;
            // Locate the end of the c string
            while (buffer$1[i] !== 0x00 && i < buffer$1.length) {
                i++;
            }
            // If are at the end of the buffer there is a problem with the document
            if (i >= buffer$1.length)
                throw new Error('Bad BSON Document: illegal CString');
            // Return the C string
            var source = buffer$1.toString('utf8', index, i);
            // Create the regexp
            index = i + 1;
            // Get the start search index
            i = index;
            // Locate the end of the c string
            while (buffer$1[i] !== 0x00 && i < buffer$1.length) {
                i++;
            }
            // If are at the end of the buffer there is a problem with the document
            if (i >= buffer$1.length)
                throw new Error('Bad BSON Document: illegal CString');
            // Return the C string
            var regExpOptions = buffer$1.toString('utf8', index, i);
            index = i + 1;
            // For each option add the corresponding one for javascript
            var optionsArray = new Array(regExpOptions.length);
            // Parse options
            for (i = 0; i < regExpOptions.length; i++) {
                switch (regExpOptions[i]) {
                    case 'm':
                        optionsArray[i] = 'm';
                        break;
                    case 's':
                        optionsArray[i] = 'g';
                        break;
                    case 'i':
                        optionsArray[i] = 'i';
                        break;
                }
            }
            object[name] = new RegExp(source, optionsArray.join(''));
        }
        else if (elementType === constants.BSON_DATA_REGEXP && bsonRegExp === true) {
            // Get the start search index
            i = index;
            // Locate the end of the c string
            while (buffer$1[i] !== 0x00 && i < buffer$1.length) {
                i++;
            }
            // If are at the end of the buffer there is a problem with the document
            if (i >= buffer$1.length)
                throw new Error('Bad BSON Document: illegal CString');
            // Return the C string
            var source = buffer$1.toString('utf8', index, i);
            index = i + 1;
            // Get the start search index
            i = index;
            // Locate the end of the c string
            while (buffer$1[i] !== 0x00 && i < buffer$1.length) {
                i++;
            }
            // If are at the end of the buffer there is a problem with the document
            if (i >= buffer$1.length)
                throw new Error('Bad BSON Document: illegal CString');
            // Return the C string
            var regExpOptions = buffer$1.toString('utf8', index, i);
            index = i + 1;
            // Set the object
            object[name] = new regexp.BSONRegExp(source, regExpOptions);
        }
        else if (elementType === constants.BSON_DATA_SYMBOL) {
            var stringSize = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            if (stringSize <= 0 ||
                stringSize > buffer$1.length - index ||
                buffer$1[index + stringSize - 1] !== 0)
                throw new Error('bad string length in bson');
            var symbol$1 = buffer$1.toString('utf8', index, index + stringSize - 1);
            object[name] = promoteValues ? symbol$1 : new symbol.BSONSymbol(symbol$1);
            index = index + stringSize;
        }
        else if (elementType === constants.BSON_DATA_TIMESTAMP) {
            var lowBits = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            var highBits = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            object[name] = new timestamp.Timestamp(lowBits, highBits);
        }
        else if (elementType === constants.BSON_DATA_MIN_KEY) {
            object[name] = new min_key.MinKey();
        }
        else if (elementType === constants.BSON_DATA_MAX_KEY) {
            object[name] = new max_key.MaxKey();
        }
        else if (elementType === constants.BSON_DATA_CODE) {
            var stringSize = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            if (stringSize <= 0 ||
                stringSize > buffer$1.length - index ||
                buffer$1[index + stringSize - 1] !== 0)
                throw new Error('bad string length in bson');
            var functionString = buffer$1.toString('utf8', index, index + stringSize - 1);
            // If we are evaluating the functions
            if (evalFunctions) {
                // If we have cache enabled let's look for the md5 of the function in the cache
                if (cacheFunctions) {
                    // Got to do this to avoid V8 deoptimizing the call due to finding eval
                    object[name] = isolateEval(functionString, functionCache, object);
                }
                else {
                    object[name] = isolateEval(functionString);
                }
            }
            else {
                object[name] = new code.Code(functionString);
            }
            // Update parse index position
            index = index + stringSize;
        }
        else if (elementType === constants.BSON_DATA_CODE_W_SCOPE) {
            var totalSize = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            // Element cannot be shorter than totalSize + stringSize + documentSize + terminator
            if (totalSize < 4 + 4 + 4 + 1) {
                throw new Error('code_w_scope total size shorter minimum expected length');
            }
            // Get the code string size
            var stringSize = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            // Check if we have a valid string
            if (stringSize <= 0 ||
                stringSize > buffer$1.length - index ||
                buffer$1[index + stringSize - 1] !== 0)
                throw new Error('bad string length in bson');
            // Javascript function
            var functionString = buffer$1.toString('utf8', index, index + stringSize - 1);
            // Update parse index position
            index = index + stringSize;
            // Parse the element
            var _index = index;
            // Decode the size of the object document
            var objectSize = buffer$1[index] |
                (buffer$1[index + 1] << 8) |
                (buffer$1[index + 2] << 16) |
                (buffer$1[index + 3] << 24);
            // Decode the scope object
            var scopeObject = deserializeObject(buffer$1, _index, options, false);
            // Adjust the index
            index = index + objectSize;
            // Check if field length is too short
            if (totalSize < 4 + 4 + objectSize + stringSize) {
                throw new Error('code_w_scope total size is too short, truncating scope');
            }
            // Check if totalSize field is too long
            if (totalSize > 4 + 4 + objectSize + stringSize) {
                throw new Error('code_w_scope total size is too long, clips outer document');
            }
            // If we are evaluating the functions
            if (evalFunctions) {
                // If we have cache enabled let's look for the md5 of the function in the cache
                if (cacheFunctions) {
                    // Got to do this to avoid V8 deoptimizing the call due to finding eval
                    object[name] = isolateEval(functionString, functionCache, object);
                }
                else {
                    object[name] = isolateEval(functionString);
                }
                object[name].scope = scopeObject;
            }
            else {
                object[name] = new code.Code(functionString, scopeObject);
            }
        }
        else if (elementType === constants.BSON_DATA_DBPOINTER) {
            // Get the code string size
            var stringSize = buffer$1[index++] |
                (buffer$1[index++] << 8) |
                (buffer$1[index++] << 16) |
                (buffer$1[index++] << 24);
            // Check if we have a valid string
            if (stringSize <= 0 ||
                stringSize > buffer$1.length - index ||
                buffer$1[index + stringSize - 1] !== 0)
                throw new Error('bad string length in bson');
            // Namespace
            if (!validate_utf8.validateUtf8(buffer$1, index, index + stringSize - 1)) {
                throw new Error('Invalid UTF-8 string in BSON document');
            }
            var namespace = buffer$1.toString('utf8', index, index + stringSize - 1);
            // Update parse index position
            index = index + stringSize;
            // Read the oid
            var oidBuffer = buffer.Buffer.alloc(12);
            buffer$1.copy(oidBuffer, 0, index, index + 12);
            var oid = new objectid.ObjectId(oidBuffer);
            // Update the index
            index = index + 12;
            // Upgrade to DBRef type
            object[name] = new db_ref.DBRef(namespace, oid);
        }
        else {
            throw new Error('Detected unknown BSON type ' + elementType.toString(16) + ' for fieldname "' + name + '"');
        }
    }
    // Check if the deserialization was against a valid array/object
    if (size !== index - startIndex) {
        if (isArray)
            throw new Error('corrupt array bson');
        throw new Error('corrupt object bson');
    }
    // check if object's $ keys are those of a DBRef
    var dollarKeys = Object.keys(object).filter(function (k) { return k.startsWith('$'); });
    var valid = true;
    dollarKeys.forEach(function (k) {
        if (['$ref', '$id', '$db'].indexOf(k) === -1)
            valid = false;
    });
    // if a $key not in "$ref", "$id", "$db", don't make a DBRef
    if (!valid)
        return object;
    if (db_ref.isDBRefLike(object)) {
        var copy = Object.assign({}, object);
        delete copy.$ref;
        delete copy.$id;
        delete copy.$db;
        return new db_ref.DBRef(object.$ref, object.$id, object.$db, copy);
    }
    return object;
}
/**
 * Ensure eval is isolated, store the result in functionCache.
 *
 * @internal
 */
function isolateEval(functionString, functionCache, object) {
    if (!functionCache)
        return new Function(functionString);
    // Check for cache hit, eval if missing and return cached function
    if (functionCache[functionString] == null) {
        functionCache[functionString] = new Function(functionString);
    }
    // Set the object
    return functionCache[functionString].bind(object);
}
//# sourceMappingURL=deserializer.js.map
});

unwrapExports(deserializer);
deserializer.deserialize;

var float_parser = createCommonjsModule(function (module, exports) {
// Copyright (c) 2008, Fair Oaks Labs, Inc.
// All rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are met:
//
//  * Redistributions of source code must retain the above copyright notice,
//    this list of conditions and the following disclaimer.
//
//  * Redistributions in binary form must reproduce the above copyright notice,
//    this list of conditions and the following disclaimer in the documentation
//    and/or other materials provided with the distribution.
//
//  * Neither the name of Fair Oaks Labs, Inc. nor the names of its contributors
//    may be used to endorse or promote products derived from this software
//    without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
// AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
// ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
// LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
// SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
// INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
// CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
// ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
// POSSIBILITY OF SUCH DAMAGE.
//
//
// Modifications to writeIEEE754 to support negative zeroes made by Brian White
Object.defineProperty(exports, "__esModule", { value: true });
exports.writeIEEE754 = exports.readIEEE754 = void 0;
function readIEEE754(buffer, offset, endian, mLen, nBytes) {
    var e;
    var m;
    var bBE = endian === 'big';
    var eLen = nBytes * 8 - mLen - 1;
    var eMax = (1 << eLen) - 1;
    var eBias = eMax >> 1;
    var nBits = -7;
    var i = bBE ? 0 : nBytes - 1;
    var d = bBE ? 1 : -1;
    var s = buffer[offset + i];
    i += d;
    e = s & ((1 << -nBits) - 1);
    s >>= -nBits;
    nBits += eLen;
    for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8)
        ;
    m = e & ((1 << -nBits) - 1);
    e >>= -nBits;
    nBits += mLen;
    for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8)
        ;
    if (e === 0) {
        e = 1 - eBias;
    }
    else if (e === eMax) {
        return m ? NaN : (s ? -1 : 1) * Infinity;
    }
    else {
        m = m + Math.pow(2, mLen);
        e = e - eBias;
    }
    return (s ? -1 : 1) * m * Math.pow(2, e - mLen);
}
exports.readIEEE754 = readIEEE754;
function writeIEEE754(buffer, value, offset, endian, mLen, nBytes) {
    var e;
    var m;
    var c;
    var bBE = endian === 'big';
    var eLen = nBytes * 8 - mLen - 1;
    var eMax = (1 << eLen) - 1;
    var eBias = eMax >> 1;
    var rt = mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0;
    var i = bBE ? nBytes - 1 : 0;
    var d = bBE ? -1 : 1;
    var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0;
    value = Math.abs(value);
    if (isNaN(value) || value === Infinity) {
        m = isNaN(value) ? 1 : 0;
        e = eMax;
    }
    else {
        e = Math.floor(Math.log(value) / Math.LN2);
        if (value * (c = Math.pow(2, -e)) < 1) {
            e--;
            c *= 2;
        }
        if (e + eBias >= 1) {
            value += rt / c;
        }
        else {
            value += rt * Math.pow(2, 1 - eBias);
        }
        if (value * c >= 2) {
            e++;
            c /= 2;
        }
        if (e + eBias >= eMax) {
            m = 0;
            e = eMax;
        }
        else if (e + eBias >= 1) {
            m = (value * c - 1) * Math.pow(2, mLen);
            e = e + eBias;
        }
        else {
            m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen);
            e = 0;
        }
    }
    if (isNaN(value))
        m = 0;
    while (mLen >= 8) {
        buffer[offset + i] = m & 0xff;
        i += d;
        m /= 256;
        mLen -= 8;
    }
    e = (e << mLen) | m;
    if (isNaN(value))
        e += 8;
    eLen += mLen;
    while (eLen > 0) {
        buffer[offset + i] = e & 0xff;
        i += d;
        e /= 256;
        eLen -= 8;
    }
    buffer[offset + i - d] |= s * 128;
}
exports.writeIEEE754 = writeIEEE754;
//# sourceMappingURL=float_parser.js.map
});

unwrapExports(float_parser);
float_parser.writeIEEE754;
float_parser.readIEEE754;

var serializer = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.serializeInto = void 0;








var regexp = /\x00/; // eslint-disable-line no-control-regex
var ignoreKeys = new Set(['$db', '$ref', '$id', '$clusterTime']);
function isRegExp(d) {
    return Object.prototype.toString.call(d) === '[object RegExp]';
}
/*
 * isArray indicates if we are writing to a BSON array (type 0x04)
 * which forces the "key" which really an array index as a string to be written as ascii
 * This will catch any errors in index as a string generation
 */
function serializeString(buffer, key, value, index, isArray) {
    // Encode String type
    buffer[index++] = constants.BSON_DATA_STRING;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes + 1;
    buffer[index - 1] = 0;
    // Write the string
    var size = buffer.write(value, index + 4, undefined, 'utf8');
    // Write the size of the string to buffer
    buffer[index + 3] = ((size + 1) >> 24) & 0xff;
    buffer[index + 2] = ((size + 1) >> 16) & 0xff;
    buffer[index + 1] = ((size + 1) >> 8) & 0xff;
    buffer[index] = (size + 1) & 0xff;
    // Update index
    index = index + 4 + size;
    // Write zero
    buffer[index++] = 0;
    return index;
}
function serializeNumber(buffer, key, value, index, isArray) {
    // We have an integer value
    // TODO(NODE-2529): Add support for big int
    if (Number.isInteger(value) &&
        value >= constants.BSON_INT32_MIN &&
        value <= constants.BSON_INT32_MAX) {
        // If the value fits in 32 bits encode as int32
        // Set int type 32 bits or less
        buffer[index++] = constants.BSON_DATA_INT;
        // Number of written bytes
        var numberOfWrittenBytes = !isArray
            ? buffer.write(key, index, undefined, 'utf8')
            : buffer.write(key, index, undefined, 'ascii');
        // Encode the name
        index = index + numberOfWrittenBytes;
        buffer[index++] = 0;
        // Write the int value
        buffer[index++] = value & 0xff;
        buffer[index++] = (value >> 8) & 0xff;
        buffer[index++] = (value >> 16) & 0xff;
        buffer[index++] = (value >> 24) & 0xff;
    }
    else {
        // Encode as double
        buffer[index++] = constants.BSON_DATA_NUMBER;
        // Number of written bytes
        var numberOfWrittenBytes = !isArray
            ? buffer.write(key, index, undefined, 'utf8')
            : buffer.write(key, index, undefined, 'ascii');
        // Encode the name
        index = index + numberOfWrittenBytes;
        buffer[index++] = 0;
        // Write float
        float_parser.writeIEEE754(buffer, value, index, 'little', 52, 8);
        // Adjust index
        index = index + 8;
    }
    return index;
}
function serializeNull(buffer, key, _, index, isArray) {
    // Set long type
    buffer[index++] = constants.BSON_DATA_NULL;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    return index;
}
function serializeBoolean(buffer, key, value, index, isArray) {
    // Write the type
    buffer[index++] = constants.BSON_DATA_BOOLEAN;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    // Encode the boolean value
    buffer[index++] = value ? 1 : 0;
    return index;
}
function serializeDate(buffer, key, value, index, isArray) {
    // Write the type
    buffer[index++] = constants.BSON_DATA_DATE;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    // Write the date
    var dateInMilis = long_1.Long.fromNumber(value.getTime());
    var lowBits = dateInMilis.getLowBits();
    var highBits = dateInMilis.getHighBits();
    // Encode low bits
    buffer[index++] = lowBits & 0xff;
    buffer[index++] = (lowBits >> 8) & 0xff;
    buffer[index++] = (lowBits >> 16) & 0xff;
    buffer[index++] = (lowBits >> 24) & 0xff;
    // Encode high bits
    buffer[index++] = highBits & 0xff;
    buffer[index++] = (highBits >> 8) & 0xff;
    buffer[index++] = (highBits >> 16) & 0xff;
    buffer[index++] = (highBits >> 24) & 0xff;
    return index;
}
function serializeRegExp(buffer, key, value, index, isArray) {
    // Write the type
    buffer[index++] = constants.BSON_DATA_REGEXP;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    if (value.source && value.source.match(regexp) != null) {
        throw Error('value ' + value.source + ' must not contain null bytes');
    }
    // Adjust the index
    index = index + buffer.write(value.source, index, undefined, 'utf8');
    // Write zero
    buffer[index++] = 0x00;
    // Write the parameters
    if (value.ignoreCase)
        buffer[index++] = 0x69; // i
    if (value.global)
        buffer[index++] = 0x73; // s
    if (value.multiline)
        buffer[index++] = 0x6d; // m
    // Add ending zero
    buffer[index++] = 0x00;
    return index;
}
function serializeBSONRegExp(buffer, key, value, index, isArray) {
    // Write the type
    buffer[index++] = constants.BSON_DATA_REGEXP;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    // Check the pattern for 0 bytes
    if (value.pattern.match(regexp) != null) {
        // The BSON spec doesn't allow keys with null bytes because keys are
        // null-terminated.
        throw Error('pattern ' + value.pattern + ' must not contain null bytes');
    }
    // Adjust the index
    index = index + buffer.write(value.pattern, index, undefined, 'utf8');
    // Write zero
    buffer[index++] = 0x00;
    // Write the options
    index = index + buffer.write(value.options.split('').sort().join(''), index, undefined, 'utf8');
    // Add ending zero
    buffer[index++] = 0x00;
    return index;
}
function serializeMinMax(buffer, key, value, index, isArray) {
    // Write the type of either min or max key
    if (value === null) {
        buffer[index++] = constants.BSON_DATA_NULL;
    }
    else if (value._bsontype === 'MinKey') {
        buffer[index++] = constants.BSON_DATA_MIN_KEY;
    }
    else {
        buffer[index++] = constants.BSON_DATA_MAX_KEY;
    }
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    return index;
}
function serializeObjectId(buffer, key, value, index, isArray) {
    // Write the type
    buffer[index++] = constants.BSON_DATA_OID;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    // Write the objectId into the shared buffer
    if (typeof value.id === 'string') {
        buffer.write(value.id, index, undefined, 'binary');
    }
    else if (value.id && value.id.copy) {
        value.id.copy(buffer, index, 0, 12);
    }
    else {
        throw new TypeError('object [' + JSON.stringify(value) + '] is not a valid ObjectId');
    }
    // Adjust index
    return index + 12;
}
function serializeBuffer(buffer, key, value, index, isArray) {
    // Write the type
    buffer[index++] = constants.BSON_DATA_BINARY;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    // Get size of the buffer (current write point)
    var size = value.length;
    // Write the size of the string to buffer
    buffer[index++] = size & 0xff;
    buffer[index++] = (size >> 8) & 0xff;
    buffer[index++] = (size >> 16) & 0xff;
    buffer[index++] = (size >> 24) & 0xff;
    // Write the default subtype
    buffer[index++] = constants.BSON_BINARY_SUBTYPE_DEFAULT;
    // Copy the content form the binary field to the buffer
    buffer.set(ensure_buffer.ensureBuffer(value), index);
    // Adjust the index
    index = index + size;
    return index;
}
function serializeObject(buffer, key, value, index, checkKeys, depth, serializeFunctions, ignoreUndefined, isArray, path) {
    if (checkKeys === void 0) { checkKeys = false; }
    if (depth === void 0) { depth = 0; }
    if (serializeFunctions === void 0) { serializeFunctions = false; }
    if (ignoreUndefined === void 0) { ignoreUndefined = true; }
    if (isArray === void 0) { isArray = false; }
    if (path === void 0) { path = []; }
    for (var i = 0; i < path.length; i++) {
        if (path[i] === value)
            throw new Error('cyclic dependency detected');
    }
    // Push value to stack
    path.push(value);
    // Write the type
    buffer[index++] = Array.isArray(value) ? constants.BSON_DATA_ARRAY : constants.BSON_DATA_OBJECT;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    var endIndex = serializeInto(buffer, value, checkKeys, index, depth + 1, serializeFunctions, ignoreUndefined, path);
    // Pop stack
    path.pop();
    return endIndex;
}
function serializeDecimal128(buffer, key, value, index, isArray) {
    buffer[index++] = constants.BSON_DATA_DECIMAL128;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    // Write the data from the value
    value.bytes.copy(buffer, index, 0, 16);
    return index + 16;
}
function serializeLong(buffer, key, value, index, isArray) {
    // Write the type
    buffer[index++] =
        value._bsontype === 'Long' ? constants.BSON_DATA_LONG : constants.BSON_DATA_TIMESTAMP;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    // Write the date
    var lowBits = value.getLowBits();
    var highBits = value.getHighBits();
    // Encode low bits
    buffer[index++] = lowBits & 0xff;
    buffer[index++] = (lowBits >> 8) & 0xff;
    buffer[index++] = (lowBits >> 16) & 0xff;
    buffer[index++] = (lowBits >> 24) & 0xff;
    // Encode high bits
    buffer[index++] = highBits & 0xff;
    buffer[index++] = (highBits >> 8) & 0xff;
    buffer[index++] = (highBits >> 16) & 0xff;
    buffer[index++] = (highBits >> 24) & 0xff;
    return index;
}
function serializeInt32(buffer, key, value, index, isArray) {
    value = value.valueOf();
    // Set int type 32 bits or less
    buffer[index++] = constants.BSON_DATA_INT;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    // Write the int value
    buffer[index++] = value & 0xff;
    buffer[index++] = (value >> 8) & 0xff;
    buffer[index++] = (value >> 16) & 0xff;
    buffer[index++] = (value >> 24) & 0xff;
    return index;
}
function serializeDouble(buffer, key, value, index, isArray) {
    // Encode as double
    buffer[index++] = constants.BSON_DATA_NUMBER;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    // Write float
    float_parser.writeIEEE754(buffer, value.value, index, 'little', 52, 8);
    // Adjust index
    index = index + 8;
    return index;
}
function serializeFunction(buffer, key, value, index, _checkKeys, _depth, isArray) {
    buffer[index++] = constants.BSON_DATA_CODE;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    // Function string
    var functionString = utils.normalizedFunctionString(value);
    // Write the string
    var size = buffer.write(functionString, index + 4, undefined, 'utf8') + 1;
    // Write the size of the string to buffer
    buffer[index] = size & 0xff;
    buffer[index + 1] = (size >> 8) & 0xff;
    buffer[index + 2] = (size >> 16) & 0xff;
    buffer[index + 3] = (size >> 24) & 0xff;
    // Update index
    index = index + 4 + size - 1;
    // Write zero
    buffer[index++] = 0;
    return index;
}
function serializeCode(buffer, key, value, index, checkKeys, depth, serializeFunctions, ignoreUndefined, isArray) {
    if (checkKeys === void 0) { checkKeys = false; }
    if (depth === void 0) { depth = 0; }
    if (serializeFunctions === void 0) { serializeFunctions = false; }
    if (ignoreUndefined === void 0) { ignoreUndefined = true; }
    if (isArray === void 0) { isArray = false; }
    if (value.scope && typeof value.scope === 'object') {
        // Write the type
        buffer[index++] = constants.BSON_DATA_CODE_W_SCOPE;
        // Number of written bytes
        var numberOfWrittenBytes = !isArray
            ? buffer.write(key, index, undefined, 'utf8')
            : buffer.write(key, index, undefined, 'ascii');
        // Encode the name
        index = index + numberOfWrittenBytes;
        buffer[index++] = 0;
        // Starting index
        var startIndex = index;
        // Serialize the function
        // Get the function string
        var functionString = typeof value.code === 'string' ? value.code : value.code.toString();
        // Index adjustment
        index = index + 4;
        // Write string into buffer
        var codeSize = buffer.write(functionString, index + 4, undefined, 'utf8') + 1;
        // Write the size of the string to buffer
        buffer[index] = codeSize & 0xff;
        buffer[index + 1] = (codeSize >> 8) & 0xff;
        buffer[index + 2] = (codeSize >> 16) & 0xff;
        buffer[index + 3] = (codeSize >> 24) & 0xff;
        // Write end 0
        buffer[index + 4 + codeSize - 1] = 0;
        // Write the
        index = index + codeSize + 4;
        //
        // Serialize the scope value
        var endIndex = serializeInto(buffer, value.scope, checkKeys, index, depth + 1, serializeFunctions, ignoreUndefined);
        index = endIndex - 1;
        // Writ the total
        var totalSize = endIndex - startIndex;
        // Write the total size of the object
        buffer[startIndex++] = totalSize & 0xff;
        buffer[startIndex++] = (totalSize >> 8) & 0xff;
        buffer[startIndex++] = (totalSize >> 16) & 0xff;
        buffer[startIndex++] = (totalSize >> 24) & 0xff;
        // Write trailing zero
        buffer[index++] = 0;
    }
    else {
        buffer[index++] = constants.BSON_DATA_CODE;
        // Number of written bytes
        var numberOfWrittenBytes = !isArray
            ? buffer.write(key, index, undefined, 'utf8')
            : buffer.write(key, index, undefined, 'ascii');
        // Encode the name
        index = index + numberOfWrittenBytes;
        buffer[index++] = 0;
        // Function string
        var functionString = value.code.toString();
        // Write the string
        var size = buffer.write(functionString, index + 4, undefined, 'utf8') + 1;
        // Write the size of the string to buffer
        buffer[index] = size & 0xff;
        buffer[index + 1] = (size >> 8) & 0xff;
        buffer[index + 2] = (size >> 16) & 0xff;
        buffer[index + 3] = (size >> 24) & 0xff;
        // Update index
        index = index + 4 + size - 1;
        // Write zero
        buffer[index++] = 0;
    }
    return index;
}
function serializeBinary(buffer, key, value, index, isArray) {
    // Write the type
    buffer[index++] = constants.BSON_DATA_BINARY;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    // Extract the buffer
    var data = value.value(true);
    // Calculate size
    var size = value.position;
    // Add the deprecated 02 type 4 bytes of size to total
    if (value.sub_type === binary.Binary.SUBTYPE_BYTE_ARRAY)
        size = size + 4;
    // Write the size of the string to buffer
    buffer[index++] = size & 0xff;
    buffer[index++] = (size >> 8) & 0xff;
    buffer[index++] = (size >> 16) & 0xff;
    buffer[index++] = (size >> 24) & 0xff;
    // Write the subtype to the buffer
    buffer[index++] = value.sub_type;
    // If we have binary type 2 the 4 first bytes are the size
    if (value.sub_type === binary.Binary.SUBTYPE_BYTE_ARRAY) {
        size = size - 4;
        buffer[index++] = size & 0xff;
        buffer[index++] = (size >> 8) & 0xff;
        buffer[index++] = (size >> 16) & 0xff;
        buffer[index++] = (size >> 24) & 0xff;
    }
    // Write the data to the object
    buffer.set(data, index);
    // Adjust the index
    index = index + value.position;
    return index;
}
function serializeSymbol(buffer, key, value, index, isArray) {
    // Write the type
    buffer[index++] = constants.BSON_DATA_SYMBOL;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    // Write the string
    var size = buffer.write(value.value, index + 4, undefined, 'utf8') + 1;
    // Write the size of the string to buffer
    buffer[index] = size & 0xff;
    buffer[index + 1] = (size >> 8) & 0xff;
    buffer[index + 2] = (size >> 16) & 0xff;
    buffer[index + 3] = (size >> 24) & 0xff;
    // Update index
    index = index + 4 + size - 1;
    // Write zero
    buffer[index++] = 0x00;
    return index;
}
function serializeDBRef(buffer, key, value, index, depth, serializeFunctions, isArray) {
    // Write the type
    buffer[index++] = constants.BSON_DATA_OBJECT;
    // Number of written bytes
    var numberOfWrittenBytes = !isArray
        ? buffer.write(key, index, undefined, 'utf8')
        : buffer.write(key, index, undefined, 'ascii');
    // Encode the name
    index = index + numberOfWrittenBytes;
    buffer[index++] = 0;
    var startIndex = index;
    var output = {
        $ref: value.collection || value.namespace,
        $id: value.oid
    };
    if (value.db != null) {
        output.$db = value.db;
    }
    output = Object.assign(output, value.fields);
    var endIndex = serializeInto(buffer, output, false, index, depth + 1, serializeFunctions);
    // Calculate object size
    var size = endIndex - startIndex;
    // Write the size
    buffer[startIndex++] = size & 0xff;
    buffer[startIndex++] = (size >> 8) & 0xff;
    buffer[startIndex++] = (size >> 16) & 0xff;
    buffer[startIndex++] = (size >> 24) & 0xff;
    // Set index
    return endIndex;
}
function serializeInto(buffer, object, checkKeys, startingIndex, depth, serializeFunctions, ignoreUndefined, path) {
    if (checkKeys === void 0) { checkKeys = false; }
    if (startingIndex === void 0) { startingIndex = 0; }
    if (depth === void 0) { depth = 0; }
    if (serializeFunctions === void 0) { serializeFunctions = false; }
    if (ignoreUndefined === void 0) { ignoreUndefined = true; }
    if (path === void 0) { path = []; }
    startingIndex = startingIndex || 0;
    path = path || [];
    // Push the object to the path
    path.push(object);
    // Start place to serialize into
    var index = startingIndex + 4;
    // Special case isArray
    if (Array.isArray(object)) {
        // Get object keys
        for (var i = 0; i < object.length; i++) {
            var key = '' + i;
            var value = object[i];
            // Is there an override value
            if (value && value.toBSON) {
                if (typeof value.toBSON !== 'function')
                    throw new TypeError('toBSON is not a function');
                value = value.toBSON();
            }
            if (typeof value === 'string') {
                index = serializeString(buffer, key, value, index, true);
            }
            else if (typeof value === 'number') {
                index = serializeNumber(buffer, key, value, index, true);
            }
            else if (typeof value === 'bigint') {
                throw new TypeError('Unsupported type BigInt, please use Decimal128');
            }
            else if (typeof value === 'boolean') {
                index = serializeBoolean(buffer, key, value, index, true);
            }
            else if (value instanceof Date || utils.isDate(value)) {
                index = serializeDate(buffer, key, value, index, true);
            }
            else if (value === undefined) {
                index = serializeNull(buffer, key, value, index, true);
            }
            else if (value === null) {
                index = serializeNull(buffer, key, value, index, true);
            }
            else if (value['_bsontype'] === 'ObjectId' || value['_bsontype'] === 'ObjectID') {
                index = serializeObjectId(buffer, key, value, index, true);
            }
            else if (utils.isBuffer(value) || utils.isUint8Array(value)) {
                index = serializeBuffer(buffer, key, value, index, true);
            }
            else if (value instanceof RegExp || isRegExp(value)) {
                index = serializeRegExp(buffer, key, value, index, true);
            }
            else if (typeof value === 'object' && value['_bsontype'] == null) {
                index = serializeObject(buffer, key, value, index, checkKeys, depth, serializeFunctions, ignoreUndefined, true, path);
            }
            else if (typeof value === 'object' &&
                extended_json.isBSONType(value) &&
                value._bsontype === 'Decimal128') {
                index = serializeDecimal128(buffer, key, value, index, true);
            }
            else if (value['_bsontype'] === 'Long' || value['_bsontype'] === 'Timestamp') {
                index = serializeLong(buffer, key, value, index, true);
            }
            else if (value['_bsontype'] === 'Double') {
                index = serializeDouble(buffer, key, value, index, true);
            }
            else if (typeof value === 'function' && serializeFunctions) {
                index = serializeFunction(buffer, key, value, index, checkKeys, depth, true);
            }
            else if (value['_bsontype'] === 'Code') {
                index = serializeCode(buffer, key, value, index, checkKeys, depth, serializeFunctions, ignoreUndefined, true);
            }
            else if (value['_bsontype'] === 'Binary') {
                index = serializeBinary(buffer, key, value, index, true);
            }
            else if (value['_bsontype'] === 'Symbol') {
                index = serializeSymbol(buffer, key, value, index, true);
            }
            else if (value['_bsontype'] === 'DBRef') {
                index = serializeDBRef(buffer, key, value, index, depth, serializeFunctions, true);
            }
            else if (value['_bsontype'] === 'BSONRegExp') {
                index = serializeBSONRegExp(buffer, key, value, index, true);
            }
            else if (value['_bsontype'] === 'Int32') {
                index = serializeInt32(buffer, key, value, index, true);
            }
            else if (value['_bsontype'] === 'MinKey' || value['_bsontype'] === 'MaxKey') {
                index = serializeMinMax(buffer, key, value, index, true);
            }
            else if (typeof value['_bsontype'] !== 'undefined') {
                throw new TypeError('Unrecognized or invalid _bsontype: ' + value['_bsontype']);
            }
        }
    }
    else if (object instanceof bson_browser_esm_map.Map) {
        var iterator = object.entries();
        var done = false;
        while (!done) {
            // Unpack the next entry
            var entry = iterator.next();
            done = !!entry.done;
            // Are we done, then skip and terminate
            if (done)
                continue;
            // Get the entry values
            var key = entry.value[0];
            var value = entry.value[1];
            // Check the type of the value
            var type = typeof value;
            // Check the key and throw error if it's illegal
            if (typeof key === 'string' && !ignoreKeys.has(key)) {
                if (key.match(regexp) != null) {
                    // The BSON spec doesn't allow keys with null bytes because keys are
                    // null-terminated.
                    throw Error('key ' + key + ' must not contain null bytes');
                }
                if (checkKeys) {
                    if ('$' === key[0]) {
                        throw Error('key ' + key + " must not start with '$'");
                    }
                    else if (~key.indexOf('.')) {
                        throw Error('key ' + key + " must not contain '.'");
                    }
                }
            }
            if (type === 'string') {
                index = serializeString(buffer, key, value, index);
            }
            else if (type === 'number') {
                index = serializeNumber(buffer, key, value, index);
            }
            else if (type === 'bigint' || utils.isBigInt64Array(value) || utils.isBigUInt64Array(value)) {
                throw new TypeError('Unsupported type BigInt, please use Decimal128');
            }
            else if (type === 'boolean') {
                index = serializeBoolean(buffer, key, value, index);
            }
            else if (value instanceof Date || utils.isDate(value)) {
                index = serializeDate(buffer, key, value, index);
            }
            else if (value === null || (value === undefined && ignoreUndefined === false)) {
                index = serializeNull(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'ObjectId' || value['_bsontype'] === 'ObjectID') {
                index = serializeObjectId(buffer, key, value, index);
            }
            else if (utils.isBuffer(value) || utils.isUint8Array(value)) {
                index = serializeBuffer(buffer, key, value, index);
            }
            else if (value instanceof RegExp || isRegExp(value)) {
                index = serializeRegExp(buffer, key, value, index);
            }
            else if (type === 'object' && value['_bsontype'] == null) {
                index = serializeObject(buffer, key, value, index, checkKeys, depth, serializeFunctions, ignoreUndefined, false, path);
            }
            else if (type === 'object' && value['_bsontype'] === 'Decimal128') {
                index = serializeDecimal128(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'Long' || value['_bsontype'] === 'Timestamp') {
                index = serializeLong(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'Double') {
                index = serializeDouble(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'Code') {
                index = serializeCode(buffer, key, value, index, checkKeys, depth, serializeFunctions, ignoreUndefined);
            }
            else if (typeof value === 'function' && serializeFunctions) {
                index = serializeFunction(buffer, key, value, index, checkKeys, depth, serializeFunctions);
            }
            else if (value['_bsontype'] === 'Binary') {
                index = serializeBinary(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'Symbol') {
                index = serializeSymbol(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'DBRef') {
                index = serializeDBRef(buffer, key, value, index, depth, serializeFunctions);
            }
            else if (value['_bsontype'] === 'BSONRegExp') {
                index = serializeBSONRegExp(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'Int32') {
                index = serializeInt32(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'MinKey' || value['_bsontype'] === 'MaxKey') {
                index = serializeMinMax(buffer, key, value, index);
            }
            else if (typeof value['_bsontype'] !== 'undefined') {
                throw new TypeError('Unrecognized or invalid _bsontype: ' + value['_bsontype']);
            }
        }
    }
    else {
        // Did we provide a custom serialization method
        if (object.toBSON) {
            if (typeof object.toBSON !== 'function')
                throw new TypeError('toBSON is not a function');
            object = object.toBSON();
            if (object != null && typeof object !== 'object')
                throw new TypeError('toBSON function did not return an object');
        }
        // Iterate over all the keys
        for (var key in object) {
            var value = object[key];
            // Is there an override value
            if (value && value.toBSON) {
                if (typeof value.toBSON !== 'function')
                    throw new TypeError('toBSON is not a function');
                value = value.toBSON();
            }
            // Check the type of the value
            var type = typeof value;
            // Check the key and throw error if it's illegal
            if (typeof key === 'string' && !ignoreKeys.has(key)) {
                if (key.match(regexp) != null) {
                    // The BSON spec doesn't allow keys with null bytes because keys are
                    // null-terminated.
                    throw Error('key ' + key + ' must not contain null bytes');
                }
                if (checkKeys) {
                    if ('$' === key[0]) {
                        throw Error('key ' + key + " must not start with '$'");
                    }
                    else if (~key.indexOf('.')) {
                        throw Error('key ' + key + " must not contain '.'");
                    }
                }
            }
            if (type === 'string') {
                index = serializeString(buffer, key, value, index);
            }
            else if (type === 'number') {
                index = serializeNumber(buffer, key, value, index);
            }
            else if (type === 'bigint') {
                throw new TypeError('Unsupported type BigInt, please use Decimal128');
            }
            else if (type === 'boolean') {
                index = serializeBoolean(buffer, key, value, index);
            }
            else if (value instanceof Date || utils.isDate(value)) {
                index = serializeDate(buffer, key, value, index);
            }
            else if (value === undefined) {
                if (ignoreUndefined === false)
                    index = serializeNull(buffer, key, value, index);
            }
            else if (value === null) {
                index = serializeNull(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'ObjectId' || value['_bsontype'] === 'ObjectID') {
                index = serializeObjectId(buffer, key, value, index);
            }
            else if (utils.isBuffer(value) || utils.isUint8Array(value)) {
                index = serializeBuffer(buffer, key, value, index);
            }
            else if (value instanceof RegExp || isRegExp(value)) {
                index = serializeRegExp(buffer, key, value, index);
            }
            else if (type === 'object' && value['_bsontype'] == null) {
                index = serializeObject(buffer, key, value, index, checkKeys, depth, serializeFunctions, ignoreUndefined, false, path);
            }
            else if (type === 'object' && value['_bsontype'] === 'Decimal128') {
                index = serializeDecimal128(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'Long' || value['_bsontype'] === 'Timestamp') {
                index = serializeLong(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'Double') {
                index = serializeDouble(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'Code') {
                index = serializeCode(buffer, key, value, index, checkKeys, depth, serializeFunctions, ignoreUndefined);
            }
            else if (typeof value === 'function' && serializeFunctions) {
                index = serializeFunction(buffer, key, value, index, checkKeys, depth, serializeFunctions);
            }
            else if (value['_bsontype'] === 'Binary') {
                index = serializeBinary(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'Symbol') {
                index = serializeSymbol(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'DBRef') {
                index = serializeDBRef(buffer, key, value, index, depth, serializeFunctions);
            }
            else if (value['_bsontype'] === 'BSONRegExp') {
                index = serializeBSONRegExp(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'Int32') {
                index = serializeInt32(buffer, key, value, index);
            }
            else if (value['_bsontype'] === 'MinKey' || value['_bsontype'] === 'MaxKey') {
                index = serializeMinMax(buffer, key, value, index);
            }
            else if (typeof value['_bsontype'] !== 'undefined') {
                throw new TypeError('Unrecognized or invalid _bsontype: ' + value['_bsontype']);
            }
        }
    }
    // Remove the path
    path.pop();
    // Final padding byte for object
    buffer[index++] = 0x00;
    // Final size
    var size = index - startingIndex;
    // Write the size of the object
    buffer[startingIndex++] = size & 0xff;
    buffer[startingIndex++] = (size >> 8) & 0xff;
    buffer[startingIndex++] = (size >> 16) & 0xff;
    buffer[startingIndex++] = (size >> 24) & 0xff;
    return index;
}
exports.serializeInto = serializeInto;
//# sourceMappingURL=serializer.js.map
});

unwrapExports(serializer);
serializer.serializeInto;

var bson = createCommonjsModule(function (module, exports) {
Object.defineProperty(exports, "__esModule", { value: true });
exports.ObjectID = exports.Decimal128 = exports.BSONRegExp = exports.MaxKey = exports.MinKey = exports.Int32 = exports.Double = exports.Timestamp = exports.Long = exports.UUID = exports.ObjectId = exports.Binary = exports.DBRef = exports.BSONSymbol = exports.Map = exports.Code = exports.LongWithoutOverridesClass = exports.EJSON = exports.BSON_INT64_MIN = exports.BSON_INT64_MAX = exports.BSON_INT32_MIN = exports.BSON_INT32_MAX = exports.BSON_DATA_UNDEFINED = exports.BSON_DATA_TIMESTAMP = exports.BSON_DATA_SYMBOL = exports.BSON_DATA_STRING = exports.BSON_DATA_REGEXP = exports.BSON_DATA_OID = exports.BSON_DATA_OBJECT = exports.BSON_DATA_NUMBER = exports.BSON_DATA_NULL = exports.BSON_DATA_MIN_KEY = exports.BSON_DATA_MAX_KEY = exports.BSON_DATA_LONG = exports.BSON_DATA_INT = exports.BSON_DATA_DECIMAL128 = exports.BSON_DATA_DBPOINTER = exports.BSON_DATA_DATE = exports.BSON_DATA_CODE_W_SCOPE = exports.BSON_DATA_CODE = exports.BSON_DATA_BOOLEAN = exports.BSON_DATA_BINARY = exports.BSON_DATA_ARRAY = exports.BSON_BINARY_SUBTYPE_UUID_NEW = exports.BSON_BINARY_SUBTYPE_UUID = exports.BSON_BINARY_SUBTYPE_USER_DEFINED = exports.BSON_BINARY_SUBTYPE_MD5 = exports.BSON_BINARY_SUBTYPE_FUNCTION = exports.BSON_BINARY_SUBTYPE_DEFAULT = exports.BSON_BINARY_SUBTYPE_BYTE_ARRAY = void 0;
exports.deserializeStream = exports.calculateObjectSize = exports.deserialize = exports.serializeWithBufferAndIndex = exports.serialize = exports.setInternalBufferSize = void 0;


Object.defineProperty(exports, "Binary", { enumerable: true, get: function () { return binary.Binary; } });

Object.defineProperty(exports, "Code", { enumerable: true, get: function () { return code.Code; } });

Object.defineProperty(exports, "DBRef", { enumerable: true, get: function () { return db_ref.DBRef; } });

Object.defineProperty(exports, "Decimal128", { enumerable: true, get: function () { return decimal128.Decimal128; } });

Object.defineProperty(exports, "Double", { enumerable: true, get: function () { return double_1.Double; } });



Object.defineProperty(exports, "Int32", { enumerable: true, get: function () { return int_32.Int32; } });

Object.defineProperty(exports, "Long", { enumerable: true, get: function () { return long_1.Long; } });

Object.defineProperty(exports, "Map", { enumerable: true, get: function () { return bson_browser_esm_map.Map; } });

Object.defineProperty(exports, "MaxKey", { enumerable: true, get: function () { return max_key.MaxKey; } });

Object.defineProperty(exports, "MinKey", { enumerable: true, get: function () { return min_key.MinKey; } });

Object.defineProperty(exports, "ObjectId", { enumerable: true, get: function () { return objectid.ObjectId; } });
Object.defineProperty(exports, "ObjectID", { enumerable: true, get: function () { return objectid.ObjectId; } });

// Parts of the parser



Object.defineProperty(exports, "BSONRegExp", { enumerable: true, get: function () { return regexp.BSONRegExp; } });

Object.defineProperty(exports, "BSONSymbol", { enumerable: true, get: function () { return symbol.BSONSymbol; } });

Object.defineProperty(exports, "Timestamp", { enumerable: true, get: function () { return timestamp.Timestamp; } });

Object.defineProperty(exports, "UUID", { enumerable: true, get: function () { return uuid.UUID; } });

Object.defineProperty(exports, "BSON_BINARY_SUBTYPE_BYTE_ARRAY", { enumerable: true, get: function () { return constants.BSON_BINARY_SUBTYPE_BYTE_ARRAY; } });
Object.defineProperty(exports, "BSON_BINARY_SUBTYPE_DEFAULT", { enumerable: true, get: function () { return constants.BSON_BINARY_SUBTYPE_DEFAULT; } });
Object.defineProperty(exports, "BSON_BINARY_SUBTYPE_FUNCTION", { enumerable: true, get: function () { return constants.BSON_BINARY_SUBTYPE_FUNCTION; } });
Object.defineProperty(exports, "BSON_BINARY_SUBTYPE_MD5", { enumerable: true, get: function () { return constants.BSON_BINARY_SUBTYPE_MD5; } });
Object.defineProperty(exports, "BSON_BINARY_SUBTYPE_USER_DEFINED", { enumerable: true, get: function () { return constants.BSON_BINARY_SUBTYPE_USER_DEFINED; } });
Object.defineProperty(exports, "BSON_BINARY_SUBTYPE_UUID", { enumerable: true, get: function () { return constants.BSON_BINARY_SUBTYPE_UUID; } });
Object.defineProperty(exports, "BSON_BINARY_SUBTYPE_UUID_NEW", { enumerable: true, get: function () { return constants.BSON_BINARY_SUBTYPE_UUID_NEW; } });
Object.defineProperty(exports, "BSON_DATA_ARRAY", { enumerable: true, get: function () { return constants.BSON_DATA_ARRAY; } });
Object.defineProperty(exports, "BSON_DATA_BINARY", { enumerable: true, get: function () { return constants.BSON_DATA_BINARY; } });
Object.defineProperty(exports, "BSON_DATA_BOOLEAN", { enumerable: true, get: function () { return constants.BSON_DATA_BOOLEAN; } });
Object.defineProperty(exports, "BSON_DATA_CODE", { enumerable: true, get: function () { return constants.BSON_DATA_CODE; } });
Object.defineProperty(exports, "BSON_DATA_CODE_W_SCOPE", { enumerable: true, get: function () { return constants.BSON_DATA_CODE_W_SCOPE; } });
Object.defineProperty(exports, "BSON_DATA_DATE", { enumerable: true, get: function () { return constants.BSON_DATA_DATE; } });
Object.defineProperty(exports, "BSON_DATA_DBPOINTER", { enumerable: true, get: function () { return constants.BSON_DATA_DBPOINTER; } });
Object.defineProperty(exports, "BSON_DATA_DECIMAL128", { enumerable: true, get: function () { return constants.BSON_DATA_DECIMAL128; } });
Object.defineProperty(exports, "BSON_DATA_INT", { enumerable: true, get: function () { return constants.BSON_DATA_INT; } });
Object.defineProperty(exports, "BSON_DATA_LONG", { enumerable: true, get: function () { return constants.BSON_DATA_LONG; } });
Object.defineProperty(exports, "BSON_DATA_MAX_KEY", { enumerable: true, get: function () { return constants.BSON_DATA_MAX_KEY; } });
Object.defineProperty(exports, "BSON_DATA_MIN_KEY", { enumerable: true, get: function () { return constants.BSON_DATA_MIN_KEY; } });
Object.defineProperty(exports, "BSON_DATA_NULL", { enumerable: true, get: function () { return constants.BSON_DATA_NULL; } });
Object.defineProperty(exports, "BSON_DATA_NUMBER", { enumerable: true, get: function () { return constants.BSON_DATA_NUMBER; } });
Object.defineProperty(exports, "BSON_DATA_OBJECT", { enumerable: true, get: function () { return constants.BSON_DATA_OBJECT; } });
Object.defineProperty(exports, "BSON_DATA_OID", { enumerable: true, get: function () { return constants.BSON_DATA_OID; } });
Object.defineProperty(exports, "BSON_DATA_REGEXP", { enumerable: true, get: function () { return constants.BSON_DATA_REGEXP; } });
Object.defineProperty(exports, "BSON_DATA_STRING", { enumerable: true, get: function () { return constants.BSON_DATA_STRING; } });
Object.defineProperty(exports, "BSON_DATA_SYMBOL", { enumerable: true, get: function () { return constants.BSON_DATA_SYMBOL; } });
Object.defineProperty(exports, "BSON_DATA_TIMESTAMP", { enumerable: true, get: function () { return constants.BSON_DATA_TIMESTAMP; } });
Object.defineProperty(exports, "BSON_DATA_UNDEFINED", { enumerable: true, get: function () { return constants.BSON_DATA_UNDEFINED; } });
Object.defineProperty(exports, "BSON_INT32_MAX", { enumerable: true, get: function () { return constants.BSON_INT32_MAX; } });
Object.defineProperty(exports, "BSON_INT32_MIN", { enumerable: true, get: function () { return constants.BSON_INT32_MIN; } });
Object.defineProperty(exports, "BSON_INT64_MAX", { enumerable: true, get: function () { return constants.BSON_INT64_MAX; } });
Object.defineProperty(exports, "BSON_INT64_MIN", { enumerable: true, get: function () { return constants.BSON_INT64_MIN; } });
var extended_json_2 = extended_json;
Object.defineProperty(exports, "EJSON", { enumerable: true, get: function () { return extended_json_2.EJSON; } });
var timestamp_2 = timestamp;
Object.defineProperty(exports, "LongWithoutOverridesClass", { enumerable: true, get: function () { return timestamp_2.LongWithoutOverridesClass; } });
/** @internal */
// Default Max Size
var MAXSIZE = 1024 * 1024 * 17;
// Current Internal Temporary Serialization Buffer
var buffer$1 = buffer.Buffer.alloc(MAXSIZE);
/**
 * Sets the size of the internal serialization buffer.
 *
 * @param size - The desired size for the internal serialization buffer
 * @public
 */
function setInternalBufferSize(size) {
    // Resize the internal serialization buffer if needed
    if (buffer$1.length < size) {
        buffer$1 = buffer.Buffer.alloc(size);
    }
}
exports.setInternalBufferSize = setInternalBufferSize;
/**
 * Serialize a Javascript object.
 *
 * @param object - the Javascript object to serialize.
 * @returns Buffer object containing the serialized object.
 * @public
 */
function serialize(object, options) {
    if (options === void 0) { options = {}; }
    // Unpack the options
    var checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;
    var serializeFunctions = typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;
    var ignoreUndefined = typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : true;
    var minInternalBufferSize = typeof options.minInternalBufferSize === 'number' ? options.minInternalBufferSize : MAXSIZE;
    // Resize the internal serialization buffer if needed
    if (buffer$1.length < minInternalBufferSize) {
        buffer$1 = buffer.Buffer.alloc(minInternalBufferSize);
    }
    // Attempt to serialize
    var serializationIndex = serializer.serializeInto(buffer$1, object, checkKeys, 0, 0, serializeFunctions, ignoreUndefined, []);
    // Create the final buffer
    var finishedBuffer = buffer.Buffer.alloc(serializationIndex);
    // Copy into the finished buffer
    buffer$1.copy(finishedBuffer, 0, 0, finishedBuffer.length);
    // Return the buffer
    return finishedBuffer;
}
exports.serialize = serialize;
/**
 * Serialize a Javascript object using a predefined Buffer and index into the buffer,
 * useful when pre-allocating the space for serialization.
 *
 * @param object - the Javascript object to serialize.
 * @param finalBuffer - the Buffer you pre-allocated to store the serialized BSON object.
 * @returns the index pointing to the last written byte in the buffer.
 * @public
 */
function serializeWithBufferAndIndex(object, finalBuffer, options) {
    if (options === void 0) { options = {}; }
    // Unpack the options
    var checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;
    var serializeFunctions = typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;
    var ignoreUndefined = typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : true;
    var startIndex = typeof options.index === 'number' ? options.index : 0;
    // Attempt to serialize
    var serializationIndex = serializer.serializeInto(buffer$1, object, checkKeys, 0, 0, serializeFunctions, ignoreUndefined);
    buffer$1.copy(finalBuffer, startIndex, 0, serializationIndex);
    // Return the index
    return startIndex + serializationIndex - 1;
}
exports.serializeWithBufferAndIndex = serializeWithBufferAndIndex;
/**
 * Deserialize data as BSON.
 *
 * @param buffer - the buffer containing the serialized set of BSON documents.
 * @returns returns the deserialized Javascript Object.
 * @public
 */
function deserialize(buffer, options) {
    if (options === void 0) { options = {}; }
    return deserializer.deserialize(ensure_buffer.ensureBuffer(buffer), options);
}
exports.deserialize = deserialize;
/**
 * Calculate the bson size for a passed in Javascript object.
 *
 * @param object - the Javascript object to calculate the BSON byte size for
 * @returns size of BSON object in bytes
 * @public
 */
function calculateObjectSize(object, options) {
    if (options === void 0) { options = {}; }
    options = options || {};
    var serializeFunctions = typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;
    var ignoreUndefined = typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : true;
    return calculate_size.calculateObjectSize(object, serializeFunctions, ignoreUndefined);
}
exports.calculateObjectSize = calculateObjectSize;
/**
 * Deserialize stream data as BSON documents.
 *
 * @param data - the buffer containing the serialized set of BSON documents.
 * @param startIndex - the start index in the data Buffer where the deserialization is to start.
 * @param numberOfDocuments - number of documents to deserialize.
 * @param documents - an array where to store the deserialized documents.
 * @param docStartIndex - the index in the documents array from where to start inserting documents.
 * @param options - additional options used for the deserialization.
 * @returns next index in the buffer after deserialization **x** numbers of documents.
 * @public
 */
function deserializeStream(data, startIndex, numberOfDocuments, documents, docStartIndex, options) {
    var internalOptions = Object.assign({ allowObjectSmallerThanBufferSize: true, index: 0 }, options);
    var bufferData = ensure_buffer.ensureBuffer(data);
    var index = startIndex;
    // Loop over all documents
    for (var i = 0; i < numberOfDocuments; i++) {
        // Find size of the document
        var size = bufferData[index] |
            (bufferData[index + 1] << 8) |
            (bufferData[index + 2] << 16) |
            (bufferData[index + 3] << 24);
        // Update options with index
        internalOptions.index = index;
        // Parse the document at this point
        documents[docStartIndex + i] = deserializer.deserialize(bufferData, internalOptions);
        // Adjust index by the document size
        index = index + size;
    }
    // Return object containing end index of parsing and list of documents
    return index;
}
exports.deserializeStream = deserializeStream;
/**
 * BSON default export
 * @deprecated Please use named exports
 * @privateRemarks
 * We want to someday deprecate the default export,
 * so none of the new TS types are being exported on the default
 * @public
 */
var BSON = {
    Binary: binary.Binary,
    Code: code.Code,
    DBRef: db_ref.DBRef,
    Decimal128: decimal128.Decimal128,
    Double: double_1.Double,
    Int32: int_32.Int32,
    Long: long_1.Long,
    UUID: uuid.UUID,
    Map: bson_browser_esm_map.Map,
    MaxKey: max_key.MaxKey,
    MinKey: min_key.MinKey,
    ObjectId: objectid.ObjectId,
    ObjectID: objectid.ObjectId,
    BSONRegExp: regexp.BSONRegExp,
    BSONSymbol: symbol.BSONSymbol,
    Timestamp: timestamp.Timestamp,
    EJSON: extended_json.EJSON,
    setInternalBufferSize: setInternalBufferSize,
    serialize: serialize,
    serializeWithBufferAndIndex: serializeWithBufferAndIndex,
    deserialize: deserialize,
    calculateObjectSize: calculateObjectSize,
    deserializeStream: deserializeStream
};
exports.default = BSON;
//# sourceMappingURL=bson.js.map
});

var bson$1 = unwrapExports(bson);
var bson_1 = bson.ObjectID;
var bson_2 = bson.Decimal128;
var bson_3 = bson.BSONRegExp;
var bson_4 = bson.MaxKey;
var bson_5 = bson.MinKey;
var bson_6 = bson.Int32;
var bson_7 = bson.Double;
var bson_8 = bson.Timestamp;
var bson_9 = bson.Long;
var bson_10 = bson.UUID;
var bson_11 = bson.ObjectId;
var bson_12 = bson.Binary;
var bson_13 = bson.DBRef;
var bson_14 = bson.BSONSymbol;
var bson_15 = bson.Map;
var bson_16 = bson.Code;
var bson_17 = bson.LongWithoutOverridesClass;
var bson_18 = bson.EJSON;
var bson_19 = bson.BSON_INT64_MIN;
var bson_20 = bson.BSON_INT64_MAX;
var bson_21 = bson.BSON_INT32_MIN;
var bson_22 = bson.BSON_INT32_MAX;
var bson_23 = bson.BSON_DATA_UNDEFINED;
var bson_24 = bson.BSON_DATA_TIMESTAMP;
var bson_25 = bson.BSON_DATA_SYMBOL;
var bson_26 = bson.BSON_DATA_STRING;
var bson_27 = bson.BSON_DATA_REGEXP;
var bson_28 = bson.BSON_DATA_OID;
var bson_29 = bson.BSON_DATA_OBJECT;
var bson_30 = bson.BSON_DATA_NUMBER;
var bson_31 = bson.BSON_DATA_NULL;
var bson_32 = bson.BSON_DATA_MIN_KEY;
var bson_33 = bson.BSON_DATA_MAX_KEY;
var bson_34 = bson.BSON_DATA_LONG;
var bson_35 = bson.BSON_DATA_INT;
var bson_36 = bson.BSON_DATA_DECIMAL128;
var bson_37 = bson.BSON_DATA_DBPOINTER;
var bson_38 = bson.BSON_DATA_DATE;
var bson_39 = bson.BSON_DATA_CODE_W_SCOPE;
var bson_40 = bson.BSON_DATA_CODE;
var bson_41 = bson.BSON_DATA_BOOLEAN;
var bson_42 = bson.BSON_DATA_BINARY;
var bson_43 = bson.BSON_DATA_ARRAY;
var bson_44 = bson.BSON_BINARY_SUBTYPE_UUID_NEW;
var bson_45 = bson.BSON_BINARY_SUBTYPE_UUID;
var bson_46 = bson.BSON_BINARY_SUBTYPE_USER_DEFINED;
var bson_47 = bson.BSON_BINARY_SUBTYPE_MD5;
var bson_48 = bson.BSON_BINARY_SUBTYPE_FUNCTION;
var bson_49 = bson.BSON_BINARY_SUBTYPE_DEFAULT;
var bson_50 = bson.BSON_BINARY_SUBTYPE_BYTE_ARRAY;
var bson_51 = bson.deserializeStream;
var bson_52 = bson.calculateObjectSize;
var bson_53 = bson.deserialize;
var bson_54 = bson.serializeWithBufferAndIndex;
var bson_55 = bson.serialize;
var bson_56 = bson.setInternalBufferSize;

/* harmony default export */ const bson_browser_esm = ((/* unused pure expression or super */ null && (bson$1)));

//# sourceMappingURL=bson.browser.esm.js.map

;// CONCATENATED MODULE: ./node_modules/realm-web/dist/bundle.dom.es.js
/* provided dependency */ var process = __webpack_require__(4155);




var bundle_dom_es_spreadArrays = (undefined && undefined.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
var BrowserInfo = /** @class */ (function () {
    function BrowserInfo(name, version, os) {
        this.name = name;
        this.version = version;
        this.os = os;
        this.type = 'browser';
    }
    return BrowserInfo;
}());
var NodeInfo = /** @class */ (function () {
    function NodeInfo(version) {
        this.version = version;
        this.type = 'node';
        this.name = 'node';
        this.os = process.platform;
    }
    return NodeInfo;
}());
var SearchBotDeviceInfo = /** @class */ (function () {
    function SearchBotDeviceInfo(name, version, os, bot) {
        this.name = name;
        this.version = version;
        this.os = os;
        this.bot = bot;
        this.type = 'bot-device';
    }
    return SearchBotDeviceInfo;
}());
var BotInfo = /** @class */ (function () {
    function BotInfo() {
        this.type = 'bot';
        this.bot = true; // NOTE: deprecated test name instead
        this.name = 'bot';
        this.version = null;
        this.os = null;
    }
    return BotInfo;
}());
var ReactNativeInfo = /** @class */ (function () {
    function ReactNativeInfo() {
        this.type = 'react-native';
        this.name = 'react-native';
        this.version = null;
        this.os = null;
    }
    return ReactNativeInfo;
}());
// tslint:disable-next-line:max-line-length
var SEARCHBOX_UA_REGEX = /alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/;
var SEARCHBOT_OS_REGEX = /(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/;
var REQUIRED_VERSION_PARTS = 3;
var userAgentRules = [
    ['aol', /AOLShield\/([0-9\._]+)/],
    ['edge', /Edge\/([0-9\._]+)/],
    ['edge-ios', /EdgiOS\/([0-9\._]+)/],
    ['yandexbrowser', /YaBrowser\/([0-9\._]+)/],
    ['kakaotalk', /KAKAOTALK\s([0-9\.]+)/],
    ['samsung', /SamsungBrowser\/([0-9\.]+)/],
    ['silk', /\bSilk\/([0-9._-]+)\b/],
    ['miui', /MiuiBrowser\/([0-9\.]+)$/],
    ['beaker', /BeakerBrowser\/([0-9\.]+)/],
    ['edge-chromium', /Edg\/([0-9\.]+)/],
    [
        'chromium-webview',
        /(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/,
    ],
    ['chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],
    ['phantomjs', /PhantomJS\/([0-9\.]+)(:?\s|$)/],
    ['crios', /CriOS\/([0-9\.]+)(:?\s|$)/],
    ['firefox', /Firefox\/([0-9\.]+)(?:\s|$)/],
    ['fxios', /FxiOS\/([0-9\.]+)/],
    ['opera-mini', /Opera Mini.*Version\/([0-9\.]+)/],
    ['opera', /Opera\/([0-9\.]+)(?:\s|$)/],
    ['opera', /OPR\/([0-9\.]+)(:?\s|$)/],
    ['ie', /Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],
    ['ie', /MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],
    ['ie', /MSIE\s(7\.0)/],
    ['bb10', /BB10;\sTouch.*Version\/([0-9\.]+)/],
    ['android', /Android\s([0-9\.]+)/],
    ['ios', /Version\/([0-9\._]+).*Mobile.*Safari.*/],
    ['safari', /Version\/([0-9\._]+).*Safari/],
    ['facebook', /FBAV\/([0-9\.]+)/],
    ['instagram', /Instagram\s([0-9\.]+)/],
    ['ios-webview', /AppleWebKit\/([0-9\.]+).*Mobile/],
    ['ios-webview', /AppleWebKit\/([0-9\.]+).*Gecko\)$/],
    ['searchbot', SEARCHBOX_UA_REGEX],
];
var operatingSystemRules = [
    ['iOS', /iP(hone|od|ad)/],
    ['Android OS', /Android/],
    ['BlackBerry OS', /BlackBerry|BB10/],
    ['Windows Mobile', /IEMobile/],
    ['Amazon OS', /Kindle/],
    ['Windows 3.11', /Win16/],
    ['Windows 95', /(Windows 95)|(Win95)|(Windows_95)/],
    ['Windows 98', /(Windows 98)|(Win98)/],
    ['Windows 2000', /(Windows NT 5.0)|(Windows 2000)/],
    ['Windows XP', /(Windows NT 5.1)|(Windows XP)/],
    ['Windows Server 2003', /(Windows NT 5.2)/],
    ['Windows Vista', /(Windows NT 6.0)/],
    ['Windows 7', /(Windows NT 6.1)/],
    ['Windows 8', /(Windows NT 6.2)/],
    ['Windows 8.1', /(Windows NT 6.3)/],
    ['Windows 10', /(Windows NT 10.0)/],
    ['Windows ME', /Windows ME/],
    ['Open BSD', /OpenBSD/],
    ['Sun OS', /SunOS/],
    ['Chrome OS', /CrOS/],
    ['Linux', /(Linux)|(X11)/],
    ['Mac OS', /(Mac_PowerPC)|(Macintosh)/],
    ['QNX', /QNX/],
    ['BeOS', /BeOS/],
    ['OS/2', /OS\/2/],
];
function detect(userAgent) {
    if (!!userAgent) {
        return parseUserAgent(userAgent);
    }
    if (typeof document === 'undefined' &&
        typeof navigator !== 'undefined' &&
        navigator.product === 'ReactNative') {
        return new ReactNativeInfo();
    }
    if (typeof navigator !== 'undefined') {
        return parseUserAgent(navigator.userAgent);
    }
    return getNodeVersion();
}
function matchUserAgent(ua) {
    // opted for using reduce here rather than Array#first with a regex.test call
    // this is primarily because using the reduce we only perform the regex
    // execution once rather than once for the test and for the exec again below
    // probably something that needs to be benchmarked though
    return (ua !== '' &&
        userAgentRules.reduce(function (matched, _a) {
            var browser = _a[0], regex = _a[1];
            if (matched) {
                return matched;
            }
            var uaMatch = regex.exec(ua);
            return !!uaMatch && [browser, uaMatch];
        }, false));
}
function parseUserAgent(ua) {
    var matchedRule = matchUserAgent(ua);
    if (!matchedRule) {
        return null;
    }
    var name = matchedRule[0], match = matchedRule[1];
    if (name === 'searchbot') {
        return new BotInfo();
    }
    var versionParts = match[1] && match[1].split(/[._]/).slice(0, 3);
    if (versionParts) {
        if (versionParts.length < REQUIRED_VERSION_PARTS) {
            versionParts = bundle_dom_es_spreadArrays(versionParts, createVersionParts(REQUIRED_VERSION_PARTS - versionParts.length));
        }
    }
    else {
        versionParts = [];
    }
    var version = versionParts.join('.');
    var os = detectOS(ua);
    var searchBotMatch = SEARCHBOT_OS_REGEX.exec(ua);
    if (searchBotMatch && searchBotMatch[1]) {
        return new SearchBotDeviceInfo(name, version, os, searchBotMatch[1]);
    }
    return new BrowserInfo(name, version, os);
}
function detectOS(ua) {
    for (var ii = 0, count = operatingSystemRules.length; ii < count; ii++) {
        var _a = operatingSystemRules[ii], os = _a[0], regex = _a[1];
        var match = regex.exec(ua);
        if (match) {
            return os;
        }
    }
    return null;
}
function getNodeVersion() {
    var isNode = typeof process !== 'undefined' && process.version;
    return isNode ? new NodeInfo(process.version.slice(1)) : null;
}
function createVersionParts(count) {
    var output = [];
    for (var ii = 0; ii < count; ii++) {
        output.push('0');
    }
    return output;
}

////////////////////////////////////////////////////////////////////////////
//
// Copyright 2020 Realm Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
////////////////////////////////////////////////////////////////////////////
class DefaultNetworkTransport {
    constructor() {
        if (!DefaultNetworkTransport.fetch) {
            throw new Error("DefaultNetworkTransport.fetch must be set before it's used");
        }
        if (!DefaultNetworkTransport.AbortController) {
            throw new Error("DefaultNetworkTransport.AbortController must be set before it's used");
        }
    }
    fetchWithCallbacks(request, handler) {
        // tslint:disable-next-line: no-console
        this.fetch(request)
            .then(async (response) => {
            const decodedBody = await response.text();
            // Pull out the headers of the response
            const responseHeaders = {};
            response.headers.forEach((value, key) => {
                responseHeaders[key] = value;
            });
            return {
                statusCode: response.status,
                headers: responseHeaders,
                body: decodedBody,
            };
        })
            .then(r => handler.onSuccess(r))
            .catch(e => handler.onError(e));
    }
    async fetch(request) {
        const { timeoutMs, url, ...rest } = request;
        const { signal, cancelTimeout } = this.createTimeoutSignal(timeoutMs);
        try {
            // We'll await the response to catch throw our own error
            return await DefaultNetworkTransport.fetch(url, {
                signal,
                ...rest
            });
        }
        finally {
            // Whatever happens, cancel any timeout
            cancelTimeout();
        }
    }
    createTimeoutSignal(timeoutMs) {
        if (typeof timeoutMs === "number") {
            const controller = new DefaultNetworkTransport.AbortController();
            // Call abort after a specific number of milliseconds
            const timeout = setTimeout(() => {
                controller.abort();
            }, timeoutMs);
            return {
                signal: controller.signal,
                cancelTimeout: () => {
                    clearTimeout(timeout);
                },
            };
        }
        else {
            return {
                signal: undefined,
                cancelTimeout: () => {
                    /* No-op */
                },
            };
        }
    }
}
DefaultNetworkTransport.DEFAULT_HEADERS = {
    "Content-Type": "application/json",
};

////////////////////////////////////////////////////////////////////////////
DefaultNetworkTransport.fetch = window.fetch.bind(window);
DefaultNetworkTransport.AbortController = window.AbortController;

var bundle_dom_es_commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof __webpack_require__.g !== 'undefined' ? __webpack_require__.g : typeof self !== 'undefined' ? self : {};

function bundle_dom_es_createCommonjsModule(fn, basedir, module) {
	return module = {
	  path: basedir,
	  exports: {},
	  require: function (path, base) {
      return commonjsRequire(path, (base === undefined || base === null) ? module.path : base);
    }
	}, fn(module, module.exports), module.exports;
}

function commonjsRequire () {
	throw new Error('Dynamic requires are not currently supported by @rollup/plugin-commonjs');
}

var base64 = bundle_dom_es_createCommonjsModule(function (module, exports) {
(function (global, factory) {
     module.exports = factory(global)
        ;
}((
    typeof self !== 'undefined' ? self
        : typeof window !== 'undefined' ? window
        : typeof bundle_dom_es_commonjsGlobal !== 'undefined' ? bundle_dom_es_commonjsGlobal
: bundle_dom_es_commonjsGlobal
), function(global) {
    // existing version for noConflict()
    global = global || {};
    var _Base64 = global.Base64;
    var version = "2.6.4";
    // constants
    var b64chars
        = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
    var b64tab = function(bin) {
        var t = {};
        for (var i = 0, l = bin.length; i < l; i++) t[bin.charAt(i)] = i;
        return t;
    }(b64chars);
    var fromCharCode = String.fromCharCode;
    // encoder stuff
    var cb_utob = function(c) {
        if (c.length < 2) {
            var cc = c.charCodeAt(0);
            return cc < 0x80 ? c
                : cc < 0x800 ? (fromCharCode(0xc0 | (cc >>> 6))
                                + fromCharCode(0x80 | (cc & 0x3f)))
                : (fromCharCode(0xe0 | ((cc >>> 12) & 0x0f))
                    + fromCharCode(0x80 | ((cc >>>  6) & 0x3f))
                    + fromCharCode(0x80 | ( cc         & 0x3f)));
        } else {
            var cc = 0x10000
                + (c.charCodeAt(0) - 0xD800) * 0x400
                + (c.charCodeAt(1) - 0xDC00);
            return (fromCharCode(0xf0 | ((cc >>> 18) & 0x07))
                    + fromCharCode(0x80 | ((cc >>> 12) & 0x3f))
                    + fromCharCode(0x80 | ((cc >>>  6) & 0x3f))
                    + fromCharCode(0x80 | ( cc         & 0x3f)));
        }
    };
    var re_utob = /[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g;
    var utob = function(u) {
        return u.replace(re_utob, cb_utob);
    };
    var cb_encode = function(ccc) {
        var padlen = [0, 2, 1][ccc.length % 3],
        ord = ccc.charCodeAt(0) << 16
            | ((ccc.length > 1 ? ccc.charCodeAt(1) : 0) << 8)
            | ((ccc.length > 2 ? ccc.charCodeAt(2) : 0)),
        chars = [
            b64chars.charAt( ord >>> 18),
            b64chars.charAt((ord >>> 12) & 63),
            padlen >= 2 ? '=' : b64chars.charAt((ord >>> 6) & 63),
            padlen >= 1 ? '=' : b64chars.charAt(ord & 63)
        ];
        return chars.join('');
    };
    var btoa = global.btoa && typeof global.btoa == 'function'
        ? function(b){ return global.btoa(b) } : function(b) {
        if (b.match(/[^\x00-\xFF]/)) throw new RangeError(
            'The string contains invalid characters.'
        );
        return b.replace(/[\s\S]{1,3}/g, cb_encode);
    };
    var _encode = function(u) {
        return btoa(utob(String(u)));
    };
    var mkUriSafe = function (b64) {
        return b64.replace(/[+\/]/g, function(m0) {
            return m0 == '+' ? '-' : '_';
        }).replace(/=/g, '');
    };
    var encode = function(u, urisafe) {
        return urisafe ? mkUriSafe(_encode(u)) : _encode(u);
    };
    var encodeURI = function(u) { return encode(u, true) };
    var fromUint8Array;
    if (global.Uint8Array) fromUint8Array = function(a, urisafe) {
        // return btoa(fromCharCode.apply(null, a));
        var b64 = '';
        for (var i = 0, l = a.length; i < l; i += 3) {
            var a0 = a[i], a1 = a[i+1], a2 = a[i+2];
            var ord = a0 << 16 | a1 << 8 | a2;
            b64 +=    b64chars.charAt( ord >>> 18)
                +     b64chars.charAt((ord >>> 12) & 63)
                + ( typeof a1 != 'undefined'
                    ? b64chars.charAt((ord >>>  6) & 63) : '=')
                + ( typeof a2 != 'undefined'
                    ? b64chars.charAt( ord         & 63) : '=');
        }
        return urisafe ? mkUriSafe(b64) : b64;
    };
    // decoder stuff
    var re_btou = /[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g;
    var cb_btou = function(cccc) {
        switch(cccc.length) {
        case 4:
            var cp = ((0x07 & cccc.charCodeAt(0)) << 18)
                |    ((0x3f & cccc.charCodeAt(1)) << 12)
                |    ((0x3f & cccc.charCodeAt(2)) <<  6)
                |     (0x3f & cccc.charCodeAt(3)),
            offset = cp - 0x10000;
            return (fromCharCode((offset  >>> 10) + 0xD800)
                    + fromCharCode((offset & 0x3FF) + 0xDC00));
        case 3:
            return fromCharCode(
                ((0x0f & cccc.charCodeAt(0)) << 12)
                    | ((0x3f & cccc.charCodeAt(1)) << 6)
                    |  (0x3f & cccc.charCodeAt(2))
            );
        default:
            return  fromCharCode(
                ((0x1f & cccc.charCodeAt(0)) << 6)
                    |  (0x3f & cccc.charCodeAt(1))
            );
        }
    };
    var btou = function(b) {
        return b.replace(re_btou, cb_btou);
    };
    var cb_decode = function(cccc) {
        var len = cccc.length,
        padlen = len % 4,
        n = (len > 0 ? b64tab[cccc.charAt(0)] << 18 : 0)
            | (len > 1 ? b64tab[cccc.charAt(1)] << 12 : 0)
            | (len > 2 ? b64tab[cccc.charAt(2)] <<  6 : 0)
            | (len > 3 ? b64tab[cccc.charAt(3)]       : 0),
        chars = [
            fromCharCode( n >>> 16),
            fromCharCode((n >>>  8) & 0xff),
            fromCharCode( n         & 0xff)
        ];
        chars.length -= [0, 0, 2, 1][padlen];
        return chars.join('');
    };
    var _atob = global.atob && typeof global.atob == 'function'
        ? function(a){ return global.atob(a) } : function(a){
        return a.replace(/\S{1,4}/g, cb_decode);
    };
    var atob = function(a) {
        return _atob(String(a).replace(/[^A-Za-z0-9\+\/]/g, ''));
    };
    var _decode = function(a) { return btou(_atob(a)) };
    var _fromURI = function(a) {
        return String(a).replace(/[-_]/g, function(m0) {
            return m0 == '-' ? '+' : '/'
        }).replace(/[^A-Za-z0-9\+\/]/g, '');
    };
    var decode = function(a){
        return _decode(_fromURI(a));
    };
    var toUint8Array;
    if (global.Uint8Array) toUint8Array = function(a) {
        return Uint8Array.from(atob(_fromURI(a)), function(c) {
            return c.charCodeAt(0);
        });
    };
    var noConflict = function() {
        var Base64 = global.Base64;
        global.Base64 = _Base64;
        return Base64;
    };
    // export Base64
    global.Base64 = {
        VERSION: version,
        atob: atob,
        btoa: btoa,
        fromBase64: decode,
        toBase64: encode,
        utob: utob,
        encode: encode,
        encodeURI: encodeURI,
        btou: btou,
        decode: decode,
        noConflict: noConflict,
        fromUint8Array: fromUint8Array,
        toUint8Array: toUint8Array
    };
    // if ES5 is available, make Base64.extendString() available
    if (typeof Object.defineProperty === 'function') {
        var noEnum = function(v){
            return {value:v,enumerable:false,writable:true,configurable:true};
        };
        global.Base64.extendString = function () {
            Object.defineProperty(
                String.prototype, 'fromBase64', noEnum(function () {
                    return decode(this)
                }));
            Object.defineProperty(
                String.prototype, 'toBase64', noEnum(function (urisafe) {
                    return encode(this, urisafe)
                }));
            Object.defineProperty(
                String.prototype, 'toBase64URI', noEnum(function () {
                    return encode(this, true)
                }));
        };
    }
    //
    // export Base64 to the namespace
    //
    if (global['Meteor']) { // Meteor.js
        Base64 = global.Base64;
    }
    // module.exports and AMD are mutually exclusive.
    // module.exports has precedence.
    if ( module.exports) {
        module.exports.Base64 = global.Base64;
    }
    // that's it!
    return {Base64: global.Base64}
}));
});

////////////////////////////////////////////////////////////////////////////
const SERIALIZATION_OPTIONS = {
    relaxed: false,
};
/**
 * Serialize an object containing BSON types into extended-JSON.
 *
 * @param obj The object containing BSON types.
 * @returns The document in extended-JSON format.
 */
function serialize(obj) {
    return bson_18.serialize(obj, SERIALIZATION_OPTIONS);
}
/**
 * De-serialize an object or an array of object from extended-JSON into an object or an array of object with BSON types.
 *
 * @param obj The object or array of objects in extended-JSON format.
 * @returns The object or array of objects with inflated BSON types.
 */
function deserialize(obj) {
    if (Array.isArray(obj)) {
        return obj.map(doc => bson_18.deserialize(doc));
    }
    else {
        return bson_18.deserialize(obj);
    }
}

////////////////////////////////////////////////////////////////////////////
/**
 * The type of a user.
 */
var UserType;
(function (UserType) {
    /**
     * A normal end-user created this user.
     */
    UserType["Normal"] = "normal";
    /**
     * The user was created by the server.
     */
    UserType["Server"] = "server";
})(UserType || (UserType = {}));
/** @ignore */
var DataKey;
(function (DataKey) {
    /** @ignore */
    DataKey["NAME"] = "name";
    /** @ignore */
    DataKey["EMAIL"] = "email";
    /** @ignore */
    DataKey["PICTURE"] = "picture";
    /** @ignore */
    DataKey["FIRST_NAME"] = "first_name";
    /** @ignore */
    DataKey["LAST_NAME"] = "last_name";
    /** @ignore */
    DataKey["GENDER"] = "gender";
    /** @ignore */
    DataKey["BIRTHDAY"] = "birthday";
    /** @ignore */
    DataKey["MIN_AGE"] = "min_age";
    /** @ignore */
    DataKey["MAX_AGE"] = "max_age";
})(DataKey || (DataKey = {}));
const DATA_MAPPING = {
    [DataKey.NAME]: "name",
    [DataKey.EMAIL]: "email",
    [DataKey.PICTURE]: "pictureUrl",
    [DataKey.FIRST_NAME]: "firstName",
    [DataKey.LAST_NAME]: "lastName",
    [DataKey.GENDER]: "gender",
    [DataKey.BIRTHDAY]: "birthday",
    [DataKey.MIN_AGE]: "minAge",
    [DataKey.MAX_AGE]: "maxAge",
};
/** @inheritdoc */
class UserProfile {
    /**
     * @param response The response of a call fetching the users profile.
     */
    constructor(response) {
        /** @ignore */
        this.type = UserType.Normal;
        /** @ignore */
        this.identities = [];
        if (typeof response === "object" && response !== null) {
            const { type, identities, data } = response;
            if (typeof type === "string") {
                this.type = type;
            }
            else {
                throw new Error("Expected 'type' in the response body");
            }
            if (Array.isArray(identities)) {
                this.identities = identities.map((identity) => {
                    return {
                        id: identity.id,
                        providerType: identity["provider_type"],
                    };
                });
            }
            else {
                throw new Error("Expected 'identities' in the response body");
            }
            if (typeof data === "object" && data !== null) {
                const mappedData = Object.fromEntries(Object.entries(data).map(([key, value]) => {
                    if (key in DATA_MAPPING) {
                        // Translate any known data field to its JS idiomatic alias
                        return [DATA_MAPPING[key], value];
                    }
                    else {
                        // Pass through any other values
                        return [key, value];
                    }
                }));
                // We can use `any` since we trust the user supplies the correct type
                // eslint-disable-next-line @typescript-eslint/no-explicit-any
                this.data = deserialize(mappedData);
            }
            else {
                throw new Error("Expected 'data' in the response body");
            }
        }
        else {
            this.data = {};
        }
    }
}

////////////////////////////////////////////////////////////////////////////
//
// Copyright 2020 Realm Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
////////////////////////////////////////////////////////////////////////////
/**
 * A `Storage` which will prefix a key part to every operation.
 */
class PrefixedStorage {
    /**
     * Construct a `Storage` which will prefix a key part to every operation.
     *
     * @param storage The underlying storage to use for operations.
     * @param keyPart The part of the key to prefix when performing operations.
     */
    constructor(storage, keyPart) {
        this.storage = storage;
        this.keyPart = keyPart;
    }
    /** @inheritdoc */
    get(key) {
        return this.storage.get(this.keyPart + PrefixedStorage.PART_SEPARATOR + key);
    }
    /** @inheritdoc */
    set(key, value) {
        return this.storage.set(this.keyPart + PrefixedStorage.PART_SEPARATOR + key, value);
    }
    /** @inheritdoc */
    remove(key) {
        return this.storage.remove(this.keyPart + PrefixedStorage.PART_SEPARATOR + key);
    }
    /** @inheritdoc */
    prefix(keyPart) {
        return new PrefixedStorage(this, keyPart);
    }
    /** @inheritdoc */
    clear(prefix = "") {
        return this.storage.clear(this.keyPart + PrefixedStorage.PART_SEPARATOR + prefix);
    }
    /** @inheritdoc */
    addListener(listener) {
        return this.storage.addListener(listener);
    }
    /** @inheritdoc */
    removeListener(listener) {
        return this.storage.addListener(listener);
    }
}
/**
 * The string separating two parts.
 */
PrefixedStorage.PART_SEPARATOR = ":";

////////////////////////////////////////////////////////////////////////////
const ACCESS_TOKEN_STORAGE_KEY = "accessToken";
const REFRESH_TOKEN_STORAGE_KEY = "refreshToken";
const PROFILE_STORAGE_KEY = "profile";
const PROVIDER_TYPE_STORAGE_KEY = "providerType";
/**
 * Storage specific to the app.
 */
class UserStorage extends PrefixedStorage {
    /**
     * Construct a storage for a `User`.
     *
     * @param storage The underlying storage to wrap.
     * @param userId The id of the user.
     */
    constructor(storage, userId) {
        super(storage, `user(${userId})`);
    }
    /**
     * Get the access token from storage.
     *
     * @returns Access token (null if unknown).
     */
    get accessToken() {
        return this.get(ACCESS_TOKEN_STORAGE_KEY);
    }
    /**
     * Set the access token in storage.
     *
     * @param value Access token (null if unknown).
     */
    set accessToken(value) {
        if (value === null) {
            this.remove(ACCESS_TOKEN_STORAGE_KEY);
        }
        else {
            this.set(ACCESS_TOKEN_STORAGE_KEY, value);
        }
    }
    /**
     * Get the refresh token from storage.
     *
     * @returns Refresh token (null if unknown and user is logged out).
     */
    get refreshToken() {
        return this.get(REFRESH_TOKEN_STORAGE_KEY);
    }
    /**
     * Set the refresh token in storage.
     *
     * @param value Refresh token (null if unknown and user is logged out).
     */
    set refreshToken(value) {
        if (value === null) {
            this.remove(REFRESH_TOKEN_STORAGE_KEY);
        }
        else {
            this.set(REFRESH_TOKEN_STORAGE_KEY, value);
        }
    }
    /**
     * Get the user profile from storage.
     *
     * @returns User profile (undefined if its unknown).
     */
    get profile() {
        const value = this.get(PROFILE_STORAGE_KEY);
        if (value) {
            const profile = new UserProfile();
            // Patch in the values
            Object.assign(profile, JSON.parse(value));
            return profile;
        }
    }
    /**
     * Set the user profile in storage.
     *
     * @param value User profile (undefined if its unknown).
     */
    set profile(value) {
        if (value) {
            this.set(PROFILE_STORAGE_KEY, JSON.stringify(value));
        }
        else {
            this.remove(PROFILE_STORAGE_KEY);
        }
    }
    /**
     * Get the type of authentication provider used to authenticate
     *
     * @returns User profile (undefined if its unknown).
     */
    get providerType() {
        const value = this.get(PROVIDER_TYPE_STORAGE_KEY);
        if (value) {
            return value;
        }
    }
    /**
     * Set the type of authentication provider used to authenticate
     *
     * @param value Type of authentication provider.
     */
    set providerType(value) {
        if (value) {
            this.set(PROVIDER_TYPE_STORAGE_KEY, value);
        }
        else {
            this.remove(PROVIDER_TYPE_STORAGE_KEY);
        }
    }
}

////////////////////////////////////////////////////////////////////////////
//
// Copyright 2020 Realm Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
////////////////////////////////////////////////////////////////////////////
/**
 * @param obj The object to remove keys (and undefined values from)
 * @returns A new object without the keys where the value is undefined.
 */
function removeKeysWithUndefinedValues(obj) {
    return Object.fromEntries(Object.entries(obj).filter(entry => typeof entry[1] !== "undefined"));
}

////////////////////////////////////////////////////////////////////////////
/**
 * Generate a random sequence of characters.
 *
 * @param length The length of the string.
 * @param alphabet The alphabet of characters to pick from.
 * @returns A string of characters picked randomly from `alphabet`.
 */
function generateRandomString(length, alphabet) {
    let result = "";
    for (let i = 0; i < length; i++) {
        result += alphabet[Math.floor(Math.random() * alphabet.length)];
    }
    return result;
}
/**
 * Encode an object mapping from string to string, into a query string to be appended a URL.
 *
 * @param params The parameters to include in the string.
 * @param prefixed Should the "?" prefix be added if values exists?
 * @returns A URL encoded representation of the parameters (omitting a "?" prefix).
 */
function encodeQueryString(params, prefixed = true) {
    // Filter out undefined values
    const cleanedParams = removeKeysWithUndefinedValues(params);
    // Determine if a prefixed "?" is appropreate
    const prefix = prefixed && Object.keys(cleanedParams).length > 0 ? "?" : "";
    // Transform keys and values to a query string
    return (prefix +
        Object.entries(cleanedParams)
            .map(([k, v]) => `${k}=${encodeURIComponent(v)}`)
            .join("&"));
}
/**
 * Decodes a query string into an object.
 *
 * @param str The query string to decode.
 * @returns The decoded query string.
 */
function decodeQueryString(str) {
    const cleanStr = str[0] === "?" ? str.substr(1) : str;
    return Object.fromEntries(cleanStr
        .split("&")
        .filter(s => s.length > 0)
        .map(kvp => kvp.split("="))
        .map(([k, v]) => [k, decodeURIComponent(v)]));
}

////////////////////////////////////////////////////////////////////////////
/**
 * A list of names that functions cannot have to be callable through the functions proxy.
 */
const RESERVED_NAMES = [
    "inspect",
    "callFunction",
    "callFunctionStreaming",
    // Methods defined on the Object.prototype might be "typeof probed" and called by libraries and runtime environments.
    ...Object.getOwnPropertyNames(Object.prototype),
];
/**
 * Remove the key for any fields with undefined values.
 *
 * @param args The arguments to clean.
 * @returns The cleaned arguments.
 */
function cleanArgs(args) {
    for (const arg of args) {
        if (typeof arg === "object") {
            for (const [key, value] of Object.entries(arg)) {
                if (value === undefined) {
                    delete arg[key];
                }
            }
        }
    }
    return args;
}
/**
 * Remove keys for any undefined values and serialize to EJSON.
 *
 * @param args The arguments to clean and serialize.
 * @returns The cleaned and serialized arguments.
 */
function cleanArgsAndSerialize(args) {
    const cleaned = cleanArgs(args);
    return cleaned.map(arg => (typeof arg === "object" ? serialize(arg) : arg));
}
/**
 * Defines how functions are called.
 */
class FunctionsFactory {
    /**
     * @param fetcher The underlying fetcher to use when sending requests.
     * @param config Additional configuration parameters.
     */
    constructor(fetcher, config = {}) {
        this.fetcher = fetcher;
        this.serviceName = config.serviceName;
        this.argsTransformation =
            config.argsTransformation || cleanArgsAndSerialize;
    }
    /**
     * Create a factory of functions, wrapped in a Proxy that returns bound copies of `callFunction` on any property.
     *
     * @param fetcher The underlying fetcher to use when requesting.
     * @param config Additional configuration parameters.
     * @returns The newly created factory of functions.
     */
    static create(fetcher, config = {}) {
        // Create a proxy, wrapping a simple object returning methods that calls functions
        // TODO: Lazily fetch available functions and return these from the ownKeys() trap
        const factory = new FunctionsFactory(fetcher, config);
        // Wrap the factory in a proxy that calls the internal call method
        return new Proxy(factory, {
            get(target, p, receiver) {
                if (typeof p === "string" && RESERVED_NAMES.indexOf(p) === -1) {
                    return target.callFunction.bind(target, p);
                }
                else {
                    const prop = Reflect.get(target, p, receiver);
                    return typeof prop === "function"
                        ? prop.bind(target)
                        : prop;
                }
            },
        });
    }
    /**
     * Call a remote function by it's name.
     *
     * @param name Name of the remote function.
     * @param args Arguments to pass to the remote function.
     * @returns A promise of the value returned when executing the remote function.
     */
    async callFunction(name, ...args) {
        // See https://github.com/mongodb/stitch-js-sdk/blob/master/packages/core/sdk/src/services/internal/CoreStitchServiceClientImpl.ts
        const body = {
            name,
            arguments: this.argsTransformation
                ? this.argsTransformation(args)
                : args,
        };
        if (this.serviceName) {
            body.service = this.serviceName;
        }
        const appRoute = this.fetcher.appRoute;
        return this.fetcher.fetchJSON({
            method: "POST",
            path: appRoute.functionsCall().path,
            body,
        });
    }
    /**
     * Call a remote function by it's name.
     *
     * @param name Name of the remote function.
     * @param args Arguments to pass to the remote function.
     * @returns A promise of the value returned when executing the remote function.
     */
    callFunctionStreaming(name, ...args) {
        const body = {
            name,
            arguments: this.argsTransformation
                ? this.argsTransformation(args)
                : args,
        };
        if (this.serviceName) {
            body.service = this.serviceName;
        }
        const appRoute = this.fetcher.appRoute;
        const qs = encodeQueryString({
            ["baas_request"]: Base64.encode(JSON.stringify(body)),
        });
        return this.fetcher.fetchStream({
            method: "GET",
            path: appRoute.functionsCall().path + qs,
        });
    }
}

////////////////////////////////////////////////////////////////////////////
//
// Copyright 2020 Realm Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
////////////////////////////////////////////////////////////////////////////
/** @inheritdoc */
class EmailPasswordAuth {
    /**
     * Construct an interface to the email / password authentication provider.
     *
     * @param fetcher The underlying fetcher used to request the services.
     * @param providerName Optional custom name of the authentication provider.
     */
    constructor(fetcher, providerName = "local-userpass") {
        this.fetcher = fetcher;
        this.providerName = providerName;
    }
    /** @inheritdoc */
    async registerUser(email, password) {
        const appRoute = this.fetcher.appRoute;
        await this.fetcher.fetchJSON({
            method: "POST",
            path: appRoute.emailPasswordAuth(this.providerName).register().path,
            body: { email, password },
        });
    }
    /** @inheritdoc */
    async confirmUser(token, tokenId) {
        const appRoute = this.fetcher.appRoute;
        await this.fetcher.fetchJSON({
            method: "POST",
            path: appRoute.emailPasswordAuth(this.providerName).confirm().path,
            body: { token, tokenId },
        });
    }
    /** @inheritdoc */
    async resendConfirmationEmail(email) {
        const appRoute = this.fetcher.appRoute;
        await this.fetcher.fetchJSON({
            method: "POST",
            path: appRoute.emailPasswordAuth(this.providerName).confirmSend()
                .path,
            body: { email },
        });
    }
    /** @inheritdoc */
    async resetPassword(token, tokenId, password) {
        const appRoute = this.fetcher.appRoute;
        await this.fetcher.fetchJSON({
            method: "POST",
            path: appRoute.emailPasswordAuth(this.providerName).reset().path,
            body: { token, tokenId, password },
        });
    }
    /** @inheritdoc */
    async sendResetPasswordEmail(email) {
        const appRoute = this.fetcher.appRoute;
        await this.fetcher.fetchJSON({
            method: "POST",
            path: appRoute.emailPasswordAuth(this.providerName).resetSend()
                .path,
            body: { email },
        });
    }
    /** @inheritdoc */
    async callResetPasswordFunction(email, password, ...args) {
        const appRoute = this.fetcher.appRoute;
        await this.fetcher.fetchJSON({
            method: "POST",
            path: appRoute.emailPasswordAuth(this.providerName).resetCall()
                .path,
            body: { email, password, arguments: args },
        });
    }
}

////////////////////////////////////////////////////////////////////////////
//
// Copyright 2020 Realm Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
////////////////////////////////////////////////////////////////////////////
/**
 * @returns The base api route.
 */
function api() {
    return {
        path: "/api/client/v2.0",
        /**
         * @param appId The id of the app.
         * @returns The URL of the app endpoint.
         */
        app(appId) {
            return {
                path: this.path + `/app/${appId}`,
                /**
                 * @returns The URL of the app location endpoint.
                 */
                location() {
                    return {
                        path: this.path + "/location",
                    };
                },
                /**
                 * @param providerName The name of the provider.
                 * @returns The app url concatinated with the /auth/providers/{providerName}
                 */
                authProvider(providerName) {
                    return {
                        path: this.path + `/auth/providers/${providerName}`,
                        /**
                         * @returns Get the URL of an authentication provider.
                         */
                        login() {
                            return { path: this.path + "/login" };
                        },
                    };
                },
                /**
                 * @param providerName The name of the provider.
                 * @returns The app url concatinated with the /auth/providers/{providerName}
                 */
                emailPasswordAuth(providerName) {
                    const authProviderRoutes = this.authProvider(providerName);
                    return {
                        ...authProviderRoutes,
                        register() {
                            return { path: this.path + "/register" };
                        },
                        confirm() {
                            return { path: this.path + "/confirm" };
                        },
                        confirmSend() {
                            return { path: this.path + "/confirm/send" };
                        },
                        reset() {
                            return { path: this.path + "/reset" };
                        },
                        resetSend() {
                            return { path: this.path + "/reset/send" };
                        },
                        resetCall() {
                            return { path: this.path + "/reset/call" };
                        },
                    };
                },
                functionsCall() {
                    return {
                        path: this.path + "/functions/call",
                    };
                },
            };
        },
        auth() {
            return {
                path: this.path + "/auth",
                apiKeys() {
                    return {
                        path: this.path + "/api_keys",
                        key(id) {
                            return {
                                path: this.path + `/${id}`,
                                enable() {
                                    return { path: this.path + "/enable" };
                                },
                                disable() {
                                    return { path: this.path + "/disable" };
                                },
                            };
                        },
                    };
                },
                profile() {
                    return { path: this.path + "/profile" };
                },
                session() {
                    return { path: this.path + "/session" };
                },
            };
        },
    };
}
var routes = { api };

////////////////////////////////////////////////////////////////////////////
/** @inheritdoc */
class ApiKeyAuth {
    /**
     * Construct an interface to the API-key authentication provider.
     *
     * @param fetcher The fetcher used to send requests to services.
     * @param providerName Optional custom name of the authentication provider.
     */
    constructor(fetcher, providerName = "api-key") {
        this.fetcher = fetcher;
    }
    /** @inheritdoc */
    create(name) {
        return this.fetcher.fetchJSON({
            method: "POST",
            body: { name },
            path: routes.api().auth().apiKeys().path,
            tokenType: "refresh",
        });
    }
    /** @inheritdoc */
    fetch(keyId) {
        return this.fetcher.fetchJSON({
            method: "GET",
            path: routes.api().auth().apiKeys().key(keyId).path,
            tokenType: "refresh",
        });
    }
    /** @inheritdoc */
    fetchAll() {
        return this.fetcher.fetchJSON({
            method: "GET",
            tokenType: "refresh",
            path: routes.api().auth().apiKeys().path,
        });
    }
    /** @inheritdoc */
    async delete(keyId) {
        await this.fetcher.fetchJSON({
            method: "DELETE",
            path: routes.api().auth().apiKeys().key(keyId).path,
            tokenType: "refresh",
        });
    }
    /** @inheritdoc */
    async enable(keyId) {
        await this.fetcher.fetchJSON({
            method: "PUT",
            path: routes.api().auth().apiKeys().key(keyId).enable().path,
            tokenType: "refresh",
        });
    }
    /** @inheritdoc */
    async disable(keyId) {
        await this.fetcher.fetchJSON({
            method: "PUT",
            path: routes.api().auth().apiKeys().key(keyId).disable().path,
            tokenType: "refresh",
        });
    }
}

////////////////////////////////////////////////////////////////////////////
//
// Copyright 2020 Realm Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
////////////////////////////////////////////////////////////////////////////
let environment = null;
/**
 * Set the environment of execution.
 * Note: This should be called as the first thing before executing any code which calls getEnvironment()
 *
 * @param e An object containing environment specific implementations.
 */
function setEnvironment(e) {
    environment = e;
}
/**
 * Get the environment of execution.
 *
 * @returns An object containing environment specific implementations.
 */
function getEnvironment() {
    if (environment) {
        return environment;
    }
    else {
        throw new Error("Cannot get environment before it's set");
    }
}

////////////////////////////////////////////////////////////////////////////
//
// Copyright 2020 Realm Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
////////////////////////////////////////////////////////////////////////////
/**
 * An error occured during the parsing of a watch stream.
 */
class WatchError extends Error {
    constructor({ message, code }) {
        super(message);
        /**
         * The name of this type of error
         */
        this.name = "WatchError";
        this.code = code;
    }
}

////////////////////////////////////////////////////////////////////////////
// NOTE: this is a fully processed event, not a single "data: foo" line!
/**
 * The state of a WatchStream.
 */
var WatchStreamState;
(function (WatchStreamState) {
    /**
     * Need to call one of the feed functions.
     */
    WatchStreamState["NEED_DATA"] = "NEED_DATA";
    /**
     * Call nextEvent() to consume an event.
     */
    WatchStreamState["HAVE_EVENT"] = "HAVE_EVENT";
    /**
     * Call error().
     */
    WatchStreamState["HAVE_ERROR"] = "HAVE_ERROR";
})(WatchStreamState || (WatchStreamState = {}));
/**
 * Represents a stream of events
 */
class WatchStream {
    constructor() {
        this._state = WatchStreamState.NEED_DATA;
        this._error = null;
        // Used by feedBuffer to construct lines
        this._textDecoder = new (getEnvironment().TextDecoder)();
        this._buffer = "";
        this._bufferOffset = 0;
        // Used by feedLine for building the next SSE
        this._eventType = "";
        this._dataBuffer = "";
    }
    // Call these when you have data, in whatever shape is easiest for your SDK to get.
    // Pick one, mixing and matching on a single instance isn't supported.
    // These can only be called in NEED_DATA state, which is the initial state.
    feedBuffer(buffer) {
        this.assertState(WatchStreamState.NEED_DATA);
        this._buffer += this._textDecoder.decode(buffer, { stream: true });
        this.advanceBufferState();
    }
    feedLine(line) {
        this.assertState(WatchStreamState.NEED_DATA);
        // This is an implementation of the algorithm described at
        // https://html.spec.whatwg.org/multipage/server-sent-events.html#event-stream-interpretation.
        // Currently the server does not use id or retry lines, so that processing isn't implemented.
        // ignore trailing LF if not removed by SDK.
        if (line.endsWith("\n"))
            line = line.substr(0, line.length - 1);
        // ignore trailing CR from CRLF
        if (line.endsWith("\r"))
            line = line.substr(0, line.length - 1);
        if (line.length === 0) {
            // This is the "dispatch the event" portion of the algorithm.
            if (this._dataBuffer.length === 0) {
                this._eventType = "";
                return;
            }
            if (this._dataBuffer.endsWith("\n"))
                this._dataBuffer = this._dataBuffer.substr(0, this._dataBuffer.length - 1);
            this.feedSse({
                data: this._dataBuffer,
                eventType: this._eventType,
            });
            this._dataBuffer = "";
            this._eventType = "";
        }
        if (line[0] === ":")
            return;
        const colon = line.indexOf(":");
        const field = line.substr(0, colon);
        let value = colon === -1 ? "" : line.substr(colon + 1);
        if (value.startsWith(" "))
            value = value.substr(1);
        if (field === "event") {
            this._eventType = value;
        }
        else if (field === "data") {
            this._dataBuffer += value;
            this._dataBuffer += "\n";
        }
        else ;
    }
    feedSse(sse) {
        this.assertState(WatchStreamState.NEED_DATA);
        const firstPercentIndex = sse.data.indexOf("%");
        if (firstPercentIndex !== -1) {
            // For some reason, the stich server decided to add percent-encoding for '%', '\n', and '\r' to its
            // event-stream replies. But it isn't real urlencoding, since most characters pass through, so we can't use
            // uri_percent_decode() here.
            let buffer = "";
            let start = 0;
            for (let percentIndex = firstPercentIndex; percentIndex !== -1; percentIndex = sse.data.indexOf("%", start)) {
                buffer += sse.data.substr(start, percentIndex - start);
                const encoded = sse.data.substr(percentIndex, 3); // may be smaller than 3 if string ends with %
                if (encoded === "%25") {
                    buffer += "%";
                }
                else if (encoded === "%0A") {
                    buffer += "\x0A"; // '\n'
                }
                else if (encoded === "%0D") {
                    buffer += "\x0D"; // '\r'
                }
                else {
                    buffer += encoded; // propagate as-is
                }
                start = percentIndex + encoded.length;
            }
            // Advance the buffer with the last part
            buffer += sse.data.substr(start);
            sse.data = buffer;
        }
        if (!sse.eventType || sse.eventType === "message") {
            try {
                const parsed = bson_18.parse(sse.data);
                if (typeof parsed === "object") {
                    // ???
                    this._nextEvent = parsed;
                    this._state = WatchStreamState.HAVE_EVENT;
                    return;
                }
            }
            catch {
                // fallthrough to same handling as for non-document value.
            }
            this._state = WatchStreamState.HAVE_ERROR;
            this._error = new WatchError({
                message: "server returned malformed event: " + sse.data,
                code: "bad bson parse",
            });
        }
        else if (sse.eventType === "error") {
            this._state = WatchStreamState.HAVE_ERROR;
            // default error message if we have issues parsing the reply.
            this._error = new WatchError({
                message: sse.data,
                code: "unknown",
            });
            try {
                const { error_code: errorCode, error } = bson_18.parse(sse.data);
                if (typeof errorCode !== "string")
                    return;
                if (typeof error !== "string")
                    return;
                // XXX in realm-js, object-store will error if the error_code is not one of the known
                // error code enum values.
                this._error = new WatchError({
                    message: error,
                    code: errorCode,
                });
            }
            catch {
                return; // Use the default state.
            }
        }
        else ;
    }
    get state() {
        return this._state;
    }
    // Consumes the returned event. If you used feedBuffer(), there may be another event or error after this one,
    // so you need to call state() again to see what to do next.
    nextEvent() {
        this.assertState(WatchStreamState.HAVE_EVENT);
        // We can use "as ChangeEvent<T>" since we just asserted the state.
        const out = this._nextEvent;
        this._state = WatchStreamState.NEED_DATA;
        this.advanceBufferState();
        return out;
    }
    // Once this enters the error state, it stays that way. You should not feed any more data.
    get error() {
        return this._error;
    }
    ////////////////////////////////////////////
    advanceBufferState() {
        this.assertState(WatchStreamState.NEED_DATA);
        while (this.state === WatchStreamState.NEED_DATA) {
            if (this._bufferOffset === this._buffer.length) {
                this._buffer = "";
                this._bufferOffset = 0;
                return;
            }
            // NOTE not supporting CR-only newlines, just LF and CRLF.
            const nextNewlineIndex = this._buffer.indexOf("\n", this._bufferOffset);
            if (nextNewlineIndex === -1) {
                // We have a partial line.
                if (this._bufferOffset !== 0) {
                    // Slide the partial line down to the front of the buffer.
                    this._buffer = this._buffer.substr(this._bufferOffset, this._buffer.length - this._bufferOffset);
                    this._bufferOffset = 0;
                }
                return;
            }
            this.feedLine(this._buffer.substr(this._bufferOffset, nextNewlineIndex - this._bufferOffset));
            this._bufferOffset = nextNewlineIndex + 1; // Advance past this line, including its newline.
        }
    }
    assertState(state) {
        if (this._state !== state) {
            throw Error(`Expected WatchStream to be in state ${state}, but in state ${this._state}`);
        }
    }
}

////////////////////////////////////////////////////////////////////////////
/**
 * A remote collection of documents.
 */
class MongoDBCollection {
    /**
     * Construct a remote collection of documents.
     *
     * @param fetcher The fetcher to use when requesting the service.
     * @param serviceName The name of the remote service.
     * @param databaseName The name of the database.
     * @param collectionName The name of the remote collection.
     */
    constructor(fetcher, serviceName, databaseName, collectionName) {
        this.functions = FunctionsFactory.create(fetcher, {
            serviceName,
        });
        this.databaseName = databaseName;
        this.collectionName = collectionName;
        this.serviceName = serviceName;
        this.fetcher = fetcher;
    }
    /** @inheritdoc */
    find(filter = {}, options = {}) {
        return this.functions.find({
            database: this.databaseName,
            collection: this.collectionName,
            query: filter,
            project: options.projection,
            sort: options.sort,
            limit: options.limit,
        });
    }
    /** @inheritdoc */
    findOne(filter = {}, options = {}) {
        return this.functions.findOne({
            database: this.databaseName,
            collection: this.collectionName,
            query: filter,
            project: options.projection,
            sort: options.sort,
        });
    }
    /** @inheritdoc */
    findOneAndUpdate(filter = {}, update, options = {}) {
        return this.functions.findOneAndUpdate({
            database: this.databaseName,
            collection: this.collectionName,
            filter,
            update,
            sort: options.sort,
            projection: options.projection,
            upsert: options.upsert,
            returnNewDocument: options.returnNewDocument,
        });
    }
    /** @inheritdoc */
    findOneAndReplace(filter = {}, replacement, options = {}) {
        return this.functions.findOneAndReplace({
            database: this.databaseName,
            collection: this.collectionName,
            filter: filter,
            update: replacement,
            sort: options.sort,
            projection: options.projection,
            upsert: options.upsert,
            returnNewDocument: options.returnNewDocument,
        });
    }
    /** @inheritdoc */
    findOneAndDelete(filter = {}, options = {}) {
        return this.functions.findOneAndReplace({
            database: this.databaseName,
            collection: this.collectionName,
            filter,
            sort: options.sort,
            projection: options.projection,
        });
    }
    /** @inheritdoc */
    aggregate(pipeline) {
        return this.functions.aggregate({
            database: this.databaseName,
            collection: this.collectionName,
            pipeline,
        });
    }
    /** @inheritdoc */
    count(filter = {}, options = {}) {
        return this.functions.count({
            database: this.databaseName,
            collection: this.collectionName,
            query: filter,
            limit: options.limit,
        });
    }
    /** @inheritdoc */
    insertOne(document) {
        return this.functions.insertOne({
            database: this.databaseName,
            collection: this.collectionName,
            document,
        });
    }
    /** @inheritdoc */
    insertMany(documents) {
        return this.functions.insertMany({
            database: this.databaseName,
            collection: this.collectionName,
            documents,
        });
    }
    /** @inheritdoc */
    deleteOne(filter = {}) {
        return this.functions.deleteOne({
            database: this.databaseName,
            collection: this.collectionName,
            query: filter,
        });
    }
    /** @inheritdoc */
    deleteMany(filter = {}) {
        return this.functions.deleteMany({
            database: this.databaseName,
            collection: this.collectionName,
            query: filter,
        });
    }
    /** @inheritdoc */
    updateOne(filter, update, options = {}) {
        return this.functions.updateOne({
            database: this.databaseName,
            collection: this.collectionName,
            query: filter,
            update,
            upsert: options.upsert,
        });
    }
    /** @inheritdoc */
    updateMany(filter, update, options = {}) {
        return this.functions.updateMany({
            database: this.databaseName,
            collection: this.collectionName,
            query: filter,
            update,
            upsert: options.upsert,
        });
    }
    async *watch({ ids, filter, } = {}) {
        const iterator = await this.functions.callFunctionStreaming("watch", {
            database: this.databaseName,
            collection: this.collectionName,
            ids,
            filter,
        });
        const watchStream = new WatchStream();
        for await (const chunk of iterator) {
            if (!chunk)
                continue;
            watchStream.feedBuffer(chunk);
            while (watchStream.state == WatchStreamState.HAVE_EVENT) {
                yield watchStream.nextEvent();
            }
            if (watchStream.state == WatchStreamState.HAVE_ERROR)
                // XXX this is just throwing an error like {error_code: "BadRequest, error: "message"},
                // which matches realm-js, but is different from how errors are handled in realm-web
                throw watchStream.error;
        }
    }
}

////////////////////////////////////////////////////////////////////////////
/**
 * Creates an Remote MongoDB Collection.
 * Note: This method exists to enable function binding.
 *
 * @param fetcher The underlying fetcher.
 * @param serviceName A service name.
 * @param databaseName A database name.
 * @param collectionName A collection name.
 * @returns The collection.
 */
function createCollection(fetcher, serviceName, databaseName, collectionName) {
    return new MongoDBCollection(fetcher, serviceName, databaseName, collectionName);
}
/**
 * Creates a Remote MongoDB Database.
 * Note: This method exists to enable function binding.
 *
 * @param fetcher The underlying fetcher
 * @param serviceName A service name
 * @param databaseName A database name
 * @returns The database.
 */
function createDatabase(fetcher, serviceName, databaseName) {
    return {
        collection: createCollection.bind(null, fetcher, serviceName, databaseName),
    };
}
/**
 * Creates a Remote MongoDB Service.
 * Note: This method exists to enable function binding.
 *
 * @param fetcher The underlying fetcher.
 * @param serviceName An optional service name.
 * @returns The service.
 */
function createService(fetcher, serviceName = "mongo-db") {
    return { db: createDatabase.bind(null, fetcher, serviceName) };
}

////////////////////////////////////////////////////////////////////////////
const DEFAULT_DEVICE_ID = "000000000000000000000000";
/** The state of a user within the app */
var UserState;
(function (UserState) {
    /** Active, with both access and refresh tokens */
    UserState["Active"] = "active";
    /** Logged out, but there might still be data persisted about the user, in the browser. */
    UserState["LoggedOut"] = "logged-out";
    /** Logged out and all data about the user has been removed. */
    UserState["Removed"] = "removed";
})(UserState || (UserState = {}));
/** The type of a user. */
var UserType$1;
(function (UserType) {
    /** Created by the user itself. */
    UserType["Normal"] = "normal";
    /** Created by an administrator of the app. */
    UserType["Server"] = "server";
})(UserType$1 || (UserType$1 = {}));
/**
 * Representation of an authenticated user of an app.
 */
class User {
    /**
     * @param parameters Parameters of the user.
     */
    constructor(parameters) {
        this.app = parameters.app;
        this.id = parameters.id;
        this.storage = new UserStorage(this.app.storage, this.id);
        if ("accessToken" in parameters &&
            "refreshToken" in parameters &&
            "providerType" in parameters) {
            this._accessToken = parameters.accessToken;
            this._refreshToken = parameters.refreshToken;
            this.providerType = parameters.providerType;
            // Save the parameters to storage, for future instances to be hydrated from
            this.storage.accessToken = parameters.accessToken;
            this.storage.refreshToken = parameters.refreshToken;
            this.storage.providerType = parameters.providerType;
        }
        else {
            // Hydrate the rest of the parameters from storage
            this._accessToken = this.storage.accessToken;
            this._refreshToken = this.storage.refreshToken;
            const providerType = this.storage.providerType;
            this._profile = this.storage.profile;
            if (providerType) {
                this.providerType = providerType;
            }
            else {
                throw new Error("Storage is missing a provider type");
            }
        }
        this.fetcher = this.app.fetcher.clone({
            userContext: { currentUser: this },
        });
        this.apiKeys = new ApiKeyAuth(this.fetcher);
        this.functions = FunctionsFactory.create(this.fetcher);
    }
    /**
     * @returns The access token used to authenticate the user towards MongoDB Realm.
     */
    get accessToken() {
        return this._accessToken;
    }
    /**
     * @param token The new access token.
     */
    set accessToken(token) {
        this._accessToken = token;
        this.storage.accessToken = token;
    }
    /**
     * @returns The refresh token used to issue new access tokens.
     */
    get refreshToken() {
        return this._refreshToken;
    }
    /**
     * @param token The new refresh token.
     */
    set refreshToken(token) {
        this._refreshToken = token;
        this.storage.refreshToken = token;
    }
    /**
     * @returns The current state of the user.
     */
    get state() {
        if (this.id in this.app.allUsers) {
            return this.refreshToken === null
                ? UserState.LoggedOut
                : UserState.Active;
        }
        else {
            return UserState.Removed;
        }
    }
    /**
     * @returns The logged in state of the user.
     */
    get isLoggedIn() {
        return this.state === UserState.Active;
    }
    get customData() {
        if (this.accessToken) {
            const decodedToken = this.decodeAccessToken();
            return decodedToken.userData;
        }
        else {
            throw new Error("Cannot read custom data without an access token");
        }
    }
    /**
     * @returns Profile containing detailed information about the user.
     */
    get profile() {
        if (this._profile) {
            return this._profile.data;
        }
        else {
            throw new Error("A profile was never fetched for this user");
        }
    }
    get identities() {
        if (this._profile) {
            return this._profile.identities;
        }
        else {
            throw new Error("A profile was never fetched for this user");
        }
    }
    get deviceId() {
        if (this.accessToken) {
            const payload = this.accessToken.split(".")[1];
            if (payload) {
                const parsedPayload = JSON.parse(base64.Base64.decode(payload));
                const deviceId = parsedPayload["baas_device_id"];
                if (typeof deviceId === "string" &&
                    deviceId !== DEFAULT_DEVICE_ID) {
                    return deviceId;
                }
            }
        }
        return null;
    }
    /**
     * Refresh the users profile data.
     */
    async refreshProfile() {
        // Fetch the latest profile
        const response = await this.fetcher.fetchJSON({
            method: "GET",
            path: routes.api().auth().profile().path,
        });
        // Create a profile instance
        this._profile = new UserProfile(response);
        // Store this for later hydration
        this.storage.profile = this._profile;
    }
    /**
     * Log out the user, invalidating the session (and its refresh token).
     */
    async logOut() {
        // Invalidate the refresh token
        try {
            if (this._refreshToken !== null) {
                await this.fetcher.fetchJSON({
                    method: "DELETE",
                    path: routes.api().auth().session().path,
                    tokenType: "refresh",
                });
            }
        }
        finally {
            // Forget the access and refresh token
            this.accessToken = null;
            this.refreshToken = null;
        }
    }
    /** @inheritdoc */
    async linkCredentials(credentials) {
        const response = await this.app.authenticator.authenticate(credentials, this);
        // Sanity check the response
        if (this.id !== response.userId) {
            const details = `got user id ${response.userId} expected ${this.id}`;
            throw new Error(`Link response ment for another user (${details})`);
        }
        // Update the access token
        this.accessToken = response.accessToken;
        // Refresh the profile to include the new identity
        await this.refreshProfile();
    }
    /**
     * Request a new access token, using the refresh token.
     */
    async refreshAccessToken() {
        const response = await this.fetcher.fetchJSON({
            method: "POST",
            path: routes.api().auth().session().path,
            tokenType: "refresh",
        });
        const { access_token: accessToken } = response;
        if (typeof accessToken === "string") {
            this.accessToken = accessToken;
        }
        else {
            throw new Error("Expected an 'access_token' in the response");
        }
    }
    /** @inheritdoc */
    async refreshCustomData() {
        await this.refreshAccessToken();
        return this.customData;
    }
    /** @inheritdoc */
    callFunction(name, ...args) {
        return this.functions.callFunction(name, ...args);
    }
    /**
     * @returns A plain ol' JavaScript object representation of the user.
     */
    toJSON() {
        return {
            id: this.id,
            accessToken: this.accessToken,
            refreshToken: this.refreshToken,
            profile: this._profile,
            state: this.state,
            customData: this.customData,
        };
    }
    /** @inheritdoc */
    push(serviceName = "") {
        throw new Error("Not yet implemented");
    }
    /** @inheritdoc */
    mongoClient(serviceName) {
        return createService(this.fetcher, serviceName);
    }
    decodeAccessToken() {
        if (this.accessToken) {
            // Decode and spread the token
            const parts = this.accessToken.split(".");
            if (parts.length !== 3) {
                throw new Error("Expected an access token with three parts");
            }
            // Decode the payload
            const encodedPayload = parts[1];
            const decodedPayload = base64.Base64.decode(encodedPayload);
            const parsedPayload = JSON.parse(decodedPayload);
            const { exp: expires, iat: issuedAt, sub: subject, user_data: userData = {}, } = parsedPayload;
            // Validate the types
            if (typeof expires !== "number") {
                throw new Error("Failed to decode access token 'exp'");
            }
            else if (typeof issuedAt !== "number") {
                throw new Error("Failed to decode access token 'iat'");
            }
            return { expires, issuedAt, subject, userData };
        }
        else {
            throw new Error("Missing an access token");
        }
    }
}

////////////////////////////////////////////////////////////////////////////
//
// Copyright 2020 Realm Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
////////////////////////////////////////////////////////////////////////////
// TODO: Ensure the static interface of the Credentials class implements the static interface of Realm.Credentials
// See https://stackoverflow.com/a/43484801
/**
 * Instances of this class can be passed to the `app.logIn` method to authenticate an end-user.
 */
class Credentials {
    /**
     * Constructs an instance of credentials.
     *
     * @param providerName The name of the authentication provider used when authenticating.
     * @param providerType The type of the authentication provider used when authenticating.
     * @param payload The data being sent to the service when authenticating.
     */
    constructor(providerName, providerType, payload) {
        this.providerName = providerName;
        this.providerType = providerType;
        this.payload = payload;
    }
    /**
     * Creates credentials that logs in using the [Anonymous Provider](https://docs.mongodb.com/realm/authentication/anonymous/).
     *
     * @returns The credentials instance, which can be passed to `app.logIn`.
     */
    static anonymous() {
        return new Credentials("anon-user", "anon-user", {});
    }
    /**
     * Creates credentials that logs in using the [API Key Provider](https://docs.mongodb.com/realm/authentication/api-key/).
     *
     * @deprecated Use `Credentials.apiKey`.
     *
     * @param key The secret content of the API key.
     * @returns The credentials instance, which can be passed to `app.logIn`.
     */
    static userApiKey(key) {
        return new Credentials("api-key", "api-key", { key });
    }
    /**
     * Creates credentials that logs in using the [API Key Provider](https://docs.mongodb.com/realm/authentication/api-key/).
     *
     * @deprecated Use `Credentials.apiKey`.
     *
     * @param key The secret content of the API key.
     * @returns The credentials instance, which can be passed to `app.logIn`.
     */
    static serverApiKey(key) {
        return new Credentials("api-key", "api-key", { key });
    }
    /**
     * Creates credentials that logs in using the [API Key Provider](https://docs.mongodb.com/realm/authentication/api-key/).
     *
     * @param key The secret content of the API key.
     * @returns The credentials instance, which can be passed to `app.logIn`.
     */
    static apiKey(key) {
        return new Credentials("api-key", "api-key", { key });
    }
    /**
     * Creates credentials that logs in using the [Email/Password Provider](https://docs.mongodb.com/realm/authentication/email-password/).
     * Note: This was formerly known as the "Username/Password" provider.
     *
     * @param email The end-users email address.
     * @param password The end-users password.
     * @returns The credentials instance, which can be passed to `app.logIn`.
     */
    static emailPassword(email, password) {
        return new Credentials("local-userpass", "local-userpass", {
            username: email,
            password,
        });
    }
    /**
     * Creates credentials that logs in using the [Custom Function Provider](https://docs.mongodb.com/realm/authentication/custom-function/).
     *
     * @param payload The custom payload as expected by the server.
     * @returns The credentials instance, which can be passed to `app.logIn`.
     */
    static function(payload) {
        return new Credentials("custom-function", "custom-function", payload);
    }
    /**
     * Creates credentials that logs in using the [Custom JWT Provider](https://docs.mongodb.com/realm/authentication/custom-jwt/).
     *
     * @param token The JSON Web Token (JWT).
     * @returns The credentials instance, which can be passed to `app.logIn`.
     */
    static jwt(token) {
        return new Credentials("custom-token", "custom-token", {
            token,
        });
    }
    /**
     * Creates credentials that logs in using the [Google Provider](https://docs.mongodb.com/realm/authentication/google/).
     *
     * @param payload The URL that users should be redirected to, the auth code or id token from Google.
     * @returns The credentials instance, which can be passed to `app.logIn`.
     */
    static google(payload) {
        return new Credentials("oauth2-google", "oauth2-google", Credentials.derivePayload(payload));
    }
    /**
     * @param payload The payload string.
     * @returns A payload object based on the string.
     */
    static derivePayload(payload) {
        if (typeof payload === "string") {
            if (payload.includes("://")) {
                return this.derivePayload({ redirectUrl: payload });
            }
            else if (payload.startsWith("4/")) {
                return this.derivePayload({ authCode: payload });
            }
            else if (payload.startsWith("ey")) {
                // eslint-disable-next-line @typescript-eslint/camelcase
                return this.derivePayload({ idToken: payload });
            }
            else {
                throw new Error(`Unexpected payload: ${payload}`);
            }
        }
        else if (Object.keys(payload).length === 1) {
            if ("authCode" in payload || "redirectUrl" in payload) {
                return payload;
            }
            else if ("idToken" in payload) {
                // eslint-disable-next-line @typescript-eslint/camelcase
                return { id_token: payload.idToken };
            }
            else {
                throw new Error("Unexpected payload: " + JSON.stringify(payload));
            }
        }
        else {
            throw new Error("Expected only one property in payload, got " +
                JSON.stringify(payload));
        }
    }
    /**
     * Creates credentials that logs in using the [Facebook Provider](https://docs.mongodb.com/realm/authentication/facebook/).
     *
     * @param redirectUrlOrAccessToken The URL that users should be redirected to or the auth code returned from Facebook.
     * @returns The credentials instance, which can be passed to `app.logIn`.
     */
    static facebook(redirectUrlOrAccessToken) {
        return new Credentials("oauth2-facebook", "oauth2-facebook", redirectUrlOrAccessToken.includes("://")
            ? { redirectUrl: redirectUrlOrAccessToken }
            : { accessToken: redirectUrlOrAccessToken });
    }
    /**
     * Creates credentials that logs in using the [Apple ID Provider](https://docs.mongodb.com/realm/authentication/apple/).
     *
     * @param redirectUrlOrIdToken The URL that users should be redirected to or the id_token returned from Apple.
     * @returns The credentials instance, which can be passed to `app.logIn`.
     */
    static apple(redirectUrlOrIdToken) {
        return new Credentials("oauth2-apple", "oauth2-apple", redirectUrlOrIdToken.includes("://")
            ? { redirectUrl: redirectUrlOrIdToken }
            : {
                // eslint-disable-next-line @typescript-eslint/camelcase
                id_token: redirectUrlOrIdToken,
            });
    }
}

////////////////////////////////////////////////////////////////////////////
const USER_IDS_STORAGE_KEY = "userIds";
const DEVICE_ID_STORAGE_KEY = "deviceId";
/**
 * Storage specific to the app.
 */
class AppStorage extends PrefixedStorage {
    /**
     * @param storage The underlying storage to wrap.
     * @param appId The id of the app.
     */
    constructor(storage, appId) {
        super(storage, `app(${appId})`);
    }
    /**
     * Reads out the list of user ids from storage.
     *
     * @returns A list of user ids.
     */
    getUserIds() {
        const userIdsString = this.get(USER_IDS_STORAGE_KEY);
        const userIds = userIdsString ? JSON.parse(userIdsString) : [];
        if (Array.isArray(userIds)) {
            // Remove any duplicates that might have been added
            // The Set preserves insertion order
            return [...new Set(userIds)];
        }
        else {
            throw new Error("Expected the user ids to be an array");
        }
    }
    /**
     * Sets the list of ids in storage.
     * Optionally merging with existing ids stored in the storage, by prepending these while voiding duplicates.
     *
     * @param userIds The list of ids to store.
     * @param mergeWithExisting Prepend existing ids to avoid data-races with other apps using this storage.
     */
    setUserIds(userIds, mergeWithExisting) {
        if (mergeWithExisting) {
            // Add any existing user id to the end of this list, avoiding duplicates
            const existingIds = this.getUserIds();
            for (const id of existingIds) {
                if (userIds.indexOf(id) === -1) {
                    userIds.push(id);
                }
            }
        }
        // Store the list of ids
        this.set(USER_IDS_STORAGE_KEY, JSON.stringify(userIds));
    }
    /**
     * Remove an id from the list of ids.
     *
     * @param userId The id of a User to be removed.
     */
    removeUserId(userId) {
        const existingIds = this.getUserIds();
        const userIds = existingIds.filter(id => id !== userId);
        // Store the list of ids
        this.setUserIds(userIds, false);
    }
    /**
     * @returns id of this device (if any exists)
     */
    getDeviceId() {
        return this.get(DEVICE_ID_STORAGE_KEY);
    }
    /**
     * @param deviceId The id of this device, to send on subsequent authentication requests.
     */
    setDeviceId(deviceId) {
        this.set(DEVICE_ID_STORAGE_KEY, deviceId);
    }
}

////////////////////////////////////////////////////////////////////////////
//
// Copyright 2020 Realm Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
////////////////////////////////////////////////////////////////////////////
const LOWERCASE_LETTERS = "abcdefghijklmnopqrstuvwxyz";
const CLOSE_CHECK_INTERVAL = 100; // 10 times per second
/* eslint-disable @typescript-eslint/camelcase */
const REDIRECT_HASH_TO_RESULT = {
    _stitch_client_app_id: "appId",
    _baas_client_app_id: "appId",
    _stitch_ua: "userAuth",
    _baas_ua: "userAuth",
    _stitch_link: "link",
    _baas_link: "link",
    _stitch_error: "error",
    _baas_error: "error",
    _stitch_state: "state",
    _baas_state: "state",
};
/* eslint-enable @typescript-eslint/camelcase */
/**
 * A collection of methods helping implement the OAuth2 flow.
 */
class OAuth2Helper {
    /**
     * @param storage The underlying storage to use when storing and retriving secrets.
     * @param openWindow An optional function called when a browser window needs to open.
     */
    constructor(storage, openWindow = getEnvironment().openWindow) {
        this.storage = storage.prefix("oauth2");
        this.openWindow = openWindow;
    }
    /**
     * Parses the query string from the final step of the OAuth flow.
     *
     * @param queryString The query string passed through in location.hash.
     * @returns The result of the OAuth flow.
     */
    static parseRedirectLocation(queryString) {
        const params = decodeQueryString(queryString);
        const result = {};
        for (const [p, r] of Object.entries(REDIRECT_HASH_TO_RESULT)) {
            const value = params[p];
            if (value) {
                result[r] = value;
            }
        }
        return result;
    }
    /**
     * Handle the redirect querystring by parsing it and storing it for others to consume.
     *
     * @param queryString The query string containing the encoded result from the OAuth provider.
     * @param storage The underlying storage used to persist the result.
     */
    static handleRedirect(queryString, storage = getEnvironment().defaultStorage) {
        const result = OAuth2Helper.parseRedirectLocation(queryString);
        const { state, error } = result;
        if (typeof state === "string") {
            const oauth2Storage = storage.prefix("oauth2");
            const stateStorage = OAuth2Helper.getStateStorage(oauth2Storage, state);
            stateStorage.set("result", JSON.stringify(result));
        }
        else if (error) {
            throw new Error(`Failed to handle OAuth 2.0 redirect: ${error}`);
        }
        else {
            throw new Error("Failed to handle OAuth 2.0 redirect.");
        }
    }
    /**
     * Decodes the authInfo string into its seperate parts.
     *
     * @param authInfo An authInfo string returned from the server.
     * @returns An object containing the separate parts of the authInfo string.
     */
    static decodeAuthInfo(authInfo) {
        const parts = (authInfo || "").split("$");
        if (parts.length === 4) {
            const [accessToken, refreshToken, userId, deviceId] = parts;
            return { accessToken, refreshToken, userId, deviceId };
        }
        else {
            throw new Error("Failed to decode 'authInfo' into ids and tokens");
        }
    }
    /**
     * Get the storage key associated of an secret associated with a state.
     *
     * @param storage The root storage used to derive a "state namespaced" storage.
     * @param state The random state.
     * @returns The storage associated with a particular state.
     */
    static getStateStorage(storage, state) {
        return storage.prefix(`state(${state})`);
    }
    /**
     * Open a window and wait for the redirect to be handled.
     *
     * @param url The URL to open.
     * @param state The state which will be used to listen for storage updates.
     * @returns The result passed through the redirect.
     */
    openWindowAndWaitForRedirect(url, state) {
        const stateStorage = OAuth2Helper.getStateStorage(this.storage, state);
        // Return a promise that resolves when the  gets known
        return new Promise((resolve, reject) => {
            let redirectWindow = null;
            // We're declaring the interval now to enable referencing before its initialized
            let windowClosedInterval; // eslint-disable-line prefer-const
            const handleStorageUpdate = () => {
                // Trying to get the secret from storage
                const result = stateStorage.get("result");
                if (result) {
                    const parsedResult = JSON.parse(result);
                    // The secret got updated!
                    stateStorage.removeListener(handleStorageUpdate);
                    // Clear the storage to prevent others from reading this
                    stateStorage.clear();
                    // Try closing the newly created window
                    try {
                        if (redirectWindow) {
                            // Stop checking if the window closed
                            clearInterval(windowClosedInterval);
                            redirectWindow.close();
                        }
                    }
                    catch (err) {
                        console.warn(`Failed closing redirect window: ${err}`);
                    }
                    finally {
                        resolve(parsedResult);
                    }
                }
            };
            // Add a listener to the state storage, awaiting an update to the secret
            stateStorage.addListener(handleStorageUpdate);
            // Open up a window
            redirectWindow = this.openWindow(url);
            // Not using a const, because we need the two listeners to reference each other when removing the other.
            windowClosedInterval = setInterval(() => {
                // Polling "closed" because registering listeners on the window violates cross-origin policies
                if (!redirectWindow) {
                    // No need to keep polling for a window that we can't check
                    clearInterval(windowClosedInterval);
                }
                else if (redirectWindow.closed) {
                    // Stop polling the window state
                    clearInterval(windowClosedInterval);
                    // Stop listening for changes to the storage
                    stateStorage.removeListener(handleStorageUpdate);
                    // Reject the promise
                    const err = new Error("Window closed");
                    reject(err);
                }
            }, CLOSE_CHECK_INTERVAL);
        });
    }
    /**
     * Generate a random state string.
     *
     * @returns The random state string.
     */
    generateState() {
        return generateRandomString(12, LOWERCASE_LETTERS);
    }
}

////////////////////////////////////////////////////////////////////////////
const REDIRECT_LOCATION_HEADER = "x-baas-location";
/**
 * Handles authentication and linking of users.
 */
class Authenticator {
    /**
     * @param fetcher The fetcher used to fetch responses from the server.
     * @param storage The storage used when completing OAuth 2.0 flows (should not be scoped to a specific app).
     * @param getDeviceInformation Called to get device information to be sent to the server.
     */
    constructor(fetcher, storage, getDeviceInformation) {
        this.fetcher = fetcher;
        this.oauth2 = new OAuth2Helper(storage);
        this.getDeviceInformation = getDeviceInformation;
    }
    /**
     * @param credentials Credentials to use when logging in.
     * @param linkingUser A user requesting to link.
     */
    async authenticate(credentials, linkingUser) {
        const deviceInformation = this.getDeviceInformation();
        const isLinking = typeof linkingUser === "object";
        if (credentials.providerType.startsWith("oauth2") &&
            typeof credentials.payload.redirectUrl === "string") {
            // Initiate the OAuth2 flow by generating a state and fetch a redirect URL
            const state = this.oauth2.generateState();
            const url = await this.getLogInUrl(credentials, isLinking, {
                state,
                redirect: credentials.payload.redirectUrl,
                // Ensure redirects are communicated in a header different from "Location" and status remains 200 OK
                providerRedirectHeader: isLinking ? true : undefined,
                // Add the device information, only if we're not linking - since that request won't have a body of its own.
                device: !isLinking ? deviceInformation.encode() : undefined,
            });
            // If we're linking, we need to send the users access token in the request
            if (isLinking) {
                const response = await this.fetcher.fetch({
                    method: "GET",
                    url,
                    tokenType: isLinking ? "access" : "none",
                    user: linkingUser,
                    // The response will set a cookie that we need to tell the browser to store
                    mode: "cors",
                    credentials: "include",
                });
                // If a response header contains a redirect URL: Open a window and wait for the redirect to be handled
                const redirectUrl = response.headers.get(REDIRECT_LOCATION_HEADER);
                if (redirectUrl) {
                    return this.openWindowAndWaitForAuthResponse(redirectUrl, state);
                }
                else {
                    throw new Error(`Missing ${REDIRECT_LOCATION_HEADER} header`);
                }
            }
            else {
                // Otherwise we can open a window and let the server redirect the user right away
                // This gives lower latency (as we don't need the client to receive and execute the redirect in code)
                // This also has less dependency on cookies and doesn't sent any tokens.
                return this.openWindowAndWaitForAuthResponse(url, state);
            }
        }
        else {
            const logInUrl = await this.getLogInUrl(credentials, isLinking);
            const response = await this.fetcher.fetchJSON({
                method: "POST",
                url: logInUrl,
                body: {
                    ...credentials.payload,
                    options: {
                        device: deviceInformation.toJSON(),
                    },
                },
                tokenType: isLinking ? "access" : "none",
                user: linkingUser,
            });
            // Spread out values from the response and ensure they're valid
            const { user_id: userId, access_token: accessToken, refresh_token: refreshToken = null, device_id: deviceId, } = response;
            if (typeof userId !== "string") {
                throw new Error("Expected a user id in the response");
            }
            if (typeof accessToken !== "string") {
                throw new Error("Expected an access token in the response");
            }
            return { userId, accessToken, refreshToken, deviceId };
        }
    }
    /**
     * @param credentials Credentials to use when logging in.
     * @param link Should the request link with the current user?
     * @param extraQueryParams Any extra parameters to include in the query string
     */
    async getLogInUrl(credentials, link = false, extraQueryParams = {}) {
        // See https://github.com/mongodb/stitch-js-sdk/blob/310f0bd5af80f818cdfbc3caf1ae29ffa8e9c7cf/packages/core/sdk/src/auth/internal/CoreStitchAuth.ts#L746-L780
        const appRoute = this.fetcher.appRoute;
        const loginRoute = appRoute
            .authProvider(credentials.providerName)
            .login();
        const qs = encodeQueryString({
            link: link ? "true" : undefined,
            ...extraQueryParams,
        });
        const locationUrl = await this.fetcher.locationUrl;
        return locationUrl + loginRoute.path + qs;
    }
    async openWindowAndWaitForAuthResponse(redirectUrl, state) {
        const redirectResult = await this.oauth2.openWindowAndWaitForRedirect(redirectUrl, state);
        // Decode the auth info (id, tokens, etc.) from the result of the redirect
        return OAuth2Helper.decodeAuthInfo(redirectResult.userAuth);
    }
}

////////////////////////////////////////////////////////////////////////////
//
// Copyright 2020 Realm Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
////////////////////////////////////////////////////////////////////////////
// TODO: Determine if the shape of an error response is specific to each service or widely used.
/**
 * An error produced while communicating with the MongoDB Realm server.
 */
class MongoDBRealmError extends Error {
    constructor(method, url, statusCode, statusText, error, errorCode, link) {
        const summary = statusText
            ? `status ${statusCode} ${statusText}`
            : `status ${statusCode}`;
        if (typeof error === "string") {
            super(`Request failed (${method} ${url}): ${error} (${summary})`);
        }
        else {
            super(`Request failed (${method} ${url}): (${summary})`);
        }
        this.method = method;
        this.url = url;
        this.statusText = statusText;
        this.statusCode = statusCode;
        this.error = error;
        this.errorCode = errorCode;
        this.link = link;
    }
    /**
     * Constructs and returns an error from a request and a response.
     * Note: The caller must throw this error themselves.
     *
     * @param request The request sent to the server.
     * @param response A raw response, as returned from the server.
     */
    static async fromRequestAndResponse(request, response) {
        var _a;
        const { url, method } = request;
        const { status, statusText } = response;
        if ((_a = response.headers.get("content-type")) === null || _a === void 0 ? void 0 : _a.startsWith("application/json")) {
            const body = await response.json();
            const error = body.error || "No message";
            const errorCode = body.error_code;
            const link = body.link;
            return new MongoDBRealmError(method, url, status, statusText, error, errorCode, link);
        }
        else {
            return new MongoDBRealmError(method, url, status, statusText);
        }
    }
}

////////////////////////////////////////////////////////////////////////////
/**
 * @param body A possible resonse body.
 * @returns An async iterator.
 */
function asyncIteratorFromResponseBody(body) {
    if (typeof body !== "object" || body === null) {
        throw new Error("Expected a non-null object");
    }
    else if (Symbol.asyncIterator in body) {
        return body;
    }
    else if ("getReader" in body) {
        const stream = body;
        return {
            [Symbol.asyncIterator]() {
                const reader = stream.getReader();
                return {
                    next() {
                        return reader.read();
                    },
                    async return() {
                        await reader.cancel();
                        return { done: true, value: null };
                    },
                };
            },
        };
    }
    else {
        throw new Error("Expected an AsyncIterable or a ReadableStream");
    }
}
/**
 * Wraps a NetworkTransport from the "realm-network-transport" package.
 * Extracts error messages and throws `MongoDBRealmError` objects upon failures.
 * Injects access or refresh tokens for a current or specific user.
 * Refreshes access tokens if requests fails due to a 401 error.
 * Optionally parses response as JSON before returning it.
 * Fetches and exposes an app's location url.
 */
class Fetcher {
    /**
     * @param config A configuration of the fetcher.
     */
    constructor({ appId, transport, userContext, locationUrlContext, }) {
        this.appId = appId;
        this.transport = transport;
        this.userContext = userContext;
        this.locationUrlContext = locationUrlContext;
    }
    /**
     * @param user An optional user to generate the header for.
     * @param tokenType The type of token (access or refresh).
     * @returns An object containing the user's token as "Authorization" header or undefined if no user is given.
     */
    static buildAuthorizationHeader(user, tokenType) {
        if (!user || tokenType === "none") {
            return {};
        }
        else if (tokenType === "access") {
            return { Authorization: `Bearer ${user.accessToken}` };
        }
        else if (tokenType === "refresh") {
            return { Authorization: `Bearer ${user.refreshToken}` };
        }
        else {
            throw new Error(`Unexpected token type (${tokenType})`);
        }
    }
    /**
     * @param body The body string or object passed from a request.
     * @returns An object optionally specifying the "Content-Type" header.
     */
    static buildBody(body) {
        if (!body) {
            return;
        }
        else if (typeof body === "object" && body !== null) {
            return JSON.stringify(serialize(body));
        }
        else if (typeof body === "string") {
            return body;
        }
        else {
            console.log("body is", body);
            throw new Error("Unexpected type of body");
        }
    }
    /**
     * @param body The body string or object passed from a request.
     * @returns An object optionally specifying the "Content-Type" header.
     */
    static buildJsonHeader(body) {
        if (body && body.length > 0) {
            return { "Content-Type": "application/json" };
        }
        else {
            return {};
        }
    }
    clone(config) {
        return new Fetcher({
            appId: this.appId,
            transport: this.transport,
            userContext: this.userContext,
            locationUrlContext: this.locationUrlContext,
            ...config,
        });
    }
    /**
     * Fetch a network resource as an authenticated user.
     *
     * @param request The request which should be sent to the server.
     * @returns The response from the server.
     */
    async fetch(request) {
        const { path, url, tokenType = "access", user = this.userContext.currentUser, ...restOfRequest } = request;
        if (typeof path === "string" && typeof url === "string") {
            throw new Error("Use of 'url' and 'path' mutually exclusive");
        }
        else if (typeof path === "string") {
            // Derive the URL
            const url = (await this.locationUrlContext.locationUrl) + path;
            return this.fetch({ ...request, path: undefined, url });
        }
        else if (typeof url === "string") {
            const response = await this.transport.fetch({
                ...restOfRequest,
                url,
                headers: {
                    ...Fetcher.buildAuthorizationHeader(user, tokenType),
                    ...request.headers,
                },
            });
            if (response.ok) {
                return response;
            }
            else if (user &&
                response.status === 401 &&
                tokenType === "access") {
                // If the access token has expired, it would help refreshing it
                await user.refreshAccessToken();
                // Retry with the specific user, since the currentUser might have changed.
                return this.fetch({ ...request, user });
            }
            else {
                if (user &&
                    response.status === 401 &&
                    tokenType === "refresh") {
                    // A 401 error while using the refresh token indicates the token has an issue.
                    // Reset the tokens to prevent a lock.
                    user.accessToken = null;
                    user.refreshToken = null;
                }
                // Throw an error with a message extracted from the body
                throw await MongoDBRealmError.fromRequestAndResponse(request, response);
            }
        }
        else {
            throw new Error("Expected either 'url' or 'path'");
        }
    }
    /**
     * Fetch a network resource as an authenticated user and parse the result as extended JSON.
     *
     * @param request The request which should be sent to the server.
     * @returns The response from the server, parsed as extended JSON.
     */
    async fetchJSON(request) {
        const { body } = request;
        const serializedBody = Fetcher.buildBody(body);
        const contentTypeHeaders = Fetcher.buildJsonHeader(serializedBody);
        const response = await this.fetch({
            ...request,
            body: serializedBody,
            headers: {
                Accept: "application/json",
                ...contentTypeHeaders,
                ...request.headers,
            },
        });
        const contentType = response.headers.get("content-type");
        if (contentType === null || contentType === void 0 ? void 0 : contentType.startsWith("application/json")) {
            const responseBody = await response.json();
            return deserialize(responseBody);
        }
        else if (contentType === null) {
            return null;
        }
        else {
            throw new Error(`Expected JSON response, got "${contentType}"`);
        }
    }
    /**
     * Fetch an "event-stream" resource as an authenticated user.
     *
     * @param request The request which should be sent to the server.
     */
    async fetchStream(request) {
        const { body } = await this.fetch({
            ...request,
            headers: {
                Accept: "text/event-stream",
                ...request.headers,
            },
        });
        return asyncIteratorFromResponseBody(body);
    }
    /**
     * @returns The path of the app route.
     */
    get appRoute() {
        return routes.api().app(this.appId);
    }
    /**
     * @returns A promise of the location URL of the app.
     */
    get locationUrl() {
        return this.locationUrlContext.locationUrl;
    }
}

////////////////////////////////////////////////////////////////////////////
/**
 * The key in a storage on which the device id is stored.
 */
const DEVICE_ID_STORAGE_KEY$1 = "deviceId";
var DeviceFields;
(function (DeviceFields) {
    DeviceFields["DEVICE_ID"] = "deviceId";
    DeviceFields["APP_ID"] = "appId";
    DeviceFields["APP_VERSION"] = "appVersion";
    DeviceFields["PLATFORM"] = "platform";
    DeviceFields["PLATFORM_VERSION"] = "platformVersion";
    DeviceFields["SDK_VERSION"] = "sdkVersion";
})(DeviceFields || (DeviceFields = {}));
/**
 * Information describing the device, app and SDK.
 */
class DeviceInformation {
    /**
     * @param params Construct the device information from these parameters.
     */
    constructor({ appId, appVersion, deviceId, }) {
        /**
         * The version of the Realm Web SDK (constant provided by Rollup).
         */
        this.sdkVersion = "1.2.1";
        const environment = getEnvironment();
        this.platform = environment.platform;
        this.platformVersion = environment.platformVersion;
        this.appId = appId;
        this.appVersion = appVersion;
        this.deviceId = deviceId;
    }
    /**
     * @returns An base64 URI encoded representation of the device information.
     */
    encode() {
        const obj = removeKeysWithUndefinedValues(this);
        return base64.Base64.encode(JSON.stringify(obj));
    }
    /**
     * @returns The defaults
     */
    toJSON() {
        return removeKeysWithUndefinedValues(this);
    }
}

////////////////////////////////////////////////////////////////////////////
/**
 * Default base url to prefix all requests if no baseUrl is specified in the configuration.
 */
const DEFAULT_BASE_URL = "https://stitch.mongodb.com";
/**
 * MongoDB Realm App
 */
class App {
    /**
     * Construct a Realm App, either from the Realm App id visible from the MongoDB Realm UI or a configuration.
     *
     * @param idOrConfiguration The Realm App id or a configuration to use for this app.
     */
    constructor(idOrConfiguration) {
        /**
         * An array of active and logged-out users.
         * Elements in the beginning of the array is considered more recent than the later elements.
         */
        this.users = [];
        /**
         * A promise resolving to the App's location url.
         */
        this._locationUrl = null;
        // If the argument is a string, convert it to a simple configuration object.
        const configuration = typeof idOrConfiguration === "string"
            ? { id: idOrConfiguration }
            : idOrConfiguration;
        // Initialize properties from the configuration
        if (typeof configuration === "object" &&
            typeof configuration.id === "string") {
            this.id = configuration.id;
        }
        else {
            throw new Error("Missing a MongoDB Realm app-id");
        }
        this.baseUrl = configuration.baseUrl || DEFAULT_BASE_URL;
        this.localApp = configuration.app;
        const { storage, transport = new DefaultNetworkTransport(), } = configuration;
        // Construct a fetcher wrapping the network transport
        this.fetcher = new Fetcher({
            appId: this.id,
            userContext: this,
            locationUrlContext: this,
            transport,
        });
        // Construct the auth providers
        this.emailPasswordAuth = new EmailPasswordAuth(this.fetcher);
        // Construct the storage
        const baseStorage = storage || getEnvironment().defaultStorage;
        this.storage = new AppStorage(baseStorage, this.id);
        this.authenticator = new Authenticator(this.fetcher, baseStorage, () => this.deviceInformation);
        // Hydrate the app state from storage
        try {
            this.hydrate();
        }
        catch (err) {
            // The storage was corrupted
            this.storage.clear();
            // A failed hydration shouldn't throw and break the app experience
            // Since this is "just" persisted state that unfortunately got corrupted or partially lost
            console.warn("Realm app hydration failed:", err.message);
        }
    }
    /**
     * Get or create a singleton Realm App from an id.
     * Calling this function multiple times with the same id will return the same instance.
     *
     * @param id The Realm App id visible from the MongoDB Realm UI or a configuration.
     * @returns The Realm App instance.
     */
    static getApp(id) {
        if (id in App.appCache) {
            return App.appCache[id];
        }
        else {
            const instance = new App(id);
            App.appCache[id] = instance;
            return instance;
        }
    }
    /**
     * Switch user.
     *
     * @param nextUser The user or id of the user to switch to.
     */
    switchUser(nextUser) {
        const index = this.users.findIndex(u => u === nextUser);
        if (index === -1) {
            throw new Error("The user was never logged into this app");
        }
        // Remove the user from the stack
        const [user] = this.users.splice(index, 1);
        // Insert the user in the beginning of the stack
        this.users.unshift(user);
    }
    /**
     * Log in a user.
     *
     * @param credentials Credentials to use when logging in.
     * @param fetchProfile Should the users profile be fetched? (default: true)
     */
    async logIn(credentials, fetchProfile = true) {
        const response = await this.authenticator.authenticate(credentials);
        const user = this.createOrUpdateUser(response, credentials.providerType);
        // Let's ensure this will be the current user, in case the user object was reused.
        this.switchUser(user);
        // If neeeded, fetch and set the profile on the user
        if (fetchProfile) {
            await user.refreshProfile();
        }
        // Persist the user id in the storage,
        // merging to avoid overriding logins from other apps using the same underlying storage
        this.storage.setUserIds(this.users.map(u => u.id), true);
        // Read out and store the device id from the server
        const deviceId = response.deviceId;
        if (deviceId && deviceId !== "000000000000000000000000") {
            this.storage.set(DEVICE_ID_STORAGE_KEY$1, deviceId);
        }
        // Return the user
        return user;
    }
    /**
     * @inheritdoc
     */
    async removeUser(user) {
        // Remove the user from the list of users
        const index = this.users.findIndex(u => u === user);
        if (index === -1) {
            throw new Error("The user was never logged into this app");
        }
        this.users.splice(index, 1);
        // Log out the user - this removes access and refresh tokens from storage
        await user.logOut();
        // Remove the users profile from storage
        this.storage.remove(`user(${user.id}):profile`);
        // Remove the user from the storage
        this.storage.removeUserId(user.id);
    }
    /**
     * The currently active user (or null if no active users exists).
     *
     * @returns the currently active user or null.
     */
    get currentUser() {
        const activeUsers = this.users.filter(user => user.state === UserState.Active);
        if (activeUsers.length === 0) {
            return null;
        }
        else {
            // Current user is the top of the stack
            return activeUsers[0];
        }
    }
    /**
     * All active and logged-out users:
     *  - First in the list are active users (ordered by most recent call to switchUser or login)
     *  - Followed by logged out users (also ordered by most recent call to switchUser or login).
     *
     * @returns An array of users active or loggedout users (current user being the first).
     */
    get allUsers() {
        // Returning a freezed copy of the list of users to prevent outside changes
        return Object.fromEntries(this.users.map(user => [user.id, user]));
    }
    /**
     * @returns A promise of the app URL, with the app location resolved.
     */
    get locationUrl() {
        if (!this._locationUrl) {
            const path = routes.api().app(this.id).location().path;
            this._locationUrl = this.fetcher
                .fetchJSON({
                method: "GET",
                url: this.baseUrl + path,
                tokenType: "none",
            })
                .then(({ hostname }) => {
                if (typeof hostname !== "string") {
                    throw new Error("Expected response to contain a 'hostname'");
                }
                else {
                    return hostname;
                }
            })
                .catch(err => {
                // Reset the location to allow another request to fetch again.
                this._locationUrl = null;
                throw err;
            });
        }
        return this._locationUrl;
    }
    /**
     * @returns Information about the current device, sent to the server when authenticating.
     */
    get deviceInformation() {
        const deviceIdStr = this.storage.getDeviceId();
        const deviceId = typeof deviceIdStr === "string" &&
            deviceIdStr !== "000000000000000000000000"
            ? new bson_11(deviceIdStr)
            : undefined;
        return new DeviceInformation({
            appId: this.localApp ? this.localApp.name : undefined,
            appVersion: this.localApp ? this.localApp.version : undefined,
            deviceId,
        });
    }
    /**
     * Create (and store) a new user or update an existing user's access and refresh tokens.
     * This helps de-duplicating users in the list of users known to the app.
     *
     * @param response A response from the Authenticator.
     * @param providerType The type of the authentication provider used.
     * @returns A new or an existing user.
     */
    createOrUpdateUser(response, providerType) {
        const existingUser = this.users.find(u => u.id === response.userId);
        if (existingUser) {
            // Update the users access and refresh tokens
            existingUser.accessToken = response.accessToken;
            existingUser.refreshToken = response.refreshToken;
            return existingUser;
        }
        else {
            // Create and store a new user
            if (!response.refreshToken) {
                throw new Error("No refresh token in response from server");
            }
            const user = new User({
                app: this,
                id: response.userId,
                accessToken: response.accessToken,
                refreshToken: response.refreshToken,
                providerType,
            });
            this.users.unshift(user);
            return user;
        }
    }
    /**
     * Restores the state of the app (active and logged-out users) from the storage
     */
    hydrate() {
        const userIds = this.storage.getUserIds();
        this.users = userIds.map(id => new User({ app: this, id }));
    }
}
/**
 * A map of app instances returned from calling getApp.
 */
App.appCache = {};
/**
 * Instances of this class can be passed to the `app.logIn` method to authenticate an end-user.
 */
App.Credentials = Credentials;

////////////////////////////////////////////////////////////////////////////
/**
 * Get or create a singleton Realm App from an id.
 * Calling this function multiple times with the same id will return the same instance.
 *
 * @param id The Realm App id visible from the MongoDB Realm UI or a configuration.
 * @returns The Realm App instance.
 */
function getApp(id) {
    return App.getApp(id);
}

////////////////////////////////////////////////////////////////////////////
/**
 * In-memory storage that will not be persisted.
 */
class LocalStorage {
    /**
     * Constructs a LocalStorage using the global window.
     */
    constructor() {
        if (typeof window === "object") {
            this.window = window;
        }
        else {
            throw new Error("Cannot use LocalStorage without a global window object");
        }
    }
    /** @inheritdoc */
    get(key) {
        return this.window.localStorage.getItem(key);
    }
    /** @inheritdoc */
    set(key, value) {
        return this.window.localStorage.setItem(key, value);
    }
    /** @inheritdoc */
    remove(key) {
        return this.window.localStorage.removeItem(key);
    }
    /** @inheritdoc */
    prefix(keyPart) {
        return new PrefixedStorage(this, keyPart);
    }
    /** @inheritdoc */
    clear(prefix) {
        const keys = [];
        // Iterate all keys to find the once have a matching prefix.
        for (let i = 0; i < this.window.localStorage.length; i++) {
            const key = this.window.localStorage.key(i);
            if (key && (!prefix || key.startsWith(prefix))) {
                keys.push(key);
            }
        }
        // Remove the items in a seperate loop to avoid updating while iterating.
        for (const key of keys) {
            this.window.localStorage.removeItem(key);
        }
    }
    /** @inheritdoc */
    addListener(listener) {
        return this.window.addEventListener("storage", listener);
    }
    /** @inheritdoc */
    removeListener(listener) {
        return this.window.removeEventListener("storage", listener);
    }
}

////////////////////////////////////////////////////////////////////////////
const bundle_dom_es_browser = detect();
const environment$1 = {
    defaultStorage: new LocalStorage().prefix("realm-web"),
    openWindow: url => window.open(url),
    platform: (bundle_dom_es_browser === null || bundle_dom_es_browser === void 0 ? void 0 : bundle_dom_es_browser.name) || "web",
    platformVersion: (bundle_dom_es_browser === null || bundle_dom_es_browser === void 0 ? void 0 : bundle_dom_es_browser.version) || "0.0.0",
    TextDecoder,
};
setEnvironment(environment$1);
/**
 * Handle an OAuth 2.0 redirect.
 *
 * @param location An optional location to use (defaults to the windows current location).
 * @param storage Optional storage used to save any results from the location.
 */
function handleAuthRedirect(location = window.location, storage = environment$1.defaultStorage) {
    try {
        const queryString = location.hash.substr(1); // Strip the initial # from the hash
        OAuth2Helper.handleRedirect(queryString, storage);
    }
    catch (err) {
        // Ensure calling this never throws: It should not interrupt a users flow.
        console.warn(err);
    }
}



;// CONCATENATED MODULE: ./src/libraries/js/src/ui/login.js
function login_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function login_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { login_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { login_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

// Auth
 // import googleOneTap from 'google-one-tap';
// let mongodb = {
//     collection: "profiles",
//     service: "mongodb-atlas",
//     database: "brainsatplay"
// }
// .get("mongodb-atlas")

var app = new App("brainsatplay-tvmdj");
var client_id = "354011508571-521lgm8ulo8nl6bevis1n94nlekf44ge.apps.googleusercontent.com";
var redirectUri = "".concat(window.location.origin, "/");
var credentials = Credentials.google(redirectUri);
var LoginWithGoogle = /*#__PURE__*/function () {
  var _ref = login_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
    var response, authResponse;
    return regeneratorRuntime.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.next = 2;
            return window.gapi.auth2.getAuthInstance().signIn();

          case 2:
            response = _context.sent;
            authResponse = response.getAuthResponse();
            return _context.abrupt("return", authResponse);

          case 5:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  }));

  return function LoginWithGoogle() {
    return _ref.apply(this, arguments);
  };
}();
var LoginWithRealm = /*#__PURE__*/function () {
  var _ref2 = login_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(authResponse) {
    var _app$currentUser;

    var user, _credentials, data;

    return regeneratorRuntime.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            if (!((_app$currentUser = app.currentUser) !== null && _app$currentUser !== void 0 && _app$currentUser.isLoggedIn)) {
              _context2.next = 4;
              break;
            }

            user = app.currentUser;
            _context2.next = 9;
            break;

          case 4:
            _credentials = Credentials.google(authResponse.id_token);
            _credentials.payload.redirectUrl = redirectUri;
            _context2.next = 8;
            return app.logIn(_credentials);

          case 8:
            user = _context2.sent;

          case 9:
            _context2.next = 11;
            return user.refreshCustomData();

          case 11:
            data = _context2.sent;
            return _context2.abrupt("return", user);

          case 13:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  }));

  return function LoginWithRealm(_x) {
    return _ref2.apply(this, arguments);
  };
}();
var login_handleAuthRedirect = function handleAuthRedirect() {
  return Realm.handleAuthRedirect();
}; // // Open the Google One Tap menu
// export const LoginWithGoogle = () => {
//     googleOneTap({ client_id }, async (response) => {
//     const credentials = Realm.Credentials.google(response.credential)
//     const user = await app.logIn(credentials);
//     console.log(`Logged in with id: ${user.id}`);
//     });
// }
;// CONCATENATED MODULE: ./src/libraries/js/src/Session.js
function Session_toConsumableArray(arr) { return Session_arrayWithoutHoles(arr) || Session_iterableToArray(arr) || Session_unsupportedIterableToArray(arr) || Session_nonIterableSpread(); }

function Session_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function Session_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function Session_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return Session_arrayLikeToArray(arr); }

function Session_slicedToArray(arr, i) { return Session_arrayWithHoles(arr) || Session_iterableToArrayLimit(arr, i) || Session_unsupportedIterableToArray(arr, i) || Session_nonIterableRest(); }

function Session_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function Session_iterableToArrayLimit(arr, i) { var _i = arr && (typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]); if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function Session_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function Session_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = Session_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }

function Session_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return Session_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return Session_arrayLikeToArray(o, minLen); }

function Session_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function Session_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function Session_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { Session_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { Session_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function Session_typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { Session_typeof = function _typeof(obj) { return typeof obj; }; } else { Session_typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return Session_typeof(obj); }

function Session_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function Session_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function Session_createClass(Constructor, protoProps, staticProps) { if (protoProps) Session_defineProperties(Constructor.prototype, protoProps); if (staticProps) Session_defineProperties(Constructor, staticProps); return Constructor; }

/*
//By Joshua Brewster, Garrett Flynn (GPL)

Stack notes:
Data Streams
- Local hardware
  -- Serial
  -- BLE
  -- Sockets/SSEs
- Server
  -- Hardware and Session state data via Websockets

Data Processing 
- eegworker.js, eegmath, bcijs, etc.

Data State
- Sort raw/filtered data
- Sort processed data
- Handle streaming data from other users

UI Templating
- StateManager.js
- UIManager.js
- ObjectListener.js
- DOMFragment.js

Local Storage
- BrowserFS for IndexedDB
- CSV saving/parsing

Frontend Execution
- UI State
- Server State
- Session/App State(s)

*/
 //fixes async calls in this bundler
// Default CSS Stylesheet

 // UI

 // Managers


 // Device Plugins

 // Plugins

 // MongoDB Realm


 // Default Styling
// import './ui/styles/defaults.css'

/**
 * ```javascript
 * import {Session} from 'brainsatplay'
 * ```
 */

var Session = /*#__PURE__*/function () {
  /**
      * @constructor 
      * @alias module:brainsatplay.Session
      * @description Class for server/socket connecting and macro controls for device streaming and data accessibilty.
      * @param {string} username Username
      * @param {string} password Password
      * @param {string} urlToConnect URL to connect to 
   * @example session = new Session();
      */

  /**
  * ```javascript
  * let session = new Session();
  * ```
  */
  function Session() {
    var _this = this;

    var username = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'guest';
    var password = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
    var urlToConnect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'https://server.brainsatplay.com';

    Session_classCallCheck(this, Session);

    this.onconnected = function () {};

    this.ondisconnected = function () {};

    this.autoselectDevice = function (autoselect) {
      var cleanDeviceString = autoselect.device.replace(/[|&;$%@"<>()+,]/g, "").replace(' ', '');
      var variantName = autoselect.variant != '' ? "".concat(cleanDeviceString, "_").concat(autoselect.variant) : cleanDeviceString;
      document.getElementById("brainsatplay-".concat(variantName)).click();
    };

    this.getDeviceData = function () {
      var deviceType = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'eeg';
      var tag = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'all';
      var deviceIdx = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;

      //get device data. Just leave deviceIdx blank unless you have multiple of the same device type connected
      _this.deviceStreams.forEach(function (d, i) {
        if (d.info.deviceType.indexOf(deviceType) > -1 && d.info.deviceNum === deviceIdx) {
          if (tag === 'all') {
            return d.atlas.data[deviceType]; //Return all objects
          }

          return d.atlas.getDeviceDataByTag(deviceType, tag);
        }
      });
    };

    this.subscribe = function () {
      var deviceName = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'eeg';
      var tag = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'FP1';
      var prop = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
      var onData = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function (newData) {};
      var sub = undefined;
      var atlasTag = tag;
      var atlasDataProp = null;

      if (deviceName.toLowerCase().indexOf('eeg') > -1 || deviceName.toLowerCase().indexOf('muse') > -1 || deviceName.toLowerCase().indexOf('notion') > -1) {
        //etc
        atlasDataProp = 'eeg';

        if (atlasTag === 'shared') {
          atlasTag = 'eeghared';
        }
      } else if (deviceName.toLowerCase().indexOf('heg') > -1) {
        atlasDataProp = 'heg';

        if (atlasTag === 'shared') {
          atlasTag = 'hegshared';
        }
      }

      if (atlasDataProp !== null) {
        var device = _this.deviceStreams.find(function (o, i) {
          if (o.info.deviceName.indexOf(deviceName) > -1 && o.info.useAtlas === true) {
            var coord = undefined;

            if (typeof atlasTag === 'string') {
              if (atlasTag.indexOf('shared') > -1) coord = o.device.atlas.getDeviceDataByTag(atlasTag, null);
            } else if (atlasTag === null || atlasTag === 'all') {
              coord = o.device.atlas.data[atlasDataProp];
            } //Subscribe to entire data object 
            else coord = o.device.atlas.getDeviceDataByTag(atlasDataProp, atlasTag);

            if (coord !== undefined) {
              if (prop === null || Array.isArray(coord) || Session_typeof(coord[prop]) !== 'object') {
                sub = _this.state.addToState(atlasTag, coord, onData);
              } else if (Session_typeof(coord[prop]) === 'object') {
                //only works for objects which are stored by reference only (i.e. arrays or the means/slices/etc objects, so sub to the whole tag to follow the count)
                sub = _this.state.addToState(atlasTag + "_" + prop, coord[prop], onData);
              }
            }

            return true;
          }
        });
      }

      return sub;
    };

    this.unsubscribe = function () {
      var tag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'FP1';
      var sub = arguments.length > 1 ? arguments[1] : undefined;

      _this.state.unsubscribe(tag, sub);
    };

    this.unsubscribeAll = function () {
      var tag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'FP1';

      _this.state.unsubscribeAll(tag);
    };

    this.getApp = function () {
      return App.getApp("brainsatplay-tvmdj");
    };

    this.loginWithGoogle = /*#__PURE__*/Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return LoginWithGoogle();

            case 2:
              return _context.abrupt("return", _context.sent);

            case 3:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    this.loginWithRealm = /*#__PURE__*/function () {
      var _ref2 = Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(authResponse) {
        var user;
        return regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return LoginWithRealm(authResponse);

              case 2:
                user = _context2.sent;
                _this.info.googleAuth = user;
                return _context2.abrupt("return", user);

              case 5:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2);
      }));

      return function (_x) {
        return _ref2.apply(this, arguments);
      };
    }();

    this.promptLogin = /*#__PURE__*/Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {
      var parentNode,
          onsuccess,
          _args3 = arguments;
      return regeneratorRuntime.wrap(function _callee3$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              parentNode = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : document.body;
              onsuccess = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : function () {};
              return _context3.abrupt("return", new Promise(function (resolve, reject) {
                var template = function template() {
                  return "\n\t\t<div id=\"".concat(_this.id, "login-page\" class=\"brainsatplay-default-container\" style=\"z-index: 1000; opacity: 0; transition: opacity 1s;\">\n\t\t\t<div>\n\t\t\t\t<h2>Choose your Username</h2>\n\t\t\t\t<div id=\"").concat(_this.id, "login-container\" class=\"brainsatplay-form-container\">\n\t\t\t\t\t<div id=\"").concat(_this.id, "login\" class=\"brainsatplay-form-context\">\n\t\t\t\t\t\t<p id=\"").concat(_this.id, "login-message\" class=\"small\"></p>\n\t\t\t\t\t\t<div class='flex'>\n\t\t\t\t\t\t\t<form id=\"").concat(_this.id, "login-form\" class=\"brainsatplay-form\" action=\"\">\n\t\t\t\t\t\t\t\t<div class=\"brainsatplay-login-element\" style=\"margin-left: 0px; margin-right: 0px\">\n\t\t\t\t\t\t\t\t\t<input type=\"text\" name=\"username\" autocomplete=\"off\" placeholder=\"Enter a username\"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"brainsatplay-login-buttons\" style=\"justify-content: flex-start;\">\n\t\t\t\t\t\t\t<div id=\"").concat(_this.id, "login-button\" class=\"brainsatplay-default-button\">Sign In</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t");
                };

                var setup = function setup() {
                  var loginPage = document.getElementById("".concat(_this.id, "login-page"));
                  var loginButton = loginPage.querySelector("[id='".concat(_this.id, "login-button']"));
                  var form = loginPage.querySelector("[id='".concat(_this.id, "login-form']"));
                  var usernameInput = form.querySelector('input');
                  form.addEventListener("keyup", function (event) {
                    if (event.keyCode === 13) {
                      event.preventDefault();
                    }
                  });
                  usernameInput.addEventListener("keyup", function (event) {
                    if (event.keyCode === 13) {
                      event.preventDefault();
                      loginButton.click();
                    }
                  });

                  loginButton.onclick = function () {
                    var formDict = {};
                    var formData = new FormData(form);

                    var _iterator = Session_createForOfIteratorHelper(formData.entries()),
                        _step;

                    try {
                      for (_iterator.s(); !(_step = _iterator.n()).done;) {
                        var pair = _step.value;
                        formDict[pair[0]] = pair[1];
                      }
                    } catch (err) {
                      _iterator.e(err);
                    } finally {
                      _iterator.f();
                    }

                    _this.setLoginInfo(formDict.username);

                    _this.login(true, _this.info.auth, function () {
                      onsuccess();
                      resolve(true);
                      setTimeout(function () {
                        ui.deleteNode();
                      }, 1000);
                    });
                  }; // Auto-set username with Google Login


                  // Auto-set username with Google Login
                  if (_this.info.googleAuth != null) {
                    _this.info.googleAuth.refreshCustomData().then(function (data) {
                      loginPage.querySelector("[name='username']")[0].value = data.username;
                      loginButton.click();
                    });
                  }

                  loginPage.style.transition = 'opacity 1s';
                  loginPage.style.opacity = '1';
                };

                var ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
              }));

            case 3:
            case "end":
              return _context3.stop();
          }
        }
      }, _callee3);
    }));

    this.createBrainstormBrowser = function () {
      var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
      var onsubscribe = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};
      var t = 1;

      var template = function template() {
        return "\n\t\t\t<div id=\"".concat(_this.id, "-brainstormBrowser\" style=\"z-index: 1000; background: black; width:100%; height: 100%; position: absolute; top: 0; left: 0; display:flex; align-items: center; justify-content: center; opacity: 0;\">\n\t\t\t\t<div id=\"").concat(_this.id, "-choiceDisplay\" style=\"flex-grow: 1;\">\n\t\t\t\t\t<h1>Browse the Brainstorm</h1>\n\t\t\t\t\t<div style=\"display: flex;\">\n\t\t\t\t\t\t<div id=\"").concat(_this.id, "-userDiv\" style=\"flex-grow: 1; overflow-y: scroll; border: 1px solid white;\">\n\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id=\"").concat(_this.id, "-controlsDiv\" style=\"overflow-y: scroll; width: 200px; display: flex; flex-wrap: wrap; justify-content: center;\">\n\t\t\t\t\t\t\t<button name=\"users\" class=\"brainsatplay-default-button\" style=\"margin: 12.5px 25px;\">WebSocket</button>\n\t\t\t\t\t\t\t<button name=\"osc\" class=\"brainsatplay-default-button\" style=\"margin: 12.5px 25px;\">OSC</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<button id=\"").concat(_this.id, "-exitBrowser\" class=\"brainsatplay-default-button\" style=\"position: absolute; bottom:25px; right: 25px;\">Go Back</button>\n\t\t\t</div>");
      };

      var setup = function setup() {
        var browser = document.getElementById("".concat(_this.id, "-brainstormBrowser"));
        var userDiv = browser.querySelector("[id='".concat(_this.id, "-userDiv']"));
        var controlsDiv = browser.querySelector("[id='".concat(_this.id, "-controlsDiv']"));
        var wsButton = controlsDiv.querySelector("[name='users']");
        var oscButton = controlsDiv.querySelector("[name='osc']");
        var lslButton = controlsDiv.querySelector("[name='lsl']");

        var closeUI = function closeUI() {
          browser.style.opacity = '0';
          window.removeEventListener('resize', resizeDisplay);
          setTimeout(function () {
            ui.deleteNode();
          }, t * 1000);
        };

        var resizeDisplay = function resizeDisplay() {
          var browser = document.getElementById("".concat(_this.id, "-brainstormBrowser"));
          var display = browser.querySelector("[id='".concat(_this.id, "-choiceDisplay']"));
          var userDiv = browser.querySelector("[id='".concat(_this.id, "-userDiv']"));
          var padding = 50;
          browser.style.padding = "".concat(padding, "px");
          userDiv.style.height = "".concat(window.innerHeight - 2 * padding - (display.offsetHeight - userDiv.offsetHeight), "px");
        };

        var exitBrowser = browser.querySelector("[id='".concat(_this.id, "-exitBrowser']"));
        exitBrowser.onclick = closeUI;
        resizeDisplay();
        window.addEventListener('resize', resizeDisplay);
        browser.style.transition = "opacity ".concat(t, "s");
        browser.style.opacity = '1';

        var updateUserDisplay = function updateUserDisplay(mode, users) {
          userDiv.innerHTML = '';
          var brainstormUserStyle = "\n\t\t\t\tbackground: rgb(20,20,20);\n\t\t\t\tpadding: 25px;\n\t\t\t\tborder: 1px solid black;\n\t\t\t\ttransition: 0.5s;\n\t\t\t";

          var onMouseOver = function onMouseOver() {
            _this.style.background = 'rgb(35,35,35)';
            _this.style.cursor = 'pointer';
          };

          var onMouseOut = function onMouseOut() {
            _this.style.background = 'rgb(20,20,20)';
            _this.style.cursor = 'default';
          };

          users.forEach(function (o) {
            var keys = Object.keys(o);
            var appMessage = o[keys[0]] == '' ? 'Idle' : "Currently in ".concat(o[keys[0]]);

            if (o[keys[1]] !== _this.info.auth.username) {
              userDiv.innerHTML += "\n\t\t\t\t\t\t<div  id=\"".concat(_this.id, "-user-").concat(o[keys[1]], "\" class=\"brainstorm-user\" style=\"").concat(brainstormUserStyle, "\" onMouseOver=\"(").concat(onMouseOver, ")()\" onMouseOut=\"(").concat(onMouseOut, ")()\">\n\t\t\t\t\t\t<p style=\"font-size: 60%;\">").concat(o[keys[2]], "</p>\n\t\t\t\t\t\t<p>").concat(o[keys[1]], "</p>\n\t\t\t\t\t\t<p style=\"font-size: 80%;\">").concat(appMessage, "</p>\n\t\t\t\t\t\t</div>");
            } else {
              userDiv.insertAdjacentHTML('afterbegin', "\n\t\t\t\t\t\t<div  id=\"".concat(_this.id, "-user-").concat(o[keys[1]], "\" class=\"brainstorm-user\" style=\"").concat(brainstormUserStyle, "\">\n\t\t\t\t\t\t\t<p style=\"font-size: 60%;\">").concat(o[keys[2]], "</p>\n\t\t\t\t\t\t\t<p>").concat(o[keys[1]], "</p>\n\t\t\t\t\t\t\t<p style=\"font-size: 80%;\">").concat(appMessage, "</p>\n\t\t\t\t\t\t</div>"));
            }
          });
          var divs = userDiv.querySelectorAll(".brainstorm-user");

          var _iterator2 = Session_createForOfIteratorHelper(divs),
              _step2;

          try {
            var _loop = function _loop() {
              var div = _step2.value;
              var name = div.id.split("".concat(_this.id, "-user-"))[1];

              if (name !== _this.info.auth.username) {
                div.onclick = function (e) {
                  if (mode == 'ws') {
                    _this.subscribeToUser(name, [], function (userData) {
                      onsubscribe(userData);
                    });
                  } else if (mode == 'osc') {
                    _this.sendBrainstormCommand(['sendOSC', {
                      test: 'connected'
                    }]);
                  }

                  closeUI();
                };
              }
            };

            for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
              _loop();
            }
          } catch (err) {
            _iterator2.e(err);
          } finally {
            _iterator2.f();
          }
        }; // Display All Users on Brainstorm


        wsButton.addEventListener('click', function () {
          _this.getUsers(null, function (userData) {
            updateUserDisplay('ws', userData);
          });
        }); // Check OSC Port

        oscButton.addEventListener('click', function () {
          _this.startOSC(undefined, undefined, undefined, undefined, function (oscInfo) {
            console.log(oscInfo);
            updateUserDisplay('osc', oscInfo);
          });
        });
        wsButton.click();
      };

      var ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
    };

    this.createIntro = function (applet) {
      var _ref4, _applet$subtitle;

      document.getElementById("".concat(applet.props.id)).innerHTML += "\n\t\t\t<div id='".concat(applet.props.id, "appHero' class=\"brainsatplay-default-container\" style=\"z-index: 6;\"><div>\n\t\t\t<h1>").concat(applet.info.name, "</h1>\n\t\t\t<p>").concat((_ref4 = (_applet$subtitle = applet.subtitle) !== null && _applet$subtitle !== void 0 ? _applet$subtitle : applet.info.intro.subtitle) !== null && _ref4 !== void 0 ? _ref4 : '', "</p>\n\t\t\t<div class=\"brainsatplay-intro-loadingbar\" style=\"z-index: 6;\"></div>\n\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div id='").concat(applet.props.id, "mode-screen' class=\"brainsatplay-default-container\" style=\"z-index: 5\"><div>\n\t\t\t\t<h2>Game Mode</h2>\n\t\t\t\t<div style=\"display: flex; align-items: center;\">\n\t\t\t\t\t\t<div id=\"").concat(applet.props.id, "solo-button\" class=\"brainsatplay-default-button\">Solo</div>\n\t\t\t\t\t\t<div id=\"").concat(applet.props.id, "multiplayer-button\" class=\"brainsatplay-default-button\">Multiplayer</div>\n\t\t\t\t</div>\n\t\t\t</div></div>\n\n\t\t\t<div id='").concat(applet.props.id, "login-screen' class=\"brainsatplay-default-container\" style=\"z-index: 4\"><div>\n\t\t\t\t<h2>Choose your Username</h2>\n\t\t\t\t<div id=\"").concat(applet.props.id, "login-container\" class=\"brainsatplay-form-container\">\n\t\t\t\t\t<div id=\"").concat(applet.props.id, "login\" class=\"brainsatplay-form-context\">\n\t\t\t\t\t\t<p id=\"").concat(applet.props.id, "login-message\" class=\"small\"></p>\n\t\t\t\t\t\t<div class='flex'>\n\t\t\t\t\t\t\t<form id=\"").concat(applet.props.id, "login-form\" class=\"brainsatplay-form\" action=\"\">\n\t\t\t\t\t\t\t\t<div class=\"brainsatplay-login-element\" style=\"margin-left: 0px; margin-right: 0px\">\n\t\t\t\t\t\t\t\t\t<input type=\"text\" name=\"username\" autocomplete=\"off\" placeholder=\"Enter a username\"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"brainsatplay-login-buttons\" style=\"justify-content: flex-start;\">\n\t\t\t\t\t\t\t<div id=\"").concat(applet.props.id, "login-button\" class=\"brainsatplay-default-button\">Sign In</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div></div>\n\n\t\t\t<div id='").concat(applet.props.id, "sessionSelection' class=\"brainsatplay-default-container\" style=\"z-index: 3\"><div>\n\t\t\t\t<div id='").concat(applet.props.id, "multiplayerDiv'\">\n\t\t\t\t<div style=\"\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tcolumn-gap: 15px;\n\t\t\t\tgrid-template-columns: repeat(2,1fr)\">\n\t\t\t\t\t<h2>Choose a Session</h2>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button id='").concat(applet.props.id, "createSession' class=\"brainsatplay-default-button\" style=\"flex-grow:0; padding: 10px; width: auto; min-height: auto; font-size: 70%;\">Make New Session</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div></div>\n\t\t\t<div id='").concat(applet.props.id, "exitSession' class=\"brainsatplay-default-button\" style=\"position: absolute; bottom: 25px; right: 25px;\">Exit Session</div>\n\t\t\t"); // Setup HTML References

      var modeScreen = document.getElementById("".concat(applet.props.id, "mode-screen"));
      var loginScreen = document.getElementById("".concat(applet.props.id, "login-screen"));
      var sessionSelection = document.getElementById("".concat(applet.props.id, "sessionSelection"));
      var exitSession = document.getElementById("".concat(applet.props.id, "exitSession"));
      var hero = document.getElementById("".concat(applet.props.id, "appHero"));
      var loadingBarElement = document.querySelector('.brainsatplay-intro-loadingbar'); // Select Mode

      var solo = modeScreen.querySelector("[id=\"".concat(applet.props.id, "solo-button\"]"));
      var multiplayer = modeScreen.querySelector("[id=\"".concat(applet.props.id, "multiplayer-button\"]"));

      solo.onclick = function () {
        modeScreen.style.opacity = 0;
        modeScreen.style.pointerEvents = 'none';
        sessionSelection.style.display = 'none';
        loginScreen.style.display = 'none';
        exitSession.style.display = 'none';
      };

      if (window.navigator.onLine) {
        multiplayer.onclick = function () {
          modeScreen.style.opacity = 0;
          modeScreen.style.pointerEvents = 'none';
        };
      } else {
        multiplayer.style.opacity = 0.25;
        multiplayer.style.pointerEvents = 'none';
      } // Autoselect


      if (applet.info.intro) {
        if (applet.info.intro.mode === 'single') solo.click();
        if (applet.info.intro.mode === 'multi') multiplayer.click();
      } // Create Session Brower


      var baseBrowserId = "".concat(applet.props.id).concat(applet.info.name);
      document.getElementById("".concat(applet.props.id, "multiplayerDiv")).innerHTML += "<button id='".concat(baseBrowserId, "search' class=\"brainsatplay-default-button\">Search</button>");
      document.getElementById("".concat(applet.props.id, "multiplayerDiv")).innerHTML += "<div id='".concat(baseBrowserId, "browserContainer' style=\"box-sizing: border-box; padding: 10px 0px; overflow-y: hidden; height: 100%; width: 100%;\"><div id='").concat(baseBrowserId, "browser' style='display: flex; align-items: center; width: 100%; font-size: 80%; overflow-x: scroll; box-sizing: border-box; padding: 25px 5%;'></div></div>");

      var waitForReturnedMsg = function waitForReturnedMsg(msgs) {
        var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};

        if (msgs.includes(_this.state.data.commandResult.msg)) {
          callback(_this.state.data.commandResult.msg);
        } else {
          setTimeout(function () {
            return waitForReturnedMsg(msgs, callback);
          }, 250);
        }
      };

      var onjoined = function onjoined() {
        sessionSelection.style.opacity = 0;
        sessionSelection.style.pointerEvents = 'none';
      };

      var onleave = function onleave() {
        sessionSearch.click();
        sessionSelection.style.opacity = 1;
        sessionSelection.style.pointerEvents = 'auto';
      };

      var sessionSearch = document.getElementById("".concat(baseBrowserId, "search"));

      sessionSearch.onclick = function () {
        _this.getSessions(applet.info.name, function (result) {
          var gridhtml = '';
          result.sessions.forEach(function (g, i) {
            if (g.usernames.length < 10) {
              // Limit connections to the same session server
              gridhtml += "<div><h3>" + g.id + "</h3><p>Streamers: " + g.usernames.length + "</p><div><button id='" + g.id + "connect' style=\"margin-top: 5px;\" class=\"brainsatplay-default-button\">Connect</button><input id='" + baseBrowserId + "spectate' type='checkbox' style=\"display: none\"></div></div>";
            } else {
              result.sessions.splice(i, 1);
            }
          });
          document.getElementById(baseBrowserId + 'browser').innerHTML = gridhtml;

          var connecToGame = function connecToGame(g) {
            var spectate = true;

            if (_this.atlas.settings.deviceConnected) {
              spectate = false;
            }

            _this.subscribeToSession(g.id, spectate, function (subresult) {
              onjoined(g);

              var leaveSession = function leaveSession() {
                _this.unsubscribeFromSession(g.id, function () {
                  onleave(g);
                });
              };

              exitSession.addEventListener('click', leaveSession);
            });
          };

          result.sessions.forEach(function (g) {
            var connectButton = document.getElementById("".concat(g.id, "connect"));
            connectButton.addEventListener('click', function () {
              connecToGame(g);
            });
          });
        });
      }; // Login Screen


      var loginButton = document.getElementById("".concat(applet.props.id, "login-button"));
      var form = document.getElementById("".concat(applet.props.id, "login-form"));
      var usernameInput = form.querySelector('input');
      form.addEventListener("keyup", function (event) {
        if (event.keyCode === 13) {
          event.preventDefault();
        }
      });
      usernameInput.addEventListener("keyup", function (event) {
        if (event.keyCode === 13) {
          event.preventDefault();
          loginButton.click();
        }
      });

      loginButton.onclick = function () {
        var form = document.getElementById("".concat(applet.props.id, "login-form"));
        var formDict = {};
        var formData = new FormData(form);

        var _iterator3 = Session_createForOfIteratorHelper(formData.entries()),
            _step3;

        try {
          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
            var pair = _step3.value;
            formDict[pair[0]] = pair[1];
          }
        } catch (err) {
          _iterator3.e(err);
        } finally {
          _iterator3.f();
        }

        var onsocketopen = function onsocketopen() {
          if (_this.socket.readyState === 1) {
            sessionSearch.click();

            var sub1 = _this.state.subscribe('commandResult', function (newResult) {
              if (newResult.msg === 'appNotFound') {
                createSession.click();

                var sub2 = _this.state.subscribe('commandResult', function (newResult) {
                  if (newResult.msg === 'sessionCreated') {
                    sessionSearch.click();
                    loginScreen.style.opacity = 0;
                    loginScreen.style.pointerEvents = 'none';

                    _this.state.unsubscribe('commandResult', sub2);
                  }
                });

                _this.state.unsubscribe('commandResult', sub1);
              } else if (true) {
                _this.state.unsubscribe('commandResult', sub1);

                loginScreen.style.opacity = 0;
                loginScreen.style.pointerEvents = 'none';
              }
            });
          } else {
            setTimeout(function () {
              onsocketopen();
            }, 500);
          }
        };

        _this.setLoginInfo(formDict.username);

        _this.login(true).then(function () {
          onsocketopen(_this.socket);
        });
      }; // Auto-set username with Google Login


      if (_this.info.googleAuth != null) {
        _this.info.googleAuth.refreshCustomData().then(function (data) {
          document.getElementsByName("username")[0].value = data.username;
          loginButton.click();
        });
      }

      exitSession.onclick = function () {
        sessionSelection.style.opacity = 1;
        sessionSelection.style.pointerEvents = 'auto';
      };

      var createSession = document.getElementById("".concat(applet.props.id, "createSession"));

      createSession.onclick = function () {
        _this.sendBrainstormCommand(['createSession', applet.info.name, applet.info.devices, Array.from(applet.streams)]);

        waitForReturnedMsg(['sessionCreated'], function () {
          sessionSearch.click();
        });
      }; // createSession.style.display = 'none'


      sessionSearch.style.display = 'none';
      var loaded = 0;
      var loadInc = 5;
      var loadTime = 3000;
      setTimeout(function () {
        loadingBarElement.style.transition = "transform ".concat((loadTime - 1000) / 1000, "s");
        loadingBarElement.style.transform = "scaleX(1)";
      }, 1000);
      setTimeout(function () {
        if (loadingBarElement) {
          loadingBarElement.classList.add('ended');
          loadingBarElement.style.transform = '';
        }

        var hero = document.getElementById("".concat(applet.props.id, "appHero"));

        if (hero) {
          hero.style.opacity = 0;
          hero.style.pointerEvents = 'none';
        }
      }, loadTime);
    };

    this.kickUserFromSession = function (sessionid, userToKick) {
      var onsuccess = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (newResult) {};

      if (_this.socket !== null && _this.socket.readyState === 1) {
        _this.sendBrainstormCommand(['leaveSession', sessionid, userToKick]);

        var sub = _this.state.subscribe('commandResult', function (newResult) {
          if (newResult.msg === 'leftSession' && newResult.id === sessionid) {
            for (var prop in _this.state.data) {
              if (prop.indexOf(userToKick) > -1) {
                _this.state.removeState(prop);
              }
            }

            onsuccess(newResult);

            _this.state.unsubscribe('commandResult', sub);
          }
        });
      }
    };

    this.waitForOpenConnection = function (socket) {
      return new Promise(function (resolve, reject) {
        var maxNumberOfAttempts = 10;
        var intervalTime = 200; //ms

        var currentAttempt = 0;
        var interval = setInterval(function () {
          if (currentAttempt > maxNumberOfAttempts - 1) {
            clearInterval(interval);
            reject(new Error('Maximum number of attempts exceeded'));
          } else if (socket.readyState === socket.OPEN) {
            clearInterval(interval);
            resolve();
          }

          currentAttempt++;
        }, intervalTime);
      });
    };

    this.deviceStreams = [];
    this.state = new StateManager({
      commandResult: {}
    });
    this.atlas = new DataAtlas_DataAtlas('atlas', undefined, undefined, true, false);
    this.info = {
      nDevices: 0,
      auth: {
        url: new URL(urlToConnect),
        username: username,
        password: password,
        authenticated: false
      },
      subscriptions: []
    };
    this.id = Math.floor(Math.random() * 10000); // Give the session an ID

    this.socket = null;
    this.streamObj = new streamSession(this.info);
    this.streamObj.deviceStreams = this.deviceStreams; //reference the same object

    this.graphs = new PluginManager(this);
  }
  /**
      * @method module:brainsatplay.Session.setLoginInfo
      * @description Set user information.
      * @param {string} username Username.
      * @param {string} password Password.
      * @param {string} appname Name of the app.
      */


  Session_createClass(Session, [{
    key: "setLoginInfo",
    value: function setLoginInfo() {
      var username = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'guest';
      var password = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
      this.info.auth.username = username;
      this.info.auth.password = password;
    }
    /**
        * @method module:brainsatplay.Session.setLoginInfo
        * @description Connect local device and add it. Use [reconnect()]{@link module:brainsatplay.Session.reconnect} if disconnecting and reconnecting device in same session.
        * @param {string} device "freeeeg32", "freeeeg32_19", "muse", "notion"
        * @param {array} analysis "eegfft", "eegcoherence", etc
     * @param {callback} onconnect Callback function on device connection. Subscribe to device outputs after connection completed.
        * @param {callback} ondisconnect Callback function on device disconnection. Unsubscribe from outputs after device is disconnected.
        * @param {boolean} streaming Set to stream to server (must be connected)
        * @param {array} streamParams e.g. [['eegch','FP1','all']]
        * @param {boolean} useFilters Filter device output if it needs filtering (some hardware already applies filters so we may skip those).
        * @param {boolean} pipeToAtlas Send data to atlas.
     */
    //

  }, {
    key: "connect",
    value: function () {
      var _connect = Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {
        var _this2 = this;

        var device,
            analysis,
            onconnect,
            ondisconnect,
            streaming,
            streamParams,
            useFilters,
            pipeToAtlas,
            found,
            newStream,
            i,
            _args4 = arguments;
        return regeneratorRuntime.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                device = _args4.length > 0 && _args4[0] !== undefined ? _args4[0] : "freeeeg32_2";
                analysis = _args4.length > 1 && _args4[1] !== undefined ? _args4[1] : ['eegfft'];
                onconnect = _args4.length > 2 && _args4[2] !== undefined ? _args4[2] : function () {};
                ondisconnect = _args4.length > 3 && _args4[3] !== undefined ? _args4[3] : function () {};
                streaming = _args4.length > 4 && _args4[4] !== undefined ? _args4[4] : false;
                streamParams = _args4.length > 5 && _args4[5] !== undefined ? _args4[5] : [];
                useFilters = _args4.length > 6 && _args4[6] !== undefined ? _args4[6] : true;
                pipeToAtlas = _args4.length > 7 && _args4[7] !== undefined ? _args4[7] : true;

                if (!(streaming === true)) {
                  _context4.next = 12;
                  break;
                }

                if (!(this.socket == null || this.socket.readyState !== 1)) {
                  _context4.next = 12;
                  break;
                }

                console.error('Server connection not found, please run login() first');
                return _context4.abrupt("return", false);

              case 12:
                if (this.deviceStreams.length > 0) {
                  if (device.indexOf('eeg') > -1 || device.indexOf('muse') > -1) {
                    found = this.deviceStreams.find(function (o, i) {
                      //multiple EEGs get their own atlases just to uncomplicate things. Will need to generalize more later for other multi channel devices with shared preconfigurations if we want to try to connect multiple
                      if (o.deviceType === 'eeg') {
                        return true;
                      }
                    });
                    if (!found) pipeToAtlas = this.deviceStreams[0].device.atlas;
                  }
                }

                if (device.includes('brainstorm')) {
                  // this.deviceStreams.push(
                  newStream = new deviceStream(device, analysis, useFilters, pipeToAtlas, this.info.auth, this); // );
                } else {
                  // this.deviceStreams.push(
                  newStream = new deviceStream(device, analysis, useFilters, pipeToAtlas, this.info.auth); // );
                }

                i = this.deviceStreams.length;

                newStream.onconnect = function () {
                  _this2.deviceStreams.push(newStream);

                  if (_this2.deviceStreams.length === 1) _this2.atlas = _this2.deviceStreams[0].device.atlas; //change over from dummy atlas

                  _this2.info.nDevices++;

                  if (streamParams[0]) {
                    _this2.beginStream(streamParams);
                  } //Device info accessible from state


                  _this2.state.addToState("device" + (i + 1), newStream.info);

                  onconnect(newStream);

                  _this2.onconnected();
                };

                newStream.ondisconnect = function () {
                  ondisconnect(newStream);

                  _this2.ondisconnected();

                  if (newStream.info.analysis.length > 0) {
                    newStream.device.atlas.analyzing = false; //cancel analysis loop
                  }

                  _this2.deviceStreams.splice(i + 1, 1);

                  if (_this2.deviceStreams.length > 1) _this2.atlas = _this2.deviceStreams[0].device.atlas;
                  _this2.info.nDevices--;
                }; // Wait for Initialization before Connection


                _context4.next = 19;
                return newStream.init();

              case 19:
                _context4.next = 21;
                return newStream.connect();

              case 21:
                return _context4.abrupt("return", newStream);

              case 22:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function connect() {
        return _connect.apply(this, arguments);
      }

      return connect;
    }()
  }, {
    key: "reconnect",
    value:
    /**
        * @method module:brainsatplay.Session.reconnect
        * @description Reconnect a device that has already been added.
        * @param {int} deviceIdx Index of device.
     * @param {callback} onconnect Callback function on device reconnection. 
     */
    function reconnect() {
      var deviceIdx = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.deviceStreams.length - 1;
      var onconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};

      if (deviceIdx > -1) {
        this.deviceStreams[deviceIdx].connect();
        onconnect();
      } else {
        console.log("No devices connected");
      }
    }
    /**
        * @method module:brainsatplay.Session.disconnect
        * @description Disconnect local device.
        * @param {int} deviceIdx Index of device.
     * @param {callback} ondisconnect Callback function on device disconnection. 
     */

  }, {
    key: "disconnect",
    value: function disconnect() {
      var deviceIdx = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.deviceStreams.length - 1;
      var ondisconnect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};

      if (deviceIdx > -1) {
        this.deviceStreams[deviceIdx].disconnect();
        ondisconnect();
      } else {
        console.log("No devices connected");
      }
    }
    /**
        * @method module:brainsatplay.Session.connectDevice
        * @description Generate DOM fragment with a selector for available devices.
     * @param {HTMLElement} parentNode Parent node to insert fragment into.
     * @param {HTMLElement} toggleButton Node of button to toggle
     * @param {callback} onconnect Callback function on device connection. 
     * @param {callback} ondisconnect Callback function on device disconnection. 
     */

  }, {
    key: "connectDevice",
    value: function connectDevice() {
      var _this3 = this;

      var parentNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.body;
      var toggleButton = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
      var deviceFilter = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
      var autoselect = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;
      var onconnect = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : /*#__PURE__*/Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5() {
        return regeneratorRuntime.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5);
      }));
      var ondisconnect = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : function () {};

      var template = function template() {
        return "\n\t\t<div id=\"".concat(_this3.id, "DeviceSelection\"  class=\"brainsatplay-default-menu\" style=\"z-index: 999; width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; opacity: 0; pointer-events: none; transition: opacity 1s;\">\n\t\t\t<div style=\"width: 100%; height: 100%; background: black; opacity: 0.8; position: absolute; top: 0; left: 0;\"></div>\n\t\t\t<div class=\"main\" style=\"padding: 50px; width: 100%; height: 100%; position: absolute; top: 0; left: 0;\">\n\t\t\t\t<div class=\"brainsatplay-header-grid\"><h1>Device Manager</h1><button id=\"").concat(_this3.id, "deviceSelectionClose\" class='brainsatplay-default-button'>Close</button></div>\n\t\t\t\t<hr>\n\t\t\t\t<div class=\"brainsatplay-device-gallery\" style=\"overflow-y: scroll;\"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t");
      };

      var setup = function setup() {
        var deviceSelection = document.getElementById("".concat(_this3.id, "DeviceSelection"));
        var deviceGallery = deviceSelection.querySelector(".brainsatplay-device-gallery");
        var closeButton = document.getElementById("".concat(_this3.id, "deviceSelectionClose"));

        var resizeDisplay = function resizeDisplay() {
          var main = deviceSelection.querySelector(".main");
          deviceGallery.style.height = "".concat(window.innerHeight - parseInt(main.style.padding.replace('px', '')) - deviceGallery.offsetTop, "px"); // deviceGallery.style.height = `${window.innerHeight - 2 * main.style.padding - (deviceGallery.offsetTop)}px`
        };

        resizeDisplay();
        window.addEventListener('resize', resizeDisplay);

        closeButton.onclick = function () {
          deviceSelection.style.opacity = '0';
          deviceSelection.style.pointerEvents = 'none';
        };

        var newDeviceList = deviceFilter != null ? deviceList.filter(function (d) {
          return deviceFilter.includes(d.name);
        }) : deviceList;
        newDeviceList.sort(function (a, b) {
          var translate = function translate(d) {
            if (d.company == 'Brains@Play') {
              return 0; // B@P
            } else if (d.company == 'HEGAlpha') {
              return 1; // HEG
            } else if (d.company == 'Neuroidss') {
              return 2; // FreEEG
            } else if (d.company == 'OpenBCI') {
              return 3; // OpenBCI
            } else if (d.company == 'Neosensory') {
              return 4; // Neosensory
            } else if (d.company == 'InteraXon') {
              return 5; // InteraXon
            } else {
                return 3; // other
              }
          };

          var pos1 = translate(a);
          var pos2 = translate(b);
          return pos1 - pos2;
        });
        newDeviceList.forEach(function (d, i) {
          if (d.variants == null) d.variants = [''];
          var cleanCompanyString = d.company.replace(/[|&;$%@"<>()+,]/g, "");
          var insertionDiv = deviceGallery.querySelector("[name=\"".concat(cleanCompanyString, "\"]"));

          if (!insertionDiv) {
            insertionDiv = document.createElement('div');
            insertionDiv.classList.add("brainsatplay-companyCard");
            insertionDiv.setAttribute("name", cleanCompanyString);
            insertionDiv.innerHTML += "<h3>".concat(d.company, "</h3><div class=\"devices\"></div>");
            deviceGallery.insertAdjacentElement('beforeend', insertionDiv);
          }

          var deviceDiv = document.createElement('div');
          deviceDiv.id = "brainsatplay-device-".concat(d.id);
          deviceDiv.classList.add('brainsatplay-deviceCard');
          var header = document.createElement('h4');
          header.id = "brainsatplay-header-".concat(d.id);
          header.innerHTML = d.name;
          deviceDiv.insertAdjacentElement('beforeend', header);
          deviceDiv.innerHTML += "<div class=\"variants\"></div>";
          var cleanDeviceString = d.name.replace(/[|&;$%@"<>()+,]/g, "").replace(' ', '');
          var deviceIndicator = document.createElement('div');
          deviceIndicator.classList.add('indicator');
          deviceDiv.insertAdjacentElement('beforeend', deviceIndicator);
          d.variants.forEach(function (v) {
            var variantName = v != '' ? "".concat(cleanDeviceString, "_").concat(v) : cleanDeviceString;
            var variantTag = v != '' ? "".concat(d.id, "_").concat(v) : d.id;
            var variantLabel = v != '' ? v : 'Connect';
            var div = document.createElement('div');
            div.id = "brainsatplay-".concat(variantName);
            div.classList.add('brainsatplay-variantButton'); // Add label to button

            div.innerHTML = "<p>".concat(variantLabel, "</p>");

            var setIndicator = function setIndicator() {
              var on = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

              if (on) {
                deviceIndicator.classList.add('on');
              } else {
                deviceIndicator.classList.remove('on');
              }
            };

            var updatedOnConnect = function updatedOnConnect(device) {
              onconnect();
              div.querySelector('p').innerHTML = "Disconnect";
              setIndicator(true);

              div.onclick = function () {
                _this3.disconnect();
              };
            };

            var updatedOnDisconnect = function updatedOnDisconnect(device) {
              ondisconnect();
              setIndicator(false);
              div.querySelector('p').innerHTML = variantLabel;

              div.onclick = function () {
                _this3.connect(variantTag, d.analysis, updatedOnConnect, updatedOnDisconnect);
              };
            };

            div.onclick = function (e) {
              _this3.connect(variantTag, d.analysis, updatedOnConnect, updatedOnDisconnect);
            };

            deviceDiv.querySelector('.variants').insertAdjacentElement('beforeend', div);
          });
          insertionDiv.querySelector('.devices').insertAdjacentElement('beforeend', deviceDiv);
        });

        var openDeviceSelectionMenu = function openDeviceSelectionMenu() {
          deviceSelection.style.opacity = '1';
          deviceSelection.style.pointerEvents = 'auto';
        };

        if (toggleButton == null) {
          var _toggleButton = document.createElement('div');

          _toggleButton.id = 'deviceManagerOpen';

          _toggleButton.classList.add('brainsatplay-default-button');

          _toggleButton.style = "\n\t\t\t\tposition: absolute; \n\t\t\t\tbottom: 25px; \n\t\t\t\tright: 25px;\n\t\t\t\tz-index: 100;\n\t\t\t";
          _toggleButton.innerHTML = 'Open Device Manager';
          document.body.insertAdjacentElement('afterbegin', _toggleButton);
          _toggleButton.onclick = openDeviceSelectionMenu;
        } else {
          toggleButton.onclick = openDeviceSelectionMenu;
        } // Autoselect the Correct Device (if declared)


        if (autoselect != null) {
          _this3.autoselectDevice(autoselect);
        }
      };

      var main = document.getElementById("".concat(this.id, "DeviceSelection"));

      if (main == null) {
        var _ui = new DOMFragment_DOMFragment(template, parentNode, undefined, setup);
      } else {
        if (autoselect != null) {
          this.autoselectDevice(autoselect);
        }
      }
    }
  }, {
    key: "beginStream",
    value: function beginStream() {
      var streamParams = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : undefined;

      //can push app stream parameters here
      if (!this.streamObj.info.streaming) {
        if (streamParams) this.addStreamParams(streamParams);
        this.streamObj.info.streaming = true;
        this.streamObj.streamLoop();
      }
    }
  }, {
    key: "endStream",
    value: function endStream() {
      this.streamObj.info.streaming = false;
    } //get the device stream object

  }, {
    key: "getDevice",
    value: function getDevice() {
      var deviceNameOrType = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'FreeEEG32_2';
      var deviceIdx = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      var found = undefined;
      this.deviceStreams.find(function (d, i) {
        if (d.info.deviceName.indexOf(deviceNameOrType) > -1 && d.info.deviceNum === deviceIdx) {
          found = d;
          return true;
        } else if (d.info.deviceType.indexOf(deviceNameOrType) > -1 && d.info.deviceNum === deviceIdx) {
          found = d;
          return true;
        }
      });
      return found;
    }
  }, {
    key: "addAnalysisMode",
    value: function addAnalysisMode() {
      var mode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
      var deviceName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.state.data.device0.deviceName;
      var n = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var device = this.getDevice(deviceName, n);
      var found = device.info.analysis.find(function (s, i) {
        if (s === mode) {
          return true;
        }
      });
      if (!found) device.info.analysis.push(mode);

      if (!device.atlas.settings.analyzing) {
        device.atlas.settings.analyzing = true;
        device.atlas.analyzer();
      }
    } //Add functions to run custom data analysis loops. You can then add functions to gather this data for streaming.

  }, {
    key: "stopAnalysis",
    value: function stopAnalysis() {
      var _this4 = this;

      var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';

      //eegfft,eegcoherence,bcijs_bandpower,bcijs_pca,heg_pulse
      if (this.deviceStreams.length > 0) {
        if (name !== '' && typeof name === 'string') {
          var found = this.atlas.settings.analysis.find(function (str, i) {
            if (name === str) {
              _this4.atlas.settings.analysis.splice(i, 1);

              return true;
            }
          });
        } else {
          this.atlas.settings.analyzing = false;
        }
      } else {
        console.error("no devices connected");
      }
    } //get data for a particular device	

  }, {
    key: "addAnalyzerFunc",
    value: function addAnalyzerFunc() {
      var prop = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};
      this.deviceStreams.forEach(function (o, i) {
        if (o.device.atlas !== null && prop !== null) {
          if (o.device.atlas.analyzerOpts.indexOf(prop) < 0) {
            o.device.atlas.analyzerOpts.push(prop);
            o.device.atlas.analyzerFuncs.push(callback);
          } else {
            console.error("property " + prop + " exists");
          }
        }
      });
    } //Input an object that will be updated with app data along with the device stream.

  }, {
    key: "streamAppData",
    value: function streamAppData() {
      var _this5 = this;

      var propname = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'data';
      var props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      var onData = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (newData) {};
      var id = "".concat(propname); //${Math.floor(Math.random()*100000000)}`;

      this.state.addToState(id, props, onData);
      this.state.data[id + "_flag"] = true;
      var sub = this.state.subscribe(id, function () {
        _this5.state.data[id + "_flag"] = true;
      });

      var newStreamFunc = function newStreamFunc() {
        if (_this5.state.data[id + "_flag"] === true) {
          _this5.state.data[id + "_flag"] = false;
          return _this5.state.data[id];
        } else return undefined;
      };

      this.addStreamFunc(id, newStreamFunc);
      return id; //this.state.unsubscribeAll(id) when done
    } //Remove arbitrary data streams made with streamAppData

  }, {
    key: "removeStreaming",
    value: function removeStreaming(id, responseIdx) {
      var manager = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.state;

      if (responseIdx == null) {
        manager.removeState(id);
        manager.removeState(id + "_flag");
        this.streamObj.removeStreamFunc(id); //remove streaming function by name

        var idx = this.streamObj.info.appStreamParams.findIndex(function (v, i) {
          return v.join('_') === id;
        });
        if (idx != null) this.streamObj.info.appStreamParams.splice(idx, 1);
      } else {
        manager.unsubscribe(id, responseIdx); //unsub state
      }
    } //Add functions for gathering data to send to the server

  }, {
    key: "addStreamFunc",
    value: function addStreamFunc(name, callback) {
      var manager = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.state;

      if (typeof name === 'string' && typeof callback === 'function') {
        // Artificially add to state (for streaming functions)
        var _callback = function _callback() {
          var data = callback();
          if (data != undefined) manager.data[name] = data;
          return data;
        }; // Run so that solo users get their own data back


        this.streamObj.streamLoop();
        this.streamObj.addStreamFunc(name, _callback);

        if (manager === this.state) {
          this.addStreamParams([[name]]);
        } else {
          this.addStreamParams([[name, undefined, 'ignore']]);
        }
      } else {
        console.error("addStreamFunc error");
      }
    } //add a parameter to the stream based on available callbacks [['function','arg1','arg2',etc][stream function 2...]]

  }, {
    key: "addStreamParams",
    value: function addStreamParams() {
      var _this6 = this;

      var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
      params.forEach(function (p, i) {
        if (Array.isArray(p)) {
          var found = _this6.deviceStreams.find(function (d) {
            if (p[0].indexOf(d.info.deviceType) > -1) {
              if (d.info.deviceType === 'eeg') {
                d.atlas.data.eegshared.eegChannelTags.find(function (o) {
                  if (o.tag === p[1] || o.ch === p[1]) {
                    _this6.streamObj.info.deviceStreamParams.push(p);

                    return true;
                  }
                });
              } else {
                _this6.streamObj.info.deviceStreamParams.push(p);
              }

              return true;
            }
          });

          if (!found) _this6.streamObj.info.appStreamParams.push(p);
        }
      });
    }
  }, {
    key: "login",
    value: //Server login and socket initialization
    function () {
      var _login = Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6() {
        var _this7 = this;

        var beginStream,
            dict,
            onsuccess,
            _args6 = arguments;
        return regeneratorRuntime.wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                beginStream = _args6.length > 0 && _args6[0] !== undefined ? _args6[0] : false;
                dict = _args6.length > 1 && _args6[1] !== undefined ? _args6[1] : this.info.auth;
                onsuccess = _args6.length > 2 && _args6[2] !== undefined ? _args6[2] : function (newResult) {};

                if (!(this.socket == null || this.socket.readyState !== 1)) {
                  _context6.next = 7;
                  break;
                }

                this.socket = this.setupWebSocket(dict).then(function (socket) {
                  _this7.socket = socket;
                  _this7.info.auth.authenticated = true;

                  if (_this7.socket !== null && _this7.socket.readyState === 1) {
                    if (beginStream === true) {
                      _this7.beginStream();
                    }
                  }

                  var sub = _this7.state.subscribe('commandResult', function (newResult) {
                    if (Session_typeof(newResult) === 'object') {
                      if (newResult.msg === 'resetUsername') {
                        _this7.info.auth.username = newResult.username;

                        _this7.state.unsubscribe('commandResult', sub);

                        onsuccess(newResult);
                      }
                    }
                  });
                });
                _context6.next = 8;
                break;

              case 7:
                return _context6.abrupt("return", this.info.auth);

              case 8:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));

      function login() {
        return _login.apply(this, arguments);
      }

      return login;
    }()
  }, {
    key: "signup",
    value: function () {
      var _signup = Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7() {
        var dict,
            baseURL,
            json,
            response,
            _args7 = arguments;
        return regeneratorRuntime.wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                dict = _args7.length > 0 && _args7[0] !== undefined ? _args7[0] : {};
                baseURL = _args7.length > 1 && _args7[1] !== undefined ? _args7[1] : this.info.auth.url.toString();
                baseURL = this.checkURL(baseURL);
                json = JSON.stringify(dict);
                _context7.next = 6;
                return fetch(baseURL.toString() + 'signup', {
                  method: 'POST',
                  mode: 'cors',
                  headers: new Headers({
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                  }),
                  body: json
                }).then(function (res) {
                  return res.json().then(function (message) {
                    return message;
                  });
                }).then(function (message) {
                  console.log("\n" + message);
                  return message;
                })["catch"](function (err) {
                  console.error("\n" + err.message);
                });

              case 6:
                response = _context7.sent;
                return _context7.abrupt("return", response);

              case 8:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function signup() {
        return _signup.apply(this, arguments);
      }

      return signup;
    }()
  }, {
    key: "request",
    value: function () {
      var _request = Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee8(body) {
        var method,
            pathname,
            baseURL,
            dict,
            _args8 = arguments;
        return regeneratorRuntime.wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                method = _args8.length > 1 && _args8[1] !== undefined ? _args8[1] : "POST";
                pathname = _args8.length > 2 && _args8[2] !== undefined ? _args8[2] : '';
                baseURL = _args8.length > 3 && _args8[3] !== undefined ? _args8[3] : this.info.auth.url.toString();

                if (!(pathname !== '')) {
                  _context8.next = 13;
                  break;
                }

                baseURL = this.checkURL(baseURL);
                pathname = this.checkPathname(pathname);
                dict = {
                  method: method,
                  mode: 'cors',
                  headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                  }
                };

                if (method === 'POST') {
                  dict.body = JSON.stringify(body);
                }

                _context8.next = 10;
                return fetch(baseURL + pathname, dict).then(function (res) {
                  return res.json().then(function (dict) {
                    return dict.message;
                  });
                })["catch"](function (err) {
                  console.error("\n" + err.message);
                });

              case 10:
                return _context8.abrupt("return", _context8.sent);

              case 13:
                console.error("You must provide a valid pathname to request resources from " + baseURL);
                return _context8.abrupt("return");

              case 15:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function request(_x2) {
        return _request.apply(this, arguments);
      }

      return request;
    }()
  }, {
    key: "processSocketMessage",
    value: function processSocketMessage() {
      var _this8 = this;

      var received = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
      var parsed = JSON.parse(received);

      if (!parsed.msg) {
        console.log(received);
        return;
      }

      if (parsed.msg === 'userData') {
        for (var prop in parsed.userData) {
          this.state.updateState("userData_" + parsed.username + "_" + prop, parsed.userData[prop]);
        }
      } else if (parsed.msg === 'sessionData') {
        parsed.userData.forEach(function (o, i) {
          var user = o.username;

          for (var _prop in o) {
            if (_prop !== 'username') _this8.state.updateState("".concat(parsed.id, "_").concat(user, "_").concat(_prop), o[_prop]);
          }
        });

        if (parsed.userLeft) {
          for (var _prop2 in this.state.data) {
            if (_prop2.indexOf(parsed.userLeft) > -1) {
              this.state.removeState(_prop2);
            }
          }
        }

        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'getUsersResult') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'getSessionDataResult') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'getSessionInfoResult') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'getSessionsResult') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'sessionCreated') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'subscribedToUser') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'userNotFound') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'subscribedToSession') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'leftSession') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'sessionDeleted') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'unsubscribed') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'appNotFound' || parsed.msg === 'sessionNotFound') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'resetUsername') {
        this.state.updateState("commandResult", parsed);
      } else if (parsed.msg === 'getUserDataResult') {
        this.state.updateState("commandResult", parsed);
      } // OSC
      else if (parsed.msg === 'oscError') {
          this.state.updateState("commandResult", parsed);
        } else if (parsed.msg === 'oscInfo') {
          this.state.updateState("commandResult", parsed);
        } else if (parsed.msg === 'oscData') {
          console.log(parsed.oscData); // for (const prop in parsed.userData) {
          // 	this.state.data["userData_" + parsed.username + "_" + prop] = parsed.userData[prop];
          // }
        } else {
          console.log(parsed);
        }
    }
  }, {
    key: "setupWebSocket",
    value: function () {
      var _setupWebSocket = Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee9() {
        var _this9 = this;

        var auth,
            encodeForSubprotocol,
            socket,
            subprotocol,
            wsPromise,
            _args9 = arguments;
        return regeneratorRuntime.wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                auth = _args9.length > 0 && _args9[0] !== undefined ? _args9[0] : this.info.auth;

                encodeForSubprotocol = function encodeForSubprotocol(info) {
                  return info.replace(' ', '%20');
                };

                socket = null;
                subprotocol = ['username&' + encodeForSubprotocol(auth.username), 'password&' + encodeForSubprotocol(auth.password), 'origin&' + encodeForSubprotocol('brainsatplay.js')];

                if (!(auth.url.protocol === 'http:')) {
                  _context9.next = 8;
                  break;
                }

                socket = new WebSocket("ws://" + auth.url.host, subprotocol);
                _context9.next = 14;
                break;

              case 8:
                if (!(auth.url.protocol === 'https:')) {
                  _context9.next = 12;
                  break;
                }

                socket = new WebSocket("wss://" + auth.url.host, subprotocol);
                _context9.next = 14;
                break;

              case 12:
                console.log('invalid protocol');
                return _context9.abrupt("return");

              case 14:
                wsPromise = new Promise(function (resolve, reject) {
                  socket.onerror = function (e) {
                    console.log('error', e);
                  };

                  socket.onopen = function () {
                    _this9.streamObj.socket = socket;
                    resolve(socket);
                  };

                  socket.onmessage = function (msg) {
                    // console.log('Message recieved: ' + msg.data)
                    _this9.processSocketMessage(msg.data);
                  };

                  socket.onclose = function (msg) {
                    console.log('close');
                  };
                });
                return _context9.abrupt("return", wsPromise);

              case 16:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function setupWebSocket() {
        return _setupWebSocket.apply(this, arguments);
      }

      return setupWebSocket;
    }()
  }, {
    key: "subscribeToUser",
    value: function subscribeToUser() {
      var _this10 = this;

      var username = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
      var userProps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
      var onsuccess = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (newResult) {};

      // if successful, props will be available in state under this.state.data['username_prop']
      //check if user is subscribable
      if (this.socket !== null && this.socket.readyState === 1) {
        this.sendBrainstormCommand(['getUserData', username]);
        userProps.forEach(function (prop) {
          var p = prop;
          if (Array.isArray(p)) p = prop.join("_"); //if props are given like ['eegch','FP1']

          _this10.state.updateState(username + "_" + p, null);
        }); //wait for result, if user found then add the user

        var sub = this.state.subscribe('commandResult', function (newResult) {
          if (Session_typeof(newResult) === 'object') {
            if (newResult.msg === 'getUserDataResult') {
              if (newResult.username === username) {
                _this10.sendBrainstormCommand(['subscribeToUser', username, userProps]);

                for (var _i = 0, _Object$entries = Object.entries(newResult.userData.props); _i < _Object$entries.length; _i++) {
                  var _Object$entries$_i = Session_slicedToArray(_Object$entries[_i], 2),
                      prop = _Object$entries$_i[0],
                      value = _Object$entries$_i[1];

                  _this10.state.updateState("userData_" + username + "_" + prop, value);
                }
              }

              onsuccess(newResult.userData);

              _this10.state.unsubscribe('commandResult', sub);
            } else if (newResult.msg === 'userNotFound' && newResult.username === username) {
              _this10.state.unsubscribe('commandResult', sub);

              console.log("User not found: ", username);
            }
          }
        });
      }
    }
  }, {
    key: "unsubscribeFromUser",
    value: function unsubscribeFromUser() {
      var _this11 = this;

      var username = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
      var userProps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
      var onsuccess = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (newResult) {};

      //unsubscribe from user entirely or just from specific props
      //send unsubscribe command
      if (this.socket !== null && this.socket.readyState === 1) {
        this.sendBrainstormCommand(['unsubscribeFromUser', username, userProps]);
        var sub = this.state.subscribe('commandResult', function (newResult) {
          if (newResult.msg === 'unsubscribed' && newResult.username === username) {
            for (var prop in _this11.state.data) {
              if (prop.indexOf(username) > -1) {
                _this11.state.removeState(prop);
              }
            }

            onsuccess(newResult);

            _this11.state.unsubscribe('commandResult', sub);
          }
        });
      }
    }
  }, {
    key: "getUsers",
    value: function getUsers(appname) {
      var _this12 = this;

      var onsuccess = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (newResult) {};

      if (this.socket !== null && this.socket.readyState === 1) {
        this.sendBrainstormCommand(['getUsers', appname]); //wait for response, check result, if session is found and correct props are available, then add the stream props locally necessary for session

        var sub = this.state.subscribe('commandResult', function (newResult) {
          if (Session_typeof(newResult) === 'object') {
            if (newResult.msg === 'getUsersResult') {
              // && newResult.appname === appname) {						
              onsuccess(newResult.userData); //list userData, then subscribe to session by id

              _this12.state.unsubscribe('commandResult', sub);

              return newResult.userData;
            }
          } else if (newResult.msg === 'usersNotFound') {
            //} & newResult.appname === appname) {
            _this12.state.unsubscribe('commandResult', sub);

            console.log("Users not found: ", appname);
            return [];
          }
        });
      }
    }
  }, {
    key: "startOSC",
    value: function startOSC() {
      var _this13 = this;

      var localAddress = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "127.0.0.1";
      var localPort = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 57121;
      var remoteAddress = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
      var remotePort = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;
      var onsuccess = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : function (newResult) {};
      // Read and Write to the Same Address if Unspecified
      if (remoteAddress == null) remoteAddress = localAddress;
      if (remotePort == null) remotePort = localPort;
      this.sendBrainstormCommand(['startOSC', localAddress, localPort, remoteAddress, remotePort]);
      var sub = this.state.subscribe('commandResult', function (newResult) {
        if (Session_typeof(newResult) === 'object') {
          if (newResult.msg === 'oscInfo') {
            onsuccess(newResult.oscInfo);

            _this13.state.unsubscribe('commandResult', sub);

            return newResult.oscInfo;
          }
        } else if (newResult.msg === 'oscError') {
          _this13.state.unsubscribe('commandResult', sub);

          console.log("OSC Error", newResult.oscError);
          return [];
        }
      });
    } // stopOSC(localAddress="127.0.0.1",localPort=57121, onsuccess = (newResult) => { }){
    // }

  }, {
    key: "getSessions",
    value: function getSessions(appname) {
      var _this14 = this;

      var onsuccess = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (newResult) {};

      if (this.socket !== null && this.socket.readyState === 1) {
        this.sendBrainstormCommand(['getSessions', appname]); //wait for response, check result, if session is found and correct props are available, then add the stream props locally necessary for session

        var sub = this.state.subscribe('commandResult', function (newResult) {
          if (Session_typeof(newResult) === 'object') {
            if (newResult.msg === 'getSessionsResult' && newResult.appname === appname) {
              onsuccess(newResult);

              _this14.state.unsubscribe('commandResult', sub);

              return newResult.sessions;
            }
          } else if (newResult.msg === 'appNotFound' & newResult.appname === appname) {
            _this14.state.unsubscribe('commandResult', sub);

            console.log("App not found: ", appname);
            return [];
          }
        });
      }
    } //connect using the unique id of the subscription

  }, {
    key: "subscribeToSession",
    value: function subscribeToSession(sessionid) {
      var _this15 = this;

      var spectating = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
      var onsuccess = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (newResult) {};
      console.log(this.info.auth.username);

      if (this.socket !== null && this.socket.readyState === 1) {
        this.sendBrainstormCommand(['getSessionInfo', sessionid]); //wait for response, check result, if session is found and correct props are available, then add the stream props locally necessary for session

        var sub = this.state.subscribe('commandResult', function (newResult) {
          if (Session_typeof(newResult) === 'object') {
            if (newResult.msg === 'getSessionInfoResult' && newResult.sessionInfo.id === sessionid) {
              var configured = true;

              if (spectating === false) {
                //check that this user has the correct streaming configuration with the correct connected device
                var streamParams = [];
                newResult.sessionInfo.propnames.forEach(function (prop) {
                  streamParams.push(prop.split("_"));
                });
                configured = _this15.configureStreamForSession(newResult.sessionInfo.devices, streamParams); //Expected propnames like ['eegch','FP1','eegfft','FP2']
                // this.streamObj

                onsuccess(newResult);
              }

              if (configured === true) {
                _this15.sendBrainstormCommand(['subscribeToSession', sessionid, spectating]);

                _this15.info.subscriptions.push(sessionid);

                onsuccess(newResult);
              } //console.log('unsubscribe ' + sub)


              _this15.state.unsubscribe('commandResult', sub);
            } else if (newResult.msg === 'sessionNotFound' & newResult.id === sessionid) {
              _this15.state.unsubscribe('commandResult', sub);

              console.log("Session not found: ", sessionid);
            }
          }
        });
      }
    }
  }, {
    key: "unsubscribeFromSession",
    value: function unsubscribeFromSession() {
      var _this16 = this;

      var sessionid = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
      var onsuccess = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (newResult) {};

      //send unsubscribe command
      if (this.socket !== null && this.socket.readyState === 1) {
        this.sendBrainstormCommand(['leaveSession', sessionid]);
        var sub = this.state.subscribe('commandResult', function (newResult) {
          if (newResult.msg === 'leftSession' && newResult.id === sessionid) {
            for (var prop in _this16.state.data) {
              if (prop.indexOf(sessionid) > -1) {
                _this16.state.removeState(prop);
              }
            }

            onsuccess(newResult);

            _this16.state.unsubscribe('commandResult', sub);
          }
        });
      }
    }
  }, {
    key: "getBrainstormData",
    value: function getBrainstormData(query) {
      var _this17 = this;

      var props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
      var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'app';
      var format = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 'default';
      var usernameInd;
      var propInd;
      var structureFilter;

      if (type === 'user') {
        usernameInd = 1;
        propInd = 2;

        structureFilter = function structureFilter(input) {
          var val = input.split('_')[0];
          return val === 'userData';
        };
      } else {
        usernameInd = 2;
        propInd = 3;

        structureFilter = function structureFilter(input) {
          return input.split('_')[0] !== 'userData';
        };
      }

      var arr = [];

      if (query != null) {
        var regex = new RegExp(query);
        var returnedStates = Object.keys(this.state.data).filter(function (k) {
          // Query is True
          var test1 = regex.test(k); // Structure is Appropriate

          var test2 = structureFilter(k); // Props are Included

          var test3 = false;
          props.forEach(function (p) {
            if (k.includes(p)) {
              test3 = true;
            }
          });
          if (test1 && test2 && test3) return true;
        });
        var usedNames = [];
        returnedStates.forEach(function (str) {
          var strArr = str.split('_');

          if (!usedNames.includes(strArr[usernameInd])) {
            usedNames.push(strArr[usernameInd]);
            arr.push({
              username: strArr[usernameInd]
            });
          }

          arr.find(function (o) {
            var prop = strArr.slice(propInd).join('_'); // Other User Data

            if (o.username === strArr[usernameInd]) {
              // Plugin Format
              if (format === 'plugin') {
                o.value = _this17.state.data[str].value;
                o.label = prop;
              } // Default Format
              else {
                  o[prop] = _this17.state.data[str];
                }
            }
          });
        });
        var i = arr.length;
        arr.push({
          username: this.info.auth.username
        });
        props.forEach(function (prop) {
          // Plugin Format
          if (format === 'plugin') {
            arr[i].value = _this17.state.data[prop].value;
            arr[i].label = prop;
          } // Default Format
          else {
              arr[i][prop] = _this17.state.data[prop];
            }
        });
      } else {
        console.error('please specify a query for the Brainstorm (app, username, prop)');
      }

      return arr;
    }
  }, {
    key: "configureStreamForSession",
    value: function configureStreamForSession() {
      var _this18 = this;

      var deviceTypes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
      var streamParams = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
      //Set local device stream parameters based on what the session wants
      var params = streamParams;
      var d = undefined;

      if (this.deviceStreams.length === 0) {
        //no devices, add params anyway
        params.forEach(function (p) {
          if (!_this18.streamObj.deviceStreams.find(function (ds) {
            if (p[0].indexOf(ds.info.deviceType) > -1) {
              return true;
            }
          })) {
            if (!_this18.streamObj.info.appStreamParams.find(function (sp) {
              if (sp.toString() === p.toString()) return true;
            })) {
              _this18.streamObj.info.appStreamParams.push(p);
            }
          }
        });

        if (this.streamObj.info.streaming === false) {
          this.streamObj.info.streaming = true;
          this.streamObj.streamLoop();
        }
      } else {
        deviceTypes.forEach(function (name, i) {
          // configure named device
          d = _this18.deviceStreams.find(function (o, j) {
            if (o.info.deviceType.toLowerCase() === name.toLowerCase()) {
              var deviceParams = [];
              params.forEach(function (p) {
                if (p[0].indexOf(o.info.deviceType) > -1 && !_this18.streamObj.info.deviceStreamParams.find(function (dp) {
                  return dp.toString() === p.toString();
                })) {
                  //stream parameters should have the device type specified (in case multiple devices are involved)
                  if ('eeg' === o.info.deviceType.toLowerCase()) {
                    o.device.atlas.data.eegshared.eegChannelTags.find(function (ob) {
                      if (ob.tag === p[1] || ob.ch === p[1]) {
                        deviceParams.push(p);
                        return true;
                      }
                    });
                  } else deviceParams.push(p);
                } else if (!_this18.streamObj.deviceStreams.find(function (ds) {
                  if (p[0].indexOf(ds.info.deviceType) > -1) {
                    return true;
                  }
                })) {
                  if (!_this18.streamObj.info.appStreamParams.find(function (sp) {
                    if (sp.toString() === p.toString()) return true;
                  })) {
                    _this18.streamObj.info.appStreamParams.push(p);
                  }
                }
              });

              if (deviceParams.length > 0 || _this18.streamObj.info.appStreamParams.length > 0) {
                var _this18$streamObj$inf;

                (_this18$streamObj$inf = _this18.streamObj.info.deviceStreamParams).push.apply(_this18$streamObj$inf, deviceParams);

                if (_this18.streamObj.info.streaming === false) {
                  _this18.streamObj.info.streaming = true;

                  _this18.streamObj.streamLoop();
                }

                return true;
              }
            }
          });
        });
      }

      if (this.streamObj.info.deviceStreamParams.length === 0 && this.streamObj.info.appStreamParams.length === 0) {
        console.error('Compatible device not found');
        return false;
      } else {
        return true;
      }
    }
  }, {
    key: "sendBrainstormCommand",
    value: function () {
      var _sendBrainstormCommand = Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee10() {
        var command,
            dict,
            o,
            json,
            _args10 = arguments;
        return regeneratorRuntime.wrap(function _callee10$(_context10) {
          while (1) {
            switch (_context10.prev = _context10.next) {
              case 0:
                command = _args10.length > 0 && _args10[0] !== undefined ? _args10[0] : '';
                dict = _args10.length > 1 && _args10[1] !== undefined ? _args10[1] : {};
                // Create Message
                o = {
                  cmd: command,
                  username: this.info.auth.username
                };
                Object.assign(o, dict);
                json = JSON.stringify(o);

                if (!(this.socket.readyState !== 1)) {
                  _context10.next = 17;
                  break;
                }

                _context10.prev = 6;
                _context10.next = 9;
                return waitForOpenConnection(this.socket);

              case 9:
                this.socket.send(json);
                _context10.next = 15;
                break;

              case 12:
                _context10.prev = 12;
                _context10.t0 = _context10["catch"](6);
                console.error(_context10.t0);

              case 15:
                _context10.next = 18;
                break;

              case 17:
                this.socket.send(json);

              case 18:
              case "end":
                return _context10.stop();
            }
          }
        }, _callee10, this, [[6, 12]]);
      }));

      function sendBrainstormCommand() {
        return _sendBrainstormCommand.apply(this, arguments);
      }

      return sendBrainstormCommand;
    }()
  }, {
    key: "closeSocket",
    value: function closeSocket() {
      this.socket.close();
    }
  }, {
    key: "onconnectionLost",
    value: function onconnectionLost(response) {
      //If a user is removed from the server
      var found = false;
      var idx = 0;
      var c = this.info.subscriptions.find(function (o, i) {
        if (o.username === response.username) {
          found = true;
          return true;
        }
      });

      if (found === true) {
        this.info.subscriptions.splice(idx, 1);
        this.info.nDevices--;
      }
    }
  }, {
    key: "checkURL",
    value: function checkURL(url) {
      if (url.slice(-1) !== '/') {
        url += '/';
      }

      return url;
    }
  }, {
    key: "checkPathname",
    value: function checkPathname(pathname) {
      if (pathname.slice(0) === '/') {
        pathname.splice(0, 1);
      }

      return pathname;
    }
  }]);

  return Session;
}(); //-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//Class for handling local device streaming as well as automating data organization/analysis and streaming to server.

var deviceStream = /*#__PURE__*/function () {
  function deviceStream() {
    var device = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "freeeeg32_2";
    var analysis = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ['eegfft'];
    var useFilters = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
    var pipeToAtlas = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;
    var auth = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {
      username: 'guest'
    };
    var session = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : null;

    Session_classCallCheck(this, deviceStream);

    Session_initialiseProps.call(this);

    this.info = {
      deviceName: device,
      deviceType: null,
      analysis: analysis,
      //['eegcoherence','eegfft' etc]
      session: session,
      deviceNum: 0,
      googleAuth: null,
      auth: auth,
      sps: null,
      useFilters: useFilters,
      useAtlas: false,
      simulating: false
    };
    this.device = null, //Device object, can be instance of eeg32, MuseClient, etc.
    this.deviceConfigs = deviceList;
    this.pipeToAtlas = pipeToAtlas; //this.init(device,useFilters,pipeToAtlas,analysis);
  }

  Session_createClass(deviceStream, [{
    key: "onconnect",
    value: //Generic handlers to be called by devices, you can stage further processing and UI/State handling here
    function onconnect() {}
  }, {
    key: "ondisconnect",
    value: function ondisconnect() {}
  }]);

  return deviceStream;
}();

var Session_initialiseProps = function _initialiseProps() {
  var _this21 = this;

  this.init = /*#__PURE__*/Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee14() {
    var info,
        pipeToAtlas,
        _args14 = arguments;
    return regeneratorRuntime.wrap(function _callee14$(_context14) {
      while (1) {
        switch (_context14.prev = _context14.next) {
          case 0:
            info = _args14.length > 0 && _args14[0] !== undefined ? _args14[0] : _this21.info;
            pipeToAtlas = _args14.length > 1 && _args14[1] !== undefined ? _args14[1] : _this21.pipeToAtlas;
            return _context14.abrupt("return", new Promise( /*#__PURE__*/function () {
              var _ref7 = Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee13(resolve, reject) {
                var findAsync, _findAsync;

                return regeneratorRuntime.wrap(function _callee13$(_context13) {
                  while (1) {
                    switch (_context13.prev = _context13.next) {
                      case 0:
                        _findAsync = function _findAsync3() {
                          _findAsync = Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee12(arr, asyncCallback) {
                            var promises, results, index;
                            return regeneratorRuntime.wrap(function _callee12$(_context12) {
                              while (1) {
                                switch (_context12.prev = _context12.next) {
                                  case 0:
                                    promises = arr.map(asyncCallback);
                                    _context12.next = 3;
                                    return Promise.all(promises);

                                  case 3:
                                    results = _context12.sent;
                                    index = results.findIndex(function (result) {
                                      return result;
                                    });
                                    return _context12.abrupt("return", arr[index]);

                                  case 6:
                                  case "end":
                                    return _context12.stop();
                                }
                              }
                            }, _callee12);
                          }));
                          return _findAsync.apply(this, arguments);
                        };

                        findAsync = function _findAsync2(_x5, _x6) {
                          return _findAsync.apply(this, arguments);
                        };

                        findAsync(_this21.deviceConfigs, /*#__PURE__*/function () {
                          var _ref8 = Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee11(o, i) {
                            return regeneratorRuntime.wrap(function _callee11$(_context11) {
                              while (1) {
                                switch (_context11.prev = _context11.next) {
                                  case 0:
                                    if (!(info.deviceName.indexOf(o.id) > -1)) {
                                      _context11.next = 6;
                                      break;
                                    }

                                    if (info.deviceName.includes('brainstorm')) {
                                      _this21.device = new o.cls(info.deviceName, info.session, _this21.onconnect, _this21.ondisconnect);
                                    } else {
                                      _this21.device = new o.cls(info.deviceName, _this21.onconnect, _this21.ondisconnect);
                                    } // Initialize Device


                                    _context11.next = 4;
                                    return _this21.device.init(info, pipeToAtlas);

                                  case 4:
                                    resolve(true);
                                    return _context11.abrupt("return", true);

                                  case 6:
                                  case "end":
                                    return _context11.stop();
                                }
                              }
                            }, _callee11);
                          }));

                          return function (_x7, _x8) {
                            return _ref8.apply(this, arguments);
                          };
                        }());

                      case 3:
                      case "end":
                        return _context13.stop();
                    }
                  }
                }, _callee13);
              }));

              return function (_x3, _x4) {
                return _ref7.apply(this, arguments);
              };
            }()));

          case 3:
          case "end":
            return _context14.stop();
        }
      }
    }, _callee14);
  }));
  this.connect = /*#__PURE__*/Session_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee15() {
    return regeneratorRuntime.wrap(function _callee15$(_context15) {
      while (1) {
        switch (_context15.prev = _context15.next) {
          case 0:
            _context15.next = 2;
            return _this21.device.connect();

          case 2:
            return _context15.abrupt("return", _context15.sent);

          case 3:
          case "end":
            return _context15.stop();
        }
      }
    }, _callee15);
  }));

  this.disconnect = function () {
    _this21.device.disconnect();
  };
};

var streamSession = /*#__PURE__*/function () {
  function streamSession(info, socket) {
    var _this19 = this;

    Session_classCallCheck(this, streamSession);

    this.getDataForSocket = function () {
      var device = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : undefined;
      var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [['prop', 'tag', 'arg1']];
      var userData = {};
      params.forEach(function (param, i) {
        _this19.streamTable.find(function (option, i) {
          if (param[0] === option.prop) {
            var args;
            if (device) args = [device].concat(Session_toConsumableArray(param.slice(1)));else args = param.slice(1);
            var result = args.length !== 0 ? option.callback.apply(option, Session_toConsumableArray(args)) : option.callback();

            if (result !== undefined) {
              if (param[2] !== 'ignore') {
                userData[param.join('_')] = result;
              }
            }

            return true;
          }
        });
      });
      return userData; // if(Object.keys(streamObj.userData).length > 0) {
      // 	this.socket.send(JSON.stringify(streamObj));
      // }
    };

    this.streamLoop = function () {
      var prev = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      var streamObj = {
        username: _this19.info.auth.username,
        userData: {}
      };

      if (_this19.info.streaming === true && _this19.socket.readyState === 1) {
        _this19.deviceStreams.forEach(function (d) {
          if (_this19.info.nDevices < _this19.deviceStreams.length) {
            if (!streamObj.userData.devices) streamObj.userData.devices = [];
            streamObj.userData.devices.push(d.info.deviceName);
            _this19.info.nDevices++;
          }

          var params = [];

          _this19.info.deviceStreamParams.forEach(function (param, i) {
            if (_this19.info.deviceStreamParams.length === 0) {
              console.error('No stream parameters set');
              return false;
            }

            if (param[0].indexOf(d.info.deviceType) > -1) {
              params.push(param);
            }
          });

          if (params.length > 0) {
            Object.assign(streamObj.userData, _this19.getDataForSocket(d, params));
          }
        });

        Object.assign(streamObj.userData, _this19.getDataForSocket(undefined, _this19.info.appStreamParams)); //if(params.length > 0) { this.sendDataToSocket(params); }
        // console.log(this.info)

        if (_this19.info.subscriptions.length > 0) {
          // Only stream if subscription is established
          if (Object.keys(streamObj.userData).length > 0) {
            _this19.socket.send(JSON.stringify(streamObj));
          }
        }

        _this19.info.streamCt++;
        setTimeout(function () {
          _this19.streamLoop();
        }, _this19.info.streamLoopTiming);
      } else {
        _this19.getDataForSocket(undefined, _this19.info.appStreamParams);

        _this19.info.streamCt = 0;
        setTimeout(function () {
          _this19.streamLoop();
        }, _this19.info.streamLoopTiming);
      }
    };

    this.deviceStreams = [];
    this.info = {
      auth: info.auth,
      subscriptions: info.subscriptions,
      streaming: false,
      deviceStreamParams: [],
      nDevices: 0,
      appStreamParams: [],
      streamCt: 0,
      streamLoopTiming: 50
    };
    this.streamTable = []; //tags and callbacks for streaming

    this.socket = socket;
    this.configureDefaultStreamTable();
  }

  Session_createClass(streamSession, [{
    key: "configureDefaultStreamTable",
    value: function configureDefaultStreamTable() {
      var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];

      //Stream table default parameter callbacks to extract desired data from the data atlas
      var getEEGChData = function getEEGChData(device, channel) {
        var nSamples = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'all';
        var get = nSamples;

        if (device.info.useAtlas === true) {
          var coord = false;

          if (typeof channel === 'number') {
            coord = device.atlas.getEEGDataByChannel(channel);
          } else {
            coord = device.atlas.getEEGDataByTag(channel);
          }

          if (coord !== undefined) {
            if (get === 'all') {
              if (coord.count === 0) return undefined;
              get = coord.count - coord.lastRead;
              coord.lastRead = coord.count; //tracks count of last reading for keeping up to date

              if (get === 0) return undefined;
            }

            if (coord.filtered.length > 0) {
              var times = coord.times.slice(coord.times.length - get, coord.times.length);
              var samples = coord.filtered.slice(coord.filtered.length - get, coord.filtered.length);
              return {
                times: times,
                samples: samples
              };
            } else if (coord.raw.length > 0) {
              var _times = coord.times.slice(coord.times.length - get, coord.times.length);

              var _samples = coord.raw.slice(coord.raw.length - get, coord.raw.length);

              return {
                times: _times,
                samples: _samples
              };
            } else {
              return undefined;
            }
          } else {
            return undefined;
          }
        }
      };

      var getEEGFFTData = function getEEGFFTData(device, channel) {
        var nArrays = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'all';
        var get = nArrays;

        if (device.info.useAtlas === true) {
          var coord = false;

          if (typeof channel === 'number') {
            coord = device.atlas.getEEGFFTData(channel);
          } else {
            coord = device.atlas.getEEGDataByTag(channel);
          }

          if (coord !== undefined) {
            if (get === 'all') {
              if (coord.fftCount === 0) return undefined;
              get = coord.fftCount - coord.lastReadFFT;
              coord.lastReadFFT = coord.fftCount;
              if (get === 0) return undefined;
            }

            var fftTimes = coord.fftTimes.slice(coord.fftTimes.length - get, coord.fftTimes.length);
            var ffts = coord.ffts.slice(coord.ffts.length - get, coord.ffts.length);
            return {
              times: fftTimes,
              ffts: ffts
            };
          } else {
            return undefined;
          }
        }
      };

      var getEEGBandpowerMeans = function getEEGBandpowerMeans(device, channel) {
        if (device.info.useAtlas === true) {
          var coord = false;
          coord = device.atlas.getLatestFFTData(channel)[0];

          if (coord !== undefined) {
            return {
              time: coord.time,
              bandpowers: coord.mean
            };
          } else {
            return undefined;
          }
        }
      };

      var getEEGCoherenceBandpowerMeans = function getEEGCoherenceBandpowerMeans(device, channel) {
        if (device.info.useAtlas === true) {
          var coord = false;
          coord = device.atlas.getLatestCoherenceData(channel);

          if (coord !== undefined) {
            return {
              time: coord.time,
              bandpowers: coord.mean
            };
          } else {
            return undefined;
          }
        }
      };

      var getEEGBandpowerSlices = function getEEGBandpowerSlices(device, channel) {
        if (device.info.useAtlas === true) {
          var coord = false;
          coord = device.atlas.getLatestFFTData(channel)[0];

          if (coord !== undefined) {
            return {
              time: coord.time,
              bandpowers: coord.slice
            };
          } else {
            return undefined;
          }
        }
      };

      var getEEGCoherenceBandpowerSlices = function getEEGCoherenceBandpowerSlices(device, channel) {
        if (device.info.useAtlas === true) {
          var coord = false;
          coord = device.atlas.getLatestCoherenceData(channel)[0];

          if (coord !== undefined) {
            return {
              time: coord.time,
              bandpowers: coord.slice
            };
          } else {
            return undefined;
          }
        }
      };

      var getCoherenceData = function getCoherenceData(device, tag) {
        var nArrays = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'all';
        var get = nArrays;

        if (device.info.useAtlas === true) {
          var coord = device.atlas.getCoherenceByTag(tag);

          if (coord !== undefined) {
            if (get === 'all') {
              if (coord.fftCount === 0) return undefined;
              get = coord.fftCount - coord.lastRead;
              coord.lastRead = coord.fftCount;
              if (get === 0) return undefined;
            }

            var cohTimes = coord.times.slice(coord.fftTimes.length - get, coord.fftTimes.length);
            var ffts = coord.ffts.slice(coord.ffts.length - get, coord.ffts.length);
            return {
              times: cohTimes,
              ffts: ffts
            };
          } else {
            return undefined;
          }
        }
      };

      var getHEGData = function getHEGData(device) {
        var _device$info;

        var tag = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var nArrays = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'all';
        var prop = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : undefined;
        var get = nArrays;

        if ((device === null || device === void 0 ? void 0 : (_device$info = device.info) === null || _device$info === void 0 ? void 0 : _device$info.useAtlas) === true) {
          var coord = device.atlas.getDeviceDataByTag('heg', tag);

          if (get === 'all') {
            get = coord.count - coord.lastRead;
            coord.lastRead = coord.count;
            if (get <= 0) return undefined;
          }

          if (coord !== undefined) {
            if (prop !== undefined) {
              var times = coord.times.slice(coord.times.length - get, coord.times.length);
              var data = coord[prop].slice(coord.ffts.length - get, coord.ffts.length);
              var obj = {
                times: times
              };
              obj[prop] = data;
              return obj;
            } else return coord;
          } else {
            return undefined;
          }
        }
      };

      this.streamTable = [{
        prop: 'eegch',
        callback: getEEGChData
      }, {
        prop: 'eegfft',
        callback: getEEGFFTData
      }, {
        prop: 'eegcoherence',
        callback: getCoherenceData
      }, {
        prop: 'eegfftbands',
        callback: getEEGBandpowerMeans
      }, {
        prop: 'eegcoherencebands',
        callback: getEEGCoherenceBandpowerMeans
      }, {
        prop: 'eegfftbandslices',
        callback: getEEGBandpowerSlices
      }, {
        prop: 'eegcoherencebandslices',
        callback: getEEGCoherenceBandpowerSlices
      }, {
        prop: 'hegdata',
        callback: getHEGData
      }];

      if (params.length > 0) {
        var _this$streamTable;

        (_this$streamTable = this.streamTable).push.apply(_this$streamTable, Session_toConsumableArray(params));
      }
    }
  }, {
    key: "addStreamFunc",
    value: function addStreamFunc() {
      var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
      var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};
      this.streamTable.push({
        prop: name,
        callback: callback
      });
    }
  }, {
    key: "removeStreamFunc",
    value: function removeStreamFunc() {
      var _this20 = this;

      var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
      this.streamTable.find(function (o, i) {
        if (o.prop === name) {
          return _this20.streamTable.splice(i, 1);
        }
      });
    }
  }, {
    key: "configureStreamParams",
    value: function configureStreamParams() {
      var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [['prop', 'tag']];
      //Simply defines expected data parameters from the user for server-side reference
      var propsToSend = [];
      params.forEach(function (param, i) {
        propsToSend.push(param.join('_'));
      });
      this.sendBrainstormCommand(['addProps', propsToSend]);
    } //pass array of arrays defining which datasets you want to pull from according to the available
    // functions and additional required arguments from the streamTable e.g.: [['eegch','FP1'],['eegfft','FP1']]

  }]);

  return streamSession;
}();
;// CONCATENATED MODULE: ./src/libraries/js/src/Application.js
function Application_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function Application_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function Application_createClass(Constructor, protoProps, staticProps) { if (protoProps) Application_defineProperties(Constructor.prototype, protoProps); if (staticProps) Application_defineProperties(Constructor, staticProps); return Constructor; }


 // import './ui/styles/defaults.css'

var Application = /*#__PURE__*/function () {
  function Application() {
    var info = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var parent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.body;
    var session = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new Session();
    var settings = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [];

    Application_classCallCheck(this, Application);

    //-------Keep these------- 
    this.session = session; //Reference to the Session to access data and subscribe

    this.parentNode = parent;
    this.info = info;
    this.settings = settings;
    this.AppletHTML = null; //------------------------

    this.props = {
      //Changes to this can be used to auto-update the HTML and track important UI values 
      id: String(Math.floor(Math.random() * 1000000)) //Keep random ID

    };
    this.session.graphs.add(this.props.id, this.info.name, this.info.graphs);
  }

  Application_createClass(Application, [{
    key: "init",
    value: function init() {
      var _this = this;

      var info = this.session.graphs.start(this.props.id);
      this.streams = info.streams;
      this.uiParams = info.uiParams;

      var setupHTML = function setupHTML() {
        if (_this.info.intro != null) _this.session.createIntro(_this);
        console.log('setting up');

        _this.uiParams.setupHTML.forEach(function (f) {
          f(_this);
        });
      };

      this.uiParams.HTMLtemplate = "<div id=\"".concat(this.props.id, "\" style=\"height:100%; width:100%;\">").concat(this.uiParams.HTMLtemplate, "</div>");
      this.AppletHTML = new DOMFragment_DOMFragment( // Fast HTML rendering container object
      this.uiParams.HTMLtemplate, //Define the html template string or function with properties
      this.parentNode, //Define where to append to (use the parentNode)
      this.props, //Reference to the HTML render properties (optional)
      setupHTML, //The setup functions for buttons and other onclick/onchange/etc functions which won't work inline in the template string
      undefined, //Can have an onchange function fire when properties change
      "NEVER" //Changes to props or the template string will automatically rerender the html template if "NEVER" is changed to "FRAMERATE" or another value, otherwise the UI manager handles resizing and reinits when new apps are added/destroyed
      );

      if (this.settings.length > 0) {
        this.configure(this.settings);
      } //You can give the app initialization settings if you want via an array.

    } //Delete all event listeners and loops here and delete the HTML block

  }, {
    key: "deinit",
    value: function deinit() {
      this.session.graphs.stop(this.props.id);
      if (this.AppletHTML) this.AppletHTML.deleteNode();
    } //Responsive UI update, for resizing and responding to new connections detected by the UI manager

  }, {
    key: "responsive",
    value: function responsive() {
      if (this.info.responsive instanceof Function) this.info.responsive();
    }
  }, {
    key: "configure",
    value: function configure() {
      var settings = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
      //For configuring from the address bar or saved settings. Expects an array of arguments [a,b,c] to do whatever with
      settings.forEach(function (cmd, i) {});
    }
  }]);

  return Application;
}();
;// CONCATENATED MODULE: ./src/libraries/js/brainsatplay.js
/**
 * Module for creating BCI application in Javascript.
 * @module brainsatplay
 */
 // Plugins

 // Session Manager

 // Application

 // export * from './src/analysis/eegmath'
// CommonJS Exports Not Working for Node.js Utilities
// import * as brainstorm from './src/brainstorm/Brainstorm'
// export {brainstorm}
})();

/******/ 	return __webpack_exports__;
/******/ })()
;
});