!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.brainsatplay=r():t.brainsatplay=r()}(this,(function(){return(()=>{"use strict";var t,r,e={842:(t,r,e)=>{var n,a=e(9985);function i(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function o(t,r){return Math.sqrt(t*t+r*r)}function u(t,r){for(var e=0,n=0;n<r;n++)e+=t[n];return e/r}function h(t,r,e){for(var n=0,a=0;a<e;a++)n+=(t[a]-r)*(t[a]-r);return Math.sqrt(n)}function s(t,r,e,n,a,i,o,u){for(var h=0,s=0;s<o;s++){var f=s+u,l=0;f<o&&(l=n[f]),h+=(t[s]-r)*(l-a)}return h/(e*i)}function f(t,r,e){for(var n=0,a=0,i=1/r,o=6.28318530718*e*i,u=0;u<r;u++){var h=o*u;n+=t[u]*Math.cos(h),a-=t[u]*Math.sin(h)}return[n*i,a*i]}function l(t,r,e,n){for(var a=0,i=0,o=1/r,u=6.28318530718*e*o,h=0;h<r;h++){var s=u*h;a+=t[h+(r-1)*n]*Math.cos(s),i-=t[h+(r-1)*n]*Math.sin(s)}return[a*o,i*o]}function c(t,r,e,n){var a=0,i=0,o=6.28318530718*e*(1/r),u=1,h=0,s=.25*n;if(e<=s)for(;e<=s;)s*=.5,u+=1;for(var f=0;f<r;f+=u){var l=f;l>r&&(l=r);var c=o*l;a+=t[l]*Math.cos(c),i-=t[l]*Math.sin(c),h+=1}return[a/h,i/h]}function d(t,r,e,n,a){var i=0,o=0,u=6.28318530718*e*(1/r),h=1,s=0,f=.25*a;if(e<=f)for(;e<=f;)f*=.5,h+=1;for(var l=0;l<r;l+=h){var c=l;c>r&&(c=r);var d=u*c;i+=t[c+(r-1)*n]*Math.cos(d),o-=t[c+(r-1)*n]*Math.sin(d),s+=1}return[i/s,o/s]}function v(t,r,e){for(var n=0,a=0,i=1/r,o=6.28318530718*e*i,u=0;u<r;u++){var h=o*u;n+=t[u]*Math.cos(h),a=t[u]*Math.sin(h)-a}return[n*i,a*i]}function p(t,r,e,n){for(var a=0,i=0,o=1/r,u=6.28318530718*e*o,h=0;h<r;h++){var s=u*h;a+=t[h+(r-1)*n]*Math.cos(s),i=t[h+(r-1)*n]*Math.sin(s)-i}return[a*o,i*o]}function g(t,r,e,n){var a=0,i=0,o=6.28318530718*e*(1/r),u=1,h=0,s=.25*n;if(e<=s)for(;e<=s;)s*=.5,u+=1;for(var f=0;f<r;f+=u){var l=f;l>r&&(l=r);var c=o*l;a+=t[l]*Math.cos(c),i=t[l]*Math.sin(c)-i,h+=1}return[a/h,i/h]}function y(t,r,e,n,a){var i=0,o=0,u=6.28318530718*e*(1/r),h=1,s=0,f=.25*a;if(e<=f)for(;e<=f;)f*=.5,h+=1;for(var l=0;l<r;l+=h){var c=l;c>r&&(c=r);var d=u*c;i+=t[c+(r-1)*n]*Math.cos(d),o=t[c+(r-1)*n]*Math.sin(d)-o,s+=1}return[i/s,o/s]}function m(t,r,e,n,a){for(var i=2*a+1,o=0,u=0,h=0,s=-a;s<=a;)if(this.thread.x+s<0||this.thread.x+s>=r)s++;else{for(var f=-a;f<=a;)if(this.thread.y+f<0||this.thread.y+f>=e)f++;else{var l=n[(f+a)*i+s+a],c=t[this.thread.y+s][this.thread.x+f];o+=c.r*l,u+=c.g*l,h+=c.b*l,f++}s++}this.color(o,u,h)}function M(t,r,e,n){var a=c(t,r,this.thread.x,n);return o(a[0],a[1])*e}function w(t,r,e,n){var a=g(t,r,this.thread.x,n);return o(a[0],a[1])*e}var b=(i(n={correlogramsKern:function(t,r){var e=2*Math.floor(this.thread.x/r),n=this.thread.x-Math.floor(this.thread.x/r)*r,a=u(t[e],r),i=u(t[e+1],r),o=h(t[e],a,r),f=h(t[e+1],i,r);return s(t[e],a,o,t[e+1],i,f,r,n)},correlogramsPCKern:function(t,r,e,n){var a=2*Math.floor(this.thread.x/r),i=this.thread.x-Math.floor(this.thread.x/r)*r,o=e[a],u=e[a+1],h=n[a],f=n[a+1];return s(t[a],o,h,t[a+1],u,f,r,i)},dftKern:function(t,r,e){var n=f(t,r,this.thread.x);return o(n[0],n[1])*e},idftKern:function(t,r,e){var n=v(t,r,this.thread.x);return o(n[0],n[1])*e},fftKern:M,ifftKern:w,dft_windowedKern:function(t,r,e,n,a){var i;return o((i=f(t,r,this.thread.x/r*(n-e)+e))[0],i[1])*a},idft_windowedKern:function(t,r,e,n,a){var i;return o((i=v(t,r,this.thread.x/r*(n-e)+e))[0],i[1])*a},fft_windowedKern:function(t,r,e,n,a){var i;return o((i=c(t,r,this.thread.x/r*(n-e)+e))[0],i[1])*a},ifft_windowedKern:function(t,r,e,n,a){var i;return o((i=g(t,r,this.thread.x/r*(n-e)+e))[0],i[1])*a},listdft2DKern:function(t,r){var e=this.output.x,n=f(t[this.thread.y],e,this.thread.x);return o(n[0],n[1])*r},listdft1DKern:function(t,r,e){var n=[0,0];if(this.thread.x<=r)n=f(t,r,this.thread.x);else{var a=Math.floor(this.thread.x/r);n=l(t,r,this.thread.x-a*r,a)}return o(n[0],n[1])*e},listfft1DKern:function(t,r,e,n){var a=[0,0];if(this.thread.x<=r)a=c(t,r,this.thread.x,n);else{var i=Math.floor(this.thread.x/r);a=d(t,r,this.thread.x-i*r,i,n)}return o(a[0],a[1])*e},listfft1D_windowedKern:function(t,r,e,n,a){var i=[0,0];if(this.thread.x<r)i=c(t,r,this.thread.x/r*(n-e)+e,r);else{var u=Math.floor(this.thread.x/r);i=d(t,r,(this.thread.x-u*r)/r*(n-e)+e-u*r,u,r)}return o(i[0],i[1])*a},listdft1D_windowedKern:function(t,r,e,n,a){var i=[0,0];if(this.thread.x<r)i=f(t,r,this.thread.x/r*(n-e)+e);else{var u=Math.floor(this.thread.x/r);i=l(t,r,(this.thread.x-u*r)/r*(n-e)+e-u*r,u)}return o(i[0],i[1])*a},listidft1D_windowedKern:function(t,r,e,n,a){var i=[0,0];if(this.thread.x<r)i=v(t,r,this.thread.x/r*(n-e)+e);else{var u=Math.floor(this.thread.x/r);i=p(t,r,(this.thread.x-u*r)/r*(n-e)+e-u*r,u)}return o(2*i[0],2*i[1])*a},listifft1D_windowedKern:function(t,r,e,n,a){var i=[0,0];if(this.thread.x<r)i=g(t,r,this.thread.x/r*(n-e)+e);else{var u=Math.floor(this.thread.x/r);i=y(t,r,(this.thread.x-u*r)/r*(n-e)+e-u*r,u)}return o(2*i[0],2*i[1])*a},bulkArrayMulKern:function(t,r,e,n){for(var a=t[e*Math.floor(this.thread.x/r)][this.thread.x],i=0;i<e;i++)a*=t[i][this.thread.x];return a*n}},"fftKern",M),i(n,"ifftKern",w),i(n,"multiImgConv2DKern",(function(t,r,e,n,a,i,o){for(var u=0;u<i;u++){var h=a[u],s=(Math.sqrt(h)-1)/2;m(t,r,e,n[u],s)}if(0===o)return[this.color.r,this.color.g,this.color.b]})),n),x=[function(t,r){return t+r},function(t,r){return t-r},function(t,r){return t*r},function(t,r){return t/r},function(t,r,e,n){return[t+e,r+n]},function(t,r,e,n){return[t-e,r-n]},function(t,r,e,n){return[t*e-r*n,t*n+r*e]},function(t,r){var e=Math.exp(t);return[e*Math.cos(r),e*Math.sin(r)]},o,function(t){return 0-t},function(t){for(var r=Math.sqrt(t),e=3;e<=r;){if(t%e==0)return e;e+=2}},u,h,function(t,r,e){for(var n=0,a=0,i=0;i<e;i++)n+=(a=t[i]-r)*a;return n/e},function(t,r,e){for(var n=0,a=0,i=0;i<e;i++)n+=(a=t[i]-r)*a;return Math.sqrt(n/e)},s,function(t,r,e){for(var n=0,a=0;a<r;a++)n+=Math.exp(t[a]);return Math.exp(t[e])/n},f,l,v,p,c,g,y,m];function k(t){return function(t){if(Array.isArray(t))return D(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(t){if("string"==typeof t)return D(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?D(t,r):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function A(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function K(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{setDynamicOutput:!0,setDynamicArguments:!0,setPipeline:!0,setImmutable:!0},n=t.createKernel(r);return e.setDynamicOutput&&n.setDynamicOutput(!0),e.setDynamicArguments&&n.setDynamicArguments(!0),e.setPipeline&&n.setPipeline(!0),e.setImmutable&&n.setImmutable(!0),n}var C=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new a.GPU;A(this,t),this.gpu=r,this.kernel,this.PI=3.141592653589793,this.SQRT1_2=.7071067811865476,this.addFunctions(),this.imgkernels={edgeDetection:[-1,-1,-1,-1,8,-1,-1,-1,-1],boxBlur:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],sobelLeft:[1,0,-1,2,0,-2,1,0,-1],sobelRight:[-1,0,1,-2,0,2,-1,0,1],sobelTop:[1,2,1,0,0,0,-1,-2,-1],sobelBottom:[-1,2,1,0,0,0,1,2,1],identity:[0,0,0,0,1,0,0,0,0],gaussian3x3:[1,2,1,2,4,2,1,2,1],guassian7x7:[0,0,0,5,0,0,0,0,5,18,32,18,5,0,0,18,64,100,64,18,0,5,32,100,100,100,32,5,0,18,64,100,64,18,0,0,5,18,32,18,5,0,0,0,0,5,0,0,0],emboss:[-2,-1,0,-1,1,1,0,1,2],sharpen:[0,-1,0,-1,5,-1,0,-1,0]}}var r,e;return r=t,(e=[{key:"addFunctions",value:function(){var t=this;x.forEach((function(r){return t.gpu.addFunction(r)})),this.correlograms=_(this.gpu,b.correlogramsKern),this.correlogramsPC=_(this.gpu,b.correlogramsKern),this.dft=_(this.gpu,b.dftKern),this.idft=_(this.gpu,b.idftKern),this.dft_windowed=_(this.gpu,b.dft_windowedKern),this.idft_windoed=_(this.gpu,b.idft_windowedKern),this.fft=_(this.gpu,b.fftKern),this.ifft=_(this.gpu,b.ifftKern),this.fft_windowed=_(this.gpu,b.fft_windowedKern),this.ifft_windowed=_(this.gpu,b.ifft_windowedKern),this.listdft2D=_(this.gpu,b.listdft2DKern),this.listdft1D=_(this.gpu,b.listdft1DKern),this.listdft1D_windowed=_(this.gpu,b.listdft1D_windowedKern),this.listfft1D=_(this.gpu,b.listfft1DKern),this.listfft1D_windowed=_(this.gpu,b.listfft1D_windowedKern),this.listidft1D_windowed=_(this.gpu,b.listidft1D_windowedKern),this.listifft1D_windowed=_(this.gpu,b.listifft1D_windowedKern),this.bulkArrayMul=_(this.gpu,b.bulkArrayMulKern),this.multiConv2D=_(this.gpu,b.multiImgConv2DKern),this.gpuCoherence=function(r,e,n,a,i){var o=t.correlograms(r),u=t.listfft1D_windowed(o,e,n,a,i,new Array(Math.ceil(r/e)).fill(0));return t.bulkArrayMul(u,e,5,1)}}},{key:"gpuXCors",value:function(t){var r,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!0===e){var a=[],i=[];t.forEach((function(t,r){a.push(t.reduce((function(t,r){return r+t}))/t.length),i.push(Math.sqrt(a[r].reduce((function(t,r){return t+Math.pow(r-mean1,2)}))))}));for(var o=[],u=[],h=[],s=0;s<t.length;s++)for(var f=s;f<t.length;f++){var l;(l=h).push.apply(l,k(t[s]).concat(k(t[f]))),o.push(a[s],a[f]),u.push(i[s],i[f])}this.correlogramsPC.setOutput([h.length]),this.correlogramsPC.setLoopMaxIterations(2*t[0].length),r=this.correlogramsPC(h,t[0].length,o,u)}else{for(h=[],s=0;s<t.length;s++)for(f=s;f<t.length;f++){var c;(c=h).push.apply(c,k(t[s]).concat(k(t[f])))}this.correlograms.setOutput([h.length]),this.correlograms.setLoopMaxIterations(2*t[0].length),r=this.correlograms(h,t[0].length)}if(!0===n)return r;var d=r.toArray();r.delete();var v=[];for(s=0;s<t.length;s++)v.push(d.splice(0,t[0].length));return v}},{key:"gpuDFT",value:function(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t.length,i=a/r;this.dft.setOutput([t.length]),this.dft.setLoopMaxIterations(a);var o=this.dft(t,a,e,DCoffset);if(!1===n){var u=this.makeFrequencyDistribution(a,i),h=o.toArray();return o.delete(),[u,this.orderMagnitudes(h)]}var s=o;return o.delete(),s}},{key:"MultiChannelDFT",value:function(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=[];t.forEach((function(t){var r;(r=a).push.apply(r,k(t))}));var i=t[0].length,o=i/r;this.listdft1D.setOutput([a.length]),this.listdft1D.setLoopMaxIterations(i);var u=this.listdft1D(a,i,e);if(!1===n){var h=[],s=this.makeFrequencyDistribution(i,o);a=u.toArray();for(var f=0;f<a.length;f+=i)h.push(this.orderMagnitudes(k(a.slice(f,f+i))));return u.delete(),[s,h]}var l=u;return u.delete(),l}},{key:"MultiChannelDFT_Bandpass",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=[];t.forEach((function(t){var r;(r=o).push.apply(r,k(t))}));var u=2*n,h=t[0].length,s=h/r;this.listdft1D_windowed.setOutput([o.length]),this.listdft1D_windowed.setLoopMaxIterations(h);var f=this.listdft1D_windowed(o,s,e,u,a);if(!0===i)return f;o=f.toArray(),f.delete();var l=this.bandPassWindow(e,n,s);return[l,this.orderBPMagnitudes(o,r,s,h)]}},{key:"gpuFFT",value:function(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t.length,i=a/r;this.fft.setOutput([t.length]),this.fft.setLoopMaxIterations(a);var o=this.fft(t,a,e,DCoffset);if(!1===n){var u=this.makeFrequencyDistribution(a,i),h=o.toArray();return o.delete(),[u,this.orderMagnitudes(h)]}var s=o;return o.delete(),s}},{key:"MultiChannelFFT",value:function(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=[];t.forEach((function(t){var r;(r=a).push.apply(r,k(t))}));var i=t[0].length,o=i/r;this.listfft1D.setOutput([a.length]),this.listfft1D.setLoopMaxIterations(i);var u=this.listfft1D(a,i,e);if(!1===n){var h=[],s=this.makeFrequencyDistribution(i,o);a=u.toArray();for(var f=0;f<a.length;f+=i)h.push(this.orderMagnitudes(k(a.slice(f,f+i))));return u.delete(),[s,h]}var l=u;return u.delete(),l}},{key:"MultiChannelFFT_Bandpass",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=[];t.forEach((function(t){var r;(r=o).push.apply(r,k(t))}));var u=2*n,h=t[0].length,s=h/r;this.listfft1D_windowed.setOutput([o.length]),this.listfft1D_windowed.setLoopMaxIterations(h);var f=this.listfft1D_windowed(o,s,e,u,a);if(!0===i)return f;o=f.toArray(),f.delete();var l=this.bandPassWindow(e,n,s);return[l,this.orderBPMagnitudes(o,r,s,h)]}},{key:"orderMagnitudes",value:function(t){return[].concat(k(t.slice(Math.ceil(.5*t.length),t.length)),k(t.slice(0,Math.ceil(.5*t.length))))}},{key:"makeFrequencyDistribution",value:function(t,r){for(var e=t,n=r/e,a=[],i=-e/2;i<e/2;i++){var o=i*n;a.push(o)}return a}},{key:"orderBPMagnitudes",value:function(t,r,e,n){for(var a=[],i=0;i<t.length;i+=n)a.push(k(t.slice(i,Math.ceil(.5*n+i))));var o=[],u=1/e;return r>1?(a.forEach((function(t,r){o.push([]);for(var n=1/Math.max.apply(Math,k(t)),a=0;a<t.length;a++)if(0==a)o[r]=t.slice(a,Math.floor(e)),a=Math.floor(e);else{var i=a-Math.floor(Math.floor(a*u)*e)-1;o[r][i]=o[r][i]*t[a-1]*n}o[r]=k(o[r].slice(0,Math.ceil(.5*o[r].length)))})),o):a}},{key:"bandPassWindow",value:function(t,r,e){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=2*r,i=(a-t)/e,o=[];if(!0===n)for(var u=0;u<Math.ceil(.5*e);u+=i)o.push(t+(a-t)*u/e);else for(u=-Math.ceil(.5*e);u<Math.ceil(.5*e);u+=i)o.push(t+(a-t)*u/e);return o}}])&&K(r.prototype,e),t}();function F(t){return function(t){if(Array.isArray(t))return O(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(t){if("string"==typeof t)return O(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?O(t,r):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function E(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var I=function(){function t(){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t)}var r,e;return r=t,e=[{key:"genSineWave",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:512,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=[],u=[],h=1/n,s=0;s<e;s+=h){var f=Math.sin(2*Math.PI*t*s)*r;f+=Math.sin(2*Math.PI*a*s)*i,o.push(f),u.push(s)}return[u,o]}},{key:"mean",value:function(t){return t.reduce((function(t,r){return r+t}))/t.length}},{key:"variance",value:function(t){for(var r=this.mean(t),e=[],n=0;n<t.length;n++)e.push((t[n]-r)/(t.length-1));return e}},{key:"transpose",value:function(t){return t[0].map((function(r,e){return t.map((function(t){return t[e]}))}))}},{key:"matmul",value:function(t,r){for(var e=t.length,n=t[0].length,a=(r.length,r[0].length),i=new Array(e),o=0;o<e;++o){i[o]=new Array(a);for(var u=0;u<a;++u){i[o][u]=0;for(var h=0;h<n;++h)i[o][u]+=t[o][h]*r[h][u]}}return i}},{key:"cov2d",value:function(t){var r=this,e=this.transpose(t),n=[],a=[],i=[];t.forEach((function(t,e){a.push(r.mean(t))})),e.forEach((function(t,e){i.push(r.mean(t))})),t.forEach((function(r,e){n.push([]);for(var o=0;o<r.length;o++)n[e].push((t[e][o]-a[e])*(t[e][o]-i[o])/(r.length-1))})),console.log(n);for(var o=this.transpose(n),u=n.length,h=n[0].length,s=(o.length,o[0].length),f=new Array(u),l=0;l<u;++l){f[l]=new Array(s);for(var c=0;c<s;++c){f[l][c]=0;for(var d=0;d<h;++d)f[l][c]+=n[l][d]*o[d][c]/(t[0].length-1)}}return f}},{key:"cov1d",value:function(t,r){return this.cov2d([t,r])}},{key:"crosscorrelation",value:function(t,r){var e=[].concat(F(r),F(Array(r.length).fill(0))),n=this.mean(t),a=this.mean(r),i=t.reduce((function(t,r){return t+Math.pow(r-n,2)}));i=Math.sqrt(i);for(var o=r.reduce((function(t,r){return t+Math.pow(r-n,2)})),u=1/(i*(o=Math.sqrt(o))),h=new Array(t.length).fill(0),s=0;s<t.length;s++){var f=t.reduce((function(t,r,i){return t+(r-n)*(e[s+i]-a)}));h[s]=f*u}return h}},{key:"autocorrelation",value:function(t){for(var r=[].concat(F(t),F(Array(t.length).fill(0))),e=this.mean(t),n=t.reduce((function(t,r){return t+Math.pow(r-e,2)})),a=1/((n=Math.sqrt(n))*n),i=new Array(t.length).fill(0),o=0;o<t.length;o++){var u=t.reduce((function(t,n,a){return t+(n-e)*(r[o+a]-e)}));i[o]=u*a}return i}},{key:"correlograms",value:function(r){var e=[];return r.forEach((function(n,a){r.forEach((function(r,i){i>=a&&e.push(t.crosscorrelation(n,r))}))})),e}},{key:"sma",value:function(t,r){for(var e=[],n=0;n<t.length;n++)if(0==n)e.push(t[0]);else if(n<r){var a=t.slice(0,n+1);e.push(a.reduce((function(t,r){return r+t}))/(n+1))}else a=t.slice(n-r,n),e.push(a.reduce((function(t,r){return r+t}))/r);return e}},{key:"interpolateArray",value:function(t,r){var e=this.canvas.height/t.length,n=function(t,r,n){return(t+(r-t)*n)*e},a=new Array,i=new Number((t.length-1)/(r-1));a[0]=t[0];for(var o=1;o<r-1;o++){var u=o*i,h=new Number(Math.floor(u)).toFixed(),s=new Number(Math.ceil(u)).toFixed(),f=u-h;a[o]=n(t[h],t[s],f)}return a[r-1]=t[t.length-1],a}},{key:"isExtrema",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"peak",e=F(t);if(t.length>1){var n=!0;return e.forEach((function(t,a){"peak"===r?(a<Math.floor(.5*e.length)&&t>=e[Math.floor(.5*e.length)]||a>Math.floor(.5*e.length)&&t>=e[Math.floor(.5*e.length)])&&(n=!1):(a<Math.floor(.5*e.length)&&t<=e[Math.floor(.5*e.length)]||a>Math.floor(.5*e.length)&&t<=e[Math.floor(.5*e.length)])&&(n=!1)})),"peak"!==r&&"valley"!==r&&!1===n&&(n=!0,e.forEach((function(t,r){(r<Math.floor(.5*e.length)&&t>=e[Math.floor(.5*e.length)]||r>Math.floor(.5*e.length)&&t>=e[Math.floor(.5*e.length)])&&(n=!1)}))),n}}},{key:"isCriticalPoint",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"peak",e=F(t);if(t.length>1){var n=!0;return e.forEach((function(t,a){"peak"===r?(a<.5*e.length&&t<=0||a>.5*e.length&&t>0)&&(n=!1):(a<.5*e.length&&t>=0||a>.5*e.length&&t<0)&&(n=!1)})),"peak"!==r&&"valley"!==r&&!1===n&&(n=!0,e.forEach((function(t,r){(r<.5*e.length&&t<=0||r>.5*e.length&&t>0)&&(n=!1)}))),n}}}],null&&E(r.prototype,null),e&&E(r,e),t}();function P(t){return function(t){if(Array.isArray(t))return j(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(t){if("string"==typeof t)return j(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?j(t,r):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var T=new C;addEventListener("message",(function(t){console.time("worker");var r="function not defined";switch(t.data.foo){case"xcor":r=I.crosscorrelation(t.data.input[0],t.data.input[1]);break;case"autocor":r=I.autocorrelation(t.data.input);break;case"cov1d":r=I.cov1d(t.data.input[0],t.data.input[1]);break;case"cov2d":r=I.cov2d(t.data.input);break;case"sma":r=I.sma(t.data.input[0],t.data.input[1]);break;case"dft":var e=1;void 0!==t.data.input[2]&&(e=t.data.input[2]),r=T.gpuDFT(t.data.input[0],t.data.input[1],e);break;case"multidft":e=1,void 0!==t.data.input[2]&&(e=t.data.input[2]),r=T.MultiChannelDFT(t.data.input[0],t.data.input[1],e);break;case"multidftbandpass":e=1,void 0!==t.data.input[4]&&(e=t.data.input[4]),r=T.MultiChannelDFT_Bandpass(t.data.input[0],t.data.input[1],t.data.input[2],t.data.input[3],e);break;case"fft":e=1,void 0!==t.data.input[2]&&(e=t.data.input[2]),r=T.gpuFFT(t.data.input[0],t.data.input[1],e);break;case"multifft":e=1,void 0!==t.data.input[2]&&(e=t.data.input[2]),r=T.MultiChannelFFT(t.data.input[0],t.data.input[1],e);break;case"multifftbandpass":e=1,void 0!==t.data.input[4]&&(e=t.data.input[4]),r=T.MultiChannelFFT_Bandpass(t.data.input[0],t.data.input[1],t.data.input[2],t.data.input[3],e);break;case"gpucoh":r=T.gpuCoherence(t.data.input[0],t.data.input[1],t.data.input[2],t.data.input[3],t.data.input[4]);break;case"coherence":var n,a=I.correlograms(t.data.input[0]),i=[].concat(P(t.data.input[0]),P(a)),o=(e=1,(n=T.MultiChannelDFT_Bandpass(i,t.data.input[1],t.data.input[2],t.data.input[3],e))[1].splice(t.data.input[0].length,i.length-t.data.input[0].length)),u=[],h=t.data.input[0].length,s=0,f=0;o.forEach((function(t,r){if(f+s===h){var e=o.splice(r,1);s++,o.splice.apply(o,[s,0].concat(P(e))),f=0}f++}));var l=[];s=0,f=1,o.forEach((function(t,r){var e=new Array(t.length).fill(0);r<h?(t.forEach((function(t,r){e[r]=t})),l.push(e)):(t.forEach((function(t,r){e[r]=t*t/(l[s][r]*l[s+f][r]),e[r]>1&&(e[r]=1)})),++f+s===h&&(s++,f=1),u.push(e))})),r=[n[0],n[1],u]}console.timeEnd("worker"),postMessage({output:r,foo:t.data.foo,origin:t.data.origin})}))}},n={};function a(t){var r=n[t];if(void 0!==r)return r.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,a),i.exports}return a.m=e,a.x=()=>{var t=a.O(void 0,[985],(()=>a(842)));return a.O(t)},t=[],a.O=(r,e,n,i)=>{if(!e){var o=1/0;for(s=0;s<t.length;s++){for(var[e,n,i]=t[s],u=!0,h=0;h<e.length;h++)(!1&i||o>=i)&&Object.keys(a.O).every((t=>a.O[t](e[h])))?e.splice(h--,1):(u=!1,i<o&&(o=i));u&&(t.splice(s--,1),r=n())}return r}i=i||0;for(var s=t.length;s>0&&t[s-1][2]>i;s--)t[s]=t[s-1];t[s]=[e,n,i]},a.f={},a.e=t=>Promise.all(Object.keys(a.f).reduce(((r,e)=>(a.f[e](t,r),r)),[])),a.u=t=>t+".brainsatplay.js",a.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),a.p="/src/libraries/js/dist/",(()=>{var t={842:1};a.f.i=(r,e)=>{t[r]||importScripts(a.p+a.u(r))};var r=this.webpackChunkbrainsatplay=this.webpackChunkbrainsatplay||[],e=r.push.bind(r);r.push=r=>{var[n,i,o]=r;for(var u in i)a.o(i,u)&&(a.m[u]=i[u]);for(o&&o(a);n.length;)t[n.pop()]=1;e(r)}})(),r=a.x,a.x=()=>a.e(985).then(r),a.x()})()}));