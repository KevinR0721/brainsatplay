/*! For license information please see brainsatplay.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.brainsatplay=e():t.brainsatplay=e()}(this,(function(){return(()=>{var t={2182:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6276);function i(t){for(var e=[],n=0;n<t.length;n++)n%3==0?e.push(t[n]<<4|t[n+1]>>4):(e.push((15&t[n])<<8|t[n+1]),n++);return e}function o(t,e){function n(n){return{x:e*t.getInt16(n),y:e*t.getInt16(n+2),z:e*t.getInt16(n+4)}}return{sequenceId:t.getUint16(0),samples:[n(2),n(8),n(14)]}}e.parseControl=function(t){return t.pipe(r.concatMap((function(t){return t.split("")})),r.scan((function(t,e){return t.indexOf("}")>=0?e:t+e}),""),r.filter((function(t){return t.indexOf("}")>=0})),r.map((function(t){return JSON.parse(t)})))},e.decodeUnsigned12BitData=i,e.decodeEEGSamples=function(t){return i(t).map((function(t){return.48828125*(t-2048)}))},e.parseTelemetry=function(t){return{sequenceId:t.getUint16(0),batteryLevel:t.getUint16(2)/512,fuelGaugeVoltage:2.2*t.getUint16(4),temperature:t.getUint16(8)}},e.parseAccelerometer=function(t){return o(t,610352e-10)},e.parseGyroscope=function(t){return o(t,.0074768)}},5080:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}c((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(4496),s=n(6276);e.decodeResponse=function(t){return(new TextDecoder).decode(t.subarray(1,1+t[0]))},e.encodeCommand=function(t){var e=(new TextEncoder).encode("X"+t+"\n");return e[0]=e.length-1,e},e.observableCharacteristic=function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,t.startNotifications()];case 1:return n.sent(),e=o.fromEvent(t.service.device,"gattserverdisconnected"),[2,o.fromEvent(t,"characteristicvaluechanged").pipe(s.takeUntil(e),s.map((function(t){return t.target.value})))]}}))}))}},9768:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4496),i=n(6276),o=n(5856);e.zipSamples=function(t){var e=[],n=null;return t.pipe(i.mergeMap((function(t){if(t.timestamp!==n&&(n=t.timestamp,e.length)){var i=r.from([e.slice()]);return e.splice(0,e.length,t),i}return e.push(t),r.from([])})),i.concat(r.from([e])),i.mergeMap((function(t){var e=t[0].samples.map((function(e,n){for(var r=[NaN,NaN,NaN,NaN,NaN],i=0,s=t;i<s.length;i++){var a=s[i];r[a.electrode]=a.samples[n]}return{data:r,index:t[0].index,timestamp:t[0].timestamp+1e3*n/o.EEG_FREQUENCY}}));return r.from(e)})))}},5856:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}c((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(4496),s=n(6276),a=n(2182),c=n(5080),u=n(9768);e.zipSamples=u.zipSamples,e.MUSE_SERVICE=65165;var l=["273e0003-4c4d-454d-96be-f03bac821358","273e0004-4c4d-454d-96be-f03bac821358","273e0005-4c4d-454d-96be-f03bac821358","273e0006-4c4d-454d-96be-f03bac821358","273e0007-4c4d-454d-96be-f03bac821358"];e.EEG_FREQUENCY=256,e.channelNames=["TP9","AF7","AF8","TP10","AUX"];var h=function(){function t(){this.enableAux=!1,this.deviceName="",this.connectionStatus=new o.BehaviorSubject(!1),this.gatt=null,this.lastIndex=null,this.lastTimestamp=null}return t.prototype.connect=function(t){return r(this,void 0,void 0,(function(){var n,r,u,h,f,d,p,v,g,y,b,m,w,x,S,_,k=this;return i(this,(function(T){switch(T.label){case 0:return t?(this.gatt=t,[3,4]):[3,1];case 1:return[4,navigator.bluetooth.requestDevice({filters:[{services:[e.MUSE_SERVICE]}]})];case 2:return n=T.sent(),r=this,[4,n.gatt.connect()];case 3:r.gatt=T.sent(),T.label=4;case 4:return this.deviceName=this.gatt.device.name||null,[4,this.gatt.getPrimaryService(e.MUSE_SERVICE)];case 5:return u=T.sent(),o.fromEvent(this.gatt.device,"gattserverdisconnected").pipe(s.first()).subscribe((function(){k.gatt=null,k.connectionStatus.next(!1)})),h=this,[4,u.getCharacteristic("273e0001-4c4d-454d-96be-f03bac821358")];case 6:return h.controlChar=T.sent(),f=this,[4,c.observableCharacteristic(this.controlChar)];case 7:return f.rawControlData=T.sent().pipe(s.map((function(t){return c.decodeResponse(new Uint8Array(t.buffer))})),s.share()),this.controlResponses=a.parseControl(this.rawControlData),[4,u.getCharacteristic("273e000b-4c4d-454d-96be-f03bac821358")];case 8:return d=T.sent(),p=this,[4,c.observableCharacteristic(d)];case 9:return p.telemetryData=T.sent().pipe(s.map(a.parseTelemetry)),[4,u.getCharacteristic("273e0009-4c4d-454d-96be-f03bac821358")];case 10:return v=T.sent(),g=this,[4,c.observableCharacteristic(v)];case 11:return g.gyroscopeData=T.sent().pipe(s.map(a.parseGyroscope)),[4,u.getCharacteristic("273e000a-4c4d-454d-96be-f03bac821358")];case 12:return y=T.sent(),b=this,[4,c.observableCharacteristic(y)];case 13:b.accelerometerData=T.sent().pipe(s.map(a.parseAccelerometer)),this.eventMarkers=new o.Subject,this.eegCharacteristics=[],m=[],w=this.enableAux?l.length:4,x=function(t){var e,n,r,o;return i(this,(function(i){switch(i.label){case 0:return e=l[t],[4,u.getCharacteristic(e)];case 1:return n=i.sent(),o=(r=m).push,[4,c.observableCharacteristic(n)];case 2:return o.apply(r,[i.sent().pipe(s.map((function(e){var n=e.getUint16(0);return{electrode:t,index:n,samples:a.decodeEEGSamples(new Uint8Array(e.buffer).subarray(2)),timestamp:k.getTimestamp(n)}})))]),S.eegCharacteristics.push(n),[2]}}))},S=this,_=0,T.label=14;case 14:return _<w?[5,x(_)]:[3,17];case 15:T.sent(),T.label=16;case 16:return _++,[3,14];case 17:return this.eegReadings=o.merge.apply(void 0,m),this.connectionStatus.next(!0),[2]}}))}))},t.prototype.sendCommand=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.controlChar.writeValue(c.encodeCommand(t))];case 1:return e.sent(),[2]}}))}))},t.prototype.start=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return[4,this.pause()];case 1:return e.sent(),t=this.enableAux?"p20":"p21",[4,this.controlChar.writeValue(c.encodeCommand(t))];case 2:return e.sent(),[4,this.controlChar.writeValue(c.encodeCommand("s"))];case 3:return e.sent(),[4,this.resume()];case 4:return e.sent(),[2]}}))}))},t.prototype.pause=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.sendCommand("h")];case 1:return t.sent(),[2]}}))}))},t.prototype.resume=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.sendCommand("d")];case 1:return t.sent(),[2]}}))}))},t.prototype.deviceInfo=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return t=this.controlResponses.pipe(s.filter((function(t){return!!t.fw})),s.take(1)).toPromise(),[4,this.sendCommand("v1")];case 1:return e.sent(),[2,t]}}))}))},t.prototype.injectMarker=function(t,e){return void 0===e&&(e=(new Date).getTime()),r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.eventMarkers.next({value:t,timestamp:e})];case 1:return n.sent(),[2]}}))}))},t.prototype.disconnect=function(){this.gatt&&(this.lastIndex=null,this.lastTimestamp=null,this.gatt.disconnect(),this.connectionStatus.next(!1))},t.prototype.getTimestamp=function(t){var n=1/e.EEG_FREQUENCY*1e3*12;for(null!==this.lastIndex&&null!==this.lastTimestamp||(this.lastIndex=t,this.lastTimestamp=(new Date).getTime()-n);this.lastIndex-t>4096;)t+=65536;return t===this.lastIndex?this.lastTimestamp:t>this.lastIndex?(this.lastTimestamp+=n*(t-this.lastIndex),this.lastIndex=t,this.lastTimestamp):this.lastTimestamp-n*(this.lastIndex-t)},t}();e.MuseClient=h},5047:t=>{var e=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof g?e:g,o=Object.create(i.prototype),s=new A(r||[]);return o._invoke=function(t,e,n){var r=h;return function(i,o){if(r===d)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw o;return O()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=T(s,n);if(a){if(a===v)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var c=l(t,e,n);if("normal"===c.type){if(r=n.done?p:f,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(t,n,s),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var h="suspendedStart",f="suspendedYield",d="executing",p="completed",v={};function g(){}function y(){}function b(){}var m={};m[o]=function(){return this};var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==n&&r.call(x,o)&&(m=x);var S=b.prototype=g.prototype=Object.create(m);function _(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(i,o,s,a){var c=l(t[i],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==typeof h&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(h).then((function(t){u.value=t,s(u)}),(function(t){return n("throw",t,s,a)}))}a(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function T(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=l(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function I(t){if(t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}return{next:O}}function O(){return{value:e,done:!0}}return y.prototype=S.constructor=b,b.constructor=y,y.displayName=c(b,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,a,"GeneratorFunction")),t.prototype=Object.create(S),t},t.awrap=function(t){return{__await:t}},_(k.prototype),k.prototype[s]=function(){return this},t.AsyncIterator=k,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var s=new k(u(e,n,r,i),o);return t.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},_(S),c(S,a,"Generator"),S[o]=function(){return this},S.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=I,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return a.type="throw",a.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),C(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;C(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:I(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}},9892:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4496);e.BehaviorSubject=r.BehaviorSubject},3646:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4496);e.Subject=r.Subject},4874:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4496);e.fromEvent=r.fromEvent},8313:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6276);e.filter=r.filter},9904:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6276);e.first=r.first},2778:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6276);e.map=r.map},213:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6276);e.mergeMap=r.mergeMap},4025:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6276);e.takeUntil=r.takeUntil},8181:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6276);e.tap=r.tap},4633:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(9892))},5955:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(3646))},4496:(t,e,n)=>{"use strict";n.r(e),n.d(e,{ArgumentOutOfRangeError:()=>O.W,AsyncSubject:()=>l.c,BehaviorSubject:()=>c.X,ConnectableObservable:()=>i.c,EMPTY:()=>K.E,EmptyError:()=>F.K,GroupedObservable:()=>o.T,NEVER:()=>ht,Notification:()=>T.P,NotificationKind:()=>T.W,ObjectUnsubscribedError:()=>P.N,Observable:()=>r.y,ReplaySubject:()=>u.t,Scheduler:()=>S.b,Subject:()=>a.xQ,Subscriber:()=>k.L,Subscription:()=>_.w,TimeoutError:()=>D.W,UnsubscriptionError:()=>N.B,VirtualAction:()=>x,VirtualTimeScheduler:()=>w,animationFrame:()=>m,animationFrameScheduler:()=>b,asap:()=>h.e,asapScheduler:()=>h.E,async:()=>f.P,asyncScheduler:()=>f.z,bindCallback:()=>L,bindNodeCallback:()=>G,combineLatest:()=>W.aj,concat:()=>Y.z,config:()=>It.v,defer:()=>H.P,empty:()=>K.c,forkJoin:()=>$,from:()=>Q.D,fromEvent:()=>et,fromEventPattern:()=>rt,generate:()=>it,identity:()=>A.y,iif:()=>st,interval:()=>ct,isObservable:()=>I,merge:()=>lt.T,never:()=>ft,noop:()=>C.Z,observable:()=>s.L,of:()=>dt.of,onErrorResumeNext:()=>pt,pairs:()=>vt,partition:()=>wt,pipe:()=>E.z,queue:()=>d.c,queueScheduler:()=>d.N,race:()=>xt.S3,range:()=>St,scheduled:()=>At.x,throwError:()=>kt._,timer:()=>Tt.H,using:()=>Et,zip:()=>Ct.$R});var r=n(9939),i=n(9386),o=n(453),s=n(8859),a=n(1194),c=n(4580),u=n(1048),l=n(3866),h=n(4858),f=n(646),d=n(7410),p=n(2995),v=n(9795),g=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return p.ZT(e,t),e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0?t.prototype.requestAsyncId.call(this,e,n,r):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame((function(){return e.flush(null)}))))},e.prototype.recycleAsyncId=function(e,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,r);0===e.actions.length&&(cancelAnimationFrame(n),e.scheduled=void 0)},e}(v.o),y=n(2966),b=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p.ZT(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,r=-1,i=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++r<i&&(t=n.shift()));if(this.active=!1,e){for(;++r<i&&(t=n.shift());)t.unsubscribe();throw e}},e}(y.v))(g),m=b,w=function(t){function e(e,n){void 0===e&&(e=x),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=t.call(this,e,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return p.ZT(e,t),e.prototype.flush=function(){for(var t,e,n=this.actions,r=this.maxFrames;(e=n[0])&&e.delay<=r&&(n.shift(),this.frame=e.delay,!(t=e.execute(e.state,e.delay))););if(t){for(;e=n.shift();)e.unsubscribe();throw t}},e.frameTimeFactor=10,e}(y.v),x=function(t){function e(e,n,r){void 0===r&&(r=e.index+=1);var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.index=r,i.active=!0,i.index=e.index=r,i}return p.ZT(e,t),e.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return t.prototype.schedule.call(this,n,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},e.prototype.requestAsyncId=function(t,n,r){void 0===r&&(r=0),this.delay=t.frame+r;var i=t.actions;return i.push(this),i.sort(e.sortActions),!0},e.prototype.recycleAsyncId=function(t,e,n){void 0===n&&(n=0)},e.prototype._execute=function(e,n){if(!0===this.active)return t.prototype._execute.call(this,e,n)},e.sortActions=function(t,e){return t.delay===e.delay?t.index===e.index?0:t.index>e.index?1:-1:t.delay>e.delay?1:-1},e}(v.o),S=n(7035),_=n(1586),k=n(1881),T=n(8781),E=n(1199),C=n(4582),A=n(6930);function I(t){return!!t&&(t instanceof r.y||"function"==typeof t.lift&&"function"==typeof t.subscribe)}var O=n(9120),F=n(4397),P=n(906),N=n(2674),D=n(5915),j=n(2188),R=n(4658),B=n(3073),z=n(4070);function L(t,e,n){if(e){if(!(0,z.K)(e))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return L(t,n).apply(void 0,r).pipe((0,j.U)((function(t){return(0,B.k)(t)?e.apply(void 0,t):e(t)})))};n=e}return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var o,s=this,a={context:s,subject:o,callbackFunc:t,scheduler:n};return new r.y((function(r){if(n){var i={args:e,subscriber:r,params:a};return n.schedule(M,0,i)}if(!o){o=new l.c;try{t.apply(s,e.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];o.next(t.length<=1?t[0]:t),o.complete()}]))}catch(t){(0,R._)(o)?o.error(t):console.warn(t)}}return o.subscribe(r)}))}}function M(t){var e=this,n=t.args,r=t.subscriber,i=t.params,o=i.callbackFunc,s=i.context,a=i.scheduler,c=i.subject;if(!c){c=i.subject=new l.c;try{o.apply(s,n.concat([function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t.length<=1?t[0]:t;e.add(a.schedule(V,0,{value:r,subject:c}))}]))}catch(t){c.error(t)}}this.add(c.subscribe(r))}function V(t){var e=t.value,n=t.subject;n.next(e),n.complete()}function G(t,e,n){if(e){if(!(0,z.K)(e))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return G(t,n).apply(void 0,r).pipe((0,j.U)((function(t){return(0,B.k)(t)?e.apply(void 0,t):e(t)})))};n=e}return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var o={subject:void 0,args:e,callbackFunc:t,scheduler:n,context:this};return new r.y((function(r){var i=o.context,s=o.subject;if(n)return n.schedule(U,0,{params:o,subscriber:r,context:i});if(!s){s=o.subject=new l.c;try{t.apply(i,e.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.shift();n?s.error(n):(s.next(t.length<=1?t[0]:t),s.complete())}]))}catch(t){(0,R._)(s)?s.error(t):console.warn(t)}}return s.subscribe(r)}))}}function U(t){var e=this,n=t.params,r=t.subscriber,i=t.context,o=n.callbackFunc,s=n.args,a=n.scheduler,c=n.subject;if(!c){c=n.subject=new l.c;try{o.apply(i,s.concat([function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t.shift();if(r)e.add(a.schedule(Z,0,{err:r,subject:c}));else{var i=t.length<=1?t[0]:t;e.add(a.schedule(q,0,{value:i,subject:c}))}}]))}catch(t){this.add(a.schedule(Z,0,{err:t,subject:c}))}}this.add(c.subscribe(r))}function q(t){var e=t.value,n=t.subject;n.next(e),n.complete()}function Z(t){var e=t.err;t.subject.error(e)}var W=n(97),Y=n(4245),H=n(6542),K=n(4773),J=n(757),Q=n(7238);function $(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){var n=t[0];if((0,B.k)(n))return X(n,null);if((0,J.K)(n)&&Object.getPrototypeOf(n)===Object.prototype){var r=Object.keys(n);return X(r.map((function(t){return n[t]})),r)}}if("function"==typeof t[t.length-1]){var i=t.pop();return X(t=1===t.length&&(0,B.k)(t[0])?t[0]:t,null).pipe((0,j.U)((function(t){return i.apply(void 0,t)})))}return X(t,null)}function X(t,e){return new r.y((function(n){var r=t.length;if(0!==r)for(var i=new Array(r),o=0,s=0,a=function(a){var c=(0,Q.D)(t[a]),u=!1;n.add(c.subscribe({next:function(t){u||(u=!0,s++),i[a]=t},error:function(t){return n.error(t)},complete:function(){++o!==r&&u||(s===r&&n.next(e?e.reduce((function(t,e,n){return t[e]=i[n],t}),{}):i),n.complete())}}))},c=0;c<r;c++)a(c);else n.complete()}))}var tt=n(7371);function et(t,e,n,i){return(0,tt.m)(n)&&(i=n,n=void 0),i?et(t,e,n).pipe((0,j.U)((function(t){return(0,B.k)(t)?i.apply(void 0,t):i(t)}))):new r.y((function(r){nt(t,e,(function(t){arguments.length>1?r.next(Array.prototype.slice.call(arguments)):r.next(t)}),r,n)}))}function nt(t,e,n,r,i){var o;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){var s=t;t.addEventListener(e,n,i),o=function(){return s.removeEventListener(e,n,i)}}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){var a=t;t.on(e,n),o=function(){return a.off(e,n)}}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){var c=t;t.addListener(e,n),o=function(){return c.removeListener(e,n)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var u=0,l=t.length;u<l;u++)nt(t[u],e,n,r,i)}r.add(o)}function rt(t,e,n){return n?rt(t,e).pipe((0,j.U)((function(t){return(0,B.k)(t)?n.apply(void 0,t):n(t)}))):new r.y((function(n){var r,i=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.next(1===t.length?t[0]:t)};try{r=t(i)}catch(t){return void n.error(t)}if((0,tt.m)(e))return function(){return e(i,r)}}))}function it(t,e,n,i,o){var s,a;if(1==arguments.length){var c=t;a=c.initialState,e=c.condition,n=c.iterate,s=c.resultSelector||A.y,o=c.scheduler}else void 0===i||(0,z.K)(i)?(a=t,s=A.y,o=i):(a=t,s=i);return new r.y((function(t){var r=a;if(o)return o.schedule(ot,0,{subscriber:t,iterate:n,condition:e,resultSelector:s,state:r});for(;;){if(e){var i=void 0;try{i=e(r)}catch(e){return void t.error(e)}if(!i){t.complete();break}}var c=void 0;try{c=s(r)}catch(e){return void t.error(e)}if(t.next(c),t.closed)break;try{r=n(r)}catch(e){return void t.error(e)}}}))}function ot(t){var e=t.subscriber,n=t.condition;if(!e.closed){if(t.needIterate)try{t.state=t.iterate(t.state)}catch(t){return void e.error(t)}else t.needIterate=!0;if(n){var r=void 0;try{r=n(t.state)}catch(t){return void e.error(t)}if(!r)return void e.complete();if(e.closed)return}var i;try{i=t.resultSelector(t.state)}catch(t){return void e.error(t)}if(!e.closed&&(e.next(i),!e.closed))return this.schedule(t)}}function st(t,e,n){return void 0===e&&(e=K.E),void 0===n&&(n=K.E),(0,H.P)((function(){return t()?e:n}))}var at=n(6712);function ct(t,e){return void 0===t&&(t=0),void 0===e&&(e=f.P),(!(0,at.k)(t)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=f.P),new r.y((function(n){return n.add(e.schedule(ut,t,{subscriber:n,counter:0,period:t})),n}))}function ut(t){var e=t.subscriber,n=t.counter,r=t.period;e.next(n),this.schedule({subscriber:e,counter:n+1,period:r},r)}var lt=n(7686),ht=new r.y(C.Z);function ft(){return ht}var dt=n(6612);function pt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)return K.E;var n=t[0],i=t.slice(1);return 1===t.length&&(0,B.k)(n)?pt.apply(void 0,n):new r.y((function(t){var e=function(){return t.add(pt.apply(void 0,i).subscribe(t))};return(0,Q.D)(n).subscribe({next:function(e){t.next(e)},error:e,complete:e})}))}function vt(t,e){return e?new r.y((function(n){var r=Object.keys(t),i=new _.w;return i.add(e.schedule(gt,0,{keys:r,index:0,subscriber:n,subscription:i,obj:t})),i})):new r.y((function(e){for(var n=Object.keys(t),r=0;r<n.length&&!e.closed;r++){var i=n[r];t.hasOwnProperty(i)&&e.next([i,t[i]])}e.complete()}))}function gt(t){var e=t.keys,n=t.index,r=t.subscriber,i=t.subscription,o=t.obj;if(!r.closed)if(n<e.length){var s=e[n];r.next([s,o[s]]),i.add(this.schedule({keys:e,index:n+1,subscriber:r,subscription:i,obj:o}))}else r.complete()}var yt=n(5683),bt=n(1400),mt=n(2730);function wt(t,e,n){return[(0,mt.h)(e,n)(new r.y((0,bt.s)(t))),(0,mt.h)((0,yt.f)(e,n))(new r.y((0,bt.s)(t)))]}var xt=n(2219);function St(t,e,n){return void 0===t&&(t=0),new r.y((function(r){void 0===e&&(e=t,t=0);var i=0,o=t;if(n)return n.schedule(_t,0,{index:i,count:e,start:t,subscriber:r});for(;;){if(i++>=e){r.complete();break}if(r.next(o++),r.closed)break}}))}function _t(t){var e=t.start,n=t.index,r=t.count,i=t.subscriber;n>=r?i.complete():(i.next(e),i.closed||(t.index=n+1,t.start=e+1,this.schedule(t)))}var kt=n(4236),Tt=n(3254);function Et(t,e){return new r.y((function(n){var r,i;try{r=t()}catch(t){return void n.error(t)}try{i=e(r)}catch(t){return void n.error(t)}var o=(i?(0,Q.D)(i):K.E).subscribe(n);return function(){o.unsubscribe(),r&&r.unsubscribe()}}))}var Ct=n(1131),At=n(2540),It=n(604)},3866:(t,e,n)=>{"use strict";n.d(e,{c:()=>s});var r=n(2995),i=n(1194),o=n(1586),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=null,e.hasNext=!1,e.hasCompleted=!1,e}return r.ZT(e,t),e.prototype._subscribe=function(e){return this.hasError?(e.error(this.thrownError),o.w.EMPTY):this.hasCompleted&&this.hasNext?(e.next(this.value),e.complete(),o.w.EMPTY):t.prototype._subscribe.call(this,e)},e.prototype.next=function(t){this.hasCompleted||(this.value=t,this.hasNext=!0)},e.prototype.error=function(e){this.hasCompleted||t.prototype.error.call(this,e)},e.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&t.prototype.next.call(this,this.value),t.prototype.complete.call(this)},e}(i.xQ)},4580:(t,e,n)=>{"use strict";n.d(e,{X:()=>s});var r=n(2995),i=n(1194),o=n(906),s=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return r.ZT(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new o.N;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(i.xQ)},8781:(t,e,n)=>{"use strict";n.d(e,{W:()=>r,P:()=>a});var r,i=n(4773),o=n(6612),s=n(4236);r||(r={});var a=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){switch(this.kind){case"N":return(0,o.of)(this.value);case"E":return(0,s._)(this.error);case"C":return(0,i.c)()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}()},9939:(t,e,n)=>{"use strict";n.d(e,{y:()=>l});var r=n(4658),i=n(1881),o=n(2532),s=n(5629),a=n(8859),c=n(1199),u=n(604),l=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,a=function(t,e,n){if(t){if(t instanceof i.L)return t;if(t[o.b])return t[o.b]()}return t||e||n?new i.L(t,e,n):new i.L(s.c)}(t,e,n);if(r?a.add(r.call(a,this.source)):a.add(this.source||u.v.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),u.v.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){u.v.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),(0,r._)(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=h(e))((function(e,r){var i;i=n.subscribe((function(e){try{t(e)}catch(t){r(t),i&&i.unsubscribe()}}),r,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[a.L]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:(0,c.U)(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=h(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function h(t){if(t||(t=u.v.Promise||Promise),!t)throw new Error("no Promise impl found");return t}},5629:(t,e,n)=>{"use strict";n.d(e,{c:()=>o});var r=n(604),i=n(7804),o={closed:!0,next:function(t){},error:function(t){if(r.v.useDeprecatedSynchronousErrorHandling)throw t;(0,i.z)(t)},complete:function(){}}},6807:(t,e,n)=>{"use strict";n.d(e,{L:()=>i});var r=n(2995),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.ZT(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(n(1881).L)},1048:(t,e,n)=>{"use strict";n.d(e,{t:()=>l});var r=n(2995),i=n(1194),o=n(7410),s=n(1586),a=n(9433),c=n(906),u=n(7566),l=function(t){function e(e,n,r){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=e<1?1:e,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return r.ZT(e,t),e.prototype.nextInfiniteTimeWindow=function(e){if(!this.isStopped){var n=this._events;n.push(e),n.length>this._bufferSize&&n.shift()}t.prototype.next.call(this,e)},e.prototype.nextTimeWindow=function(e){this.isStopped||(this._events.push(new h(this._getNow(),e)),this._trimBufferThenGetEvents()),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;if(this.closed)throw new c.N;if(this.isStopped||this.hasError?e=s.w.EMPTY:(this.observers.push(t),e=new u.W(this,t)),i&&t.add(t=new a.ht(t,i)),n)for(var l=0;l<o&&!t.closed;l++)t.next(r[l]);else for(l=0;l<o&&!t.closed;l++)t.next(r[l].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},e.prototype._getNow=function(){return(this.scheduler||o.c).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(t-r[o].time<n);)o++;return i>e&&(o=Math.max(o,i-e)),o>0&&r.splice(0,o),r},e}(i.xQ),h=function(){return function(t,e){this.time=t,this.value=e}}()},7035:(t,e,n)=>{"use strict";n.d(e,{b:()=>r});var r=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}()},1194:(t,e,n)=>{"use strict";n.d(e,{Yc:()=>l,xQ:()=>h});var r=n(2995),i=n(9939),o=n(1881),s=n(1586),a=n(906),c=n(7566),u=n(2532),l=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return r.ZT(e,t),e}(o.L),h=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r.ZT(e,t),e.prototype[u.b]=function(){return new l(this)},e.prototype.lift=function(t){var e=new f(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new a.N;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].next(t)},e.prototype.error=function(t){if(this.closed)throw new a.N;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new a.N;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new a.N;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new a.N;return this.hasError?(t.error(this.thrownError),s.w.EMPTY):this.isStopped?(t.complete(),s.w.EMPTY):(this.observers.push(t),new c.W(this,t))},e.prototype.asObservable=function(){var t=new i.y;return t.source=this,t},e.create=function(t,e){return new f(t,e)},e}(i.y),f=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return r.ZT(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):s.w.EMPTY},e}(h)},7566:(t,e,n)=>{"use strict";n.d(e,{W:()=>i});var r=n(2995),i=function(t){function e(e,n){var r=t.call(this)||this;return r.subject=e,r.subscriber=n,r.closed=!1,r}return r.ZT(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(n(1586).w)},1881:(t,e,n)=>{"use strict";n.d(e,{L:()=>l});var r=n(2995),i=n(7371),o=n(5629),s=n(1586),a=n(2532),c=n(604),u=n(7804),l=function(t){function e(n,r,i){var s=t.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=o.c;break;case 1:if(!n){s.destination=o.c;break}if("object"==typeof n){n instanceof e?(s.syncErrorThrowable=n.syncErrorThrowable,s.destination=n,n.add(s)):(s.syncErrorThrowable=!0,s.destination=new h(s,n));break}default:s.syncErrorThrowable=!0,s.destination=new h(s,n,r,i)}return s}return r.ZT(e,t),e.prototype[a.b]=function(){return this},e.create=function(t,n,r){var i=new e(t,n,r);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(s.w),h=function(t){function e(e,n,r,s){var a,c=t.call(this)||this;c._parentSubscriber=e;var u=c;return(0,i.m)(n)?a=n:n&&(a=n.next,r=n.error,s=n.complete,n!==o.c&&(u=Object.create(n),(0,i.m)(u.unsubscribe)&&c.add(u.unsubscribe.bind(u)),u.unsubscribe=c.unsubscribe.bind(c))),c._context=u,c._next=a,c._error=r,c._complete=s,c}return r.ZT(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;c.v.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=c.v.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):(0,u.z)(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;(0,u.z)(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};c.v.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),c.v.useDeprecatedSynchronousErrorHandling)throw t;(0,u.z)(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!c.v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(e){return c.v.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):((0,u.z)(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(l)},1586:(t,e,n)=>{"use strict";n.d(e,{w:()=>a});var r=n(3073),i=n(757),o=n(7371),s=n(2674),a=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this,a=n._parentOrParents,u=n._ctorUnsubscribe,l=n._unsubscribe,h=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,a instanceof t)a.remove(this);else if(null!==a)for(var f=0;f<a.length;++f)a[f].remove(this);if((0,o.m)(l)){u&&(this._unsubscribe=void 0);try{l.call(this)}catch(t){e=t instanceof s.B?c(t.errors):[t]}}if((0,r.k)(h)){f=-1;for(var d=h.length;++f<d;){var p=h[f];if((0,i.K)(p))try{p.unsubscribe()}catch(t){e=e||[],t instanceof s.B?e=e.concat(c(t.errors)):e.push(t)}}}if(e)throw new s.B(e)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof t){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.EMPTY=((e=new t).closed=!0,e),t}();function c(t){return t.reduce((function(t,e){return t.concat(e instanceof s.B?e.errors:e)}),[])}},604:(t,e,n)=>{"use strict";n.d(e,{v:()=>i});var r=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack,r=t},get useDeprecatedSynchronousErrorHandling(){return r}}},3694:(t,e,n)=>{"use strict";n.d(e,{IY:()=>a,Ds:()=>c,ft:()=>u});var r=n(2995),i=n(1881),o=n(9939),s=n(1400),a=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,n}return r.ZT(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(i.L),c=(i.L,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.ZT(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(i.L));function u(t,e){if(!e.closed){if(t instanceof o.y)return t.subscribe(e);var n;try{n=(0,s.s)(t)(e)}catch(t){e.error(t)}return n}}i.L},9386:(t,e,n)=>{"use strict";n.d(e,{c:()=>u,N:()=>l});var r=n(2995),i=n(1194),o=n(9939),s=n(1881),a=n(1586),c=n(6840),u=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return r.ZT(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new a.w).add(this.source.subscribe(new h(this.getSubject(),this))),t.closed&&(this._connection=null,t=a.w.EMPTY)),t},e.prototype.refCount=function(){return(0,c.x)()(this)},e}(o.y),l=function(){var t=u.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}}(),h=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return r.ZT(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(i.Yc);s.L},97:(t,e,n)=>{"use strict";n.d(e,{aj:()=>l,Ms:()=>h});var r=n(2995),i=n(4070),o=n(3073),s=n(6807),a=n(505),c=n(7),u={};function l(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=void 0,r=void 0;return(0,i.K)(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&(0,o.k)(t[0])&&(t=t[0]),(0,c.n)(t,r).lift(new h(n))}var h=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new f(t,this.resultSelector))},t}(),f=function(t){function e(e,n){var r=t.call(this,e)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return r.ZT(e,t),e.prototype._next=function(t){this.values.push(u),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add((0,a.D)(this,r,void 0,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n){var r=this.values,i=r[n],o=this.toRespond?i===u?--this.toRespond:this.toRespond:0;r[n]=e,0===o&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(s.L)},4245:(t,e,n)=>{"use strict";n.d(e,{z:()=>o});var r=n(6612),i=n(430);function o(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,i.u)()(r.of.apply(void 0,t))}},6542:(t,e,n)=>{"use strict";n.d(e,{P:()=>s});var r=n(9939),i=n(7238),o=n(4773);function s(t){return new r.y((function(e){var n;try{n=t()}catch(t){return void e.error(t)}return(n?(0,i.D)(n):(0,o.c)()).subscribe(e)}))}},4773:(t,e,n)=>{"use strict";n.d(e,{E:()=>i,c:()=>o});var r=n(9939),i=new r.y((function(t){return t.complete()}));function o(t){return t?function(t){return new r.y((function(e){return t.schedule((function(){return e.complete()}))}))}(t):i}},7238:(t,e,n)=>{"use strict";n.d(e,{D:()=>s});var r=n(9939),i=n(1400),o=n(2540);function s(t,e){return e?(0,o.x)(t,e):t instanceof r.y?t:new r.y((0,i.s)(t))}},7:(t,e,n)=>{"use strict";n.d(e,{n:()=>s});var r=n(9939),i=n(7651),o=n(6405);function s(t,e){return e?(0,o.r)(t,e):new r.y((0,i.V)(t))}},7686:(t,e,n)=>{"use strict";n.d(e,{T:()=>a});var r=n(9939),i=n(4070),o=n(7258),s=n(7);function a(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Number.POSITIVE_INFINITY,a=null,c=t[t.length-1];return(0,i.K)(c)?(a=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof c&&(n=t.pop()),null===a&&1===t.length&&t[0]instanceof r.y?t[0]:(0,o.J)(n)((0,s.n)(t,a))}},6612:(t,e,n)=>{"use strict";n.d(e,{of:()=>s});var r=n(4070),i=n(7),o=n(6405);function s(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return(0,r.K)(n)?(t.pop(),(0,o.r)(t,n)):(0,i.n)(t)}},2219:(t,e,n)=>{"use strict";n.d(e,{S3:()=>c});var r=n(2995),i=n(3073),o=n(7),s=n(6807),a=n(505);function c(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){if(!(0,i.k)(t[0]))return t[0];t=t[0]}return(0,o.n)(t,void 0).lift(new u)}var u=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new l(t))},t}(),l=function(t){function e(e){var n=t.call(this,e)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}return r.ZT(e,t),e.prototype._next=function(t){this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{for(var n=0;n<e&&!this.hasFirst;n++){var r=t[n],i=(0,a.D)(this,r,void 0,n);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},e.prototype.notifyNext=function(t,e,n){if(!this.hasFirst){this.hasFirst=!0;for(var r=0;r<this.subscriptions.length;r++)if(r!==n){var i=this.subscriptions[r];i.unsubscribe(),this.remove(i)}this.subscriptions=null}this.destination.next(e)},e}(s.L)},4236:(t,e,n)=>{"use strict";n.d(e,{_:()=>i});var r=n(9939);function i(t,e){return e?new r.y((function(n){return e.schedule(o,0,{error:t,subscriber:n})})):new r.y((function(e){return e.error(t)}))}function o(t){var e=t.error;t.subscriber.error(e)}},3254:(t,e,n)=>{"use strict";n.d(e,{H:()=>a});var r=n(9939),i=n(646),o=n(6712),s=n(4070);function a(t,e,n){void 0===t&&(t=0);var a=-1;return(0,o.k)(e)?a=Number(e)<1?1:Number(e):(0,s.K)(e)&&(n=e),(0,s.K)(n)||(n=i.P),new r.y((function(e){var r=(0,o.k)(t)?t:+t-n.now();return n.schedule(c,r,{index:0,period:a,subscriber:e})}))}function c(t){var e=t.index,n=t.period,r=t.subscriber;if(r.next(e),!r.closed){if(-1===n)return r.complete();t.index=e+1,this.schedule(t,n)}}},1131:(t,e,n)=>{"use strict";n.d(e,{$R:()=>u,mx:()=>l});var r=n(2995),i=n(7),o=n(3073),s=n(1881),a=n(2),c=n(3694);function u(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return"function"==typeof n&&t.pop(),(0,i.n)(t,void 0).lift(new l(n))}var l=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new h(t,this.resultSelector))},t}(),h=function(t){function e(e,n,r){void 0===r&&(r=Object.create(null));var i=t.call(this,e)||this;return i.resultSelector=n,i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:void 0,i}return r.ZT(e,t),e.prototype._next=function(t){var e=this.iterators;(0,o.k)(t)?e.push(new d(t)):"function"==typeof t[a.hZ]?e.push(new f(t[a.hZ]())):e.push(new p(this.destination,this,t))},e.prototype._complete=function(){var t=this.iterators,e=t.length;if(this.unsubscribe(),0!==e){this.active=e;for(var n=0;n<e;n++){var r=t[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}else this.destination.complete()},e.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},e.prototype.checkIterators=function(){for(var t=this.iterators,e=t.length,n=this.destination,r=0;r<e;r++)if("function"==typeof(s=t[r]).hasValue&&!s.hasValue())return;var i=!1,o=[];for(r=0;r<e;r++){var s,a=(s=t[r]).next();if(s.hasCompleted()&&(i=!0),a.done)return void n.complete();o.push(a.value)}this.resultSelector?this._tryresultSelector(o):n.next(o),i&&n.complete()},e.prototype._tryresultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(s.L),f=function(){function t(t){this.iterator=t,this.nextResult=t.next()}return t.prototype.hasValue=function(){return!0},t.prototype.next=function(){var t=this.nextResult;return this.nextResult=this.iterator.next(),t},t.prototype.hasCompleted=function(){var t=this.nextResult;return Boolean(t&&t.done)},t}(),d=function(){function t(t){this.array=t,this.index=0,this.length=0,this.length=t.length}return t.prototype[a.hZ]=function(){return this},t.prototype.next=function(t){var e=this.index++,n=this.array;return e<this.length?{value:n[e],done:!1}:{value:null,done:!0}},t.prototype.hasValue=function(){return this.array.length>this.index},t.prototype.hasCompleted=function(){return this.array.length===this.index},t}(),p=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return r.ZT(e,t),e.prototype[a.hZ]=function(){return this},e.prototype.next=function(){var t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}},e.prototype.hasValue=function(){return this.buffer.length>0},e.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},e.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},e.prototype.notifyNext=function(t){this.buffer.push(t),this.parent.checkIterators()},e.prototype.subscribe=function(){return(0,c.ft)(this.observable,new c.IY(this))},e}(c.Ds)},430:(t,e,n)=>{"use strict";n.d(e,{u:()=>i});var r=n(7258);function i(){return(0,r.J)(1)}},2730:(t,e,n)=>{"use strict";n.d(e,{h:()=>o});var r=n(2995),i=n(1881);function o(t,e){return function(n){return n.lift(new s(t,e))}}var s=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new a(t,this.predicate,this.thisArg))},t}(),a=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return r.ZT(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(i.L)},453:(t,e,n)=>{"use strict";n.d(e,{v:()=>c,T:()=>f});var r=n(2995),i=n(1881),o=n(1586),s=n(9939),a=n(1194);function c(t,e,n,r){return function(i){return i.lift(new u(t,e,n,r))}}var u=function(){function t(t,e,n,r){this.keySelector=t,this.elementSelector=e,this.durationSelector=n,this.subjectSelector=r}return t.prototype.call=function(t,e){return e.subscribe(new l(t,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},t}(),l=function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;return s.keySelector=n,s.elementSelector=r,s.durationSelector=i,s.subjectSelector=o,s.groups=null,s.attemptedToUnsubscribe=!1,s.count=0,s}return r.ZT(e,t),e.prototype._next=function(t){var e;try{e=this.keySelector(t)}catch(t){return void this.error(t)}this._group(t,e)},e.prototype._group=function(t,e){var n=this.groups;n||(n=this.groups=new Map);var r,i=n.get(e);if(this.elementSelector)try{r=this.elementSelector(t)}catch(t){this.error(t)}else r=t;if(!i){i=this.subjectSelector?this.subjectSelector():new a.xQ,n.set(e,i);var o=new f(e,i,this);if(this.destination.next(o),this.durationSelector){var s=void 0;try{s=this.durationSelector(new f(e,i))}catch(t){return void this.error(t)}this.add(s.subscribe(new h(e,i,this)))}}i.closed||i.next(r)},e.prototype._error=function(t){var e=this.groups;e&&(e.forEach((function(e,n){e.error(t)})),e.clear()),this.destination.error(t)},e.prototype._complete=function(){var t=this.groups;t&&(t.forEach((function(t,e){t.complete()})),t.clear()),this.destination.complete()},e.prototype.removeGroup=function(t){this.groups.delete(t)},e.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&t.prototype.unsubscribe.call(this))},e}(i.L),h=function(t){function e(e,n,r){var i=t.call(this,n)||this;return i.key=e,i.group=n,i.parent=r,i}return r.ZT(e,t),e.prototype._next=function(t){this.complete()},e.prototype._unsubscribe=function(){var t=this.parent,e=this.key;this.key=this.parent=null,t&&t.removeGroup(e)},e}(i.L),f=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.groupSubject=n,i.refCountSubscription=r,i}return r.ZT(e,t),e.prototype._subscribe=function(t){var e=new o.w,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&e.add(new d(n)),e.add(r.subscribe(t)),e},e}(s.y),d=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,e.count++,n}return r.ZT(e,t),e.prototype.unsubscribe=function(){var e=this.parent;e.closed||this.closed||(t.prototype.unsubscribe.call(this),e.count-=1,0===e.count&&e.attemptedToUnsubscribe&&e.unsubscribe())},e}(o.w)},2188:(t,e,n)=>{"use strict";n.d(e,{U:()=>o});var r=n(2995),i=n(1881);function o(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new s(t,e))}}var s=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new a(t,this.project,this.thisArg))},t}(),a=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return r.ZT(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(i.L)},7258:(t,e,n)=>{"use strict";n.d(e,{J:()=>o});var r=n(1710),i=n(6930);function o(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),(0,r.zg)(i.y,t)}},1710:(t,e,n)=>{"use strict";n.d(e,{zg:()=>a,VS:()=>l});var r=n(2995),i=n(2188),o=n(7238),s=n(3694);function a(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(r){return r.pipe(a((function(n,r){return(0,o.D)(t(n,r)).pipe((0,i.U)((function(t,i){return e(n,t,r,i)})))}),n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new c(t,n))})}var c=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.project,this.concurrent))},t}(),u=function(t){function e(e,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=t.call(this,e)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return r.ZT(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new s.IY(this),n=this.destination;n.add(e);var r=(0,s.ft)(t,e);r!==e&&n.add(r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(s.Ds),l=a},9433:(t,e,n)=>{"use strict";n.d(e,{QV:()=>s,ht:()=>c});var r=n(2995),i=n(1881),o=n(8781);function s(t,e){return void 0===e&&(e=0),function(n){return n.lift(new a(t,e))}}var a=function(){function t(t,e){void 0===e&&(e=0),this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.scheduler,this.delay))},t}(),c=function(t){function e(e,n,r){void 0===r&&(r=0);var i=t.call(this,e)||this;return i.scheduler=n,i.delay=r,i}return r.ZT(e,t),e.dispatch=function(t){var e=t.notification,n=t.destination;e.observe(n),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.destination.add(this.scheduler.schedule(e.dispatch,this.delay,new u(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(o.P.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(o.P.createError(t)),this.unsubscribe()},e.prototype._complete=function(){this.scheduleMessage(o.P.createComplete()),this.unsubscribe()},e}(i.L),u=function(){return function(t,e){this.notification=t,this.destination=e}}()},6840:(t,e,n)=>{"use strict";n.d(e,{x:()=>o});var r=n(2995),i=n(1881);function o(){return function(t){return t.lift(new s(t))}}var s=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var r=new a(t,n),i=e.subscribe(r);return r.closed||(r.connection=n.connect()),i},t}(),a=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return r.ZT(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},e}(i.L)},6405:(t,e,n)=>{"use strict";n.d(e,{r:()=>o});var r=n(9939),i=n(1586);function o(t,e){return new r.y((function(n){var r=new i.w,o=0;return r.add(e.schedule((function(){o!==t.length?(n.next(t[o++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}},2540:(t,e,n)=>{"use strict";n.d(e,{x:()=>l});var r=n(9939),i=n(1586),o=n(8859),s=n(6405),a=n(2),c=n(9633),u=n(2318);function l(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[o.L]}(t))return function(t,e){return new r.y((function(n){var r=new i.w;return r.add(e.schedule((function(){var i=t[o.L]();r.add(i.subscribe({next:function(t){r.add(e.schedule((function(){return n.next(t)})))},error:function(t){r.add(e.schedule((function(){return n.error(t)})))},complete:function(){r.add(e.schedule((function(){return n.complete()})))}}))}))),r}))}(t,e);if((0,c.t)(t))return function(t,e){return new r.y((function(n){var r=new i.w;return r.add(e.schedule((function(){return t.then((function(t){r.add(e.schedule((function(){n.next(t),r.add(e.schedule((function(){return n.complete()})))})))}),(function(t){r.add(e.schedule((function(){return n.error(t)})))}))}))),r}))}(t,e);if((0,u.z)(t))return(0,s.r)(t,e);if(function(t){return t&&"function"==typeof t[a.hZ]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new r.y((function(n){var r,o=new i.w;return o.add((function(){r&&"function"==typeof r.return&&r.return()})),o.add(e.schedule((function(){r=t[a.hZ](),o.add(e.schedule((function(){if(!n.closed){var t,e;try{var i=r.next();t=i.value,e=i.done}catch(t){return void n.error(t)}e?n.complete():(n.next(t),this.schedule())}})))}))),o}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}},9795:(t,e,n)=>{"use strict";n.d(e,{o:()=>i});var r=n(2995),i=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return r.ZT(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,r=void 0;try{this.work(t)}catch(t){n=!0,r=!!t&&t||new Error(t)}if(n)return this.unsubscribe(),r},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return r.ZT(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(n(1586).w))},2966:(t,e,n)=>{"use strict";n.d(e,{v:()=>o});var r=n(2995),i=n(7035),o=function(t){function e(n,r){void 0===r&&(r=i.b.now);var o=t.call(this,n,(function(){return e.delegate&&e.delegate!==o?e.delegate.now():r()}))||this;return o.actions=[],o.active=!1,o.scheduled=void 0,o}return r.ZT(e,t),e.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,r,i):t.prototype.schedule.call(this,n,r,i)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(i.b)},4858:(t,e,n)=>{"use strict";n.d(e,{e:()=>l,E:()=>u});var r=n(2995),i=1,o=function(){return Promise.resolve()}(),s={};function a(t){return t in s&&(delete s[t],!0)}var c=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return r.ZT(e,t),e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0?t.prototype.requestAsyncId.call(this,e,n,r):(e.actions.push(this),e.scheduled||(e.scheduled=(c=e.flush.bind(e,null),u=i++,s[u]=!0,o.then((function(){return a(u)&&c()})),u)));var c,u},e.prototype.recycleAsyncId=function(e,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,r);0===e.actions.length&&(a(n),e.scheduled=void 0)},e}(n(9795).o),u=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.ZT(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,r=-1,i=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++r<i&&(t=n.shift()));if(this.active=!1,e){for(;++r<i&&(t=n.shift());)t.unsubscribe();throw e}},e}(n(2966).v))(c),l=u},646:(t,e,n)=>{"use strict";n.d(e,{z:()=>i,P:()=>o});var r=n(9795),i=new(n(2966).v)(r.o),o=i},7410:(t,e,n)=>{"use strict";n.d(e,{c:()=>s,N:()=>o});var r=n(2995),i=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return r.ZT(e,t),e.prototype.schedule=function(e,n){return void 0===n&&(n=0),n>0?t.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,n){return n>0||this.closed?t.prototype.execute.call(this,e,n):this._execute(e,n)},e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?t.prototype.requestAsyncId.call(this,e,n,r):e.flush(this)},e}(n(9795).o),o=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.ZT(e,t),e}(n(2966).v))(i),s=o},2:(t,e,n)=>{"use strict";function r(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}n.d(e,{hZ:()=>i});var i=r()},8859:(t,e,n)=>{"use strict";n.d(e,{L:()=>r});var r=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}()},2532:(t,e,n)=>{"use strict";n.d(e,{b:()=>r});var r=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}()},9120:(t,e,n)=>{"use strict";n.d(e,{W:()=>r});var r=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}()},4397:(t,e,n)=>{"use strict";n.d(e,{K:()=>r});var r=function(){function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t}()},906:(t,e,n)=>{"use strict";n.d(e,{N:()=>r});var r=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}()},5915:(t,e,n)=>{"use strict";n.d(e,{W:()=>r});var r=function(){function t(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return t.prototype=Object.create(Error.prototype),t}()},2674:(t,e,n)=>{"use strict";n.d(e,{B:()=>r});var r=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}()},4658:(t,e,n)=>{"use strict";n.d(e,{_:()=>i});var r=n(1881);function i(t){for(;t;){var e=t,n=e.closed,i=e.destination,o=e.isStopped;if(n||o)return!1;t=i&&i instanceof r.L?i:null}return!0}},7804:(t,e,n)=>{"use strict";function r(t){setTimeout((function(){throw t}),0)}n.d(e,{z:()=>r})},6930:(t,e,n)=>{"use strict";function r(t){return t}n.d(e,{y:()=>r})},3073:(t,e,n)=>{"use strict";n.d(e,{k:()=>r});var r=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}()},2318:(t,e,n)=>{"use strict";n.d(e,{z:()=>r});var r=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t}},7371:(t,e,n)=>{"use strict";function r(t){return"function"==typeof t}n.d(e,{m:()=>r})},6712:(t,e,n)=>{"use strict";n.d(e,{k:()=>i});var r=n(3073);function i(t){return!(0,r.k)(t)&&t-parseFloat(t)+1>=0}},757:(t,e,n)=>{"use strict";function r(t){return null!==t&&"object"==typeof t}n.d(e,{K:()=>r})},9633:(t,e,n)=>{"use strict";function r(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}n.d(e,{t:()=>r})},4070:(t,e,n)=>{"use strict";function r(t){return t&&"function"==typeof t.schedule}n.d(e,{K:()=>r})},4582:(t,e,n)=>{"use strict";function r(){}n.d(e,{Z:()=>r})},5683:(t,e,n)=>{"use strict";function r(t,e){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=t,n.thisArg=e,n}n.d(e,{f:()=>r})},1199:(t,e,n)=>{"use strict";n.d(e,{z:()=>i,U:()=>o});var r=n(6930);function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return o(t)}function o(t){return 0===t.length?r.y:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}},1400:(t,e,n)=>{"use strict";n.d(e,{s:()=>l});var r=n(7651),i=n(7804),o=n(2),s=n(8859),a=n(2318),c=n(9633),u=n(757),l=function(t){if(t&&"function"==typeof t[s.L])return l=t,function(t){var e=l[s.L]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if((0,a.z)(t))return(0,r.V)(t);if((0,c.t)(t))return n=t,function(t){return n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,i.z),t};if(t&&"function"==typeof t[o.hZ])return e=t,function(t){for(var n=e[o.hZ]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t};var e,n,l,h=(0,u.K)(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+h+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},7651:(t,e,n)=>{"use strict";n.d(e,{V:()=>r});var r=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.complete()}}},505:(t,e,n)=>{"use strict";n.d(e,{D:()=>a});var r=n(2995),i=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parent=e,i.outerValue=n,i.outerIndex=r,i.index=0,i}return r.ZT(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(n(1881).L),o=n(1400),s=n(9939);function a(t,e,n,r,a){if(void 0===a&&(a=new i(t,n,r)),!a.closed)return e instanceof s.y?e.subscribe(a):(0,o.s)(e)(a)}},6276:(t,e,n)=>{"use strict";n.r(e),n.d(e,{audit:()=>o,auditTime:()=>l,buffer:()=>h,bufferCount:()=>v,bufferTime:()=>w,bufferToggle:()=>O,bufferWhen:()=>N,catchError:()=>R,combineAll:()=>M,combineLatest:()=>U,concat:()=>Z,concatAll:()=>W.u,concatMap:()=>H,concatMapTo:()=>K,count:()=>J,debounce:()=>X,debounceTime:()=>nt,defaultIfEmpty:()=>st,delay:()=>ht,delayWhen:()=>gt,dematerialize:()=>xt,distinct:()=>kt,distinctUntilChanged:()=>Ct,distinctUntilKeyChanged:()=>Ot,elementAt:()=>Gt,endWith:()=>qt,every:()=>Zt,exhaust:()=>Ht,exhaustMap:()=>$t,expand:()=>ee,filter:()=>Pt.h,finalize:()=>ie,find:()=>ae,findIndex:()=>le,first:()=>fe,flatMap:()=>Y.VS,groupBy:()=>de.v,ignoreElements:()=>pe,isEmpty:()=>ye,last:()=>_e,map:()=>Qt.U,mapTo:()=>ke,materialize:()=>Ce,max:()=>je,merge:()=>Be,mergeAll:()=>ze.J,mergeMap:()=>Y.zg,mergeMapTo:()=>Le,mergeScan:()=>Me,min:()=>Ue,multicast:()=>Ze,observeOn:()=>Ye.QV,onErrorResumeNext:()=>He,pairwise:()=>Qe,partition:()=>en,pluck:()=>nn,publish:()=>sn,publishBehavior:()=>cn,publishLast:()=>ln,publishReplay:()=>fn,race:()=>pn,reduce:()=>De,refCount:()=>Cn.x,repeat:()=>vn,repeatWhen:()=>bn,retry:()=>xn,retryWhen:()=>kn,sample:()=>An,sampleTime:()=>Fn,scan:()=>Oe,sequenceEqual:()=>jn,share:()=>Mn,shareReplay:()=>Vn,single:()=>Gn,skip:()=>Zn,skipLast:()=>Hn,skipUntil:()=>Qn,skipWhile:()=>tr,startWith:()=>rr,subscribeOn:()=>ar,switchAll:()=>fr,switchMap:()=>ur,switchMapTo:()=>dr,take:()=>Lt,takeLast:()=>we,takeUntil:()=>pr,takeWhile:()=>yr,tap:()=>Sr,throttle:()=>Er,throttleTime:()=>Ir,throwIfEmpty:()=>Dt,timeInterval:()=>Dr,timeout:()=>Vr,timeoutWith:()=>Br,timestamp:()=>Gr,toArray:()=>Zr,window:()=>Wr,windowCount:()=>Kr,windowTime:()=>$r,windowToggle:()=>oi,windowWhen:()=>ci,withLatestFrom:()=>hi,zip:()=>vi,zipAll:()=>gi});var r=n(2995),i=n(3694);function o(t){return function(e){return e.lift(new s(t))}}var s=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new a(t,this.durationSelector))},t}(),a=function(t){function e(e,n){var r=t.call(this,e)||this;return r.durationSelector=n,r.hasValue=!1,r}return r.ZT(e,t),e.prototype._next=function(t){if(this.value=t,this.hasValue=!0,!this.throttled){var e=void 0;try{e=(0,this.durationSelector)(t)}catch(t){return this.destination.error(t)}var n=(0,i.ft)(e,new i.IY(this));!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}},e.prototype.clearThrottle=function(){var t=this,e=t.value,n=t.hasValue,r=t.throttled;r&&(this.remove(r),this.throttled=void 0,r.unsubscribe()),n&&(this.value=void 0,this.hasValue=!1,this.destination.next(e))},e.prototype.notifyNext=function(){this.clearThrottle()},e.prototype.notifyComplete=function(){this.clearThrottle()},e}(i.Ds),c=n(646),u=n(3254);function l(t,e){return void 0===e&&(e=c.P),o((function(){return(0,u.H)(t,e)}))}function h(t){return function(e){return e.lift(new f(t))}}var f=function(){function t(t){this.closingNotifier=t}return t.prototype.call=function(t,e){return e.subscribe(new d(t,this.closingNotifier))},t}(),d=function(t){function e(e,n){var r=t.call(this,e)||this;return r.buffer=[],r.add((0,i.ft)(n,new i.IY(r))),r}return r.ZT(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype.notifyNext=function(){var t=this.buffer;this.buffer=[],this.destination.next(t)},e}(i.Ds),p=n(1881);function v(t,e){return void 0===e&&(e=null),function(n){return n.lift(new g(t,e))}}var g=function(){function t(t,e){this.bufferSize=t,this.startBufferEvery=e,this.subscriberClass=e&&t!==e?b:y}return t.prototype.call=function(t,e){return e.subscribe(new this.subscriberClass(t,this.bufferSize,this.startBufferEvery))},t}(),y=function(t){function e(e,n){var r=t.call(this,e)||this;return r.bufferSize=n,r.buffer=[],r}return r.ZT(e,t),e.prototype._next=function(t){var e=this.buffer;e.push(t),e.length==this.bufferSize&&(this.destination.next(e),this.buffer=[])},e.prototype._complete=function(){var e=this.buffer;e.length>0&&this.destination.next(e),t.prototype._complete.call(this)},e}(p.L),b=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.bufferSize=n,i.startBufferEvery=r,i.buffers=[],i.count=0,i}return r.ZT(e,t),e.prototype._next=function(t){var e=this,n=e.bufferSize,r=e.startBufferEvery,i=e.buffers,o=e.count;this.count++,o%r==0&&i.push([]);for(var s=i.length;s--;){var a=i[s];a.push(t),a.length===n&&(i.splice(s,1),this.destination.next(a))}},e.prototype._complete=function(){for(var e=this.buffers,n=this.destination;e.length>0;){var r=e.shift();r.length>0&&n.next(r)}t.prototype._complete.call(this)},e}(p.L),m=n(4070);function w(t){var e=arguments.length,n=c.P;(0,m.K)(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],e--);var r=null;e>=2&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return e>=3&&(i=arguments[2]),function(e){return e.lift(new x(t,r,i,n))}}var x=function(){function t(t,e,n,r){this.bufferTimeSpan=t,this.bufferCreationInterval=e,this.maxBufferSize=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new _(t,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},t}(),S=function(){return function(){this.buffer=[]}}(),_=function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;s.bufferTimeSpan=n,s.bufferCreationInterval=r,s.maxBufferSize=i,s.scheduler=o,s.contexts=[];var a=s.openContext();if(s.timespanOnly=null==r||r<0,s.timespanOnly){var c={subscriber:s,context:a,bufferTimeSpan:n};s.add(a.closeAction=o.schedule(k,n,c))}else{var u={subscriber:s,context:a},l={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:s,scheduler:o};s.add(a.closeAction=o.schedule(E,n,u)),s.add(o.schedule(T,r,l))}return s}return r.ZT(e,t),e.prototype._next=function(t){for(var e,n=this.contexts,r=n.length,i=0;i<r;i++){var o=n[i],s=o.buffer;s.push(t),s.length==this.maxBufferSize&&(e=o)}e&&this.onBufferFull(e)},e.prototype._error=function(e){this.contexts.length=0,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts,n=this.destination;e.length>0;){var r=e.shift();n.next(r.buffer)}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.contexts=null},e.prototype.onBufferFull=function(t){this.closeContext(t);var e=t.closeAction;if(e.unsubscribe(),this.remove(e),!this.closed&&this.timespanOnly){t=this.openContext();var n=this.bufferTimeSpan,r={subscriber:this,context:t,bufferTimeSpan:n};this.add(t.closeAction=this.scheduler.schedule(k,n,r))}},e.prototype.openContext=function(){var t=new S;return this.contexts.push(t),t},e.prototype.closeContext=function(t){this.destination.next(t.buffer);var e=this.contexts;(e?e.indexOf(t):-1)>=0&&e.splice(e.indexOf(t),1)},e}(p.L);function k(t){var e=t.subscriber,n=t.context;n&&e.closeContext(n),e.closed||(t.context=e.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function T(t){var e=t.bufferCreationInterval,n=t.bufferTimeSpan,r=t.subscriber,i=t.scheduler,o=r.openContext();r.closed||(r.add(o.closeAction=i.schedule(E,n,{subscriber:r,context:o})),this.schedule(t,e))}function E(t){var e=t.subscriber,n=t.context;e.closeContext(n)}var C=n(1586),A=n(505),I=n(6807);function O(t,e){return function(n){return n.lift(new F(t,e))}}var F=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new P(t,this.openings,this.closingSelector))},t}(),P=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.closingSelector=r,i.contexts=[],i.add((0,A.D)(i,n)),i}return r.ZT(e,t),e.prototype._next=function(t){for(var e=this.contexts,n=e.length,r=0;r<n;r++)e[r].buffer.push(t)},e.prototype._error=function(e){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts;e.length>0;){var n=e.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e){t?this.closeBuffer(t):this.openBuffer(e)},e.prototype.notifyComplete=function(t){this.closeBuffer(t.context)},e.prototype.openBuffer=function(t){try{var e=this.closingSelector.call(this,t);e&&this.trySubscribe(e)}catch(t){this._error(t)}},e.prototype.closeBuffer=function(t){var e=this.contexts;if(e&&t){var n=t.buffer,r=t.subscription;this.destination.next(n),e.splice(e.indexOf(t),1),this.remove(r),r.unsubscribe()}},e.prototype.trySubscribe=function(t){var e=this.contexts,n=new C.w,r={buffer:[],subscription:n};e.push(r);var i=(0,A.D)(this,t,r);!i||i.closed?this.closeBuffer(r):(i.context=r,this.add(i),n.add(i))},e}(I.L);function N(t){return function(e){return e.lift(new D(t))}}var D=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new j(t,this.closingSelector))},t}(),j=function(t){function e(e,n){var r=t.call(this,e)||this;return r.closingSelector=n,r.subscribing=!1,r.openBuffer(),r}return r.ZT(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype._complete=function(){var e=this.buffer;e&&this.destination.next(e),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.buffer=void 0,this.subscribing=!1},e.prototype.notifyNext=function(){this.openBuffer()},e.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},e.prototype.openBuffer=function(){var t=this.closingSubscription;t&&(this.remove(t),t.unsubscribe());var e,n=this.buffer;this.buffer&&this.destination.next(n),this.buffer=[];try{e=(0,this.closingSelector)()}catch(t){return this.error(t)}t=new C.w,this.closingSubscription=t,this.add(t),this.subscribing=!0,t.add((0,i.ft)(e,new i.IY(this))),this.subscribing=!1},e}(i.Ds);function R(t){return function(e){var n=new B(t),r=e.lift(n);return n.caught=r}}var B=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new z(t,this.selector,this.caught))},t}(),z=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.selector=n,i.caught=r,i}return r.ZT(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle();var r=new i.IY(this);this.add(r);var o=(0,i.ft)(n,r);o!==r&&this.add(o)}},e}(i.Ds),L=n(97);function M(t){return function(e){return e.lift(new L.Ms(t))}}var V=n(3073),G=n(7238);function U(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=null;return"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&(0,V.k)(t[0])&&(t=t[0].slice()),function(e){return e.lift.call((0,G.D)([e].concat(t)),new L.Ms(n))}}var q=n(4245);function Z(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return e.lift.call(q.z.apply(void 0,[e].concat(t)))}}var W=n(430),Y=n(1710);function H(t,e){return(0,Y.zg)(t,e,1)}function K(t,e){return H((function(){return t}),e)}function J(t){return function(e){return e.lift(new Q(t,e))}}var Q=function(){function t(t,e){this.predicate=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new $(t,this.predicate,this.source))},t}(),$=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.source=r,i.count=0,i.index=0,i}return r.ZT(e,t),e.prototype._next=function(t){this.predicate?this._tryPredicate(t):this.count++},e.prototype._tryPredicate=function(t){var e;try{e=this.predicate(t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e&&this.count++},e.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},e}(p.L);function X(t){return function(e){return e.lift(new tt(t))}}var tt=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new et(t,this.durationSelector))},t}(),et=function(t){function e(e,n){var r=t.call(this,e)||this;return r.durationSelector=n,r.hasValue=!1,r}return r.ZT(e,t),e.prototype._next=function(t){try{var e=this.durationSelector.call(this,t);e&&this._tryNext(t,e)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.emitValue(),this.destination.complete()},e.prototype._tryNext=function(t,e){var n=this.durationSubscription;this.value=t,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=(0,i.ft)(e,new i.IY(this)))&&!n.closed&&this.add(this.durationSubscription=n)},e.prototype.notifyNext=function(){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){if(this.hasValue){var e=this.value,n=this.durationSubscription;n&&(this.durationSubscription=void 0,n.unsubscribe(),this.remove(n)),this.value=void 0,this.hasValue=!1,t.prototype._next.call(this,e)}},e}(i.Ds);function nt(t,e){return void 0===e&&(e=c.P),function(n){return n.lift(new rt(t,e))}}var rt=function(){function t(t,e){this.dueTime=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new it(t,this.dueTime,this.scheduler))},t}(),it=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return r.ZT(e,t),e.prototype._next=function(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(ot,this.dueTime,this))},e.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},e.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var t=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}},e.prototype.clearDebounce=function(){var t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)},e}(p.L);function ot(t){t.debouncedNext()}function st(t){return void 0===t&&(t=null),function(e){return e.lift(new at(t))}}var at=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new ct(t,this.defaultValue))},t}(),ct=function(t){function e(e,n){var r=t.call(this,e)||this;return r.defaultValue=n,r.isEmpty=!0,r}return r.ZT(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(p.L);function ut(t){return t instanceof Date&&!isNaN(+t)}var lt=n(8781);function ht(t,e){void 0===e&&(e=c.P);var n=ut(t)?+t-e.now():Math.abs(t);return function(t){return t.lift(new ft(n,e))}}var ft=function(){function t(t,e){this.delay=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new dt(t,this.delay,this.scheduler))},t}(),dt=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return r.ZT(e,t),e.dispatch=function(t){for(var e=t.source,n=e.queue,r=t.scheduler,i=t.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(t,o)}else this.unsubscribe(),e.active=!1},e.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},e.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler,n=new pt(e.now()+this.delay,t);this.queue.push(n),!1===this.active&&this._schedule(e)}},e.prototype._next=function(t){this.scheduleNotification(lt.P.createNext(t))},e.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(lt.P.createComplete()),this.unsubscribe()},e}(p.L),pt=function(){return function(t,e){this.time=t,this.notification=e}}(),vt=n(9939);function gt(t,e){return e?function(n){return new mt(n,e).lift(new yt(t))}:function(e){return e.lift(new yt(t))}}var yt=function(){function t(t){this.delayDurationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new bt(t,this.delayDurationSelector))},t}(),bt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}return r.ZT(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(t),this.removeSubscription(i),this.tryComplete()},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype.notifyComplete=function(t){var e=this.removeSubscription(t);e&&this.destination.next(e),this.tryComplete()},e.prototype._next=function(t){var e=this.index++;try{var n=this.delayDurationSelector(t,e);n&&this.tryDelay(n,t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},e.prototype.removeSubscription=function(t){t.unsubscribe();var e=this.delayNotifierSubscriptions.indexOf(t);return-1!==e&&this.delayNotifierSubscriptions.splice(e,1),t.outerValue},e.prototype.tryDelay=function(t,e){var n=(0,A.D)(this,t,e);n&&!n.closed&&(this.destination.add(n),this.delayNotifierSubscriptions.push(n))},e.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},e}(I.L),mt=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subscriptionDelay=n,r}return r.ZT(e,t),e.prototype._subscribe=function(t){this.subscriptionDelay.subscribe(new wt(t,this.source))},e}(vt.y),wt=function(t){function e(e,n){var r=t.call(this)||this;return r.parent=e,r.source=n,r.sourceSubscribed=!1,r}return r.ZT(e,t),e.prototype._next=function(t){this.subscribeToSource()},e.prototype._error=function(t){this.unsubscribe(),this.parent.error(t)},e.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},e.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},e}(p.L);function xt(){return function(t){return t.lift(new St)}}var St=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new _t(t))},t}(),_t=function(t){function e(e){return t.call(this,e)||this}return r.ZT(e,t),e.prototype._next=function(t){t.observe(this.destination)},e}(p.L);function kt(t,e){return function(n){return n.lift(new Tt(t,e))}}var Tt=function(){function t(t,e){this.keySelector=t,this.flushes=e}return t.prototype.call=function(t,e){return e.subscribe(new Et(t,this.keySelector,this.flushes))},t}(),Et=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.keySelector=n,o.values=new Set,r&&o.add((0,i.ft)(r,new i.IY(o))),o}return r.ZT(e,t),e.prototype.notifyNext=function(){this.values.clear()},e.prototype.notifyError=function(t){this._error(t)},e.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},e.prototype._useKeySelector=function(t){var e,n=this.destination;try{e=this.keySelector(t)}catch(t){return void n.error(t)}this._finalizeNext(e,t)},e.prototype._finalizeNext=function(t,e){var n=this.values;n.has(t)||(n.add(t),this.destination.next(e))},e}(i.Ds);function Ct(t,e){return function(n){return n.lift(new At(t,e))}}var At=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new It(t,this.compare,this.keySelector))},t}(),It=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return r.ZT(e,t),e.prototype.compare=function(t,e){return t===e},e.prototype._next=function(t){var e;try{var n=this.keySelector;e=n?n(t):t}catch(t){return this.destination.error(t)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;r||(this.key=e,this.destination.next(t))},e}(p.L);function Ot(t,e){return Ct((function(n,r){return e?e(n[t],r[t]):n[t]===r[t]}))}var Ft=n(9120),Pt=n(2730),Nt=n(4397);function Dt(t){return void 0===t&&(t=Bt),function(e){return e.lift(new jt(t))}}var jt=function(){function t(t){this.errorFactory=t}return t.prototype.call=function(t,e){return e.subscribe(new Rt(t,this.errorFactory))},t}(),Rt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.errorFactory=n,r.hasValue=!1,r}return r.ZT(e,t),e.prototype._next=function(t){this.hasValue=!0,this.destination.next(t)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var t=void 0;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)},e}(p.L);function Bt(){return new Nt.K}var zt=n(4773);function Lt(t){return function(e){return 0===t?(0,zt.c)():e.lift(new Mt(t))}}var Mt=function(){function t(t){if(this.total=t,this.total<0)throw new Ft.W}return t.prototype.call=function(t,e){return e.subscribe(new Vt(t,this.total))},t}(),Vt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return r.ZT(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(p.L);function Gt(t,e){if(t<0)throw new Ft.W;var n=arguments.length>=2;return function(r){return r.pipe((0,Pt.h)((function(e,n){return n===t})),Lt(1),n?st(e):Dt((function(){return new Ft.W})))}}var Ut=n(6612);function qt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return(0,q.z)(e,Ut.of.apply(void 0,t))}}function Zt(t,e){return function(n){return n.lift(new Wt(t,e,n))}}var Wt=function(){function t(t,e,n){this.predicate=t,this.thisArg=e,this.source=n}return t.prototype.call=function(t,e){return e.subscribe(new Yt(t,this.predicate,this.thisArg,this.source))},t}(),Yt=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.predicate=n,o.thisArg=r,o.source=i,o.index=0,o.thisArg=r||o,o}return r.ZT(e,t),e.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},e.prototype._next=function(t){var e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e||this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(p.L);function Ht(){return function(t){return t.lift(new Kt)}}var Kt=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Jt(t))},t}(),Jt=function(t){function e(e){var n=t.call(this,e)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}return r.ZT(e,t),e.prototype._next=function(t){this.hasSubscription||(this.hasSubscription=!0,this.add((0,i.ft)(t,new i.IY(this))))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},e.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}(i.Ds),Qt=n(2188);function $t(t,e){return e?function(n){return n.pipe($t((function(n,r){return(0,G.D)(t(n,r)).pipe((0,Qt.U)((function(t,i){return e(n,t,r,i)})))})))}:function(e){return e.lift(new Xt(t))}}var Xt=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new te(t,this.project))},t}(),te=function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}return r.ZT(e,t),e.prototype._next=function(t){this.hasSubscription||this.tryNext(t)},e.prototype.tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.hasSubscription=!0,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new i.IY(this),n=this.destination;n.add(e);var r=(0,i.ft)(t,e);r!==e&&n.add(r)},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}(i.Ds);function ee(t,e,n){return void 0===e&&(e=Number.POSITIVE_INFINITY),e=(e||0)<1?Number.POSITIVE_INFINITY:e,function(r){return r.lift(new ne(t,e,n))}}var ne=function(){function t(t,e,n){this.project=t,this.concurrent=e,this.scheduler=n}return t.prototype.call=function(t,e){return e.subscribe(new re(t,this.project,this.concurrent,this.scheduler))},t}(),re=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.project=n,o.concurrent=r,o.scheduler=i,o.index=0,o.active=0,o.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(o.buffer=[]),o}return r.ZT(e,t),e.dispatch=function(t){var e=t.subscriber,n=t.result,r=t.value,i=t.index;e.subscribeToProjection(n,r,i)},e.prototype._next=function(t){var n=this.destination;if(n.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){n.next(t);try{var i=(0,this.project)(t,r);if(this.scheduler){var o={subscriber:this,result:i,value:t,index:r};this.destination.add(this.scheduler.schedule(e.dispatch,0,o))}else this.subscribeToProjection(i,t,r)}catch(t){n.error(t)}}else this.buffer.push(t)}},e.prototype.subscribeToProjection=function(t,e,n){this.active++,this.destination.add((0,i.ft)(t,new i.IY(this)))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this._next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},e}(i.Ds);function ie(t){return function(e){return e.lift(new oe(t))}}var oe=function(){function t(t){this.callback=t}return t.prototype.call=function(t,e){return e.subscribe(new se(t,this.callback))},t}(),se=function(t){function e(e,n){var r=t.call(this,e)||this;return r.add(new C.w(n)),r}return r.ZT(e,t),e}(p.L);function ae(t,e){if("function"!=typeof t)throw new TypeError("predicate is not a function");return function(n){return n.lift(new ce(t,n,!1,e))}}var ce=function(){function t(t,e,n,r){this.predicate=t,this.source=e,this.yieldIndex=n,this.thisArg=r}return t.prototype.call=function(t,e){return e.subscribe(new ue(t,this.predicate,this.source,this.yieldIndex,this.thisArg))},t}(),ue=function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;return s.predicate=n,s.source=r,s.yieldIndex=i,s.thisArg=o,s.index=0,s}return r.ZT(e,t),e.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete(),this.unsubscribe()},e.prototype._next=function(t){var e=this.predicate,n=this.thisArg,r=this.index++;try{e.call(n||this,t,r,this.source)&&this.notifyComplete(this.yieldIndex?r:t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},e}(p.L);function le(t,e){return function(n){return n.lift(new ce(t,n,!0,e))}}var he=n(6930);function fe(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?(0,Pt.h)((function(e,n){return t(e,n,r)})):he.y,Lt(1),n?st(e):Dt((function(){return new Nt.K})))}}var de=n(453);function pe(){return function(t){return t.lift(new ve)}}var ve=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new ge(t))},t}(),ge=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.ZT(e,t),e.prototype._next=function(t){},e}(p.L);function ye(){return function(t){return t.lift(new be)}}var be=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new me(t))},t}(),me=function(t){function e(e){return t.call(this,e)||this}return r.ZT(e,t),e.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype._next=function(t){this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(p.L);function we(t){return function(e){return 0===t?(0,zt.c)():e.lift(new xe(t))}}var xe=function(){function t(t){if(this.total=t,this.total<0)throw new Ft.W}return t.prototype.call=function(t,e){return e.subscribe(new Se(t,this.total))},t}(),Se=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.ring=new Array,r.count=0,r}return r.ZT(e,t),e.prototype._next=function(t){var e=this.ring,n=this.total,r=this.count++;e.length<n?e.push(t):e[r%n]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=e++%n;t.next(r[o])}t.complete()},e}(p.L);function _e(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?(0,Pt.h)((function(e,n){return t(e,n,r)})):he.y,we(1),n?st(e):Dt((function(){return new Nt.K})))}}function ke(t){return function(e){return e.lift(new Te(t))}}var Te=function(){function t(t){this.value=t}return t.prototype.call=function(t,e){return e.subscribe(new Ee(t,this.value))},t}(),Ee=function(t){function e(e,n){var r=t.call(this,e)||this;return r.value=n,r}return r.ZT(e,t),e.prototype._next=function(t){this.destination.next(this.value)},e}(p.L);function Ce(){return function(t){return t.lift(new Ae)}}var Ae=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Ie(t))},t}(),Ie=function(t){function e(e){return t.call(this,e)||this}return r.ZT(e,t),e.prototype._next=function(t){this.destination.next(lt.P.createNext(t))},e.prototype._error=function(t){var e=this.destination;e.next(lt.P.createError(t)),e.complete()},e.prototype._complete=function(){var t=this.destination;t.next(lt.P.createComplete()),t.complete()},e}(p.L);function Oe(t,e){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Fe(t,e,n))}}var Fe=function(){function t(t,e,n){void 0===n&&(n=!1),this.accumulator=t,this.seed=e,this.hasSeed=n}return t.prototype.call=function(t,e){return e.subscribe(new Pe(t,this.accumulator,this.seed,this.hasSeed))},t}(),Pe=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.accumulator=n,o._seed=r,o.hasSeed=i,o.index=0,o}return r.ZT(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.accumulator(this.seed,t,n)}catch(t){this.destination.error(t)}this.seed=e,this.destination.next(e)},e}(p.L),Ne=n(1199);function De(t,e){return arguments.length>=2?function(n){return(0,Ne.z)(Oe(t,e),we(1),st(e))(n)}:function(e){return(0,Ne.z)(Oe((function(e,n,r){return t(e,n,r+1)})),we(1))(e)}}function je(t){return De("function"==typeof t?function(e,n){return t(e,n)>0?e:n}:function(t,e){return t>e?t:e})}var Re=n(7686);function Be(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return e.lift.call(Re.T.apply(void 0,[e].concat(t)))}}var ze=n(7258);function Le(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?(0,Y.zg)((function(){return t}),e,n):("number"==typeof e&&(n=e),(0,Y.zg)((function(){return t}),n))}function Me(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return r.lift(new Ve(t,e,n))}}var Ve=function(){function t(t,e,n){this.accumulator=t,this.seed=e,this.concurrent=n}return t.prototype.call=function(t,e){return e.subscribe(new Ge(t,this.accumulator,this.seed,this.concurrent))},t}(),Ge=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.accumulator=n,o.acc=r,o.concurrent=i,o.hasValue=!1,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return r.ZT(e,t),e.prototype._next=function(t){if(this.active<this.concurrent){var e=this.index++,n=this.destination,r=void 0;try{r=(0,this.accumulator)(this.acc,t,e)}catch(t){return n.error(t)}this.active++,this._innerSub(r)}else this.buffer.push(t)},e.prototype._innerSub=function(t){var e=new i.IY(this),n=this.destination;n.add(e);var r=(0,i.ft)(t,e);r!==e&&n.add(r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},e.prototype.notifyNext=function(t){var e=this.destination;this.acc=t,this.hasValue=!0,e.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},e}(i.Ds);function Ue(t){return De("function"==typeof t?function(e,n){return t(e,n)<0?e:n}:function(t,e){return t<e?t:e})}var qe=n(9386);function Ze(t,e){return function(n){var r;if(r="function"==typeof t?t:function(){return t},"function"==typeof e)return n.lift(new We(r,e));var i=Object.create(n,qe.N);return i.source=n,i.subjectFactory=r,i}}var We=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(t);return i.add(e.subscribe(r)),i},t}(),Ye=n(9433);function He(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 1===t.length&&(0,V.k)(t[0])&&(t=t[0]),function(e){return e.lift(new Ke(t))}}var Ke=function(){function t(t){this.nextSources=t}return t.prototype.call=function(t,e){return e.subscribe(new Je(t,this.nextSources))},t}(),Je=function(t){function e(e,n){var r=t.call(this,e)||this;return r.destination=e,r.nextSources=n,r}return r.ZT(e,t),e.prototype.notifyError=function(){this.subscribeToNextSource()},e.prototype.notifyComplete=function(){this.subscribeToNextSource()},e.prototype._error=function(t){this.subscribeToNextSource(),this.unsubscribe()},e.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},e.prototype.subscribeToNextSource=function(){var t=this.nextSources.shift();if(t){var e=new i.IY(this),n=this.destination;n.add(e);var r=(0,i.ft)(t,e);r!==e&&n.add(r)}else this.destination.complete()},e}(i.Ds);function Qe(){return function(t){return t.lift(new $e)}}var $e=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Xe(t))},t}(),Xe=function(t){function e(e){var n=t.call(this,e)||this;return n.hasPrev=!1,n}return r.ZT(e,t),e.prototype._next=function(t){var e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)},e}(p.L),tn=n(5683);function en(t,e){return function(n){return[(0,Pt.h)(t,e)(n),(0,Pt.h)((0,tn.f)(t,e))(n)]}}function nn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(e){return(0,Qt.U)(rn(t,n))(e)}}function rn(t,e){return function(n){for(var r=n,i=0;i<e;i++){var o=null!=r?r[t[i]]:void 0;if(void 0===o)return;r=o}return r}}var on=n(1194);function sn(t){return t?Ze((function(){return new on.xQ}),t):Ze(new on.xQ)}var an=n(4580);function cn(t){return function(e){return Ze(new an.X(t))(e)}}var un=n(3866);function ln(){return function(t){return Ze(new un.c)(t)}}var hn=n(1048);function fn(t,e,n,r){n&&"function"!=typeof n&&(r=n);var i="function"==typeof n?n:void 0,o=new hn.t(t,e,r);return function(t){return Ze((function(){return o}),i)(t)}}var dn=n(2219);function pn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return 1===t.length&&(0,V.k)(t[0])&&(t=t[0]),e.lift.call(dn.S3.apply(void 0,[e].concat(t)))}}function vn(t){return void 0===t&&(t=-1),function(e){return 0===t?(0,zt.c)():t<0?e.lift(new gn(-1,e)):e.lift(new gn(t-1,e))}}var gn=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new yn(t,this.count,this.source))},t}(),yn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.count=n,i.source=r,i}return r.ZT(e,t),e.prototype.complete=function(){if(!this.isStopped){var e=this.source,n=this.count;if(0===n)return t.prototype.complete.call(this);n>-1&&(this.count=n-1),e.subscribe(this._unsubscribeAndRecycle())}},e}(p.L);function bn(t){return function(e){return e.lift(new mn(t))}}var mn=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){return e.subscribe(new wn(t,this.notifier,e))},t}(),wn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.notifier=n,i.source=r,i.sourceIsBeingSubscribedTo=!0,i}return r.ZT(e,t),e.prototype.notifyNext=function(){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},e.prototype.notifyComplete=function(){if(!1===this.sourceIsBeingSubscribedTo)return t.prototype.complete.call(this)},e.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return t.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next(void 0)}},e.prototype._unsubscribe=function(){var t=this.notifications,e=this.retriesSubscription;t&&(t.unsubscribe(),this.notifications=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e.prototype._unsubscribeAndRecycle=function(){var e=this._unsubscribe;return this._unsubscribe=null,t.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=e,this},e.prototype.subscribeToRetries=function(){var e;this.notifications=new on.xQ;try{e=(0,this.notifier)(this.notifications)}catch(e){return t.prototype.complete.call(this)}this.retries=e,this.retriesSubscription=(0,i.ft)(e,new i.IY(this))},e}(i.Ds);function xn(t){return void 0===t&&(t=-1),function(e){return e.lift(new Sn(t,e))}}var Sn=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new _n(t,this.count,this.source))},t}(),_n=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.count=n,i.source=r,i}return r.ZT(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return t.prototype.error.call(this,e);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},e}(p.L);function kn(t){return function(e){return e.lift(new Tn(t,e))}}var Tn=function(){function t(t,e){this.notifier=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new En(t,this.notifier,this.source))},t}(),En=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.notifier=n,i.source=r,i}return r.ZT(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.errors,r=this.retries,o=this.retriesSubscription;if(r)this.errors=void 0,this.retriesSubscription=void 0;else{n=new on.xQ;try{r=(0,this.notifier)(n)}catch(e){return t.prototype.error.call(this,e)}o=(0,i.ft)(r,new i.IY(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=o,n.next(e)}},e.prototype._unsubscribe=function(){var t=this.errors,e=this.retriesSubscription;t&&(t.unsubscribe(),this.errors=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e.prototype.notifyNext=function(){var t=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=t,this.source.subscribe(this)},e}(i.Ds),Cn=n(6840);function An(t){return function(e){return e.lift(new In(t))}}var In=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new On(t),r=e.subscribe(n);return r.add((0,i.ft)(this.notifier,new i.IY(n))),r},t}(),On=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasValue=!1,e}return r.ZT(e,t),e.prototype._next=function(t){this.value=t,this.hasValue=!0},e.prototype.notifyNext=function(){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},e}(i.Ds);function Fn(t,e){return void 0===e&&(e=c.P),function(n){return n.lift(new Pn(t,e))}}var Pn=function(){function t(t,e){this.period=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new Nn(t,this.period,this.scheduler))},t}(),Nn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.period=n,i.scheduler=r,i.hasValue=!1,i.add(r.schedule(Dn,n,{subscriber:i,period:n})),i}return r.ZT(e,t),e.prototype._next=function(t){this.lastValue=t,this.hasValue=!0},e.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},e}(p.L);function Dn(t){var e=t.subscriber,n=t.period;e.notifyNext(),this.schedule(t,n)}function jn(t,e){return function(n){return n.lift(new Rn(t,e))}}var Rn=function(){function t(t,e){this.compareTo=t,this.comparator=e}return t.prototype.call=function(t,e){return e.subscribe(new Bn(t,this.compareTo,this.comparator))},t}(),Bn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.compareTo=n,i.comparator=r,i._a=[],i._b=[],i._oneComplete=!1,i.destination.add(n.subscribe(new zn(e,i))),i}return r.ZT(e,t),e.prototype._next=function(t){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(t),this.checkValues())},e.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},e.prototype.checkValues=function(){for(var t=this,e=t._a,n=t._b,r=t.comparator;e.length>0&&n.length>0;){var i=e.shift(),o=n.shift(),s=!1;try{s=r?r(i,o):i===o}catch(t){this.destination.error(t)}s||this.emit(!1)}},e.prototype.emit=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype.nextB=function(t){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(t),this.checkValues())},e.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},e}(p.L),zn=function(t){function e(e,n){var r=t.call(this,e)||this;return r.parent=n,r}return r.ZT(e,t),e.prototype._next=function(t){this.parent.nextB(t)},e.prototype._error=function(t){this.parent.error(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},e}(p.L);function Ln(){return new on.xQ}function Mn(){return function(t){return(0,Cn.x)()(Ze(Ln)(t))}}function Vn(t,e,n){var r;return r=t&&"object"==typeof t?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n},function(t){return t.lift(function(t){var e,n,r=t.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=t.windowTime,s=void 0===o?Number.POSITIVE_INFINITY:o,a=t.refCount,c=t.scheduler,u=0,l=!1,h=!1;return function(t){var r;u++,!e||l?(l=!1,e=new hn.t(i,s,c),r=e.subscribe(this),n=t.subscribe({next:function(t){e.next(t)},error:function(t){l=!0,e.error(t)},complete:function(){h=!0,n=void 0,e.complete()}}),h&&(n=void 0)):r=e.subscribe(this),this.add((function(){u--,r.unsubscribe(),r=void 0,n&&!h&&a&&0===u&&(n.unsubscribe(),n=void 0,e=void 0)}))}}(r))}}function Gn(t){return function(e){return e.lift(new Un(t,e))}}var Un=function(){function t(t,e){this.predicate=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new qn(t,this.predicate,this.source))},t}(),qn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.source=r,i.seenValue=!1,i.index=0,i}return r.ZT(e,t),e.prototype.applySingleValue=function(t){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=t)},e.prototype._next=function(t){var e=this.index++;this.predicate?this.tryNext(t,e):this.applySingleValue(t)},e.prototype.tryNext=function(t,e){try{this.predicate(t,e,this.source)&&this.applySingleValue(t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){var t=this.destination;this.index>0?(t.next(this.seenValue?this.singleValue:void 0),t.complete()):t.error(new Nt.K)},e}(p.L);function Zn(t){return function(e){return e.lift(new Wn(t))}}var Wn=function(){function t(t){this.total=t}return t.prototype.call=function(t,e){return e.subscribe(new Yn(t,this.total))},t}(),Yn=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return r.ZT(e,t),e.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)},e}(p.L);function Hn(t){return function(e){return e.lift(new Kn(t))}}var Kn=function(){function t(t){if(this._skipCount=t,this._skipCount<0)throw new Ft.W}return t.prototype.call=function(t,e){return 0===this._skipCount?e.subscribe(new p.L(t)):e.subscribe(new Jn(t,this._skipCount))},t}(),Jn=function(t){function e(e,n){var r=t.call(this,e)||this;return r._skipCount=n,r._count=0,r._ring=new Array(n),r}return r.ZT(e,t),e.prototype._next=function(t){var e=this._skipCount,n=this._count++;if(n<e)this._ring[n]=t;else{var r=n%e,i=this._ring,o=i[r];i[r]=t,this.destination.next(o)}},e}(p.L);function Qn(t){return function(e){return e.lift(new $n(t))}}var $n=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){return e.subscribe(new Xn(t,this.notifier))},t}(),Xn=function(t){function e(e,n){var r=t.call(this,e)||this;r.hasValue=!1;var o=new i.IY(r);r.add(o),r.innerSubscription=o;var s=(0,i.ft)(n,o);return s!==o&&(r.add(s),r.innerSubscription=s),r}return r.ZT(e,t),e.prototype._next=function(e){this.hasValue&&t.prototype._next.call(this,e)},e.prototype.notifyNext=function(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},e.prototype.notifyComplete=function(){},e}(i.Ds);function tr(t){return function(e){return e.lift(new er(t))}}var er=function(){function t(t){this.predicate=t}return t.prototype.call=function(t,e){return e.subscribe(new nr(t,this.predicate))},t}(),nr=function(t){function e(e,n){var r=t.call(this,e)||this;return r.predicate=n,r.skipping=!0,r.index=0,r}return r.ZT(e,t),e.prototype._next=function(t){var e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)},e.prototype.tryCallPredicate=function(t){try{var e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(t){this.destination.error(t)}},e}(p.L);function rr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return(0,m.K)(n)?(t.pop(),function(e){return(0,q.z)(t,e,n)}):function(e){return(0,q.z)(t,e)}}var ir=n(4858),or=n(6712),sr=function(t){function e(e,n,r){void 0===n&&(n=0),void 0===r&&(r=ir.e);var i=t.call(this)||this;return i.source=e,i.delayTime=n,i.scheduler=r,(!(0,or.k)(n)||n<0)&&(i.delayTime=0),r&&"function"==typeof r.schedule||(i.scheduler=ir.e),i}return r.ZT(e,t),e.create=function(t,n,r){return void 0===n&&(n=0),void 0===r&&(r=ir.e),new e(t,n,r)},e.dispatch=function(t){var e=t.source,n=t.subscriber;return this.add(e.subscribe(n))},e.prototype._subscribe=function(t){var n=this.delayTime,r=this.source;return this.scheduler.schedule(e.dispatch,n,{source:r,subscriber:t})},e}(vt.y);function ar(t,e){return void 0===e&&(e=0),function(n){return n.lift(new cr(t,e))}}var cr=function(){function t(t,e){this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return new sr(e,this.delay,this.scheduler).subscribe(t)},t}();function ur(t,e){return"function"==typeof e?function(n){return n.pipe(ur((function(n,r){return(0,G.D)(t(n,r)).pipe((0,Qt.U)((function(t,i){return e(n,t,r,i)})))})))}:function(e){return e.lift(new lr(t))}}var lr=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new hr(t,this.project))},t}(),hr=function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.index=0,r}return r.ZT(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this._innerSub(e)},e.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe();var n=new i.IY(this),r=this.destination;r.add(n),this.innerSubscription=(0,i.ft)(t,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t){this.destination.next(t)},e}(i.Ds);function fr(){return ur(he.y)}function dr(t,e){return e?ur((function(){return t}),e):ur((function(){return t}))}function pr(t){return function(e){return e.lift(new vr(t))}}var vr=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new gr(t),r=(0,i.ft)(this.notifier,new i.IY(n));return r&&!n.seenValue?(n.add(r),e.subscribe(n)):n},t}(),gr=function(t){function e(e){var n=t.call(this,e)||this;return n.seenValue=!1,n}return r.ZT(e,t),e.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},e.prototype.notifyComplete=function(){},e}(i.Ds);function yr(t,e){return void 0===e&&(e=!1),function(n){return n.lift(new br(t,e))}}var br=function(){function t(t,e){this.predicate=t,this.inclusive=e}return t.prototype.call=function(t,e){return e.subscribe(new mr(t,this.predicate,this.inclusive))},t}(),mr=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.inclusive=r,i.index=0,i}return r.ZT(e,t),e.prototype._next=function(t){var e,n=this.destination;try{e=this.predicate(t,this.index++)}catch(t){return void n.error(t)}this.nextOrComplete(t,e)},e.prototype.nextOrComplete=function(t,e){var n=this.destination;Boolean(e)?n.next(t):(this.inclusive&&n.next(t),n.complete())},e}(p.L),wr=n(4582),xr=n(7371);function Sr(t,e,n){return function(r){return r.lift(new _r(t,e,n))}}var _r=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new kr(t,this.nextOrObserver,this.error,this.complete))},t}(),kr=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o._tapNext=wr.Z,o._tapError=wr.Z,o._tapComplete=wr.Z,o._tapError=r||wr.Z,o._tapComplete=i||wr.Z,(0,xr.m)(n)?(o._context=o,o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||wr.Z,o._tapError=n.error||wr.Z,o._tapComplete=n.complete||wr.Z),o}return r.ZT(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(p.L),Tr={leading:!0,trailing:!1};function Er(t,e){return void 0===e&&(e=Tr),function(n){return n.lift(new Cr(t,!!e.leading,!!e.trailing))}}var Cr=function(){function t(t,e,n){this.durationSelector=t,this.leading=e,this.trailing=n}return t.prototype.call=function(t,e){return e.subscribe(new Ar(t,this.durationSelector,this.leading,this.trailing))},t}(),Ar=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.destination=e,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}return r.ZT(e,t),e.prototype._next=function(t){this._hasValue=!0,this._sendValue=t,this._throttled||(this._leading?this.send():this.throttle(t))},e.prototype.send=function(){var t=this._hasValue,e=this._sendValue;t&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=void 0},e.prototype.throttle=function(t){var e=this.tryDurationSelector(t);e&&this.add(this._throttled=(0,i.ft)(e,new i.IY(this)))},e.prototype.tryDurationSelector=function(t){try{return this.durationSelector(t)}catch(t){return this.destination.error(t),null}},e.prototype.throttlingDone=function(){var t=this._throttled,e=this._trailing;t&&t.unsubscribe(),this._throttled=void 0,e&&this.send()},e.prototype.notifyNext=function(){this.throttlingDone()},e.prototype.notifyComplete=function(){this.throttlingDone()},e}(i.Ds);function Ir(t,e,n){return void 0===e&&(e=c.P),void 0===n&&(n=Tr),function(r){return r.lift(new Or(t,e,n.leading,n.trailing))}}var Or=function(){function t(t,e,n,r){this.duration=t,this.scheduler=e,this.leading=n,this.trailing=r}return t.prototype.call=function(t,e){return e.subscribe(new Fr(t,this.duration,this.scheduler,this.leading,this.trailing))},t}(),Fr=function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;return s.duration=n,s.scheduler=r,s.leading=i,s.trailing=o,s._hasTrailingValue=!1,s._trailingValue=null,s}return r.ZT(e,t),e.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Pr,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))},e.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},e.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},e}(p.L);function Pr(t){t.subscriber.clearThrottle()}var Nr=n(6542);function Dr(t){return void 0===t&&(t=c.P),function(e){return(0,Nr.P)((function(){return e.pipe(Oe((function(e,n){var r=e.current;return{value:n,current:t.now(),last:r}}),{current:t.now(),value:void 0,last:void 0}),(0,Qt.U)((function(t){var e=t.current,n=t.last,r=t.value;return new jr(r,e-n)})))}))}}var jr=function(){return function(t,e){this.value=t,this.interval=e}}(),Rr=n(5915);function Br(t,e,n){return void 0===n&&(n=c.P),function(r){var i=ut(t),o=i?+t-n.now():Math.abs(t);return r.lift(new zr(o,i,e,n))}}var zr=function(){function t(t,e,n,r){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new Lr(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t}(),Lr=function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;return s.absoluteTimeout=n,s.waitFor=r,s.withObservable=i,s.scheduler=o,s.scheduleTimeout(),s}return r.ZT(e,t),e.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add((0,i.ft)(e,new i.IY(t)))},e.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),t.prototype._next.call(this,e)},e.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},e}(i.Ds),Mr=n(4236);function Vr(t,e){return void 0===e&&(e=c.P),Br(t,(0,Mr._)(new Rr.W),e)}function Gr(t){return void 0===t&&(t=c.P),(0,Qt.U)((function(e){return new Ur(e,t.now())}))}var Ur=function(){return function(t,e){this.value=t,this.timestamp=e}}();function qr(t,e,n){return 0===n?[e]:(t.push(e),t)}function Zr(){return De(qr,[])}function Wr(t){return function(e){return e.lift(new Yr(t))}}var Yr=function(){function t(t){this.windowBoundaries=t}return t.prototype.call=function(t,e){var n=new Hr(t),r=e.subscribe(n);return r.closed||n.add((0,i.ft)(this.windowBoundaries,new i.IY(n))),r},t}(),Hr=function(t){function e(e){var n=t.call(this,e)||this;return n.window=new on.xQ,e.next(n.window),n}return r.ZT(e,t),e.prototype.notifyNext=function(){this.openWindow()},e.prototype.notifyError=function(t){this._error(t)},e.prototype.notifyComplete=function(){this._complete()},e.prototype._next=function(t){this.window.next(t)},e.prototype._error=function(t){this.window.error(t),this.destination.error(t)},e.prototype._complete=function(){this.window.complete(),this.destination.complete()},e.prototype._unsubscribe=function(){this.window=null},e.prototype.openWindow=function(){var t=this.window;t&&t.complete();var e=this.destination,n=this.window=new on.xQ;e.next(n)},e}(i.Ds);function Kr(t,e){return void 0===e&&(e=0),function(n){return n.lift(new Jr(t,e))}}var Jr=function(){function t(t,e){this.windowSize=t,this.startWindowEvery=e}return t.prototype.call=function(t,e){return e.subscribe(new Qr(t,this.windowSize,this.startWindowEvery))},t}(),Qr=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.destination=e,i.windowSize=n,i.startWindowEvery=r,i.windows=[new on.xQ],i.count=0,e.next(i.windows[0]),i}return r.ZT(e,t),e.prototype._next=function(t){for(var e=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,o=i.length,s=0;s<o&&!this.closed;s++)i[s].next(t);var a=this.count-r+1;if(a>=0&&a%e==0&&!this.closed&&i.shift().complete(),++this.count%e==0&&!this.closed){var c=new on.xQ;i.push(c),n.next(c)}},e.prototype._error=function(t){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().error(t);this.destination.error(t)},e.prototype._complete=function(){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().complete();this.destination.complete()},e.prototype._unsubscribe=function(){this.count=0,this.windows=null},e}(p.L);function $r(t){var e=c.P,n=null,r=Number.POSITIVE_INFINITY;return(0,m.K)(arguments[3])&&(e=arguments[3]),(0,m.K)(arguments[2])?e=arguments[2]:(0,or.k)(arguments[2])&&(r=Number(arguments[2])),(0,m.K)(arguments[1])?e=arguments[1]:(0,or.k)(arguments[1])&&(n=Number(arguments[1])),function(i){return i.lift(new Xr(t,n,r,e))}}var Xr=function(){function t(t,e,n,r){this.windowTimeSpan=t,this.windowCreationInterval=e,this.maxWindowSize=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new ei(t,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},t}(),ti=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._numberOfNextedValues=0,e}return r.ZT(e,t),e.prototype.next=function(e){this._numberOfNextedValues++,t.prototype.next.call(this,e)},Object.defineProperty(e.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),e}(on.xQ),ei=function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;s.destination=e,s.windowTimeSpan=n,s.windowCreationInterval=r,s.maxWindowSize=i,s.scheduler=o,s.windows=[];var a=s.openWindow();if(null!==r&&r>=0){var c={subscriber:s,window:a,context:null},u={windowTimeSpan:n,windowCreationInterval:r,subscriber:s,scheduler:o};s.add(o.schedule(ii,n,c)),s.add(o.schedule(ri,r,u))}else{var l={subscriber:s,window:a,windowTimeSpan:n};s.add(o.schedule(ni,n,l))}return s}return r.ZT(e,t),e.prototype._next=function(t){for(var e=this.windows,n=e.length,r=0;r<n;r++){var i=e[r];i.closed||(i.next(t),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},e.prototype._error=function(t){for(var e=this.windows;e.length>0;)e.shift().error(t);this.destination.error(t)},e.prototype._complete=function(){for(var t=this.windows;t.length>0;){var e=t.shift();e.closed||e.complete()}this.destination.complete()},e.prototype.openWindow=function(){var t=new ti;return this.windows.push(t),this.destination.next(t),t},e.prototype.closeWindow=function(t){t.complete();var e=this.windows;e.splice(e.indexOf(t),1)},e}(p.L);function ni(t){var e=t.subscriber,n=t.windowTimeSpan,r=t.window;r&&e.closeWindow(r),t.window=e.openWindow(),this.schedule(t,n)}function ri(t){var e=t.windowTimeSpan,n=t.subscriber,r=t.scheduler,i=t.windowCreationInterval,o=n.openWindow(),s=this,a={action:s,subscription:null},c={subscriber:n,window:o,context:a};a.subscription=r.schedule(ii,e,c),s.add(a.subscription),s.schedule(t,i)}function ii(t){var e=t.subscriber,n=t.window,r=t.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),e.closeWindow(n)}function oi(t,e){return function(n){return n.lift(new si(t,e))}}var si=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new ai(t,this.openings,this.closingSelector))},t}(),ai=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=(0,A.D)(i,n,n)),i}return r.ZT(e,t),e.prototype._next=function(t){var e=this.contexts;if(e)for(var n=e.length,r=0;r<n;r++)e[r].window.next(t)},e.prototype._error=function(e){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var o=n[i];o.window.error(e),o.subscription.unsubscribe()}t.prototype._error.call(this,e)},e.prototype._complete=function(){var e=this.contexts;if(this.contexts=null,e)for(var n=e.length,r=-1;++r<n;){var i=e[r];i.window.complete(),i.subscription.unsubscribe()}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,n=-1;++n<e;){var r=t[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},e.prototype.notifyNext=function(t,e,n,r,i){if(t===this.openings){var o=void 0;try{o=(0,this.closingSelector)(e)}catch(t){return this.error(t)}var s=new on.xQ,a=new C.w,c={window:s,subscription:a};this.contexts.push(c);var u=(0,A.D)(this,o,c);u.closed?this.closeWindow(this.contexts.length-1):(u.context=c,a.add(u)),this.destination.next(s)}else this.closeWindow(this.contexts.indexOf(t))},e.prototype.notifyError=function(t){this.error(t)},e.prototype.notifyComplete=function(t){t!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(t.context))},e.prototype.closeWindow=function(t){if(-1!==t){var e=this.contexts,n=e[t],r=n.window,i=n.subscription;e.splice(t,1),r.complete(),i.unsubscribe()}},e}(I.L);function ci(t){return function(e){return e.lift(new ui(t))}}var ui=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new li(t,this.closingSelector))},t}(),li=function(t){function e(e,n){var r=t.call(this,e)||this;return r.destination=e,r.closingSelector=n,r.openWindow(),r}return r.ZT(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.openWindow(i)},e.prototype.notifyError=function(t){this._error(t)},e.prototype.notifyComplete=function(t){this.openWindow(t)},e.prototype._next=function(t){this.window.next(t)},e.prototype._error=function(t){this.window.error(t),this.destination.error(t),this.unsubscribeClosingNotification()},e.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},e.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},e.prototype.openWindow=function(t){void 0===t&&(t=null),t&&(this.remove(t),t.unsubscribe());var e=this.window;e&&e.complete();var n,r=this.window=new on.xQ;this.destination.next(r);try{n=(0,this.closingSelector)()}catch(t){return this.destination.error(t),void this.window.error(t)}this.add(this.closingNotification=(0,A.D)(this,n))},e}(I.L);function hi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var n;"function"==typeof t[t.length-1]&&(n=t.pop());var r=t;return e.lift(new fi(r,n))}}var fi=function(){function t(t,e){this.observables=t,this.project=e}return t.prototype.call=function(t,e){return e.subscribe(new di(t,this.observables,this.project))},t}(),di=function(t){function e(e,n,r){var i=t.call(this,e)||this;i.observables=n,i.project=r,i.toRespond=[];var o=n.length;i.values=new Array(o);for(var s=0;s<o;s++)i.toRespond.push(s);for(s=0;s<o;s++){var a=n[s];i.add((0,A.D)(i,a,void 0,s))}return i}return r.ZT(e,t),e.prototype.notifyNext=function(t,e,n){this.values[n]=e;var r=this.toRespond;if(r.length>0){var i=r.indexOf(n);-1!==i&&r.splice(i,1)}},e.prototype.notifyComplete=function(){},e.prototype._next=function(t){if(0===this.toRespond.length){var e=[t].concat(this.values);this.project?this._tryProject(e):this.destination.next(e)}},e.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(I.L),pi=n(1131);function vi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return e.lift.call(pi.$R.apply(void 0,[e].concat(t)))}}function gi(t){return function(e){return e.lift(new pi.mx(t))}}},2995:(t,e,n)=>{"use strict";n.d(e,{ZT:()=>i});var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}},6941:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(4874))},9541:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(8313))},3520:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(9904))},301:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(2778))},9388:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(213))},8304:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(4025))},3756:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(8181))}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}n.r(r),n.d(r,{DOMFragment:()=>V,brainsatplay:()=>Ie}),n(5047);var s=function(){function t(){var n=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e(this,t),this.addFunc=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=null;return null!==e&&(null===t?n.listeners.forEach((function(t,n){r=t.listener.addFunc(e)})):n.listeners.find((function(n,i){n.key===t&&(r=n.listener.addFunc(e))}))),r},this.removeFuncs=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t?n.listeners.forEach((function(t,n){t.listener.removeFuncs(e)})):n.listeners.find((function(n,r){n.name===t&&n.listener.removeFuncs(e)}))},this.debug=r,this.listeners=[]}return o(t,[{key:"addListener",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.debug;if(void 0!==e){var s=t;null===s&&(s=Math.floor(1e5*Math.random()));var c={key:s,listener:new a(e,n,r,i,o)};this.listeners.push(c)}else console.error("You must assign an object")}},{key:"hasKey",value:function(t){var e=!1;return this.listeners.forEach((function(n,r){n.key===t&&(e=!0)})),e}},{key:"getKeyIndices",value:function(t){var e=[];return this.listeners.find((function(n,r){n.key===t&&e.push(r)})),e}},{key:"onchange",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t?this.listeners.forEach((function(t,n){t.listener.onchange=e})):this.listeners.find((function(n,r){n.name===t&&(n.listener.onchange=e)}))}},{key:"stop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===t?this.listeners.forEach((function(t,e){t.listener.stop()})):this.listeners.find((function(e,n){e.name===t&&e.listener.stop()}))}},{key:"start",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===t?this.listeners.forEach((function(t,e){t.listener.start()})):this.listeners.find((function(e,n){e.name===t&&e.listener.start()}))}},{key:"remove",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===e)this.listeners.splice(0,this.listeners.length);else{var n=[];this.listeners.find((function(t,r){t.name===e&&n.push(r)})),n.reverse().forEach((function(e){t.listeners[e].stop(),t.listeners.splice(e,1)}))}}}]),t}(),a=function(){function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"__ANY__",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onchange,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"FRAMERATE",s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];e(this,t),c.call(this),this.debug=s,this.onchange=i,this.onchangeFuncs=[],this.object=n,this.propName=r,this.propOld=void 0,this.setListenerRef(r),this.running=!0,this.interval,o<=0?(this.interval=10,console.log("Min recommended interval set: 10ms")):this.interval=o,this.checker=requestAnimationFrame(this.check)}return o(t,[{key:"removeFuncs",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===t?this.onchangeFuncs=[]:void 0!==this.onchangeFuncs[t]&&this.onchangeFuncs.splice(t,1)}},{key:"start",value:function(){this.running=!0,this.checker=requestAnimationFrame(this.check)}},{key:"stop",value:function(){this.running=!1,cancelAnimationFrame(this.checker)}}]),t}(),c=function(){var e=this;this.onchange=function(t){console.log(e.propName," changed from: ",e.propOld," to: ",e.object[e.propName])},this.addFunc=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null!==t&&e.onchangeFuncs.push(t),e.onchangeFuncs.length-1},this.onchangeMulti=function(t){e.onchangeFuncs.forEach((function(n,r){!0===e.debug&&console.log(n),n(t)}))},this.setListenerRef=function(n){"__ANY__"===n||null==n?e.propOld=JSON.stringifyFast(e.object):Array.isArray(e.object[n])?e.propOld=JSON.stringifyFast(e.object[n].slice(e.object[n].length-20)):"object"===t(e.object[n])?e.propOld=JSON.stringifyFast(e.object[n]):"function"==typeof e.object[n]?e.propOld=e.object[n].toString():e.propOld=e.object[n],!0===e.debug&&console.log("propname",n,", new assignment: ",e.propOld)},this.check=function(){if("__ANY__"===e.propName||null===e.propName||void 0===e.propName)e.propOld!==JSON.stringifyFast(e.object)&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object),e.setListenerRef(e.propName));else if(Array.isArray(e.object[e.propName]))e.propOld!==JSON.stringifyFast(e.object[e.propName].slice(e.object[e.propName].length-20))&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object[e.propName]),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object[e.propName]),e.setListenerRef(e.propName));else if("object"===t(e.object[e.propName])){var n=JSON.stringifyFast(e.object[e.propName]);e.propOld!==n&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object[e.propName]),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object[e.propName]),e.setListenerRef(e.propName))}else"function"==typeof e.object[e.propName]?e.propOld!==e.object[e.propName].toString()&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object[e.propName].toString()),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object[e.propName].toString()),e.setListenerRef(e.propName)):e.object[e.propName]!==e.propOld&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object[e.propName]),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object[e.propName]),e.setListenerRef(e.propName));!0===e.running&&(!0===e.debug&&console.log("checking",e.object,e.propName),"FRAMERATE"===e.interval?e.checker=requestAnimationFrame(e.check):setTimeout((function(){e.check}),e.interval))}};function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}void 0===JSON.stringifyFast&&(JSON.stringifyFast=function(){var e=new Map,n=[],r=["this"];function i(n,i){var o=i;if(null!==o&&"object"===t(i)){var s=e.get(o),a=i.constructor.name;if(s)return"[Circular Reference]"+s;if("Array"===a&&i.length>20)o=i.slice(i.length-20),e.set(o,r.join("."));else if("Object"!==a&&"Number"!==a&&"String"!==a&&"Boolean"!==a)o="instanceof_"+a,e.set(o,r.join("."));else if("object"===t(o)){var c={};for(var u in o)Array.isArray(o[u])?c[u]=o[u].slice(o[u].length-20):c[u]=o[u]}else e.set(o,r.join("."))}return o}return function(t,o){try{return n.push(t),JSON.stringify(t,i,o)}finally{e.clear(),n.length=0,r.length=1}}}());var p=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FRAMERATE";f(this,t),this.data=n,this.data.stateUpdateInterval=r,this.pushToState={},this.prev=Object.assign({},this.data),this.listener=new s;var i=function(){e.listener.listeners.forEach((function(t,n){t.interval=e.data.stateUpdateInterval}))};this.listener.addListener("interval",this.data,"stateUpdateInterval",i,r);var o=function(){if(Object.keys(e.pushToState).length>0){Object.assign(e.prev,e.data),Object.assign(e.data,e.pushToState);var t,n=l(Object.getOwnPropertyNames(e.pushToState));try{for(n.s();!(t=n.n()).done;){var r=t.value;delete e.pushToState[r]}}catch(t){n.e(t)}finally{n.f()}}};this.listener.addListener("push",this.pushToState,"__ANY__",o,r)}var e,n;return e=t,(n=[{key:"addToState",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.data[t]=e,null!==n)return this.addSecondaryKeyResponse(t,n,r)}},{key:"getState",value:function(){return JSON.parse(JSON.stringifyFast(this.data))}},{key:"setState",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(this.pushToState,t),this.pushToState}},{key:"setPrimaryKeyResponse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null!==e&&(this.listener.hasKey(t)?this.listener.onchange(t,e):null!==t&&this.listener.addListener(t,this.data,t,e,this.data.stateUpdateInterval,n))}},{key:"addSecondaryKeyResponse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null!==e)return this.listener.hasKey(t)?this.listener.addFunc(t,e):null!==t?(this.listener.addListener(t,this.data,t,(function(){}),this.data.stateUpdateInterval,n),this.listener.addFunc(t,e)):this.listener.addFunc("state",e)}},{key:"removeSecondaryKeyResponse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!==t?this.listener.hasKey(t)&&this.listener.removeFuncs(t,e):console.error("provide key")}},{key:"clearAllKeyResponses",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.listener.hasKey(t)&&this.listener.remove(t)}},{key:"subscribe",value:function(t,e){if(void 0!==this.data[t])return this.addSecondaryKeyResponse(t,e);this.addToState(k,null,e)}},{key:"unsubscribe",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!==e?this.removeSecondaryKeyResponse(t,e):console.error("Specify a subcription function index")}},{key:"unsubscribeAll",value:function(t){this.clearAllKeyResponses(t)}}])&&d(e.prototype,n),t}();function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function y(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}void 0===JSON.stringifyFast&&(JSON.stringifyFast=function(){var t=new Map,e=[],n=["this"];function r(e,r){var i=r;if(null!==i&&"object"===u(r)){var o=t.get(i),s=r.constructor.name;if(o)return"[Circular Reference]"+o;if("Array"===s&&r.length>20)i=r.slice(r.length-20),t.set(i,n.join("."));else if("Object"!==s&&"Number"!==s&&"String"!==s&&"Boolean"!==s)i="instanceof_"+s,t.set(i,n.join("."));else if("object"===u(i)){var a={};for(var c in i)Array.isArray(i[c])?a[c]=i[c].slice(i[c].length-20):a[c]=i[c]}else t.set(i,n.join("."))}return i}return function(i,o){try{return e.push(i),JSON.stringify(i,r,o)}finally{t.clear(),e.length=0,n.length=1}}}());var x=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"atlas",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{eegshared:{eegChannelTags:[{ch:0,tag:"FP1",analyze:!0},{ch:1,tag:"FP2",analyze:!0}],sps:512}},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"10_20",o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:["eegfft"];m(this,t),this.getDeviceDataByTag=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eeg",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FP1",r=void 0;return"number"==typeof n&&"eeg"===t&&e.data[t+"shared"][t+"ChannelTags"].find((function(t,e){if(t.ch===n&&null!==t.tag)return n=t.tag,!0})),t.indexOf("shared")<0?(e.data[t].find((function(t,e){if(t.tag===n)return r=t,!0})),r):null===n||"all"===n?e.data[t]:"string"==typeof n||"number"==typeof n?(e.data[t].find((function(t,e){if(t.tag===n)return r=t,!0})),r):r},this.getEEGDataByChannel=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=void 0;return e.data.eegshared.eegChannelTags.find((function(r,i){if(r.ch===t&&!1!==(n=null===r.tag||"other"===r.tag?e.getEEGDataByTag(r.ch):e.getEEGDataByTag(r.tag)))return!0})),n},this.getEEGDataByTag=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FP1",n=void 0;return e.data.eeg.find((function(e,r){if(e.tag===t)return n=e,!0})),n},this.getCoherenceByTag=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FP1_FZ",n=void 0;return e.data.coherence.find((function(e,r){if(e.tag===t)return n=e,!0})),n},this.getLatestFFTData=function(){var t=[];return e.data.eegshared.eegChannelTags.forEach((function(n,r){if(!0===n.analyze){var i=e.getEEGDataByTag(n.tag);if(0===i.fftCount)t.push({tag:i.tag,fftCount:i.fftCount});else{var o=i.fftCount-1;t.push({tag:i.tag,fftCount:i.fftCount,time:i.fftTimes[o],fft:i.ffts[o],slice:{delta:i.slices.delta[o],theta:i.slices.theta[o],alpha1:i.slices.alpha1[o],alpha2:i.slices.alpha2[o],beta:i.slices.beta[o],lowgamma:i.slices.lowgamma[o],highgamma:i.slices.highgamma[o]},mean:{delta:i.means.delta[o],theta:i.means.theta[o],alpha1:i.means.alpha1[o],alpha2:i.means.alpha2[o],beta:i.means.beta[o],lowgamma:i.slices.lowgamma[o],highgamma:i.means.highgamma[o]}})}}})),t},this.getLatestCoherenceData=function(){var t=[];return e.data.coherence.forEach((function(e,n){var r=e.fftCount-1;t.push({tag:e.tag,fftCount:e.fftCount,time:e.times[r],fft:e.ffts[r],slice:{delta:e.slices.delta[r],theta:e.slices.theta[r],alpha1:e.slices.alpha1[r],alpha2:e.slices.alpha2[r],beta:e.slices.beta[r],gamma:e.slices.gamma[r]},mean:{delta:e.means.delta[r],theta:e.means.theta[r],alpha1:e.means.alpha1[r],alpha2:e.means.alpha2[r],beta:e.means.beta[r],gamma:e.means.gamma[r]}})})),t},this.getFrontalData=function(){var t=void 0;if(e.settings.eeg){var n=e.getEEGDataByTag("FP1"),r=e.getEEGDataByTag("FP2");n&&r||(n=e.getEEGDataByTag("AF7"),r=e.getEEGDataByTag("AF8")),n&&r&&(t=[n,r])}return t},this.getFrontalCoherenceData=function(){var t,n,r,i=void 0;return e.settings.coherence&&(i=null!==(t=null!==(n=null!==(r=e.getCoherenceByTag("FP2_FP1"))&&void 0!==r?r:e.getCoherenceByTag("FP1_FP2"))&&void 0!==n?n:e.getCoherenceByTag("AF7_AF8"))&&void 0!==t?t:e.getCoherenceByTag("AF8_AF7")),i},this.getCNCoherenceData=function(){var t=void 0;return e.settings.coherence&&void 0===(t=e.getCoherenceByTag("C3_C4"))&&(t=e.getCoherenceByTag("C4_C3")),t},this.getCNData=function(){var t=void 0;if(e.settings.eeg){var n=e.getEEGDataByTag("C3"),r=e.getEEGDataByTag("C4");n&&r&&(t=[n,r])}return t},this.getCoherenceScore=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"alpha1";if(t.fftCount>0){var r=t.fftCount,i=Math.min(20,r),o=t.means[n].slice(r-i);return e.mean(o)}return 0},this.getAlphaRatio=function(t){return t.fftCount>0?t.means.alpha2[eeg_ch.fftCount-1]/t.means.alpha1[eeg_ch.fftCount-1]:0},this.getThetaBetaRatio=function(t){return t.fftCount>0?t.means.theta[t.fftCount-1]/t.means.beta[t.fftCount-1]:0},this.getAlphaBetaRatio=function(t){return t.fftCount>0?.5*(t.means.alpha1[eeg_ch.fftCount-1]+t.means.alpha2[eeg_ch.fftCount-1])/t.means.beta[eeg_ch.fftCount-1]:0},this.get40HzGamma=function(t){if(t.fftCount>0){var n=t.slices.lowgamma[eeg_ch.fftCount-1],r=[];return n.forEach((function(t,n){e.eegshared.freqBins.lowgamma[n]>38&&e.eegshared.freqBins.lowgamma[n]<42&&r.push(t)})),e.max.apply(e,r)}return 0},this.getLowGammaScore=function(t){if(t.fftCount>0){var n=t.fftCount,r=20;n<r&&(r=n);var i=t.means.lowgamma.slice(n-r);return t.means.lowgamma[n-1]-e.mean(i)}return 0},this.getHEGRatioScore=function(t){if(t.count>0){var n=t.count,r=40;n<r&&(r=n);var i=t.ratio.slice(n-r);return t.ratio[n-1]-e.mean(i)}return 0},this.getBlink=function(){var t=[!1,!1];return null==e.data.blink&&(e.data.blink={blinkDuration:1,blinkThreshold:220,lastBlink:Date.now()}),Date.now()-e.data.blink.lastBlink>1e3*e.data.blink.blinkDuration&&([["AF7","FP1"],["AF8","FP2"]].forEach((function(n,r){var i,o=null!==(i=e.getEEGDataByTag(n[0]))&&void 0!==i?i:e.getEEGDataByTag(n[1]),s=o.filtered.slice(o.filtered.length-e.data.blink.blinkDuration*e.data.eegshared.sps),a=Math.max.apply(Math,y(s.map((function(t){return Math.abs(t)}))));t[r]=a>e.data.blink.blinkThreshold})),e.data.blink.lastBlink=Date.now()),t},this.beatDetection=function(t,n){var r=Math.floor(n/4);r%2==0&&(r+=1);var i=Math.round(.5*r),o=Math.floor(3*n);o%2==0&&(o+=1);var s=Math.round(.5*o),a=t.beat_detect;if(a.rir.push(t.red[t.count-1]+t.ir[t.count-1]),a.rir.length>r?a.rir[a.rir.length-1]=e.mean(a.rir.slice(a.rir.length-r)):a.rir[a.rir.length-1]=e.mean(a.rir),a.rir.length>o?a.rir2.push(e.mean(a.rir.slice(a.rir.length-o))):a.rir2.push(e.mean(a.rir)),t.count>1){if(a.drir_dt.push((a.rir[t.count-1]-a.rir[t.count-2])/(t.times[t.count-1]-t.times[t.count-2])),a.drir_dt.length>r){a.drir_dt[a.drir_dt.length-1]=e.mean(a.drir_dt.slice(a.drir_dt.length-r));var c=a.localmins.length,u=a.localmaxs.length;if(e.isExtrema(a.rir.slice(a.rir.length-r),"valley")?a.localmins.push({idx:t.count-i,val:a.rir[t.count-i],t:t.times[t.count-i]}):e.isExtrema(a.rir.slice(a.rir.length-r),"peak")&&a.localmaxs.push({idx:t.count-i,val:a.rir[t.count-i],t:t.times[t.count-i]}),a.localmins.length>1&&a.localmaxs.length>1){if(a.localmins.length>a.localmaxs.length+2)for(;a.localmins.length>a.localmaxs.length+2;)a.localmins.splice(a.localmins.length-2,1);else if(a.localmaxs.length>a.localmins.length+2)for(;a.localmaxs.length>a.localmins.length+2;)a.localmaxs.splice(a.localmins.length-2,1);if(c<a.localmins.length&&a.val_dists.push({dt:a.localmins[a.localmins.length-1].t-a.localmins[a.localmins.length-2].t,t:a.localmins[a.localmins.length-1].t,y0:a.localmins[a.localmins.length-2].val,y1:a.localmins[a.localmins.length-1].val}),u<a.localmaxs.length&&a.peak_dists.push({dt:a.localmaxs[a.localmaxs.length-1].t-a.localmaxs[a.localmaxs.length-2].t,t:a.localmaxs[a.localmaxs.length-1].t,y0:a.localmaxs[a.localmaxs.length-2].val,y1:a.localmaxs[a.localmaxs.length-1].val}),a.peak_dists.length>1&&a.val_dists.length>1)if(a.val_dists[a.val_dists.length-1].t>a.peak_dists[a.peak_dists.length-1].t){if(0===a.beats.length)a.beats.push({t:a.peak_dists[a.peak_dists.length-1].t,hrv:0,bpm:60*(a.peak_dists[a.peak_dists.length-1].dt+a.val_dists[a.val_dists.length-1].dt)/2e3,height0:a.peak_dists[a.peak_dists.length-1].y0-a.val_dists[a.val_dists.length-1].y0,height1:a.peak_dists[a.peak_dists.length-1].y1-a.val_dists[a.val_dists.length-1].y1});else if(a.beats[a.beats.length-1].t!==a.peak_dists[a.peak_dists.length-1].t){var l=60*(a.peak_dists[a.peak_dists.length-1].dt+a.val_dists[a.val_dists.length-1].dt)/2e3;a.beats.push({t:a.peak_dists[a.peak_dists.length-1].t,hrv:Math.abs(l-a.beats[a.beats.length-1].bpm),bpm:l,height0:a.peak_dists[a.peak_dists.length-1].y0-a.val_dists[a.val_dists.length-1].y0,height1:a.peak_dists[a.peak_dists.length-1].y1-a.val_dists[a.val_dists.length-1].y1})}}else if(0===a.beats.length)a.beats.push({t:a.peak_dists[a.peak_dists.length-2].t,hrv:0,bpm:60*(a.peak_dists[a.peak_dists.length-2].dt+a.val_dists[a.val_dists.length-1].dt)/2e3,height0:a.peak_dists[a.peak_dists.length-2].y0-a.val_dists[a.val_dists.length-2].y0,height1:a.peak_dists[a.peak_dists.length-2].y1-a.val_dists[a.val_dists.length-2].y1});else if(a.beats[a.beats.length-1].t!==a.peak_dists[a.peak_dists.length-2].t){var h=60*(a.peak_dists[a.peak_dists.length-2].dt+a.val_dists[a.val_dists.length-1].dt)/2e3;a.beats.push({t:a.peak_dists[a.peak_dists.length-2].t,hrv:Math.abs(h-a.beats[a.beats.length-2].bpm),bpm:h,height0:a.peak_dists[a.peak_dists.length-2].y0-a.val_dists[a.val_dists.length-2].y0,height1:a.peak_dists[a.peak_dists.length-2].y1-a.val_dists[a.val_dists.length-2].y1})}}}if(a.rir2.length>o){var f=a.localmins2.length,d=a.localmaxs2.length;if(e.isExtrema(a.rir2.slice(a.rir2.length-o),"valley")?a.localmins2.push({idx:t.count-s,val:a.rir[t.count-s],t:t.times[t.count-s]}):e.isExtrema(a.rir2.slice(a.rir2.length-o),"peak")&&a.localmaxs2.push({idx:t.count-s,val:a.rir[t.count-s],t:t.times[t.count-s]}),a.localmins2.length>1&&a.localmaxs2.length>1){if(a.localmins2.length>a.localmaxs2.length+2)for(;a.localmins2.length>a.localmaxs2.length+2;)a.localmins2.splice(a.localmins2.length-2,1);else if(a.localmaxs2.length>a.localmins2.length+2)for(;a.localmaxs2.length>a.localmins2.length+2;)a.localmaxs2.splice(a.localmins2.length-2,1);if(f<a.localmins2.length&&a.val_dists2.push({dt:a.localmins2[a.localmins2.length-1].t-a.localmins2[a.localmins2.length-2].t,t:a.localmins2[a.localmins2.length-1].t,y0:a.localmins2[a.localmins2.length-2].val,y1:a.localmins2[a.localmins2.length-1].val}),d<a.localmaxs2.length&&a.peak_dists2.push({dt:a.localmaxs2[a.localmaxs2.length-1].t-a.localmaxs2[a.localmaxs2.length-2].t,t:a.localmaxs2[a.localmaxs2.length-1].t,y0:a.localmaxs2[a.localmaxs2.length-2].val,y1:a.localmaxs2[a.localmaxs2.length-1].val}),a.peak_dists2.length>1&&a.val_dists2.length>1)if(a.val_dists2[a.val_dists2.length-1].t>a.peak_dists2[a.peak_dists2.length-1].t){if(0===a.breaths.length)a.breaths.push(g({t:a.peak_dists2[a.peak_dists2.length-1].t,bpm:12e4/(a.peak_dists2[a.peak_dists2.length-1].dt+a.val_dists2[a.val_dists2.length-1].dt),brv:0,height0:a.peak_dists2[a.peak_dists2.length-1].y0-a.val_dists2[a.val_dists2.length-1].y0},"height0",a.peak_dists2[a.peak_dists2.length-1].y1-a.val_dists2[a.val_dists2.length-1].y1));else if(a.breaths[a.breaths.length-1].t!==a.peak_dists2[a.peak_dists2.length-1].t){var p=12e4/(a.peak_dists2[a.peak_dists2.length-1].dt+a.val_dists2[a.val_dists2.length-1].dt);a.breaths.push(g({t:a.peak_dists2[a.peak_dists2.length-1].t,bpm:p,brv:Math.abs(p-a.breaths[a.breaths.length-1].bpm),height0:a.peak_dists2[a.peak_dists2.length-1].y0-a.val_dists2[a.val_dists2.length-1].y0},"height0",a.peak_dists2[a.peak_dists2.length-1].y1-a.val_dists2[a.val_dists2.length-1].y1))}}else if(0===a.breaths.length)a.breaths.push(g({t:a.peak_dists2[a.peak_dists2.length-2].t,bpm:12e4/(a.peak_dists2[a.peak_dists2.length-2].dt+a.val_dists2[a.val_dists2.length-2].dt),brv:0,height0:a.peak_dists2[a.peak_dists2.length-2].y0-a.val_dists2[a.val_dists2.length-2].y0},"height0",a.peak_dists2[a.peak_dists2.length-2].y1-a.val_dists2[a.val_dists2.length-2].y1));else if(a.breaths[a.breaths.length-1].t!==a.peak_dists2[a.peak_dists2.length-2].t){var v=12e4/(a.peak_dists2[a.peak_dists2.length-2].dt+a.val_dists2[a.val_dists2.length-2].dt);a.breaths.push(g({t:a.peak_dists2[a.peak_dists2.length-2].t,bpm:v,brv:Math.abs(v-a.breaths[a.breaths.length-1].bpm),height0:a.peak_dists2[a.peak_dists2.length-2].y0-a.val_dists2[a.val_dists2.length-2].y0},"height0",a.peak_dists2[a.peak_dists2.length-2].y1-a.val_dists2[a.val_dists2.length-2].y1))}}}}},this.mapFFTData=function(t,n,r){e.data.eeg.find((function(i,o){if(i.tag===r){if(i.fftCount++,i.fftTimes.push(n),i.ffts.push(t),e.data.eegshared.bandFreqs.scp[1].length>0){var s=t.slice(e.data.eegshared.bandFreqs.scp[1][0],e.data.eegshared.bandFreqs.scp[1][e.data.eegshared.bandFreqs.scp[1].length-1]+1);i.slices.scp.push(s),i.means.scp.push(e.mean(s))}if(e.data.eegshared.bandFreqs.scp[1].length>0){var a=t.slice(e.data.eegshared.bandFreqs.delta[1][0],e.data.eegshared.bandFreqs.delta[1][e.data.eegshared.bandFreqs.delta[1].length-1]+1);i.slices.delta.push(a),i.means.delta.push(e.mean(a))}if(e.data.eegshared.bandFreqs.theta[1].length>0){var c=t.slice(e.data.eegshared.bandFreqs.theta[1][0],e.data.eegshared.bandFreqs.theta[1][e.data.eegshared.bandFreqs.theta[1].length-1]+1);i.slices.theta.push(c),i.means.theta.push(e.mean(c))}if(e.data.eegshared.bandFreqs.alpha1[1].length>0){var u=t.slice(e.data.eegshared.bandFreqs.alpha1[1][0],e.data.eegshared.bandFreqs.alpha1[1][e.data.eegshared.bandFreqs.alpha1[1].length-1]+1);i.slices.alpha1.push(u),i.means.alpha1.push(e.mean(u))}if(e.data.eegshared.bandFreqs.alpha2[1].length>0){var l=t.slice(e.data.eegshared.bandFreqs.alpha2[1][0],e.data.eegshared.bandFreqs.alpha2[1][e.data.eegshared.bandFreqs.alpha2[1].length-1]+1);i.slices.alpha2.push(l),i.means.alpha2.push(e.mean(l))}if(e.data.eegshared.bandFreqs.beta[1].length>0){var h=t.slice(e.data.eegshared.bandFreqs.beta[1][0],e.data.eegshared.bandFreqs.beta[1][e.data.eegshared.bandFreqs.beta[1].length-1]+1);i.slices.beta.push(h),i.means.beta.push(e.mean(h))}if(e.data.eegshared.bandFreqs.lowgamma[1].length>0){var f=t.slice(e.data.eegshared.bandFreqs.lowgamma[1][0],e.data.eegshared.bandFreqs.lowgamma[1][e.data.eegshared.bandFreqs.lowgamma[1].length-1]+1);i.slices.lowgamma.push(f),i.means.lowgamma.push(e.mean(f))}if(e.data.eegshared.bandFreqs.highgamma[1].length>0){var d=t.slice(e.data.eegshared.bandFreqs.highgamma[1][0],e.data.eegshared.bandFreqs.highgamma[1][e.data.eegshared.bandFreqs.highgamma[1].length-1]+1);i.slices.highgamma.push(d),i.means.highgamma.push(e.mean(d))}return!0}}))},this.mapCoherenceData=function(t,n){t.forEach((function(t,r){if(e.data.coherence[r].fftCount++,e.data.coherence[r].ffts.push(t),e.data.coherence[r].fftTimes.push(n),e.data.eegshared.bandFreqs.scp[1].length>0){var i=t.slice(e.data.eegshared.bandFreqs.scp[1][0],e.data.eegshared.bandFreqs.scp[1][e.data.eegshared.bandFreqs.scp[1].length-1]+1);e.data.coherence[r].slices.scp.push(i),e.data.coherence[r].means.scp.push(e.mean(i))}if(e.data.eegshared.bandFreqs.delta[1].length>0){var o=t.slice(e.data.eegshared.bandFreqs.delta[1][0],e.data.eegshared.bandFreqs.delta[1][e.data.eegshared.bandFreqs.delta[1].length-1]+1);e.data.coherence[r].slices.delta.push(o),e.data.coherence[r].means.delta.push(e.mean(o))}if(e.data.eegshared.bandFreqs.theta[1].length>0){var s=t.slice(e.data.eegshared.bandFreqs.theta[1][0],e.data.eegshared.bandFreqs.theta[1][e.data.eegshared.bandFreqs.theta[1].length-1]+1);e.data.coherence[r].slices.theta.push(s),e.data.coherence[r].means.theta.push(e.mean(s))}if(e.data.eegshared.bandFreqs.alpha1[1].length>0){var a=t.slice(e.data.eegshared.bandFreqs.alpha1[1][0],e.data.eegshared.bandFreqs.alpha1[1][e.data.eegshared.bandFreqs.alpha1[1].length-1]+1);e.data.coherence[r].slices.alpha1.push(a),e.data.coherence[r].means.alpha1.push(e.mean(a))}if(e.data.eegshared.bandFreqs.alpha2[1].length>0){var c=t.slice(e.data.eegshared.bandFreqs.alpha2[1][0],e.data.eegshared.bandFreqs.alpha2[1][e.data.eegshared.bandFreqs.alpha2[1].length-1]+1);e.data.coherence[r].slices.alpha2.push(c),e.data.coherence[r].means.alpha2.push(e.mean(c))}if(e.data.eegshared.bandFreqs.beta[1].length>0){var u=t.slice(e.data.eegshared.bandFreqs.beta[1][0],e.data.eegshared.bandFreqs.beta[1][e.data.eegshared.bandFreqs.beta[1].length-1]+1);e.data.coherence[r].slices.beta.push(u),e.data.coherence[r].means.beta.push(e.mean(u))}if(e.data.eegshared.bandFreqs.lowgamma[1].length>0){var l=t.slice(e.data.eegshared.bandFreqs.lowgamma[1][0],e.data.eegshared.bandFreqs.lowgamma[1][e.data.eegshared.bandFreqs.lowgamma[1].length-1]+1);e.data.coherence[r].slices.lowgamma.push(l),e.data.coherence[r].means.lowgamma.push(e.mean(l))}if(e.data.eegshared.bandFreqs.highgamma[1].length>0){var h=t.slice(e.data.eegshared.bandFreqs.highgamma[1][0],e.data.eegshared.bandFreqs.highgamma[1][e.data.eegshared.bandFreqs.highgamma[1].length-1]+1);e.data.coherence[r].slices.highgamma.push(h),e.data.coherence[r].means.highgamma.push(e.mean(h))}}))},this.bufferEEGSignals=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=Math.floor(e.data.eegshared.sps*t),r=[],i=null,o=0;o<e.data.eegshared.eegChannelTags.length;o++)if(!0===e.data.eegshared.eegChannelTags[o].analyze&&null!==e.data.eegshared.eegChannelTags[o].tag&&"other"!==e.data.eegshared.eegChannelTags[o].tag){var s=e.getEEGDataByTag(e.data.eegshared.eegChannelTags[o].tag);void 0!==s&&(s.filtered.length>0?r.push(s.filtered.slice(s.filtered.length-n)):s.raw.length>0&&r.push(s.raw.slice(s.raw.length-n)),null===i&&(i=s.times[s.times.length-1]))}return!0===e.settings.analyzing&&(e.workerPostTime=i),r},this.readyEEGDataForWriting=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end",r=["TimeStamps","UnixTime"],i=[],o=0,s=0,a=[],c=null;if(e.data.eegshared.eegChannelTags.forEach((function(t,n){null===c&&"other"!==t.tag&&!0===t.analyze&&(c=e.getEEGDataByChannel(t.ch)),a.push(e.getEEGDataByChannel(t.ch))})),a.length>0){if("end"===n&&(n=a[0].count),a[0].count<t&&(t=e.atlas.rolloverLimit-2e3),0!==t)for(;c.fftTimes[o]<a[0].times[t];)o++;for(var u=function(t){var n=[];if(n.push(e.toISOLocal(new Date(a[0].times[t])),a[0].times[t]),a.forEach((function(e,i){0===t&&r.push(e.tag),e.filtered.length>t?n.push(e.filtered[t].toFixed(0)):e.raw.length>t&&n.push(e.raw[t].toFixed(0))})),c.fftCount>=o&&c.fftTimes[o]===a[0].times[t]&&(a.forEach((function(i,s){if(0===o&&!e.data.eegshared.eegChannelTags.find((function(t,e){if(!(i.tag!==t.ch&&i.tag!==t.tag||!1!==t.analyze&&"other"!==t.tag))return!0}))){var c=y(e.data.eegshared.frequencies).map((function(t,e){return t.toFixed(3)}));r.push(i.tag+"; FFT Hz:",c.join(","))}a[0].times[t]===i.fftTimes[o]&&n.push(y(i.ffts[o]).map((function(t,e){return t.toFixed(3)})))})),e.settings.coherence&&e.data.coherence.forEach((function(t,i){if(0===o){var s=y(e.data.eegshared.frequencies).map((function(t,e){return t.toFixed(3)}));r.push(t.tag+"; FFT Hz:",s.join(","))}if(a[0].fftTimes[o]===t.fftTimes[o])try{n.push(y(t.ffts[o]).map((function(t,e){return t.toFixed(3)})))}catch(e){console.log(e,o,t)}})),o++),e.data.other.notes.length>0){if(0===t)r.push("Notes");else for(;e.data.other.notes[s].time<a[0].times[t];)s++;e.data.other.notes[s].time<=a[0].times[t]&&(n.push(e.data.other.notes[s].note),nodeidx++)}i.push(n.join(","))},l=t;l<n;l++)u(l);return[r.join(",")+"\n",i.join("\n")]}},this.readyHEGDataForWriting=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=["TimeStamps","UnixTime","Red","IR","Ambient","Ratio"],o=[],s=e.data.heg[r];"end"===n&&(n=s.times.length);for(var a=t;a<n;a++){var c=s.times[a];if(o.push([c,e.toISOLocal(new Date(c)),s.red[a],s.ir[a],s.ambient[a],s.ratio[a]].join(",")),e.data.other.notes.length>0){if(0===a)i.push("Notes");else for(;e.data.other.notes[noteidx].time<c;)noteidx++;e.data.other.notes[noteidx].time<=c&&(line.push(e.data.other.notes[noteidx].note),nodeidx++)}}return[i.join(",")+"\n",o.join("\n")]},this.workeronmessage=function(t){if(t.origin===e.name){if("multidftbandpass"===t.foo||"multidft"===t.foo){var n=y(t.output[1]),r=0;e.data.eegshared.eegChannelTags.forEach((function(t,i){null!==t.tag&&"other"!==t.tag&&!0===t.analyze&&(e.mapFFTData(n[r],e.workerPostTime,t.tag),r++)})),e.checkRollover("eeg")}else if("coherence"===t.foo){n=y(t.output[1]);var i=y(t.output[2]),o=0;e.data.eegshared.eegChannelTags.forEach((function(t,r){null!==t.tag&&"other"!==t.tag&&!0===t.analyze&&(e.mapFFTData(n[o],e.workerPostTime,t.tag),o++)})),e.mapCoherenceData(i,e.workerPostTime),e.checkRollover("eeg")}e.workerWaiting=!1}},this.analyzer=function(){!0===e.settings.analyzing&&(e.settings.analysis.forEach((function(t,n){e.analyzerOpts.forEach((function(n,r){n===t&&e.analyzerFuncs[r]()}))})),setTimeout((function(){requestAnimationFrame(e.analyzer)}),50))},this.makeFeedbackOptions=function(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.getElementById(t.props.id).querySelector(".brainsatplay-neurofeedback-container"),i=t.props.id,o="";if(e.settings.deviceConnected){r.style.pointerEvents="auto";var s=function(){return e.getCoherenceScore(e.getFrontalCoherenceData(),"alpha1")},a=function(){var t=e.getFrontalData(),n=[];return t.forEach((function(t){n.push(e.getThetaBetaRatio(t))})),Math.min(1/(n.reduce((function(t,e){return t+e}))/n.length),1)},c=function(){var t=e.data.heg[0].count;if(t>1){var n=40;t<n&&(n=t);var r=e.data.heg[0].ratio.slice(t-n);return e.data.heg[0].ratio[t-1]-e.mean(r)}},u=function(t){var n=e.data.heg[0].beat_detect[t],r=e.data.heg[0].beat_detect.prevBeatLength;if(e.data.heg[0].beat_detect.prevBeatLength=n.length,r<n.length&&(console.log("beat"),n[n.length-1].tRead=Date.now()),0<n.length){var i=(Date.now()-n[n.length-1].tRead)/1e3*n[n.length-1].bpm/30;return i<1?1-(.5+.5*Math.cos(2*Math.PI*i)):0}return 0},l=function(){return u("beats")},h=function(){return u("breaths")};n=[{label:"Select your neurofeedback",function:t.defaultNeurofeedback}],e.settings.heg&&n.push({label:"HEG Ratio",function:c},{label:"Heartbeat",function:l},{label:"Breath",function:h}),e.settings.eeg&&n.push({label:"Frontal Alpha Coherence",function:s},{label:"Focus",function:a});var f=document.getElementById("".concat(i,"-neurofeedbackselector"));null==f&&(o='<div><select id="'.concat(i,'-neurofeedbackselector">'),n.forEach((function(t,e){o+=0===e?"<option value=".concat(t.function.name," disabled>").concat(t.label,"</option>"):1===e?"<option value=".concat(t.function.name," selected>").concat(t.label,"</option>"):"<option value=".concat(t.function.name,">").concat(t.label,"</option>"),e===n.length-1&&(o+="</select></div>")})),r.innerHTML+=o,f=document.getElementById("".concat(i,"-neurofeedbackselector"))),t.getNeurofeedback=n.find((function(t){return t.function.name==f.value})).function,f.onchange=function(e){t.getNeurofeedback=n.find((function(t){return t.function.name==e.target.value})).function}}},this.name=n,this.config=i,this.state=new p({deviceConnected:!1,analyzing:!1,analysis:a,heg:!1,eeg:!1,coherence:!1,eyetracker:!1,accelerometer:!1,hrv:!1,fnirs:!1,ecg:!1,spo2:!1,emg:!1}),this.settings=this.state.data,this.data={eegshared:{eegChannelTags:[],sps:1,startTime:0,frequencies:[],bandFreqs:{scp:[[],[]],delta:[[],[]],theta:[[],[]],alpha1:[[],[]],alpha2:[[],[]],beta:[[],[]],lowgamma:[[],[]],highgamma:[[],[]]}},eeg:[],coherence:[],heg:[],fnirs:[],accelerometer:[],hrv:[],spo2:[],emg:[],ecg:[],eyetracker:[],other:{notes:[],games:{}}},Object.assign(this.data,r),this.rolloverLimit=60030,"10_20"===i?(this.settings.eeg=!0,this.data.eeg=this.gen10_20Atlas(this.data.eegshared.eegChannelTags)):"muse"===i?(this.settings.eeg=!0,this.data.eeg=this.genMuseAtlas()):"big"===i?(this.settings.eeg=!0,this.data.eeg=this.gen10_20Atlas()):"hegduino"===i?(this.addHEGCoord(this.data.heg.length,0,60,60),this.settings.heg=!0):"eyetracker"===i&&(this.settings.eyetracker=!0,this.addEyeTracker(this.data.eyetracker.length)),!0===o&&(this.settings.coherence=!0,this.data.coherence=this.genCoherenceMap(this.data.eegshared.eegChannelTags)),this.data.eegshared.eegChannelTags&&this.data.eegshared.eegChannelTags.forEach((function(t,n){void 0===e.getEEGDataByTag(t.tag)&&e.addEEGCoord(t.ch)})),this.data.eegshared.sps&&(this.data.eegshared.frequencies=this.bandpassWindow(0,128,.5*this.data.eegshared.sps),this.data.eegshared.bandFreqs=this.getBandFreqs(this.data.eegshared.frequencies)),this.analyzerOpts=[],this.analyzerFuncs=[],this.workerPostTime=0,this.workerWaiting=!1,this.workerIdx=0,!0===s&&(this.addDefaultAnalyzerFuncs(),window.workerResponses||(window.workerResponses=[]),window.workerResponses.push(this.workeronmessage))}var e,n;return e=t,(n=[{key:"genEEGCoordinateStruct",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i={scp:[],delta:[],theta:[],alpha1:[],alpha2:[],beta:[],lowgamma:[],highgamma:[]},o={tag:t,position:{x:e,y:n,z:r},count:0,times:[],raw:[],filtered:[],fftCount:0,fftTimes:[],ffts:[],slices:JSON.parse(JSON.stringify(i)),means:JSON.parse(JSON.stringify(i)),lastReadFFT:0,lastRead:0};return o}},{key:"addEEGCoord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:999,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:999;this.data.eeg.push(this.genEEGCoordinateStruct(t,e,n,r))}},{key:"genMuseAtlas",value:function(){var t=this,e=[],n=[[-21.5,70.2,-.1],[28.4,69.1,-.4],[-54.8,33.9,-3.5],[56.6,30.8,-4.1]];function r(t,e){var n=[];return t.forEach((function(t,r){n.push(.5*(t+e[r]))})),n}var i=[r(n[0],n[2]),r(n[1],n[3]),[-80.2,-31.3,-10.7],[81.9,-34.2,-8.2]];return["AF7","AF8","TP9","TP10"].forEach((function(n,r){e.push(t.genEEGCoordinateStruct(n,i[r][0],i[r][1],i[r][2]))})),e}},{key:"gen10_20Atlas",value:function(t){var e=this,n={FP1:[-21.2,66.9,12.1],FPZ:[1.4,65.1,11.3],FP2:[24.3,66.3,12.5],AF7:[-41.7,52.8,11.3],AF3:[-32.7,48.4,32.8],AFZ:[1.8,54.8,37.9],AF4:[35.1,50.1,31.1],AF8:[43.9,52.7,9.3],F5:[-51.4,26.7,24.7],F3:[-39.7,25.3,44.7],F1:[-22.1,26.8,54.9],FZ:[0,26.8,60.6],F2:[23.6,28.2,55.6],F4:[41.9,27.5,43.9],F6:[52.9,28.7,25.2],F7:[-52.1,28.6,3.8],F8:[53.2,28.4,3.1],FC5:[-59.1,3,26.1],FC3:[-45.5,2.4,51.3],FC1:[-24.7,.3,66.4],FCZ:[1,1,72.8],FC2:[26.1,3.2,66],FC4:[47.5,4.6,49.7],FC6:[60.5,4.9,25.5],FT9:[-53.8,-2.1,-29.1],FT7:[-59.2,3.4,-2.1],FT8:[60.2,4.7,-2.8],FT10:[55,-3.6,-31],T7:[-65.8,-17.8,-2.9],T5:[-61.5,-65.3,1.1],T3:[-70.2,-21.3,-10.7],T4:[71.9,-25.2,-8.2],T6:[59.3,-67.6,3.8],T8:[67.4,-18.5,-3.4],C5:[-63.6,-18.9,25.8],C3:[-49.1,-20.7,53.2],C1:[-25.1,-22.5,70.1],CZ:[.8,-21.9,77.4],C2:[26.7,-20.9,69.5],C4:[50.3,-18.8,53],C6:[65.2,-18,26.4],CP5:[-61.8,-46.2,22.5],CP3:[-46.9,-47.7,49.7],CP1:[-24,-49.1,66.1],CPZ:[.7,-47.9,72.6],CP2:[25.8,-47.1,66],CP4:[49.5,-45.5,50.7],CP6:[62.9,-44.6,24.4],TP9:[-73.6,-46.7,-4],TP7:[-63.6,-44.7,-4],TP8:[64.6,-45.4,-3.7],TP10:[74.6,-47.4,-3.7],P9:[-50.8,-51.3,-37.7],P7:[-55.9,-64.8,0],P5:[-52.7,-67.1,19.9],P3:[-41.4,-67.8,42.4],P1:[-21.6,-71.3,52.6],PZ:[.7,-69.3,56.9],P2:[24.4,-69.9,53.5],P4:[44.2,-65.8,42.7],P6:[54.4,-65.3,20.2],P8:[56.4,-64.4,.1],P10:[51,-53.9,-36.5],PO7:[-44,-81.7,1.6],PO3:[-33.3,-84.3,26.5],POZ:[0,-87.9,33.5],PO4:[35.2,-82.6,26.1],PO8:[43.3,-82,.7],O1:[-25.8,-93.3,7.7],Oz:[.3,-97.1,8.7],O2:[25,-95.2,6.2]},r=[];if(null==t)for(var i in n)r.push(this.genEEGCoordinateStruct(i,n[i][0],n[i][1],n[i][2]));else t.forEach((function(t){var i=t.tag;n[i]&&r.push(e.genEEGCoordinateStruct(i,n[i][0],n[i][1],n[i][2]))})),["FP1","FP2","FPZ","F3","F4","F7","F8","CZ","C3","C4","T3","T4","T5","T6","PZ","P3","P4","O1","O2"].forEach((function(t,i){r.find((function(e){return e.tag===t}))||(console.log("notfound"),r.push(e.genEEGCoordinateStruct(t,n[t][0],n[t][1],n[t][2])))}));return r}},{key:"genCoherenceStruct",value:function(t,e,n,r){var i={scp:[],delta:[],theta:[],alpha1:[],alpha2:[],beta:[],lowgamma:[],highgamma:[]};return{tag:t+"_"+e,x0:null==n?void 0:n.x,y0:null==n?void 0:n.y,z0:null==n?void 0:n.z,x1:null==r?void 0:r.x,y1:null==r?void 0:r.y,z1:null==r?void 0:r.z,fftCount:0,fftTimes:[],ffts:[],slices:JSON.parse(JSON.stringify(i)),means:JSON.parse(JSON.stringify(i)),lastRead:0}}},{key:"genCoherenceMap",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data.eegshared.eegChannelTags,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=1,i=0,o=0;o<t.length*(t.length+1)/2-t.length;o++){if(!1===e||!0===e&&null!==t[i].tag&&null!==t[i+r].tag&&"other"!==t[i].tag&&"other"!==t[i+r].tag&&!0===t[i].analyze&&!0===t[i+r].analyze){var s=this.getEEGDataByTag(t[i].tag),a=this.getEEGDataByTag(t[i+r].tag);n.push(this.genCoherenceStruct(t[i].tag,t[i+r].tag,s.position,a.position))}++r+i===t.length&&(i++,r=1)}return n}},{key:"genHEGStruct",value:function(t,e,n,r){return{tag:t,position:{x:e,y:n,z:r},count:0,times:[],red:[],ir:[],ambient:[],ratio:[],beat_detect:{beats:[],breaths:[],rir:[],rir2:[],drir_dt:[],localmins:[],localmaxs:[],val_dists:[],peak_dists:[],localmins2:[],localmaxs2:[],val_dists2:[],peak_dists2:[]},lastRead:0,startTime:0}}},{key:"addHEGCoord",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"heg1",e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.data.heg.push(this.genHEGStruct(t,e,n,r))}},{key:"genFNIRSStruct",value:function(t,e,n,r){return{tag:t,position:{x:e,y:n,z:r},count:0,times:[],red:[],ir:[],ir2:[],ambient:[],lastRead:0}}},{key:"addFNIRSCoord",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"banana1",e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.data.fnirs.push(this.genHEGStruct(t,e,n,r))}},{key:"genAccelerometerStruct",value:function(t,e,n,r){return{tag:t,position:{x:e,y:n,z:r},count:0,times:[],Ax:[],Ay:[],Az:[],Gx:[],Gy:[],Gz:[],lastRead:0,startTime:0}}},{key:"addAccelerometerCoord",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"accel1",e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.data.accelerometer.push(this.genAccelerometerStruct(t,e,n,r))}},{key:"genHRVStruct",value:function(t){return{tag:t,count:0,times:[],raw:[],filtered:[],bpm:[],hrv:[],lastRead:0,startTime:0}}},{key:"addHRV",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hrv1";this.data.hrv.push(genHRVStruct(t))}},{key:"genEyeTrackerStruct",value:function(t){return{tag:t,count:0,times:[],x:[],y:[],smax:[],smay:[],lastRead:0,startTime:0}}},{key:"addEyeTracker",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eyes";this.data.eyetracker.push(this.genEyeTrackerStruct(t))}},{key:"makeNote",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"event",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(void 0===e){if(this.settings.eeg){var n=this.getEEGDataByChannel(this.data.eegshared.eegChannelTags[0].ch);e=n.times[n.times.length-1],this.data.other.notes.push({time:e,note:t})}this.settings.heg?(e=this.data.heg[0].times[this.data.heg[0].times.length-1],this.data.other.notes.push({time:e,note:t})):this.data.other.notes.push({time:Date.now(),note:t})}else this.data.other.notes.push({time:e,note:t})}},{key:"getCoordPositions",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eeg",e=[],n=0;n<this.data[t].length;n++)e.push([this.data[t][n].position.x,this.data[t][n].position.y,this.data[t][n].position.z]);return e}},{key:"mean",value:function(t){return t.reduce((function(t,e){return e+t}))/t.length}},{key:"isExtrema",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"peak",n=y(t);if(n.length%2==0&&n.pop(),t.length>1){var r=!0;return n.forEach((function(t,i){"peak"===e?(i<Math.floor(.5*n.length)&&t>=n[Math.floor(.5*n.length)]||i>Math.floor(.5*n.length)&&t>=n[Math.floor(.5*n.length)])&&(r=!1):(i<Math.floor(.5*n.length)&&t<=n[Math.floor(.5*n.length)]||i>Math.floor(.5*n.length)&&t<=n[Math.floor(.5*n.length)])&&(r=!1)})),"peak"!==e&&"valley"!==e&&!1===r&&(r=!0,n.forEach((function(t,e){(e<Math.floor(.5*n.length)&&t>=n[Math.floor(.5*n.length)]||e>Math.floor(.5*n.length)&&t>=n[Math.floor(.5*n.length)])&&(r=!1)}))),r}}},{key:"isCriticalPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"peak",n=y(t);if(n.length%2==0&&n.pop(),t.length>1){var r=!0;return n.forEach((function(t,i){"peak"===e?(i<.5*n.length&&t<=0||i>.5*n.length&&t>0)&&(r=!1):(i<.5*n.length&&t>=0||i>.5*n.length&&t<0)&&(r=!1)})),"peak"!==e&&"valley"!==e&&!1===r&&(r=!0,n.forEach((function(t,e){(e<.5*n.length&&t<=0||e>.5*n.length&&t>0)&&(r=!1)}))),r}}},{key:"setDefaultTags",value:function(){return[{ch:0,tag:null},{ch:1,tag:null},{ch:2,tag:null},{ch:3,tag:null},{ch:4,tag:null},{ch:5,tag:null},{ch:6,tag:null},{ch:7,tag:null},{ch:8,tag:null},{ch:9,tag:null},{ch:10,tag:null},{ch:11,tag:null},{ch:12,tag:null},{ch:13,tag:null},{ch:14,tag:null},{ch:15,tag:null},{ch:16,tag:null},{ch:17,tag:null},{ch:18,tag:null},{ch:19,tag:null},{ch:20,tag:null},{ch:21,tag:null},{ch:22,tag:null},{ch:23,tag:null},{ch:24,tag:null},{ch:25,tag:null},{ch:26,tag:null},{ch:27,tag:null},{ch:28,tag:null},{ch:29,tag:null},{ch:30,tag:null},{ch:31,tag:null}]}},{key:"getBandFreqs",value:function(t){var e=[[],[]],n=[[],[]],r=[[],[]],i=[[],[]],o=[[],[]],s=[[],[]],a=[[],[]],c=[[],[]];return t.forEach((function(t,u){t>=.1&&t<=1?(e[0].push(t),e[1].push(u)):t>=1&&t<=4?(n[0].push(t),n[1].push(u)):t>4&&t<=8?(r[0].push(t),r[1].push(u)):t>8&&t<=10?(i[0].push(t),i[1].push(u)):t>10&&t<=12?(o[0].push(t),o[1].push(u)):t>12&&t<=30?(s[0].push(t),s[1].push(u)):t>30&&t<=45?(a[0].push(t),a[1].push(u)):t>45&&(c[0].push(t),c[1].push(u))})),{scp:e,delta:n,theta:r,alpha1:i,alpha2:o,beta:s,lowgamma:a,highgamma:c}}},{key:"bandpassWindow",value:function(t,e,n){for(var r=(e-t)/n,i=[],o=0;o<e;)i.push(o),o+=r;return i}},{key:"toISOLocal",value:function(t){var e=function(t){return("0"+t).slice(-2)},n=t.getTimezoneOffset(),r=n<0?"+":"-";return n=Math.abs(n),t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+"T"+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+"."+("00"+t.getMilliseconds()).slice(-3)+"(UTC"+r+e(n/60|0)+":00)"}},{key:"regenAtlasses",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512;this.data.eeg=this.makeAtlas10_20();var r=this.bandPassWindow(t,e,n);this.data.eegshared.frequencies=r,this.data.eegshared.bandFreqs=this.getBandFreqs(r),this.coherenceMap=this.genCoherenceMap()}},{key:"addDefaultAnalyzerFuncs",value:function(){var t=this;this.analyzerOpts.push("eegfft","eegcoherence"),this.analyzerFuncs.push((function(){if(!1===t.workerWaiting){var e=t.bufferEEGSignals(1);e.length>0&&e[0].length>=t.data.eegshared.sps&&(window.postToWorker({foo:"multidftbandpass",input:[e,1,0,128,1],origin:t.name},t.workerIdx),t.workerWaiting=!0)}}),(function(){if(!1===t.workerWaiting){var e=t.bufferEEGSignals(1);e.length>0&&e[0].length>=t.data.eegshared.sps&&(window.postToWorker({foo:"coherence",input:[e,1,0,128,1],origin:t.name},t.workerIdx),t.workerWaiting=!0)}}))}},{key:"addAnalyzerFunc",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=this.analyzerOpts.find((function(e,r){if(e==e)return t.analyzerFuncs[r]=n,!0}));void 0===r&&(this.analyzerOpts.push(e),this.analyzerFuncs.push(n))}},{key:"checkRollover",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===e)for(var n in this.data)Array.isArray(this.data[n])&&this.data[n].forEach((function(e,n){for(var r in e)if(Array.isArray(e[r])||"object"!==v(e[r]))Array.isArray(e[r])&&e[r].length>t.rolloverLimit&&(e[r].splice(0,e[r].length-t.rolloverLimit-2e3),"ffts"===r?(e.fftCount=e[r].length,e.lastReadFFT>e[r].length&&(e.lastReadFFT=e[r].length)):"times"===r&&(e.count=e[r].length,e.lastRead>e[r].length&&(e.lastRead=e[r].length)));else for(var i in e[r])Array.isArray(e[r][i])&&e[r][i].length>t.rolloverLimit&&e[r][i].splice(0,e[r][i].length-t.rolloverLimit-2e3)}));else Array.isArray(this.data[e])&&this.data[e].forEach((function(e,n){for(var r in e)if(Array.isArray(e[r])||"object"!==v(e[r]))Array.isArray(e[r])&&e[r].length>t.rolloverLimit&&(e[r].splice(0,e[r].length-t.rolloverLimit-2e3),"ffts"===r?(e.fftCount=e[r].length,e.lastReadFFT=e[r].length):"times"===r&&(e.count=e[r].length,e.lastRead=e[r].length));else for(var i in e[r])Array.isArray(e[r][i])&&e[r][i].length>t.rolloverLimit&&e[r][i].splice(0,e[r][i].length-t.rolloverLimit-2e3)}))}}])&&w(e.prototype,n),t}();function S(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function _(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){S(o,r,i,s,a,"next",t)}function a(t){S(o,r,i,s,a,"throw",t)}s(void 0)}))}}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function E(t){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var I=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.onDecodedCallback,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onConnectedCallback,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onDisconnectedCallback,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.decode,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:115200;C(this,t),this.onDecodedCallback=e,this.onConnectedCallback=n,this.onDisconnectedCallback=r,this.decode=i,this.connected=!1,this.subscribed=!1,this.buffer=[],this.startByte=160,this.stopByte=192,this.searchString=new Uint8Array([this.stopByte,this.startByte]),this.readRate=16.666667,this.readBufferSize=2e3,this.sps=512,this.nChannels=32,this.nPeripheralChannels=6,this.updateMs=1e3/this.sps,this.stepSize=1/Math.pow(2,24),this.vref=2.5,this.gain=8,this.vscale=this.vref/this.gain*this.stepSize,this.uVperStep=this.vref/this.gain*this.stepSize*1e6,this.scalar=1/(1e6/(this.vref/this.gain*this.stepSize)),this.maxBufferedSamples=60*this.sps*2,this.data={count:0,startms:0,ms:[],A0:[],A1:[],A2:[],A3:[],A4:[],A5:[],A6:[],A7:[],A8:[],A9:[],A10:[],A11:[],A12:[],A13:[],A14:[],A15:[],A16:[],A17:[],A18:[],A19:[],A20:[],A21:[],A22:[],A23:[],A24:[],A25:[],A26:[],A27:[],A28:[],A29:[],A30:[],A31:[],Ax:[],Ay:[],Az:[],Gx:[],Gy:[],Gz:[]},this.resetDataBuffers(),navigator.serial||console.error("`navigator.serial not found! Enable #enable-experimental-web-platform-features in chrome://flags (search 'experimental')"),this.port=null,this.reader=null,this.baudrate=o}var e,n,r,i,o,s,a;return e=t,(n=[{key:"resetDataBuffers",value:function(){for(var t in this.data.count=0,this.data.startms=0,this.data)"object"===E(this.data[t])&&(this.data[t]=new Array(this.maxBufferedSamples).fill(0))}},{key:"setScalar",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/(Math.pow(2,23)-1),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4.5;this.stepSize=e,this.vref=n,this.gain=t,this.vscale=this.vref/this.gain*this.stepSize,this.uVperStep=this.vref/this.gain*this.stepSize*1e6,this.scalar=1/(1e6/(this.vref/this.gain*this.stepSize))}},{key:"getLatestData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"A0",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e;return n<=1?[this.data[t][this.data.count-1]]:(n>this.data.count&&(n=this.data.count),this.data[t].slice(this.data.count-n,this.data.count))}},{key:"bytesToInt16",value:function(t,e){return 256*t+e}},{key:"int16ToBytes",value:function(t){return[255&t,t>>8&255]}},{key:"bytesToInt24",value:function(t,e,n){return 65536*t+256*e+n}},{key:"int24ToBytes",value:function(t){return[255&t,t>>8&255,t>>16&255]}},{key:"decode",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.buffer,e=this.searchString,n=t,r=this.boyerMoore(e),i=r.byteLength,o=[],s=0,a=r(n);-1!==a;a=r(n,a+i))o.push(a);if(o.length>=2){for(var c=1;c<o.length;c++)if(o[c]-o[c-1]!=105);else{var u=t.slice(o[c-1],o[c]+1);for(this.data.count<this.maxBufferedSamples&&this.data.count++,this.data.count-1==0?(this.data.ms[this.data.count-1]=Date.now(),this.data.startms=this.data.ms[0]):(this.data.ms[this.data.count-1]=this.data.ms[this.data.count-2]+this.updateMs,this.data.count>=this.maxBufferedSamples&&(this.data.ms.splice(0,5120),this.data.ms.push(new Array(5120).fill(0)))),a=3;a<99;a+=3){var l="A"+(a-3)/3;this.data[l][this.data.count-1]=this.bytesToInt24(u[a],u[a+1],u[a+2]),this.data.count>=this.maxBufferedSamples&&(this.data[l].splice(0,5120),this.data[l].push(new Array(5120).fill(0)))}this.data.Ax[this.data.count-1]=this.bytesToInt16(u[99],u[100]),this.data.Ay[this.data.count-1]=this.bytesToInt16(u[101],u[102]),this.data.Az[this.data.count-1]=this.bytesToInt16(u[103],u[104]),this.data.count>=this.maxBufferedSamples&&(this.data.Ax.splice(0,5120),this.data.Ay.splice(0,5120),this.data.Az.splice(0,5120),this.data.Ax.push(new Array(5120).fill(0)),this.data.Ay.push(new Array(5120).fill(0)),this.data.Az.push(new Array(5120).fill(0)),this.data.count-=5120),s++}return s>0&&t.splice(0,o[o.length-1]),s}}},{key:"onDecodedCallback",value:function(t){}},{key:"onConnectedCallback",value:function(){console.log("port connected!")}},{key:"onDisconnectedCallback",value:function(){console.log("port disconnected!")}},{key:"onReceive",value:function(t){var e,n;(e=this.buffer).push.apply(e,function(t){if(Array.isArray(t))return T(t)}(n=t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return T(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var r=this.decode(this.buffer);!1===r||0===r||isNaN(r)||this.onDecodedCallback(r)}},{key:"onPortSelected",value:(a=_(regeneratorRuntime.mark((function t(e){var n,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:this.baudrate,t.prev=1,t.prev=2,t.next=5,e.open({baudRate:n,bufferSize:this.readBufferSize});case 5:this.onConnectedCallback(),this.connected=!0,this.subscribed=!0,this.subscribe(e),t.next=19;break;case 11:return t.prev=11,t.t0=t.catch(2),t.next=15,e.open({baudrate:n,buffersize:this.readBufferSize});case 15:this.onConnectedCallback(),this.connected=!0,this.subscribed=!0,this.subscribe(e);case 19:t.next=25;break;case 21:t.prev=21,t.t1=t.catch(1),console.log(t.t1),this.connected=!1;case 25:case"end":return t.stop()}}),t,this,[[1,21],[2,11]])}))),function(t){return a.apply(this,arguments)})},{key:"subscribe",value:(s=_(regeneratorRuntime.mark((function t(e){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.port.readable&&!0===this.subscribed&&(this.reader=e.readable.getReader(),(n=function(){var t=_(regeneratorRuntime.mark((function t(){var e,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.reader.read();case 3:if(e=t.sent,i=e.value,!e.done&&!1!==r.subscribed){t.next=9;break}return t.next=9,r.reader.releaseLock();case 9:if(i)try{r.onReceive(i)}catch(t){console.log(t)}!0===r.subscribed&&setTimeout((function(){n()}),r.readRate),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(0),console.log(t.t0),r.closePort();case 17:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(){return t.apply(this,arguments)}}())());case 1:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"subscribeSafe",value:(o=_(regeneratorRuntime.mark((function t(e){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:new Promise((function(t,r){for(;n.port.readable&&!0===n.subscribed;){n.reader=e.readable.getReader();for(var i=!0,o=new Promise((function(t,e){return n.reader.read()})),s=new Promise((function(t,e){setTimeout(t,100,"readfail")}));!0===i;)Promise.race([o,s]).then((function(t){if(console.log("newpromise"),"readfail"===t)console.log(t);else{var e=t.value;!0===t.done||!0===n.subscribed?new Promise((function(t,e){t(n.reader.releaseLock())})).then((function(){i=!1})):n.onReceive(e)}}))}t("not readable")}));case 1:case"end":return t.stop()}}),t)}))),function(t){return o.apply(this,arguments)})},{key:"closePort",value:(i=_(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=r.length>0&&void 0!==r[0]?r[0]:this.port,this.port&&(this.subscribed=!1,setTimeout(_(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.reader){t.next=4;break}return t.next=3,n.reader.releaseLock();case 3:n.reader=null;case 4:return t.next=6,e.close();case 6:n.port=null,n.connected=!1,n.onDisconnectedCallback();case 9:case"end":return t.stop()}}),t)}))),100));case 2:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"setupSerialAsync",value:(r=_(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:this.baudrate,t.next=4,navigator.serial.requestPort();case 4:this.port=t.sent,navigator.serial.addEventListener("disconnect",(function(t){n.closePort(n.port)})),this.onPortSelected(this.port,e);case 7:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"asUint8Array",value:function(t){if(t instanceof Uint8Array)return t;if("string"==typeof t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r>127)throw new TypeError("Only ASCII patterns are supported");e[n]=r}return e}return new Uint8Array(t)}},{key:"boyerMoore",value:function(t){var e=this,n=this.asUint8Array(t),r=n.length;if(0===r)throw new TypeError("patternBuffer must be at least 1 byte long");for(var i=new Int32Array(256),o=0;o<256;o++)i[o]=-1;for(var s=0;s<r;s++)i[n[s]]=s;var a=function(t,r,o){var s=e.asUint8Array(t);void 0===r&&(r=0),void 0===o&&(o=s.length);for(var a,c=n,u=i,l=o-c.length,h=c.length-1,f=r;f<=l;f+=a){a=0;for(var d=h;d>=0;d--){var p=s[f+d];if(c[d]!==p){a=Math.max(1,d-u[p]);break}}if(0===a)return f}return-1};return a.byteLength=n.byteLength,a}}])&&A(e.prototype,n),t}();function O(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function F(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function P(t,e,n){return e&&F(t.prototype,e),n&&F(t,n),t}var N=function(){function t(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/Math.sqrt(2),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;O(this,t);var s=["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"];if(s.indexOf(e)<0)return console.error("Valid types: 'lowpass','highpass','bandpass','notch','peak','lowshelf','highshelf'"),!1;this.type=e,this.freq=n,this.sps=r,this.Q=i,this.dbGain=o,this.a0=0,this.a1=0,this.a2=0,this.b0=0,this.b1=0,this.b2=0,this.x1=0,this.x2=0,this.y1=0,this.y2=0;var a=Math.pow(10,o/40),c=2*Math.PI*n/r,u=Math.sin(c),l=Math.cos(c),h=u/(2*i),f=Math.sqrt(a+a);this[e](a,u,l,h,f),this.b0/=this.a0,this.b1/=this.a0,this.b2/=this.a0,this.a1/=this.a0,this.a2/=this.a0}return P(t,[{key:"lowpass",value:function(t,e,n,r,i){this.b0=.5*(1-n),this.b1=1-n,this.b2=.5*(1-n),this.a0=1+r,this.a1=-2*n,this.a2=1-r}},{key:"highpass",value:function(t,e,n,r,i){this.b0=.5*(1+n),this.b1=-(1+n),this.b2=.5*(1+n),this.a0=1+r,this.a1=-2*n,this.a2=1-r}},{key:"bandpass",value:function(t,e,n,r,i){this.b0=r,this.b1=0,this.b2=-r,this.a0=1+r,this.a1=-2*n,this.a2=1-r}},{key:"notch",value:function(t,e,n,r,i){this.b0=1,this.b1=-2*n,this.b2=1,this.a0=1+r,this.a1=-2*n,this.a2=1-r}},{key:"peak",value:function(t,e,n,r,i){this.b0=1+r*t,this.b1=-2*n,this.b2=1-r*t,this.a0=1+r/t,this.a1=-2*n,this.a2=1-r/t}},{key:"lowshelf",value:function(t,e,n,r,i){this.b0=t*(t+1-(t-1)*n+i*e),this.b1=2*t*(t-1-(t+1)*n),this.b2=t*(t+1-(t-1)*n-i*e),this.a0=t+1+(t+1)*n+i*e,this.a1=2*(t-1+(t+1)*n),this.a2=t+1+(t-1)*n-i*e}},{key:"highshelf",value:function(t,e,n,r,i){this.b0=t*(t+1+(t-1)*n+i*e),this.b1=2*t*(t-1+(t+1)*n),this.b2=t*(t+1-(t-1)*n-i*e),this.a0=t+1-(t+1)*n-i*e,this.a1=2*(t-1-(t+1)*n),this.a2=t+1-(t-1)*n-i*e}},{key:"applyFilter",value:function(t){var e=this.b0*t+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;return this.x2=this.x1,this.x1=t,this.y2=this.y1,this.y1=e,e}},{key:"zResult",value:function(t){try{var e=Math.pow(Math.sin(Math.PI*t*2/(2*this.sps)),2);return(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*e+16*this.b0*this.b2*e*e)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*e+16*this.a2*e*e)}catch(t){return-200}}}],[{key:"calcCenterFrequency",value:function(t,e){return(t+e)/2}},{key:"calcBandwidth",value:function(t,e){return e-this.calcCenterFrequency(t,e)}},{key:"calcBandpassQ",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.pow(10,Math.floor(Math.log10(t))),r=n*Math.sqrt((t-e)*(t+e))/(2*e);return r}},{key:"calcNotchQ",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.pow(10,Math.floor(Math.log10(t))),r=n*t*e/Math.sqrt((t-e)*(t+e));return r}}]),t}(),D=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.995;O(this,t),this.r=e,this.y1=this.y2=this.x1=this.x2=0}return P(t,[{key:"applyFilter",value:function(t){this.x2=this.x1,this.x1=t;var e=this.x1-this.x2+this.r*this.y1;return this.y2=this.y1,this.y1=e,e}}]),t}(),j=function(t,e,n){return new N("notch",t,e,N.calcNotchQ(t,n),0)},R=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.pow(10,Math.floor(Math.log10(N.calcCenterFrequency(t,e))));return new N("bandpass",N.calcCenterFrequency(t,e),n,N.calcBandpassQ(N.calcCenterFrequency(t,e),N.calcBandwidth(t,e),r),0)},B=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"A0",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;O(this,t),this.channel=e,this.idx=0,this.sps=n,this.filtering=r,this.bplower=3,this.bpupper=45,this.scalingFactor=i,this.useSMA4=!1,this.last4=[],this.useNotch50=!0,this.useNotch60=!0,this.useLp1=!1,this.useBp1=!1,this.useDCB=!0,this.useScaling=!1,this.notch50=[j(50,n,1),j(100,n,1)],this.notch60=[j(60,n,1),j(120,n,1)],this.lp1=[new N("lowpass",50,n),new N("lowpass",50,n),new N("lowpass",50,n),new N("lowpass",50,n)],this.bp1=[R(this.bplower,this.bpupper,n,9.75),R(this.bplower,this.bpupper,n,9.75),R(this.bplower,this.bpupper,n,9.75),R(this.bplower,this.bpupper,n,9.75)],this.dcb=new D(.995)}return P(t,[{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sps;this.notch50=j(50,t,1),this.notch60=j(60,t,1),this.lp1=[new N("lowpass",50,t),new N("lowpass",50,t),new N("lowpass",50,t),new N("lowpass",50,t)],this.bp1=[R(this.bplower,this.bpupper,t,9.75),R(this.bplower,this.bpupper,t,9.75),R(this.bplower,this.bpupper,t,9.75),R(this.bplower,this.bpupper,t,9.75)],this.dcb=new D(.995)}},{key:"setBandpass",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.bplower,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.bpupper,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.sps;this.bplower=t,this.bpupper=e,this.bp1=[R(t,e,n),R(t,e,n),R(t,e,n),R(t,e,n)]}},{key:"apply",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastidx+1,n=t;return!0===this.filtering&&(!0===this.useDCB&&(n=this.dcb.applyFilter(n)),!0===this.useSMA4&&(e<4||(n=this.last4.reduce((function(t,e){return t+e}))/this.last4.length,this.last4.shift()),this.last4.push(n)),!0===this.useNotch50&&this.notch50.forEach((function(t,e){n=t.applyFilter(n)})),!0===this.useNotch60&&this.notch60.forEach((function(t,e){n=t.applyFilter(n)})),!0===this.useLp1&&this.lp1.forEach((function(t,e){n=t.applyFilter(n)})),!0===this.useBp1&&(this.bp1.forEach((function(t,e){n=t.applyFilter(n)})),n*=this.bp1.length),!0===this.useScaling&&(n*=this.scalingFactor)),this.lastidx=e,n}}]),t}();function z(t){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function M(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var V=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.templateStringGen,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(t){},c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NEVER";L(this,t),this.onchange=function(){arguments.length>0&&void 0!==arguments[0]||e.renderSettings.props},this.onRender=function(){arguments.length>0&&void 0!==arguments[0]||e.renderSettings.props},this.onRender=o,this.onchange=a,this.parentNode=r,"string"==typeof r&&(this.parentNode=document.getElementById(r)),this.renderSettings={templateStringGen:n,props:i},this.templateString="",this.templateString="function"==typeof n?n(i):n;var u=c;if(this.renderSettings.props==={}&&(u="NEVER"),this.node=null,this.listener=new s,Object.keys(this.renderSettings.props).length>0&&null!=u&&"NEVER"!==u){console.log("making listeners for ",n);var l=function(){e.updateNode()};this.listener.addListener("templateChange",this.renderSettings,"templateStringGen",l,u);var h=function(){e.updateNode(),e.onchange()};this.listener.addListener("props",this.renderSettings,"props",h,u)}this.renderNode()}var e,n;return e=t,(n=[{key:"appendFragment",value:function(t,e){var n=document.createElement("template");n.innerHTML=t;var r=n.content;return e.appendChild(r),e.children[e.children.length-1]}},{key:"deleteFragment",value:function(t,e){var n=document.getElementById(e);t.removeChild(n)}},{key:"removeParent",value:function(t){var e=document.getElementById(t);e.parentNode.parentNode.removeChild(e.parentNode)}},{key:"renderNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parentNode;this.node=this.appendFragment(this.templateString,t),this.onRender()}},{key:"updateNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parentNode,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.node,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.props;t.removeChild(e),"function"==typeof this.renderSettings.templateStringGen?this.templateString=this.renderSettings.templateStringGen(this.props):this.templateString=this.renderSettings.templateStringGen,this.renderNode(t,n)}},{key:"deleteNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.node;"string"==typeof t?(thisNode=document.getElementById(t),thisNode.parentNode.removeChild(thisNode),this.node=null):"object"===z(t)&&(t.parentNode.removeChild(t),this.node=null)}},{key:"appendStylesheet",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.node;if("string"==typeof t){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=t,e.insertAdjacentElement("afterbegin",n)}else if(Array.isArray(t))t.forEach((function(t){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=t,e.insertAdjacentElement("afterbegin",n)}));else if("function"==typeof t){var r=t();e.insertAdjacentHTML("afterbegin",r)}}}])&&M(e.prototype,n),t}();function G(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function U(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){G(o,r,i,s,a,"next",t)}function a(t){G(o,r,i,s,a,"throw",t)}s(void 0)}))}}function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Z(t){return function(t){if(Array.isArray(t))return W(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return W(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?W(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var H=function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"freeeeg32_2",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;Y(this,t),this.init=function(t,n){if(t.sps=512,t.deviceType="eeg","freeeeg32_2"===e.mode?t.eegChannelTags=[{ch:4,tag:"FP2",analyze:!0},{ch:24,tag:"FP1",analyze:!0},{ch:8,tag:"other",analyze:!1}]:"freeeeg32_19"===e.mode?t.eegChannelTags=[{ch:4,tag:"FP2",analyze:!0},{ch:24,tag:"FP1",analyze:!0},{ch:0,tag:"O2",analyze:!0},{ch:1,tag:"T6",analyze:!0},{ch:2,tag:"T4",analyze:!0},{ch:3,tag:"F8",analyze:!0},{ch:5,tag:"F4",analyze:!0},{ch:6,tag:"C4",analyze:!0},{ch:7,tag:"P4",analyze:!0},{ch:25,tag:"F3",analyze:!0},{ch:26,tag:"C3",analyze:!0},{ch:27,tag:"P3",analyze:!0},{ch:28,tag:"O1",analyze:!0},{ch:29,tag:"T5",analyze:!0},{ch:30,tag:"T3",analyze:!0},{ch:31,tag:"F7",analyze:!0},{ch:16,tag:"FZ",analyze:!0},{ch:12,tag:"PZ",analyze:!0},{ch:8,tag:"other",analyze:!1}]:t.eegChannelTags=[{ch:4,tag:"FP2",analyze:!0},{ch:24,tag:"FP1",analyze:!0},{ch:8,tag:"other",analyze:!1}],e.device=new I((function(n){e.atlas.data.eegshared.eegChannelTags.forEach((function(r,i){var o,s,a,c,u=e.device.getLatestData("A"+r.ch,n),l=new Array(u.length).fill(0);if("other"!==r.tag&&!0===t.useFilters)e.filters.forEach((function(t,e){t.channel===r.ch&&u.forEach((function(e,n){l[n]=t.apply(e)}))})),!0===t.useAtlas&&((c=null!==r.tag?e.atlas.getEEGDataByTag(r.tag):e.atlas.getEEGDataByChannel(r.ch)).count+=n,(o=c.times).push.apply(o,Z(e.device.data.ms.slice(e.device.data.count-n,e.device.data.count))),(s=c.filtered).push.apply(s,Z(l)),(a=c.raw).push.apply(a,Z(u)));else if(!0===t.useAtlas){var h,f,d=e.atlas.getEEGDataByChannel(r.ch);d.count+=n,(h=d.times).push.apply(h,Z(e.device.data.ms.slice(e.device.data.count-n,e.device.data.count))),(f=d.raw).push.apply(f,Z(u))}}))}),(function(){!0===t.useAtlas&&(e.atlas.data.eegshared.startTime=Date.now(),!0!==e.atlas.settings.analyzing&&t.analysis.length>0&&(e.atlas.settings.analyzing=!0,e.atlas.settings.deviceConnected=!0,setTimeout((function(){e.atlas.analyzer()}),1200)),e.onconnect())}),(function(){e.atlas.settings.analyzing=!1,e.ondisconnect()})),!0===t.useFilters&&t.eegChannelTags.forEach((function(n,r){"other"!==n.tag?e.filters.push(new B(n.ch,t.sps,!0,e.device.uVperStep)):e.filters.push(new B(n.ch,t.sps,!1,e.device.uVperStep)),e.filters[e.filters.length-1].useScaling=!0})),!0===n)e.atlas=new x(location+":"+e.mode,{eegshared:{eegChannelTags:t.eegChannelTags,sps:t.sps}},"10_20",!0,!0,t.analysis),t.useAtlas=!0;else if("object"===q(n)){var r;e.atlas=n,e.atlas.data.eegshared.eegChannelTags=t.eegChannelTags,e.atlas.data.eegshared.sps=t.sps,e.atlas.data.eegshared.frequencies=e.atlas.bandpassWindow(0,128,.5*t.sps),e.atlas.data.eegshared.bandFreqs=e.atlas.getBandFreqs(e.atlas.data.eegshared.frequencies),e.atlas.data.eeg=e.atlas.gen10_20Atlas(),e.atlas.data.coherence=e.atlas.genCoherenceMap(t.eegChannelTags),e.atlas.data.eegshared.eegChannelTags.forEach((function(t,n){void 0===e.atlas.getEEGDataByTag(t.tag)&&e.atlas.addEEGCoord(t.ch)})),e.atlas.settings.coherence=!0,e.atlas.settings.eeg=!0,t.useAtlas=!0,t.analysis.length>0&&((r=e.atlas.settings.analysis).push.apply(r,Z(t.analysis)),e.atlas.settings.analyzing||(e.atlas.settings.analyzing=!0,e.atlas.analyzer()))}},this.connect=U(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.device.setupSerialAsync();case 2:e.setIndicator(!0);case 3:case"end":return t.stop()}}),t)}))),this.disconnect=function(){e.device.closePort(),e.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){arguments.length>0&&void 0!==arguments[0]||document.body,Math.floor(1e4*Math.random())},this.atlas=null,this.mode=n,this.device=null,this.filters=[],this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.border="1px solid white")}},K=n(5856);function J(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function Q(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){J(o,r,i,s,a,"next",t)}function a(t){J(o,r,i,s,a,"throw",t)}s(void 0)}))}}function $(t){return function(t){if(Array.isArray(t))return X(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function tt(t){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function et(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var nt=function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;et(this,t),this.init=function(t,e){if(t.sps=256,t.deviceType="eeg",t.eegChannelTags=[{ch:0,tag:"TP9",analyze:!0},{ch:1,tag:"AF7",analyze:!0},{ch:2,tag:"AF8",analyze:!0},{ch:3,tag:"TP10",analyze:!0}],n.device=new K.MuseClient,!0===t.useFilters&&t.eegChannelTags.forEach((function(e,r){"other"!==e.tag?n.filters.push(new B(e.ch,t.sps,!0,1)):n.filters.push(new B(e.ch,t.sps,!1,1))})),!0===e)n.atlas=new x(location+":"+n.mode,{eegshared:{eegChannelTags:t.eegChannelTags,sps:t.sps}},"muse",!0,!0,t.analysis),t.useAtlas=!0;else if("object"===tt(e)){var r;n.atlas=e,n.atlas.data.eegshared.eegChannelTags=t.eegChannelTags,n.atlas.data.eegshared.sps=t.sps,n.atlas.data.eegshared.frequencies=n.atlas.bandpassWindow(0,128,.5*t.sps),n.atlas.data.eegshared.bandFreqs=n.atlas.getBandFreqs(n.atlas.data.eegshared.frequencies),n.atlas.data.eeg=n.atlas.genMuseAtlas(),n.atlas.data.coherence=n.atlas.genCoherenceMap(t.eegChannelTags),n.atlas.settings.coherence=!0,n.atlas.settings.eeg=!0,t.useAtlas=!0,t.analysis.length>0&&((r=n.atlas.settings.analysis).push.apply(r,$(t.analysis)),n.atlas.settings.analyzing||(n.atlas.settings.analyzing=!0,n.atlas.analyzer()))}n.info=t},this.connect=Q(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.device.connect();case 2:return t.next=4,n.device.start();case 4:n.device.eegReadings.subscribe((function(t){if(n.info.useAtlas){var e,r,i=Array(t.samples.length).fill(t.timestamp);i=i.map((function(t,e){return t-(1-n.info.sps/i.length*e/10)}));var o=n.atlas.getEEGDataByChannel(t.electrode);if((e=o.times).push.apply(e,$(i)),(r=o.raw).push.apply(r,$(t.samples)),o.count+=t.samples.length,!0===n.info.useFilters){var s,a=new Array(t.samples.length).fill(0);void 0!==n.filters[t.electrode]&&t.samples.forEach((function(e,r){a[r]=n.filters[t.electrode].apply(e)})),(s=o.filtered).push.apply(s,$(a))}}})),n.atlas.data.eegshared.startTime=Date.now(),n.atlas.settings.deviceConnected=!0,!0!==n.atlas.settings.analyzing&&n.info.analysis.length>0&&(n.atlas.settings.analyzing=!0,setTimeout((function(){n.atlas.analyzer()}),1200)),n.device.gatt.device.addEventListener("gattserverdisconnected",(function(){n.atlas.analyzing=!1,n.atlas.settings.deviceConnected=!1,n.ondisconnect()})),n.onconnect(),n.setIndicator(!0);case 11:case"end":return t.stop()}}),t)}))),this.disconnect=function(){n.device.disconnect(),n.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,e=(Math.floor(1e4*Math.random()),function(){return"\n            "}),r=function(){};n.ui=new V(e,t,void 0,r)},this.atlas=null,this.mode=e,this.device=null,this.filters=[],this.info,this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="1px solid white")}};function rt(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function it(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){rt(o,r,i,s,a,"next",t)}function a(t){rt(o,r,i,s,a,"throw",t)}s(void 0)}))}}function ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function st(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function at(t,e,n){return e&&st(t.prototype,e),n&&st(t,n),t}var ct=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"usb",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"http://192.168.4.1/";ot(this,t),this.interface=null,this.mode=e,"usb"===e||"serial"===e?this.setupSerialDevice(n,r,i):"ble"===e||"bt"===e?this.setupBLEDevice(n,r,i):"wifi"!==e&&"events"!==e&&"sse"!==e||this.setupSSEDevice(o,n,r,i)}return at(t,[{key:"setupSerialDevice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.interface=new ft,this.interface.onConnectedCallback=e,this.interface.onReadLine=t,this.interface.onDisconnectedCallback=n}},{key:"setupBLEDevice",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.interface=new ut,this.interface.onConnectedCallback=n,this.interface.onDisconnectedCallback=r,this.interface.onNotificationCallback=function(n){var r=t.interface.decoder.decode(n.target.value);e(r)}}},{key:"setupSSEDevice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http://192.168.4.1/",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=function(t){e(t.data)};this.interface=new ht(t+"events",n,r,void 0,[{tag:"heg",callback:i}]),this.interface.newPostFunction("sendCommand",t+"command")}},{key:"sendCommand",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";"usb"===this.mode||"serial"===this.mode||"ble"===this.mode||"bt"===this.mode?this.interface.sendMessage(t):"wifi"!==this.mode&&"events"!==this.mode&&"sse"!==this.mode||this.interface.sendCommand(t)}},{key:"connect",value:function(t){"usb"===this.mode||"serial"===this.mode?navigator.serial?this.interface.setupSerialAsync():chrome.serial?this.interface.connectSelected(!0,t):(console.error("ERROR: Cannot locate navigator.serial. Enable #experimental-web-platform-features in chrome://flags"),alert("Serial support not found. Enable #experimental-web-platform-features in chrome://flags or use a chrome extension")):"ble"===this.mode||"bt"===this.mode?this.interface.connect():"wifi"!==this.mode&&"events"!==this.mode&&"sse"!==this.mode||this.interface.open()}},{key:"disconnect",value:function(){"usb"===this.mode||"serial"===this.mode?navigator.serial?this.interface.closePort():this.interface.connectSelected(!1):"ble"===this.mode||"bt"===this.mode?this.interface.disconnect():"wifi"!==this.mode&&"events"!==this.mode&&"sse"!==this.mode||this.interface.close()}}]),t}(),ut=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"6e400002-b5a3-f393-e0a9-e50e24dcca9e",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"6e400003-b5a3-f393-e0a9-e50e24dcca9e",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"main_body",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"blebutton",a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];ot(this,t),lt.call(this),this.serviceUUID=e,this.rxUUID=n,this.txUUID=r,this.encoder=new TextEncoder("utf-8"),this.decoder=new TextDecoder("utf-8"),this.device=null,this.server=null,this.service=null,this.rxchar=null,this.txchar=null,this.parentId=o,this.buttonId=s,this.async=a,this.android=navigator.userAgent.toLowerCase().indexOf("android")>-1,this.n,!0===i&&this.initUI(o,s)}var e,n,r;return at(t,[{key:"initUI",value:function(t,e){var n=this;null!==this.device&&this.device.gatt.connected&&(this.device.gatt.disconnect(),console.log("device disconnected"));var r='<button id="'+e+'">BLE Connect</button>';HEGwebAPI.appendFragment(r,t),document.getElementById(e).onclick=function(){!1===n.async?n.connect():n.initBLEasync()}}},{key:"connectAsync",value:(r=it(regeneratorRuntime.mark((function t(){var e,n,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.bluetooth.requestDevice({filters:[{namePrefix:"HEG"}],optionalServices:[this.serviceUUID]});case 2:return this.device=t.sent,console.log("BLE Device: ",this.device),t.next=6,null===(e=this.device.gatt)||void 0===e?void 0:e.connect();case 6:if(n=t.sent){t.next=9;break}throw"no connection";case 9:return this.device.addEventListener("gattserverdisconnected",onDisconnected),this.server=n,t.next=13,this.server.getPrimaryService(this.serviceUUID);case 13:return r=t.sent,t.next=16,r.getCharacteristic(this.rxUUID);case 16:return i=t.sent,t.next=19,i.writeValue(this.encoder.encode("t"));case 19:if(1!=this.android){t.next=22;break}return t.next=22,i.writeValue(this.encoder.encode("o"));case 22:return t.next=24,r.getCharacteristic(this.txUUID);case 24:return this.characteristic=t.sent,this.onConnectedCallback(),t.abrupt("return",!0);case 27:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"readDeviceAsync",value:(n=it(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.characteristic){t.next=3;break}throw console.log("HEG not connected"),"error";case 3:this.doReadHeg=!0,e="";case 5:if(!this.doReadHeg){t.next=14;break}return t.t0=this.decoder,t.next=9,this.characteristic.readValue();case 9:t.t1=t.sent,(n=t.t0.decode.call(t.t0,t.t1))!==this.data&&(e=n,console.log(e),this.n+=1,this.onReadAsyncCallback(e)),t.next=5;break;case 14:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"initBLEasync",value:(e=it(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.connectAsync();case 2:this.readDeviceasync(),this.spsinterval();case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),t}(),lt=function(){var t=this;this.connect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.serviceUUID,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.rxUUID,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.txUUID;function i(t){return function(e){return new Promise((function(n){return setTimeout((function(){return n(e)}),t)}))}}navigator.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:[e]}).then((function(e){return t.device=e,e.gatt.connect()})).then(i(100)).then((function(t){return t.getPrimaryService(e)})).then(i(100)).then((function(e){return t.service=e,e.getCharacteristic(n).then(i(100)).then((function(e){return t.rxchar=e,e.writeValue(t.encoder.encode("t"))})),1==t.android&&e.getCharacteristic(n).then(i(1e3)).then((function(e){return e.writeValue(t.encoder.encode("o"))})),e.getCharacteristic(r)})).then(i(1100)).then((function(e){return t.txchar=e,e.startNotifications()})).then(i(100)).then((function(e){e.addEventListener("characteristicvaluechanged",t.onNotificationCallback)})).then(i(100)).then(t.onConnectedCallback()).catch((function(e){console.error(e),t.onErrorCallback(e)}))},this.onNotificationCallback=function(e){var n=t.decoder.decode(e.target.value);console.log("BLE MSG: ",n)},this.onConnectedCallback=function(){},this.sendMessage=function(e){t.rxchar.writeValue(t.encoder.encode(e))},this.disconnect=function(){var e;null===(e=t.server)||void 0===e||e.disconnect(),t.onDisconnectedCallback()},this.onDisconnectedCallback=function(){console.log("BLE device disconnected!")},this.onReadAsyncCallback=function(t){console.log("BLE Data: ",t)},this.stopReadAsync=function(){t.doReadHeg=!1,tx.writeValue(t.encoder.encode("f"))},this.spsinterval=function(){setTimeout((function(){console.log("SPS",t.n+""),t.n=0,t.spsinterval()}),1e3)}},ht=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http://192.168.4.1/events",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onOpen,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onError,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.onMsg,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];ot(this,t),this.onOpen=function(t){console.log("Events Connected!",t.data)},this.onError=function(t){console.log("event source error:",t.data),t.target.readyState!==EventSource.OPEN&&console.log("Events Disconnected")},this.onMsg=function(t){console.log("event source:",t.data)},this.open=function(){e.createEventListeners()},this.close=function(){e.removeEventListeners()},this.hostUrl=n,this.onOpen=r,this.onError=i,this.onMsg=o,this.source=null,this.customCallbacks=s,this.createEventListeners(n,custom)}return at(t,[{key:"createEventListeners",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.hostUrl,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.customCallbacks,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.source;null!==n&&this.removeEventListeners(e,n),window.EventSource&&((n=new EventSource(t)).addEventListener("open",this.onOpen,!1),n.addEventListener("error",this.onError,!1),n.addEventListener("message",this.onMsg,!1),e.length>0&&e.forEach((function(t,e){n.addEventListener(t.tag,t.callback,!1)})))}},{key:"removeEventListeners",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.custom,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.source;window.EventSource&&(e.close(),e.removeEventListener("open",this.openEvent,!1),e.removeEventListener("error",this.errorEvent,!1),e.removeEventListener("message",this.messageEvent,!1),t.length>0&&t.forEach((function(t,n){e.removeEventListener(t.tag,t.callback,!1)})),e=null)}},{key:"newPostFunction",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"post",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.hostUrl,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,o=function(){var t=new XMLHttpRequest;t.open("POST",e,!0,r,i),t.send(n),t.onerror=function(){t.abort()}};return this[t]=o,o}}]),t}(),ft=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"serialmenu";ot(this,t),this.onGetDevices=function(t){document.getElementById("serialports").innerHTML="";for(var n=[],r=0;r<t.length;r++)console.log(t[r].path);t.forEach((function(t){var r=t.displayName+"("+t.path+")";if(console.log("displayName "+r),r||(r=t.path),n.push({option:r,value:t.path}),console.log(e.defaultUI),1==e.defaultUI){var i=document.createElement("option");i.text=r,i.value=t.path,console.log("option",i),document.getElementById("serialports").appendChild(i)}})),e.displayPorts=n},this.onReceive=function(t){if(t.connectionId===e.connectionId){var n,r=new Uint8Array(t.data),i=String.fromCharCode.apply(null,r);for(e.encodedBuffer+=decodeURIComponent(escape(i)),console.log(e.encodedBuffer.length);(n=e.encodedBuffer.indexOf("\n"))>=0;){var o=e.encodedBuffer.substr(0,n+1);1==e.recordData&&e.recorded.push(o),(e.monitoring=!0)&&(e.newSamples++,e.monitorData.push(o)),e.onReadLine(o),e.encodedBuffer=e.encodedBuffer.substr(n+1)}}else console.log("ERR: Receive ID:",t.connectionId)},this.onConnectComplete=function(t){e.connectionId=t.connectionId,console.log("Connected! ID:",e.connectionId),chrome.serial.onReceive.addListener(e.onReceive),chrome.serial.onReceiveError.addListener(e.onReceiveError),e.onConnectedCallback()},this.displayPorts=[],this.defaultUI=n,this.encodedBuffer="",this.connectionId=-1,this.recordData=!1,this.recorded=[],this.port=null,this.decoder=null,this.subscribed=!1,this.reader=null,this.writer=null,this.monitoring=!1,this.newSamples=0,this.monitorSamples=1e4,this.monitorData=[],this.monitorIdx=0,chrome.serial?(!0===n&&this.setupSelect(r,!1),this.setupSerial()):navigator.serial?(this.decoder=new TextDecoder,!0===n&&this.setupSelect(r,!0)):(console.log("ERROR: Cannot locate navigator.serial. Enable #experimental-web-platform-features in chrome://flags"),alert("Serial support not found. Enable #experimental-web-platform-features in chrome://flags or use a chrome extension"))}var e,n,r,i,o;return at(t,[{key:"setupSelect",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(chrome.serial){var r=document.createElement("select");r.setAttribute("id","serialports"),(i=document.createDocumentFragment()).appendChild(r),document.getElementById(t).innerHTML='<button id="refreshSerial">Get</button><button id="connectSerial">Set</button>',document.getElementById(t).appendChild(i),document.getElementById("connectSerial").onclick=function(){n?e.setupSerialAsync():(-1!==e.connectionId&&e.connectSelected(!1),e.connectSelected(!0,document.getElementById("serialports").value))}}else if(navigator.serial){var i=document.createDocumentFragment();document.getElementById(t).innerHTML='<button id="refreshSerial">Set USB Device</button>',document.getElementById(t).appendChild(i)}document.getElementById("refreshSerial").onclick=function(){n?e.setupSerialAsync():e.setupSerial()}}},{key:"setupMonitor",value:function(t){var e=this;this.monitorData.length>this.monitorSamples&&this.monitorData.splice(0,this.monitorData.length-this.monitorSamples);var n=document.createElement("div");n.setAttribute("id","streamMonitor"),this.monitorData.forEach((function(t,r){n.innerHTML+="<div id="+e.monitorIdx+">"+t+"</div>",e.monitorIdx++})),this.newSamples=0;var r=document.createDocumentFragment();r.appendChild(n),document.getElementById(t).appendChild(r),requestAnimationFrame((function n(){if(e.newSamples>0){if(e.monitorData.length>e.monitorSamples){for(var r=e.monitorIdx-e.monitorSamples-(e.monitorData.length-e.monitorSamples);r>e.monitorIdx-e.monitorSamples;r++)document.getElementById(r).remove();e.monitorData.splice(0,e.monitorData.length-e.monitorSamples)}for(r=0;r<newSamples;r++){var i=document.createElement("div");i.innerHTML='<div id="'+e.monitorIdx+'">'+e.monitorData[e.monitorData.length-1-r]+"</div>";var o=document.createDocumentFragment();o.appendChild(i),document.getElementById(t).appendChild(o),e.monitorIdx++;var s=document.getElementById("streamMonitor");s.scrollTop=s.scrollHeight}setTimeout(requestAnimationFrame(n),15)}}))}},{key:"onReceiveError",value:function(t){console.log("onReceiveError"),t.connectionId===this.connectionId&&(console.log("Error from ID:",t.connectionId),this.onError.dispatch(t.error),console.log("Error: "+t.error))}},{key:"onConnectedCallback",value:function(){console.log("USB device Ready!")}},{key:"onDisconnectedCallback",value:function(){console.log("USB device disconnected!")}},{key:"sendMessage",value:function(t){t+="\n";for(var e=unescape(encodeURIComponent(t)),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);chrome.serial?this.connectionId>-1?(chrome.serial.send(this.connectionId,n.buffer,this.onSendCallback),console.log("Send message:",t)):console.log("Device is disconnected!"):navigator.serial&&this.port.writable&&this.sendMessageAsync(n.buffer)}},{key:"onSendCallback",value:function(t){console.log("sendInfo",t)}},{key:"onReadLine",value:function(t){console.log(t)}},{key:"connectSelected",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(1==t&&""!==e)console.log("Connecting",e),chrome.serial.connect(e,{bitrate:115200},this.onConnectComplete);else{if(console.log("Disconnect"+e),this.connectionId<0)return void console.log("connectionId",this.connectionId);this.encodedBuffer="",chrome.serial.onReceive.removeListener(this.onReceive),chrome.serial.onReceiveError.removeListener(this.onReceiveError),chrome.serial.flush(this.connectionId,(function(){console.log("chrome.serial.flush",this.connectionId)})),chrome.serial.disconnect(this.connectionId,(function(){console.log("chrome.serial.disconnect",this.connectionId)}))}}},{key:"setupSerial",value:function(){chrome.serial.getDevices(this.onGetDevices)}},{key:"sendMessageAsync",value:(o=it(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.port.writable.getWriter(),t.next=3,n.write(e);case 3:n.releaseLock();case 4:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"onPortSelected",value:(i=it(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.open({baudRate:115200,bufferSize:1e3});case 3:t.next=9;break;case 5:return t.prev=5,t.t0=t.catch(0),t.next=9,e.open({baudrate:115200,buffersize:1e3});case 9:this.onConnectedCallback(),this.subscribed=!0,this.subscribe(e);case 12:case"end":return t.stop()}}),t,this,[[0,5]])}))),function(t){return i.apply(this,arguments)})},{key:"onReceiveAsync",value:function(t){var e;for(this.encodedBuffer+=this.decoder.decode(t);(e=this.encodedBuffer.indexOf("\n"))>=0;){var n=this.encodedBuffer.substr(0,e+1);1==this.recordData&&this.recorded.push(n),(this.monitoring=!0)&&(this.newSamples++,this.monitorData.push(n)),this.onReadLine(n),this.encodedBuffer=this.encodedBuffer.substr(e+1)}}},{key:"subscribe",value:(r=it(regeneratorRuntime.mark((function t(e){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.port.readable&&!0===this.subscribed&&(this.reader=e.readable.getReader(),(n=function(){var t=it(regeneratorRuntime.mark((function t(){var i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.reader.read();case 3:if(i=t.sent,o=i.value,!i.done&&!1!==r.subscribed){t.next=9;break}return t.next=9,r.reader.releaseLock();case 9:if(o)try{r.onReceiveAsync(o),!0===r.subscribed&&setTimeout((function(){n()}),30)}catch(t){console.log(t)}t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.log(t.t0),t.t0.message.includes("framing")||t.t0.message.includes("overflow")||t.t0.message.includes("Overflow")||t.t0.message.includes("break")?(r.subscribed=!1,setTimeout(it(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.reader){t.next=4;break}return t.next=3,r.reader.releaseLock();case 3:r.reader=null;case 4:r.subscribed=!0,r.subscribe(e);case 6:case"end":return t.stop()}}),t)}))),30)):t.t0.message.includes("parity")||t.t0.message.includes("Parity")?(r.closePort(),setTimeout((function(){r.onPortSelected(r.port)}),100)):r.closePort();case 16:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(){return t.apply(this,arguments)}}())());case 1:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"closePort",value:(n=it(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=r.length>0&&void 0!==r[0]?r[0]:this.port,this.port&&(this.subscribed=!1,setTimeout(it(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.reader){t.next=4;break}return t.next=3,n.reader.releaseLock();case 3:n.reader=null;case 4:return t.next=6,e.close();case 6:n.connected=!1,n.onDisconnectedCallback();case 8:case"end":return t.stop()}}),t)}))),50));case 2:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"setupSerialAsync",value:(e=it(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,navigator.serial.requestPort();case 3:this.port=t.sent,navigator.serial.addEventListener("disconnect",(function(t){e.closePort()})),this.onPortSelected(this.port);case 6:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"saveCsv",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.recorded,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).toISOString(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"|",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Header\n",i=r;t.forEach((function(t){i+=t.split(n).join(",")+"\n"}));var o=document.createElement("a");o.href="data:text/csv;charset=utf-8,"+encodeURI(i),o.target="_blank",o.download=""!==e?e+".csv":(new Date).toISOString()+".csv",o.click()}},{key:"openFile",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:",",n=document.createElement("input");n.type="file",n.onchange=function(r){t.csvDat=[];var i=r.target.files[0],o=new FileReader;o.readAsText(i),o.onload=function(n){var r=n.target.result.split("\n");r.pop(),r.forEach((function(n,r){if(0==r)var i=n.split(e);else i=n.split(e),t.csvDat.push(i)})),t.onOpen()},n.value=""},n.click()}},{key:"onOpen",value:function(){alert("CSV Opened!")}}]),t}();function dt(t){return function(t){if(Array.isArray(t))return pt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return pt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function vt(t){return(vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var bt=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hegduinousb",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;gt(this,t),this.init=function(t,n){t.sps=32,t.deviceType="heg";var r=function(n){if(n.indexOf("|")>-1){var r=n.split("|");if(r.length>3){var i=e.atlas.data.heg[t.deviceNum];i.count++,1===i.count&&(i.startTime=Date.now()),"ble"===e.device.mode&&!0===e.device.interface.android?(i.times.push(Date.now()),i.red.push(parseFloat(r[0])),i.ir.push(parseFloat(r[1])),i.ratio.push(parseFloat(r[2]))):(i.times.push(Date.now()),i.red.push(parseFloat(r[1])),i.ir.push(parseFloat(r[2])),i.ratio.push(parseFloat(r[3])),i.ambient.push(parseFloat(r[4]))),e.atlas.beatDetection(i,t.sps)}}else console.log("HEGDUINO: ",n)};if("hegduinowifi"===e.mode||"hegduinosse"===e.mode?(t.sps=20,e.device=new ct("wifi",r,(function(){!0!==e.atlas.settings.analyzing&&t.analysis.length>0&&(e.atlas.settings.analyzing=!0,setTimeout((function(){e.atlas.analyzer()}),1200)),e.atlas.settings.deviceConnected=!0,e.onconnect()}),(function(){e.atlas.settings.analyzing=!1,e.atlas.settings.deviceConnected=!1,e.ondisconnect()}))):"hegduinobt"===e.mode||"hegduinoble"===e.mode?e.device=new ct("ble",r,(function(){!0!==e.atlas.settings.analyzing&&t.analysis.length>0&&(e.atlas.settings.analyzing=!0,setTimeout((function(){e.atlas.analyzer()}),1200)),e.atlas.settings.deviceConnected=!0,e.onconnect()}),(function(){e.atlas.settings.analyzing=!1,e.atlas.settings.deviceConnected=!1,e.ondisconnect()})):"hegduinoserial"!==e.mode&&"hegduinousb"!==e.mode||(e.device=new ct("usb",r,(function(){!0!==e.atlas.settings.analyzing&&t.analysis.length>0&&(e.atlas.settings.analyzing=!0,setTimeout((function(){e.atlas.analyzer()}),1200)),e.atlas.settings.deviceConnected=!0,e.onconnect()}),(function(){e.atlas.settings.analyzing=!1,e.atlas.settings.deviceConnected=!1,e.ondisconnect()}))),!0===n)e.atlas=new x(location+":"+e.mode,{hegshared:{sps:t.sps}},"hegduino",!1,!0,t.analysis),t.deviceNum=e.atlas.data.heg.length-1,t.useAtlas=!0;else if("object"===vt(n)){var i;e.atlas=n,t.deviceNum=e.atlas.data.heg.length,e.atlas.data.hegshared={sps:t.sps},e.atlas.addHEGCoord(e.atlas.data.heg.length),e.atlas.settings.heg=!0,t.useAtlas=!0,t.analysis.length>0&&((i=e.atlas.settings.analysis).push.apply(i,dt(t.analysis)),e.atlas.settings.analyzing||(e.atlas.settings.analyzing=!0,e.atlas.analyzer()))}},this.connect=function(){e.device.connect(),e.setIndicator(!0)},this.disconnect=function(){e.device.disconnect(),e.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,n=Math.floor(1e4*Math.random()),r=function(){return"\n            <div id='"+n+"hegduinoControls'>\n                <button id='"+n+"hegon'>On</button>\n                <button id='"+n+"hegoff'>Off</button>\n                <input id='"+n+"hegcmd' type='text' placeholder='R'></input><button id='"+n+"sendcmd'>Send</button>\n            </div>\n            "},i=function(){document.getElementById(n+"hegon").onclick=function(){e.device.sendCommand("t")},document.getElementById(n+"hegoff").onclick=function(){e.device.sendCommand("f")},document.getElementById(n+"sendcmd").onclick=function(){e.device.sendCommand(elm(n+"hegcmd").value)}};e.ui=new V(r,t,void 0,i)},this.atlas=null,this.mode=n,this.device=null,this.filters=[],this.ui=null,this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.border="1px solid white")}}var e,n;return e=t,(n=[{key:"mean",value:function(t){return t.reduce((function(t,e){return e+t}))/t.length}}])&&yt(e.prototype,n),t}();function mt(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function wt(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){mt(o,r,i,s,a,"next",t)}function a(t){mt(o,r,i,s,a,"throw",t)}s(void 0)}))}}function xt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function St(t){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Tt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.onDecodedCallback,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onConnectedCallback,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onDisconnectedCallback,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"daisy",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.decode,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:115200;_t(this,t),this.onDecodedCallback=e,this.onConnectedCallback=n,this.onDisconnectedCallback=r,this.decode=o,this.connected=!1,this.subscribed=!1,this.buffer=[],this.startByte=160,this.stopByte=192,this.searchString=new Uint8Array([this.stopByte,this.startByte]),this.readRate=16.666667,this.readBufferSize=2e3,this.sps=250,this.nChannels=16,this.nPeripheralChannels=6,this.updateMs=1e3/this.sps,this.stepSize=1/(Math.pow(2,23)-1),this.vref=4.5,this.gain=24,this.vscale=this.vref/this.gain*this.stepSize,this.uVperStep=this.vref/this.gain*this.stepSize*1e6,this.scalar=1/(1e6/(this.vref/this.gain*this.stepSize)),this.maxBufferedSamples=60*this.sps*1,this.mode=i,this.data={count:0,startms:0,ms:[],A0:[],A1:[],A2:[],A3:[],A4:[],A5:[],A6:[],A7:[],A8:[],A9:[],A10:[],A11:[],A12:[],A13:[],A14:[],A15:[],Ax:[],Ay:[],Az:[],Gx:[],Gy:[],Gz:[]},this.resetDataBuffers(),navigator.serial||console.error("`navigator.serial not found! Enable #enable-experimental-web-platform-features in chrome://flags (search 'experimental')"),this.port=null,this.reader=null,this.baudrate=s}var e,n,r,i,o,s,a,c;return e=t,(n=[{key:"resetDataBuffers",value:function(){for(var t in this.data.count=0,this.data.startms=0,this.data)"object"===St(this.data[t])&&(this.data[t]=new Array(this.maxBufferedSamples).fill(0))}},{key:"setScalar",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/(Math.pow(2,23)-1),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4.5;this.stepSize=e,this.vref=n,this.gain=t,this.vscale=this.vref/this.gain*this.stepSize,this.uVperStep=this.vref/this.gain*this.stepSize*1e6,this.scalar=1/(1e6/(this.vref/this.gain*this.stepSize))}},{key:"getLatestData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"A0",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e;return n<=1?[this.data[t][this.data.count-1]]:(n>this.data.count&&(n=this.data.count),this.data[t].slice(this.data.count-n,this.data.count))}},{key:"bytesToInt16",value:function(t,e){var n=(255&t)<<8|255&e;return(8388608&n)>0?n|=4294901760:n&=65535,n}},{key:"int16ToBytes",value:function(t){return[255&t,t>>8&255]}},{key:"bytesToInt24",value:function(t,e,n){var r=(255&t)<<16|(255&e)<<8|255&n;return(8388608&r)>0?r|=4278190080:r&=16777215,r}},{key:"int24ToBytes",value:function(t){return[255&t,t>>8&255,t>>16&255]}},{key:"decode",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.buffer,e=this.searchString,n=t,r=this.boyerMoore(e),i=r.byteLength,o=[],s=0,a=r(n);-1!==a;a=r(n,a+i))o.push(a);if(o.length>=2){for(var c=1;c<o.length;c++)if(o[c]-o[c-1]==33){var u=t.slice(o[c-1],o[c]+1);for(this.data.count<this.maxBufferedSamples&&this.data.count++,this.data.count-1==0?(this.data.ms[this.data.count-1]=Date.now(),this.data.startms=this.data.ms[0]):(this.data.ms[this.data.count-1]=this.data.ms[this.data.count-2]+this.updateMs,this.data.count>=this.maxBufferedSamples&&(this.data.ms.splice(0,5120),this.data.ms.push(new Array(5120).fill(0)))),a=3;a<27;a+=3){var l=void 0;l="daisy"===this.mode?u[2]%2!=0?"A"+(a-3)/3:"A"+(8+(a-3)/3):"A"+(a-3)/3,this.data[l][this.data.count-1]=this.bytesToInt24(u[a],u[a+1],u[a+2]),this.data.count>=this.maxBufferedSamples&&(this.data[l].splice(0,5120),this.data[l].push(new Array(5120).fill(0)))}this.data.Ax[this.data.count-1]=this.bytesToInt16(u[27],u[28]),this.data.Ay[this.data.count-1]=this.bytesToInt16(u[29],u[30]),this.data.Az[this.data.count-1]=this.bytesToInt16(u[31],u[32]),this.data.count>=this.maxBufferedSamples&&(this.data.Ax.splice(0,5120),this.data.Ay.splice(0,5120),this.data.Az.splice(0,5120),this.data.Ax.push(new Array(5120).fill(0)),this.data.Ay.push(new Array(5120).fill(0)),this.data.Az.push(new Array(5120).fill(0)),this.data.count-=5120),s++}return s>0&&t.splice(0,o[o.length-1]),s}}},{key:"onDecodedCallback",value:function(t){}},{key:"onConnectedCallback",value:function(){console.log("port connected!")}},{key:"onDisconnectedCallback",value:function(){console.log("port disconnected!")}},{key:"onReceive",value:function(t){var e,n;(e=this.buffer).push.apply(e,function(t){if(Array.isArray(t))return xt(t)}(n=t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return xt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xt(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var r=this.decode(this.buffer);!1===r||0===r||isNaN(r)||this.onDecodedCallback(r)}},{key:"sendMsg",value:(c=wt(regeneratorRuntime.mark((function t(e){var n,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=unescape(encodeURIComponent(e+="\n")),r=new Uint8Array(n.length),i=this.port.writable.getWriter(),t.next=6,i.write(r.buffer);case 6:return i.releaseLock(),t.abrupt("return",!0);case 8:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"onPortSelected",value:(a=wt(regeneratorRuntime.mark((function t(e){var n,r=this,i=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:this.baudrate,t.prev=1,t.prev=2,t.next=5,e.open({baudRate:n,bufferSize:this.readBufferSize});case 5:setTimeout((function(){r.onConnectedCallback(),r.connected=!0,r.subscribed=!0,r.sendMsg("b"),r.subscribe(e)}),500),t.next=13;break;case 8:return t.prev=8,t.t0=t.catch(2),t.next=12,e.open({baudrate:n,buffersize:this.readBufferSize});case 12:setTimeout((function(){r.onConnectedCallback(),r.connected=!0,r.subscribed=!0,r.sendMsg("b"),r.subscribe(e)}),500);case 13:t.next=19;break;case 15:t.prev=15,t.t1=t.catch(1),console.log(t.t1),this.connected=!1;case 19:case"end":return t.stop()}}),t,this,[[1,15],[2,8]])}))),function(t){return a.apply(this,arguments)})},{key:"subscribe",value:(s=wt(regeneratorRuntime.mark((function t(e){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.port.readable&&!0===this.subscribed&&(this.reader=e.readable.getReader(),(n=function(){var t=wt(regeneratorRuntime.mark((function t(){var e,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.reader.read();case 3:if(e=t.sent,i=e.value,!e.done&&!1!==r.subscribed){t.next=9;break}return t.next=9,r.reader.releaseLock();case 9:if(i)try{r.onReceive(i)}catch(t){console.log(t)}!0===r.subscribed&&setTimeout((function(){n()}),r.readRate),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(0),console.log(t.t0),r.closePort();case 17:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(){return t.apply(this,arguments)}}())());case 1:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"subscribeSafe",value:(o=wt(regeneratorRuntime.mark((function t(e){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:new Promise((function(t,r){for(;n.port.readable&&!0===n.subscribed;){n.reader=e.readable.getReader();for(var i=!0,o=new Promise((function(t,e){return n.reader.read()})),s=new Promise((function(t,e){setTimeout(t,100,"readfail")}));!0===i;)Promise.race([o,s]).then((function(t){if(console.log("newpromise"),"readfail"===t)console.log(t);else{var e=t.value;!0===t.done||!0===n.subscribed?new Promise((function(t,e){t(n.reader.releaseLock())})).then((function(){i=!1})):n.onReceive(e)}}))}t("not readable")}));case 1:case"end":return t.stop()}}),t)}))),function(t){return o.apply(this,arguments)})},{key:"closePort",value:(i=wt(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=r.length>0&&void 0!==r[0]?r[0]:this.port,this.port&&(this.subscribed=!1,this.sendMsg("s"),setTimeout(wt(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.reader&&(n.reader=null),t.next=3,e.close();case 3:n.port=null,n.connected=!1,n.onDisconnectedCallback();case 6:case"end":return t.stop()}}),t)}))),100));case 2:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"setupSerialAsync",value:(r=wt(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:this.baudrate,t.next=4,navigator.serial.requestPort();case 4:this.port=t.sent,navigator.serial.addEventListener("disconnect",(function(t){n.closePort(n.port)})),this.onPortSelected(this.port,e);case 7:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"asUint8Array",value:function(t){if(t instanceof Uint8Array)return t;if("string"==typeof t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r>127)throw new TypeError("Only ASCII patterns are supported");e[n]=r}return e}return new Uint8Array(t)}},{key:"boyerMoore",value:function(t){var e=this,n=this.asUint8Array(t),r=n.length;if(0===r)throw new TypeError("patternBuffer must be at least 1 byte long");for(var i=new Int32Array(256),o=0;o<256;o++)i[o]=-1;for(var s=0;s<r;s++)i[n[s]]=s;var a=function(t,r,o){var s=e.asUint8Array(t);void 0===r&&(r=0),void 0===o&&(o=s.length);for(var a,c=n,u=i,l=o-c.length,h=c.length-1,f=r;f<=l;f+=a){a=0;for(var d=h;d>=0;d--){var p=s[f+d];if(c[d]!==p){a=Math.max(1,d-u[p]);break}}if(0===a)return f}return-1};return a.byteLength=n.byteLength,a}}])&&kt(e.prototype,n),t}();function Et(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function Ct(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){Et(o,r,i,s,a,"next",t)}function a(t){Et(o,r,i,s,a,"throw",t)}s(void 0)}))}}function At(t){return(At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function It(t){return function(t){if(Array.isArray(t))return Ot(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Ot(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ot(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Pt,Nt=function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"cyton_daisy",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;Ft(this,t),this.init=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{sps:null,deviceType:null,eegChannelTags:null,analysis:["eegfft"],useAtlas:void 0},n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.sps=250,t.deviceType="eeg";var r=function(n){e.atlas.data.eegshared.eegChannelTags.forEach((function(r,i){var o,s,a,c,u=e.device.getLatestData("A"+r.ch,n),l=new Array(u.length).fill(0);if("other"!==r.tag&&!0===t.useFilters)e.filters.forEach((function(t,e){t.channel===r.ch&&u.forEach((function(e,n){l[n]=t.apply(e)}))})),!0===t.useAtlas&&((c=null!==r.tag?e.atlas.getEEGDataByTag(r.tag):e.atlas.getEEGDataByChannel(r.ch)).count+=n,(o=c.times).push.apply(o,It(e.device.data.ms.slice(e.device.data.count-n,e.device.data.count))),(s=c.filtered).push.apply(s,It(l)),(a=c.raw).push.apply(a,It(u)));else if(!0===t.useAtlas){var h,f,d=e.atlas.getEEGDataByChannel(r.ch);d.count+=n,(h=d.times).push.apply(h,It(e.device.data.ms.slice(e.device.data.count-n,e.device.data.count))),(f=d.raw).push.apply(f,It(u))}}))},i=function(){!0===t.useAtlas&&(e.atlas.data.eegshared.startTime=Date.now(),!0!==e.atlas.settings.analyzing&&t.analysis.length>0&&(e.atlas.settings.analyzing=!0,setTimeout((function(){e.atlas.analyzer()}),1200))),e.atlas.settings.deviceConnected=!0,e.onconnect()},o=function(){e.atlas.settings.analyzing=!1,e.atlas.settings.deviceConnected=!1,e.ondisconnect()},s=[];if(e.mode.indexOf("daisy")>-1?(s=[{ch:0,tag:"FP1",analyze:!0},{ch:1,tag:"FP2",analyze:!0},{ch:2,tag:"C3",analyze:!0},{ch:3,tag:"C4",analyze:!0},{ch:4,tag:"P7",analyze:!0},{ch:5,tag:"P8",analyze:!0},{ch:6,tag:"O1",analyze:!0},{ch:7,tag:"O2",analyze:!0},{ch:8,tag:"F7",analyze:!0},{ch:9,tag:"F8",analyze:!0},{ch:10,tag:"F3",analyze:!0},{ch:11,tag:"F4",analyze:!0},{ch:12,tag:"T7",analyze:!0},{ch:13,tag:"T8",analyze:!0},{ch:14,tag:"P3",analyze:!0},{ch:15,tag:"P4",analyze:!0}],e.device=new Tt(r,i,o,"daisy")):(s=[{ch:0,tag:"FP1",analyze:!0},{ch:1,tag:"FP2",analyze:!0},{ch:2,tag:"C3",analyze:!0},{ch:3,tag:"C4",analyze:!0},{ch:4,tag:"P7",analyze:!0},{ch:5,tag:"P8",analyze:!0},{ch:6,tag:"O1",analyze:!0},{ch:7,tag:"O2",analyze:!0}],e.device=new Tt(r,i,o,"single")),!0===t.useFilters&&s.forEach((function(n,r){"other"!==n.tag?e.filters.push(new B(n.ch,t.sps,!0,e.device.uVperStep)):e.filters.push(new B(n.ch,t.sps,!1,e.device.uVperStep))})),t.eegChannelTags=s,!0===n){var a="10_20";e.atlas=new x(location+":"+e.mode,{eegshared:{eegChannelTags:t.eegChannelTags,sps:t.sps}},a,!0,!0,t.analysis),t.useAtlas=!0}else if("object"===At(n)){var c;e.atlas=n,e.atlas.data.eegshared.eegChannelTags=t.eegChannelTags,e.atlas.data.eegshared.sps=t.sps,e.atlas.data.eegshared.frequencies=e.atlas.bandpassWindow(0,128,.5*t.sps),e.atlas.data.eegshared.bandFreqs=e.atlas.getBandFreqs(e.atlas.data.eegshared.frequencies),e.atlas.data.eeg=e.atlas.gen10_20Atlas(),e.atlas.data.coherence=e.atlas.genCoherenceMap(t.eegChannelTags),e.atlas.data.eegshared.eegChannelTags.forEach((function(t,n){void 0===e.atlas.getEEGDataByTag(t.tag)&&e.atlas.addEEGCoord(t.ch)})),e.atlas.settings.coherence=!0,e.atlas.settings.eeg=!0,t.useAtlas=!0,t.analysis.length>0&&((c=e.atlas.settings.analysis).push.apply(c,It(t.analysis)),e.atlas.settings.analyzing||(e.atlas.settings.analyzing=!0,e.atlas.analyzer()))}},this.connect=Ct(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.device.setupSerialAsync();case 2:e.setIndicator(!0);case 3:case"end":return t.stop()}}),t)}))),this.disconnect=function(){e.device.closePort(),e.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,n=(Math.floor(1e4*Math.random()),function(){return"\n            "}),r=function(){};e.ui=new V(n,t,void 0,r)},this.atlas=null,this.mode=n,this.device=null,this.filters=[],this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.border="1px solid white")}};function Dt(t){return function(t){if(Array.isArray(t))return jt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return jt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Rt(t){return(Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var zt=function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;Bt(this,t),this.init=function(t,e){if(t.deviceType="eyetracker",!0===e)n.atlas=new x(location+":"+n.mode,void 0,"eyetracker",!0,!0,t.analysis),t.deviceNum=n.atlas.data.heg.length-1,t.useAtlas=!0,t.deviceNum=n.atlas.data.eyetracker.length-1;else if("object"===Rt(e)){var r;n.atlas=e,t.deviceNum=n.atlas.data.eyetracker.length,n.atlas.addEyeTracker(n.atlas.data.eyetracker.length),n.atlas.settings.eyetracker=!0,t.useAtlas=!0,t.analysis.length>0&&((r=n.atlas.settings.analysis).push.apply(r,Dt(t.analysis)),n.atlas.settings.analyzing||(n.atlas.settings.analyzing=!0,n.atlas.analyzer()))}n.info=t},this.connect=function(){Pt.setGazeListener((function(t,e){if(null!=t&&(t.x,t.y,!0===n.info.useAtlas)){var r=n.atlas.data.eyetracker[n.info.deviceNum];0===r.times.length&&(r.startTime=Date.now()),r.times.push(Date.now()),r.x.push(t.x),r.y.push(t.y),r.x.length>10?(r.smax.push(r.x.slice(r.x.length-10).reduce((function(t,e){return t+e}))/10),r.smay.push(r.y.slice(r.y.length-10).reduce((function(t,e){return t+e}))/10)):(r.smax.push(r.x.slice(0).reduce((function(t,e){return t+e}))/r.x.length),r.smay.push(r.y.slice(0).reduce((function(t,e){return t+e}))/r.y.length))}})).begin(),n.atlas.settings.deviceConnected=!0,n.onconnect(),n.setIndicator(!0)},this.disconnect=function(){Pt.end(),n.atlas.settings.deviceConnected=!1,n.ondisconnect(),n.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,e=(Math.floor(1e4*Math.random()),function(){return"\n            "}),r=function(){};n.ui=new V(e,t,void 0,r)},this.atlas=null,this.mode=e,this.device=null,this.filters=[],this.info,this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="1px solid white")}},Lt=n(5955),Mt=n(4633),Vt=n(3756),Gt=n(301),Ut=n(3520),qt=n(9541),Zt=n(8304),Wt=n(9388),Yt=n(6941);function Ht(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Kt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ht(Object(n),!0).forEach((function(e){Jt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ht(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Jt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Qt=function(t){var e=t.channelData;return Kt(Kt({},function(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}(t,["channelData"])),{},{data:e})},$t="ganglion",Xt={reader:"2d30c082-f39f-4ce6-923f-3484ea480596",writer:"2d30c083-f39f-4ce6-923f-3484ea480596",connection:"2d30c084-f39f-4ce6-923f-3484ea480596"},te={filters:[{namePrefix:"Ganglion-"}],optionalServices:[65156]},ee={start:"b",accelData:"n"};function ne(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function re(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ne(Object(n),!0).forEach((function(e){ie(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ie(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function oe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=n){var r,i,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);s=!0);}catch(t){a=!0,i=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return se(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?se(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ae(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function ce(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){ae(o,r,i,s,a,"next",t)}function a(t){ae(o,r,i,s,a,"throw",t)}s(void 0)}))}}function ue(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function le(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function he(t){var e=parseInt(t.rawDataPacket[0]);if(e<=k.OBCIGanglionByteId19Bit.max)return processRouteSampleData(t);switch(e){case k.OBCIGanglionByteIdMultiPacket:return processMultiBytePacket(t);case k.OBCIGanglionByteIdMultiPacketStop:return processMultiBytePacketStop(t);case k.OBCIGanglionByteIdImpedanceChannel1:case k.OBCIGanglionByteIdImpedanceChannel2:case k.OBCIGanglionByteIdImpedanceChannel3:case k.OBCIGanglionByteIdImpedanceChannel4:case k.OBCIGanglionByteIdImpedanceChannelReference:return processImpedanceData(t);default:return null}}var fe=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};function r(t){return{channelNumber:t,powerDown:!1,gain:24,inputType:"normal",bias:!0,srb2:!0,srb1:!1}}ue(this,t),this.options=n,this.gatt=null,this.device=null,this.deviceName=null,this.service=null,this.characteristics=null,this.onDisconnect$=new Lt.Subject,this.boardName=$t,this.channelSize=4;var i=function(t){for(var e=[],n=0;n<t;n++)e.push(r(n));return e};function o(t){for(var e=[],n=0;n<3;n++)e.push(new Array(t));return e}this.rawDataPacketToSample={accelArray:[0,0,0],channelSettings:i(4),decompressedSamples:o(4),lastSampleNumber:0,rawDataPacket:new Uint8Array(33).buffer,rawDataPackets:[],scale:!0,sendCounts:!1,timeOffset:0,verbose:!1},this.connectionStatus=new Mt.BehaviorSubject(!1),this.stream=(new Lt.Subject).pipe((0,Gt.map)((function(t){return e.eventToBufferMapper(t)})),(0,Vt.tap)((function(t){return e.setRawDataPacket(t)})),(0,Gt.map)((function(){return he(e.rawDataPacketToSample)})),(0,Wt.mergeMap)((function(t){return t})),(0,Gt.map)(Qt),(0,Zt.takeUntil)(this.onDisconnect$)),this.accelData=this.stream.pipe((0,qt.filter)((function(t){return t.accelData.length})))}var e,n,r,i;return e=t,(n=[{key:"eventToBufferMapper",value:function(t){return new Uint8Array(t.target.value.buffer)}},{key:"setRawDataPacket",value:function(t){this.rawDataPacketToSample.rawDataPacket=t}},{key:"connect",value:(i=ce(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.bluetooth.requestDevice(te);case 2:return this.device=t.sent,this.addDisconnectedEvent(),t.next=6,this.device.gatt.connect();case 6:return this.gatt=t.sent,this.deviceName=this.gatt.device.name,t.next=10,this.gatt.getPrimaryService(65156);case 10:return this.service=t.sent,t.t0=this,t.next=14,this.service.getCharacteristics();case 14:t.t1=t.sent,t.t0.setCharacteristics.call(t.t0,t.t1),this.connectionStatus.next(!0);case 17:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"setCharacteristics",value:function(t){this.characteristics=Object.entries(Xt).reduce((function(e,n){var r=oe(n,2),i=r[0],o=r[1];return re(re({},e),{},ie({},i,t.find((function(t){return t.uuid===o}))))}),{})}},{key:"start",value:(r=ce(regeneratorRuntime.mark((function t(){var e,n,r,i,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.characteristics,n=e.reader,r=e.writer,i=Object.entries(ee).reduce((function(t,e){var n=oe(e,2),r=n[0],i=n[1];return re(re({},t),{},ie({},r,(new TextEncoder).encode(i)))}),{}),n.startNotifications(),n.addEventListener("characteristicvaluechanged",(function(t){o.stream.next(t)})),!this.options.accelData){t.next=8;break}return t.next=7,r.writeValue(i.accelData);case 7:n.readValue();case 8:return t.next=10,r.writeValue(i.start);case 10:n.readValue();case 11:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"addDisconnectedEvent",value:function(){var t=this;(0,Yt.fromEvent)(this.device,"gattserverdisconnected").pipe((0,Ut.first)()).subscribe((function(){t.gatt=null,t.device=null,t.deviceName=null,t.service=null,t.characteristics=null,t.connectionStatus.next(!1)}))}},{key:"disconnect",value:function(){this.gatt&&(this.onDisconnect$.next(),this.gatt.disconnect())}}])&&le(e.prototype,n),t}();function de(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function pe(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){de(o,r,i,s,a,"next",t)}function a(t){de(o,r,i,s,a,"throw",t)}s(void 0)}))}}function ve(t){return function(t){if(Array.isArray(t))return ge(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return ge(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ge(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ye(t){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function be(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var me=function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;be(this,t),this.init=function(t,e){t.sps=200,t.deviceType="eeg";var r=15686/8388607;if(t.eegChannelTags=[{ch:0,tag:"FP1",analyze:!0},{ch:1,tag:"FP2",analyze:!0},{ch:2,tag:"C3",analyze:!0},{ch:3,tag:"C4",analyze:!0}],!0===t.useFilters&&t.eegChannelTags.forEach((function(e,i){"other"!==e.tag?n.filters.push(new B(e.ch,t.sps,!0,r)):n.filters.push(new B(e.ch,t.sps,!1,r))})),!0===e)n.atlas=new x(location+":"+n.mode,{eegshared:{eegChannelTags:t.eegChannelTags,sps:t.sps}},"10_20",!0,!0,t.analysis),t.useAtlas=!0;else if("object"===ye(e)){var i;n.atlas=e,n.atlas.data.eegshared.eegChannelTags=t.eegChannelTags,n.atlas.data.eegshared.sps=t.sps,n.atlas.data.eegshared.frequencies=n.atlas.bandpassWindow(0,128,.5*t.sps),n.atlas.data.eegshared.bandFreqs=n.atlas.getBandFreqs(n.atlas.data.eegshared.frequencies),n.atlas.data.eeg=n.atlas.gen10_20Atlas(),n.atlas.data.coherence=n.atlas.genCoherenceMap(t.eegChannelTags),n.atlas.data.eegshared.eegChannelTags.forEach((function(t,e){void 0===n.atlas.getEEGDataByTag(t.tag)&&n.atlas.addEEGCoord(t.ch)})),n.atlas.settings.coherence=!0,n.atlas.settings.eeg=!0,t.useAtlas=!0,t.analysis.length>0&&((i=n.atlas.settings.analysis).push.apply(i,ve(t.analysis)),n.atlas.settings.analyzing||(n.atlas.settings.analyzing=!0,n.atlas.analyzer()))}},this.connect=pe(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.device=new fe,t.next=3,n.device.connect();case 3:return t.next=5,n.device.start();case 5:n.device.stream.subscribe((function(t){if(n.info.useAtlas){var e=t.timestamp;t.data.forEach((function(r,i){var o=n.atlas.getEEGDataByChannel(i);if(o.times.push(e),o.raw.push(r),o.count++,!0===n.info.useFilters){var s,a=0;void 0!==n.filters[i]&&(a=n.filters[i].apply(t)),(s=o.filtered).push.apply(s,ve(a))}}))}})),!0===info.useAtlas&&(n.atlas.data.eegshared.startTime=Date.now(),!0!==n.atlas.settings.analyzing&&info.analysis.length>0&&(n.atlas.settings.analyzing=!0,setTimeout((function(){n.atlas.analyzer()}),1200))),n.atlas.settings.deviceConnected=!0,n.onconnect(),n.setIndicator(!0);case 10:case"end":return t.stop()}}),t)}))),this.disconnect=function(){n.device.disconnect(),n.atlas.settings.analyzing=!1,n.atlas.settings.deviceConnected=!1,n.ondisconnect(),n.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,e=(Math.floor(1e4*Math.random()),function(){return"\n            "}),r=function(){};n.ui=new V(e,t,void 0,r)},this.atlas=null,this.mode=e,this.device=null,this.filters=[],this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="1px solid white")}};function we(t){return function(t){if(Array.isArray(t))return xe(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return xe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xe(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Se(t){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _e(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function ke(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){_e(o,r,i,s,a,"next",t)}function a(t){_e(o,r,i,s,a,"throw",t)}s(void 0)}))}}function Te(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ee(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ce(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ae(t,e,n){return e&&Ce(t.prototype,e),n&&Ce(t,n),t}var Ie=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"public",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"http://localhost:8000",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"http://127.0.0.1:8000";Ee(this,t),Oe.call(this),this.devices=[],this.state=new p({commandResult:{}}),this.atlas=new x("atlas",void 0,void 0,!0,!1),this.info={nDevices:0,auth:{url:new URL(o),username:e,password:n,access:i,appname:r.toLowerCase().split(" ").join("").replace(/^[^a-z]+|[^\w]+/gi,""),authenticated:!1},subscribed:!1,connections:[],localHostURL:s},this.socket=null}var e,n,r;return Ae(t,[{key:"setLoginInfo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"public",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.info.auth.username=t,this.info.auth.password=e,this.info.auth.access=n,this.info.auth.appname=r}},{key:"connect",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"freeeeg32_2",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["eegfft"],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[["eegch","FP1","all"]],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],c=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(!0===o&&(console.log(this.socket),null==this.socket||1!==this.socket.readyState))return console.error("Server connection not found, please run login() first"),!1;if(this.devices.length>0&&(e.indexOf("eeg")>-1||e.indexOf("muse")>-1)){var u=this.devices.find((function(t,e){if("eeg"===t.deviceType)return!0}));u||(c=this.devices[0].atlas)}this.devices.push(new Fe(e,n,a,c,o,this.socket,s,this.info.auth));var l=this.devices.length-1;this.devices[l].onconnect=function(){t.info.nDevices++,r(),t.onconnected()},this.devices[l].ondisconnect=function(){i(),t.ondisconnected(),Array.isArray(t.devices[l].info.analysis)&&t.devices[l].info.analysis.length>0&&(t.devices[l].info.analyzing=!1),t.devices[l].info.streaming=!1,t.devices.splice(l,1),t.info.nDevices--},this.devices[l].init(),1===this.devices.length&&(this.atlas=this.devices[0].atlas),this.state.addToState("device"+l,this.devices[l].info),this.devices[l].connect()}},{key:"reconnect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.devices.length-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t>-1?(this.devices[t].connect(),e()):console.log("No devices connected")}},{key:"disconnect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.devices.length-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t>-1?(this.devices[t].info.streaming=!1,this.devices[t].disconnect(),e()):console.log("No devices connected")}},{key:"makeConnectOptions",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=Math.floor(1e4*Math.random())+"devicemenu",o='<div><span class="collapsible-content-label">Device Selection</span><hr></div><div class="device-gallery">',s=["muse","freeeeg32_2","freeeeg32_19","hegduinousb","hegduinobt","cyton","cyton_daisy","ganglion","simulated_eeg"];s.forEach((function(t,e){o+="\n\t\t\t<div id='brainsatplay-".concat(t,"' value='").concat(t,"' class='device-card'>\n\t\t\t<div id='brainsatplay-").concat(t,"-indicator' class='indicator'></div>\n\t\t\t").concat(t,"\n\t\t\t</div>")})),o+="</div>",e.insertAdjacentHTML("afterbegin",o),e.insertAdjacentHTML("beforeend","<button id='"+i+"disconnect'>Disconnect</button>"),s.forEach((function(e,i){document.getElementById("brainsatplay-".concat(e)).onclick=function(){"muse"===e?t.connect("muse",["eegcoherence"],n,r):"freeeeg32_2"===e?t.connect("freeeeg32_2",["eegcoherence"],n,r):"freeeeg32_19"===e?t.connect("freeeeg32_19",["eegfft"],n,r):"hegduinousb"===e?t.connect("hegduinousb",[],n,r):"hegduinobt"===e?t.connect("hegduinobt",[],n,r):"hegduinowifi"===e?t.connect("hegduinowifi",[],n,r):"cyton"===e?t.connect("cyton",["eegfft"],n,r):"cyton_daisy"===e?t.connect("cyton_daisy",["eegfft"],n,r):"ganglion"===e?t.connect("ganglion",["eegcoherence"],n,r):"simulated_eeg"===e&&t.connect("simulated_eeg",["eegfft"],n,r)}})),document.getElementById(i+"disconnect").onclick=function(){t.disconnect()}}},{key:"beginStream",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.devices[t].info.streaming&&(this.devices[t].info.streaming=!0,null!==e&&(this.devices[t].info.streamParams=e),this.devices[t].streamLoop())}},{key:"endStream",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.devices[t].info.streaming=!1}},{key:"getDevice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"freeeeg32_2",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=void 0;return this.devices.find((function(r,i){return r.info.deviceName.indexOf(t)>-1&&r.info.deviceNum===e||r.info.deviceType.indexOf(t)>-1&&r.info.deviceNum===e?(n=r,!0):void 0})),n}},{key:"addAnalysisMode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.data.device0.deviceName,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.getDevice(e,n),i=r.info.analysis.find((function(e,n){if(e===t)return!0}));i||r.info.analysis.push(t),r.atlas.settings.analyzing||(r.atlas.settings.analyzing=!0,r.atlas.analyzer())}},{key:"stopAnalysis",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.devices.length>0?""!==e&&"string"==typeof e?this.atlas.settings.analysis.find((function(n,r){if(e===n)return t.atlas.settings.analysis.splice(r,1),!0})):this.atlas.settings.analyzing=!1:console.error("no devices connected")}},{key:"getStreamData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={};for(var r in this.state.data)null===e?r.indexOf(t)>-1&&(n[r]=this.state.data[r]):r.indexOf(t)>-1&&r.indexOf(e)>-1&&(n[r]=this.state.data[r]);return n}},{key:"addAnalyzerFunc",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.devices.forEach((function(n,r){null!==n.atlas&&null!==t&&(n.atlas.analyzerOpts.indexOf(t)<0?(n.atlas.analyzerOpts.push(t),n.atlas.analyzerFuncs.push(e)):console.error("property "+t+" exists"))}))}},{key:"streamAppData",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.info.nDevices>0){var r=e+Math.floor(1e4*Math.random()),i=Object.assign(Te({},r+"newData",!0),n);this.state.addToState(r,i,(function(e){t.state.data[r][r+"newData"]||(t.state.data[r][r+"newData"]=!0)}));var o=function(){return!0===t.state.data[r][r+"newData"]?(t.state.data[r][r+"newData"]=!1,t.state.data[r]):void 0};this.addStreamFunc(r,o),this.addStreamParam([r])}}},{key:"addStreamFunc",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;"string"==typeof t&&"function"==typeof e&&void 0!==this.devices[n]?this.devices[n].addStreamFunc(t,e):console.error("addStreamFunc error")}},{key:"addStreamParam",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach((function(e,n){Array.isArray(e)&&t.devices.find((function(t){if(e[0].indexOf(t.info.deviceType)>-1)return"eeg"===t.info.deviceType?t.atlas.data.eegshared.eegChannelTags.find((function(n){if(n.tag===e[1]||n.ch===e[1])return t.info.streamParams.push(e),!0})):t.info.streamParams.push(e),!0}))}))}},{key:"login",value:(r=ke(regeneratorRuntime.mark((function t(){var e,n,r=this,i=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=i.length>0&&void 0!==i[0]&&i[0],n=i.length>1&&void 0!==i[1]?i[1]:this.info.auth,i.length>2&&void 0!==i[2]?i[2]:this.info.auth.url.toString(),null!=this.socket&&1===this.socket.readyState||(this.socket=this.setupWebSocket(n),this.info.auth.authenticated=!0,this.subscribed=!0),null!==this.socket&&1===this.socket.readyState&&!0===e&&this.devices.length>0&&this.devices.forEach((function(t,e){r.beginStream(e)}));case 5:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"signup",value:(n=ke(regeneratorRuntime.mark((function t(){var e,n,r,i,o=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=o.length>0&&void 0!==o[0]?o[0]:{},n=o.length>1&&void 0!==o[1]?o[1]:this.info.auth.url.toString(),n=this.checkURL(n),r=JSON.stringify(e),t.next=6,fetch(n.toString()+"signup",{method:"POST",mode:"cors",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:r}).then((function(t){return t.json().then((function(t){return t}))})).then((function(t){return console.log("\n"+t),t})).catch((function(t){console.error("\n"+t.message)}));case 6:return i=t.sent,t.abrupt("return",i);case 8:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"request",value:(e=ke(regeneratorRuntime.mark((function t(e){var n,r,i,o,s=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:"POST",r=s.length>2&&void 0!==s[2]?s[2]:"",i=s.length>3&&void 0!==s[3]?s[3]:this.info.auth.url.toString(),""===r){t.next=13;break}return i=this.checkURL(i),r=this.checkPathname(r),o={method:n,mode:"cors",headers:{Accept:"application/json","Content-Type":"application/json"}},"POST"===n&&(o.body=JSON.stringify(e)),t.next=10,fetch(i+r,o).then((function(t){return t.json().then((function(t){return t.message}))})).catch((function(t){console.error("\n"+t.message)}));case 10:return t.abrupt("return",t.sent);case 13:return console.error("You must provide a valid pathname to request resources from "+i),t.abrupt("return");case 15:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"processSocketMessage",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=JSON.parse(e);if(n.msg)if("userData"===n.msg)for(var r in n.userData)this.state.data[n.username+"_userData"][r]=n.userData[r];else"gameData"===n.msg?(null==this.state.data.multiplayer[n.id]&&(this.state.data.multiplayer[n.id]={userData:{}}),this.state.data.multiplayer[n.id].userData?n.userData.forEach((function(e,r){var i=t.state.data.multiplayer[n.id].userData[e.username];if(null!=i){var o=function(t){null==i.latest[t]&&(i.latest[t]=null),i.latest[t]=e[t],e[t].constructor==Object&&Object.keys(e[t]).forEach((function(n){null==i.history[t]?i.history[t]=e[t]:i.history[t][n].push(e[t][n])}))};for(var s in e)o(s)}else t.state.data.multiplayer[n.id].userData[e.username]={latest:{},history:e}})):this.state.data.multiplayer[n.id].userData={},this.state.data.multiplayer[n.id].spectators=n.spectators,this.state.data.multiplayer[n.id].usernames=n.usernames,this.state.data.multiplayer[n.id].t=Date.now()):"getUserDataResult"===n.msg||"getUsersResult"===n.msg||"getGameDataResult"===n.msg||"getGameInfoResult"===n.msg||"getGamesResult"===n.msg?this.state.data.commandResult=n:"gameCreated"===n.msg?(this.state.data.commandResult=n,this.info.auth.appname=n.gameInfo.id):"subscribedToUser"===n.msg||"userNotFound"===n.msg||"subscribedToGame"===n.msg||"leftGame"===n.msg||"gameDeleted"===n.msg||"unsubscribed"===n.msg||"gameNotFound"===n.msg?this.state.data.commandResult=n:"resetUsername"===n.msg?this.info.auth.username=n.username:"ping"===n.msg||console.log(n);else console.log(e)}},{key:"setupWebSocket",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.info.auth,n=null,r=["username&"+e.username,"password&"+e.password,"appname&"+e.appname];if("http:"===location.protocol)n=new WebSocket("ws://"+e.url.host,r);else{if("https:"!==location.protocol)return void console.log("invalid protocol");n=new WebSocket("wss://"+e.url.host,r)}return n.onerror=function(){console.log("error")},n.onopen=function(){console.log("socket opened")},n.onmessage=function(e){t.processSocketMessage(e.data)},n.onclose=function(t){console.log("close")},n}},{key:"subscribeToUser",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.info.auth.username,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){};if(null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({username:this.info.auth.username,cmd:["getUserData",e]})),n.forEach((function(n){var r=n;Array.isArray(r)&&(r=n.join("_")),t.state.data[e+"_"+r]=null}));var o=this.state.subscribe("commandResult",(function(s){"object"===Se(s)&&("getUserDataResult"===s.msg?(s.username===e&&t.socket.send(JSON.stringify({username:t.info.auth.username,cmd:["subscribeToUser",r,e,n]})),i(s),t.state.unsubscribe("commandResult",o)):"userNotFound"===s.msg&&s.username===e&&(t.state.unsubscribe("commandResult",o),console.log("User not found: ",e)))}))}}},{key:"unsubscribeFromUser",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.info.auth.username,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){};if(null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({cmd:["unsubscribeFromUser",r,e,n],username:this.info.auth.username}));var o=this.state.subscribe("commandResult",(function(n){if("unsubscribed"===n.msg&&n.username===e){for(var r in t.state.data)r.indexOf(e)>-1&&(t.state.unsubscribeAll(r),t.state.data[r]=void 0);i(n),t.state.unsubscribe("commandResult",o)}}))}}},{key:"getGames",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.info.auth.appname,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){};if(null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({username:this.info.auth.username,cmd:["getGames",e]}));var r=this.state.subscribe("commandResult",(function(i){"object"===Se(i)?"getGamesResult"===i.msg&&i.appname===e&&(console.log(i.gameInfo),n(i),t.state.unsubscribe("commandResult",r)):"gameNotFound"===i.msg&i.appname===e&&(t.state.unsubscribe("commandResult",r),console.log("Game not found: ",e))}))}}},{key:"subscribeToGame",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.info.auth.appname,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.info.auth.username,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){};if(console.log(this.info.auth.username),null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({username:this.info.auth.username,cmd:["getGameInfo",e]}));var o=this.state.subscribe("commandResult",(function(s){if("object"===Se(s))if("getGameInfoResult"===s.msg&&s.gameInfo.id===e){var a=!0;if(!1===n){var c=[];s.gameInfo.propnames.forEach((function(t){c.push(t.split("_"))})),a=t.configureStreamForGame(s.gameInfo.devices,c)}if(!0===a){t.socket.send(JSON.stringify({username:t.info.auth.username,cmd:["subscribeToGame",r,e,n]}));var u={};s.gameInfo.usernames.forEach((function(t){u[t]={latest:{},history:{}},s.gameInfo.propnames.forEach((function(e){u[t].latest[e]=null,u[t].history[e]=null}))})),t.state.data.multiplayer=Te({},s.gameInfo.id,{usernames:[],spectators:[],userData:u}),i(s)}t.state.unsubscribe("commandResult",o)}else"gameNotFound"===s.msg&s.appname===e&&(t.state.unsubscribe("commandResult",o),console.log("Game not found: ",e))}))}}},{key:"unsubscribeFromGame",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){};if(null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({cmd:["leaveGame",e],username:this.info.auth.username}));var r=this.state.subscribe("commandResult",(function(i){if("leftGame"===i.msg&&i.appname===e){for(var o in t.state.data)o.indexOf(e)>-1&&(t.state.unsubscribeAll(o),t.state.data[o]=void 0);n(i),t.state.unsubscribe("commandResult",r)}}))}}},{key:"configureStreamForGame",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=[];n.forEach((function(t,e){void 0===t[2]?r.push([t[0],t[1],"all"]):r.push(we(t))}));var i=!1;return e.forEach((function(e,n){t.devices.find((function(n,o){if(n.info.deviceType===e){null===n.socket&&(n.socket=t.socket);var s=[];if(r.forEach((function(t){t[0].indexOf(n.info.deviceType)>-1&&("eeg"===n.info.deviceType?n.atlas.data.eegshared.eegChannelTags.find((function(e){if(e.tag===t[1]||e.ch===t[1])return s.push(t),!0})):s.push(t))})),s.length>0)return n.info.streamParams=s,!1===n.info.streaming&&(n.info.streaming=!0,n.streamLoop()),i=!0,!0}}))})),!!i||(console.error("Compatible device not found"),!1)}},{key:"sendWSCommand",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null!=this.socket&&1===this.socket.readyState){var n={cmd:t,username:this.info.auth.username};Object.assign(n,e);var r=JSON.stringify(n);console.log("Message sent: ",r),this.socket.send(r)}}},{key:"closeSocket",value:function(){this.socket.close()}},{key:"onconnectionLost",value:function(t){var e=!1;this.info.connections.find((function(n,r){if(n.username===t.username)return e=!0,!0})),!0===e&&(this.info.connections.splice(0,1),this.info.nDevices--)}},{key:"checkURL",value:function(t){return"/"!==t.slice(-1)&&(t+="/"),t}},{key:"checkPathname",value:function(t){return"/"===t.slice(0)&&t.splice(0,1),t}}]),t}(),Oe=function(){var t=this;this.onconnected=function(){},this.ondisconnected=function(){},this.getDeviceData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eeg",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.devices.forEach((function(t,i){if(console.log("get"),t.info.deviceType.indexOf(e)>-1&&t.info.deviceNum===r)return"all"===n?t.atlas.data[e]:t.atlas.getDeviceDataByTag(e,n)}))},this.subscribe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eeg",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FP1",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){},o=void 0,s=n,a=null;return e.indexOf("eeg")>-1||e.indexOf("muse")>-1||e.indexOf("notion")>-1?(a="eeg","shared"===s&&(s="eeghared")):e.indexOf("heg")>-1&&(a="heg","shared"===s&&(s="hegshared")),null!==a&&t.devices.find((function(n,c){if(n.info.deviceName.indexOf(e)>-1&&!0===n.info.useAtlas){var u=void 0;return"string"==typeof s?s.indexOf("shared")>-1&&(u=n.atlas.getDeviceDataByTag(s,null)):u=null===s||"all"===s?n.atlas.data[a]:n.atlas.getDeviceDataByTag(a,s),void 0!==u&&(null===r||Array.isArray(u)||"object"!==Se(u[r])?o=t.state.addToState(s,u,i):"object"===Se(u[r])&&(o=t.state.addToState(s+"_"+r,u[r],i))),!0}})),o},this.unsubscribe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FP1",n=arguments.length>1?arguments[1]:void 0;t.state.unsubscribe(e,n)},this.unsubscribeAll=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FP1";t.state.unsubscribeAll(e)},this.makeGameBrowser=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){},o=Math.floor(1e6*Math.random())+e,s="<div id='"+o+"'><button id='"+o+"search'>Search</button><table id='"+o+"browser'></table></div>";("string"==typeof n||n instanceof String)&&(n=document.getElementById(n)),n.insertAdjacentHTML("beforeend",s),document.getElementById(o+"search").onclick=function(){t.getGames(e,(function(e){var n="";e.gameInfo.forEach((function(t){n+="<tr><td>"+t.id+"</td><td>"+t.usernames.length+"</td><td><button id='"+t.id+"connect'>Connect</button>Spectate:<input id='"+o+"spectate' type='checkbox'></td></tr>"})),document.getElementById(o+"browser").insertAdjacentHTML("afterbegin",n),e.gameInfo.forEach((function(e){document.getElementById(e.id+"connect").onclick=function(){t.subscribeToGame(e.id,document.getElementById(o+"spectate").checked,void 0,(function(n){r(e),document.getElementById(o).insertAdjacentHTML("afterbegin","<button id='"+o+"disconnect'>Disconnect</button>"),document.getElementById(o+"disconnect").onclick=function(){t.unsubscribeFromGame(e.id,(function(){i(e);var t=document.getElementById(o+"disconnect");t.parentNode.removeChild(t)}))}}))}}))}))}},this.kickPlayerFromGame=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){};if(null!==t.socket&&1===t.socket.readyState){t.socket.send({cmd:["leaveGame",e,n],username:t.info.auth.username});var i=t.state.subscribe("commandResult",(function(o){if("leftGame"===o.msg&&o.appname===e){for(var s in t.state.data)s.indexOf(n)>-1&&(t.state.unsubscribeAll(s),t.state.data[s]=void 0);r(o),t.state.unsubscribe("commandResult",i)}}))}}},Fe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"freeeeg32_2",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["eegfft"],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{username:"guest"};Ee(this,t),Pe.call(this),this.info={deviceName:e,deviceType:null,streaming:o,streamParams:a,analysis:n,deviceNum:0,streamLoopTiming:100,streamCt:0,auth:c,sps:null,useFilters:r,useAtlas:!1,simulating:!1},this.device=null,this.deviceConfigs=[{name:"freeeeg32",cls:H},{name:"muse",cls:nt},{name:"hegduino",cls:bt},{name:"cyton",cls:Nt},{name:"webgazer",cls:zt},{name:"ganglion",cls:me}],this.socket=s,this.streamTable=[],this.filters=[],this.atlas=null,this.pipeToAtlas=i}return Ae(t,[{key:"onconnect",value:function(){}},{key:"ondisconnect",value:function(){}},{key:"configureDefaultStreamTable",value:function(){var t,e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=n;if(!0!==e.info.useAtlas);else{var i=!1;if(void 0!==(i="number"==typeof t?e.atlas.getEEGDataByChannel(t):e.atlas.getEEGDataByTag(t))){if("all"===r){if(0===i.count)return;if(r=i.count-i.lastRead,i.lastRead=i.count,0===r)return}if(i.filtered.length>0){var o=i.times.slice(i.times.length-r,i.times.length),s=i.filtered.slice(i.filtered.length-r,i.filtered.length);return{times:o,samples:s}}if(i.raw.length>0){var a=i.times.slice(i.times.length-r,i.times.length),c=i.raw.slice(i.raw.length-r,i.raw.length);return{times:a,samples:c}}return}}},i=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=n;if(!0!==e.info.useAtlas);else{var i=!1;if(void 0!==(i="number"==typeof t?e.atlas.getEEGFFTData(t):e.atlas.getEEGDataByTag(t))){if("all"===r){if(0===i.fftCount)return;if(r=i.fftCount-i.lastReadFFT,i.lastReadFFT=i.fftCount,0===r)return}var o=i.fftTimes.slice(i.fftTimes.length-r,i.fftTimes.length),s=i.ffts.slice(i.ffts.length-r,i.ffts.length);return{times:o,ffts:s}}}},o=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=n;if(!0!==e.info.useAtlas);else{console.log(t);var i=e.atlas.getCoherenceByTag(t);if(void 0!==i){if("all"===r){if(0===i.fftCount)return;if(r=i.fftCount-i.lastRead,i.lastRead=i.fftCount,0===r)return}var o=i.times.slice(i.fftTimes.length-r,i.fftTimes.length),s=i.ffts.slice(i.ffts.length-r,i.ffts.length);return{times:o,ffts:s}}}},s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=n;if(!0!==e.info.useAtlas);else{var o=e.atlas.getDeviceDataByTag("heg",t);if("all"===i&&(i=o.count-o.lastRead,o.lastRead=o.count,i<=0))return;if(void 0!==o){if(void 0!==r){var s=o.times.slice(o.times.length-i,o.times.length),a=o[r].slice(o.ffts.length-i,o.ffts.length),c={times:s};return c[r]=a,c}return o}}};this.streamTable=[{prop:"eegch",callback:r},{prop:"eegfft",callback:i},{prop:"eegcoherence",callback:o},{prop:"hegdata",callback:s}],n.length>0&&(t=this.streamTable).push.apply(t,we(n))}},{key:"addStreamFunc",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.streamtable.push({prop:t,callback:e})}},{key:"configureStreamParams",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[["prop","tag"]],e=[];t.forEach((function(t,n){e.push(t.join("_"))})),this.socket.send(JSON.stringify({cmd:["addProps",e],username:this.info.auth.username}))}},{key:"simulateData",value:function(){if(!0===this.info.simulating){for(var t=Math.floor(100*this.info.sps/1e3),e=0;e<t;e++);setTimeout(requestAnimationFrame(this.simulateData),100)}}}]),t}(),Pe=function(){var t=this;this.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.info,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.pipeToAtlas;t.deviceConfigs.find((function(r,i){if(e.deviceName.indexOf(r.name)>-1)return t.device=new r.cls(e.deviceName,t.onconnect,t.ondisconnect),t.device.init(e,n),t.atlas=t.device.atlas,t.filters=t.device.filters,null!==t.atlas&&(t.pipeToAtlas=!0,t.configureDefaultStreamTable(),!0===t.info.streaming&&t.streamLoop()),!0}))},this.connect=function(){t.device.connect()},this.disconnect=function(){t.device.disconnect()},this.sendDataToSocket=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[["prop","tag","arg1"]],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={username:t.info.auth.username,userData:{}};Object.assign(r.userData,n),e.forEach((function(e,n){t.streamTable.find((function(t,n){if(e[0].indexOf(t.prop)>-1){var i=e.slice(1),o=t.callback.apply(t,we(i));return void 0!==o&&(r.userData[e.join("_")]=o),!0}}))})),Object.keys(r.userData).length>0&&t.socket.send(JSON.stringify(r))},this.streamLoop=function(){if(!0===t.info.streaming){var e=[];if(0===t.info.streamParams.length)return console.error("No stream parameters set"),!1;t.info.streamParams.forEach((function(n,r){t.streamTable.find((function(t,r){if(t.prop===n[0])return e.push(n),!0}))})),e.length>0&&t.sendDataToSocket(e),t.info.streamCt++,setTimeout((function(){t.streamLoop()}),t.info.streamLoopTiming)}else t.info.streamCt=0}}})(),r})()}));