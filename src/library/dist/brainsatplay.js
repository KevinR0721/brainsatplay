/*! For license information please see brainsatplay.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.brainsatplay=e():t.brainsatplay=e()}(this,(function(){return(()=>{var t={7187:t=>{"use strict";var e,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};e=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var i=Number.isNaN||function(t){return t!=t};function a(){a.init.call(this)}t.exports=a,t.exports.once=function(t,e){return new Promise((function(n,r){function i(){void 0!==a&&t.removeListener("error",a),n([].slice.call(arguments))}var a;"error"!==e&&(a=function(n){t.removeListener(e,i),r(n)},t.once("error",a)),t.once(e,i)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function s(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function c(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function u(t,e,n,r){var i,a,o,u;if(s(n),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),a=t._events),o=a[e]),void 0===o)o=a[e]=n,++t._eventsCount;else if("function"==typeof o?o=a[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=c(t))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=o.length,u=l,console&&console.warn&&console.warn(u)}return t}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function f(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):p(i,i.length)}function d(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");o=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i="error"===t,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var c=a[t];if(void 0===c)return!1;if("function"==typeof c)r(c,this,e);else{var u=c.length,l=p(c,u);for(n=0;n<u;++n)r(l[n],this,e)}return!0},a.prototype.addListener=function(t,e){return u(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return u(this,t,e,!0)},a.prototype.once=function(t,e){return s(e),this.on(t,h(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){return s(e),this.prependListener(t,h(this,t,e)),this},a.prototype.removeListener=function(t,e){var n,r,i,a,o;if(s(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===e||n[a].listener===e){o=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,o||e)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,a=Object.keys(n);for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},a.prototype.listeners=function(t){return f(this,t,!0)},a.prototype.rawListeners=function(t){return f(this,t,!1)},a.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):d.call(t,e)},a.prototype.listenerCount=d,a.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},6123:t=>{!function(e){const n=2*Math.PI;var r;r=function(t,e){var r=Math.random(),i=Math.random(),a=Math.sqrt(-2*Math.log(r))*Math.cos(n*i);return Math.sqrt(-2*Math.log(r)),Math.sin(n*i),a*e+t},t.exports=r}()},1481:(t,e,n)=>{!function(e){const r=n(6123);var i=function(t){var e=Math.abs(t),n=1/(1+e/2),r=n*Math.exp(-e*e-1.26551223+n*(1.00002368+n*(.37409196+n*(.09678418+n*(n*(.27886807+n*(n*(1.48851587+n*(.17087277*n-.82215223))-1.13520398))-.18628806)))));return t>=0?r:2-r},a=function(t,e){if(e<=0)throw new Error("Variance must be > 0 (but was "+e+")");this.mean=t,this.variance=e,this.standardDeviation=Math.sqrt(e)};a.prototype.pdf=function(t){var e=this.standardDeviation*Math.sqrt(2*Math.PI);return Math.exp(-Math.pow(t-this.mean,2)/(2*this.variance))/e},a.prototype.cdf=function(t){return.5*i(-(t-this.mean)/(this.standardDeviation*Math.sqrt(2)))},a.prototype.ppf=function(t){return this.mean-this.standardDeviation*Math.sqrt(2)*function(t){if(t>=2)return-100;if(t<=0)return 100;for(var e=t<1?t:2-t,n=Math.sqrt(-2*Math.log(e/2)),r=-.70711*((2.30753+.27061*n)/(1+n*(.99229+.04481*n))-n),a=0;a<2;a++){var o=i(r)-e;r+=o/(1.1283791670955126*Math.exp(-r*r)-r*o)}return t<1?r:-r}(2*t)},a.prototype.mul=function(t){if("number"==typeof t)return this.scale(t);var e=1/this.variance,n=1/t.variance;return c(e+n,e*this.mean+n*t.mean)},a.prototype.div=function(t){if("number"==typeof t)return this.scale(1/t);var e=1/this.variance,n=1/t.variance;return c(e-n,e*this.mean-n*t.mean)},a.prototype.add=function(t){return s(this.mean+t.mean,this.variance+t.variance)},a.prototype.sub=function(t){return s(this.mean-t.mean,this.variance+t.variance)},a.prototype.scale=function(t){return s(this.mean*t,this.variance*t*t)},a.prototype.random=function(t){let e=this.mean,n=this.standardDeviation;return Array(t).fill(0).map((()=>r(e,n)))};var o,s=function(t,e){return new a(t,e)},c=function(t,e){return s(e/t,1/t)};o=s,t.exports=o}()},4139:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1717);function i(t){for(var e=[],n=0;n<t.length;n++)n%3==0?e.push(t[n]<<4|t[n+1]>>4):(e.push((15&t[n])<<8|t[n+1]),n++);return e}function a(t,e){function n(n){return{x:e*t.getInt16(n),y:e*t.getInt16(n+2),z:e*t.getInt16(n+4)}}return{sequenceId:t.getUint16(0),samples:[n(2),n(8),n(14)]}}e.parseControl=function(t){return t.pipe(r.concatMap((function(t){return t.split("")})),r.scan((function(t,e){return t.indexOf("}")>=0?e:t+e}),""),r.filter((function(t){return t.indexOf("}")>=0})),r.map((function(t){return JSON.parse(t)})))},e.decodeUnsigned12BitData=i,e.decodeEEGSamples=function(t){return i(t).map((function(t){return.48828125*(t-2048)}))},e.parseTelemetry=function(t){return{sequenceId:t.getUint16(0),batteryLevel:t.getUint16(2)/512,fuelGaugeVoltage:2.2*t.getUint16(4),temperature:t.getUint16(8)}},e.parseAccelerometer=function(t){return a(t,610352e-10)},e.parseGyroscope=function(t){return a(t,.0074768)}},7338:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,s)}c((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(4143),o=n(1717);e.decodeResponse=function(t){return(new TextDecoder).decode(t.subarray(1,1+t[0]))},e.encodeCommand=function(t){var e=(new TextEncoder).encode("X"+t+"\n");return e[0]=e.length-1,e},e.observableCharacteristic=function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,t.startNotifications()];case 1:return n.sent(),e=a.fromEvent(t.service.device,"gattserverdisconnected"),[2,a.fromEvent(t,"characteristicvaluechanged").pipe(o.takeUntil(e),o.map((function(t){return t.target.value})))]}}))}))}},1335:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4143),i=n(1717),a=n(2306);e.zipSamples=function(t){var e=[],n=null;return t.pipe(i.mergeMap((function(t){if(t.timestamp!==n&&(n=t.timestamp,e.length)){var i=r.from([e.slice()]);return e.splice(0,e.length,t),i}return e.push(t),r.from([])})),i.concat(r.from([e])),i.mergeMap((function(t){var e=t[0].samples.map((function(e,n){for(var r=[NaN,NaN,NaN,NaN,NaN],i=0,o=t;i<o.length;i++){var s=o[i];r[s.electrode]=s.samples[n]}return{data:r,index:t[0].index,timestamp:t[0].timestamp+1e3*n/a.EEG_FREQUENCY}}));return r.from(e)})))}},2306:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,s)}c((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(4143),o=n(1717),s=n(4139),c=n(7338),u=n(1335);e.zipSamples=u.zipSamples,e.MUSE_SERVICE=65165;var l=["273e0003-4c4d-454d-96be-f03bac821358","273e0004-4c4d-454d-96be-f03bac821358","273e0005-4c4d-454d-96be-f03bac821358","273e0006-4c4d-454d-96be-f03bac821358","273e0007-4c4d-454d-96be-f03bac821358"];e.EEG_FREQUENCY=256,e.channelNames=["TP9","AF7","AF8","TP10","AUX"];var h=function(){function t(){this.enableAux=!1,this.deviceName="",this.connectionStatus=new a.BehaviorSubject(!1),this.gatt=null,this.lastIndex=null,this.lastTimestamp=null}return t.prototype.connect=function(t){return r(this,void 0,void 0,(function(){var n,r,u,h,f,d,p,v,m,g,y,b,w,C,S,I,O=this;return i(this,(function(k){switch(k.label){case 0:return t?(this.gatt=t,[3,4]):[3,1];case 1:return[4,navigator.bluetooth.requestDevice({filters:[{services:[e.MUSE_SERVICE]}]})];case 2:return n=k.sent(),r=this,[4,n.gatt.connect()];case 3:r.gatt=k.sent(),k.label=4;case 4:return this.deviceName=this.gatt.device.name||null,[4,this.gatt.getPrimaryService(e.MUSE_SERVICE)];case 5:return u=k.sent(),a.fromEvent(this.gatt.device,"gattserverdisconnected").pipe(o.first()).subscribe((function(){O.gatt=null,O.connectionStatus.next(!1)})),h=this,[4,u.getCharacteristic("273e0001-4c4d-454d-96be-f03bac821358")];case 6:return h.controlChar=k.sent(),f=this,[4,c.observableCharacteristic(this.controlChar)];case 7:return f.rawControlData=k.sent().pipe(o.map((function(t){return c.decodeResponse(new Uint8Array(t.buffer))})),o.share()),this.controlResponses=s.parseControl(this.rawControlData),[4,u.getCharacteristic("273e000b-4c4d-454d-96be-f03bac821358")];case 8:return d=k.sent(),p=this,[4,c.observableCharacteristic(d)];case 9:return p.telemetryData=k.sent().pipe(o.map(s.parseTelemetry)),[4,u.getCharacteristic("273e0009-4c4d-454d-96be-f03bac821358")];case 10:return v=k.sent(),m=this,[4,c.observableCharacteristic(v)];case 11:return m.gyroscopeData=k.sent().pipe(o.map(s.parseGyroscope)),[4,u.getCharacteristic("273e000a-4c4d-454d-96be-f03bac821358")];case 12:return g=k.sent(),y=this,[4,c.observableCharacteristic(g)];case 13:y.accelerometerData=k.sent().pipe(o.map(s.parseAccelerometer)),this.eventMarkers=new a.Subject,this.eegCharacteristics=[],b=[],w=this.enableAux?l.length:4,C=function(t){var e,n,r,a;return i(this,(function(i){switch(i.label){case 0:return e=l[t],[4,u.getCharacteristic(e)];case 1:return n=i.sent(),a=(r=b).push,[4,c.observableCharacteristic(n)];case 2:return a.apply(r,[i.sent().pipe(o.map((function(e){var n=e.getUint16(0);return{electrode:t,index:n,samples:s.decodeEEGSamples(new Uint8Array(e.buffer).subarray(2)),timestamp:O.getTimestamp(n)}})))]),S.eegCharacteristics.push(n),[2]}}))},S=this,I=0,k.label=14;case 14:return I<w?[5,C(I)]:[3,17];case 15:k.sent(),k.label=16;case 16:return I++,[3,14];case 17:return this.eegReadings=a.merge.apply(void 0,b),this.connectionStatus.next(!0),[2]}}))}))},t.prototype.sendCommand=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.controlChar.writeValue(c.encodeCommand(t))];case 1:return e.sent(),[2]}}))}))},t.prototype.start=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return[4,this.pause()];case 1:return e.sent(),t=this.enableAux?"p20":"p21",[4,this.controlChar.writeValue(c.encodeCommand(t))];case 2:return e.sent(),[4,this.controlChar.writeValue(c.encodeCommand("s"))];case 3:return e.sent(),[4,this.resume()];case 4:return e.sent(),[2]}}))}))},t.prototype.pause=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.sendCommand("h")];case 1:return t.sent(),[2]}}))}))},t.prototype.resume=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.sendCommand("d")];case 1:return t.sent(),[2]}}))}))},t.prototype.deviceInfo=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return t=this.controlResponses.pipe(o.filter((function(t){return!!t.fw})),o.take(1)).toPromise(),[4,this.sendCommand("v1")];case 1:return e.sent(),[2,t]}}))}))},t.prototype.injectMarker=function(t,e){return void 0===e&&(e=(new Date).getTime()),r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.eventMarkers.next({value:t,timestamp:e})];case 1:return n.sent(),[2]}}))}))},t.prototype.disconnect=function(){this.gatt&&(this.lastIndex=null,this.lastTimestamp=null,this.gatt.disconnect(),this.connectionStatus.next(!1))},t.prototype.getTimestamp=function(t){var n=1/e.EEG_FREQUENCY*1e3*12;for(null!==this.lastIndex&&null!==this.lastTimestamp||(this.lastIndex=t,this.lastTimestamp=(new Date).getTime()-n);this.lastIndex-t>4096;)t+=65536;return t===this.lastIndex?this.lastTimestamp:t>this.lastIndex?(this.lastTimestamp+=n*(t-this.lastIndex),this.lastIndex=t,this.lastTimestamp):this.lastTimestamp-n*(this.lastIndex-t)},t}();e.MuseClient=h},4155:t=>{var e,n,r=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(t){if(e===setTimeout)return setTimeout(t,0);if((e===i||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:i}catch(t){e=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var s,c=[],u=!1,l=-1;function h(){u&&s&&(u=!1,s.length?c=s.concat(c):l=-1,c.length&&f())}function f(){if(!u){var t=o(h);u=!0;for(var e=c.length;e;){for(s=c,c=[];++l<e;)s&&s[l].run();l=-1,e=c.length}s=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function p(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new d(t,e)),1!==c.length||u||o(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},5666:t=>{var e=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),o=new E(r||[]);return a._invoke=function(t,e,n){var r=h;return function(i,a){if(r===d)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw a;return T()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=k(o,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var c=l(t,e,n);if("normal"===c.type){if(r=n.done?p:f,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(t,n,o),a}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var h="suspendedStart",f="suspendedYield",d="executing",p="completed",v={};function m(){}function g(){}function y(){}var b={};b[a]=function(){return this};var w=Object.getPrototypeOf,C=w&&w(w(_([])));C&&C!==n&&r.call(C,a)&&(b=C);var S=y.prototype=m.prototype=Object.create(b);function I(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function n(i,a,o,s){var c=l(t[i],t,a);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==typeof h&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):e.resolve(h).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function a(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(a,a):a()}}function k(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,k(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=l(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function B(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function _(t){if(t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:T}}function T(){return{value:e,done:!0}}return g.prototype=S.constructor=y,y.constructor=g,g.displayName=c(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,s,"GeneratorFunction")),t.prototype=Object.create(S),t},t.awrap=function(t){return{__await:t}},I(O.prototype),O.prototype[o]=function(){return this},t.AsyncIterator=O,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new O(u(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},I(S),c(S,s,"Generator"),S[a]=function(){return this},S.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=_,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),B(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;B(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:_(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}},7576:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4143);e.BehaviorSubject=r.BehaviorSubject},5345:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4143);e.Subject=r.Subject},969:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4143);e.fromEvent=r.fromEvent},5624:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1717);e.filter=r.filter},6097:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1717);e.first=r.first},1709:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1717);e.map=r.map},3895:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1717);e.mergeMap=r.mergeMap},6740:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1717);e.takeUntil=r.takeUntil},698:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1717);e.tap=r.tap},9122:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(7576))},8314:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(5345))},4143:(t,e,n)=>{"use strict";n.r(e),n.d(e,{ArgumentOutOfRangeError:()=>T.W,AsyncSubject:()=>l.c,BehaviorSubject:()=>c.X,ConnectableObservable:()=>i.c,EMPTY:()=>Q.E,EmptyError:()=>P.K,GroupedObservable:()=>a.T,NEVER:()=>ht,Notification:()=>k.P,NotificationKind:()=>k.W,ObjectUnsubscribedError:()=>A.N,Observable:()=>r.y,ReplaySubject:()=>u.t,Scheduler:()=>S.b,Subject:()=>s.xQ,Subscriber:()=>O.L,Subscription:()=>I.w,TimeoutError:()=>N.W,UnsubscriptionError:()=>D.B,VirtualAction:()=>C,VirtualTimeScheduler:()=>w,animationFrame:()=>b,animationFrameScheduler:()=>y,asap:()=>h.e,asapScheduler:()=>h.E,async:()=>f.P,asyncScheduler:()=>f.z,bindCallback:()=>L,bindNodeCallback:()=>U,combineLatest:()=>H.aj,concat:()=>W.z,config:()=>_t.v,defer:()=>Y.P,empty:()=>Q.c,forkJoin:()=>$,from:()=>J.D,fromEvent:()=>et,fromEventPattern:()=>rt,generate:()=>it,identity:()=>E.y,iif:()=>ot,interval:()=>ct,isObservable:()=>_,merge:()=>lt.T,never:()=>ft,noop:()=>B.Z,observable:()=>o.L,of:()=>dt.of,onErrorResumeNext:()=>pt,pairs:()=>vt,partition:()=>wt,pipe:()=>x.z,queue:()=>d.c,queueScheduler:()=>d.N,race:()=>Ct.S3,range:()=>St,scheduled:()=>Et.x,throwError:()=>Ot._,timer:()=>kt.H,using:()=>xt,zip:()=>Bt.$R});var r=n(2772),i=n(3140),a=n(1120),o=n(5050),s=n(211),c=n(9233),u=n(2630),l=n(364),h=n(6650),f=n(964),d=n(2546),p=n(5987),v=n(6114),m=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return p.ZT(e,t),e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0?t.prototype.requestAsyncId.call(this,e,n,r):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame((function(){return e.flush(null)}))))},e.prototype.recycleAsyncId=function(e,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,r);0===e.actions.length&&(cancelAnimationFrame(n),e.scheduled=void 0)},e}(v.o),g=n(8399),y=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p.ZT(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,r=-1,i=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++r<i&&(t=n.shift()));if(this.active=!1,e){for(;++r<i&&(t=n.shift());)t.unsubscribe();throw e}},e}(g.v))(m),b=y,w=function(t){function e(e,n){void 0===e&&(e=C),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=t.call(this,e,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return p.ZT(e,t),e.prototype.flush=function(){for(var t,e,n=this.actions,r=this.maxFrames;(e=n[0])&&e.delay<=r&&(n.shift(),this.frame=e.delay,!(t=e.execute(e.state,e.delay))););if(t){for(;e=n.shift();)e.unsubscribe();throw t}},e.frameTimeFactor=10,e}(g.v),C=function(t){function e(e,n,r){void 0===r&&(r=e.index+=1);var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.index=r,i.active=!0,i.index=e.index=r,i}return p.ZT(e,t),e.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return t.prototype.schedule.call(this,n,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},e.prototype.requestAsyncId=function(t,n,r){void 0===r&&(r=0),this.delay=t.frame+r;var i=t.actions;return i.push(this),i.sort(e.sortActions),!0},e.prototype.recycleAsyncId=function(t,e,n){void 0===n&&(n=0)},e.prototype._execute=function(e,n){if(!0===this.active)return t.prototype._execute.call(this,e,n)},e.sortActions=function(t,e){return t.delay===e.delay?t.index===e.index?0:t.index>e.index?1:-1:t.delay>e.delay?1:-1},e}(v.o),S=n(8725),I=n(8760),O=n(979),k=n(2632),x=n(2561),B=n(3306),E=n(3608);function _(t){return!!t&&(t instanceof r.y||"function"==typeof t.lift&&"function"==typeof t.subscribe)}var T=n(6565),P=n(6929),A=n(1016),D=n(8782),N=n(1462),F=n(5709),R=n(3642),j=n(9026),M=n(7507);function L(t,e,n){if(e){if(!(0,M.K)(e))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return L(t,n).apply(void 0,r).pipe((0,F.U)((function(t){return(0,j.k)(t)?e.apply(void 0,t):e(t)})))};n=e}return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var a,o=this,s={context:o,subject:a,callbackFunc:t,scheduler:n};return new r.y((function(r){if(n){var i={args:e,subscriber:r,params:s};return n.schedule(z,0,i)}if(!a){a=new l.c;try{t.apply(o,e.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a.next(t.length<=1?t[0]:t),a.complete()}]))}catch(t){(0,R._)(a)?a.error(t):console.warn(t)}}return a.subscribe(r)}))}}function z(t){var e=this,n=t.args,r=t.subscriber,i=t.params,a=i.callbackFunc,o=i.context,s=i.scheduler,c=i.subject;if(!c){c=i.subject=new l.c;try{a.apply(o,n.concat([function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t.length<=1?t[0]:t;e.add(s.schedule(G,0,{value:r,subject:c}))}]))}catch(t){c.error(t)}}this.add(c.subscribe(r))}function G(t){var e=t.value,n=t.subject;n.next(e),n.complete()}function U(t,e,n){if(e){if(!(0,M.K)(e))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return U(t,n).apply(void 0,r).pipe((0,F.U)((function(t){return(0,j.k)(t)?e.apply(void 0,t):e(t)})))};n=e}return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var a={subject:void 0,args:e,callbackFunc:t,scheduler:n,context:this};return new r.y((function(r){var i=a.context,o=a.subject;if(n)return n.schedule(V,0,{params:a,subscriber:r,context:i});if(!o){o=a.subject=new l.c;try{t.apply(i,e.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.shift();n?o.error(n):(o.next(t.length<=1?t[0]:t),o.complete())}]))}catch(t){(0,R._)(o)?o.error(t):console.warn(t)}}return o.subscribe(r)}))}}function V(t){var e=this,n=t.params,r=t.subscriber,i=t.context,a=n.callbackFunc,o=n.args,s=n.scheduler,c=n.subject;if(!c){c=n.subject=new l.c;try{a.apply(i,o.concat([function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t.shift();if(r)e.add(s.schedule(Z,0,{err:r,subject:c}));else{var i=t.length<=1?t[0]:t;e.add(s.schedule(q,0,{value:i,subject:c}))}}]))}catch(t){this.add(s.schedule(Z,0,{err:t,subject:c}))}}this.add(c.subscribe(r))}function q(t){var e=t.value,n=t.subject;n.next(e),n.complete()}function Z(t){var e=t.err;t.subject.error(e)}var H=n(5142),W=n(9795),Y=n(1410),Q=n(5631),K=n(2009),J=n(5760);function $(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){var n=t[0];if((0,j.k)(n))return X(n,null);if((0,K.K)(n)&&Object.getPrototypeOf(n)===Object.prototype){var r=Object.keys(n);return X(r.map((function(t){return n[t]})),r)}}if("function"==typeof t[t.length-1]){var i=t.pop();return X(t=1===t.length&&(0,j.k)(t[0])?t[0]:t,null).pipe((0,F.U)((function(t){return i.apply(void 0,t)})))}return X(t,null)}function X(t,e){return new r.y((function(n){var r=t.length;if(0!==r)for(var i=new Array(r),a=0,o=0,s=function(s){var c=(0,J.D)(t[s]),u=!1;n.add(c.subscribe({next:function(t){u||(u=!0,o++),i[s]=t},error:function(t){return n.error(t)},complete:function(){++a!==r&&u||(o===r&&n.next(e?e.reduce((function(t,e,n){return t[e]=i[n],t}),{}):i),n.complete())}}))},c=0;c<r;c++)s(c);else n.complete()}))}var tt=n(4156);function et(t,e,n,i){return(0,tt.m)(n)&&(i=n,n=void 0),i?et(t,e,n).pipe((0,F.U)((function(t){return(0,j.k)(t)?i.apply(void 0,t):i(t)}))):new r.y((function(r){nt(t,e,(function(t){arguments.length>1?r.next(Array.prototype.slice.call(arguments)):r.next(t)}),r,n)}))}function nt(t,e,n,r,i){var a;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){var o=t;t.addEventListener(e,n,i),a=function(){return o.removeEventListener(e,n,i)}}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){var s=t;t.on(e,n),a=function(){return s.off(e,n)}}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){var c=t;t.addListener(e,n),a=function(){return c.removeListener(e,n)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var u=0,l=t.length;u<l;u++)nt(t[u],e,n,r,i)}r.add(a)}function rt(t,e,n){return n?rt(t,e).pipe((0,F.U)((function(t){return(0,j.k)(t)?n.apply(void 0,t):n(t)}))):new r.y((function(n){var r,i=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.next(1===t.length?t[0]:t)};try{r=t(i)}catch(t){return void n.error(t)}if((0,tt.m)(e))return function(){return e(i,r)}}))}function it(t,e,n,i,a){var o,s;if(1==arguments.length){var c=t;s=c.initialState,e=c.condition,n=c.iterate,o=c.resultSelector||E.y,a=c.scheduler}else void 0===i||(0,M.K)(i)?(s=t,o=E.y,a=i):(s=t,o=i);return new r.y((function(t){var r=s;if(a)return a.schedule(at,0,{subscriber:t,iterate:n,condition:e,resultSelector:o,state:r});for(;;){if(e){var i=void 0;try{i=e(r)}catch(e){return void t.error(e)}if(!i){t.complete();break}}var c=void 0;try{c=o(r)}catch(e){return void t.error(e)}if(t.next(c),t.closed)break;try{r=n(r)}catch(e){return void t.error(e)}}}))}function at(t){var e=t.subscriber,n=t.condition;if(!e.closed){if(t.needIterate)try{t.state=t.iterate(t.state)}catch(t){return void e.error(t)}else t.needIterate=!0;if(n){var r=void 0;try{r=n(t.state)}catch(t){return void e.error(t)}if(!r)return void e.complete();if(e.closed)return}var i;try{i=t.resultSelector(t.state)}catch(t){return void e.error(t)}if(!e.closed&&(e.next(i),!e.closed))return this.schedule(t)}}function ot(t,e,n){return void 0===e&&(e=Q.E),void 0===n&&(n=Q.E),(0,Y.P)((function(){return t()?e:n}))}var st=n(5812);function ct(t,e){return void 0===t&&(t=0),void 0===e&&(e=f.P),(!(0,st.k)(t)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=f.P),new r.y((function(n){return n.add(e.schedule(ut,t,{subscriber:n,counter:0,period:t})),n}))}function ut(t){var e=t.subscriber,n=t.counter,r=t.period;e.next(n),this.schedule({subscriber:e,counter:n+1,period:r},r)}var lt=n(4370),ht=new r.y(B.Z);function ft(){return ht}var dt=n(8170);function pt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)return Q.E;var n=t[0],i=t.slice(1);return 1===t.length&&(0,j.k)(n)?pt.apply(void 0,n):new r.y((function(t){var e=function(){return t.add(pt.apply(void 0,i).subscribe(t))};return(0,J.D)(n).subscribe({next:function(e){t.next(e)},error:e,complete:e})}))}function vt(t,e){return e?new r.y((function(n){var r=Object.keys(t),i=new I.w;return i.add(e.schedule(mt,0,{keys:r,index:0,subscriber:n,subscription:i,obj:t})),i})):new r.y((function(e){for(var n=Object.keys(t),r=0;r<n.length&&!e.closed;r++){var i=n[r];t.hasOwnProperty(i)&&e.next([i,t[i]])}e.complete()}))}function mt(t){var e=t.keys,n=t.index,r=t.subscriber,i=t.subscription,a=t.obj;if(!r.closed)if(n<e.length){var o=e[n];r.next([o,a[o]]),i.add(this.schedule({keys:e,index:n+1,subscriber:r,subscription:i,obj:a}))}else r.complete()}var gt=n(8463),yt=n(7843),bt=n(6008);function wt(t,e,n){return[(0,bt.h)(e,n)(new r.y((0,yt.s)(t))),(0,bt.h)((0,gt.f)(e,n))(new r.y((0,yt.s)(t)))]}var Ct=n(8821);function St(t,e,n){return void 0===t&&(t=0),new r.y((function(r){void 0===e&&(e=t,t=0);var i=0,a=t;if(n)return n.schedule(It,0,{index:i,count:e,start:t,subscriber:r});for(;;){if(i++>=e){r.complete();break}if(r.next(a++),r.closed)break}}))}function It(t){var e=t.start,n=t.index,r=t.count,i=t.subscriber;n>=r?i.complete():(i.next(e),i.closed||(t.index=n+1,t.start=e+1,this.schedule(t)))}var Ot=n(4944),kt=n(9604);function xt(t,e){return new r.y((function(n){var r,i;try{r=t()}catch(t){return void n.error(t)}try{i=e(r)}catch(t){return void n.error(t)}var a=(i?(0,J.D)(i):Q.E).subscribe(n);return function(){a.unsubscribe(),r&&r.unsubscribe()}}))}var Bt=n(5080),Et=n(8107),_t=n(150)},364:(t,e,n)=>{"use strict";n.d(e,{c:()=>o});var r=n(5987),i=n(211),a=n(8760),o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=null,e.hasNext=!1,e.hasCompleted=!1,e}return r.ZT(e,t),e.prototype._subscribe=function(e){return this.hasError?(e.error(this.thrownError),a.w.EMPTY):this.hasCompleted&&this.hasNext?(e.next(this.value),e.complete(),a.w.EMPTY):t.prototype._subscribe.call(this,e)},e.prototype.next=function(t){this.hasCompleted||(this.value=t,this.hasNext=!0)},e.prototype.error=function(e){this.hasCompleted||t.prototype.error.call(this,e)},e.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&t.prototype.next.call(this,this.value),t.prototype.complete.call(this)},e}(i.xQ)},9233:(t,e,n)=>{"use strict";n.d(e,{X:()=>o});var r=n(5987),i=n(211),a=n(1016),o=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return r.ZT(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new a.N;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(i.xQ)},2632:(t,e,n)=>{"use strict";n.d(e,{W:()=>r,P:()=>s});var r,i=n(5631),a=n(8170),o=n(4944);r||(r={});var s=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){switch(this.kind){case"N":return(0,a.of)(this.value);case"E":return(0,o._)(this.error);case"C":return(0,i.c)()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}()},2772:(t,e,n)=>{"use strict";n.d(e,{y:()=>l});var r=n(3642),i=n(979),a=n(3142),o=n(2174),s=n(5050),c=n(2561),u=n(150),l=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,s=function(t,e,n){if(t){if(t instanceof i.L)return t;if(t[a.b])return t[a.b]()}return t||e||n?new i.L(t,e,n):new i.L(o.c)}(t,e,n);if(r?s.add(r.call(s,this.source)):s.add(this.source||u.v.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),u.v.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){u.v.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),(0,r._)(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=h(e))((function(e,r){var i;i=n.subscribe((function(e){try{t(e)}catch(t){r(t),i&&i.unsubscribe()}}),r,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[s.L]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:(0,c.U)(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=h(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function h(t){if(t||(t=u.v.Promise||Promise),!t)throw new Error("no Promise impl found");return t}},2174:(t,e,n)=>{"use strict";n.d(e,{c:()=>a});var r=n(150),i=n(1644),a={closed:!0,next:function(t){},error:function(t){if(r.v.useDeprecatedSynchronousErrorHandling)throw t;(0,i.z)(t)},complete:function(){}}},2039:(t,e,n)=>{"use strict";n.d(e,{L:()=>i});var r=n(5987),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.ZT(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(n(979).L)},2630:(t,e,n)=>{"use strict";n.d(e,{t:()=>l});var r=n(5987),i=n(211),a=n(2546),o=n(8760),s=n(9276),c=n(1016),u=n(8253),l=function(t){function e(e,n,r){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=e<1?1:e,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return r.ZT(e,t),e.prototype.nextInfiniteTimeWindow=function(e){if(!this.isStopped){var n=this._events;n.push(e),n.length>this._bufferSize&&n.shift()}t.prototype.next.call(this,e)},e.prototype.nextTimeWindow=function(e){this.isStopped||(this._events.push(new h(this._getNow(),e)),this._trimBufferThenGetEvents()),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,a=r.length;if(this.closed)throw new c.N;if(this.isStopped||this.hasError?e=o.w.EMPTY:(this.observers.push(t),e=new u.W(this,t)),i&&t.add(t=new s.ht(t,i)),n)for(var l=0;l<a&&!t.closed;l++)t.next(r[l]);else for(l=0;l<a&&!t.closed;l++)t.next(r[l].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},e.prototype._getNow=function(){return(this.scheduler||a.c).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,a=0;a<i&&!(t-r[a].time<n);)a++;return i>e&&(a=Math.max(a,i-e)),a>0&&r.splice(0,a),r},e}(i.xQ),h=function(){return function(t,e){this.time=t,this.value=e}}()},8725:(t,e,n)=>{"use strict";n.d(e,{b:()=>r});var r=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}()},211:(t,e,n)=>{"use strict";n.d(e,{Yc:()=>l,xQ:()=>h});var r=n(5987),i=n(2772),a=n(979),o=n(8760),s=n(1016),c=n(8253),u=n(3142),l=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return r.ZT(e,t),e}(a.L),h=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r.ZT(e,t),e.prototype[u.b]=function(){return new l(this)},e.prototype.lift=function(t){var e=new f(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new s.N;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].next(t)},e.prototype.error=function(t){if(this.closed)throw new s.N;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new s.N;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new s.N;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new s.N;return this.hasError?(t.error(this.thrownError),o.w.EMPTY):this.isStopped?(t.complete(),o.w.EMPTY):(this.observers.push(t),new c.W(this,t))},e.prototype.asObservable=function(){var t=new i.y;return t.source=this,t},e.create=function(t,e){return new f(t,e)},e}(i.y),f=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return r.ZT(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):o.w.EMPTY},e}(h)},8253:(t,e,n)=>{"use strict";n.d(e,{W:()=>i});var r=n(5987),i=function(t){function e(e,n){var r=t.call(this)||this;return r.subject=e,r.subscriber=n,r.closed=!1,r}return r.ZT(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(n(8760).w)},979:(t,e,n)=>{"use strict";n.d(e,{L:()=>l});var r=n(5987),i=n(4156),a=n(2174),o=n(8760),s=n(3142),c=n(150),u=n(1644),l=function(t){function e(n,r,i){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=a.c;break;case 1:if(!n){o.destination=a.c;break}if("object"==typeof n){n instanceof e?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new h(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new h(o,n,r,i)}return o}return r.ZT(e,t),e.prototype[s.b]=function(){return this},e.create=function(t,n,r){var i=new e(t,n,r);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(o.w),h=function(t){function e(e,n,r,o){var s,c=t.call(this)||this;c._parentSubscriber=e;var u=c;return(0,i.m)(n)?s=n:n&&(s=n.next,r=n.error,o=n.complete,n!==a.c&&(u=Object.create(n),(0,i.m)(u.unsubscribe)&&c.add(u.unsubscribe.bind(u)),u.unsubscribe=c.unsubscribe.bind(c))),c._context=u,c._next=s,c._error=r,c._complete=o,c}return r.ZT(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;c.v.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=c.v.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):(0,u.z)(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;(0,u.z)(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};c.v.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),c.v.useDeprecatedSynchronousErrorHandling)throw t;(0,u.z)(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!c.v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(e){return c.v.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):((0,u.z)(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(l)},8760:(t,e,n)=>{"use strict";n.d(e,{w:()=>s});var r=n(9026),i=n(2009),a=n(4156),o=n(8782),s=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this,s=n._parentOrParents,u=n._ctorUnsubscribe,l=n._unsubscribe,h=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,s instanceof t)s.remove(this);else if(null!==s)for(var f=0;f<s.length;++f)s[f].remove(this);if((0,a.m)(l)){u&&(this._unsubscribe=void 0);try{l.call(this)}catch(t){e=t instanceof o.B?c(t.errors):[t]}}if((0,r.k)(h)){f=-1;for(var d=h.length;++f<d;){var p=h[f];if((0,i.K)(p))try{p.unsubscribe()}catch(t){e=e||[],t instanceof o.B?e=e.concat(c(t.errors)):e.push(t)}}}if(e)throw new o.B(e)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof t){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var a=this._subscriptions;return null===a?this._subscriptions=[n]:a.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.EMPTY=((e=new t).closed=!0,e),t}();function c(t){return t.reduce((function(t,e){return t.concat(e instanceof o.B?e.errors:e)}),[])}},150:(t,e,n)=>{"use strict";n.d(e,{v:()=>i});var r=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack,r=t},get useDeprecatedSynchronousErrorHandling(){return r}}},7604:(t,e,n)=>{"use strict";n.d(e,{IY:()=>s,Ds:()=>c,ft:()=>u});var r=n(5987),i=n(979),a=n(2772),o=n(7843),s=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,n}return r.ZT(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(i.L),c=(i.L,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.ZT(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(i.L));function u(t,e){if(!e.closed){if(t instanceof a.y)return t.subscribe(e);var n;try{n=(0,o.s)(t)(e)}catch(t){e.error(t)}return n}}i.L},3140:(t,e,n)=>{"use strict";n.d(e,{c:()=>u,N:()=>l});var r=n(5987),i=n(211),a=n(2772),o=n(979),s=n(8760),c=n(3018),u=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return r.ZT(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new s.w).add(this.source.subscribe(new h(this.getSubject(),this))),t.closed&&(this._connection=null,t=s.w.EMPTY)),t},e.prototype.refCount=function(){return(0,c.x)()(this)},e}(a.y),l=function(){var t=u.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}}(),h=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return r.ZT(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(i.Yc);o.L},5142:(t,e,n)=>{"use strict";n.d(e,{aj:()=>l,Ms:()=>h});var r=n(5987),i=n(7507),a=n(9026),o=n(2039),s=n(2080),c=n(3375),u={};function l(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=void 0,r=void 0;return(0,i.K)(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&(0,a.k)(t[0])&&(t=t[0]),(0,c.n)(t,r).lift(new h(n))}var h=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new f(t,this.resultSelector))},t}(),f=function(t){function e(e,n){var r=t.call(this,e)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return r.ZT(e,t),e.prototype._next=function(t){this.values.push(u),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add((0,s.D)(this,r,void 0,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n){var r=this.values,i=r[n],a=this.toRespond?i===u?--this.toRespond:this.toRespond:0;r[n]=e,0===a&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(o.L)},9795:(t,e,n)=>{"use strict";n.d(e,{z:()=>a});var r=n(8170),i=n(2257);function a(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,i.u)()(r.of.apply(void 0,t))}},1410:(t,e,n)=>{"use strict";n.d(e,{P:()=>o});var r=n(2772),i=n(5760),a=n(5631);function o(t){return new r.y((function(e){var n;try{n=t()}catch(t){return void e.error(t)}return(n?(0,i.D)(n):(0,a.c)()).subscribe(e)}))}},5631:(t,e,n)=>{"use strict";n.d(e,{E:()=>i,c:()=>a});var r=n(2772),i=new r.y((function(t){return t.complete()}));function a(t){return t?function(t){return new r.y((function(e){return t.schedule((function(){return e.complete()}))}))}(t):i}},5760:(t,e,n)=>{"use strict";n.d(e,{D:()=>o});var r=n(2772),i=n(7843),a=n(8107);function o(t,e){return e?(0,a.x)(t,e):t instanceof r.y?t:new r.y((0,i.s)(t))}},3375:(t,e,n)=>{"use strict";n.d(e,{n:()=>o});var r=n(2772),i=n(6900),a=n(3109);function o(t,e){return e?(0,a.r)(t,e):new r.y((0,i.V)(t))}},4370:(t,e,n)=>{"use strict";n.d(e,{T:()=>s});var r=n(2772),i=n(7507),a=n(2556),o=n(3375);function s(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Number.POSITIVE_INFINITY,s=null,c=t[t.length-1];return(0,i.K)(c)?(s=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof c&&(n=t.pop()),null===s&&1===t.length&&t[0]instanceof r.y?t[0]:(0,a.J)(n)((0,o.n)(t,s))}},8170:(t,e,n)=>{"use strict";n.d(e,{of:()=>o});var r=n(7507),i=n(3375),a=n(3109);function o(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return(0,r.K)(n)?(t.pop(),(0,a.r)(t,n)):(0,i.n)(t)}},8821:(t,e,n)=>{"use strict";n.d(e,{S3:()=>c});var r=n(5987),i=n(9026),a=n(3375),o=n(2039),s=n(2080);function c(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){if(!(0,i.k)(t[0]))return t[0];t=t[0]}return(0,a.n)(t,void 0).lift(new u)}var u=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new l(t))},t}(),l=function(t){function e(e){var n=t.call(this,e)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}return r.ZT(e,t),e.prototype._next=function(t){this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{for(var n=0;n<e&&!this.hasFirst;n++){var r=t[n],i=(0,s.D)(this,r,void 0,n);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},e.prototype.notifyNext=function(t,e,n){if(!this.hasFirst){this.hasFirst=!0;for(var r=0;r<this.subscriptions.length;r++)if(r!==n){var i=this.subscriptions[r];i.unsubscribe(),this.remove(i)}this.subscriptions=null}this.destination.next(e)},e}(o.L)},4944:(t,e,n)=>{"use strict";n.d(e,{_:()=>i});var r=n(2772);function i(t,e){return e?new r.y((function(n){return e.schedule(a,0,{error:t,subscriber:n})})):new r.y((function(e){return e.error(t)}))}function a(t){var e=t.error;t.subscriber.error(e)}},9604:(t,e,n)=>{"use strict";n.d(e,{H:()=>s});var r=n(2772),i=n(964),a=n(5812),o=n(7507);function s(t,e,n){void 0===t&&(t=0);var s=-1;return(0,a.k)(e)?s=Number(e)<1?1:Number(e):(0,o.K)(e)&&(n=e),(0,o.K)(n)||(n=i.P),new r.y((function(e){var r=(0,a.k)(t)?t:+t-n.now();return n.schedule(c,r,{index:0,period:s,subscriber:e})}))}function c(t){var e=t.index,n=t.period,r=t.subscriber;if(r.next(e),!r.closed){if(-1===n)return r.complete();t.index=e+1,this.schedule(t,n)}}},5080:(t,e,n)=>{"use strict";n.d(e,{$R:()=>u,mx:()=>l});var r=n(5987),i=n(3375),a=n(9026),o=n(979),s=n(999),c=n(7604);function u(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return"function"==typeof n&&t.pop(),(0,i.n)(t,void 0).lift(new l(n))}var l=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new h(t,this.resultSelector))},t}(),h=function(t){function e(e,n,r){void 0===r&&(r=Object.create(null));var i=t.call(this,e)||this;return i.resultSelector=n,i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:void 0,i}return r.ZT(e,t),e.prototype._next=function(t){var e=this.iterators;(0,a.k)(t)?e.push(new d(t)):"function"==typeof t[s.hZ]?e.push(new f(t[s.hZ]())):e.push(new p(this.destination,this,t))},e.prototype._complete=function(){var t=this.iterators,e=t.length;if(this.unsubscribe(),0!==e){this.active=e;for(var n=0;n<e;n++){var r=t[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}else this.destination.complete()},e.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},e.prototype.checkIterators=function(){for(var t=this.iterators,e=t.length,n=this.destination,r=0;r<e;r++)if("function"==typeof(o=t[r]).hasValue&&!o.hasValue())return;var i=!1,a=[];for(r=0;r<e;r++){var o,s=(o=t[r]).next();if(o.hasCompleted()&&(i=!0),s.done)return void n.complete();a.push(s.value)}this.resultSelector?this._tryresultSelector(a):n.next(a),i&&n.complete()},e.prototype._tryresultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(o.L),f=function(){function t(t){this.iterator=t,this.nextResult=t.next()}return t.prototype.hasValue=function(){return!0},t.prototype.next=function(){var t=this.nextResult;return this.nextResult=this.iterator.next(),t},t.prototype.hasCompleted=function(){var t=this.nextResult;return Boolean(t&&t.done)},t}(),d=function(){function t(t){this.array=t,this.index=0,this.length=0,this.length=t.length}return t.prototype[s.hZ]=function(){return this},t.prototype.next=function(t){var e=this.index++,n=this.array;return e<this.length?{value:n[e],done:!1}:{value:null,done:!0}},t.prototype.hasValue=function(){return this.array.length>this.index},t.prototype.hasCompleted=function(){return this.array.length===this.index},t}(),p=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return r.ZT(e,t),e.prototype[s.hZ]=function(){return this},e.prototype.next=function(){var t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}},e.prototype.hasValue=function(){return this.buffer.length>0},e.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},e.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},e.prototype.notifyNext=function(t){this.buffer.push(t),this.parent.checkIterators()},e.prototype.subscribe=function(){return(0,c.ft)(this.observable,new c.IY(this))},e}(c.Ds)},2257:(t,e,n)=>{"use strict";n.d(e,{u:()=>i});var r=n(2556);function i(){return(0,r.J)(1)}},6008:(t,e,n)=>{"use strict";n.d(e,{h:()=>a});var r=n(5987),i=n(979);function a(t,e){return function(n){return n.lift(new o(t,e))}}var o=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.predicate,this.thisArg))},t}(),s=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return r.ZT(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(i.L)},1120:(t,e,n)=>{"use strict";n.d(e,{v:()=>c,T:()=>f});var r=n(5987),i=n(979),a=n(8760),o=n(2772),s=n(211);function c(t,e,n,r){return function(i){return i.lift(new u(t,e,n,r))}}var u=function(){function t(t,e,n,r){this.keySelector=t,this.elementSelector=e,this.durationSelector=n,this.subjectSelector=r}return t.prototype.call=function(t,e){return e.subscribe(new l(t,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},t}(),l=function(t){function e(e,n,r,i,a){var o=t.call(this,e)||this;return o.keySelector=n,o.elementSelector=r,o.durationSelector=i,o.subjectSelector=a,o.groups=null,o.attemptedToUnsubscribe=!1,o.count=0,o}return r.ZT(e,t),e.prototype._next=function(t){var e;try{e=this.keySelector(t)}catch(t){return void this.error(t)}this._group(t,e)},e.prototype._group=function(t,e){var n=this.groups;n||(n=this.groups=new Map);var r,i=n.get(e);if(this.elementSelector)try{r=this.elementSelector(t)}catch(t){this.error(t)}else r=t;if(!i){i=this.subjectSelector?this.subjectSelector():new s.xQ,n.set(e,i);var a=new f(e,i,this);if(this.destination.next(a),this.durationSelector){var o=void 0;try{o=this.durationSelector(new f(e,i))}catch(t){return void this.error(t)}this.add(o.subscribe(new h(e,i,this)))}}i.closed||i.next(r)},e.prototype._error=function(t){var e=this.groups;e&&(e.forEach((function(e,n){e.error(t)})),e.clear()),this.destination.error(t)},e.prototype._complete=function(){var t=this.groups;t&&(t.forEach((function(t,e){t.complete()})),t.clear()),this.destination.complete()},e.prototype.removeGroup=function(t){this.groups.delete(t)},e.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&t.prototype.unsubscribe.call(this))},e}(i.L),h=function(t){function e(e,n,r){var i=t.call(this,n)||this;return i.key=e,i.group=n,i.parent=r,i}return r.ZT(e,t),e.prototype._next=function(t){this.complete()},e.prototype._unsubscribe=function(){var t=this.parent,e=this.key;this.key=this.parent=null,t&&t.removeGroup(e)},e}(i.L),f=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.groupSubject=n,i.refCountSubscription=r,i}return r.ZT(e,t),e.prototype._subscribe=function(t){var e=new a.w,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&e.add(new d(n)),e.add(r.subscribe(t)),e},e}(o.y),d=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,e.count++,n}return r.ZT(e,t),e.prototype.unsubscribe=function(){var e=this.parent;e.closed||this.closed||(t.prototype.unsubscribe.call(this),e.count-=1,0===e.count&&e.attemptedToUnsubscribe&&e.unsubscribe())},e}(a.w)},5709:(t,e,n)=>{"use strict";n.d(e,{U:()=>a});var r=n(5987),i=n(979);function a(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new o(t,e))}}var o=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.project,this.thisArg))},t}(),s=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return r.ZT(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(i.L)},2556:(t,e,n)=>{"use strict";n.d(e,{J:()=>a});var r=n(7746),i=n(3608);function a(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),(0,r.zg)(i.y,t)}},7746:(t,e,n)=>{"use strict";n.d(e,{zg:()=>s,VS:()=>l});var r=n(5987),i=n(5709),a=n(5760),o=n(7604);function s(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(r){return r.pipe(s((function(n,r){return(0,a.D)(t(n,r)).pipe((0,i.U)((function(t,i){return e(n,t,r,i)})))}),n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new c(t,n))})}var c=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.project,this.concurrent))},t}(),u=function(t){function e(e,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=t.call(this,e)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return r.ZT(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new o.IY(this),n=this.destination;n.add(e);var r=(0,o.ft)(t,e);r!==e&&n.add(r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(o.Ds),l=s},9276:(t,e,n)=>{"use strict";n.d(e,{QV:()=>o,ht:()=>c});var r=n(5987),i=n(979),a=n(2632);function o(t,e){return void 0===e&&(e=0),function(n){return n.lift(new s(t,e))}}var s=function(){function t(t,e){void 0===e&&(e=0),this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.scheduler,this.delay))},t}(),c=function(t){function e(e,n,r){void 0===r&&(r=0);var i=t.call(this,e)||this;return i.scheduler=n,i.delay=r,i}return r.ZT(e,t),e.dispatch=function(t){var e=t.notification,n=t.destination;e.observe(n),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.destination.add(this.scheduler.schedule(e.dispatch,this.delay,new u(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(a.P.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(a.P.createError(t)),this.unsubscribe()},e.prototype._complete=function(){this.scheduleMessage(a.P.createComplete()),this.unsubscribe()},e}(i.L),u=function(){return function(t,e){this.notification=t,this.destination=e}}()},3018:(t,e,n)=>{"use strict";n.d(e,{x:()=>a});var r=n(5987),i=n(979);function a(){return function(t){return t.lift(new o(t))}}var o=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var r=new s(t,n),i=e.subscribe(r);return r.closed||(r.connection=n.connect()),i},t}(),s=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return r.ZT(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},e}(i.L)},3109:(t,e,n)=>{"use strict";n.d(e,{r:()=>a});var r=n(2772),i=n(8760);function a(t,e){return new r.y((function(n){var r=new i.w,a=0;return r.add(e.schedule((function(){a!==t.length?(n.next(t[a++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}},8107:(t,e,n)=>{"use strict";n.d(e,{x:()=>l});var r=n(2772),i=n(8760),a=n(5050),o=n(3109),s=n(999),c=n(336),u=n(9217);function l(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[a.L]}(t))return function(t,e){return new r.y((function(n){var r=new i.w;return r.add(e.schedule((function(){var i=t[a.L]();r.add(i.subscribe({next:function(t){r.add(e.schedule((function(){return n.next(t)})))},error:function(t){r.add(e.schedule((function(){return n.error(t)})))},complete:function(){r.add(e.schedule((function(){return n.complete()})))}}))}))),r}))}(t,e);if((0,c.t)(t))return function(t,e){return new r.y((function(n){var r=new i.w;return r.add(e.schedule((function(){return t.then((function(t){r.add(e.schedule((function(){n.next(t),r.add(e.schedule((function(){return n.complete()})))})))}),(function(t){r.add(e.schedule((function(){return n.error(t)})))}))}))),r}))}(t,e);if((0,u.z)(t))return(0,o.r)(t,e);if(function(t){return t&&"function"==typeof t[s.hZ]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new r.y((function(n){var r,a=new i.w;return a.add((function(){r&&"function"==typeof r.return&&r.return()})),a.add(e.schedule((function(){r=t[s.hZ](),a.add(e.schedule((function(){if(!n.closed){var t,e;try{var i=r.next();t=i.value,e=i.done}catch(t){return void n.error(t)}e?n.complete():(n.next(t),this.schedule())}})))}))),a}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}},6114:(t,e,n)=>{"use strict";n.d(e,{o:()=>i});var r=n(5987),i=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return r.ZT(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,r=void 0;try{this.work(t)}catch(t){n=!0,r=!!t&&t||new Error(t)}if(n)return this.unsubscribe(),r},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return r.ZT(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(n(8760).w))},8399:(t,e,n)=>{"use strict";n.d(e,{v:()=>a});var r=n(5987),i=n(8725),a=function(t){function e(n,r){void 0===r&&(r=i.b.now);var a=t.call(this,n,(function(){return e.delegate&&e.delegate!==a?e.delegate.now():r()}))||this;return a.actions=[],a.active=!1,a.scheduled=void 0,a}return r.ZT(e,t),e.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,r,i):t.prototype.schedule.call(this,n,r,i)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(i.b)},6650:(t,e,n)=>{"use strict";n.d(e,{e:()=>l,E:()=>u});var r=n(5987),i=1,a=function(){return Promise.resolve()}(),o={};function s(t){return t in o&&(delete o[t],!0)}var c=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return r.ZT(e,t),e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0?t.prototype.requestAsyncId.call(this,e,n,r):(e.actions.push(this),e.scheduled||(e.scheduled=(c=e.flush.bind(e,null),u=i++,o[u]=!0,a.then((function(){return s(u)&&c()})),u)));var c,u},e.prototype.recycleAsyncId=function(e,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,r);0===e.actions.length&&(s(n),e.scheduled=void 0)},e}(n(6114).o),u=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.ZT(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,r=-1,i=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++r<i&&(t=n.shift()));if(this.active=!1,e){for(;++r<i&&(t=n.shift());)t.unsubscribe();throw e}},e}(n(8399).v))(c),l=u},964:(t,e,n)=>{"use strict";n.d(e,{z:()=>i,P:()=>a});var r=n(6114),i=new(n(8399).v)(r.o),a=i},2546:(t,e,n)=>{"use strict";n.d(e,{c:()=>o,N:()=>a});var r=n(5987),i=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return r.ZT(e,t),e.prototype.schedule=function(e,n){return void 0===n&&(n=0),n>0?t.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,n){return n>0||this.closed?t.prototype.execute.call(this,e,n):this._execute(e,n)},e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?t.prototype.requestAsyncId.call(this,e,n,r):e.flush(this)},e}(n(6114).o),a=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.ZT(e,t),e}(n(8399).v))(i),o=a},999:(t,e,n)=>{"use strict";function r(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}n.d(e,{hZ:()=>i});var i=r()},5050:(t,e,n)=>{"use strict";n.d(e,{L:()=>r});var r=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}()},3142:(t,e,n)=>{"use strict";n.d(e,{b:()=>r});var r=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}()},6565:(t,e,n)=>{"use strict";n.d(e,{W:()=>r});var r=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}()},6929:(t,e,n)=>{"use strict";n.d(e,{K:()=>r});var r=function(){function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t}()},1016:(t,e,n)=>{"use strict";n.d(e,{N:()=>r});var r=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}()},1462:(t,e,n)=>{"use strict";n.d(e,{W:()=>r});var r=function(){function t(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return t.prototype=Object.create(Error.prototype),t}()},8782:(t,e,n)=>{"use strict";n.d(e,{B:()=>r});var r=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}()},3642:(t,e,n)=>{"use strict";n.d(e,{_:()=>i});var r=n(979);function i(t){for(;t;){var e=t,n=e.closed,i=e.destination,a=e.isStopped;if(n||a)return!1;t=i&&i instanceof r.L?i:null}return!0}},1644:(t,e,n)=>{"use strict";function r(t){setTimeout((function(){throw t}),0)}n.d(e,{z:()=>r})},3608:(t,e,n)=>{"use strict";function r(t){return t}n.d(e,{y:()=>r})},9026:(t,e,n)=>{"use strict";n.d(e,{k:()=>r});var r=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}()},9217:(t,e,n)=>{"use strict";n.d(e,{z:()=>r});var r=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t}},4156:(t,e,n)=>{"use strict";function r(t){return"function"==typeof t}n.d(e,{m:()=>r})},5812:(t,e,n)=>{"use strict";n.d(e,{k:()=>i});var r=n(9026);function i(t){return!(0,r.k)(t)&&t-parseFloat(t)+1>=0}},2009:(t,e,n)=>{"use strict";function r(t){return null!==t&&"object"==typeof t}n.d(e,{K:()=>r})},336:(t,e,n)=>{"use strict";function r(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}n.d(e,{t:()=>r})},7507:(t,e,n)=>{"use strict";function r(t){return t&&"function"==typeof t.schedule}n.d(e,{K:()=>r})},3306:(t,e,n)=>{"use strict";function r(){}n.d(e,{Z:()=>r})},8463:(t,e,n)=>{"use strict";function r(t,e){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=t,n.thisArg=e,n}n.d(e,{f:()=>r})},2561:(t,e,n)=>{"use strict";n.d(e,{z:()=>i,U:()=>a});var r=n(3608);function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return a(t)}function a(t){return 0===t.length?r.y:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}},7843:(t,e,n)=>{"use strict";n.d(e,{s:()=>l});var r=n(6900),i=n(1644),a=n(999),o=n(5050),s=n(9217),c=n(336),u=n(2009),l=function(t){if(t&&"function"==typeof t[o.L])return l=t,function(t){var e=l[o.L]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if((0,s.z)(t))return(0,r.V)(t);if((0,c.t)(t))return n=t,function(t){return n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,i.z),t};if(t&&"function"==typeof t[a.hZ])return e=t,function(t){for(var n=e[a.hZ]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t};var e,n,l,h=(0,u.K)(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+h+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},6900:(t,e,n)=>{"use strict";n.d(e,{V:()=>r});var r=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.complete()}}},2080:(t,e,n)=>{"use strict";n.d(e,{D:()=>s});var r=n(5987),i=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parent=e,i.outerValue=n,i.outerIndex=r,i.index=0,i}return r.ZT(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(n(979).L),a=n(7843),o=n(2772);function s(t,e,n,r,s){if(void 0===s&&(s=new i(t,n,r)),!s.closed)return e instanceof o.y?e.subscribe(s):(0,a.s)(e)(s)}},1717:(t,e,n)=>{"use strict";n.r(e),n.d(e,{audit:()=>a,auditTime:()=>l,buffer:()=>h,bufferCount:()=>v,bufferTime:()=>w,bufferToggle:()=>T,bufferWhen:()=>D,catchError:()=>R,combineAll:()=>z,combineLatest:()=>V,concat:()=>Z,concatAll:()=>H.u,concatMap:()=>Y,concatMapTo:()=>Q,count:()=>K,debounce:()=>X,debounceTime:()=>nt,defaultIfEmpty:()=>ot,delay:()=>ht,delayWhen:()=>mt,dematerialize:()=>Ct,distinct:()=>Ot,distinctUntilChanged:()=>Bt,distinctUntilKeyChanged:()=>Tt,elementAt:()=>Ut,endWith:()=>qt,every:()=>Zt,exhaust:()=>Yt,exhaustMap:()=>$t,expand:()=>ee,filter:()=>At.h,finalize:()=>ie,find:()=>se,findIndex:()=>le,first:()=>fe,flatMap:()=>W.VS,groupBy:()=>de.v,ignoreElements:()=>pe,isEmpty:()=>ge,last:()=>Ie,map:()=>Jt.U,mapTo:()=>Oe,materialize:()=>Be,max:()=>Fe,merge:()=>je,mergeAll:()=>Me.J,mergeMap:()=>W.zg,mergeMapTo:()=>Le,mergeScan:()=>ze,min:()=>Ve,multicast:()=>Ze,observeOn:()=>We.QV,onErrorResumeNext:()=>Ye,pairwise:()=>Je,partition:()=>en,pluck:()=>nn,publish:()=>on,publishBehavior:()=>cn,publishLast:()=>ln,publishReplay:()=>fn,race:()=>pn,reduce:()=>Ne,refCount:()=>Bn.x,repeat:()=>vn,repeatWhen:()=>yn,retry:()=>Cn,retryWhen:()=>On,sample:()=>En,sampleTime:()=>Pn,scan:()=>Te,sequenceEqual:()=>Fn,share:()=>zn,shareReplay:()=>Gn,single:()=>Un,skip:()=>Zn,skipLast:()=>Yn,skipUntil:()=>Jn,skipWhile:()=>tr,startWith:()=>rr,subscribeOn:()=>sr,switchAll:()=>fr,switchMap:()=>ur,switchMapTo:()=>dr,take:()=>Lt,takeLast:()=>we,takeUntil:()=>pr,takeWhile:()=>gr,tap:()=>Sr,throttle:()=>xr,throttleTime:()=>_r,throwIfEmpty:()=>Nt,timeInterval:()=>Nr,timeout:()=>Gr,timeoutWith:()=>jr,timestamp:()=>Ur,toArray:()=>Zr,window:()=>Hr,windowCount:()=>Qr,windowTime:()=>$r,windowToggle:()=>ai,windowWhen:()=>ci,withLatestFrom:()=>hi,zip:()=>vi,zipAll:()=>mi});var r=n(5987),i=n(7604);function a(t){return function(e){return e.lift(new o(t))}}var o=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.durationSelector))},t}(),s=function(t){function e(e,n){var r=t.call(this,e)||this;return r.durationSelector=n,r.hasValue=!1,r}return r.ZT(e,t),e.prototype._next=function(t){if(this.value=t,this.hasValue=!0,!this.throttled){var e=void 0;try{e=(0,this.durationSelector)(t)}catch(t){return this.destination.error(t)}var n=(0,i.ft)(e,new i.IY(this));!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}},e.prototype.clearThrottle=function(){var t=this,e=t.value,n=t.hasValue,r=t.throttled;r&&(this.remove(r),this.throttled=void 0,r.unsubscribe()),n&&(this.value=void 0,this.hasValue=!1,this.destination.next(e))},e.prototype.notifyNext=function(){this.clearThrottle()},e.prototype.notifyComplete=function(){this.clearThrottle()},e}(i.Ds),c=n(964),u=n(9604);function l(t,e){return void 0===e&&(e=c.P),a((function(){return(0,u.H)(t,e)}))}function h(t){return function(e){return e.lift(new f(t))}}var f=function(){function t(t){this.closingNotifier=t}return t.prototype.call=function(t,e){return e.subscribe(new d(t,this.closingNotifier))},t}(),d=function(t){function e(e,n){var r=t.call(this,e)||this;return r.buffer=[],r.add((0,i.ft)(n,new i.IY(r))),r}return r.ZT(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype.notifyNext=function(){var t=this.buffer;this.buffer=[],this.destination.next(t)},e}(i.Ds),p=n(979);function v(t,e){return void 0===e&&(e=null),function(n){return n.lift(new m(t,e))}}var m=function(){function t(t,e){this.bufferSize=t,this.startBufferEvery=e,this.subscriberClass=e&&t!==e?y:g}return t.prototype.call=function(t,e){return e.subscribe(new this.subscriberClass(t,this.bufferSize,this.startBufferEvery))},t}(),g=function(t){function e(e,n){var r=t.call(this,e)||this;return r.bufferSize=n,r.buffer=[],r}return r.ZT(e,t),e.prototype._next=function(t){var e=this.buffer;e.push(t),e.length==this.bufferSize&&(this.destination.next(e),this.buffer=[])},e.prototype._complete=function(){var e=this.buffer;e.length>0&&this.destination.next(e),t.prototype._complete.call(this)},e}(p.L),y=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.bufferSize=n,i.startBufferEvery=r,i.buffers=[],i.count=0,i}return r.ZT(e,t),e.prototype._next=function(t){var e=this,n=e.bufferSize,r=e.startBufferEvery,i=e.buffers,a=e.count;this.count++,a%r==0&&i.push([]);for(var o=i.length;o--;){var s=i[o];s.push(t),s.length===n&&(i.splice(o,1),this.destination.next(s))}},e.prototype._complete=function(){for(var e=this.buffers,n=this.destination;e.length>0;){var r=e.shift();r.length>0&&n.next(r)}t.prototype._complete.call(this)},e}(p.L),b=n(7507);function w(t){var e=arguments.length,n=c.P;(0,b.K)(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],e--);var r=null;e>=2&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return e>=3&&(i=arguments[2]),function(e){return e.lift(new C(t,r,i,n))}}var C=function(){function t(t,e,n,r){this.bufferTimeSpan=t,this.bufferCreationInterval=e,this.maxBufferSize=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new I(t,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},t}(),S=function(){return function(){this.buffer=[]}}(),I=function(t){function e(e,n,r,i,a){var o=t.call(this,e)||this;o.bufferTimeSpan=n,o.bufferCreationInterval=r,o.maxBufferSize=i,o.scheduler=a,o.contexts=[];var s=o.openContext();if(o.timespanOnly=null==r||r<0,o.timespanOnly){var c={subscriber:o,context:s,bufferTimeSpan:n};o.add(s.closeAction=a.schedule(O,n,c))}else{var u={subscriber:o,context:s},l={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:o,scheduler:a};o.add(s.closeAction=a.schedule(x,n,u)),o.add(a.schedule(k,r,l))}return o}return r.ZT(e,t),e.prototype._next=function(t){for(var e,n=this.contexts,r=n.length,i=0;i<r;i++){var a=n[i],o=a.buffer;o.push(t),o.length==this.maxBufferSize&&(e=a)}e&&this.onBufferFull(e)},e.prototype._error=function(e){this.contexts.length=0,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts,n=this.destination;e.length>0;){var r=e.shift();n.next(r.buffer)}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.contexts=null},e.prototype.onBufferFull=function(t){this.closeContext(t);var e=t.closeAction;if(e.unsubscribe(),this.remove(e),!this.closed&&this.timespanOnly){t=this.openContext();var n=this.bufferTimeSpan,r={subscriber:this,context:t,bufferTimeSpan:n};this.add(t.closeAction=this.scheduler.schedule(O,n,r))}},e.prototype.openContext=function(){var t=new S;return this.contexts.push(t),t},e.prototype.closeContext=function(t){this.destination.next(t.buffer);var e=this.contexts;(e?e.indexOf(t):-1)>=0&&e.splice(e.indexOf(t),1)},e}(p.L);function O(t){var e=t.subscriber,n=t.context;n&&e.closeContext(n),e.closed||(t.context=e.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function k(t){var e=t.bufferCreationInterval,n=t.bufferTimeSpan,r=t.subscriber,i=t.scheduler,a=r.openContext();r.closed||(r.add(a.closeAction=i.schedule(x,n,{subscriber:r,context:a})),this.schedule(t,e))}function x(t){var e=t.subscriber,n=t.context;e.closeContext(n)}var B=n(8760),E=n(2080),_=n(2039);function T(t,e){return function(n){return n.lift(new P(t,e))}}var P=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new A(t,this.openings,this.closingSelector))},t}(),A=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.closingSelector=r,i.contexts=[],i.add((0,E.D)(i,n)),i}return r.ZT(e,t),e.prototype._next=function(t){for(var e=this.contexts,n=e.length,r=0;r<n;r++)e[r].buffer.push(t)},e.prototype._error=function(e){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts;e.length>0;){var n=e.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e){t?this.closeBuffer(t):this.openBuffer(e)},e.prototype.notifyComplete=function(t){this.closeBuffer(t.context)},e.prototype.openBuffer=function(t){try{var e=this.closingSelector.call(this,t);e&&this.trySubscribe(e)}catch(t){this._error(t)}},e.prototype.closeBuffer=function(t){var e=this.contexts;if(e&&t){var n=t.buffer,r=t.subscription;this.destination.next(n),e.splice(e.indexOf(t),1),this.remove(r),r.unsubscribe()}},e.prototype.trySubscribe=function(t){var e=this.contexts,n=new B.w,r={buffer:[],subscription:n};e.push(r);var i=(0,E.D)(this,t,r);!i||i.closed?this.closeBuffer(r):(i.context=r,this.add(i),n.add(i))},e}(_.L);function D(t){return function(e){return e.lift(new N(t))}}var N=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new F(t,this.closingSelector))},t}(),F=function(t){function e(e,n){var r=t.call(this,e)||this;return r.closingSelector=n,r.subscribing=!1,r.openBuffer(),r}return r.ZT(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype._complete=function(){var e=this.buffer;e&&this.destination.next(e),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.buffer=void 0,this.subscribing=!1},e.prototype.notifyNext=function(){this.openBuffer()},e.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},e.prototype.openBuffer=function(){var t=this.closingSubscription;t&&(this.remove(t),t.unsubscribe());var e,n=this.buffer;this.buffer&&this.destination.next(n),this.buffer=[];try{e=(0,this.closingSelector)()}catch(t){return this.error(t)}t=new B.w,this.closingSubscription=t,this.add(t),this.subscribing=!0,t.add((0,i.ft)(e,new i.IY(this))),this.subscribing=!1},e}(i.Ds);function R(t){return function(e){var n=new j(t),r=e.lift(n);return n.caught=r}}var j=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new M(t,this.selector,this.caught))},t}(),M=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.selector=n,i.caught=r,i}return r.ZT(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle();var r=new i.IY(this);this.add(r);var a=(0,i.ft)(n,r);a!==r&&this.add(a)}},e}(i.Ds),L=n(5142);function z(t){return function(e){return e.lift(new L.Ms(t))}}var G=n(9026),U=n(5760);function V(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=null;return"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&(0,G.k)(t[0])&&(t=t[0].slice()),function(e){return e.lift.call((0,U.D)([e].concat(t)),new L.Ms(n))}}var q=n(9795);function Z(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return e.lift.call(q.z.apply(void 0,[e].concat(t)))}}var H=n(2257),W=n(7746);function Y(t,e){return(0,W.zg)(t,e,1)}function Q(t,e){return Y((function(){return t}),e)}function K(t){return function(e){return e.lift(new J(t,e))}}var J=function(){function t(t,e){this.predicate=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new $(t,this.predicate,this.source))},t}(),$=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.source=r,i.count=0,i.index=0,i}return r.ZT(e,t),e.prototype._next=function(t){this.predicate?this._tryPredicate(t):this.count++},e.prototype._tryPredicate=function(t){var e;try{e=this.predicate(t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e&&this.count++},e.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},e}(p.L);function X(t){return function(e){return e.lift(new tt(t))}}var tt=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new et(t,this.durationSelector))},t}(),et=function(t){function e(e,n){var r=t.call(this,e)||this;return r.durationSelector=n,r.hasValue=!1,r}return r.ZT(e,t),e.prototype._next=function(t){try{var e=this.durationSelector.call(this,t);e&&this._tryNext(t,e)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.emitValue(),this.destination.complete()},e.prototype._tryNext=function(t,e){var n=this.durationSubscription;this.value=t,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=(0,i.ft)(e,new i.IY(this)))&&!n.closed&&this.add(this.durationSubscription=n)},e.prototype.notifyNext=function(){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){if(this.hasValue){var e=this.value,n=this.durationSubscription;n&&(this.durationSubscription=void 0,n.unsubscribe(),this.remove(n)),this.value=void 0,this.hasValue=!1,t.prototype._next.call(this,e)}},e}(i.Ds);function nt(t,e){return void 0===e&&(e=c.P),function(n){return n.lift(new rt(t,e))}}var rt=function(){function t(t,e){this.dueTime=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new it(t,this.dueTime,this.scheduler))},t}(),it=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return r.ZT(e,t),e.prototype._next=function(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(at,this.dueTime,this))},e.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},e.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var t=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}},e.prototype.clearDebounce=function(){var t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)},e}(p.L);function at(t){t.debouncedNext()}function ot(t){return void 0===t&&(t=null),function(e){return e.lift(new st(t))}}var st=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new ct(t,this.defaultValue))},t}(),ct=function(t){function e(e,n){var r=t.call(this,e)||this;return r.defaultValue=n,r.isEmpty=!0,r}return r.ZT(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(p.L);function ut(t){return t instanceof Date&&!isNaN(+t)}var lt=n(2632);function ht(t,e){void 0===e&&(e=c.P);var n=ut(t)?+t-e.now():Math.abs(t);return function(t){return t.lift(new ft(n,e))}}var ft=function(){function t(t,e){this.delay=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new dt(t,this.delay,this.scheduler))},t}(),dt=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return r.ZT(e,t),e.dispatch=function(t){for(var e=t.source,n=e.queue,r=t.scheduler,i=t.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var a=Math.max(0,n[0].time-r.now());this.schedule(t,a)}else this.unsubscribe(),e.active=!1},e.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},e.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler,n=new pt(e.now()+this.delay,t);this.queue.push(n),!1===this.active&&this._schedule(e)}},e.prototype._next=function(t){this.scheduleNotification(lt.P.createNext(t))},e.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(lt.P.createComplete()),this.unsubscribe()},e}(p.L),pt=function(){return function(t,e){this.time=t,this.notification=e}}(),vt=n(2772);function mt(t,e){return e?function(n){return new bt(n,e).lift(new gt(t))}:function(e){return e.lift(new gt(t))}}var gt=function(){function t(t){this.delayDurationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new yt(t,this.delayDurationSelector))},t}(),yt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}return r.ZT(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(t),this.removeSubscription(i),this.tryComplete()},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype.notifyComplete=function(t){var e=this.removeSubscription(t);e&&this.destination.next(e),this.tryComplete()},e.prototype._next=function(t){var e=this.index++;try{var n=this.delayDurationSelector(t,e);n&&this.tryDelay(n,t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},e.prototype.removeSubscription=function(t){t.unsubscribe();var e=this.delayNotifierSubscriptions.indexOf(t);return-1!==e&&this.delayNotifierSubscriptions.splice(e,1),t.outerValue},e.prototype.tryDelay=function(t,e){var n=(0,E.D)(this,t,e);n&&!n.closed&&(this.destination.add(n),this.delayNotifierSubscriptions.push(n))},e.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},e}(_.L),bt=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subscriptionDelay=n,r}return r.ZT(e,t),e.prototype._subscribe=function(t){this.subscriptionDelay.subscribe(new wt(t,this.source))},e}(vt.y),wt=function(t){function e(e,n){var r=t.call(this)||this;return r.parent=e,r.source=n,r.sourceSubscribed=!1,r}return r.ZT(e,t),e.prototype._next=function(t){this.subscribeToSource()},e.prototype._error=function(t){this.unsubscribe(),this.parent.error(t)},e.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},e.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},e}(p.L);function Ct(){return function(t){return t.lift(new St)}}var St=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new It(t))},t}(),It=function(t){function e(e){return t.call(this,e)||this}return r.ZT(e,t),e.prototype._next=function(t){t.observe(this.destination)},e}(p.L);function Ot(t,e){return function(n){return n.lift(new kt(t,e))}}var kt=function(){function t(t,e){this.keySelector=t,this.flushes=e}return t.prototype.call=function(t,e){return e.subscribe(new xt(t,this.keySelector,this.flushes))},t}(),xt=function(t){function e(e,n,r){var a=t.call(this,e)||this;return a.keySelector=n,a.values=new Set,r&&a.add((0,i.ft)(r,new i.IY(a))),a}return r.ZT(e,t),e.prototype.notifyNext=function(){this.values.clear()},e.prototype.notifyError=function(t){this._error(t)},e.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},e.prototype._useKeySelector=function(t){var e,n=this.destination;try{e=this.keySelector(t)}catch(t){return void n.error(t)}this._finalizeNext(e,t)},e.prototype._finalizeNext=function(t,e){var n=this.values;n.has(t)||(n.add(t),this.destination.next(e))},e}(i.Ds);function Bt(t,e){return function(n){return n.lift(new Et(t,e))}}var Et=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new _t(t,this.compare,this.keySelector))},t}(),_t=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return r.ZT(e,t),e.prototype.compare=function(t,e){return t===e},e.prototype._next=function(t){var e;try{var n=this.keySelector;e=n?n(t):t}catch(t){return this.destination.error(t)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;r||(this.key=e,this.destination.next(t))},e}(p.L);function Tt(t,e){return Bt((function(n,r){return e?e(n[t],r[t]):n[t]===r[t]}))}var Pt=n(6565),At=n(6008),Dt=n(6929);function Nt(t){return void 0===t&&(t=jt),function(e){return e.lift(new Ft(t))}}var Ft=function(){function t(t){this.errorFactory=t}return t.prototype.call=function(t,e){return e.subscribe(new Rt(t,this.errorFactory))},t}(),Rt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.errorFactory=n,r.hasValue=!1,r}return r.ZT(e,t),e.prototype._next=function(t){this.hasValue=!0,this.destination.next(t)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var t=void 0;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)},e}(p.L);function jt(){return new Dt.K}var Mt=n(5631);function Lt(t){return function(e){return 0===t?(0,Mt.c)():e.lift(new zt(t))}}var zt=function(){function t(t){if(this.total=t,this.total<0)throw new Pt.W}return t.prototype.call=function(t,e){return e.subscribe(new Gt(t,this.total))},t}(),Gt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return r.ZT(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(p.L);function Ut(t,e){if(t<0)throw new Pt.W;var n=arguments.length>=2;return function(r){return r.pipe((0,At.h)((function(e,n){return n===t})),Lt(1),n?ot(e):Nt((function(){return new Pt.W})))}}var Vt=n(8170);function qt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return(0,q.z)(e,Vt.of.apply(void 0,t))}}function Zt(t,e){return function(n){return n.lift(new Ht(t,e,n))}}var Ht=function(){function t(t,e,n){this.predicate=t,this.thisArg=e,this.source=n}return t.prototype.call=function(t,e){return e.subscribe(new Wt(t,this.predicate,this.thisArg,this.source))},t}(),Wt=function(t){function e(e,n,r,i){var a=t.call(this,e)||this;return a.predicate=n,a.thisArg=r,a.source=i,a.index=0,a.thisArg=r||a,a}return r.ZT(e,t),e.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},e.prototype._next=function(t){var e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e||this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(p.L);function Yt(){return function(t){return t.lift(new Qt)}}var Qt=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Kt(t))},t}(),Kt=function(t){function e(e){var n=t.call(this,e)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}return r.ZT(e,t),e.prototype._next=function(t){this.hasSubscription||(this.hasSubscription=!0,this.add((0,i.ft)(t,new i.IY(this))))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},e.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}(i.Ds),Jt=n(5709);function $t(t,e){return e?function(n){return n.pipe($t((function(n,r){return(0,U.D)(t(n,r)).pipe((0,Jt.U)((function(t,i){return e(n,t,r,i)})))})))}:function(e){return e.lift(new Xt(t))}}var Xt=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new te(t,this.project))},t}(),te=function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}return r.ZT(e,t),e.prototype._next=function(t){this.hasSubscription||this.tryNext(t)},e.prototype.tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.hasSubscription=!0,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new i.IY(this),n=this.destination;n.add(e);var r=(0,i.ft)(t,e);r!==e&&n.add(r)},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}(i.Ds);function ee(t,e,n){return void 0===e&&(e=Number.POSITIVE_INFINITY),e=(e||0)<1?Number.POSITIVE_INFINITY:e,function(r){return r.lift(new ne(t,e,n))}}var ne=function(){function t(t,e,n){this.project=t,this.concurrent=e,this.scheduler=n}return t.prototype.call=function(t,e){return e.subscribe(new re(t,this.project,this.concurrent,this.scheduler))},t}(),re=function(t){function e(e,n,r,i){var a=t.call(this,e)||this;return a.project=n,a.concurrent=r,a.scheduler=i,a.index=0,a.active=0,a.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(a.buffer=[]),a}return r.ZT(e,t),e.dispatch=function(t){var e=t.subscriber,n=t.result,r=t.value,i=t.index;e.subscribeToProjection(n,r,i)},e.prototype._next=function(t){var n=this.destination;if(n.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){n.next(t);try{var i=(0,this.project)(t,r);if(this.scheduler){var a={subscriber:this,result:i,value:t,index:r};this.destination.add(this.scheduler.schedule(e.dispatch,0,a))}else this.subscribeToProjection(i,t,r)}catch(t){n.error(t)}}else this.buffer.push(t)}},e.prototype.subscribeToProjection=function(t,e,n){this.active++,this.destination.add((0,i.ft)(t,new i.IY(this)))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this._next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},e}(i.Ds);function ie(t){return function(e){return e.lift(new ae(t))}}var ae=function(){function t(t){this.callback=t}return t.prototype.call=function(t,e){return e.subscribe(new oe(t,this.callback))},t}(),oe=function(t){function e(e,n){var r=t.call(this,e)||this;return r.add(new B.w(n)),r}return r.ZT(e,t),e}(p.L);function se(t,e){if("function"!=typeof t)throw new TypeError("predicate is not a function");return function(n){return n.lift(new ce(t,n,!1,e))}}var ce=function(){function t(t,e,n,r){this.predicate=t,this.source=e,this.yieldIndex=n,this.thisArg=r}return t.prototype.call=function(t,e){return e.subscribe(new ue(t,this.predicate,this.source,this.yieldIndex,this.thisArg))},t}(),ue=function(t){function e(e,n,r,i,a){var o=t.call(this,e)||this;return o.predicate=n,o.source=r,o.yieldIndex=i,o.thisArg=a,o.index=0,o}return r.ZT(e,t),e.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete(),this.unsubscribe()},e.prototype._next=function(t){var e=this.predicate,n=this.thisArg,r=this.index++;try{e.call(n||this,t,r,this.source)&&this.notifyComplete(this.yieldIndex?r:t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},e}(p.L);function le(t,e){return function(n){return n.lift(new ce(t,n,!0,e))}}var he=n(3608);function fe(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?(0,At.h)((function(e,n){return t(e,n,r)})):he.y,Lt(1),n?ot(e):Nt((function(){return new Dt.K})))}}var de=n(1120);function pe(){return function(t){return t.lift(new ve)}}var ve=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new me(t))},t}(),me=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.ZT(e,t),e.prototype._next=function(t){},e}(p.L);function ge(){return function(t){return t.lift(new ye)}}var ye=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new be(t))},t}(),be=function(t){function e(e){return t.call(this,e)||this}return r.ZT(e,t),e.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype._next=function(t){this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(p.L);function we(t){return function(e){return 0===t?(0,Mt.c)():e.lift(new Ce(t))}}var Ce=function(){function t(t){if(this.total=t,this.total<0)throw new Pt.W}return t.prototype.call=function(t,e){return e.subscribe(new Se(t,this.total))},t}(),Se=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.ring=new Array,r.count=0,r}return r.ZT(e,t),e.prototype._next=function(t){var e=this.ring,n=this.total,r=this.count++;e.length<n?e.push(t):e[r%n]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var a=e++%n;t.next(r[a])}t.complete()},e}(p.L);function Ie(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?(0,At.h)((function(e,n){return t(e,n,r)})):he.y,we(1),n?ot(e):Nt((function(){return new Dt.K})))}}function Oe(t){return function(e){return e.lift(new ke(t))}}var ke=function(){function t(t){this.value=t}return t.prototype.call=function(t,e){return e.subscribe(new xe(t,this.value))},t}(),xe=function(t){function e(e,n){var r=t.call(this,e)||this;return r.value=n,r}return r.ZT(e,t),e.prototype._next=function(t){this.destination.next(this.value)},e}(p.L);function Be(){return function(t){return t.lift(new Ee)}}var Ee=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new _e(t))},t}(),_e=function(t){function e(e){return t.call(this,e)||this}return r.ZT(e,t),e.prototype._next=function(t){this.destination.next(lt.P.createNext(t))},e.prototype._error=function(t){var e=this.destination;e.next(lt.P.createError(t)),e.complete()},e.prototype._complete=function(){var t=this.destination;t.next(lt.P.createComplete()),t.complete()},e}(p.L);function Te(t,e){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Pe(t,e,n))}}var Pe=function(){function t(t,e,n){void 0===n&&(n=!1),this.accumulator=t,this.seed=e,this.hasSeed=n}return t.prototype.call=function(t,e){return e.subscribe(new Ae(t,this.accumulator,this.seed,this.hasSeed))},t}(),Ae=function(t){function e(e,n,r,i){var a=t.call(this,e)||this;return a.accumulator=n,a._seed=r,a.hasSeed=i,a.index=0,a}return r.ZT(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.accumulator(this.seed,t,n)}catch(t){this.destination.error(t)}this.seed=e,this.destination.next(e)},e}(p.L),De=n(2561);function Ne(t,e){return arguments.length>=2?function(n){return(0,De.z)(Te(t,e),we(1),ot(e))(n)}:function(e){return(0,De.z)(Te((function(e,n,r){return t(e,n,r+1)})),we(1))(e)}}function Fe(t){return Ne("function"==typeof t?function(e,n){return t(e,n)>0?e:n}:function(t,e){return t>e?t:e})}var Re=n(4370);function je(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return e.lift.call(Re.T.apply(void 0,[e].concat(t)))}}var Me=n(2556);function Le(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?(0,W.zg)((function(){return t}),e,n):("number"==typeof e&&(n=e),(0,W.zg)((function(){return t}),n))}function ze(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return r.lift(new Ge(t,e,n))}}var Ge=function(){function t(t,e,n){this.accumulator=t,this.seed=e,this.concurrent=n}return t.prototype.call=function(t,e){return e.subscribe(new Ue(t,this.accumulator,this.seed,this.concurrent))},t}(),Ue=function(t){function e(e,n,r,i){var a=t.call(this,e)||this;return a.accumulator=n,a.acc=r,a.concurrent=i,a.hasValue=!1,a.hasCompleted=!1,a.buffer=[],a.active=0,a.index=0,a}return r.ZT(e,t),e.prototype._next=function(t){if(this.active<this.concurrent){var e=this.index++,n=this.destination,r=void 0;try{r=(0,this.accumulator)(this.acc,t,e)}catch(t){return n.error(t)}this.active++,this._innerSub(r)}else this.buffer.push(t)},e.prototype._innerSub=function(t){var e=new i.IY(this),n=this.destination;n.add(e);var r=(0,i.ft)(t,e);r!==e&&n.add(r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},e.prototype.notifyNext=function(t){var e=this.destination;this.acc=t,this.hasValue=!0,e.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},e}(i.Ds);function Ve(t){return Ne("function"==typeof t?function(e,n){return t(e,n)<0?e:n}:function(t,e){return t<e?t:e})}var qe=n(3140);function Ze(t,e){return function(n){var r;if(r="function"==typeof t?t:function(){return t},"function"==typeof e)return n.lift(new He(r,e));var i=Object.create(n,qe.N);return i.source=n,i.subjectFactory=r,i}}var He=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(t);return i.add(e.subscribe(r)),i},t}(),We=n(9276);function Ye(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 1===t.length&&(0,G.k)(t[0])&&(t=t[0]),function(e){return e.lift(new Qe(t))}}var Qe=function(){function t(t){this.nextSources=t}return t.prototype.call=function(t,e){return e.subscribe(new Ke(t,this.nextSources))},t}(),Ke=function(t){function e(e,n){var r=t.call(this,e)||this;return r.destination=e,r.nextSources=n,r}return r.ZT(e,t),e.prototype.notifyError=function(){this.subscribeToNextSource()},e.prototype.notifyComplete=function(){this.subscribeToNextSource()},e.prototype._error=function(t){this.subscribeToNextSource(),this.unsubscribe()},e.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},e.prototype.subscribeToNextSource=function(){var t=this.nextSources.shift();if(t){var e=new i.IY(this),n=this.destination;n.add(e);var r=(0,i.ft)(t,e);r!==e&&n.add(r)}else this.destination.complete()},e}(i.Ds);function Je(){return function(t){return t.lift(new $e)}}var $e=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Xe(t))},t}(),Xe=function(t){function e(e){var n=t.call(this,e)||this;return n.hasPrev=!1,n}return r.ZT(e,t),e.prototype._next=function(t){var e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)},e}(p.L),tn=n(8463);function en(t,e){return function(n){return[(0,At.h)(t,e)(n),(0,At.h)((0,tn.f)(t,e))(n)]}}function nn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(e){return(0,Jt.U)(rn(t,n))(e)}}function rn(t,e){return function(n){for(var r=n,i=0;i<e;i++){var a=null!=r?r[t[i]]:void 0;if(void 0===a)return;r=a}return r}}var an=n(211);function on(t){return t?Ze((function(){return new an.xQ}),t):Ze(new an.xQ)}var sn=n(9233);function cn(t){return function(e){return Ze(new sn.X(t))(e)}}var un=n(364);function ln(){return function(t){return Ze(new un.c)(t)}}var hn=n(2630);function fn(t,e,n,r){n&&"function"!=typeof n&&(r=n);var i="function"==typeof n?n:void 0,a=new hn.t(t,e,r);return function(t){return Ze((function(){return a}),i)(t)}}var dn=n(8821);function pn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return 1===t.length&&(0,G.k)(t[0])&&(t=t[0]),e.lift.call(dn.S3.apply(void 0,[e].concat(t)))}}function vn(t){return void 0===t&&(t=-1),function(e){return 0===t?(0,Mt.c)():t<0?e.lift(new mn(-1,e)):e.lift(new mn(t-1,e))}}var mn=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new gn(t,this.count,this.source))},t}(),gn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.count=n,i.source=r,i}return r.ZT(e,t),e.prototype.complete=function(){if(!this.isStopped){var e=this.source,n=this.count;if(0===n)return t.prototype.complete.call(this);n>-1&&(this.count=n-1),e.subscribe(this._unsubscribeAndRecycle())}},e}(p.L);function yn(t){return function(e){return e.lift(new bn(t))}}var bn=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){return e.subscribe(new wn(t,this.notifier,e))},t}(),wn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.notifier=n,i.source=r,i.sourceIsBeingSubscribedTo=!0,i}return r.ZT(e,t),e.prototype.notifyNext=function(){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},e.prototype.notifyComplete=function(){if(!1===this.sourceIsBeingSubscribedTo)return t.prototype.complete.call(this)},e.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return t.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next(void 0)}},e.prototype._unsubscribe=function(){var t=this.notifications,e=this.retriesSubscription;t&&(t.unsubscribe(),this.notifications=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e.prototype._unsubscribeAndRecycle=function(){var e=this._unsubscribe;return this._unsubscribe=null,t.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=e,this},e.prototype.subscribeToRetries=function(){var e;this.notifications=new an.xQ;try{e=(0,this.notifier)(this.notifications)}catch(e){return t.prototype.complete.call(this)}this.retries=e,this.retriesSubscription=(0,i.ft)(e,new i.IY(this))},e}(i.Ds);function Cn(t){return void 0===t&&(t=-1),function(e){return e.lift(new Sn(t,e))}}var Sn=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new In(t,this.count,this.source))},t}(),In=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.count=n,i.source=r,i}return r.ZT(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return t.prototype.error.call(this,e);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},e}(p.L);function On(t){return function(e){return e.lift(new kn(t,e))}}var kn=function(){function t(t,e){this.notifier=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new xn(t,this.notifier,this.source))},t}(),xn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.notifier=n,i.source=r,i}return r.ZT(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.errors,r=this.retries,a=this.retriesSubscription;if(r)this.errors=void 0,this.retriesSubscription=void 0;else{n=new an.xQ;try{r=(0,this.notifier)(n)}catch(e){return t.prototype.error.call(this,e)}a=(0,i.ft)(r,new i.IY(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=a,n.next(e)}},e.prototype._unsubscribe=function(){var t=this.errors,e=this.retriesSubscription;t&&(t.unsubscribe(),this.errors=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e.prototype.notifyNext=function(){var t=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=t,this.source.subscribe(this)},e}(i.Ds),Bn=n(3018);function En(t){return function(e){return e.lift(new _n(t))}}var _n=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new Tn(t),r=e.subscribe(n);return r.add((0,i.ft)(this.notifier,new i.IY(n))),r},t}(),Tn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasValue=!1,e}return r.ZT(e,t),e.prototype._next=function(t){this.value=t,this.hasValue=!0},e.prototype.notifyNext=function(){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},e}(i.Ds);function Pn(t,e){return void 0===e&&(e=c.P),function(n){return n.lift(new An(t,e))}}var An=function(){function t(t,e){this.period=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new Dn(t,this.period,this.scheduler))},t}(),Dn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.period=n,i.scheduler=r,i.hasValue=!1,i.add(r.schedule(Nn,n,{subscriber:i,period:n})),i}return r.ZT(e,t),e.prototype._next=function(t){this.lastValue=t,this.hasValue=!0},e.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},e}(p.L);function Nn(t){var e=t.subscriber,n=t.period;e.notifyNext(),this.schedule(t,n)}function Fn(t,e){return function(n){return n.lift(new Rn(t,e))}}var Rn=function(){function t(t,e){this.compareTo=t,this.comparator=e}return t.prototype.call=function(t,e){return e.subscribe(new jn(t,this.compareTo,this.comparator))},t}(),jn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.compareTo=n,i.comparator=r,i._a=[],i._b=[],i._oneComplete=!1,i.destination.add(n.subscribe(new Mn(e,i))),i}return r.ZT(e,t),e.prototype._next=function(t){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(t),this.checkValues())},e.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},e.prototype.checkValues=function(){for(var t=this,e=t._a,n=t._b,r=t.comparator;e.length>0&&n.length>0;){var i=e.shift(),a=n.shift(),o=!1;try{o=r?r(i,a):i===a}catch(t){this.destination.error(t)}o||this.emit(!1)}},e.prototype.emit=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype.nextB=function(t){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(t),this.checkValues())},e.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},e}(p.L),Mn=function(t){function e(e,n){var r=t.call(this,e)||this;return r.parent=n,r}return r.ZT(e,t),e.prototype._next=function(t){this.parent.nextB(t)},e.prototype._error=function(t){this.parent.error(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},e}(p.L);function Ln(){return new an.xQ}function zn(){return function(t){return(0,Bn.x)()(Ze(Ln)(t))}}function Gn(t,e,n){var r;return r=t&&"object"==typeof t?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n},function(t){return t.lift(function(t){var e,n,r=t.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,a=t.windowTime,o=void 0===a?Number.POSITIVE_INFINITY:a,s=t.refCount,c=t.scheduler,u=0,l=!1,h=!1;return function(t){var r;u++,!e||l?(l=!1,e=new hn.t(i,o,c),r=e.subscribe(this),n=t.subscribe({next:function(t){e.next(t)},error:function(t){l=!0,e.error(t)},complete:function(){h=!0,n=void 0,e.complete()}}),h&&(n=void 0)):r=e.subscribe(this),this.add((function(){u--,r.unsubscribe(),r=void 0,n&&!h&&s&&0===u&&(n.unsubscribe(),n=void 0,e=void 0)}))}}(r))}}function Un(t){return function(e){return e.lift(new Vn(t,e))}}var Vn=function(){function t(t,e){this.predicate=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new qn(t,this.predicate,this.source))},t}(),qn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.source=r,i.seenValue=!1,i.index=0,i}return r.ZT(e,t),e.prototype.applySingleValue=function(t){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=t)},e.prototype._next=function(t){var e=this.index++;this.predicate?this.tryNext(t,e):this.applySingleValue(t)},e.prototype.tryNext=function(t,e){try{this.predicate(t,e,this.source)&&this.applySingleValue(t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){var t=this.destination;this.index>0?(t.next(this.seenValue?this.singleValue:void 0),t.complete()):t.error(new Dt.K)},e}(p.L);function Zn(t){return function(e){return e.lift(new Hn(t))}}var Hn=function(){function t(t){this.total=t}return t.prototype.call=function(t,e){return e.subscribe(new Wn(t,this.total))},t}(),Wn=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return r.ZT(e,t),e.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)},e}(p.L);function Yn(t){return function(e){return e.lift(new Qn(t))}}var Qn=function(){function t(t){if(this._skipCount=t,this._skipCount<0)throw new Pt.W}return t.prototype.call=function(t,e){return 0===this._skipCount?e.subscribe(new p.L(t)):e.subscribe(new Kn(t,this._skipCount))},t}(),Kn=function(t){function e(e,n){var r=t.call(this,e)||this;return r._skipCount=n,r._count=0,r._ring=new Array(n),r}return r.ZT(e,t),e.prototype._next=function(t){var e=this._skipCount,n=this._count++;if(n<e)this._ring[n]=t;else{var r=n%e,i=this._ring,a=i[r];i[r]=t,this.destination.next(a)}},e}(p.L);function Jn(t){return function(e){return e.lift(new $n(t))}}var $n=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){return e.subscribe(new Xn(t,this.notifier))},t}(),Xn=function(t){function e(e,n){var r=t.call(this,e)||this;r.hasValue=!1;var a=new i.IY(r);r.add(a),r.innerSubscription=a;var o=(0,i.ft)(n,a);return o!==a&&(r.add(o),r.innerSubscription=o),r}return r.ZT(e,t),e.prototype._next=function(e){this.hasValue&&t.prototype._next.call(this,e)},e.prototype.notifyNext=function(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},e.prototype.notifyComplete=function(){},e}(i.Ds);function tr(t){return function(e){return e.lift(new er(t))}}var er=function(){function t(t){this.predicate=t}return t.prototype.call=function(t,e){return e.subscribe(new nr(t,this.predicate))},t}(),nr=function(t){function e(e,n){var r=t.call(this,e)||this;return r.predicate=n,r.skipping=!0,r.index=0,r}return r.ZT(e,t),e.prototype._next=function(t){var e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)},e.prototype.tryCallPredicate=function(t){try{var e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(t){this.destination.error(t)}},e}(p.L);function rr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return(0,b.K)(n)?(t.pop(),function(e){return(0,q.z)(t,e,n)}):function(e){return(0,q.z)(t,e)}}var ir=n(6650),ar=n(5812),or=function(t){function e(e,n,r){void 0===n&&(n=0),void 0===r&&(r=ir.e);var i=t.call(this)||this;return i.source=e,i.delayTime=n,i.scheduler=r,(!(0,ar.k)(n)||n<0)&&(i.delayTime=0),r&&"function"==typeof r.schedule||(i.scheduler=ir.e),i}return r.ZT(e,t),e.create=function(t,n,r){return void 0===n&&(n=0),void 0===r&&(r=ir.e),new e(t,n,r)},e.dispatch=function(t){var e=t.source,n=t.subscriber;return this.add(e.subscribe(n))},e.prototype._subscribe=function(t){var n=this.delayTime,r=this.source;return this.scheduler.schedule(e.dispatch,n,{source:r,subscriber:t})},e}(vt.y);function sr(t,e){return void 0===e&&(e=0),function(n){return n.lift(new cr(t,e))}}var cr=function(){function t(t,e){this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return new or(e,this.delay,this.scheduler).subscribe(t)},t}();function ur(t,e){return"function"==typeof e?function(n){return n.pipe(ur((function(n,r){return(0,U.D)(t(n,r)).pipe((0,Jt.U)((function(t,i){return e(n,t,r,i)})))})))}:function(e){return e.lift(new lr(t))}}var lr=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new hr(t,this.project))},t}(),hr=function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.index=0,r}return r.ZT(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this._innerSub(e)},e.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe();var n=new i.IY(this),r=this.destination;r.add(n),this.innerSubscription=(0,i.ft)(t,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t){this.destination.next(t)},e}(i.Ds);function fr(){return ur(he.y)}function dr(t,e){return e?ur((function(){return t}),e):ur((function(){return t}))}function pr(t){return function(e){return e.lift(new vr(t))}}var vr=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new mr(t),r=(0,i.ft)(this.notifier,new i.IY(n));return r&&!n.seenValue?(n.add(r),e.subscribe(n)):n},t}(),mr=function(t){function e(e){var n=t.call(this,e)||this;return n.seenValue=!1,n}return r.ZT(e,t),e.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},e.prototype.notifyComplete=function(){},e}(i.Ds);function gr(t,e){return void 0===e&&(e=!1),function(n){return n.lift(new yr(t,e))}}var yr=function(){function t(t,e){this.predicate=t,this.inclusive=e}return t.prototype.call=function(t,e){return e.subscribe(new br(t,this.predicate,this.inclusive))},t}(),br=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.inclusive=r,i.index=0,i}return r.ZT(e,t),e.prototype._next=function(t){var e,n=this.destination;try{e=this.predicate(t,this.index++)}catch(t){return void n.error(t)}this.nextOrComplete(t,e)},e.prototype.nextOrComplete=function(t,e){var n=this.destination;Boolean(e)?n.next(t):(this.inclusive&&n.next(t),n.complete())},e}(p.L),wr=n(3306),Cr=n(4156);function Sr(t,e,n){return function(r){return r.lift(new Ir(t,e,n))}}var Ir=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new Or(t,this.nextOrObserver,this.error,this.complete))},t}(),Or=function(t){function e(e,n,r,i){var a=t.call(this,e)||this;return a._tapNext=wr.Z,a._tapError=wr.Z,a._tapComplete=wr.Z,a._tapError=r||wr.Z,a._tapComplete=i||wr.Z,(0,Cr.m)(n)?(a._context=a,a._tapNext=n):n&&(a._context=n,a._tapNext=n.next||wr.Z,a._tapError=n.error||wr.Z,a._tapComplete=n.complete||wr.Z),a}return r.ZT(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(p.L),kr={leading:!0,trailing:!1};function xr(t,e){return void 0===e&&(e=kr),function(n){return n.lift(new Br(t,!!e.leading,!!e.trailing))}}var Br=function(){function t(t,e,n){this.durationSelector=t,this.leading=e,this.trailing=n}return t.prototype.call=function(t,e){return e.subscribe(new Er(t,this.durationSelector,this.leading,this.trailing))},t}(),Er=function(t){function e(e,n,r,i){var a=t.call(this,e)||this;return a.destination=e,a.durationSelector=n,a._leading=r,a._trailing=i,a._hasValue=!1,a}return r.ZT(e,t),e.prototype._next=function(t){this._hasValue=!0,this._sendValue=t,this._throttled||(this._leading?this.send():this.throttle(t))},e.prototype.send=function(){var t=this._hasValue,e=this._sendValue;t&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=void 0},e.prototype.throttle=function(t){var e=this.tryDurationSelector(t);e&&this.add(this._throttled=(0,i.ft)(e,new i.IY(this)))},e.prototype.tryDurationSelector=function(t){try{return this.durationSelector(t)}catch(t){return this.destination.error(t),null}},e.prototype.throttlingDone=function(){var t=this._throttled,e=this._trailing;t&&t.unsubscribe(),this._throttled=void 0,e&&this.send()},e.prototype.notifyNext=function(){this.throttlingDone()},e.prototype.notifyComplete=function(){this.throttlingDone()},e}(i.Ds);function _r(t,e,n){return void 0===e&&(e=c.P),void 0===n&&(n=kr),function(r){return r.lift(new Tr(t,e,n.leading,n.trailing))}}var Tr=function(){function t(t,e,n,r){this.duration=t,this.scheduler=e,this.leading=n,this.trailing=r}return t.prototype.call=function(t,e){return e.subscribe(new Pr(t,this.duration,this.scheduler,this.leading,this.trailing))},t}(),Pr=function(t){function e(e,n,r,i,a){var o=t.call(this,e)||this;return o.duration=n,o.scheduler=r,o.leading=i,o.trailing=a,o._hasTrailingValue=!1,o._trailingValue=null,o}return r.ZT(e,t),e.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Ar,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))},e.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},e.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},e}(p.L);function Ar(t){t.subscriber.clearThrottle()}var Dr=n(1410);function Nr(t){return void 0===t&&(t=c.P),function(e){return(0,Dr.P)((function(){return e.pipe(Te((function(e,n){var r=e.current;return{value:n,current:t.now(),last:r}}),{current:t.now(),value:void 0,last:void 0}),(0,Jt.U)((function(t){var e=t.current,n=t.last,r=t.value;return new Fr(r,e-n)})))}))}}var Fr=function(){return function(t,e){this.value=t,this.interval=e}}(),Rr=n(1462);function jr(t,e,n){return void 0===n&&(n=c.P),function(r){var i=ut(t),a=i?+t-n.now():Math.abs(t);return r.lift(new Mr(a,i,e,n))}}var Mr=function(){function t(t,e,n,r){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new Lr(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t}(),Lr=function(t){function e(e,n,r,i,a){var o=t.call(this,e)||this;return o.absoluteTimeout=n,o.waitFor=r,o.withObservable=i,o.scheduler=a,o.scheduleTimeout(),o}return r.ZT(e,t),e.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add((0,i.ft)(e,new i.IY(t)))},e.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),t.prototype._next.call(this,e)},e.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},e}(i.Ds),zr=n(4944);function Gr(t,e){return void 0===e&&(e=c.P),jr(t,(0,zr._)(new Rr.W),e)}function Ur(t){return void 0===t&&(t=c.P),(0,Jt.U)((function(e){return new Vr(e,t.now())}))}var Vr=function(){return function(t,e){this.value=t,this.timestamp=e}}();function qr(t,e,n){return 0===n?[e]:(t.push(e),t)}function Zr(){return Ne(qr,[])}function Hr(t){return function(e){return e.lift(new Wr(t))}}var Wr=function(){function t(t){this.windowBoundaries=t}return t.prototype.call=function(t,e){var n=new Yr(t),r=e.subscribe(n);return r.closed||n.add((0,i.ft)(this.windowBoundaries,new i.IY(n))),r},t}(),Yr=function(t){function e(e){var n=t.call(this,e)||this;return n.window=new an.xQ,e.next(n.window),n}return r.ZT(e,t),e.prototype.notifyNext=function(){this.openWindow()},e.prototype.notifyError=function(t){this._error(t)},e.prototype.notifyComplete=function(){this._complete()},e.prototype._next=function(t){this.window.next(t)},e.prototype._error=function(t){this.window.error(t),this.destination.error(t)},e.prototype._complete=function(){this.window.complete(),this.destination.complete()},e.prototype._unsubscribe=function(){this.window=null},e.prototype.openWindow=function(){var t=this.window;t&&t.complete();var e=this.destination,n=this.window=new an.xQ;e.next(n)},e}(i.Ds);function Qr(t,e){return void 0===e&&(e=0),function(n){return n.lift(new Kr(t,e))}}var Kr=function(){function t(t,e){this.windowSize=t,this.startWindowEvery=e}return t.prototype.call=function(t,e){return e.subscribe(new Jr(t,this.windowSize,this.startWindowEvery))},t}(),Jr=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.destination=e,i.windowSize=n,i.startWindowEvery=r,i.windows=[new an.xQ],i.count=0,e.next(i.windows[0]),i}return r.ZT(e,t),e.prototype._next=function(t){for(var e=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,a=i.length,o=0;o<a&&!this.closed;o++)i[o].next(t);var s=this.count-r+1;if(s>=0&&s%e==0&&!this.closed&&i.shift().complete(),++this.count%e==0&&!this.closed){var c=new an.xQ;i.push(c),n.next(c)}},e.prototype._error=function(t){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().error(t);this.destination.error(t)},e.prototype._complete=function(){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().complete();this.destination.complete()},e.prototype._unsubscribe=function(){this.count=0,this.windows=null},e}(p.L);function $r(t){var e=c.P,n=null,r=Number.POSITIVE_INFINITY;return(0,b.K)(arguments[3])&&(e=arguments[3]),(0,b.K)(arguments[2])?e=arguments[2]:(0,ar.k)(arguments[2])&&(r=Number(arguments[2])),(0,b.K)(arguments[1])?e=arguments[1]:(0,ar.k)(arguments[1])&&(n=Number(arguments[1])),function(i){return i.lift(new Xr(t,n,r,e))}}var Xr=function(){function t(t,e,n,r){this.windowTimeSpan=t,this.windowCreationInterval=e,this.maxWindowSize=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new ei(t,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},t}(),ti=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._numberOfNextedValues=0,e}return r.ZT(e,t),e.prototype.next=function(e){this._numberOfNextedValues++,t.prototype.next.call(this,e)},Object.defineProperty(e.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),e}(an.xQ),ei=function(t){function e(e,n,r,i,a){var o=t.call(this,e)||this;o.destination=e,o.windowTimeSpan=n,o.windowCreationInterval=r,o.maxWindowSize=i,o.scheduler=a,o.windows=[];var s=o.openWindow();if(null!==r&&r>=0){var c={subscriber:o,window:s,context:null},u={windowTimeSpan:n,windowCreationInterval:r,subscriber:o,scheduler:a};o.add(a.schedule(ii,n,c)),o.add(a.schedule(ri,r,u))}else{var l={subscriber:o,window:s,windowTimeSpan:n};o.add(a.schedule(ni,n,l))}return o}return r.ZT(e,t),e.prototype._next=function(t){for(var e=this.windows,n=e.length,r=0;r<n;r++){var i=e[r];i.closed||(i.next(t),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},e.prototype._error=function(t){for(var e=this.windows;e.length>0;)e.shift().error(t);this.destination.error(t)},e.prototype._complete=function(){for(var t=this.windows;t.length>0;){var e=t.shift();e.closed||e.complete()}this.destination.complete()},e.prototype.openWindow=function(){var t=new ti;return this.windows.push(t),this.destination.next(t),t},e.prototype.closeWindow=function(t){t.complete();var e=this.windows;e.splice(e.indexOf(t),1)},e}(p.L);function ni(t){var e=t.subscriber,n=t.windowTimeSpan,r=t.window;r&&e.closeWindow(r),t.window=e.openWindow(),this.schedule(t,n)}function ri(t){var e=t.windowTimeSpan,n=t.subscriber,r=t.scheduler,i=t.windowCreationInterval,a=n.openWindow(),o=this,s={action:o,subscription:null},c={subscriber:n,window:a,context:s};s.subscription=r.schedule(ii,e,c),o.add(s.subscription),o.schedule(t,i)}function ii(t){var e=t.subscriber,n=t.window,r=t.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),e.closeWindow(n)}function ai(t,e){return function(n){return n.lift(new oi(t,e))}}var oi=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new si(t,this.openings,this.closingSelector))},t}(),si=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=(0,E.D)(i,n,n)),i}return r.ZT(e,t),e.prototype._next=function(t){var e=this.contexts;if(e)for(var n=e.length,r=0;r<n;r++)e[r].window.next(t)},e.prototype._error=function(e){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var a=n[i];a.window.error(e),a.subscription.unsubscribe()}t.prototype._error.call(this,e)},e.prototype._complete=function(){var e=this.contexts;if(this.contexts=null,e)for(var n=e.length,r=-1;++r<n;){var i=e[r];i.window.complete(),i.subscription.unsubscribe()}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,n=-1;++n<e;){var r=t[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},e.prototype.notifyNext=function(t,e,n,r,i){if(t===this.openings){var a=void 0;try{a=(0,this.closingSelector)(e)}catch(t){return this.error(t)}var o=new an.xQ,s=new B.w,c={window:o,subscription:s};this.contexts.push(c);var u=(0,E.D)(this,a,c);u.closed?this.closeWindow(this.contexts.length-1):(u.context=c,s.add(u)),this.destination.next(o)}else this.closeWindow(this.contexts.indexOf(t))},e.prototype.notifyError=function(t){this.error(t)},e.prototype.notifyComplete=function(t){t!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(t.context))},e.prototype.closeWindow=function(t){if(-1!==t){var e=this.contexts,n=e[t],r=n.window,i=n.subscription;e.splice(t,1),r.complete(),i.unsubscribe()}},e}(_.L);function ci(t){return function(e){return e.lift(new ui(t))}}var ui=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new li(t,this.closingSelector))},t}(),li=function(t){function e(e,n){var r=t.call(this,e)||this;return r.destination=e,r.closingSelector=n,r.openWindow(),r}return r.ZT(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.openWindow(i)},e.prototype.notifyError=function(t){this._error(t)},e.prototype.notifyComplete=function(t){this.openWindow(t)},e.prototype._next=function(t){this.window.next(t)},e.prototype._error=function(t){this.window.error(t),this.destination.error(t),this.unsubscribeClosingNotification()},e.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},e.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},e.prototype.openWindow=function(t){void 0===t&&(t=null),t&&(this.remove(t),t.unsubscribe());var e=this.window;e&&e.complete();var n,r=this.window=new an.xQ;this.destination.next(r);try{n=(0,this.closingSelector)()}catch(t){return this.destination.error(t),void this.window.error(t)}this.add(this.closingNotification=(0,E.D)(this,n))},e}(_.L);function hi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var n;"function"==typeof t[t.length-1]&&(n=t.pop());var r=t;return e.lift(new fi(r,n))}}var fi=function(){function t(t,e){this.observables=t,this.project=e}return t.prototype.call=function(t,e){return e.subscribe(new di(t,this.observables,this.project))},t}(),di=function(t){function e(e,n,r){var i=t.call(this,e)||this;i.observables=n,i.project=r,i.toRespond=[];var a=n.length;i.values=new Array(a);for(var o=0;o<a;o++)i.toRespond.push(o);for(o=0;o<a;o++){var s=n[o];i.add((0,E.D)(i,s,void 0,o))}return i}return r.ZT(e,t),e.prototype.notifyNext=function(t,e,n){this.values[n]=e;var r=this.toRespond;if(r.length>0){var i=r.indexOf(n);-1!==i&&r.splice(i,1)}},e.prototype.notifyComplete=function(){},e.prototype._next=function(t){if(0===this.toRespond.length){var e=[t].concat(this.values);this.project?this._tryProject(e):this.destination.next(e)}},e.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(_.L),pi=n(5080);function vi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return e.lift.call(pi.$R.apply(void 0,[e].concat(t)))}}function mi(t){return function(e){return e.lift(new pi.mx(t))}}},5987:(t,e,n)=>{"use strict";n.d(e,{ZT:()=>i});var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}},9126:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(969))},8111:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(5624))},173:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(6097))},2068:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(1709))},904:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(3895))},8120:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(6740))},9890:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(698))},1301:(t,e,n)=>{var r=n(7187).EventEmitter;function i(t,e,n,r,i){for(var a=0;a<i;++a,++e,++r)if(t[e]!==n[r])return!1;return!0}function a(t){"string"==typeof t&&(t=new Buffer(t));var e,n,r=t.length;for(this.maxMatches=1/0,this.matches=0,this._occ=new Array(256),this._lookbehind_size=0,this._needle=t,this._bufpos=0,this._lookbehind=new Buffer(r),n=0;n<256;++n)this._occ[n]=r;if(r>=1)for(e=0;e<r-1;++e)this._occ[t[e]]=r-1-e}(0,n(9539).inherits)(a,r),a.prototype.reset=function(){this._lookbehind_size=0,this.matches=0,this._bufpos=0},a.prototype.push=function(t,e){var n,r;for(Buffer.isBuffer(t)||(t=new Buffer(t,"binary")),r=t.length,this._bufpos=e||0;n!==r&&this.matches<this.maxMatches;)n=this._sbmh_feed(t);return n},a.prototype._sbmh_feed=function(t){var e=t.length,n=this._needle,r=n.length,a=-this._lookbehind_size,o=n[r-1],s=this._occ,c=this._lookbehind;if(a<0){for(;a<0&&a<=e-r;){if((l=this._sbmh_lookup_char(t,a+r-1))===o&&this._sbmh_memcmp(t,a,r-1))return this._lookbehind_size=0,++this.matches,a>-this._lookbehind_size?this.emit("info",!0,c,0,this._lookbehind_size+a):this.emit("info",!0),this._bufpos=a+r,a+r;a+=s[l]}if(a<0)for(;a<0&&!this._sbmh_memcmp(t,a,e-a);)a++;if(!(a>=0)){var u=this._lookbehind_size+a;return u>0&&this.emit("info",!1,c,0,u),c.copy(c,0,u,this._lookbehind_size-u),this._lookbehind_size-=u,t.copy(c,this._lookbehind_size),this._lookbehind_size+=e,this._bufpos=e,e}this.emit("info",!1,c,0,this._lookbehind_size),this._lookbehind_size=0}for(a>=0&&(a+=this._bufpos);a<=e-r;){var l;if((l=t[a+r-1])===o&&t[a]===n[0]&&i(n,0,t,a,r-1))return++this.matches,a>0?this.emit("info",!0,t,this._bufpos,a):this.emit("info",!0),this._bufpos=a+r,a+r;a+=s[l]}if(a<e){for(;a<e&&(t[a]!==n[0]||!i(t,a,n,0,e-a));)++a;a<e&&(t.copy(c,0,a,a+(e-a)),this._lookbehind_size=e-a)}return a>0&&this.emit("info",!1,t,this._bufpos,a<e?a:e),this._bufpos=e,e},a.prototype._sbmh_lookup_char=function(t,e){return e<0?this._lookbehind[this._lookbehind_size+e]:t[e]},a.prototype._sbmh_memcmp=function(t,e,n){for(var r=0;r<n;){if(this._sbmh_lookup_char(t,e+r)!==this._needle[r])return!1;++r}return!0},t.exports=a},1496:t=>{"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},384:t=>{t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},9539:(t,e,n)=>{var r=n(4155),i=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++)n[e[r]]=Object.getOwnPropertyDescriptor(t,e[r]);return n},a=/%[sdj%]/g;e.format=function(t){if(!y(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(c(arguments[n]));return e.join(" ")}n=1;for(var r=arguments,i=r.length,o=String(t).replace(a,(function(t){if("%%"===t)return"%";if(n>=i)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}})),s=r[n];n<i;s=r[++n])m(s)||!C(s)?o+=" "+s:o+=" "+c(s);return o},e.deprecate=function(t,n){if(void 0!==r&&!0===r.noDeprecation)return t;if(void 0===r)return function(){return e.deprecate(t,n).apply(this,arguments)};var i=!1;return function(){if(!i){if(r.throwDeprecation)throw new Error(n);r.traceDeprecation?console.trace(n):console.error(n),i=!0}return t.apply(this,arguments)}};var o,s={};function c(t,n){var r={seen:[],stylize:l};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),v(n)?r.showHidden=n:n&&e._extend(r,n),b(r.showHidden)&&(r.showHidden=!1),b(r.depth)&&(r.depth=2),b(r.colors)&&(r.colors=!1),b(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),h(r,t,r.depth)}function u(t,e){var n=c.styles[e];return n?"["+c.colors[n][0]+"m"+t+"["+c.colors[n][1]+"m":t}function l(t,e){return t}function h(t,n,r){if(t.customInspect&&n&&O(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,t);return y(i)||(i=h(t,i,r)),i}var a=function(t,e){if(b(e))return t.stylize("undefined","undefined");if(y(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return g(e)?t.stylize(""+e,"number"):v(e)?t.stylize(""+e,"boolean"):m(e)?t.stylize("null","null"):void 0}(t,n);if(a)return a;var o=Object.keys(n),s=function(t){var e={};return t.forEach((function(t,n){e[t]=!0})),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(n)),I(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return f(n);if(0===o.length){if(O(n)){var c=n.name?": "+n.name:"";return t.stylize("[Function"+c+"]","special")}if(w(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(S(n))return t.stylize(Date.prototype.toString.call(n),"date");if(I(n))return f(n)}var u,l="",C=!1,k=["{","}"];return p(n)&&(C=!0,k=["[","]"]),O(n)&&(l=" [Function"+(n.name?": "+n.name:"")+"]"),w(n)&&(l=" "+RegExp.prototype.toString.call(n)),S(n)&&(l=" "+Date.prototype.toUTCString.call(n)),I(n)&&(l=" "+f(n)),0!==o.length||C&&0!=n.length?r<0?w(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),u=C?function(t,e,n,r,i){for(var a=[],o=0,s=e.length;o<s;++o)_(e,String(o))?a.push(d(t,e,n,r,String(o),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(d(t,e,n,r,i,!0))})),a}(t,n,r,s,o):o.map((function(e){return d(t,n,r,s,e,C)})),t.seen.pop(),function(t,e,n){return t.reduce((function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}(u,l,k)):k[0]+l+k[1]}function f(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,n,r,i,a){var o,s,c;if((c=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?s=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(s=t.stylize("[Setter]","special")),_(r,i)||(o="["+i+"]"),s||(t.seen.indexOf(c.value)<0?(s=m(n)?h(t,c.value,null):h(t,c.value,n-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+s.split("\n").map((function(t){return"   "+t})).join("\n")):s=t.stylize("[Circular]","special")),b(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+s}function p(t){return Array.isArray(t)}function v(t){return"boolean"==typeof t}function m(t){return null===t}function g(t){return"number"==typeof t}function y(t){return"string"==typeof t}function b(t){return void 0===t}function w(t){return C(t)&&"[object RegExp]"===k(t)}function C(t){return"object"==typeof t&&null!==t}function S(t){return C(t)&&"[object Date]"===k(t)}function I(t){return C(t)&&("[object Error]"===k(t)||t instanceof Error)}function O(t){return"function"==typeof t}function k(t){return Object.prototype.toString.call(t)}function x(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(b(o)&&(o=r.env.NODE_DEBUG||""),t=t.toUpperCase(),!s[t])if(new RegExp("\\b"+t+"\\b","i").test(o)){var n=r.pid;s[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,r)}}else s[t]=function(){};return s[t]},e.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=p,e.isBoolean=v,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=g,e.isString=y,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=b,e.isRegExp=w,e.isObject=C,e.isDate=S,e.isError=I,e.isFunction=O,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=n(384);var B=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function E(){var t=new Date,e=[x(t.getHours()),x(t.getMinutes()),x(t.getSeconds())].join(":");return[t.getDate(),B[t.getMonth()],e].join(" ")}function _(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",E(),e.format.apply(e,arguments))},e.inherits=n(1496),e._extend=function(t,e){if(!e||!C(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t};var T="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function P(t,e){if(!t){var n=new Error("Promise was rejected with a falsy value");n.reason=t,t=n}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(T&&t[T]){var e;if("function"!=typeof(e=t[T]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,T,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,n,r=new Promise((function(t,r){e=t,n=r})),i=[],a=0;a<arguments.length;a++)i.push(arguments[a]);i.push((function(t,r){t?n(t):e(r)}));try{t.apply(this,i)}catch(t){n(t)}return r}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),T&&Object.defineProperty(e,T,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,i(t))},e.promisify.custom=T,e.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function e(){for(var e=[],n=0;n<arguments.length;n++)e.push(arguments[n]);var i=e.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var a=this,o=function(){return i.apply(a,arguments)};t.apply(this,e).then((function(t){r.nextTick(o,null,t)}),(function(t){r.nextTick(P,t,o)}))}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),Object.defineProperties(e,i(t)),e}}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={exports:{}};return t[r].call(a.exports,a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}n.r(r),n.d(r,{Session:()=>br}),n(5666);var o=function(){function t(){var n=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e(this,t),this.addFunc=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=null;return null!==e&&(null===t?n.listeners.forEach((function(t,n){r=t.listener.addFunc(e)})):n.listeners.find((function(n,i){n.key===t&&(r=n.listener.addFunc(e))}))),r},this.removeFuncs=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t?n.listeners.forEach((function(t,n){t.listener.removeFuncs(e)})):n.listeners.find((function(n,r){n.name===t&&n.listener.removeFuncs(e)}))},this.debug=r,this.listeners=[]}return a(t,[{key:"addListener",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.debug;if(void 0!==e){var o=t;null===o&&(o=Math.floor(1e5*Math.random()));var c={key:o,listener:new s(e,n,r,i,a)};this.listeners.push(c)}else console.error("You must assign an object")}},{key:"hasKey",value:function(t){var e=!1;return this.listeners.forEach((function(n,r){n.key===t&&(e=!0)})),e}},{key:"getKeyIndices",value:function(t){var e=[];return this.listeners.find((function(n,r){n.key===t&&e.push(r)})),e}},{key:"onchange",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t?this.listeners.forEach((function(t,n){t.listener.onchange=e})):this.listeners.find((function(n,r){n.name===t&&(n.listener.onchange=e)}))}},{key:"stop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===t?this.listeners.forEach((function(t,e){t.listener.stop()})):this.listeners.find((function(e,n){e.name===t&&e.listener.stop()}))}},{key:"start",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===t?this.listeners.forEach((function(t,e){t.listener.start()})):this.listeners.find((function(e,n){e.name===t&&e.listener.start()}))}},{key:"remove",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===e)this.listeners.splice(0,this.listeners.length);else{var n=[];this.listeners.find((function(t,r){t.name===e&&n.push(r)})),n.reverse().forEach((function(e){t.listeners[e].stop(),t.listeners.splice(e,1)}))}}}]),t}(),s=function(){function t(n){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"__ANY__",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onchange,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"FRAMERATE",s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];e(this,t),c.call(this),this.debug=s,this.onchange=a,this.onchangeFuncs=[],this.object=n,this.propName=i,this.propOld=void 0,this.setListenerRef(i),this.running=!0,this.interval,o<=0?(this.interval=10,console.log("Min recommended interval set: 10ms")):this.interval=o,"undefined"==typeof window?setTimeout((function(){r.check}),60):this.checker=requestAnimationFrame(this.check)}return a(t,[{key:"removeFuncs",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===t?this.onchangeFuncs=[]:void 0!==this.onchangeFuncs[t]&&this.onchangeFuncs.splice(t,1)}},{key:"start",value:function(){var t=this;this.running=!0,"undefined"==typeof window?setTimeout((function(){t.check}),60):this.checker=requestAnimationFrame(this.check)}},{key:"stop",value:function(){this.running=!1,cancelAnimationFrame(this.checker)}}]),t}(),c=function(){var e=this;this.onchange=function(t){console.log(e.propName," changed from: ",e.propOld," to: ",e.object[e.propName])},this.addFunc=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null!==t&&e.onchangeFuncs.push(t),e.onchangeFuncs.length-1},this.onchangeMulti=function(t){e.onchangeFuncs.forEach((function(n,r){!0===e.debug&&console.log(n),n(t)}))},this.setListenerRef=function(n){"__ANY__"===n||null==n?e.propOld=JSON.stringifyFast(e.object):Array.isArray(e.object[n])?e.propOld=JSON.stringifyFast(e.object[n].slice(e.object[n].length-20)):"object"===t(e.object[n])?e.propOld=JSON.stringifyFast(e.object[n]):"function"==typeof e.object[n]?e.propOld=e.object[n].toString():e.propOld=e.object[n],!0===e.debug&&console.log("propname",n,", new assignment: ",e.propOld)},this.check=function(){if("__ANY__"===e.propName||null===e.propName||void 0===e.propName)e.propOld!==JSON.stringifyFast(e.object)&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object),e.setListenerRef(e.propName));else if(Array.isArray(e.object[e.propName]))e.propOld!==JSON.stringifyFast(e.object[e.propName].slice(e.object[e.propName].length-20))&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object[e.propName]),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object[e.propName]),e.setListenerRef(e.propName));else if("object"===t(e.object[e.propName])){var n=JSON.stringifyFast(e.object[e.propName]);e.propOld!==n&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object[e.propName]),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object[e.propName]),e.setListenerRef(e.propName))}else"function"==typeof e.object[e.propName]?e.propOld!==e.object[e.propName].toString()&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object[e.propName].toString()),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object[e.propName].toString()),e.setListenerRef(e.propName)):e.object[e.propName]!==e.propOld&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object[e.propName]),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object[e.propName]),e.setListenerRef(e.propName));!0===e.running&&(!0===e.debug&&console.log("checking",e.object,e.propName),"FRAMERATE"===e.interval?"undefined"==typeof window?setTimeout((function(){e.check}),60):e.checker=requestAnimationFrame(e.check):setTimeout((function(){e.check}),e.interval))}};function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}void 0===JSON.stringifyFast&&(JSON.stringifyFast=function(){var e=new Map,n=[],r=["this"];function i(n,i){var a=i;if(null!==a&&"object"===t(i)){var o=e.get(a),s=i.constructor.name;if(o)return"[Circular Reference]"+o;if("Array"===s&&i.length>20)a=i.slice(i.length-20),e.set(a,r.join("."));else if("Object"!==s&&"Number"!==s&&"String"!==s&&"Boolean"!==s)a="instanceof_"+s,e.set(a,r.join("."));else if("object"===t(a)){var c={};for(var u in a)Array.isArray(a[u])?c[u]=a[u].slice(a[u].length-20):c[u]=a[u]}else e.set(a,r.join("."))}return a}return function(t,a){try{return n.push(t),JSON.stringify(t,i,a)}finally{e.clear(),n.length=0,r.length=1}}}());var p=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FRAMERATE";f(this,t),this.data=n,this.data.stateUpdateInterval=r,this.pushToState={},this.prev=Object.assign({},this.data),this.listener=new o;var i=function(){e.listener.listeners.forEach((function(t,n){t.interval=e.data.stateUpdateInterval}))};this.listener.addListener("interval",this.data,"stateUpdateInterval",i,r);var a=function(){if(Object.keys(e.pushToState).length>0){Object.assign(e.prev,e.data),Object.assign(e.data,e.pushToState);var t,n=l(Object.getOwnPropertyNames(e.pushToState));try{for(n.s();!(t=n.n()).done;){var r=t.value;delete e.pushToState[r]}}catch(t){n.e(t)}finally{n.f()}}};this.listener.addListener("push",this.pushToState,"__ANY__",a,r)}var e,n;return e=t,(n=[{key:"addToState",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.data[t]=e,null!==n)return this.addSecondaryKeyResponse(t,n,r)}},{key:"getState",value:function(){return JSON.parse(JSON.stringifyFast(this.data))}},{key:"setState",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(this.pushToState,t),this.pushToState}},{key:"setPrimaryKeyResponse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null!==e&&(this.listener.hasKey(t)?this.listener.onchange(t,e):null!==t&&this.listener.addListener(t,this.data,t,e,this.data.stateUpdateInterval,n))}},{key:"addSecondaryKeyResponse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null!==e)return this.listener.hasKey(t)?this.listener.addFunc(t,e):null!==t?(this.listener.addListener(t,this.data,t,(function(){}),this.data.stateUpdateInterval,n),this.listener.addFunc(t,e)):this.listener.addFunc("state",e)}},{key:"removeSecondaryKeyResponse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!==t?this.listener.hasKey(t)&&this.listener.removeFuncs(t,e):console.error("provide key")}},{key:"clearAllKeyResponses",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.listener.hasKey(t)&&this.listener.remove(t)}},{key:"subscribe",value:function(t,e){if(void 0!==this.data[t])return this.addSecondaryKeyResponse(t,e);this.addToState(k,null,e)}},{key:"unsubscribe",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!==e?this.removeSecondaryKeyResponse(t,e):console.error("Specify a subcription function index")}},{key:"unsubscribeAll",value:function(t){this.clearAllKeyResponses(t)}}])&&d(e.prototype,n),t}();function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function g(t){return function(t){if(Array.isArray(t))return y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}void 0===JSON.stringifyFast&&(JSON.stringifyFast=function(){var t=new Map,e=[],n=["this"];function r(e,r){var i=r;if(null!==i&&"object"===u(r)){var a=t.get(i),o=r.constructor.name;if(a)return"[Circular Reference]"+a;if("Array"===o&&r.length>20)i=r.slice(r.length-20),t.set(i,n.join("."));else if("Object"!==o&&"Number"!==o&&"String"!==o&&"Boolean"!==o)i="instanceof_"+o,t.set(i,n.join("."));else if("object"===u(i)){var s={};for(var c in i)Array.isArray(i[c])?s[c]=i[c].slice(i[c].length-20):s[c]=i[c]}else t.set(i,n.join("."))}return i}return function(i,a){try{return e.push(i),JSON.stringify(i,r,a)}finally{t.clear(),e.length=0,n.length=1}}}());var C=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"atlas",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{eegshared:{eegChannelTags:[{ch:0,tag:"FP1",analyze:!0},{ch:1,tag:"FP2",analyze:!0}],sps:512}},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"10_20",a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:["eegfft"];b(this,t),this.getDeviceDataByTag=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eeg",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FP1",r=void 0;return"number"==typeof n&&"eeg"===t&&e.data[t+"shared"][t+"ChannelTags"].find((function(t,e){if(t.ch===n&&null!==t.tag)return n=t.tag,!0})),t.indexOf("shared")<0?(e.data[t].find((function(t,e){if(t.tag===n)return r=t,!0})),r):null===n||"all"===n?e.data[t]:"string"==typeof n||"number"==typeof n?(e.data[t].find((function(t,e){if(t.tag===n)return r=t,!0})),r):r},this.getEEGDataByChannel=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=void 0;return e.data.eegshared.eegChannelTags.find((function(r,i){if(r.ch===t&&!1!==(n=null===r.tag||"other"===r.tag?e.getEEGDataByTag(r.ch):e.getEEGDataByTag(r.tag)))return!0})),n},this.getEEGDataByTag=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FP1",n=void 0;return e.data.eeg.find((function(e,r){if(e.tag===t)return n=e,!0})),n},this.getCoherenceByTag=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FP1_FZ",n=void 0;return e.data.coherence.find((function(e,r){if(e.tag===t)return n=e,!0})),n},this.getLatestFFTData=function(){var t=[];return e.data.eegshared.eegChannelTags.forEach((function(n,r){if(!0===n.analyze){var i=e.getEEGDataByTag(n.tag);if(0===i.fftCount)t.push({tag:i.tag,fftCount:i.fftCount});else{var a=i.fftCount-1;t.push({tag:i.tag,fftCount:i.fftCount,time:i.fftTimes[a],fft:i.ffts[a],slice:{delta:i.slices.delta[a],theta:i.slices.theta[a],alpha1:i.slices.alpha1[a],alpha2:i.slices.alpha2[a],beta:i.slices.beta[a],lowgamma:i.slices.lowgamma[a],highgamma:i.slices.highgamma[a]},mean:{delta:i.means.delta[a],theta:i.means.theta[a],alpha1:i.means.alpha1[a],alpha2:i.means.alpha2[a],beta:i.means.beta[a],lowgamma:i.slices.lowgamma[a],highgamma:i.means.highgamma[a]}})}}})),t},this.getLatestCoherenceData=function(){var t=[];return e.data.coherence.forEach((function(e,n){var r=e.fftCount-1;t.push({tag:e.tag,fftCount:e.fftCount,time:e.times[r],fft:e.ffts[r],slice:{delta:e.slices.delta[r],theta:e.slices.theta[r],alpha1:e.slices.alpha1[r],alpha2:e.slices.alpha2[r],beta:e.slices.beta[r],gamma:e.slices.gamma[r]},mean:{delta:e.means.delta[r],theta:e.means.theta[r],alpha1:e.means.alpha1[r],alpha2:e.means.alpha2[r],beta:e.means.beta[r],gamma:e.means.gamma[r]}})})),t},this.getFrontalData=function(){var t=void 0;if(e.settings.eeg){var n=e.getEEGDataByTag("FP1"),r=e.getEEGDataByTag("FP2");n&&r||(n=e.getEEGDataByTag("AF7"),r=e.getEEGDataByTag("AF8")),n&&r&&(t=[n,r])}return t},this.getFrontalCoherenceData=function(){var t,n,r,i=void 0;return e.settings.coherence&&(i=null!==(t=null!==(n=null!==(r=e.getCoherenceByTag("FP2_FP1"))&&void 0!==r?r:e.getCoherenceByTag("FP1_FP2"))&&void 0!==n?n:e.getCoherenceByTag("AF7_AF8"))&&void 0!==t?t:e.getCoherenceByTag("AF8_AF7")),i},this.getCNCoherenceData=function(){var t=void 0;return e.settings.coherence&&void 0===(t=e.getCoherenceByTag("C3_C4"))&&(t=e.getCoherenceByTag("C4_C3")),t},this.getCNData=function(){var t=void 0;if(e.settings.eeg){var n=e.getEEGDataByTag("C3"),r=e.getEEGDataByTag("C4");n&&r&&(t=[n,r])}return t},this.getCoherenceScore=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"alpha1";if(t.fftCount>0){var r=t.fftCount,i=Math.min(20,r),a=t.means[n].slice(r-i);return e.mean(a)}return 0},this.getAlphaRatio=function(t){return t.fftCount>0?t.means.alpha2[eeg_ch.fftCount-1]/t.means.alpha1[eeg_ch.fftCount-1]:0},this.getThetaBetaRatio=function(t){return t.fftCount>0?t.means.theta[t.fftCount-1]/t.means.beta[t.fftCount-1]:0},this.getAlphaBetaRatio=function(t){return t.fftCount>0?.5*(t.means.alpha1[eeg_ch.fftCount-1]+t.means.alpha2[eeg_ch.fftCount-1])/t.means.beta[eeg_ch.fftCount-1]:0},this.get40HzGamma=function(t){if(t.fftCount>0){var n=t.slices.lowgamma[eeg_ch.fftCount-1],r=[];return n.forEach((function(t,n){e.eegshared.freqBins.lowgamma[n]>38&&e.eegshared.freqBins.lowgamma[n]<42&&r.push(t)})),e.max.apply(e,r)}return 0},this.getLowGammaScore=function(t){if(t.fftCount>0){var n=t.fftCount,r=20;n<r&&(r=n);var i=t.means.lowgamma.slice(n-r);return t.means.lowgamma[n-1]-e.mean(i)}return 0},this.getHEGRatioScore=function(t){if(t.count>0){var n=t.count,r=40;n<r&&(r=n);var i=t.ratio.slice(n-r);return t.ratio[n-1]-e.mean(i)}return 0},this.getBlink=function(){var t=[!1,!1];return null==e.data.blink&&(e.data.blink={blinkDuration:1,blinkThreshold:220,lastBlink:Date.now()}),Date.now()-e.data.blink.lastBlink>1e3*e.data.blink.blinkDuration&&([["AF7","FP1"],["AF8","FP2"]].forEach((function(n,r){var i,a=null!==(i=e.getEEGDataByTag(n[0]))&&void 0!==i?i:e.getEEGDataByTag(n[1]),o=a.filtered.slice(a.filtered.length-e.data.blink.blinkDuration*e.data.eegshared.sps),s=Math.max.apply(Math,g(o.map((function(t){return Math.abs(t)}))));t[r]=s>e.data.blink.blinkThreshold})),e.data.blink.lastBlink=Date.now()),t},this.beatDetection=function(t,n){var r=Math.floor(n/4);r%2==0&&(r+=1);var i=Math.round(.5*r),a=Math.floor(3*n);a%2==0&&(a+=1);var o=Math.round(.5*a),s=t.beat_detect;if(s.rir.push(t.red[t.count-1]+t.ir[t.count-1]),s.rir.length>r?s.rir[s.rir.length-1]=e.mean(s.rir.slice(s.rir.length-r)):s.rir[s.rir.length-1]=e.mean(s.rir),s.rir.length>a?s.rir2.push(e.mean(s.rir.slice(s.rir.length-a))):s.rir2.push(e.mean(s.rir)),t.count>1){if(s.drir_dt.push((s.rir[t.count-1]-s.rir[t.count-2])/(t.times[t.count-1]-t.times[t.count-2])),s.drir_dt.length>r){s.drir_dt[s.drir_dt.length-1]=e.mean(s.drir_dt.slice(s.drir_dt.length-r));var c=s.localmins.length,u=s.localmaxs.length;if(e.isExtrema(s.rir.slice(s.rir.length-r),"valley")?s.localmins.push({idx:t.count-i,val:s.rir[t.count-i],t:t.times[t.count-i]}):e.isExtrema(s.rir.slice(s.rir.length-r),"peak")&&s.localmaxs.push({idx:t.count-i,val:s.rir[t.count-i],t:t.times[t.count-i]}),s.localmins.length>1&&s.localmaxs.length>1){if(s.localmins.length>s.localmaxs.length+2)for(;s.localmins.length>s.localmaxs.length+2;)s.localmins.splice(s.localmins.length-2,1);else if(s.localmaxs.length>s.localmins.length+2)for(;s.localmaxs.length>s.localmins.length+2;)s.localmaxs.splice(s.localmins.length-2,1);if(c<s.localmins.length&&s.val_dists.push({dt:s.localmins[s.localmins.length-1].t-s.localmins[s.localmins.length-2].t,t:s.localmins[s.localmins.length-1].t,y0:s.localmins[s.localmins.length-2].val,y1:s.localmins[s.localmins.length-1].val}),u<s.localmaxs.length&&s.peak_dists.push({dt:s.localmaxs[s.localmaxs.length-1].t-s.localmaxs[s.localmaxs.length-2].t,t:s.localmaxs[s.localmaxs.length-1].t,y0:s.localmaxs[s.localmaxs.length-2].val,y1:s.localmaxs[s.localmaxs.length-1].val}),s.peak_dists.length>1&&s.val_dists.length>1)if(s.val_dists[s.val_dists.length-1].t>s.peak_dists[s.peak_dists.length-1].t){if(0===s.beats.length)s.beats.push({t:s.peak_dists[s.peak_dists.length-1].t,hrv:0,bpm:60*(s.peak_dists[s.peak_dists.length-1].dt+s.val_dists[s.val_dists.length-1].dt)/2e3,height0:s.peak_dists[s.peak_dists.length-1].y0-s.val_dists[s.val_dists.length-1].y0,height1:s.peak_dists[s.peak_dists.length-1].y1-s.val_dists[s.val_dists.length-1].y1});else if(s.beats[s.beats.length-1].t!==s.peak_dists[s.peak_dists.length-1].t){var l=60*(s.peak_dists[s.peak_dists.length-1].dt+s.val_dists[s.val_dists.length-1].dt)/2e3;s.beats.push({t:s.peak_dists[s.peak_dists.length-1].t,hrv:Math.abs(l-s.beats[s.beats.length-1].bpm),bpm:l,height0:s.peak_dists[s.peak_dists.length-1].y0-s.val_dists[s.val_dists.length-1].y0,height1:s.peak_dists[s.peak_dists.length-1].y1-s.val_dists[s.val_dists.length-1].y1})}}else if(0===s.beats.length)s.beats.push({t:s.peak_dists[s.peak_dists.length-2].t,hrv:0,bpm:60*(s.peak_dists[s.peak_dists.length-2].dt+s.val_dists[s.val_dists.length-1].dt)/2e3,height0:s.peak_dists[s.peak_dists.length-2].y0-s.val_dists[s.val_dists.length-2].y0,height1:s.peak_dists[s.peak_dists.length-2].y1-s.val_dists[s.val_dists.length-2].y1});else if(s.beats[s.beats.length-1].t!==s.peak_dists[s.peak_dists.length-2].t){var h=60*(s.peak_dists[s.peak_dists.length-2].dt+s.val_dists[s.val_dists.length-1].dt)/2e3;s.beats.push({t:s.peak_dists[s.peak_dists.length-2].t,hrv:Math.abs(h-s.beats[s.beats.length-2].bpm),bpm:h,height0:s.peak_dists[s.peak_dists.length-2].y0-s.val_dists[s.val_dists.length-2].y0,height1:s.peak_dists[s.peak_dists.length-2].y1-s.val_dists[s.val_dists.length-2].y1})}}}if(s.rir2.length>a){var f=s.localmins2.length,d=s.localmaxs2.length;if(e.isExtrema(s.rir2.slice(s.rir2.length-a),"valley")?s.localmins2.push({idx:t.count-o,val:s.rir[t.count-o],t:t.times[t.count-o]}):e.isExtrema(s.rir2.slice(s.rir2.length-a),"peak")&&s.localmaxs2.push({idx:t.count-o,val:s.rir[t.count-o],t:t.times[t.count-o]}),s.localmins2.length>1&&s.localmaxs2.length>1){if(s.localmins2.length>s.localmaxs2.length+2)for(;s.localmins2.length>s.localmaxs2.length+2;)s.localmins2.splice(s.localmins2.length-2,1);else if(s.localmaxs2.length>s.localmins2.length+2)for(;s.localmaxs2.length>s.localmins2.length+2;)s.localmaxs2.splice(s.localmins2.length-2,1);if(f<s.localmins2.length&&s.val_dists2.push({dt:s.localmins2[s.localmins2.length-1].t-s.localmins2[s.localmins2.length-2].t,t:s.localmins2[s.localmins2.length-1].t,y0:s.localmins2[s.localmins2.length-2].val,y1:s.localmins2[s.localmins2.length-1].val}),d<s.localmaxs2.length&&s.peak_dists2.push({dt:s.localmaxs2[s.localmaxs2.length-1].t-s.localmaxs2[s.localmaxs2.length-2].t,t:s.localmaxs2[s.localmaxs2.length-1].t,y0:s.localmaxs2[s.localmaxs2.length-2].val,y1:s.localmaxs2[s.localmaxs2.length-1].val}),s.peak_dists2.length>1&&s.val_dists2.length>1)if(s.val_dists2[s.val_dists2.length-1].t>s.peak_dists2[s.peak_dists2.length-1].t){if(0===s.breaths.length)s.breaths.push(m({t:s.peak_dists2[s.peak_dists2.length-1].t,bpm:12e4/(s.peak_dists2[s.peak_dists2.length-1].dt+s.val_dists2[s.val_dists2.length-1].dt),brv:0,height0:s.peak_dists2[s.peak_dists2.length-1].y0-s.val_dists2[s.val_dists2.length-1].y0},"height0",s.peak_dists2[s.peak_dists2.length-1].y1-s.val_dists2[s.val_dists2.length-1].y1));else if(s.breaths[s.breaths.length-1].t!==s.peak_dists2[s.peak_dists2.length-1].t){var p=12e4/(s.peak_dists2[s.peak_dists2.length-1].dt+s.val_dists2[s.val_dists2.length-1].dt);s.breaths.push(m({t:s.peak_dists2[s.peak_dists2.length-1].t,bpm:p,brv:Math.abs(p-s.breaths[s.breaths.length-1].bpm),height0:s.peak_dists2[s.peak_dists2.length-1].y0-s.val_dists2[s.val_dists2.length-1].y0},"height0",s.peak_dists2[s.peak_dists2.length-1].y1-s.val_dists2[s.val_dists2.length-1].y1))}}else if(0===s.breaths.length)s.breaths.push(m({t:s.peak_dists2[s.peak_dists2.length-2].t,bpm:12e4/(s.peak_dists2[s.peak_dists2.length-2].dt+s.val_dists2[s.val_dists2.length-2].dt),brv:0,height0:s.peak_dists2[s.peak_dists2.length-2].y0-s.val_dists2[s.val_dists2.length-2].y0},"height0",s.peak_dists2[s.peak_dists2.length-2].y1-s.val_dists2[s.val_dists2.length-2].y1));else if(s.breaths[s.breaths.length-1].t!==s.peak_dists2[s.peak_dists2.length-2].t){var v=12e4/(s.peak_dists2[s.peak_dists2.length-2].dt+s.val_dists2[s.val_dists2.length-2].dt);s.breaths.push(m({t:s.peak_dists2[s.peak_dists2.length-2].t,bpm:v,brv:Math.abs(v-s.breaths[s.breaths.length-1].bpm),height0:s.peak_dists2[s.peak_dists2.length-2].y0-s.val_dists2[s.val_dists2.length-2].y0},"height0",s.peak_dists2[s.peak_dists2.length-2].y1-s.val_dists2[s.val_dists2.length-2].y1))}}}}},this.mapFFTData=function(t,n,r){e.data.eeg.find((function(i,a){if(i.tag===r){if(i.fftCount++,i.fftTimes.push(n),i.ffts.push(t),e.data.eegshared.bandFreqs.scp[1].length>0){var o=t.slice(e.data.eegshared.bandFreqs.scp[1][0],e.data.eegshared.bandFreqs.scp[1][e.data.eegshared.bandFreqs.scp[1].length-1]+1);i.slices.scp.push(o),i.means.scp.push(e.mean(o))}if(e.data.eegshared.bandFreqs.scp[1].length>0){var s=t.slice(e.data.eegshared.bandFreqs.delta[1][0],e.data.eegshared.bandFreqs.delta[1][e.data.eegshared.bandFreqs.delta[1].length-1]+1);i.slices.delta.push(s),i.means.delta.push(e.mean(s))}if(e.data.eegshared.bandFreqs.theta[1].length>0){var c=t.slice(e.data.eegshared.bandFreqs.theta[1][0],e.data.eegshared.bandFreqs.theta[1][e.data.eegshared.bandFreqs.theta[1].length-1]+1);i.slices.theta.push(c),i.means.theta.push(e.mean(c))}if(e.data.eegshared.bandFreqs.alpha1[1].length>0){var u=t.slice(e.data.eegshared.bandFreqs.alpha1[1][0],e.data.eegshared.bandFreqs.alpha1[1][e.data.eegshared.bandFreqs.alpha1[1].length-1]+1);i.slices.alpha1.push(u),i.means.alpha1.push(e.mean(u))}if(e.data.eegshared.bandFreqs.alpha2[1].length>0){var l=t.slice(e.data.eegshared.bandFreqs.alpha2[1][0],e.data.eegshared.bandFreqs.alpha2[1][e.data.eegshared.bandFreqs.alpha2[1].length-1]+1);i.slices.alpha2.push(l),i.means.alpha2.push(e.mean(l))}if(e.data.eegshared.bandFreqs.beta[1].length>0){var h=t.slice(e.data.eegshared.bandFreqs.beta[1][0],e.data.eegshared.bandFreqs.beta[1][e.data.eegshared.bandFreqs.beta[1].length-1]+1);i.slices.beta.push(h),i.means.beta.push(e.mean(h))}if(e.data.eegshared.bandFreqs.lowgamma[1].length>0){var f=t.slice(e.data.eegshared.bandFreqs.lowgamma[1][0],e.data.eegshared.bandFreqs.lowgamma[1][e.data.eegshared.bandFreqs.lowgamma[1].length-1]+1);i.slices.lowgamma.push(f),i.means.lowgamma.push(e.mean(f))}if(e.data.eegshared.bandFreqs.highgamma[1].length>0){var d=t.slice(e.data.eegshared.bandFreqs.highgamma[1][0],e.data.eegshared.bandFreqs.highgamma[1][e.data.eegshared.bandFreqs.highgamma[1].length-1]+1);i.slices.highgamma.push(d),i.means.highgamma.push(e.mean(d))}return!0}}))},this.mapCoherenceData=function(t,n){t.forEach((function(t,r){if(e.data.coherence[r].fftCount++,e.data.coherence[r].ffts.push(t),e.data.coherence[r].fftTimes.push(n),e.data.eegshared.bandFreqs.scp[1].length>0){var i=t.slice(e.data.eegshared.bandFreqs.scp[1][0],e.data.eegshared.bandFreqs.scp[1][e.data.eegshared.bandFreqs.scp[1].length-1]+1);e.data.coherence[r].slices.scp.push(i),e.data.coherence[r].means.scp.push(e.mean(i))}if(e.data.eegshared.bandFreqs.delta[1].length>0){var a=t.slice(e.data.eegshared.bandFreqs.delta[1][0],e.data.eegshared.bandFreqs.delta[1][e.data.eegshared.bandFreqs.delta[1].length-1]+1);e.data.coherence[r].slices.delta.push(a),e.data.coherence[r].means.delta.push(e.mean(a))}if(e.data.eegshared.bandFreqs.theta[1].length>0){var o=t.slice(e.data.eegshared.bandFreqs.theta[1][0],e.data.eegshared.bandFreqs.theta[1][e.data.eegshared.bandFreqs.theta[1].length-1]+1);e.data.coherence[r].slices.theta.push(o),e.data.coherence[r].means.theta.push(e.mean(o))}if(e.data.eegshared.bandFreqs.alpha1[1].length>0){var s=t.slice(e.data.eegshared.bandFreqs.alpha1[1][0],e.data.eegshared.bandFreqs.alpha1[1][e.data.eegshared.bandFreqs.alpha1[1].length-1]+1);e.data.coherence[r].slices.alpha1.push(s),e.data.coherence[r].means.alpha1.push(e.mean(s))}if(e.data.eegshared.bandFreqs.alpha2[1].length>0){var c=t.slice(e.data.eegshared.bandFreqs.alpha2[1][0],e.data.eegshared.bandFreqs.alpha2[1][e.data.eegshared.bandFreqs.alpha2[1].length-1]+1);e.data.coherence[r].slices.alpha2.push(c),e.data.coherence[r].means.alpha2.push(e.mean(c))}if(e.data.eegshared.bandFreqs.beta[1].length>0){var u=t.slice(e.data.eegshared.bandFreqs.beta[1][0],e.data.eegshared.bandFreqs.beta[1][e.data.eegshared.bandFreqs.beta[1].length-1]+1);e.data.coherence[r].slices.beta.push(u),e.data.coherence[r].means.beta.push(e.mean(u))}if(e.data.eegshared.bandFreqs.lowgamma[1].length>0){var l=t.slice(e.data.eegshared.bandFreqs.lowgamma[1][0],e.data.eegshared.bandFreqs.lowgamma[1][e.data.eegshared.bandFreqs.lowgamma[1].length-1]+1);e.data.coherence[r].slices.lowgamma.push(l),e.data.coherence[r].means.lowgamma.push(e.mean(l))}if(e.data.eegshared.bandFreqs.highgamma[1].length>0){var h=t.slice(e.data.eegshared.bandFreqs.highgamma[1][0],e.data.eegshared.bandFreqs.highgamma[1][e.data.eegshared.bandFreqs.highgamma[1].length-1]+1);e.data.coherence[r].slices.highgamma.push(h),e.data.coherence[r].means.highgamma.push(e.mean(h))}}))},this.bufferEEGSignals=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=Math.floor(e.data.eegshared.sps*t),r=[],i=null,a=0;a<e.data.eegshared.eegChannelTags.length;a++)if(!0===e.data.eegshared.eegChannelTags[a].analyze&&null!==e.data.eegshared.eegChannelTags[a].tag&&"other"!==e.data.eegshared.eegChannelTags[a].tag){var o=e.getEEGDataByTag(e.data.eegshared.eegChannelTags[a].tag);void 0!==o&&(o.filtered.length>0?r.push(o.filtered.slice(o.filtered.length-n)):o.raw.length>0&&r.push(o.raw.slice(o.raw.length-n)),null===i&&(i=o.times[o.times.length-1]))}return!0===e.settings.analyzing&&(e.workerPostTime=i),r},this.readyEEGDataForWriting=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end",r=["TimeStamps","UnixTime"],i=[],a=0,o=0,s=[],c=null;if(e.data.eegshared.eegChannelTags.forEach((function(t,n){null===c&&"other"!==t.tag&&!0===t.analyze&&(c=e.getEEGDataByChannel(t.ch)),s.push(e.getEEGDataByChannel(t.ch))})),s.length>0){if("end"===n&&(n=s[0].count),s[0].count<t&&(t=e.atlas.rolloverLimit-2e3),0!==t)for(;c.fftTimes[a]<s[0].times[t];)a++;for(var u=function(t){var n=[];if(n.push(e.toISOLocal(new Date(s[0].times[t])),s[0].times[t]),s.forEach((function(e,i){0===t&&r.push(e.tag),e.filtered.length>t?n.push(e.filtered[t].toFixed(0)):e.raw.length>t&&n.push(e.raw[t].toFixed(0))})),c.fftCount>=a&&c.fftTimes[a]===s[0].times[t]&&(s.forEach((function(i,o){if(0===a&&!e.data.eegshared.eegChannelTags.find((function(t,e){if(!(i.tag!==t.ch&&i.tag!==t.tag||!1!==t.analyze&&"other"!==t.tag))return!0}))){var c=g(e.data.eegshared.frequencies).map((function(t,e){return t.toFixed(3)}));r.push(i.tag+"; FFT Hz:",c.join(","))}s[0].times[t]===i.fftTimes[a]&&n.push(g(i.ffts[a]).map((function(t,e){return t.toFixed(3)})))})),e.settings.coherence&&e.data.coherence.forEach((function(t,i){if(0===a){var o=g(e.data.eegshared.frequencies).map((function(t,e){return t.toFixed(3)}));r.push(t.tag+"; FFT Hz:",o.join(","))}if(s[0].fftTimes[a]===t.fftTimes[a])try{n.push(g(t.ffts[a]).map((function(t,e){return t.toFixed(3)})))}catch(e){console.log(e,a,t)}})),a++),e.data.other.notes.length>0){if(0===t)r.push("Notes");else for(;e.data.other.notes[o].time<s[0].times[t];)o++;e.data.other.notes[o].time<=s[0].times[t]&&(n.push(e.data.other.notes[o].note),nodeidx++)}i.push(n.join(","))},l=t;l<n;l++)u(l);return[r.join(",")+"\n",i.join("\n")]}},this.readyHEGDataForWriting=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=["TimeStamps","UnixTime","Red","IR","Ambient","Ratio"],a=[],o=e.data.heg[r];"end"===n&&(n=o.times.length);for(var s=t;s<n;s++){var c=o.times[s];if(a.push([c,e.toISOLocal(new Date(c)),o.red[s],o.ir[s],o.ambient[s],o.ratio[s]].join(",")),e.data.other.notes.length>0){if(0===s)i.push("Notes");else for(;e.data.other.notes[noteidx].time<c;)noteidx++;e.data.other.notes[noteidx].time<=c&&(line.push(e.data.other.notes[noteidx].note),nodeidx++)}}return[i.join(",")+"\n",a.join("\n")]},this.workeronmessage=function(t){if(t.origin===e.name){if("multidftbandpass"===t.foo||"multidft"===t.foo){var n=g(t.output[1]),r=0;e.data.eegshared.eegChannelTags.forEach((function(t,i){null!==t.tag&&"other"!==t.tag&&!0===t.analyze&&(e.mapFFTData(n[r],e.workerPostTime,t.tag),r++)})),e.checkRollover("eeg")}else if("coherence"===t.foo){n=g(t.output[1]);var i=g(t.output[2]),a=0;e.data.eegshared.eegChannelTags.forEach((function(t,r){null!==t.tag&&"other"!==t.tag&&!0===t.analyze&&(e.mapFFTData(n[a],e.workerPostTime,t.tag),a++)})),e.mapCoherenceData(i,e.workerPostTime),e.checkRollover("eeg")}e.workerWaiting=!1}},this.analyzer=function(){!0===e.settings.analyzing&&(e.settings.analysis.forEach((function(t,n){e.analyzerOpts.forEach((function(n,r){n===t&&e.analyzerFuncs[r]()}))})),"undefined"==typeof window?setTimeout((function(){e.analyzer}),60):setTimeout((function(){requestAnimationFrame(e.analyzer)}),50))},this.makeFeedbackOptions=function(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.getElementById(t.props.id).querySelector(".brainsatplay-neurofeedback-container"),i=t.props.id,a="";if(e.settings.deviceConnected){r.style.pointerEvents="auto";var o=function(){return e.getCoherenceScore(e.getFrontalCoherenceData(),"alpha1")},s=function(){var t=e.getFrontalData(),n=[];return t.forEach((function(t){n.push(e.getThetaBetaRatio(t))})),Math.min(1/(n.reduce((function(t,e){return t+e}))/n.length),1)},c=function(){var t=e.data.heg[0].count;if(t>1){var n=40;t<n&&(n=t);var r=e.data.heg[0].ratio.slice(t-n);return e.data.heg[0].ratio[t-1]-e.mean(r)}},u=function(t){var n=e.data.heg[0].beat_detect[t],r=e.data.heg[0].beat_detect.prevBeatLength;if(e.data.heg[0].beat_detect.prevBeatLength=n.length,r<n.length&&(console.log("beat"),n[n.length-1].tRead=Date.now()),0<n.length){var i=(Date.now()-n[n.length-1].tRead)/1e3*n[n.length-1].bpm/30;return i<1?1-(.5+.5*Math.cos(2*Math.PI*i)):0}return 0},l=function(){return u("beats")},h=function(){return u("breaths")};n=[{label:"Select your neurofeedback",function:t.defaultNeurofeedback}],e.settings.heg&&n.push({label:"HEG Ratio",function:c},{label:"Heartbeat",function:l},{label:"Breath",function:h}),e.settings.eeg&&n.push({label:"Frontal Alpha Coherence",function:o},{label:"Focus",function:s});var f=document.getElementById("".concat(i,"-neurofeedbackselector"));null==f&&(a='<div><select id="'.concat(i,'-neurofeedbackselector">'),n.forEach((function(t,e){a+=0===e?"<option value=".concat(t.function.name," disabled>").concat(t.label,"</option>"):1===e?"<option value=".concat(t.function.name," selected>").concat(t.label,"</option>"):"<option value=".concat(t.function.name,">").concat(t.label,"</option>"),e===n.length-1&&(a+="</select></div>")})),r.innerHTML+=a,f=document.getElementById("".concat(i,"-neurofeedbackselector"))),t.getNeurofeedback=n.find((function(t){return t.function.name==f.value})).function,f.onchange=function(e){t.getNeurofeedback=n.find((function(t){return t.function.name==e.target.value})).function}}},this.name=n,this.config=i,this.state=new p({deviceConnected:!1,analyzing:!1,analysis:s,heg:!1,eeg:!1,coherence:!1,eyetracker:!1,accelerometer:!1,hrv:!1,fnirs:!1,ecg:!1,spo2:!1,emg:!1}),this.settings=this.state.data,this.data={eegshared:{eegChannelTags:[],sps:1,startTime:0,frequencies:[],bandFreqs:{scp:[[],[]],delta:[[],[]],theta:[[],[]],alpha1:[[],[]],alpha2:[[],[]],beta:[[],[]],lowgamma:[[],[]],highgamma:[[],[]]}},eeg:[],coherence:[],heg:[],fnirs:[],accelerometer:[],hrv:[],spo2:[],emg:[],ecg:[],eyetracker:[],other:{notes:[],games:{}}},Object.assign(this.data,r),this.rolloverLimit=60030,"10_20"===i?(this.settings.eeg=!0,this.data.eeg=this.gen10_20Atlas(this.data.eegshared.eegChannelTags)):"muse"===i?(this.settings.eeg=!0,this.data.eeg=this.genMuseAtlas()):"big"===i?(this.settings.eeg=!0,this.data.eeg=this.gen10_20Atlas()):"hegduino"===i?(this.addHEGCoord(this.data.heg.length,0,60,60),this.settings.heg=!0):"eyetracker"===i&&(this.settings.eyetracker=!0,this.addEyeTracker(this.data.eyetracker.length)),!0===a&&(this.settings.coherence=!0,this.data.coherence=this.genCoherenceMap(this.data.eegshared.eegChannelTags)),this.data.eegshared.eegChannelTags&&this.data.eegshared.eegChannelTags.forEach((function(t,n){void 0===e.getEEGDataByTag(t.tag)&&e.addEEGCoord(t.ch)})),this.data.eegshared.sps&&(this.data.eegshared.frequencies=this.bandpassWindow(0,128,.5*this.data.eegshared.sps),this.data.eegshared.bandFreqs=this.getBandFreqs(this.data.eegshared.frequencies)),this.analyzerOpts=[],this.analyzerFuncs=[],this.workerPostTime=0,this.workerWaiting=!1,this.workerIdx=0,!0===o&&(this.addDefaultAnalyzerFuncs(),window.workerResponses||(window.workerResponses=[]),window.workerResponses.push(this.workeronmessage))}var e,n;return e=t,(n=[{key:"genEEGCoordinateStruct",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i={scp:[],delta:[],theta:[],alpha1:[],alpha2:[],beta:[],lowgamma:[],highgamma:[]},a={tag:t,position:{x:e,y:n,z:r},count:0,times:[],raw:[],filtered:[],fftCount:0,fftTimes:[],ffts:[],slices:JSON.parse(JSON.stringify(i)),means:JSON.parse(JSON.stringify(i)),lastReadFFT:0,lastRead:0};return a}},{key:"addEEGCoord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:999,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:999;this.data.eeg.push(this.genEEGCoordinateStruct(t,e,n,r))}},{key:"genMuseAtlas",value:function(){var t=this,e=[],n=[[-21.5,70.2,-.1],[28.4,69.1,-.4],[-54.8,33.9,-3.5],[56.6,30.8,-4.1]];function r(t,e){var n=[];return t.forEach((function(t,r){n.push(.5*(t+e[r]))})),n}var i=[r(n[0],n[2]),r(n[1],n[3]),[-80.2,-31.3,-10.7],[81.9,-34.2,-8.2]];return["AF7","AF8","TP9","TP10"].forEach((function(n,r){e.push(t.genEEGCoordinateStruct(n,i[r][0],i[r][1],i[r][2]))})),e}},{key:"gen10_20Atlas",value:function(t){var e=this,n={FP1:[-21.2,66.9,12.1],FPZ:[1.4,65.1,11.3],FP2:[24.3,66.3,12.5],AF7:[-41.7,52.8,11.3],AF3:[-32.7,48.4,32.8],AFZ:[1.8,54.8,37.9],AF4:[35.1,50.1,31.1],AF8:[43.9,52.7,9.3],F5:[-51.4,26.7,24.7],F3:[-39.7,25.3,44.7],F1:[-22.1,26.8,54.9],FZ:[0,26.8,60.6],F2:[23.6,28.2,55.6],F4:[41.9,27.5,43.9],F6:[52.9,28.7,25.2],F7:[-52.1,28.6,3.8],F8:[53.2,28.4,3.1],FC5:[-59.1,3,26.1],FC3:[-45.5,2.4,51.3],FC1:[-24.7,.3,66.4],FCZ:[1,1,72.8],FC2:[26.1,3.2,66],FC4:[47.5,4.6,49.7],FC6:[60.5,4.9,25.5],FT9:[-53.8,-2.1,-29.1],FT7:[-59.2,3.4,-2.1],FT8:[60.2,4.7,-2.8],FT10:[55,-3.6,-31],T7:[-65.8,-17.8,-2.9],T5:[-61.5,-65.3,1.1],T3:[-70.2,-21.3,-10.7],T4:[71.9,-25.2,-8.2],T6:[59.3,-67.6,3.8],T8:[67.4,-18.5,-3.4],C5:[-63.6,-18.9,25.8],C3:[-49.1,-20.7,53.2],C1:[-25.1,-22.5,70.1],CZ:[.8,-21.9,77.4],C2:[26.7,-20.9,69.5],C4:[50.3,-18.8,53],C6:[65.2,-18,26.4],CP5:[-61.8,-46.2,22.5],CP3:[-46.9,-47.7,49.7],CP1:[-24,-49.1,66.1],CPZ:[.7,-47.9,72.6],CP2:[25.8,-47.1,66],CP4:[49.5,-45.5,50.7],CP6:[62.9,-44.6,24.4],TP9:[-73.6,-46.7,-4],TP7:[-63.6,-44.7,-4],TP8:[64.6,-45.4,-3.7],TP10:[74.6,-47.4,-3.7],P9:[-50.8,-51.3,-37.7],P7:[-55.9,-64.8,0],P5:[-52.7,-67.1,19.9],P3:[-41.4,-67.8,42.4],P1:[-21.6,-71.3,52.6],PZ:[.7,-69.3,56.9],P2:[24.4,-69.9,53.5],P4:[44.2,-65.8,42.7],P6:[54.4,-65.3,20.2],P8:[56.4,-64.4,.1],P10:[51,-53.9,-36.5],PO7:[-44,-81.7,1.6],PO3:[-33.3,-84.3,26.5],POZ:[0,-87.9,33.5],PO4:[35.2,-82.6,26.1],PO8:[43.3,-82,.7],O1:[-25.8,-93.3,7.7],Oz:[.3,-97.1,8.7],O2:[25,-95.2,6.2]},r=[];if(null==t)for(var i in n)r.push(this.genEEGCoordinateStruct(i,n[i][0],n[i][1],n[i][2]));else t.forEach((function(t){var i=t.tag;n[i]&&r.push(e.genEEGCoordinateStruct(i,n[i][0],n[i][1],n[i][2]))})),["FP1","FP2","FZ","F3","F4","F7","F8","CZ","C3","C4","T3","T4","T5","T6","PZ","P3","P4","O1","O2"].forEach((function(t,i){r.find((function(e){return e.tag===t}))||r.push(e.genEEGCoordinateStruct(t,n[t][0],n[t][1],n[t][2]))}));return r}},{key:"genCoherenceStruct",value:function(t,e,n,r){var i={scp:[],delta:[],theta:[],alpha1:[],alpha2:[],beta:[],lowgamma:[],highgamma:[]};return{tag:t+"_"+e,x0:null==n?void 0:n.x,y0:null==n?void 0:n.y,z0:null==n?void 0:n.z,x1:null==r?void 0:r.x,y1:null==r?void 0:r.y,z1:null==r?void 0:r.z,fftCount:0,fftTimes:[],ffts:[],slices:JSON.parse(JSON.stringify(i)),means:JSON.parse(JSON.stringify(i)),lastRead:0}}},{key:"genCoherenceMap",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data.eegshared.eegChannelTags,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=1,i=0,a=0;a<t.length*(t.length+1)/2-t.length;a++){if(!1===e||!0===e&&null!==t[i].tag&&null!==t[i+r].tag&&"other"!==t[i].tag&&"other"!==t[i+r].tag&&!0===t[i].analyze&&!0===t[i+r].analyze){var o=this.getEEGDataByTag(t[i].tag),s=this.getEEGDataByTag(t[i+r].tag);n.push(this.genCoherenceStruct(t[i].tag,t[i+r].tag,o.position,s.position))}++r+i===t.length&&(i++,r=1)}return n}},{key:"genHEGStruct",value:function(t,e,n,r){return{tag:t,position:{x:e,y:n,z:r},count:0,times:[],red:[],ir:[],ambient:[],ratio:[],beat_detect:{beats:[],breaths:[],rir:[],rir2:[],drir_dt:[],localmins:[],localmaxs:[],val_dists:[],peak_dists:[],localmins2:[],localmaxs2:[],val_dists2:[],peak_dists2:[]},lastRead:0,startTime:0}}},{key:"addHEGCoord",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"heg1",e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.data.heg.push(this.genHEGStruct(t,e,n,r))}},{key:"genFNIRSStruct",value:function(t,e,n,r){return{tag:t,position:{x:e,y:n,z:r},count:0,times:[],red:[],ir:[],ir2:[],ambient:[],lastRead:0}}},{key:"addFNIRSCoord",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"banana1",e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.data.fnirs.push(this.genHEGStruct(t,e,n,r))}},{key:"genAccelerometerStruct",value:function(t,e,n,r){return{tag:t,position:{x:e,y:n,z:r},count:0,times:[],Ax:[],Ay:[],Az:[],Gx:[],Gy:[],Gz:[],lastRead:0,startTime:0}}},{key:"addAccelerometerCoord",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"accel1",e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.data.accelerometer.push(this.genAccelerometerStruct(t,e,n,r))}},{key:"genHRVStruct",value:function(t){return{tag:t,count:0,times:[],raw:[],filtered:[],bpm:[],hrv:[],lastRead:0,startTime:0}}},{key:"addHRV",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hrv1";this.data.hrv.push(genHRVStruct(t))}},{key:"genEyeTrackerStruct",value:function(t){return{tag:t,count:0,times:[],x:[],y:[],smax:[],smay:[],lastRead:0,startTime:0}}},{key:"addEyeTracker",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eyes";this.data.eyetracker.push(this.genEyeTrackerStruct(t))}},{key:"makeNote",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"event",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(void 0===e){if(this.settings.eeg){var n=this.getEEGDataByChannel(this.data.eegshared.eegChannelTags[0].ch);e=n.times[n.times.length-1],this.data.other.notes.push({time:e,note:t})}this.settings.heg?(e=this.data.heg[0].times[this.data.heg[0].times.length-1],this.data.other.notes.push({time:e,note:t})):this.data.other.notes.push({time:Date.now(),note:t})}else this.data.other.notes.push({time:e,note:t})}},{key:"getCoordPositions",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eeg",e=[],n=0;n<this.data[t].length;n++)e.push([this.data[t][n].position.x,this.data[t][n].position.y,this.data[t][n].position.z]);return e}},{key:"mean",value:function(t){return t.reduce((function(t,e){return e+t}))/t.length}},{key:"isExtrema",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"peak",n=g(t);if(n.length%2==0&&n.pop(),t.length>1){var r=!0;return n.forEach((function(t,i){"peak"===e?(i<Math.floor(.5*n.length)&&t>=n[Math.floor(.5*n.length)]||i>Math.floor(.5*n.length)&&t>=n[Math.floor(.5*n.length)])&&(r=!1):(i<Math.floor(.5*n.length)&&t<=n[Math.floor(.5*n.length)]||i>Math.floor(.5*n.length)&&t<=n[Math.floor(.5*n.length)])&&(r=!1)})),"peak"!==e&&"valley"!==e&&!1===r&&(r=!0,n.forEach((function(t,e){(e<Math.floor(.5*n.length)&&t>=n[Math.floor(.5*n.length)]||e>Math.floor(.5*n.length)&&t>=n[Math.floor(.5*n.length)])&&(r=!1)}))),r}}},{key:"isCriticalPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"peak",n=g(t);if(n.length%2==0&&n.pop(),t.length>1){var r=!0;return n.forEach((function(t,i){"peak"===e?(i<.5*n.length&&t<=0||i>.5*n.length&&t>0)&&(r=!1):(i<.5*n.length&&t>=0||i>.5*n.length&&t<0)&&(r=!1)})),"peak"!==e&&"valley"!==e&&!1===r&&(r=!0,n.forEach((function(t,e){(e<.5*n.length&&t<=0||e>.5*n.length&&t>0)&&(r=!1)}))),r}}},{key:"setDefaultTags",value:function(){return[{ch:0,tag:null},{ch:1,tag:null},{ch:2,tag:null},{ch:3,tag:null},{ch:4,tag:null},{ch:5,tag:null},{ch:6,tag:null},{ch:7,tag:null},{ch:8,tag:null},{ch:9,tag:null},{ch:10,tag:null},{ch:11,tag:null},{ch:12,tag:null},{ch:13,tag:null},{ch:14,tag:null},{ch:15,tag:null},{ch:16,tag:null},{ch:17,tag:null},{ch:18,tag:null},{ch:19,tag:null},{ch:20,tag:null},{ch:21,tag:null},{ch:22,tag:null},{ch:23,tag:null},{ch:24,tag:null},{ch:25,tag:null},{ch:26,tag:null},{ch:27,tag:null},{ch:28,tag:null},{ch:29,tag:null},{ch:30,tag:null},{ch:31,tag:null}]}},{key:"getBandFreqs",value:function(t){var e=[[],[]],n=[[],[]],r=[[],[]],i=[[],[]],a=[[],[]],o=[[],[]],s=[[],[]],c=[[],[]];return t.forEach((function(t,u){t>=.1&&t<=1?(e[0].push(t),e[1].push(u)):t>=1&&t<=4?(n[0].push(t),n[1].push(u)):t>4&&t<=8?(r[0].push(t),r[1].push(u)):t>8&&t<=10?(i[0].push(t),i[1].push(u)):t>10&&t<=12?(a[0].push(t),a[1].push(u)):t>12&&t<=30?(o[0].push(t),o[1].push(u)):t>30&&t<=45?(s[0].push(t),s[1].push(u)):t>45&&(c[0].push(t),c[1].push(u))})),{scp:e,delta:n,theta:r,alpha1:i,alpha2:a,beta:o,lowgamma:s,highgamma:c}}},{key:"bandpassWindow",value:function(t,e,n){for(var r=(e-t)/n,i=[],a=0;a<e;)i.push(a),a+=r;return i}},{key:"toISOLocal",value:function(t){var e=function(t){return("0"+t).slice(-2)},n=t.getTimezoneOffset(),r=n<0?"+":"-";return n=Math.abs(n),t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+"T"+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+"."+("00"+t.getMilliseconds()).slice(-3)+"(UTC"+r+e(n/60|0)+":00)"}},{key:"regenAtlasses",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512;this.data.eeg=this.makeAtlas10_20();var r=this.bandPassWindow(t,e,n);this.data.eegshared.frequencies=r,this.data.eegshared.bandFreqs=this.getBandFreqs(r),this.coherenceMap=this.genCoherenceMap()}},{key:"addDefaultAnalyzerFuncs",value:function(){var t=this;this.analyzerOpts.push("eegfft","eegcoherence"),this.analyzerFuncs.push((function(){if(!1===t.workerWaiting){var e=t.bufferEEGSignals(1);e.length>0&&e[0].length>=t.data.eegshared.sps&&(window.postToWorker({foo:"multidftbandpass",input:[e,1,0,128,1],origin:t.name},t.workerIdx),t.workerWaiting=!0)}}),(function(){if(!1===t.workerWaiting){var e=t.bufferEEGSignals(1);e.length>0&&e[0].length>=t.data.eegshared.sps&&(window.postToWorker({foo:"coherence",input:[e,1,0,128,1],origin:t.name},t.workerIdx),t.workerWaiting=!0)}}))}},{key:"addAnalyzerFunc",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=this.analyzerOpts.find((function(e,r){if(e==e)return t.analyzerFuncs[r]=n,!0}));void 0===r&&(this.analyzerOpts.push(e),this.analyzerFuncs.push(n))}},{key:"checkRollover",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===e)for(var n in this.data)Array.isArray(this.data[n])&&this.data[n].forEach((function(e,n){for(var r in e)if(Array.isArray(e[r])||"object"!==v(e[r]))Array.isArray(e[r])&&e[r].length>t.rolloverLimit&&(e[r].splice(0,e[r].length-t.rolloverLimit-2e3),"ffts"===r?(e.fftCount=e[r].length,e.lastReadFFT>e[r].length&&(e.lastReadFFT=e[r].length)):"times"===r&&(e.count=e[r].length,e.lastRead>e[r].length&&(e.lastRead=e[r].length)));else for(var i in e[r])Array.isArray(e[r][i])&&e[r][i].length>t.rolloverLimit&&e[r][i].splice(0,e[r][i].length-t.rolloverLimit-2e3)}));else Array.isArray(this.data[e])&&this.data[e].forEach((function(e,n){for(var r in e)if(Array.isArray(e[r])||"object"!==v(e[r]))Array.isArray(e[r])&&e[r].length>t.rolloverLimit&&(e[r].splice(0,e[r].length-t.rolloverLimit-2e3),"ffts"===r?(e.fftCount=e[r].length,e.lastReadFFT=e[r].length):"times"===r&&(e.count=e[r].length,e.lastRead=e[r].length));else for(var i in e[r])Array.isArray(e[r][i])&&e[r][i].length>t.rolloverLimit&&e[r][i].splice(0,e[r][i].length-t.rolloverLimit-2e3)}))}}])&&w(e.prototype,n),t}();function S(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function I(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){S(a,r,i,o,s,"next",t)}function s(t){S(a,r,i,o,s,"throw",t)}o(void 0)}))}}function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function x(t){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function B(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var _=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.onDecodedCallback,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onConnectedCallback,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onDisconnectedCallback,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.decode,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:115200;B(this,t),this.onDecodedCallback=e,this.onConnectedCallback=n,this.onDisconnectedCallback=r,this.decode=i,this.connected=!1,this.subscribed=!1,this.buffer=[],this.startByte=160,this.stopByte=192,this.searchString=new Uint8Array([this.stopByte,this.startByte]),this.readRate=16.666667,this.readBufferSize=2e3,this.sps=512,this.nChannels=32,this.nPeripheralChannels=6,this.updateMs=1e3/this.sps,this.stepSize=1/Math.pow(2,24),this.vref=2.5,this.gain=8,this.vscale=this.vref/this.gain*this.stepSize,this.uVperStep=this.vref/this.gain*this.stepSize*1e6,this.scalar=1/(1e6/(this.vref/this.gain*this.stepSize)),this.maxBufferedSamples=60*this.sps*2,this.data={count:0,startms:0,ms:[],A0:[],A1:[],A2:[],A3:[],A4:[],A5:[],A6:[],A7:[],A8:[],A9:[],A10:[],A11:[],A12:[],A13:[],A14:[],A15:[],A16:[],A17:[],A18:[],A19:[],A20:[],A21:[],A22:[],A23:[],A24:[],A25:[],A26:[],A27:[],A28:[],A29:[],A30:[],A31:[],Ax:[],Ay:[],Az:[],Gx:[],Gy:[],Gz:[]},this.resetDataBuffers(),navigator.serial||console.error("`navigator.serial not found! Enable #enable-experimental-web-platform-features in chrome://flags (search 'experimental')"),this.port=null,this.reader=null,this.baudrate=a}var e,n,r,i,a,o,s;return e=t,(n=[{key:"resetDataBuffers",value:function(){for(var t in this.data.count=0,this.data.startms=0,this.data)"object"===x(this.data[t])&&(this.data[t]=new Array(this.maxBufferedSamples).fill(0))}},{key:"setScalar",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/(Math.pow(2,23)-1),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4.5;this.stepSize=e,this.vref=n,this.gain=t,this.vscale=this.vref/this.gain*this.stepSize,this.uVperStep=this.vref/this.gain*this.stepSize*1e6,this.scalar=1/(1e6/(this.vref/this.gain*this.stepSize))}},{key:"getLatestData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"A0",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e;return n<=1?[this.data[t][this.data.count-1]]:(n>this.data.count&&(n=this.data.count),this.data[t].slice(this.data.count-n,this.data.count))}},{key:"bytesToInt16",value:function(t,e){return 256*t+e}},{key:"int16ToBytes",value:function(t){return[255&t,t>>8&255]}},{key:"bytesToInt24",value:function(t,e,n){return 65536*t+256*e+n}},{key:"int24ToBytes",value:function(t){return[255&t,t>>8&255,t>>16&255]}},{key:"decode",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.buffer,e=this.searchString,n=t,r=this.boyerMoore(e),i=r.byteLength,a=[],o=0,s=r(n);-1!==s;s=r(n,s+i))a.push(s);if(a.length>=2){for(var c=1;c<a.length;c++)if(a[c]-a[c-1]!=105);else{var u=t.slice(a[c-1],a[c]+1);for(this.data.count<this.maxBufferedSamples&&this.data.count++,this.data.count-1==0?(this.data.ms[this.data.count-1]=Date.now(),this.data.startms=this.data.ms[0]):(this.data.ms[this.data.count-1]=this.data.ms[this.data.count-2]+this.updateMs,this.data.count>=this.maxBufferedSamples&&(this.data.ms.splice(0,5120),this.data.ms.push(new Array(5120).fill(0)))),s=3;s<99;s+=3){var l="A"+(s-3)/3;this.data[l][this.data.count-1]=this.bytesToInt24(u[s],u[s+1],u[s+2]),this.data.count>=this.maxBufferedSamples&&(this.data[l].splice(0,5120),this.data[l].push(new Array(5120).fill(0)))}this.data.Ax[this.data.count-1]=this.bytesToInt16(u[99],u[100]),this.data.Ay[this.data.count-1]=this.bytesToInt16(u[101],u[102]),this.data.Az[this.data.count-1]=this.bytesToInt16(u[103],u[104]),this.data.count>=this.maxBufferedSamples&&(this.data.Ax.splice(0,5120),this.data.Ay.splice(0,5120),this.data.Az.splice(0,5120),this.data.Ax.push(new Array(5120).fill(0)),this.data.Ay.push(new Array(5120).fill(0)),this.data.Az.push(new Array(5120).fill(0)),this.data.count-=5120),o++}return o>0&&t.splice(0,a[a.length-1]),o}}},{key:"onDecodedCallback",value:function(t){}},{key:"onConnectedCallback",value:function(){console.log("port connected!")}},{key:"onDisconnectedCallback",value:function(){console.log("port disconnected!")}},{key:"onReceive",value:function(t){var e,n;(e=this.buffer).push.apply(e,function(t){if(Array.isArray(t))return O(t)}(n=t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return O(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var r=this.decode(this.buffer);!1===r||0===r||isNaN(r)||this.onDecodedCallback(r)}},{key:"onPortSelected",value:(s=I(regeneratorRuntime.mark((function t(e){var n,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:this.baudrate,t.prev=1,t.prev=2,t.next=5,e.open({baudRate:n,bufferSize:this.readBufferSize});case 5:this.onConnectedCallback(),this.connected=!0,this.subscribed=!0,this.subscribe(e),t.next=19;break;case 11:return t.prev=11,t.t0=t.catch(2),t.next=15,e.open({baudrate:n,buffersize:this.readBufferSize});case 15:this.onConnectedCallback(),this.connected=!0,this.subscribed=!0,this.subscribe(e);case 19:t.next=25;break;case 21:t.prev=21,t.t1=t.catch(1),console.log(t.t1),this.connected=!1;case 25:case"end":return t.stop()}}),t,this,[[1,21],[2,11]])}))),function(t){return s.apply(this,arguments)})},{key:"subscribe",value:(o=I(regeneratorRuntime.mark((function t(e){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.port.readable&&!0===this.subscribed&&(this.reader=e.readable.getReader(),(n=function(){var t=I(regeneratorRuntime.mark((function t(){var e,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.reader.read();case 3:if(e=t.sent,i=e.value,!e.done&&!1!==r.subscribed){t.next=9;break}return t.next=9,r.reader.releaseLock();case 9:if(i)try{r.onReceive(i)}catch(t){console.log(t)}!0===r.subscribed&&setTimeout((function(){n()}),r.readRate),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(0),console.log(t.t0),r.closePort();case 17:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(){return t.apply(this,arguments)}}())());case 1:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"subscribeSafe",value:(a=I(regeneratorRuntime.mark((function t(e){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:new Promise((function(t,r){for(;n.port.readable&&!0===n.subscribed;){n.reader=e.readable.getReader();for(var i=!0,a=new Promise((function(t,e){return n.reader.read()})),o=new Promise((function(t,e){setTimeout(t,100,"readfail")}));!0===i;)Promise.race([a,o]).then((function(t){if(console.log("newpromise"),"readfail"===t)console.log(t);else{var e=t.value;!0===t.done||!0===n.subscribed?new Promise((function(t,e){t(n.reader.releaseLock())})).then((function(){i=!1})):n.onReceive(e)}}))}t("not readable")}));case 1:case"end":return t.stop()}}),t)}))),function(t){return a.apply(this,arguments)})},{key:"closePort",value:(i=I(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=r.length>0&&void 0!==r[0]?r[0]:this.port,this.port&&(this.subscribed=!1,setTimeout(I(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.reader){t.next=4;break}return t.next=3,n.reader.releaseLock();case 3:n.reader=null;case 4:return t.next=6,e.close();case 6:n.port=null,n.connected=!1,n.onDisconnectedCallback();case 9:case"end":return t.stop()}}),t)}))),100));case 2:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"setupSerialAsync",value:(r=I(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:this.baudrate,t.next=4,navigator.serial.requestPort();case 4:this.port=t.sent,navigator.serial.addEventListener("disconnect",(function(t){n.closePort(n.port)})),this.onPortSelected(this.port,e);case 7:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"asUint8Array",value:function(t){if(t instanceof Uint8Array)return t;if("string"==typeof t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r>127)throw new TypeError("Only ASCII patterns are supported");e[n]=r}return e}return new Uint8Array(t)}},{key:"boyerMoore",value:function(t){var e=this,n=this.asUint8Array(t),r=n.length;if(0===r)throw new TypeError("patternBuffer must be at least 1 byte long");for(var i=new Int32Array(256),a=0;a<256;a++)i[a]=-1;for(var o=0;o<r;o++)i[n[o]]=o;var s=function(t,r,a){var o=e.asUint8Array(t);void 0===r&&(r=0),void 0===a&&(a=o.length);for(var s,c=n,u=i,l=a-c.length,h=c.length-1,f=r;f<=l;f+=s){s=0;for(var d=h;d>=0;d--){var p=o[f+d];if(c[d]!==p){s=Math.max(1,d-u[p]);break}}if(0===s)return f}return-1};return s.byteLength=n.byteLength,s}}])&&E(e.prototype,n),t}();function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function A(t,e,n){return e&&P(t.prototype,e),n&&P(t,n),t}var D=function(){function t(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/Math.sqrt(2),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;T(this,t);var o=["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"];if(o.indexOf(e)<0)return console.error("Valid types: 'lowpass','highpass','bandpass','notch','peak','lowshelf','highshelf'"),!1;this.type=e,this.freq=n,this.sps=r,this.Q=i,this.dbGain=a,this.a0=0,this.a1=0,this.a2=0,this.b0=0,this.b1=0,this.b2=0,this.x1=0,this.x2=0,this.y1=0,this.y2=0;var s=Math.pow(10,a/40),c=2*Math.PI*n/r,u=Math.sin(c),l=Math.cos(c),h=u/(2*i),f=Math.sqrt(s+s);this[e](s,u,l,h,f),this.b0/=this.a0,this.b1/=this.a0,this.b2/=this.a0,this.a1/=this.a0,this.a2/=this.a0}return A(t,[{key:"lowpass",value:function(t,e,n,r,i){this.b0=.5*(1-n),this.b1=1-n,this.b2=.5*(1-n),this.a0=1+r,this.a1=-2*n,this.a2=1-r}},{key:"highpass",value:function(t,e,n,r,i){this.b0=.5*(1+n),this.b1=-(1+n),this.b2=.5*(1+n),this.a0=1+r,this.a1=-2*n,this.a2=1-r}},{key:"bandpass",value:function(t,e,n,r,i){this.b0=r,this.b1=0,this.b2=-r,this.a0=1+r,this.a1=-2*n,this.a2=1-r}},{key:"notch",value:function(t,e,n,r,i){this.b0=1,this.b1=-2*n,this.b2=1,this.a0=1+r,this.a1=-2*n,this.a2=1-r}},{key:"peak",value:function(t,e,n,r,i){this.b0=1+r*t,this.b1=-2*n,this.b2=1-r*t,this.a0=1+r/t,this.a1=-2*n,this.a2=1-r/t}},{key:"lowshelf",value:function(t,e,n,r,i){this.b0=t*(t+1-(t-1)*n+i*e),this.b1=2*t*(t-1-(t+1)*n),this.b2=t*(t+1-(t-1)*n-i*e),this.a0=t+1+(t+1)*n+i*e,this.a1=2*(t-1+(t+1)*n),this.a2=t+1+(t-1)*n-i*e}},{key:"highshelf",value:function(t,e,n,r,i){this.b0=t*(t+1+(t-1)*n+i*e),this.b1=2*t*(t-1+(t+1)*n),this.b2=t*(t+1-(t-1)*n-i*e),this.a0=t+1-(t+1)*n-i*e,this.a1=2*(t-1-(t+1)*n),this.a2=t+1-(t-1)*n-i*e}},{key:"applyFilter",value:function(t){var e=this.b0*t+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;return this.x2=this.x1,this.x1=t,this.y2=this.y1,this.y1=e,e}},{key:"zResult",value:function(t){try{var e=Math.pow(Math.sin(Math.PI*t*2/(2*this.sps)),2);return(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*e+16*this.b0*this.b2*e*e)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*e+16*this.a2*e*e)}catch(t){return-200}}}],[{key:"calcCenterFrequency",value:function(t,e){return(t+e)/2}},{key:"calcBandwidth",value:function(t,e){return e-this.calcCenterFrequency(t,e)}},{key:"calcBandpassQ",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.pow(10,Math.floor(Math.log10(t))),r=n*Math.sqrt((t-e)*(t+e))/(2*e);return r}},{key:"calcNotchQ",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.pow(10,Math.floor(Math.log10(t))),r=n*t*e/Math.sqrt((t-e)*(t+e));return r}}]),t}(),N=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.995;T(this,t),this.r=e,this.y1=this.y2=this.x1=this.x2=0}return A(t,[{key:"applyFilter",value:function(t){this.x2=this.x1,this.x1=t;var e=this.x1-this.x2+this.r*this.y1;return this.y2=this.y1,this.y1=e,e}}]),t}(),F=function(t,e,n){return new D("notch",t,e,D.calcNotchQ(t,n),0)},R=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.pow(10,Math.floor(Math.log10(D.calcCenterFrequency(t,e))));return new D("bandpass",D.calcCenterFrequency(t,e),n,D.calcBandpassQ(D.calcCenterFrequency(t,e),D.calcBandwidth(t,e),r),0)},j=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"A0",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;T(this,t),this.channel=e,this.idx=0,this.sps=n,this.filtering=r,this.bplower=3,this.bpupper=45,this.scalingFactor=i,this.useSMA4=!1,this.last4=[],this.useNotch50=!0,this.useNotch60=!0,this.useLp1=!1,this.useBp1=!1,this.useDCB=!0,this.useScaling=!1,this.notch50=[F(50,n,1),F(100,n,1)],this.notch60=[F(60,n,1),F(120,n,1)],this.lp1=[new D("lowpass",50,n),new D("lowpass",50,n),new D("lowpass",50,n),new D("lowpass",50,n)],this.bp1=[R(this.bplower,this.bpupper,n,9.75),R(this.bplower,this.bpupper,n,9.75),R(this.bplower,this.bpupper,n,9.75),R(this.bplower,this.bpupper,n,9.75)],this.dcb=new N(.995)}return A(t,[{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sps;this.notch50=F(50,t,1),this.notch60=F(60,t,1),this.lp1=[new D("lowpass",50,t),new D("lowpass",50,t),new D("lowpass",50,t),new D("lowpass",50,t)],this.bp1=[R(this.bplower,this.bpupper,t,9.75),R(this.bplower,this.bpupper,t,9.75),R(this.bplower,this.bpupper,t,9.75),R(this.bplower,this.bpupper,t,9.75)],this.dcb=new N(.995)}},{key:"setBandpass",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.bplower,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.bpupper,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.sps;this.bplower=t,this.bpupper=e,this.bp1=[R(t,e,n),R(t,e,n),R(t,e,n),R(t,e,n)]}},{key:"apply",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastidx+1,n=t;return!0===this.filtering&&(!0===this.useDCB&&(n=this.dcb.applyFilter(n)),!0===this.useSMA4&&(e<4||(n=this.last4.reduce((function(t,e){return t+e}))/this.last4.length,this.last4.shift()),this.last4.push(n)),!0===this.useNotch50&&this.notch50.forEach((function(t,e){n=t.applyFilter(n)})),!0===this.useNotch60&&this.notch60.forEach((function(t,e){n=t.applyFilter(n)})),!0===this.useLp1&&this.lp1.forEach((function(t,e){n=t.applyFilter(n)})),!0===this.useBp1&&(this.bp1.forEach((function(t,e){n=t.applyFilter(n)})),n*=this.bp1.length),!0===this.useScaling&&(n*=this.scalingFactor)),this.lastidx=e,n}}]),t}();function M(t){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var G=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.templateStringGen,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(t){},c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NEVER";L(this,t),this.onchange=function(){arguments.length>0&&void 0!==arguments[0]||e.renderSettings.props},this.onRender=function(){arguments.length>0&&void 0!==arguments[0]||e.renderSettings.props},this.onRender=a,this.onchange=s,this.parentNode=r,"string"==typeof r&&(this.parentNode=document.getElementById(r)),this.renderSettings={templateStringGen:n,props:i},this.templateString="",this.templateString="function"==typeof n?n(i):n;var u=c;if(this.renderSettings.props==={}&&(u="NEVER"),this.node=null,this.listener=new o,Object.keys(this.renderSettings.props).length>0&&null!=u&&"NEVER"!==u){console.log("making listeners for ",n);var l=function(){e.updateNode()};this.listener.addListener("templateChange",this.renderSettings,"templateStringGen",l,u);var h=function(){e.updateNode(),e.onchange()};this.listener.addListener("props",this.renderSettings,"props",h,u)}this.renderNode()}var e,n;return e=t,(n=[{key:"appendFragment",value:function(t,e){var n=document.createElement("template");n.innerHTML=t;var r=n.content;return e.appendChild(r),e.children[e.children.length-1]}},{key:"deleteFragment",value:function(t,e){var n=document.getElementById(e);t.removeChild(n)}},{key:"removeParent",value:function(t){var e=document.getElementById(t);e.parentNode.parentNode.removeChild(e.parentNode)}},{key:"renderNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parentNode;this.node=this.appendFragment(this.templateString,t),this.onRender()}},{key:"updateNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parentNode,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.node,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.props;t.removeChild(e),"function"==typeof this.renderSettings.templateStringGen?this.templateString=this.renderSettings.templateStringGen(this.props):this.templateString=this.renderSettings.templateStringGen,this.renderNode(t,n)}},{key:"deleteNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.node;"string"==typeof t?(thisNode=document.getElementById(t),thisNode.parentNode.removeChild(thisNode),this.node=null):"object"===M(t)&&(t.parentNode.removeChild(t),this.node=null)}},{key:"appendStylesheet",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.node;if("string"==typeof t){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=t,e.insertAdjacentElement("afterbegin",n)}else if(Array.isArray(t))t.forEach((function(t){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=t,e.insertAdjacentElement("afterbegin",n)}));else if("function"==typeof t){var r=t();e.insertAdjacentHTML("afterbegin",r)}}}])&&z(e.prototype,n),t}();function U(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function V(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){U(a,r,i,o,s,"next",t)}function s(t){U(a,r,i,o,s,"throw",t)}o(void 0)}))}}function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Z(t){return function(t){if(Array.isArray(t))return H(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return H(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function W(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Y=function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"freeeeg32_2",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;W(this,t),this.init=function(t,n){if(t.sps=512,t.deviceType="eeg","freeeeg32_2"===e.mode?t.eegChannelTags=[{ch:4,tag:"FP2",analyze:!0},{ch:24,tag:"FP1",analyze:!0},{ch:8,tag:"other",analyze:!1}]:"freeeeg32_19"===e.mode?t.eegChannelTags=[{ch:4,tag:"FP2",analyze:!0},{ch:24,tag:"FP1",analyze:!0},{ch:0,tag:"O2",analyze:!0},{ch:1,tag:"T6",analyze:!0},{ch:2,tag:"T4",analyze:!0},{ch:3,tag:"F8",analyze:!0},{ch:5,tag:"F4",analyze:!0},{ch:6,tag:"C4",analyze:!0},{ch:7,tag:"P4",analyze:!0},{ch:25,tag:"F3",analyze:!0},{ch:26,tag:"C3",analyze:!0},{ch:27,tag:"P3",analyze:!0},{ch:28,tag:"O1",analyze:!0},{ch:29,tag:"T5",analyze:!0},{ch:30,tag:"T3",analyze:!0},{ch:31,tag:"F7",analyze:!0},{ch:16,tag:"FZ",analyze:!0},{ch:12,tag:"PZ",analyze:!0},{ch:8,tag:"other",analyze:!1}]:t.eegChannelTags=[{ch:4,tag:"FP2",analyze:!0},{ch:24,tag:"FP1",analyze:!0},{ch:8,tag:"other",analyze:!1}],e.device=new _((function(n){e.atlas.data.eegshared.eegChannelTags.forEach((function(r,i){var a,o,s,c,u=e.device.getLatestData("A"+r.ch,n),l=new Array(u.length).fill(0);if("other"!==r.tag&&!0===t.useFilters)e.filters.forEach((function(t,e){t.channel===r.ch&&u.forEach((function(e,n){l[n]=t.apply(e)}))})),!0===t.useAtlas&&((c=null!==r.tag?e.atlas.getEEGDataByTag(r.tag):e.atlas.getEEGDataByChannel(r.ch)).count+=n,(a=c.times).push.apply(a,Z(e.device.data.ms.slice(e.device.data.count-n,e.device.data.count))),(o=c.filtered).push.apply(o,Z(l)),(s=c.raw).push.apply(s,Z(u)));else if(!0===t.useAtlas){var h,f,d=e.atlas.getEEGDataByChannel(r.ch);d.count+=n,(h=d.times).push.apply(h,Z(e.device.data.ms.slice(e.device.data.count-n,e.device.data.count))),(f=d.raw).push.apply(f,Z(u))}}))}),(function(){!0===t.useAtlas&&(e.atlas.data.eegshared.startTime=Date.now(),!0!==e.atlas.settings.analyzing&&t.analysis.length>0&&(e.atlas.settings.analyzing=!0,e.atlas.settings.deviceConnected=!0,setTimeout((function(){e.atlas.analyzer()}),1200)),e.onconnect())}),(function(){e.atlas.settings.analyzing=!1,e.ondisconnect()})),!0===t.useFilters&&t.eegChannelTags.forEach((function(n,r){"other"!==n.tag?e.filters.push(new j(n.ch,t.sps,!0,e.device.uVperStep)):e.filters.push(new j(n.ch,t.sps,!1,e.device.uVperStep)),e.filters[e.filters.length-1].useScaling=!0})),!0===n)e.atlas=new C(location+":"+e.mode,{eegshared:{eegChannelTags:t.eegChannelTags,sps:t.sps}},"10_20",!0,!0,t.analysis),t.useAtlas=!0;else if("object"===q(n)){var r;e.atlas=n,e.atlas.data.eegshared.eegChannelTags=t.eegChannelTags,e.atlas.data.eegshared.sps=t.sps,e.atlas.data.eegshared.frequencies=e.atlas.bandpassWindow(0,128,.5*t.sps),e.atlas.data.eegshared.bandFreqs=e.atlas.getBandFreqs(e.atlas.data.eegshared.frequencies),e.atlas.data.eeg=e.atlas.gen10_20Atlas(),e.atlas.data.coherence=e.atlas.genCoherenceMap(t.eegChannelTags),e.atlas.data.eegshared.eegChannelTags.forEach((function(t,n){void 0===e.atlas.getEEGDataByTag(t.tag)&&e.atlas.addEEGCoord(t.ch)})),e.atlas.settings.coherence=!0,e.atlas.settings.eeg=!0,t.useAtlas=!0,t.analysis.length>0&&((r=e.atlas.settings.analysis).push.apply(r,Z(t.analysis)),e.atlas.settings.analyzing||(e.atlas.settings.analyzing=!0,e.atlas.analyzer()))}},this.connect=V(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.device.setupSerialAsync();case 2:e.setIndicator(!0);case 3:case"end":return t.stop()}}),t)}))),this.disconnect=function(){e.device.closePort(),e.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){arguments.length>0&&void 0!==arguments[0]||document.body,Math.floor(1e4*Math.random())},this.atlas=null,this.mode=n,this.device=null,this.filters=[],this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.border="1px solid white")}},Q=n(2306);function K(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function J(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){K(a,r,i,o,s,"next",t)}function s(t){K(a,r,i,o,s,"throw",t)}o(void 0)}))}}function $(t){return function(t){if(Array.isArray(t))return X(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function tt(t){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function et(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var nt=function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;et(this,t),this.init=function(t,e){if(t.sps=256,t.deviceType="eeg",t.eegChannelTags=[{ch:0,tag:"TP9",analyze:!0},{ch:1,tag:"AF7",analyze:!0},{ch:2,tag:"AF8",analyze:!0},{ch:3,tag:"TP10",analyze:!0}],n.device=new Q.MuseClient,!0===t.useFilters&&t.eegChannelTags.forEach((function(e,r){"other"!==e.tag?n.filters.push(new j(e.ch,t.sps,!0,1)):n.filters.push(new j(e.ch,t.sps,!1,1))})),!0===e)n.atlas=new C(location+":"+n.mode,{eegshared:{eegChannelTags:t.eegChannelTags,sps:t.sps}},"muse",!0,!0,t.analysis),t.useAtlas=!0;else if("object"===tt(e)){var r;n.atlas=e,n.atlas.data.eegshared.eegChannelTags=t.eegChannelTags,n.atlas.data.eegshared.sps=t.sps,n.atlas.data.eegshared.frequencies=n.atlas.bandpassWindow(0,128,.5*t.sps),n.atlas.data.eegshared.bandFreqs=n.atlas.getBandFreqs(n.atlas.data.eegshared.frequencies),n.atlas.data.eeg=n.atlas.genMuseAtlas(),n.atlas.data.coherence=n.atlas.genCoherenceMap(t.eegChannelTags),n.atlas.settings.coherence=!0,n.atlas.settings.eeg=!0,t.useAtlas=!0,t.analysis.length>0&&((r=n.atlas.settings.analysis).push.apply(r,$(t.analysis)),n.atlas.settings.analyzing||(n.atlas.settings.analyzing=!0,n.atlas.analyzer()))}n.info=t},this.connect=J(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.device.connect();case 2:return t.next=4,n.device.start();case 4:n.device.eegReadings.subscribe((function(t){if(n.info.useAtlas){var e,r,i=Array(t.samples.length).fill(t.timestamp);i=i.map((function(t,e){return t-(1-n.info.sps/i.length*e/10)}));var a=n.atlas.getEEGDataByChannel(t.electrode);if((e=a.times).push.apply(e,$(i)),(r=a.raw).push.apply(r,$(t.samples)),a.count+=t.samples.length,!0===n.info.useFilters){var o,s=new Array(t.samples.length).fill(0);void 0!==n.filters[t.electrode]&&t.samples.forEach((function(e,r){s[r]=n.filters[t.electrode].apply(e)})),(o=a.filtered).push.apply(o,$(s))}}})),n.atlas.data.eegshared.startTime=Date.now(),n.atlas.settings.deviceConnected=!0,!0!==n.atlas.settings.analyzing&&n.info.analysis.length>0&&(n.atlas.settings.analyzing=!0,setTimeout((function(){n.atlas.analyzer()}),1200)),n.device.gatt.device.addEventListener("gattserverdisconnected",(function(){n.atlas.analyzing=!1,n.atlas.settings.deviceConnected=!1,n.ondisconnect()})),n.onconnect(),n.setIndicator(!0);case 11:case"end":return t.stop()}}),t)}))),this.disconnect=function(){n.device.disconnect(),n.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,e=(Math.floor(1e4*Math.random()),function(){return"\n            "}),r=function(){};n.ui=new G(e,t,void 0,r)},this.atlas=null,this.mode=e,this.device=null,this.filters=[],this.info,this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="1px solid white")}};function rt(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function it(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){rt(a,r,i,o,s,"next",t)}function s(t){rt(a,r,i,o,s,"throw",t)}o(void 0)}))}}function at(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ot(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function st(t,e,n){return e&&ot(t.prototype,e),n&&ot(t,n),t}var ct=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"usb",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"http://192.168.4.1/";at(this,t),this.interface=null,this.mode=e,"usb"===e||"serial"===e?this.setupSerialDevice(n,r,i):"ble"===e||"bt"===e?this.setupBLEDevice(n,r,i):"wifi"!==e&&"events"!==e&&"sse"!==e||this.setupSSEDevice(a,n,r,i)}return st(t,[{key:"setupSerialDevice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.interface=new ft,this.interface.onConnectedCallback=e,this.interface.onReadLine=t,this.interface.onDisconnectedCallback=n}},{key:"setupBLEDevice",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.interface=new ut,this.interface.onConnectedCallback=n,this.interface.onDisconnectedCallback=r,this.interface.onNotificationCallback=function(n){var r=t.interface.decoder.decode(n.target.value);e(r)}}},{key:"setupSSEDevice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http://192.168.4.1/",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=function(t){e(t.data)};this.interface=new ht(t+"events",n,r,void 0,[{tag:"heg",callback:i}]),this.interface.newPostFunction("sendCommand",t+"command")}},{key:"sendCommand",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";"usb"===this.mode||"serial"===this.mode||"ble"===this.mode||"bt"===this.mode?this.interface.sendMessage(t):"wifi"!==this.mode&&"events"!==this.mode&&"sse"!==this.mode||this.interface.sendCommand(t)}},{key:"connect",value:function(t){"usb"===this.mode||"serial"===this.mode?navigator.serial?this.interface.setupSerialAsync():chrome.serial?this.interface.connectSelected(!0,t):(console.error("ERROR: Cannot locate navigator.serial. Enable #experimental-web-platform-features in chrome://flags"),alert("Serial support not found. Enable #experimental-web-platform-features in chrome://flags or use a chrome extension")):"ble"===this.mode||"bt"===this.mode?this.interface.connect():"wifi"!==this.mode&&"events"!==this.mode&&"sse"!==this.mode||this.interface.open()}},{key:"disconnect",value:function(){"usb"===this.mode||"serial"===this.mode?navigator.serial?this.interface.closePort():this.interface.connectSelected(!1):"ble"===this.mode||"bt"===this.mode?this.interface.disconnect():"wifi"!==this.mode&&"events"!==this.mode&&"sse"!==this.mode||this.interface.close()}}]),t}(),ut=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"6e400002-b5a3-f393-e0a9-e50e24dcca9e",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"6e400003-b5a3-f393-e0a9-e50e24dcca9e",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"main_body",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"blebutton",s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];at(this,t),lt.call(this),this.serviceUUID=e,this.rxUUID=n,this.txUUID=r,this.encoder=new TextEncoder("utf-8"),this.decoder=new TextDecoder("utf-8"),this.device=null,this.server=null,this.service=null,this.rxchar=null,this.txchar=null,this.parentId=a,this.buttonId=o,this.async=s,this.android=navigator.userAgent.toLowerCase().indexOf("android")>-1,this.n,!0===i&&this.initUI(a,o)}var e,n,r;return st(t,[{key:"initUI",value:function(t,e){var n=this;null!==this.device&&this.device.gatt.connected&&(this.device.gatt.disconnect(),console.log("device disconnected"));var r='<button id="'+e+'">BLE Connect</button>';HEGwebAPI.appendFragment(r,t),document.getElementById(e).onclick=function(){!1===n.async?n.connect():n.initBLEasync()}}},{key:"connectAsync",value:(r=it(regeneratorRuntime.mark((function t(){var e,n,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.bluetooth.requestDevice({filters:[{namePrefix:"HEG"}],optionalServices:[this.serviceUUID]});case 2:return this.device=t.sent,console.log("BLE Device: ",this.device),t.next=6,null===(e=this.device.gatt)||void 0===e?void 0:e.connect();case 6:if(n=t.sent){t.next=9;break}throw"no connection";case 9:return this.device.addEventListener("gattserverdisconnected",onDisconnected),this.server=n,t.next=13,this.server.getPrimaryService(this.serviceUUID);case 13:return r=t.sent,t.next=16,r.getCharacteristic(this.rxUUID);case 16:return i=t.sent,t.next=19,i.writeValue(this.encoder.encode("t"));case 19:if(1!=this.android){t.next=22;break}return t.next=22,i.writeValue(this.encoder.encode("o"));case 22:return t.next=24,r.getCharacteristic(this.txUUID);case 24:return this.characteristic=t.sent,this.onConnectedCallback(),t.abrupt("return",!0);case 27:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"readDeviceAsync",value:(n=it(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.characteristic){t.next=3;break}throw console.log("HEG not connected"),"error";case 3:this.doReadHeg=!0,e="";case 5:if(!this.doReadHeg){t.next=14;break}return t.t0=this.decoder,t.next=9,this.characteristic.readValue();case 9:t.t1=t.sent,(n=t.t0.decode.call(t.t0,t.t1))!==this.data&&(e=n,console.log(e),this.n+=1,this.onReadAsyncCallback(e)),t.next=5;break;case 14:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"initBLEasync",value:(e=it(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.connectAsync();case 2:this.readDeviceasync(),this.spsinterval();case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),t}(),lt=function(){var t=this;this.connect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.serviceUUID,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.rxUUID,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.txUUID;function i(t){return function(e){return new Promise((function(n){return setTimeout((function(){return n(e)}),t)}))}}navigator.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:[e]}).then((function(e){return t.device=e,e.gatt.connect()})).then(i(100)).then((function(t){return t.getPrimaryService(e)})).then(i(100)).then((function(e){return t.service=e,e.getCharacteristic(n).then(i(100)).then((function(e){return t.rxchar=e,e.writeValue(t.encoder.encode("t"))})),1==t.android&&e.getCharacteristic(n).then(i(1e3)).then((function(e){return e.writeValue(t.encoder.encode("o"))})),e.getCharacteristic(r)})).then(i(1100)).then((function(e){return t.txchar=e,e.startNotifications()})).then(i(100)).then((function(e){e.addEventListener("characteristicvaluechanged",t.onNotificationCallback)})).then(i(100)).then(t.onConnectedCallback()).catch((function(e){console.error(e),t.onErrorCallback(e)}))},this.onNotificationCallback=function(e){var n=t.decoder.decode(e.target.value);console.log("BLE MSG: ",n)},this.onConnectedCallback=function(){},this.sendMessage=function(e){t.rxchar.writeValue(t.encoder.encode(e))},this.disconnect=function(){var e;null===(e=t.server)||void 0===e||e.disconnect(),t.onDisconnectedCallback()},this.onDisconnectedCallback=function(){console.log("BLE device disconnected!")},this.onReadAsyncCallback=function(t){console.log("BLE Data: ",t)},this.stopReadAsync=function(){t.doReadHeg=!1,tx.writeValue(t.encoder.encode("f"))},this.spsinterval=function(){setTimeout((function(){console.log("SPS",t.n+""),t.n=0,t.spsinterval()}),1e3)}},ht=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http://192.168.4.1/events",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onOpen,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onError,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.onMsg,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];at(this,t),this.onOpen=function(t){console.log("Events Connected!",t.data)},this.onError=function(t){console.log("event source error:",t.data),t.target.readyState!==EventSource.OPEN&&console.log("Events Disconnected")},this.onMsg=function(t){console.log("event source:",t.data)},this.open=function(){e.createEventListeners()},this.close=function(){e.removeEventListeners()},this.hostUrl=n,this.onOpen=r,this.onError=i,this.onMsg=a,this.source=null,this.customCallbacks=o,this.createEventListeners(n,custom)}return st(t,[{key:"createEventListeners",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.hostUrl,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.customCallbacks,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.source;null!==n&&this.removeEventListeners(e,n),window.EventSource&&((n=new EventSource(t)).addEventListener("open",this.onOpen,!1),n.addEventListener("error",this.onError,!1),n.addEventListener("message",this.onMsg,!1),e.length>0&&e.forEach((function(t,e){n.addEventListener(t.tag,t.callback,!1)})))}},{key:"removeEventListeners",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.custom,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.source;window.EventSource&&(e.close(),e.removeEventListener("open",this.openEvent,!1),e.removeEventListener("error",this.errorEvent,!1),e.removeEventListener("message",this.messageEvent,!1),t.length>0&&t.forEach((function(t,n){e.removeEventListener(t.tag,t.callback,!1)})),e=null)}},{key:"newPostFunction",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"post",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.hostUrl,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,a=function(){var t=new XMLHttpRequest;t.open("POST",e,!0,r,i),t.send(n),t.onerror=function(){t.abort()}};return this[t]=a,a}}]),t}(),ft=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"serialmenu";at(this,t),this.onGetDevices=function(t){document.getElementById("serialports").innerHTML="";for(var n=[],r=0;r<t.length;r++)console.log(t[r].path);t.forEach((function(t){var r=t.displayName+"("+t.path+")";if(console.log("displayName "+r),r||(r=t.path),n.push({option:r,value:t.path}),console.log(e.defaultUI),1==e.defaultUI){var i=document.createElement("option");i.text=r,i.value=t.path,console.log("option",i),document.getElementById("serialports").appendChild(i)}})),e.displayPorts=n},this.onReceive=function(t){if(t.connectionId===e.connectionId){var n,r=new Uint8Array(t.data),i=String.fromCharCode.apply(null,r);for(e.encodedBuffer+=decodeURIComponent(escape(i)),console.log(e.encodedBuffer.length);(n=e.encodedBuffer.indexOf("\n"))>=0;){var a=e.encodedBuffer.substr(0,n+1);1==e.recordData&&e.recorded.push(a),(e.monitoring=!0)&&(e.newSamples++,e.monitorData.push(a)),e.onReadLine(a),e.encodedBuffer=e.encodedBuffer.substr(n+1)}}else console.log("ERR: Receive ID:",t.connectionId)},this.onConnectComplete=function(t){e.connectionId=t.connectionId,console.log("Connected! ID:",e.connectionId),chrome.serial.onReceive.addListener(e.onReceive),chrome.serial.onReceiveError.addListener(e.onReceiveError),e.onConnectedCallback()},this.displayPorts=[],this.defaultUI=n,this.encodedBuffer="",this.connectionId=-1,this.recordData=!1,this.recorded=[],this.port=null,this.decoder=null,this.subscribed=!1,this.reader=null,this.writer=null,this.monitoring=!1,this.newSamples=0,this.monitorSamples=1e4,this.monitorData=[],this.monitorIdx=0,chrome.serial?(!0===n&&this.setupSelect(r,!1),this.setupSerial()):navigator.serial?(this.decoder=new TextDecoder,!0===n&&this.setupSelect(r,!0)):(console.log("ERROR: Cannot locate navigator.serial. Enable #experimental-web-platform-features in chrome://flags"),alert("Serial support not found. Enable #experimental-web-platform-features in chrome://flags or use a chrome extension"))}var e,n,r,i,a;return st(t,[{key:"setupSelect",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(chrome.serial){var r=document.createElement("select");r.setAttribute("id","serialports"),(i=document.createDocumentFragment()).appendChild(r),document.getElementById(t).innerHTML='<button id="refreshSerial">Get</button><button id="connectSerial">Set</button>',document.getElementById(t).appendChild(i),document.getElementById("connectSerial").onclick=function(){n?e.setupSerialAsync():(-1!==e.connectionId&&e.connectSelected(!1),e.connectSelected(!0,document.getElementById("serialports").value))}}else if(navigator.serial){var i=document.createDocumentFragment();document.getElementById(t).innerHTML='<button id="refreshSerial">Set USB Device</button>',document.getElementById(t).appendChild(i)}document.getElementById("refreshSerial").onclick=function(){n?e.setupSerialAsync():e.setupSerial()}}},{key:"onReceiveError",value:function(t){console.log("onReceiveError"),t.connectionId===this.connectionId&&(console.log("Error from ID:",t.connectionId),this.onError.dispatch(t.error),console.log("Error: "+t.error))}},{key:"onConnectedCallback",value:function(){console.log("USB device Ready!")}},{key:"onDisconnectedCallback",value:function(){console.log("USB device disconnected!")}},{key:"sendMessage",value:function(t){t+="\n";for(var e=unescape(encodeURIComponent(t)),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);chrome.serial?this.connectionId>-1?(chrome.serial.send(this.connectionId,n.buffer,this.onSendCallback),console.log("Send message:",t)):console.log("Device is disconnected!"):navigator.serial&&this.port.writable&&this.sendMessageAsync(n.buffer)}},{key:"onSendCallback",value:function(t){console.log("sendInfo",t)}},{key:"onReadLine",value:function(t){console.log(t)}},{key:"connectSelected",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(1==t&&""!==e)console.log("Connecting",e),chrome.serial.connect(e,{bitrate:115200},this.onConnectComplete);else{if(console.log("Disconnect"+e),this.connectionId<0)return void console.log("connectionId",this.connectionId);this.encodedBuffer="",chrome.serial.onReceive.removeListener(this.onReceive),chrome.serial.onReceiveError.removeListener(this.onReceiveError),chrome.serial.flush(this.connectionId,(function(){console.log("chrome.serial.flush",this.connectionId)})),chrome.serial.disconnect(this.connectionId,(function(){console.log("chrome.serial.disconnect",this.connectionId)}))}}},{key:"setupSerial",value:function(){chrome.serial.getDevices(this.onGetDevices)}},{key:"sendMessageAsync",value:(a=it(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.port.writable.getWriter(),t.next=3,n.write(e);case 3:n.releaseLock();case 4:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"onPortSelected",value:(i=it(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.open({baudRate:115200,bufferSize:1e3});case 3:t.next=9;break;case 5:return t.prev=5,t.t0=t.catch(0),t.next=9,e.open({baudrate:115200,buffersize:1e3});case 9:this.onConnectedCallback(),this.subscribed=!0,this.subscribe(e);case 12:case"end":return t.stop()}}),t,this,[[0,5]])}))),function(t){return i.apply(this,arguments)})},{key:"onReceiveAsync",value:function(t){var e;for(this.encodedBuffer+=this.decoder.decode(t);(e=this.encodedBuffer.indexOf("\n"))>=0;){var n=this.encodedBuffer.substr(0,e+1);1==this.recordData&&this.recorded.push(n),(this.monitoring=!0)&&(this.newSamples++,this.monitorData.push(n)),this.onReadLine(n),this.encodedBuffer=this.encodedBuffer.substr(e+1)}}},{key:"subscribe",value:(r=it(regeneratorRuntime.mark((function t(e){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.port.readable&&!0===this.subscribed&&(this.reader=e.readable.getReader(),(n=function(){var t=it(regeneratorRuntime.mark((function t(){var i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.reader.read();case 3:if(i=t.sent,a=i.value,!i.done&&!1!==r.subscribed){t.next=9;break}return t.next=9,r.reader.releaseLock();case 9:if(a)try{r.onReceiveAsync(a),!0===r.subscribed&&setTimeout((function(){n()}),30)}catch(t){console.log(t)}t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.log(t.t0),t.t0.message.includes("framing")||t.t0.message.includes("overflow")||t.t0.message.includes("Overflow")||t.t0.message.includes("break")?(r.subscribed=!1,setTimeout(it(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.reader){t.next=4;break}return t.next=3,r.reader.releaseLock();case 3:r.reader=null;case 4:r.subscribed=!0,r.subscribe(e);case 6:case"end":return t.stop()}}),t)}))),30)):t.t0.message.includes("parity")||t.t0.message.includes("Parity")?(r.closePort(),setTimeout((function(){r.onPortSelected(r.port)}),100)):r.closePort();case 16:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(){return t.apply(this,arguments)}}())());case 1:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"closePort",value:(n=it(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=r.length>0&&void 0!==r[0]?r[0]:this.port,this.port&&(this.subscribed=!1,setTimeout(it(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.reader){t.next=4;break}return t.next=3,n.reader.releaseLock();case 3:n.reader=null;case 4:return t.next=6,e.close();case 6:n.connected=!1,n.onDisconnectedCallback();case 8:case"end":return t.stop()}}),t)}))),50));case 2:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"setupSerialAsync",value:(e=it(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,navigator.serial.requestPort();case 3:this.port=t.sent,navigator.serial.addEventListener("disconnect",(function(t){e.closePort()})),this.onPortSelected(this.port);case 6:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"saveCsv",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.recorded,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).toISOString(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"|",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Header\n",i=r;t.forEach((function(t){i+=t.split(n).join(",")+"\n"}));var a=document.createElement("a");a.href="data:text/csv;charset=utf-8,"+encodeURI(i),a.target="_blank",a.download=""!==e?e+".csv":(new Date).toISOString()+".csv",a.click()}},{key:"openFile",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:",",n=document.createElement("input");n.type="file",n.onchange=function(r){t.csvDat=[];var i=r.target.files[0],a=new FileReader;a.readAsText(i),a.onload=function(n){var r=n.target.result.split("\n");r.pop(),r.forEach((function(n,r){if(0==r)var i=n.split(e);else i=n.split(e),t.csvDat.push(i)})),t.onOpen()},n.value=""},n.click()}},{key:"onOpen",value:function(){alert("CSV Opened!")}}]),t}();function dt(t){return function(t){if(Array.isArray(t))return pt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return pt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function vt(t){return(vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var yt=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hegduinousb",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;mt(this,t),this.init=function(t,n){t.sps=32,t.deviceType="heg";var r=function(n){if(n.indexOf("|")>-1){var r=n.split("|");if(r.length>3){var i=e.atlas.data.heg[t.deviceNum];i.count++,1===i.count&&(i.startTime=Date.now()),"ble"===e.device.mode&&!0===e.device.interface.android?(i.times.push(Date.now()),i.red.push(parseFloat(r[0])),i.ir.push(parseFloat(r[1])),i.ratio.push(parseFloat(r[2]))):(i.times.push(Date.now()),i.red.push(parseFloat(r[1])),i.ir.push(parseFloat(r[2])),i.ratio.push(parseFloat(r[3])),i.ambient.push(parseFloat(r[4]))),e.atlas.beatDetection(i,t.sps)}}else console.log("HEGDUINO: ",n)};if("hegduinowifi"===e.mode||"hegduinosse"===e.mode?(t.sps=20,e.device=new ct("wifi",r,(function(){!0!==e.atlas.settings.analyzing&&t.analysis.length>0&&(e.atlas.settings.analyzing=!0,setTimeout((function(){e.atlas.analyzer()}),1200)),e.atlas.settings.deviceConnected=!0,e.onconnect()}),(function(){e.atlas.settings.analyzing=!1,e.atlas.settings.deviceConnected=!1,e.ondisconnect()}))):"hegduinobt"===e.mode||"hegduinoble"===e.mode?e.device=new ct("ble",r,(function(){!0!==e.atlas.settings.analyzing&&t.analysis.length>0&&(e.atlas.settings.analyzing=!0,setTimeout((function(){e.atlas.analyzer()}),1200)),e.atlas.settings.deviceConnected=!0,e.onconnect()}),(function(){e.atlas.settings.analyzing=!1,e.atlas.settings.deviceConnected=!1,e.ondisconnect()})):"hegduinoserial"!==e.mode&&"hegduinousb"!==e.mode||(e.device=new ct("usb",r,(function(){!0!==e.atlas.settings.analyzing&&t.analysis.length>0&&(e.atlas.settings.analyzing=!0,setTimeout((function(){e.atlas.analyzer()}),1200)),e.atlas.settings.deviceConnected=!0,e.onconnect()}),(function(){e.atlas.settings.analyzing=!1,e.atlas.settings.deviceConnected=!1,e.ondisconnect()}))),!0===n)e.atlas=new C(location+":"+e.mode,{hegshared:{sps:t.sps}},"hegduino",!1,!0,t.analysis),t.deviceNum=e.atlas.data.heg.length-1,t.useAtlas=!0;else if("object"===vt(n)){var i;e.atlas=n,t.deviceNum=e.atlas.data.heg.length,e.atlas.data.hegshared={sps:t.sps},e.atlas.addHEGCoord(e.atlas.data.heg.length),e.atlas.settings.heg=!0,t.useAtlas=!0,t.analysis.length>0&&((i=e.atlas.settings.analysis).push.apply(i,dt(t.analysis)),e.atlas.settings.analyzing||(e.atlas.settings.analyzing=!0,e.atlas.analyzer()))}},this.connect=function(){e.device.connect(),e.setIndicator(!0)},this.disconnect=function(){e.device.disconnect(),e.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,n=Math.floor(1e4*Math.random()),r=function(){return"\n            <div id='"+n+"hegduinoControls'>\n                <button id='"+n+"hegon'>On</button>\n                <button id='"+n+"hegoff'>Off</button>\n                <input id='"+n+"hegcmd' type='text' placeholder='R'></input><button id='"+n+"sendcmd'>Send</button>\n            </div>\n            "},i=function(){document.getElementById(n+"hegon").onclick=function(){e.device.sendCommand("t")},document.getElementById(n+"hegoff").onclick=function(){e.device.sendCommand("f")},document.getElementById(n+"sendcmd").onclick=function(){e.device.sendCommand(elm(n+"hegcmd").value)}};e.ui=new G(r,t,void 0,i)},this.atlas=null,this.mode=n,this.device=null,this.filters=[],this.ui=null,this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.border="1px solid white")}}var e,n;return e=t,(n=[{key:"mean",value:function(t){return t.reduce((function(t,e){return e+t}))/t.length}}])&&gt(e.prototype,n),t}();function bt(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function wt(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){bt(a,r,i,o,s,"next",t)}function s(t){bt(a,r,i,o,s,"throw",t)}o(void 0)}))}}function Ct(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function St(t){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function It(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ot(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var kt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.onDecodedCallback,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onConnectedCallback,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onDisconnectedCallback,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"daisy",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.decode,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:115200;It(this,t),this.onDecodedCallback=e,this.onConnectedCallback=n,this.onDisconnectedCallback=r,this.decode=a,this.connected=!1,this.subscribed=!1,this.buffer=[],this.startByte=160,this.stopByte=192,this.searchString=new Uint8Array([this.stopByte,this.startByte]),this.readRate=16.666667,this.readBufferSize=2e3,this.sps=250,this.nChannels=16,this.nPeripheralChannels=6,this.updateMs=1e3/this.sps,this.stepSize=1/(Math.pow(2,23)-1),this.vref=4.5,this.gain=24,this.vscale=this.vref/this.gain*this.stepSize,this.uVperStep=this.vref/this.gain*this.stepSize*1e6,this.scalar=1/(1e6/(this.vref/this.gain*this.stepSize)),this.maxBufferedSamples=60*this.sps*1,this.mode=i,this.data={count:0,startms:0,ms:[],A0:[],A1:[],A2:[],A3:[],A4:[],A5:[],A6:[],A7:[],A8:[],A9:[],A10:[],A11:[],A12:[],A13:[],A14:[],A15:[],Ax:[],Ay:[],Az:[],Gx:[],Gy:[],Gz:[]},this.resetDataBuffers(),navigator.serial||console.error("`navigator.serial not found! Enable #enable-experimental-web-platform-features in chrome://flags (search 'experimental')"),this.port=null,this.reader=null,this.baudrate=o}var e,n,r,i,a,o,s,c;return e=t,(n=[{key:"resetDataBuffers",value:function(){for(var t in this.data.count=0,this.data.startms=0,this.data)"object"===St(this.data[t])&&(this.data[t]=new Array(this.maxBufferedSamples).fill(0))}},{key:"setScalar",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/(Math.pow(2,23)-1),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4.5;this.stepSize=e,this.vref=n,this.gain=t,this.vscale=this.vref/this.gain*this.stepSize,this.uVperStep=this.vref/this.gain*this.stepSize*1e6,this.scalar=1/(1e6/(this.vref/this.gain*this.stepSize))}},{key:"getLatestData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"A0",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e;return n<=1?[this.data[t][this.data.count-1]]:(n>this.data.count&&(n=this.data.count),this.data[t].slice(this.data.count-n,this.data.count))}},{key:"bytesToInt16",value:function(t,e){var n=(255&t)<<8|255&e;return(8388608&n)>0?n|=4294901760:n&=65535,n}},{key:"int16ToBytes",value:function(t){return[255&t,t>>8&255]}},{key:"bytesToInt24",value:function(t,e,n){var r=(255&t)<<16|(255&e)<<8|255&n;return(8388608&r)>0?r|=4278190080:r&=16777215,r}},{key:"int24ToBytes",value:function(t){return[255&t,t>>8&255,t>>16&255]}},{key:"decode",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.buffer,e=this.searchString,n=t,r=this.boyerMoore(e),i=r.byteLength,a=[],o=0,s=r(n);-1!==s;s=r(n,s+i))a.push(s);if(a.length>=2){for(var c=1;c<a.length;c++)if(a[c]-a[c-1]==33){var u=t.slice(a[c-1],a[c]+1);for(this.data.count<this.maxBufferedSamples&&this.data.count++,this.data.count-1==0?(this.data.ms[this.data.count-1]=Date.now(),this.data.startms=this.data.ms[0]):(this.data.ms[this.data.count-1]=this.data.ms[this.data.count-2]+this.updateMs,this.data.count>=this.maxBufferedSamples&&(this.data.ms.splice(0,5120),this.data.ms.push(new Array(5120).fill(0)))),s=3;s<27;s+=3){var l=void 0;l="daisy"===this.mode?u[2]%2!=0?"A"+(s-3)/3:"A"+(8+(s-3)/3):"A"+(s-3)/3,this.data[l][this.data.count-1]=this.bytesToInt24(u[s],u[s+1],u[s+2]),this.data.count>=this.maxBufferedSamples&&(this.data[l].splice(0,5120),this.data[l].push(new Array(5120).fill(0)))}this.data.Ax[this.data.count-1]=this.bytesToInt16(u[27],u[28]),this.data.Ay[this.data.count-1]=this.bytesToInt16(u[29],u[30]),this.data.Az[this.data.count-1]=this.bytesToInt16(u[31],u[32]),this.data.count>=this.maxBufferedSamples&&(this.data.Ax.splice(0,5120),this.data.Ay.splice(0,5120),this.data.Az.splice(0,5120),this.data.Ax.push(new Array(5120).fill(0)),this.data.Ay.push(new Array(5120).fill(0)),this.data.Az.push(new Array(5120).fill(0)),this.data.count-=5120),o++}return o>0&&t.splice(0,a[a.length-1]),o}}},{key:"onDecodedCallback",value:function(t){}},{key:"onConnectedCallback",value:function(){console.log("port connected!")}},{key:"onDisconnectedCallback",value:function(){console.log("port disconnected!")}},{key:"onReceive",value:function(t){var e,n;(e=this.buffer).push.apply(e,function(t){if(Array.isArray(t))return Ct(t)}(n=t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return Ct(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ct(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var r=this.decode(this.buffer);!1===r||0===r||isNaN(r)||this.onDecodedCallback(r)}},{key:"sendMsg",value:(c=wt(regeneratorRuntime.mark((function t(e){var n,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=unescape(encodeURIComponent(e+="\n")),r=new Uint8Array(n.length),i=this.port.writable.getWriter(),t.next=6,i.write(r.buffer);case 6:return i.releaseLock(),t.abrupt("return",!0);case 8:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"onPortSelected",value:(s=wt(regeneratorRuntime.mark((function t(e){var n,r=this,i=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:this.baudrate,t.prev=1,t.prev=2,t.next=5,e.open({baudRate:n,bufferSize:this.readBufferSize});case 5:setTimeout((function(){r.onConnectedCallback(),r.connected=!0,r.subscribed=!0,r.sendMsg("b"),r.subscribe(e)}),500),t.next=13;break;case 8:return t.prev=8,t.t0=t.catch(2),t.next=12,e.open({baudrate:n,buffersize:this.readBufferSize});case 12:setTimeout((function(){r.onConnectedCallback(),r.connected=!0,r.subscribed=!0,r.sendMsg("b"),r.subscribe(e)}),500);case 13:t.next=19;break;case 15:t.prev=15,t.t1=t.catch(1),console.log(t.t1),this.connected=!1;case 19:case"end":return t.stop()}}),t,this,[[1,15],[2,8]])}))),function(t){return s.apply(this,arguments)})},{key:"subscribe",value:(o=wt(regeneratorRuntime.mark((function t(e){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.port.readable&&!0===this.subscribed&&(this.reader=e.readable.getReader(),(n=function(){var t=wt(regeneratorRuntime.mark((function t(){var e,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.reader.read();case 3:if(e=t.sent,i=e.value,!e.done&&!1!==r.subscribed){t.next=9;break}return t.next=9,r.reader.releaseLock();case 9:if(i)try{r.onReceive(i)}catch(t){console.log(t)}!0===r.subscribed&&setTimeout((function(){n()}),r.readRate),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(0),console.log(t.t0),r.closePort();case 17:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(){return t.apply(this,arguments)}}())());case 1:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"subscribeSafe",value:(a=wt(regeneratorRuntime.mark((function t(e){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:new Promise((function(t,r){for(;n.port.readable&&!0===n.subscribed;){n.reader=e.readable.getReader();for(var i=!0,a=new Promise((function(t,e){return n.reader.read()})),o=new Promise((function(t,e){setTimeout(t,100,"readfail")}));!0===i;)Promise.race([a,o]).then((function(t){if(console.log("newpromise"),"readfail"===t)console.log(t);else{var e=t.value;!0===t.done||!0===n.subscribed?new Promise((function(t,e){t(n.reader.releaseLock())})).then((function(){i=!1})):n.onReceive(e)}}))}t("not readable")}));case 1:case"end":return t.stop()}}),t)}))),function(t){return a.apply(this,arguments)})},{key:"closePort",value:(i=wt(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=r.length>0&&void 0!==r[0]?r[0]:this.port,this.port&&(this.subscribed=!1,this.sendMsg("s"),setTimeout(wt(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.reader&&(n.reader=null),t.next=3,e.close();case 3:n.port=null,n.connected=!1,n.onDisconnectedCallback();case 6:case"end":return t.stop()}}),t)}))),100));case 2:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"setupSerialAsync",value:(r=wt(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:this.baudrate,t.next=4,navigator.serial.requestPort();case 4:this.port=t.sent,navigator.serial.addEventListener("disconnect",(function(t){n.closePort(n.port)})),this.onPortSelected(this.port,e);case 7:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"asUint8Array",value:function(t){if(t instanceof Uint8Array)return t;if("string"==typeof t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r>127)throw new TypeError("Only ASCII patterns are supported");e[n]=r}return e}return new Uint8Array(t)}},{key:"boyerMoore",value:function(t){var e=this,n=this.asUint8Array(t),r=n.length;if(0===r)throw new TypeError("patternBuffer must be at least 1 byte long");for(var i=new Int32Array(256),a=0;a<256;a++)i[a]=-1;for(var o=0;o<r;o++)i[n[o]]=o;var s=function(t,r,a){var o=e.asUint8Array(t);void 0===r&&(r=0),void 0===a&&(a=o.length);for(var s,c=n,u=i,l=a-c.length,h=c.length-1,f=r;f<=l;f+=s){s=0;for(var d=h;d>=0;d--){var p=o[f+d];if(c[d]!==p){s=Math.max(1,d-u[p]);break}}if(0===s)return f}return-1};return s.byteLength=n.byteLength,s}}])&&Ot(e.prototype,n),t}();function xt(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function Bt(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){xt(a,r,i,o,s,"next",t)}function s(t){xt(a,r,i,o,s,"throw",t)}o(void 0)}))}}function Et(t){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _t(t){return function(t){if(Array.isArray(t))return Tt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Tt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var At,Dt=function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"cyton_daisy",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;Pt(this,t),this.init=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{sps:null,deviceType:null,eegChannelTags:null,analysis:["eegfft"],useAtlas:void 0},n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.sps=250,t.deviceType="eeg";var r=function(n){e.atlas.data.eegshared.eegChannelTags.forEach((function(r,i){var a,o,s,c,u=e.device.getLatestData("A"+r.ch,n),l=new Array(u.length).fill(0);if("other"!==r.tag&&!0===t.useFilters)e.filters.forEach((function(t,e){t.channel===r.ch&&u.forEach((function(e,n){l[n]=t.apply(e)}))})),!0===t.useAtlas&&((c=null!==r.tag?e.atlas.getEEGDataByTag(r.tag):e.atlas.getEEGDataByChannel(r.ch)).count+=n,(a=c.times).push.apply(a,_t(e.device.data.ms.slice(e.device.data.count-n,e.device.data.count))),(o=c.filtered).push.apply(o,_t(l)),(s=c.raw).push.apply(s,_t(u)));else if(!0===t.useAtlas){var h,f,d=e.atlas.getEEGDataByChannel(r.ch);d.count+=n,(h=d.times).push.apply(h,_t(e.device.data.ms.slice(e.device.data.count-n,e.device.data.count))),(f=d.raw).push.apply(f,_t(u))}}))},i=function(){!0===t.useAtlas&&(e.atlas.data.eegshared.startTime=Date.now(),!0!==e.atlas.settings.analyzing&&t.analysis.length>0&&(e.atlas.settings.analyzing=!0,setTimeout((function(){e.atlas.analyzer()}),1200))),e.atlas.settings.deviceConnected=!0,e.onconnect()},a=function(){e.atlas.settings.analyzing=!1,e.atlas.settings.deviceConnected=!1,e.ondisconnect()},o=[];if(e.mode.indexOf("daisy")>-1?(o=[{ch:0,tag:"FP1",analyze:!0},{ch:1,tag:"FP2",analyze:!0},{ch:2,tag:"C3",analyze:!0},{ch:3,tag:"C4",analyze:!0},{ch:4,tag:"P7",analyze:!0},{ch:5,tag:"P8",analyze:!0},{ch:6,tag:"O1",analyze:!0},{ch:7,tag:"O2",analyze:!0},{ch:8,tag:"F7",analyze:!0},{ch:9,tag:"F8",analyze:!0},{ch:10,tag:"F3",analyze:!0},{ch:11,tag:"F4",analyze:!0},{ch:12,tag:"T7",analyze:!0},{ch:13,tag:"T8",analyze:!0},{ch:14,tag:"P3",analyze:!0},{ch:15,tag:"P4",analyze:!0}],e.device=new kt(r,i,a,"daisy")):(o=[{ch:0,tag:"FP1",analyze:!0},{ch:1,tag:"FP2",analyze:!0},{ch:2,tag:"C3",analyze:!0},{ch:3,tag:"C4",analyze:!0},{ch:4,tag:"P7",analyze:!0},{ch:5,tag:"P8",analyze:!0},{ch:6,tag:"O1",analyze:!0},{ch:7,tag:"O2",analyze:!0}],e.device=new kt(r,i,a,"single")),!0===t.useFilters&&o.forEach((function(n,r){"other"!==n.tag?e.filters.push(new j(n.ch,t.sps,!0,e.device.uVperStep)):e.filters.push(new j(n.ch,t.sps,!1,e.device.uVperStep))})),t.eegChannelTags=o,!0===n){var s="10_20";e.atlas=new C(location+":"+e.mode,{eegshared:{eegChannelTags:t.eegChannelTags,sps:t.sps}},s,!0,!0,t.analysis),t.useAtlas=!0}else if("object"===Et(n)){var c;e.atlas=n,e.atlas.data.eegshared.eegChannelTags=t.eegChannelTags,e.atlas.data.eegshared.sps=t.sps,e.atlas.data.eegshared.frequencies=e.atlas.bandpassWindow(0,128,.5*t.sps),e.atlas.data.eegshared.bandFreqs=e.atlas.getBandFreqs(e.atlas.data.eegshared.frequencies),e.atlas.data.eeg=e.atlas.gen10_20Atlas(),e.atlas.data.coherence=e.atlas.genCoherenceMap(t.eegChannelTags),e.atlas.data.eegshared.eegChannelTags.forEach((function(t,n){void 0===e.atlas.getEEGDataByTag(t.tag)&&e.atlas.addEEGCoord(t.ch)})),e.atlas.settings.coherence=!0,e.atlas.settings.eeg=!0,t.useAtlas=!0,t.analysis.length>0&&((c=e.atlas.settings.analysis).push.apply(c,_t(t.analysis)),e.atlas.settings.analyzing||(e.atlas.settings.analyzing=!0,e.atlas.analyzer()))}},this.connect=Bt(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.device.setupSerialAsync();case 2:e.setIndicator(!0);case 3:case"end":return t.stop()}}),t)}))),this.disconnect=function(){e.device.closePort(),e.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,n=(Math.floor(1e4*Math.random()),function(){return"\n            "}),r=function(){};e.ui=new G(n,t,void 0,r)},this.atlas=null,this.mode=n,this.device=null,this.filters=[],this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(e.mode,"-indicator")).style.border="1px solid white")}};function Nt(t){return function(t){if(Array.isArray(t))return Ft(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Ft(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ft(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ft(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Rt(t){return(Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Mt=function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;jt(this,t),this.init=function(t,e){if(t.deviceType="eyetracker",!0===e)n.atlas=new C(location+":"+n.mode,void 0,"eyetracker",!0,!0,t.analysis),t.deviceNum=n.atlas.data.heg.length-1,t.useAtlas=!0,t.deviceNum=n.atlas.data.eyetracker.length-1;else if("object"===Rt(e)){var r;n.atlas=e,t.deviceNum=n.atlas.data.eyetracker.length,n.atlas.addEyeTracker(n.atlas.data.eyetracker.length),n.atlas.settings.eyetracker=!0,t.useAtlas=!0,t.analysis.length>0&&((r=n.atlas.settings.analysis).push.apply(r,Nt(t.analysis)),n.atlas.settings.analyzing||(n.atlas.settings.analyzing=!0,n.atlas.analyzer()))}n.info=t},this.connect=function(){At.setGazeListener((function(t,e){if(null!=t&&(t.x,t.y,!0===n.info.useAtlas)){var r=n.atlas.data.eyetracker[n.info.deviceNum];0===r.times.length&&(r.startTime=Date.now()),r.times.push(Date.now()),r.x.push(t.x),r.y.push(t.y),r.x.length>10?(r.smax.push(r.x.slice(r.x.length-10).reduce((function(t,e){return t+e}))/10),r.smay.push(r.y.slice(r.y.length-10).reduce((function(t,e){return t+e}))/10)):(r.smax.push(r.x.slice(0).reduce((function(t,e){return t+e}))/r.x.length),r.smay.push(r.y.slice(0).reduce((function(t,e){return t+e}))/r.y.length))}})).begin(),n.atlas.settings.deviceConnected=!0,n.onconnect(),n.setIndicator(!0)},this.disconnect=function(){At.end(),n.atlas.settings.deviceConnected=!1,n.ondisconnect(),n.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,e=(Math.floor(1e4*Math.random()),function(){return"\n            "}),r=function(){};n.ui=new G(e,t,void 0,r)},this.atlas=null,this.mode=e,this.device=null,this.filters=[],this.info,this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="1px solid white")}},Lt=n(8314),zt=n(9122),Gt=n(9890),Ut=n(2068),Vt=n(173),qt=n(8111),Zt=n(8120),Ht=n(904),Wt=n(9126);function Yt(t){return(Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Qt="normal",Kt="shorted",Jt="biasMethod",$t="mvdd",Xt="temp",te="testSig",ee="biasDrp",ne="biasDrn",re="1hour",ie="2hour",ae="4hour",oe="12hour",se="24hour",ce="5min",ue="15min",le="30min",he="14sec",fe="CH1SET",de="CH2SET",pe="CH3SET",ve="CH4SET",me="CH5SET",ge="CH6SET",ye="CH7SET",be="CH8SET",we="analog",Ce="default",Se="debug",Ie="digital",Oe="cyton",ke="cytonBLE",xe="daisy",Be="ganglion",Ee="none",_e="none",Te="good",Pe=1e6,Ae="Ganglion",De="\nLIS3DH Registers\n0x07.0\n0x08.0\n0x09.0\n0x0A.0\n0x0B.0\n0x0C.0\n0x0D.0\n0x0E.0\n0x0F.33\n\n0x1F.0\n0x20.8\n0x21.0\n0x22.0\n0x23.18\n0x24.0\n0x25.0\n0x26.0\n0x27.0\n0x28.0\n0x29.0\n0x2A.0\n0x2B.0\n0x2C.0\n0x2D.0\n0x2E.0\n0x2F.20\n0x30.0\n0x31.0\n0x32.0\n0x33.0\n\n0x38.0\n0x39.0\n0x3A.0\n0x3B.0\n0x3C.0\n0x3D.0\n",Ne="\nLIS3DH Registers\n0x07 00\n0x08 00\n0x09 00\n0x0A 00\n0x0B 00\n0x0C 00\n0x0D 00\n0x0E 00\n0x0F 33\n\n0x1F 00\n0x20 08\n0x21 00\n0x22 00\n0x23 18\n0x24 00\n0x25 00\n0x26 00\n0x27 00\n0x28 00\n0x29 00\n0x2A 00\n0x2B 00\n0x2C 00\n0x2D 00\n0x2E 00\n0x2F 20\n0x30 00\n0x31 00\n0x32 00\n0x33 00\n\n0x38 00\n0x39 00\n0x3A 00\n0x3B 00\n0x3C 00\n0x3D 00\n",Fe="\nBoard ADS Registers\nADS_ID, 00, 3E, 0, 0, 1, 1, 1, 1, 1, 0\nCONFIG1, 01, 96, 1, 0, 0, 1, 0, 1, 1, 0\nCONFIG2, 02, C0, 1, 1, 0, 0, 0, 0, 0, 0\nCONFIG3, 03, EC, 1, 1, 1, 0, 1, 1, 0, 0\nLOFF, 04, 02, 0, 0, 0, 0, 0, 0, 1, 0\nCH1SET, 05, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH2SET, 06, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH3SET, 07, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH4SET, 08, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH5SET, 09, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH6SET, 0A, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH7SET, 0B, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH8SET, 0C, 68, 0, 1, 1, 0, 1, 0, 0, 0\nBIAS_SENSP, 0D, FF, 1, 1, 1, 1, 1, 1, 1, 1\nBIAS_SENSN, 0E, FF, 1, 1, 1, 1, 1, 1, 1, 1\nLOFF_SENSP, 0F, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_SENSN, 10, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_FLIP, 11, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_STATP, 12, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_STATN, 13, 00, 0, 0, 0, 0, 0, 0, 0, 0\nGPIO, 14, 0F, 0, 0, 0, 0, 1, 1, 1, 1\nMISC1, 15, 00, 0, 0, 0, 0, 0, 0, 0, 0\nMISC2, 16, 00, 0, 0, 0, 0, 0, 0, 0, 0\nCONFIG4, 17, 00, 0, 0, 0, 0, 0, 0, 0, 0\n",Re="\nDaisy ADS Registers\nADS_ID, 00, 3E, 0, 0, 1, 1, 1, 1, 1, 0\nCONFIG1, 01, 96, 1, 0, 0, 1, 0, 1, 1, 0\nCONFIG2, 02, C0, 1, 1, 0, 0, 0, 0, 0, 0\nCONFIG3, 03, EC, 1, 1, 1, 0, 1, 1, 0, 0\nLOFF, 04, 02, 0, 0, 0, 0, 0, 0, 1, 0\nCH1SET, 05, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH2SET, 06, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH3SET, 07, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH4SET, 08, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH5SET, 09, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH6SET, 0A, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH7SET, 0B, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH8SET, 0C, 68, 0, 1, 1, 0, 1, 0, 0, 0\nBIAS_SENSP, 0D, FF, 1, 1, 1, 1, 1, 1, 1, 1\nBIAS_SENSN, 0E, FF, 1, 1, 1, 1, 1, 1, 1, 1\nLOFF_SENSP, 0F, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_SENSN, 10, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_FLIP, 11, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_STATP, 12, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_STATN, 13, 00, 0, 0, 0, 0, 0, 0, 0, 0\nGPIO, 14, 0F, 0, 0, 0, 0, 1, 1, 1, 1\nMISC1, 15, 00, 0, 0, 0, 0, 0, 0, 0, 0\nMISC2, 16, 00, 0, 0, 0, 0, 0, 0, 0, 0\nCONFIG4, 17, 00, 0, 0, 0, 0, 0, 0, 0, 0\n",je={OBCIChannelOff1:"1",OBCIChannelOff2:"2",OBCIChannelOff3:"3",OBCIChannelOff4:"4",OBCIChannelOff5:"5",OBCIChannelOff6:"6",OBCIChannelOff7:"7",OBCIChannelOff8:"8",OBCIChannelOff9:"q",OBCIChannelOff10:"w",OBCIChannelOff11:"e",OBCIChannelOff12:"r",OBCIChannelOff13:"t",OBCIChannelOff14:"y",OBCIChannelOff15:"u",OBCIChannelOff16:"i",commandChannelOff:function(t){return new Promise((function(e,n){switch(t){case 1:e("1");break;case 2:e("2");break;case 3:e("3");break;case 4:e("4");break;case 5:e("5");break;case 6:e("6");break;case 7:e("7");break;case 8:e("8");break;case 9:e("q");break;case 10:e("w");break;case 11:e("e");break;case 12:e("r");break;case 13:e("t");break;case 14:e("y");break;case 15:e("u");break;case 16:e("i");break;default:n(Error("Error [commandChannelOff]: Invalid Channel Number"))}}))},OBCIChannelOn1:"!",OBCIChannelOn2:"@",OBCIChannelOn3:"#",OBCIChannelOn4:"$",OBCIChannelOn5:"%",OBCIChannelOn6:"^",OBCIChannelOn7:"&",OBCIChannelOn8:"*",OBCIChannelOn9:"Q",OBCIChannelOn10:"W",OBCIChannelOn11:"E",OBCIChannelOn12:"R",OBCIChannelOn13:"T",OBCIChannelOn14:"Y",OBCIChannelOn15:"U",OBCIChannelOn16:"I",commandChannelOn:function(t){return new Promise((function(e,n){switch(t){case 1:e("!");break;case 2:e("@");break;case 3:e("#");break;case 4:e("$");break;case 5:e("%");break;case 6:e("^");break;case 7:e("&");break;case 8:e("*");break;case 9:e("Q");break;case 10:e("W");break;case 11:e("E");break;case 12:e("R");break;case 13:e("T");break;case 14:e("Y");break;case 15:e("U");break;case 16:e("I");break;default:n(Error("Error [commandChannelOn]: Invalid Channel Number"))}}))},OBCITestSignalConnectToDC:"p",OBCITestSignalConnectToGround:"0",OBCITestSignalConnectToPulse1xFast:"=",OBCITestSignalConnectToPulse1xSlow:"-",OBCITestSignalConnectToPulse2xFast:"]",OBCITestSignalConnectToPulse2xSlow:"[",getTestSignalCommand:function(t){return new Promise((function(e,n){switch(t){case"dc":e("p");break;case"ground":e("0");break;case"pulse1xFast":e("=");break;case"pulse1xSlow":e("-");break;case"pulse2xFast":e("]");break;case"pulse2xSlow":e("[");break;case"none":e("d");break;default:n(Error("Invalid selection! Check your spelling."))}}))},OBCIChannelCmdADCNormal:"0",OBCIChannelCmdADCShorted:"1",OBCIChannelCmdADCBiasDRP:"6",OBCIChannelCmdADCBiasDRN:"7",OBCIChannelCmdADCBiasMethod:"2",OBCIChannelCmdADCMVDD:"3",OBCIChannelCmdADCTemp:"4",OBCIChannelCmdADCTestSig:"5",OBCIChannelCmdBiasInclude:"1",OBCIChannelCmdBiasRemove:"0",OBCIChannelCmdChannel1:"1",OBCIChannelCmdChannel2:"2",OBCIChannelCmdChannel3:"3",OBCIChannelCmdChannel4:"4",OBCIChannelCmdChannel5:"5",OBCIChannelCmdChannel6:"6",OBCIChannelCmdChannel7:"7",OBCIChannelCmdChannel8:"8",OBCIChannelCmdChannel9:"Q",OBCIChannelCmdChannel10:"W",OBCIChannelCmdChannel11:"E",OBCIChannelCmdChannel12:"R",OBCIChannelCmdChannel13:"T",OBCIChannelCmdChannel14:"Y",OBCIChannelCmdChannel15:"U",OBCIChannelCmdChannel16:"I",commandChannelForCmd:Ve,OBCIChannelCmdGain1:"0",OBCIChannelCmdGain2:"1",OBCIChannelCmdGain4:"2",OBCIChannelCmdGain6:"3",OBCIChannelCmdGain8:"4",OBCIChannelCmdGain12:"5",OBCIChannelCmdGain24:"6",commandForGain:Ue,gainForCommand:function(t){switch(String(t)){case"0":return 1;case"1":return 2;case"2":return 4;case"3":return 6;case"4":return 8;case"5":return 12;case"6":return 24;default:throw new Error("Invalid gain setting of ".concat(t," gain must be (0,1,2,3,4,5,6)"))}},OBCIChannelCmdLatch:"X",OBCIChannelCmdPowerOff:"1",OBCIChannelCmdPowerOn:"0",OBCIChannelCmdSet:"x",OBCIChannelCmdSRB1Connect:"1",OBCIChannelCmdSRB1Diconnect:"0",OBCIChannelCmdSRB2Connect:"1",OBCIChannelCmdSRB2Diconnect:"0",channelSettingsObjectDefault:qe,channelSettingsArrayInit:function(t){for(var e=[],n=0;n<t;n++)e.push(qe(n));return e},OBCIStringADCNormal:Qt,OBCIStringADCShorted:Kt,OBCIStringADCBiasMethod:Jt,OBCIStringADCMvdd:$t,OBCIStringADCTemp:Xt,OBCIStringADCTestSig:te,OBCIStringADCBiasDrp:ee,OBCIStringADCBiasDrn:ne,commandForADCString:Ge,inputTypeForCommand:function(t){switch(String(t)){case"0":return Qt;case"1":return Kt;case"2":return Jt;case"3":return $t;case"4":return Xt;case"5":return te;case"6":return ee;case"7":return ne;default:throw new Error("Invalid input type, must be less than 8")}},OBCIChannelDefaultAllSet:"d",OBCIChannelDefaultAllGet:"D",OBCIChannelImpedanceLatch:"Z",OBCIChannelImpedanceSet:"z",OBCIChannelImpedanceTestSignalApplied:"1",OBCIChannelImpedanceTestSignalAppliedNot:"0",OBCISDLogForHour1:"G",OBCISDLogForHour2:"H",OBCISDLogForHour4:"J",OBCISDLogForHour12:"K",OBCISDLogForHour24:"L",OBCISDLogForMin5:"A",OBCISDLogForMin15:"S",OBCISDLogForMin30:"F",OBCISDLogForSec14:"a",OBCISDLogStop:"j",OBCIStringSDHour1:re,OBCIStringSDHour2:ie,OBCIStringSDHour4:ae,OBCIStringSDHour12:oe,OBCIStringSDHour24:se,OBCIStringSDMin5:ce,OBCIStringSDMin15:ue,OBCIStringSDMin30:le,OBCIStringSDSec14:he,sdSettingForString:function(t){return new Promise((function(e,n){switch(t){case re:e("G");break;case ie:e("H");break;case ae:e("J");break;case oe:e("K");break;case se:e("L");break;case ce:e("A");break;case ue:e("S");break;case le:e("F");break;case he:e("a");break;default:n(Error(TypeError))}}))},OBCIStreamStart:"b",OBCIStreamStop:"s",OBCIAccelStart:"n",OBCIAccelStop:"N",OBCIMiscQueryRegisterSettings:"?",OBCIMiscQueryRegisterSettingsChannel1:fe,OBCIMiscQueryRegisterSettingsChannel2:de,OBCIMiscQueryRegisterSettingsChannel3:pe,OBCIMiscQueryRegisterSettingsChannel4:ve,OBCIMiscQueryRegisterSettingsChannel5:me,OBCIMiscQueryRegisterSettingsChannel6:ge,OBCIMiscQueryRegisterSettingsChannel7:ye,OBCIMiscQueryRegisterSettingsChannel8:be,channelSettingsKeyForChannel:function(t){return new Promise((function(e,n){switch(t){case 1:e(new Buffer(fe));break;case 2:e(new Buffer(de));break;case 3:e(new Buffer(pe));break;case 4:e(new Buffer(ve));break;case 5:e(new Buffer(me));break;case 6:e(new Buffer(ge));break;case 7:e(new Buffer(ye));break;case 8:e(new Buffer(be));break;default:n(Error("Invalid channel number"))}}))},OBCIMiscSoftReset:"v",OBCIChannelMaxNumber8:"c",OBCIChannelMaxNumber16:"C",OBCIChannelMaxNumber8NoDaisyToRemove:"",OBCIChannelMaxNumber8SuccessDaisyRemoved:"daisy removed",OBCIChannelMaxNumber16DaisyAlreadyAttached:"16",OBCIChannelMaxNumber16DaisyAttached:"daisy attached16",OBCIChannelMaxNumber16NoDaisyAttached:"no daisy to attach!8",OBCIFilterDisable:"g",OBCIFilterEnable:"f",OBCITrigger:"`",OBCINumberOfChannelsCyton:8,OBCINumberOfChannelsCytonBLE:2,OBCINumberOfChannelsDaisy:16,OBCINumberOfChannelsDefault:8,OBCINumberOfChannelsGanglion:4,OBCIBoardCyton:Oe,OBCIBoardCytonBLE:ke,OBCIBoardDaisy:xe,OBCIBoardDefault:"default",OBCIBoardGanglion:Be,OBCIBoardNone:Ee,numberOfChannelsForBoardType:function(t){switch(t){case xe:return 16;case Be:return 4;case Ee:return 0;case ke:return 2;case Oe:default:return 8}},boardTypeForNumberOfChannels:function(t){switch(t){case 16:return xe;case 4:return Be;case 0:return Ee;case 2:return ke;case 8:default:return Oe}},OBCISampleRate1000:1e3,OBCISampleRate125:125,OBCISampleRate12800:12800,OBCISampleRate1600:1600,OBCISampleRate16000:16e3,OBCISampleRate200:200,OBCISampleRate2000:2e3,OBCISampleRate250:250,OBCISampleRate25600:25600,OBCISampleRate3200:3200,OBCISampleRate400:400,OBCISampleRate4000:4e3,OBCISampleRate500:500,OBCISampleRate6400:6400,OBCISampleRate800:800,OBCISampleRate8000:8e3,OBCISampleNumberMax:255,OBCIPacketSize:33,OBCIPacketSizeBLECyton:20,OBCIPacketSizeBLERaw:12,OBCIByteStart:160,OBCIByteStop:192,OBCIErrorInvalidByteLength:"Invalid Packet Byte Length",OBCIErrorInvalidByteStart:"Invalid Start Byte",OBCIErrorInvalidByteStop:"Invalid Stop Byte",OBCIErrorInvalidData:"Invalid data - try again",OBCIErrorInvalidType:"Invalid type - check comments for input type",OBCIErrorMissingRegisterSetting:"Missing register setting",OBCIErrorMissingRequiredProperty:"Missing property in JSON",OBCIErrorNobleAlreadyScanning:"Scan already under way",OBCIErrorNobleNotAlreadyScanning:"No scan started",OBCIErrorNobleNotInPoweredOnState:"Please turn blue tooth on.",OBCIErrorTimeSyncIsNull:"'this.sync.curSyncObj' must not be null",OBCIErrorTimeSyncNoComma:"Missed the time sync sent confirmation. Try sync again",OBCIErrorUndefinedOrNullInput:"Undefined or Null Input",OBCIMasterBufferSize:4096,OBCILeadOffDriveInAmps:6e-9,OBCILeadOffFrequencyHz:31.5,getChannelSetter:function(t,e,n,r,i,a,o){var s,c,u,l;return new Promise((function(h,f){Me(t)||f(Error("channelNumber must be of type 'number' ")),Le(e)||f(Error("powerDown must be of type 'boolean' ")),Me(n)||f(Error("gain must be of type 'number' ")),ze(r)||f(Error("inputType must be of type 'string' ")),Le(i)||f(Error("bias must be of type 'boolean' ")),Le(a)||f(Error("srb1 must be of type 'boolean' ")),Le(o)||f(Error("srb2 must be of type 'boolean' "));var d=Ve(t).catch((function(t){return f(t)}));s=e?"1":"0";var p=Ue(n).catch((function(t){return f(t)})),v=Ge(r).catch((function(t){return f(t)}));c=i?"1":"0",u=a?"1":"0",l=o?"1":"0";var m={channelNumber:t,powerDown:e,gain:n,inputType:r,bias:i,srb2:a,srb1:o};Promise.all([d,p,v]).then((function(t){var e=["x",t[0],s,t[1],t[2],c,u,l,"X"];h({commandArray:e,newChannelSettingsObject:m})}))}))},getImpedanceSetter:function(t,e,n){var r,i;return new Promise((function(a,o){Me(t)||o(Error("channelNumber must be of type 'number' ")),Le(e)||o(Error("pInputApplied must be of type 'boolean' ")),Le(n)||o(Error("nInputApplied must be of type 'boolean' ")),i=e?"1":"0",r=n?"1":"0",Ve(t).then((function(t){a(["z",t,i,r,"Z"])})).catch((function(t){return o(t)}))}))},getSampleRateSetter:function(t,e){return new Promise((function(n,r){if(!ze(t))return r(Error("board type must be of type 'string' "));if(!Me(e))return r(Error("sampleRate must be of type 'number' "));var i;if(e=Math.floor(e),t===Oe||t===xe)i=He;else{if(t!==Be)return r(Error("boardType must be either ".concat(Oe," or ").concat(Be)));i=We}i(e).then((function(t){n(["~",t])})).catch((function(t){return r(t)}))}))},getBoardModeSetter:function(t){return new Promise((function(e,n){if(!ze(t))return n(Error("board mode must be of type 'string' "));Ye(t).then((function(t){e(["/",t])})).catch((function(t){return n(t)}))}))},OBCIWriteIntervalDelayMSLong:50,OBCIWriteIntervalDelayMSNone:0,OBCIWriteIntervalDelayMSShort:10,OBCISyncTimeSent:",",OBCISyncTimeSet:"<",OBCIRadioKey:240,OBCIRadioCmdChannelGet:0,OBCIRadioCmdChannelSet:1,OBCIRadioCmdChannelSetOverride:2,OBCIRadioCmdPollTimeGet:3,OBCIRadioCmdPollTimeSet:4,OBCIRadioCmdBaudRateSetDefault:5,OBCIRadioCmdBaudRateSetFast:6,OBCIRadioCmdSystemStatus:7,OBCIImpedanceTextBad:"bad",OBCIImpedanceTextGood:Te,OBCIImpedanceTextInit:"init",OBCIImpedanceTextOk:"ok",OBCIImpedanceTextNone:_e,OBCIImpedanceThresholdBadMax:Pe,OBCIImpedanceSeriesResistor:2200,getTextForRawImpedance:function(t){return t>0&&t<5e3?Te:t>5001&&t<1e4?"ok":t>10001&&t<Pe?"bad":_e},OBCISimulatorPortName:"OpenBCISimulator",OBCIStreamPacketStandardAccel:0,OBCIStreamPacketStandardRawAux:1,OBCIStreamPacketUserDefinedType:2,OBCIStreamPacketAccelTimeSyncSet:3,OBCIStreamPacketAccelTimeSynced:4,OBCIStreamPacketRawAuxTimeSyncSet:5,OBCIStreamPacketRawAuxTimeSynced:6,OBCIStreamPacketImpedance:7,isNumber:Me,isBoolean:Le,isString:ze,isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},OBCIPacketPositionStartByte:0,OBCIPacketPositionStopByte:32,OBCIPacketPositionStartAux:26,OBCIPacketPositionStopAux:31,OBCIPacketPositionChannelDataStart:2,OBCIPacketPositionChannelDataStop:25,OBCIPacketPositionSampleNumber:1,OBCIPacketPositionTimeSyncAuxStart:26,OBCIPacketPositionTimeSyncAuxStop:28,OBCIPacketPositionTimeSyncTimeStart:28,OBCIPacketPositionTimeSyncTimeStop:32,OBCISimulatorLineNoiseHz60:"60Hz",OBCISimulatorLineNoiseHz50:"50Hz",OBCISimulatorLineNoiseNone:"none",OBCISimulatorFragmentationRandom:"random",OBCISimulatorFragmentationFullBuffers:"fullBuffers",OBCISimulatorFragmentationOneByOne:"oneByOne",OBCISimulatorFragmentationNone:"none",OBCIFirmwareV1:"v1",OBCIFirmwareV2:"v2",OBCIFirmwareV3:"v3",OBCIAccelAxisX:7,OBCIAccelAxisY:8,OBCIAccelAxisZ:9,OBCIStreamPacketTimeByteSize:4,OBCIParseDaisy:"Daisy",OBCIParseFailure:"Failure",OBCIParseFirmware:"v2",OBCIParseEOT:"$$$",OBCIParseSuccess:"Success",OBCIParsingChannelSettings:2,OBCIParsingEOT:4,OBCIParsingNormal:3,OBCIParsingReset:0,OBCIParsingTimeSyncSent:1,OBCITimeoutProcessBytes:500,OBCISimulatorRawAux:"rawAux",OBCISimulatorStandard:"standard",OBCIRadioChannelMax:25,OBCIRadioChannelMin:1,OBCIRadioPollTimeMax:255,OBCIRadioPollTimeMin:0,OBCITimeSyncArraySize:10,OBCITimeSyncMultiplierWithSyncConf:.9,OBCITimeSyncMultiplierWithoutSyncConf:.75,OBCITimeSyncThresholdTransFailureMS:10,OBCIBoardModeSet:"/",OBCIBoardModeCmdDefault:"0",OBCIBoardModeCmdDebug:"1",OBCIBoardModeCmdAnalog:"2",OBCIBoardModeCmdDigital:"3",OBCIBoardModeCmdGetCur:"/",OBCIBoardModeAnalog:we,OBCIBoardModeDefault:Ce,OBCIBoardModeDebug:Se,OBCIBoardModeDigital:Ie,OBCISampleRateSet:"~",OBCISampleRateCmdCyton16000:"0",OBCISampleRateCmdCyton8000:"1",OBCISampleRateCmdCyton4000:"2",OBCISampleRateCmdCyton2000:"3",OBCISampleRateCmdCyton1000:"4",OBCISampleRateCmdCyton500:"5",OBCISampleRateCmdCyton250:"6",OBCISampleRateCmdGang25600:"0",OBCISampleRateCmdGang12800:"1",OBCISampleRateCmdGang6400:"2",OBCISampleRateCmdGang3200:"3",OBCISampleRateCmdGang1600:"4",OBCISampleRateCmdGang800:"5",OBCISampleRateCmdGang400:"6",OBCISampleRateCmdGang200:"7",OBCISampleRateCmdGetCur:"~",OBCIWifiAttach:"{",OBCIWifiRemove:"}",OBCIWifiReset:";",OBCIWifiStatus:":",OBCIRadioBaudRateDefault:115200,OBCIRadioBaudRateDefaultStr:"default",OBCIRadioBaudRateFast:230400,OBCIRadioBaudRateFastStr:"fast",OBCIEmitterAccelerometer:"accelerometer",OBCIEmitterBlePoweredUp:"blePoweredOn",OBCIEmitterClose:"close",OBCIEmitterDroppedPacket:"droppedPacket",OBCIEmitterEot:"eot",OBCIEmitterError:"error",OBCIEmitterGanglionFound:"ganglionFound",OBCIEmitterHardSet:"hardSet",OBCIEmitterImpedance:"impedance",OBCIEmitterImpedanceArray:"impedanceArray",OBCIEmitterMessage:"message",OBCIEmitterQuery:"query",OBCIEmitterRawDataPacket:"rawDataPacket",OBCIEmitterReady:"ready",OBCIEmitterRFduino:"rfduino",OBCIEmitterSample:"sample",OBCIEmitterScanStopped:"scanStopped",OBCIEmitterSynced:"synced",OBCIEmitterWifiShield:"wifiShield",OBCIGanglionAccelAxisX:1,OBCIGanglionAccelAxisY:2,OBCIGanglionAccelAxisZ:3,OBCIGanglionBleSearchTime:2e4,OBCIGanglionByteIdUncompressed:0,OBCIGanglionByteId18Bit:{max:100,min:1},OBCIGanglionByteId19Bit:{max:200,min:101},OBCIGanglionByteIdImpedanceChannel1:201,OBCIGanglionByteIdImpedanceChannel2:202,OBCIGanglionByteIdImpedanceChannel3:203,OBCIGanglionByteIdImpedanceChannel4:204,OBCIGanglionByteIdImpedanceChannelReference:205,OBCIGanglionByteIdMultiPacket:206,OBCIGanglionByteIdMultiPacketStop:207,OBCIGanglionMCP3912Gain:51,OBCIGanglionMCP3912Vref:1.2,OBCIGanglionPacketSize:20,OBCIGanglionPacket18Bit:{auxByte:20,byteId:0,dataStart:1,dataStop:19},OBCIGanglionPacket19Bit:{byteId:0,dataStart:1,dataStop:20},OBCIGanglionPrefix:Ae,OBCIGanglionSamplesPerPacket:2,OBCIGanglionSyntheticDataEnable:"t",OBCIGanglionSyntheticDataDisable:"T",OBCIGanglionImpedanceStart:"z",OBCIGanglionImpedanceStop:"Z",OBCIGanglionScaleFactorPerCountVolts:1.8699498629276494e-9,SimbleeUuidService:"fe84",SimbleeUuidReceive:"2d30c082f39f4ce6923f3484ea480596",SimbleeUuidSend:"2d30c083f39f4ce6923f3484ea480596",SimbleeUuidDisconnect:"2d30c084f39f4ce6923f3484ea480596",RFduinoUuidService:"2220",RFduinoUuidReceive:"2221",RFduinoUuidSend:"2222",RFduinoUuidSendTwo:"2223",OBCICytonBLESamplesPerPacket:3,OBCIGanglionAccelScaleFactor:.016,OBCINobleEmitterPeripheralConnect:"connect",OBCINobleEmitterPeripheralDisconnect:"disconnect",OBCINobleEmitterPeripheralDiscover:"discover",OBCINobleEmitterPeripheralServicesDiscover:"servicesDiscover",OBCINobleEmitterServiceCharacteristicsDiscover:"characteristicsDiscover",OBCINobleEmitterServiceRead:"read",OBCINobleEmitterDiscover:"discover",OBCINobleEmitterScanStart:"scanStart",OBCINobleEmitterScanStop:"scanStop",OBCINobleEmitterStateChange:"stateChange",OBCINobleStatePoweredOn:"poweredOn",getPeripheralLocalNames:function(t){return new Promise((function(e,n){var r=[];return t.forEach((function(t){r.push(t.advertisement.localName)})),r.length>0?e(r):n(Error("No peripherals discovered with prefix equal to ".concat(Ae)))}))},getPeripheralWithLocalName:function(t,e){return new Promise((function(n,r){return"object"!==Yt(t)?r(Error("pArray must be of type Object")):(t.forEach((function(t){if(t.advertisement.hasOwnProperty("localName")&&t.advertisement.localName===e)return n(t)})),r(Error("No peripheral found with localName: ".concat(e))))}))},getVersionNumber:function(t){return Number(t[1])},isPeripheralGanglion:function(t){return!!(t&&t.hasOwnProperty("advertisement")&&null!==t.advertisement&&t.advertisement.hasOwnProperty("localName")&&void 0!==t.advertisement.localName&&null!==t.advertisement.localName&&t.advertisement.localName.indexOf(Ae)>-1)},commandSampleRateForCmdCyton:He,commandSampleRateForCmdGanglion:We,commandBoardModeForMode:Ye,rawDataToSampleObjectDefault:function(t){return void 0===t&&(t=8),{accelArray:[0,0,0],channelSettings:je.channelSettingsArrayInit(t),decompressedSamples:Ze(t),lastSampleNumber:0,rawDataPacket:Buffer.alloc(33),rawDataPackets:[],scale:!0,sendCounts:!1,timeOffset:0,verbose:!1}},OBCIProtocolBLE:"ble",OBCIProtocolSerial:"serial",OBCIProtocolWifi:"wifi",OBCIRegisterQueryAccelerometerFirmwareV1:De,OBCIRegisterQueryAccelerometerFirmwareV3:Ne,OBCIRegisterQueryCyton:Fe,OBCIRegisterQueryCytonDaisy:Re,OBCIRegisterQueryNameMISC1:"MISC1",OBCIRegisterQueryNameBIASSENSP:"BIAS_SENSP",OBCIRegisterQueryNameCHnSET:["CH1SET","CH2SET","CH3SET","CH4SET","CH5SET","CH6SET","CH7SET","CH8SET"],OBCIRegisterQuerySizeCytonFirmwareV1:Fe.length+De.length,OBCIRegisterQuerySizeCytonDaisyFirmwareV1:Fe.length+Re.length+De.length,OBCIRegisterQuerySizeCytonFirmwareV3:Fe.length+Ne.length,OBCIRegisterQuerySizeCytonDaisyFirmwareV3:Fe.length+Re.length+Ne.length};function Me(t){return"number"==typeof t}function Le(t){return"boolean"==typeof t}function ze(t){return"string"==typeof t}function Ge(t){return new Promise((function(e,n){switch(t){case Qt:e("0");break;case Kt:e("1");break;case Jt:e("2");break;case $t:e("3");break;case Xt:e("4");break;case te:e("5");break;case ee:e("6");break;case ne:e("7");break;default:n(Error("Invalid ADC string"))}}))}function Ue(t){return new Promise((function(e,n){switch(t){case 1:e("0");break;case 2:e("1");break;case 4:e("2");break;case 6:e("3");break;case 8:e("4");break;case 12:e("5");break;case 24:e("6");break;default:n(Error("Invalid gain setting of "+t+" gain must be (1,2,4,6,8,12,24)"))}}))}function Ve(t){return new Promise((function(e,n){switch(t){case 1:e("1");break;case 2:e("2");break;case 3:e("3");break;case 4:e("4");break;case 5:e("5");break;case 6:e("6");break;case 7:e("7");break;case 8:e("8");break;case 9:e("Q");break;case 10:e("W");break;case 11:e("E");break;case 12:e("R");break;case 13:e("T");break;case 14:e("Y");break;case 15:e("U");break;case 16:e("I");break;default:n(Error("Invalid channel number"))}}))}function qe(t){return{channelNumber:t,powerDown:!1,gain:24,inputType:Qt,bias:!0,srb2:!0,srb1:!1}}function Ze(t){for(var e=[],n=0;n<3;n++)e.push(new Array(t));return e}function He(t){return new Promise((function(e,n){switch(t){case 16e3:e("0");break;case 8e3:e("1");break;case 4e3:e("2");break;case 2e3:e("3");break;case 1e3:e("4");break;case 500:e("5");break;case 250:e("6");break;default:n(Error("Invalid sample rate"))}}))}function We(t){return new Promise((function(e,n){switch(t){case 25600:e("0");break;case 12800:e("1");break;case 6400:e("2");break;case 3200:e("3");break;case 1600:e("4");break;case 800:e("5");break;case 400:e("6");break;case 200:e("7");break;default:n(Error("Invalid sample rate"))}}))}function Ye(t){return new Promise((function(e,n){switch(t){case Ce:e("0");break;case Se:e("1");break;case we:e("2");break;case Ie:e("3");break;default:n(Error("Invalid sample rate"))}}))}const Qe=je;var Ke=n(1481),Je=n.n(Ke),$e=n(1301),Xe=n.n($e),tn=4.5,en=.002/Math.pow(2,4),nn={extractRawDataPackets:function(t){if(!t)return{buffer:t,rawDataPackets:[]};var e=t.length,n=[];if(e<Qe.OBCIPacketSize)return{buffer:t,rawDataPackets:n};for(var r=0;r<=e-Qe.OBCIPacketSize;){if(t[r]===Qe.OBCIByteStart&&jn(t[r+Qe.OBCIPacketSize-1])){var i;i=Uint8Array.from(t.slice(r,r+Qe.OBCIPacketSize)),n.push(i);var a;a=r>0?Uint8Array.concat([Uint8Array.from(t.slice(0,r)),Uint8Array.from(t.slice(r+Qe.OBCIPacketSize))]):Uint8Array.from(t.slice(Qe.OBCIPacketSize)),t=0===a.length?null:Uint8Array.from(a),r=-1,e-=Qe.OBCIPacketSize}r++}return{buffer:t,rawDataPackets:n}},extractRawBLEDataPackets:function(t){var e=[];if(Qe.isNull(t))return e;if(t.byteLength!==Qe.OBCIPacketSizeBLECyton)return e;var n=[0,0,0];n[0]=t[1],n[1]=n[0]+1,n[1]>255&&(n[1]-=256),n[2]=n[1]+1,n[2]>255&&(n[2]-=256);for(var r=0;r<Qe.OBCICytonBLESamplesPerPacket;r++){var i=nn.samplePacketZero(n[r]);i[0]=Qe.OBCIByteStart,i[Qe.OBCIPacketPositionStopByte]=t[0],t.copy(i,Qe.OBCIPacketPositionChannelDataStart,Qe.OBCIPacketPositionChannelDataStart+6*r,Qe.OBCIPacketPositionChannelDataStart+6+6*r),e.push(i)}return e},transformRawDataPacketToSample:pn,transformRawDataPacketsToSample:function(t){for(var e=[],n=0;n<t.rawDataPackets.length;n++){t.rawDataPacket=t.rawDataPackets[n];var r=pn(t);e.push(r),r.hasOwnProperty("sampleNumber")?t.lastSampleNumber=r.sampleNumber:r.hasOwnProperty("impedanceValue")||(t.lastSampleNumber=t.rawDataPacket[Qe.OBCIPacketPositionSampleNumber])}return e},convertGanglionArrayToBuffer:function(t,e){for(var n=0;n<Qe.OBCINumberOfChannelsGanglion;n++)e.writeInt16BE(t[n]>>8,3*n),e.writeInt8(255&t[n],3*n+2)},getRawPacketType:Bn,getFromTimePacketAccel:Cn,getFromTimePacketTime:wn,getFromTimePacketRawAux:Sn,ganglionFillRawDataPacket:function(t){if(Qe.isUndefined(t)||Qe.isUndefined(t.rawDataPacket)||Qe.isNull(t.rawDataPacket)||Qe.isUndefined(t.data)||Qe.isNull(t.data))throw new Error(Qe.OBCIErrorUndefinedOrNullInput);if(!t.hasOwnProperty("sampleNumber"))throw new Error(Qe.OBCIErrorUndefinedOrNullInput);if(t.rawDataPacket.byteLength!==Qe.OBCIPacketSize)throw new Error(Qe.OBCIErrorInvalidByteLength);if(t.data.byteLength!==Qe.OBCIPacketSizeBLERaw)throw new Error(Qe.OBCIErrorInvalidByteLength);t.data.copy(t.rawDataPacket,Qe.OBCIPacketPositionChannelDataStart),t.rawDataPacket[Qe.OBCIPacketPositionSampleNumber]=t.sampleNumber,t.rawDataPacket[Qe.OBCIPacketPositionStartByte]=Qe.OBCIByteStart,t.rawDataPacket[Qe.OBCIPacketPositionStopByte]=Qe.OBCIStreamPacketStandardRawAux},parsePacketStandardAccel:function(t){if(Qe.isUndefined(t)||Qe.isUndefined(t.rawDataPacket)||Qe.isNull(t.rawDataPacket))throw new Error(Qe.OBCIErrorUndefinedOrNullInput);if(t.rawDataPacket.byteLength!==Qe.OBCIPacketSize)throw new Error(Qe.OBCIErrorInvalidByteLength);if(t.rawDataPacket[0]!==Qe.OBCIByteStart)throw new Error(Qe.OBCIErrorInvalidByteStart);var e={};return(Qe.isUndefined(t.scale)||Qe.isNull(t.scale))&&(t.scale=!0),t.scale?e.accelData=In(t.rawDataPacket.slice(Qe.OBCIPacketPositionStartAux,Qe.OBCIPacketPositionStopAux+1)):e.accelDataCounts=On(t.rawDataPacket.slice(Qe.OBCIPacketPositionStartAux,Qe.OBCIPacketPositionStopAux+1)),t.scale?e.channelData=kn(t):e.channelDataCounts=xn(t),e.auxData=Uint8Array.from(t.rawDataPacket.slice(Qe.OBCIPacketPositionStartAux,Qe.OBCIPacketPositionStopAux+1)),e.sampleNumber=t.rawDataPacket[Qe.OBCIPacketPositionSampleNumber],e.startByte=t.rawDataPacket[0],e.stopByte=t.rawDataPacket[Qe.OBCIPacketPositionStopByte],e.valid=!0,e.timestamp=Date.now(),e.boardTime=0,e},parsePacketStandardRawAux:function(t){if(Qe.isUndefined(t)||Qe.isUndefined(t.rawDataPacket)||Qe.isNull(t.rawDataPacket))throw new Error(Qe.OBCIErrorUndefinedOrNullInput);if(t.rawDataPacket.byteLength!==Qe.OBCIPacketSize)throw new Error(Qe.OBCIErrorInvalidByteLength);if(t.rawDataPacket[0]!==Qe.OBCIByteStart)throw new Error(Qe.OBCIErrorInvalidByteStart);var e={};return(Qe.isUndefined(t.scale)||Qe.isNull(t.scale))&&(t.scale=!0),t.scale?e.channelData=kn(t):e.channelDataCounts=xn(t),e.auxData=Uint8Array.from(t.rawDataPacket.slice(Qe.OBCIPacketPositionStartAux,Qe.OBCIPacketPositionStopAux+1)),e.sampleNumber=t.rawDataPacket[Qe.OBCIPacketPositionSampleNumber],e.startByte=t.rawDataPacket[0],e.stopByte=t.rawDataPacket[Qe.OBCIPacketPositionStopByte],e.valid=!0,e.timestamp=Date.now(),e.boardTime=0,e},parsePacketTimeSyncedAccel:function(t){if(Qe.isUndefined(t)||Qe.isUndefined(t.rawDataPacket)||Qe.isNull(t.rawDataPacket))throw new Error(Qe.OBCIErrorUndefinedOrNullInput);if(t.rawDataPacket.byteLength!==Qe.OBCIPacketSize)throw new Error(Qe.OBCIErrorInvalidByteLength);if(t.rawDataPacket[0]!==Qe.OBCIByteStart)throw new Error(Qe.OBCIErrorInvalidByteStart);var e={};return e.sampleNumber=t.rawDataPacket[Qe.OBCIPacketPositionSampleNumber],e.startByte=t.rawDataPacket[0],e.stopByte=t.rawDataPacket[Qe.OBCIPacketPositionStopByte],e.boardTime=wn(t.rawDataPacket),t.hasOwnProperty("timeOffset")?e.timestamp=e.boardTime+t.timeOffset:e.timestamp=Date.now(),e.auxData=Sn(t.rawDataPacket),(Qe.isUndefined(t.scale)||Qe.isNull(t.scale))&&(t.scale=!0),t.scale?e.channelData=kn(t):e.channelDataCounts=xn(t),Cn(t)&&(t.scale?e.accelData=t.accelArray:e.accelDataCounts=t.accelArray),e.valid=!0,e},parsePacketTimeSyncedRawAux:function(t){if(Qe.isUndefined(t)||Qe.isUndefined(t.rawDataPacket)||Qe.isNull(t.rawDataPacket))throw new Error(Qe.OBCIErrorUndefinedOrNullInput);if(t.rawDataPacket.byteLength!==Qe.OBCIPacketSize)throw new Error(Qe.OBCIErrorInvalidByteLength);if(t.rawDataPacket[0]!==Qe.OBCIByteStart)throw new Error(Qe.OBCIErrorInvalidByteStart);var e={};return e.sampleNumber=t.rawDataPacket[Qe.OBCIPacketPositionSampleNumber],e.startByte=t.rawDataPacket[0],e.stopByte=t.rawDataPacket[Qe.OBCIPacketPositionStopByte],e.boardTime=wn(t.rawDataPacket),t.hasOwnProperty("timeOffset")?e.timestamp=e.boardTime+t.timeOffset:e.timestamp=Date.now(),e.auxData=Sn(t.rawDataPacket),(Qe.isUndefined(t.scale)||Qe.isNull(t.scale))&&(t.scale=!0),t.scale?e.channelData=kn(t):e.channelDataCounts=xn(t),e.valid=!0,e},parsePacketImpedance:function(t){if(Qe.isUndefined(t)||Qe.isUndefined(t.rawDataPacket)||Qe.isNull(t.rawDataPacket))throw new Error(Qe.OBCIErrorUndefinedOrNullInput);if(t.rawDataPacket.byteLength!==Qe.OBCIPacketSize)throw new Error(Qe.OBCIErrorInvalidByteLength);var e={};return e.channelNumber=t.rawDataPacket[1],5===e.channelNumber&&(e.channelNumber=0),e.impedanceValue=Number(t.rawDataPacket.toString().match(/\d+/)[0]),e},convertSampleToPacketStandard:function(t){var e=new Uint8Array(Qe.OBCIPacketSize);e.fill(0),e[0]=Qe.OBCIByteStart,e[1]=t.sampleNumber;for(var n=0;n<Qe.OBCINumberOfChannelsDefault;n++)Pn(t.channelData[n]).copy(e,2+3*n);for(var r=0;r<3;r++)An(t.auxData[r]).copy(e,Qe.OBCIPacketSize-1-6+2*r);return e[Qe.OBCIPacketSize-1]=Qe.OBCIByteStop,e},convertSampleToPacketRawAux:function(t,e){var n=new Uint8Array(Qe.OBCIPacketSize);n.fill(0),n[0]=Qe.OBCIByteStart,n[1]=t.sampleNumber;for(var r=0;r<Qe.OBCINumberOfChannelsDefault;r++)Pn(t.channelData[r]).copy(n,2+3*r);return e.copy(n,26),n[Qe.OBCIPacketSize-1]=Rn(Qe.OBCIStreamPacketStandardRawAux),n},convertSampleToPacketAccelTimeSyncSet:function(t,e){var n=Fn(t,e);return n[Qe.OBCIPacketPositionStopByte]=Rn(Qe.OBCIStreamPacketAccelTimeSyncSet),n},convertSampleToPacketAccelTimeSynced:Fn,convertSampleToPacketRawAuxTimeSyncSet:function(t,e,n){var r=Nn(t,e,n);return r[Qe.OBCIPacketPositionStopByte]=Rn(Qe.OBCIStreamPacketRawAuxTimeSyncSet),r},convertSampleToPacketRawAuxTimeSynced:Nn,debugPrettyPrint:function(t){if(null==t)console.log("== Sample is undefined ==");else{console.log("-- Sample --"),console.log("---- Start Byte: "+t.startByte),console.log("---- Sample Number: "+t.sampleNumber);for(var e=0;e<8;e++)console.log("---- Channel Data "+(e+1)+": "+t.channelData[e]);if(t.accelData)for(var n=0;n<3;n++)console.log("---- Accel Data "+n+": "+t.accelData[n]);t.auxData&&console.log("---- Aux Data "+t.auxData),console.log("---- Stop Byte: "+t.stopByte)}},samplePrintHeader:function(){return"All voltages in Volts!sampleNumber, channel1, channel2, channel3, channel4, channel5, channel6, channel7, channel8, aux1, aux2, aux3\n"},samplePrintLine:function(t){return new Promise((function(e,n){null==t&&n(Error("undefined sample")),e(t.sampleNumber+","+t.channelData[0].toFixed(8)+","+t.channelData[1].toFixed(8)+","+t.channelData[2].toFixed(8)+","+t.channelData[3].toFixed(8)+","+t.channelData[4].toFixed(8)+","+t.channelData[5].toFixed(8)+","+t.channelData[6].toFixed(8)+","+t.channelData[7].toFixed(8)+","+t.auxData[0].toFixed(8)+","+t.auxData[1].toFixed(8)+","+t.auxData[2].toFixed(8)+"\n")}))},floatTo3ByteBuffer:Pn,floatTo2ByteBuffer:An,impedanceCalculationForChannel:function(t,e){var n=Math.sqrt(2);return new Promise((function(r,i){null==t&&i(Error("Sample Object cannot be null or undefined")),void 0!==t.channelData&&null!==t.channelData||i(Error("Channel cannot be null or undefined")),(e<1||e>Qe.OBCINumberOfChannelsDefault)&&i(Error("Channel number invalid."));var a=e-1;t.channelData[a]<0&&(t.channelData[a]*=-1),r(n*t.channelData[a]/Qe.OBCILeadOffDriveInAmps)}))},impedanceCalculationForAllChannels:function(t){var e=Math.sqrt(2);return new Promise((function(n,r){null==t&&r(Error("Sample Object cannot be null or undefined")),void 0!==t.channelData&&null!==t.channelData||r(Error("Channel cannot be null or undefined"));for(var i=[],a=t.channelData.length,o=0;o<a;o++){t.channelData[o]<0&&(t.channelData[o]*=-1);var s=e*t.channelData[o]/Qe.OBCILeadOffDriveInAmps;i.push(s)}t.impedances=i,n(t)}))},interpret16bitAsInt32:function(t){var e=0;return t[0]>127&&(e=65535),e<<16|t[0]<<8|t[1]},interpret24bitAsInt32:function(t){var e=0;return t[0]>127&&(e=255),e<<24|t[0]<<16|t[1]<<8|t[2]},impedanceArray:function(t){for(var e=[],n=0;n<t;n++)e.push(dn(n+1));return e},impedanceObject:dn,impedanceSummarize:function(t){t.raw>Qe.OBCIImpedanceThresholdBadMax?t.text=Qe.OBCIImpedanceTextNone:t.text=Qe.getTextForRawImpedance(t.raw)},newSample:_n,newSampleNoScale:Tn,randomSample:function(t,e,n,r){var i=Je()(0,1),a=1e6,o=new Array(t+1);o.fill(0);var s=[0,0,0],c=0,u=Math.floor(e/25);u<1&&(u=1);var l=new Array(t).fill(0),h=new Array(t).fill(0),f=new Array(t).fill(0);return function(d){for(var p,v=_n(),m=0;m<t;m++){switch(p=i.ppf(Math.random())*Math.sqrt(e/2)/a,m){case 0:case 1:n&&(o[m]+=2*Math.PI*10/e,o[m]>2*Math.PI&&(o[m]-=2*Math.PI),p+=5*Math.SQRT2*Math.sin(o[m])/a);break;default:r===Qe.OBCISimulatorLineNoiseHz60?(o[m]+=2*Math.PI*60/e,o[m]>2*Math.PI&&(o[m]-=2*Math.PI),p+=8*Math.SQRT2*Math.sin(o[m])/a):r===Qe.OBCISimulatorLineNoiseHz50&&(o[m]+=2*Math.PI*50/e,o[m]>2*Math.PI&&(o[m]-=2*Math.PI),p+=8*Math.SQRT2*Math.sin(o[m])/a)}l[m]=.99765*l[m]+.099046*p,h[m]=.963*h[m]+.2965164*p,f[m]=.57*f[m]+1.0526913*p,v.channelData[m]=l[m]+h[m]+f[m]+.1848*p}if(v.sampleNumber=255===d?0:d+1,c===u){var g=[0,0,0];g[0]=.1*Math.random()*(Math.random()>.5?-1:1),g[1]=.1*Math.random()*(Math.random()>.5?-1:1),g[2]=1-.4*Math.random()*(Math.random()>.5?-1:1),v.auxData=g,c=0}else c++,v.auxData=s;return v}},scaleFactorAux:en,impedanceCalculateArray:function(t,e){if(e.buffer.push(t.channelData),e.count++,e.count>=e.window){for(var n=[],r=0;r<t.channelData.length;r++){for(var i=0,a=0;a<e.window;a++)e.buffer[r][a]>i&&(i=e.buffer[r][a]);for(var o=0,s=0;s<e.window;s++)e.buffer[r][s]<o&&(o=e.buffer[r][s]);var c=i-o;n.push(c/2/Qe.OBCILeadOffDriveInAmps)}return e.count=0,n}return null},impedanceTestObjDefault:function(t){var e=t||{};return e.active=!1,e.buffer=[],e.count=0,e.isTestingPInput=!1,e.isTestingNInput=!1,e.onChannel=0,e.sampleNumber=0,e.continuousMode=!1,e.impedanceForChannel=0,e.window=40,e},samplePacket:function(t){return new Uint8Array([160,En(t),0,0,1,0,0,2,0,0,3,0,0,4,0,0,5,0,0,6,0,0,7,0,0,8,0,0,0,1,0,2,Rn(Qe.OBCIStreamPacketStandardAccel)])},samplePacketZero:function(t){return new Uint8Array([160,En(t),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,Rn(Qe.OBCIStreamPacketStandardAccel)])},samplePacketReal:function(t){return new Uint8Array([160,En(t),143,242,64,143,223,244,144,43,182,143,191,191,127,255,255,127,255,255,148,37,52,32,182,125,0,224,0,224,15,112,Rn(Qe.OBCIStreamPacketStandardAccel)])},samplePacketStandardRawAux:function(t){return new Uint8Array([160,En(t),0,0,1,0,0,2,0,0,3,0,0,4,0,0,5,0,0,6,0,0,7,0,0,8,0,1,2,3,4,5,Rn(Qe.OBCIStreamPacketStandardRawAux)])},samplePacketAccelTimeSyncSet:function(t){return new Uint8Array([160,En(t),0,0,1,0,0,2,0,0,3,0,0,4,0,0,5,0,0,6,0,0,7,0,0,8,0,1,0,0,0,1,Rn(Qe.OBCIStreamPacketAccelTimeSyncSet)])},samplePacketAccelTimeSynced:function(t){return new Uint8Array([160,En(t),0,0,1,0,0,2,0,0,3,0,0,4,0,0,5,0,0,6,0,0,7,0,0,8,0,1,0,0,0,1,Rn(Qe.OBCIStreamPacketAccelTimeSynced)])},samplePacketRawAuxTimeSyncSet:function(t){return new Uint8Array([160,En(t),0,0,1,0,0,2,0,0,3,0,0,4,0,0,5,0,0,6,0,0,7,0,0,8,0,1,0,0,0,1,Rn(Qe.OBCIStreamPacketRawAuxTimeSyncSet)])},samplePacketRawAuxTimeSynced:function(t){return new Uint8Array([160,En(t),0,0,1,0,0,2,0,0,3,0,0,4,0,0,5,0,0,6,0,0,7,0,0,8,0,1,0,0,0,1,Rn(Qe.OBCIStreamPacketRawAuxTimeSynced)])},samplePacketImpedance:function(t){return new Uint8Array([160,t,54,52,49,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,Rn(Qe.OBCIStreamPacketImpedance)])},samplePacketUserDefined:function(){return new Uint8Array([160,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,Rn(Qe.OBCIStreamPacketUserDefinedType)])},samplePacketCytonBLE:function(t){return new Uint8Array([192,En(t),0,0,1,0,0,2,0,0,10,0,0,20,0,0,100,0,0,200])},countADSPresent:function(t){var e=new(Xe())(new Uint8Array("ADS1299"));return e.reset(),e.push(t),e.matches},doesBufferHaveEOT:function(t){var e=new(Xe())(new Uint8Array(Qe.OBCIParseEOT));return e.reset(),e.push(t),e.matches>=1},getBiasSetFromADSRegisterQuery:gn,getBooleanFromRegisterQuery:vn,getChannelDataArray:kn,getChannelDataArrayNoScale:xn,getDataArrayAccel:In,getDataArrayAccelNoScale:On,getFirmware:function(t){var e=t.toString().match(/v\d.\d*.\d*/);if(e){var n=e[0].split(".");return{major:Number(n[0][1]),minor:Number(n[1]),patch:Number(n[2]),raw:e[0]}}return e},getSRB1FromADSRegisterQuery:mn,getNumFromThreeCSVADSRegisterQuery:yn,isEven:Dn,isFailureInBuffer:function(t){var e=new(Xe())(new Uint8Array(Qe.OBCIParseFailure));return e.reset(),e.push(t),e.matches>=1},isOdd:function(t){return t%2==1},isStopByte:jn,isSuccessInBuffer:function(t){var e=new(Xe())(new Uint8Array(Qe.OBCIParseSuccess));return e.reset(),e.push(t),e.matches>=1},isTimeSyncSetConfirmationInBuffer:function(t){if(t){var e=t.length;switch(e){case 0:return!1;case 1:return t[0]===Qe.OBCISyncTimeSent.charCodeAt(0);case 2:return t[1]===Qe.OBCIByteStart?t[0]===Qe.OBCISyncTimeSent.charCodeAt(0):!!jn(t[0])&&t[1]===Qe.OBCISyncTimeSent.charCodeAt(0);default:if(t[0]===Qe.OBCISyncTimeSent.charCodeAt(0)&&t[1]===Qe.OBCIByteStart)return!0;for(var n=1;n<e;n++)if(n===e-1){if(jn(t[n-1]))return t[n]===Qe.OBCISyncTimeSent.charCodeAt(0)}else if(jn(t[n-1])&&t[n+1]===Qe.OBCIByteStart)return t[n]===Qe.OBCISyncTimeSent.charCodeAt(0);return!1}}},makeDaisySampleObject:function(t,e){var n={};return t.hasOwnProperty("channelData")&&(n.channelData=t.channelData.concat(e.channelData)),t.hasOwnProperty("channelDataCounts")&&(n.channelDataCounts=t.channelDataCounts.concat(e.channelDataCounts)),n.sampleNumber=Math.floor(e.sampleNumber/2),n.auxData={lower:t.auxData,upper:e.auxData},n.stopByte=t.stopByte,n.timestamp=(t.timestamp+e.timestamp)/2,n._timestamps={lower:t.timestamp,upper:e.timestamp},t.hasOwnProperty("accelData")&&(t.accelData[0]>0||t.accelData[1]>0||t.accelData[2]>0?n.accelData=t.accelData:n.accelData=e.accelData),t.hasOwnProperty("accelDataCounts")&&(t.accelDataCounts[0]>0||t.accelDataCounts[1]>0||t.accelDataCounts[2]>0?n.accelDataCounts=t.accelDataCounts:n.accelDataCounts=e.accelDataCounts),n.valid=!0,n},makeDaisySampleObjectWifi:function(t,e){var n={};return t.hasOwnProperty("channelData")&&(n.channelData=t.channelData.concat(e.channelData)),t.hasOwnProperty("channelDataCounts")&&(n.channelDataCounts=t.channelDataCounts.concat(e.channelDataCounts)),n.sampleNumber=e.sampleNumber,n.auxData={lower:t.auxData,upper:e.auxData},t.hasOwnProperty("timestamp")&&(n.timestamp=t.timestamp),n.stopByte=t.stopByte,n._timestamps={lower:t.timestamp,upper:e.timestamp},t.hasOwnProperty("accelData")&&(t.accelData[0]>0||t.accelData[1]>0||t.accelData[2]>0?n.accelData=t.accelData:n.accelData=e.accelData),t.hasOwnProperty("accelDataCounts")&&(t.accelDataCounts[0]>0||t.accelDataCounts[1]>0||t.accelDataCounts[2]>0?n.accelDataCounts=t.accelDataCounts:n.accelDataCounts=e.accelDataCounts),n.valid=!0,n},makeTailByteFromPacketType:Rn,newSyncObject:function(){return{boardTime:0,correctedTransmissionTime:!1,error:null,timeSyncSent:0,timeSyncSentConfirmation:0,timeSyncSetPacket:0,timeRoundTrip:0,timeTransmission:0,timeOffset:0,timeOffsetMaster:0,valid:!1}},setChSetFromADSRegisterQuery:bn,stripToEOTBuffer:function(t){var e=t.indexOf(Qe.OBCIParseEOT);return e>=0?(e+=Qe.OBCIParseEOT.length)<t.byteLength?Uint8Array.from(t.slice(e)):null:t},syncChannelSettingsWithRawData:function(t){if(Qe.isUndefined(t)||Qe.isUndefined(t.channelSettings)||Qe.isNull(t.channelSettings)||Qe.isUndefined(t.data)||Qe.isNull(t.data))throw new Error(Qe.OBCIErrorUndefinedOrNullInput);if(!Array.isArray(t.channelSettings))throw new Error("".concat(Qe.OBCIErrorInvalidType," channelSettings"));if(t.channelSettings.length===Qe.OBCINumberOfChannelsCyton){if(t.data.toString().match(/Daisy ADS/))throw new Error("raw data mismatch - expected only cyton register info but also found daisy");if(null==t.data.toString().match(/Board ADS/))throw new Error(Qe.OBCIErrorInvalidData)}else{if(null==t.data.toString().match(/Daisy ADS/))throw new Error("raw data mismatch - expected daisy register info but none found");if(null==t.data.toString().match(/Board ADS/))throw new Error("no Board ADS info found")}t.channelSettings.forEach((function(t){if(!(t.hasOwnProperty("channelNumber")&&t.hasOwnProperty("powerDown")&&t.hasOwnProperty("gain")&&t.hasOwnProperty("inputType")&&t.hasOwnProperty("bias")&&t.hasOwnProperty("srb2")&&t.hasOwnProperty("srb1")))throw new Error(Qe.OBCIErrorMissingRequiredProperty)}));var e=null,n=!1,r=!1,i=t.data.toString().match(/Board ADS/),a=t.data.toString().slice(i.index,Qe.OBCIRegisterQueryCyton.length);if(mn(a)&&(n=!0),t.channelSettings.length>Qe.OBCINumberOfChannelsCyton){var o=t.data.toString().match(/Daisy ADS/);e=t.data.toString().slice(o.index,o.index+Qe.OBCIRegisterQueryCytonDaisy.length),mn(a)&&(r=!0)}t.channelSettings.forEach((function(t){t.channelNumber<Qe.OBCINumberOfChannelsCyton?(bn(a,t),t.bias=gn(a,t.channelNumber),t.srb1=n):(bn(e,t),t.bias=gn(e,t.channelNumber-Qe.OBCINumberOfChannelsCyton),t.srb1=r)}))},droppedPacketCheck:function(t,e){if(t===Qe.OBCISampleNumberMax&&0===e)return null;if(e-t==1)return null;var n=[];if(t>e){for(var r=Qe.OBCISampleNumberMax-t,i=0;i<r;i++)n.push(t+i+1);t=-1}for(var a=1;a<e-t;a++)n.push(t+a);return n},convert18bitAsInt32:un,convert19bitAsInt32:ln,decompressDeltas18Bit:hn,decompressDeltas19Bit:fn,sampleCompressedData:function(t){return new Uint8Array([t,0,0,0,0,8,0,5,0,0,72,0,9,240,1,176,0,48,0,8])},sampleBLERaw:function(){return new Uint8Array([0,0,1,0,0,2,0,0,3,0,0,4])},sampleImpedanceChannel1:function(){return new Uint8Array([Qe.OBCIGanglionByteIdImpedanceChannel1,0,0,1])},sampleImpedanceChannel2:function(){return new Uint8Array([Qe.OBCIGanglionByteIdImpedanceChannel2,0,0,1])},sampleImpedanceChannel3:function(){return new Uint8Array([Qe.OBCIGanglionByteIdImpedanceChannel3,0,0,1])},sampleImpedanceChannel4:function(){return new Uint8Array([Qe.OBCIGanglionByteIdImpedanceChannel4,0,0,1])},sampleImpedanceChannelReference:function(){return new Uint8Array([Qe.OBCIGanglionByteIdImpedanceChannelReference,0,0,1])},sampleMultiBytePacket:function(t){var e=new Uint8Array([Qe.OBCIGanglionByteIdMultiPacket]);return Uint8Array.concat([e,t])},sampleMultiBytePacketStop:function(t){var e=new Uint8Array([Qe.OBCIGanglionByteIdMultiPacketStop]);return Uint8Array.concat([e,t])},sampleOtherData:function(t){var e=new Uint8Array([255]);return Uint8Array.concat([e,t])},sampleUncompressedData:function(){return new Uint8Array([0,0,0,1,0,0,2,0,0,3,0,0,4,1,2,3,4,5,6,7])},parseGanglion:function(t){var e=parseInt(t.rawDataPacket[0]);if(e<=Qe.OBCIGanglionByteId19Bit.max)return cn(t);switch(e){case Qe.OBCIGanglionByteIdMultiPacket:return rn(t);case Qe.OBCIGanglionByteIdMultiPacketStop:return an(t);case Qe.OBCIGanglionByteIdImpedanceChannel1:case Qe.OBCIGanglionByteIdImpedanceChannel2:case Qe.OBCIGanglionByteIdImpedanceChannel3:case Qe.OBCIGanglionByteIdImpedanceChannel4:case Qe.OBCIGanglionByteIdImpedanceChannelReference:return function(t){var e;switch(parseInt(t.rawDataPacket[0])){case Qe.OBCIGanglionByteIdImpedanceChannel1:e=1;break;case Qe.OBCIGanglionByteIdImpedanceChannel2:e=2;break;case Qe.OBCIGanglionByteIdImpedanceChannel3:e=3;break;case Qe.OBCIGanglionByteIdImpedanceChannel4:e=4;break;case Qe.OBCIGanglionByteIdImpedanceChannelReference:e=0}for(var n={channelNumber:e,impedanceValue:0},r=t.rawDataPacket.length;Number.isNaN(Number(t.rawDataPacket.slice(1,r)))&&0!==r;)r--;return 0!==r&&(n.impedanceValue=Number(t.rawDataPacket.slice(1,r))),n}(t);default:return null}},processMultiBytePacket:rn,processMultiBytePacketStop:an};function rn(t){t.multiPacketBuffer?t.multiPacketBuffer=Uint8Array.concat([Uint8Array.from(t.multiPacketBuffer),Uint8Array.from(t.rawDataPacket.slice(Qe.OBCIGanglionPacket19Bit.dataStart,Qe.OBCIGanglionPacket19Bit.dataStop))]):t.multiPacketBuffer=t.rawDataPacket.slice(Qe.OBCIGanglionPacket19Bit.dataStart,Qe.OBCIGanglionPacket19Bit.dataStop)}function an(t){rn(t);var e=t.multiPacketBuffer.toString();return t.multiPacketBuffer=null,{message:e}}function on(t,e){for(var n=1;n<3;n++)for(var r=0;r<4;r++)t.decompressedSamples[n][r]=t.decompressedSamples[n-1][r]-e[n-1][r]}function sn(t,e,n){var r;if(n)(r=Tn(t)).channelDataCounts=e;else{r=_n(t);for(var i=0;i<Qe.OBCINumberOfChannelsGanglion;i++)r.channelData.push(e[i]*Qe.OBCIGanglionScaleFactorPerCountVolts)}return r.timestamp=Date.now(),r}function cn(t){return parseInt(t.rawDataPacket[0])===Qe.OBCIGanglionByteIdUncompressed?function(t){t.lastSampleNumber=Qe.OBCIGanglionByteIdUncompressed;for(var e=0;e<4;e++)t.decompressedSamples[0][e]=nn.interpret24bitAsInt32(t.rawDataPacket.slice(1+3*e,1+3*e+3));return[sn(0,t.decompressedSamples[0],t.sendCounts)]}(t):function(t){t.lastSampleNumber=parseInt(t.rawDataPacket[0]);var e=[];if(t.lastSampleNumber<=Qe.OBCIGanglionByteId18Bit.max)switch(on(t,hn(t.rawDataPacket.slice(Qe.OBCIGanglionPacket18Bit.dataStart,Qe.OBCIGanglionPacket18Bit.dataStop))),e.push(sn(2*t.lastSampleNumber-1,t.decompressedSamples[1],t.sendCounts)),e.push(sn(2*t.lastSampleNumber,t.decompressedSamples[2],t.sendCounts)),t.lastSampleNumber%10){case Qe.OBCIGanglionAccelAxisX:t.accelArray[0]=t.sendCounts?t.rawDataPacket.readInt8(Qe.OBCIGanglionPacket18Bit.auxByte-1):t.rawDataPacket.readInt8(Qe.OBCIGanglionPacket18Bit.auxByte-1)*Qe.OBCIGanglionAccelScaleFactor;break;case Qe.OBCIGanglionAccelAxisY:t.accelArray[1]=t.sendCounts?t.rawDataPacket.readInt8(Qe.OBCIGanglionPacket18Bit.auxByte-1):t.rawDataPacket.readInt8(Qe.OBCIGanglionPacket18Bit.auxByte-1)*Qe.OBCIGanglionAccelScaleFactor;break;case Qe.OBCIGanglionAccelAxisZ:t.accelArray[2]=t.sendCounts?t.rawDataPacket.readInt8(Qe.OBCIGanglionPacket18Bit.auxByte-1):t.rawDataPacket.readInt8(Qe.OBCIGanglionPacket18Bit.auxByte-1)*Qe.OBCIGanglionAccelScaleFactor,t.sendCounts?e[0].accelData=t.accelArray:e[0].accelDataCounts=t.accelArray}else on(t,fn(t.rawDataPacket.slice(Qe.OBCIGanglionPacket19Bit.dataStart,Qe.OBCIGanglionPacket19Bit.dataStop))),e.push(sn(2*(t.lastSampleNumber-100)-1,t.decompressedSamples[1],t.sendCounts)),e.push(sn(2*(t.lastSampleNumber-100),t.decompressedSamples[2],t.sendCounts));for(var n=0;n<Qe.OBCINumberOfChannelsGanglion;n++)t.decompressedSamples[0][n]=t.decompressedSamples[2][n];return e}(t)}function un(t){var e=0;return!0&t[2]&&(e=16383),e<<18|t[0]<<16|t[1]<<8|t[2]}function ln(t){var e=0;return!0&t[2]&&(e=8191),e<<19|t[0]<<16|t[1]<<8|t[2]}function hn(t){var e=new Array(Qe.OBCIGanglionSamplesPerPacket);e[0]=[0,0,0,0],e[1]=[0,0,0,0];for(var n,r=[],i=0;i<Qe.OBCIGanglionSamplesPerPacket;i++)r.push([0,0,0,0]);return n=new Uint8Array([t[0]>>6,(63&t[0])<<2|t[1]>>6,(63&t[1])<<2|t[2]>>6]),r[0][0]=un(n),n=new Uint8Array([(63&t[2])>>4,t[2]<<4|t[3]>>4,t[3]<<4|t[4]>>4]),r[0][1]=un(n),n=new Uint8Array([(15&t[4])>>2,t[4]<<6|t[5]>>2,t[5]<<6|t[6]>>2]),r[0][2]=un(n),n=new Uint8Array([3&t[6],t[7],t[8]]),r[0][3]=un(n),n=new Uint8Array([t[9]>>6,(63&t[9])<<2|t[10]>>6,(63&t[10])<<2|t[11]>>6]),r[1][0]=un(n),n=new Uint8Array([(63&t[11])>>4,t[11]<<4|t[12]>>4,t[12]<<4|t[13]>>4]),r[1][1]=un(n),n=new Uint8Array([(15&t[13])>>2,t[13]<<6|t[14]>>2,t[14]<<6|t[15]>>2]),r[1][2]=un(n),n=new Uint8Array([3&t[15],t[16],t[17]]),r[1][3]=un(n),r}function fn(t){var e=new Array(Qe.OBCIGanglionSamplesPerPacket);e[0]=[0,0,0,0],e[1]=[0,0,0,0];for(var n,r=[],i=0;i<Qe.OBCIGanglionSamplesPerPacket;i++)r.push([0,0,0,0]);return n=new Uint8Array([t[0]>>5,(31&t[0])<<3|t[1]>>5,(31&t[1])<<3|t[2]>>5]),r[0][0]=ln(n),n=new Uint8Array([(31&t[2])>>2,t[2]<<6|t[3]>>2,t[3]<<6|t[4]>>2]),r[0][1]=ln(n),n=new Uint8Array([(3&t[4])<<1|t[5]>>7,(127&t[5])<<1|t[6]>>7,(127&t[6])<<1|t[7]>>7]),r[0][2]=ln(n),n=new Uint8Array([(127&t[7])>>4,(15&t[7])<<4|t[8]>>4,(15&t[8])<<4|t[9]>>4]),r[0][3]=ln(n),n=new Uint8Array([(15&t[9])>>1,t[9]<<7|t[10]>>1,t[10]<<7|t[11]>>1]),r[1][0]=ln(n),n=new Uint8Array([(1&t[11])<<2|t[12]>>6,t[12]<<2|t[13]>>6,t[13]<<2|t[14]>>6]),r[1][1]=ln(n),n=new Uint8Array([(56&t[14])>>3,(7&t[14])<<5|(248&t[15])>>3,(7&t[15])<<5|(248&t[16])>>3]),r[1][2]=ln(n),n=new Uint8Array([7&t[16],t[17],t[18]]),r[1][3]=ln(n),r}function dn(t){return{channel:t,P:{raw:-1,text:Qe.OBCIImpedanceTextInit},N:{raw:-1,text:Qe.OBCIImpedanceTextInit}}}function pn(t){var e;try{switch(Bn(t.rawDataPacket[Qe.OBCIPacketPositionStopByte])){case Qe.OBCIStreamPacketStandardAccel:e=nn.parsePacketStandardAccel(t);break;case Qe.OBCIStreamPacketStandardRawAux:e=nn.parsePacketStandardRawAux(t);break;case Qe.OBCIStreamPacketAccelTimeSyncSet:case Qe.OBCIStreamPacketAccelTimeSynced:e=nn.parsePacketTimeSyncedAccel(t);break;case Qe.OBCIStreamPacketRawAuxTimeSyncSet:case Qe.OBCIStreamPacketRawAuxTimeSynced:e=nn.parsePacketTimeSyncedRawAux(t);break;case Qe.OBCIStreamPacketImpedance:e=nn.parsePacketImpedance(t);break;default:e={error:"bad stop byte ".concat(t.rawDataPacket.slice(32,33).toString("hex")),valid:!1,rawDataPacket:t.rawDataPacket},t.verbose&&console.log(e.error)}}catch(n){e={error:n,valid:!1,rawDataPacket:t.rawDataPacket},t.verbose&&console.log(n)}return e}function vn(t,e,n){var r=t.match(e);if(r){var i=parseInt(t.charAt(r.index+n));if(Number.isNaN(i))throw new Error(Qe.OBCIErrorInvalidData);return Boolean(i)}throw new Error(Qe.OBCIErrorMissingRegisterSetting)}function mn(t){return vn(t,Qe.OBCIRegisterQueryNameMISC1,21)}function gn(t,e){return vn(t,Qe.OBCIRegisterQueryNameBIASSENSP,20+3*e)}function yn(t,e,n){var r=t.match(e);if(r){var i=parseInt(t.charAt(r.index+n)),a=parseInt(t.charAt(r.index+n+3)),o=parseInt(t.charAt(r.index+n+6));if(Number.isNaN(i)||Number.isNaN(a)||Number.isNaN(o))throw new Error(Qe.OBCIErrorInvalidData);return i<<2|a<<1|o}throw new Error(Qe.OBCIErrorMissingRegisterSetting)}function bn(t,e){var n=Qe.OBCIRegisterQueryNameCHnSET[e.channelNumber];void 0===n&&(n=Qe.OBCIRegisterQueryNameCHnSET[e.channelNumber-Qe.OBCINumberOfChannelsCyton]),e.powerDown=vn(t,n,16),e.gain=Qe.gainForCommand(yn(t,n,19)),e.inputType=Qe.inputTypeForCommand(yn(t,n,31)),e.srb2=vn(t,n,28)}function wn(t){var e=Qe.OBCIPacketSize-1;if(t.byteLength!==Qe.OBCIPacketSize)throw new Error(Qe.OBCIErrorInvalidByteLength);return t.readUInt32BE(e-Qe.OBCIStreamPacketTimeByteSize)}function Cn(t){var e=Qe.OBCIPacketSize-1-Qe.OBCIStreamPacketTimeByteSize-2;if(t.rawDataPacket.byteLength!==Qe.OBCIPacketSize)throw new Error(Qe.OBCIErrorInvalidByteLength);var n=t.rawDataPacket[Qe.OBCIPacketPositionSampleNumber],r=nn.interpret16bitAsInt32(t.rawDataPacket.slice(e,e+2));switch(n%10){case Qe.OBCIAccelAxisX:return t.accelArray[0]=t.scale?r*en:r,!1;case Qe.OBCIAccelAxisY:return t.accelArray[1]=t.scale?r*en:r,!1;case Qe.OBCIAccelAxisZ:return t.accelArray[2]=t.scale?r*en:r,!0;default:return!1}}function Sn(t){if(t.byteLength!==Qe.OBCIPacketSize)throw new Error(Qe.OBCIErrorInvalidByteLength);return Uint8Array.from(t.slice(Qe.OBCIPacketPositionTimeSyncAuxStart,Qe.OBCIPacketPositionTimeSyncAuxStop))}function In(t){for(var e=[],n=0;n<3;n++){var r=2*n;e.push(nn.interpret16bitAsInt32(t.slice(r,r+2))*en)}return e}function On(t){for(var e=[],n=0;n<3;n++){var r=2*n;e.push(nn.interpret16bitAsInt32(t.slice(r,r+2)))}return e}function kn(t){if(!Array.isArray(t.channelSettings))throw new Error("Error [getChannelDataArray]: Channel Settings must be an array!");t.hasOwnProperty("protocol")||(t.protocol=Qe.OBCIProtocolSerial);var e=[],n=t.channelSettings.length,r=t.rawDataPacket[Qe.OBCIPacketPositionSampleNumber],i=n===Qe.OBCINumberOfChannelsDaisy,a=Qe.OBCINumberOfChannelsCyton;i||(a=t.channelSettings.length);for(var o=0;o<a;o++){if(!t.channelSettings[o].hasOwnProperty("gain"))throw new Error("Error [getChannelDataArray]: Invalid channel settings object at index ".concat(o));if(!Qe.isNumber(t.channelSettings[o].gain))throw new Error("Error [getChannelDataArray]: Property gain of channelSettingsObject not or type Number");var s=0;if(t.protocol===Qe.OBCIProtocolSerial)s=Dn(r)&&i?tn/t.channelSettings[o+Qe.OBCINumberOfChannelsDefault].gain/(Math.pow(2,23)-1):tn/t.channelSettings[o].gain/(Math.pow(2,23)-1);else if(t.protocol===Qe.OBCIProtocolWifi)s=i?t.lastSampleNumber===r?tn/t.channelSettings[o+Qe.OBCINumberOfChannelsDefault].gain/(Math.pow(2,23)-1):tn/t.channelSettings[o].gain/(Math.pow(2,23)-1):t.channelSettings.length===Qe.OBCINumberOfChannelsCyton?tn/t.channelSettings[o].gain/(Math.pow(2,23)-1):Qe.OBCIGanglionScaleFactorPerCountVolts;else{if(t.protocol!==Qe.OBCIProtocolBLE)throw new Error("Error [getChannelDataArray]: Invalid protocol must be wifi or serial");s=tn/t.channelSettings[o].gain/(Math.pow(2,23)-1)}e.push(s*nn.interpret24bitAsInt32(t.rawDataPacket.slice(3*o+Qe.OBCIPacketPositionChannelDataStart,3*o+Qe.OBCIPacketPositionChannelDataStart+3)))}return e}function xn(t){if(!Array.isArray(t.channelSettings))throw new Error("Error [getChannelDataArrayNoScale]: Channel Settings must be an array!");var e=[],n=t.channelSettings.length;n>Qe.OBCINumberOfChannelsDefault&&(n=Qe.OBCINumberOfChannelsDefault);for(var r=0;r<n;r++)e.push(nn.interpret24bitAsInt32(t.rawDataPacket.slice(3*r+Qe.OBCIPacketPositionChannelDataStart,3*r+Qe.OBCIPacketPositionChannelDataStart+3)));return e}function Bn(t){return 15&t}function En(t){return t||0===t?t>255&&(t=255):t=69,t}function _n(t){return t||0===t?t>255&&(t=255):t=0,{startByte:Qe.OBCIByteStart,sampleNumber:t,channelData:[],accelData:[],auxData:null,stopByte:Qe.OBCIByteStop,boardTime:0,timestamp:0,valid:!0}}function Tn(t){return t||0===t?t>255&&(t=255):t=0,{startByte:Qe.OBCIByteStart,sampleNumber:t,channelDataCounts:[],accelDataCounts:[],auxData:null,stopByte:Qe.OBCIByteStop,boardTime:0,timestamp:0,valid:!0}}function Pn(t){var e=new Uint8Array(3);e.fill(0);var n=t/(.1875/(Math.pow(2,23)-1));return n=Math.floor(n),e[2]=255&n,e[1]=(65280&n)>>8,e[0]=(n&255<<16)>>16,e}function An(t){var e=new Uint8Array(2);e.fill(0);var n=t/en;return n=Math.floor(n),e[1]=255&n,e[0]=(65280&n)>>8,e}function Dn(t){return t%2==0}function Nn(t,e,n){var r=new Uint8Array(Qe.OBCIPacketSize);r.fill(0),r[0]=Qe.OBCIByteStart,r[1]=t.sampleNumber;for(var i=0;i<Qe.OBCINumberOfChannelsDefault;i++)Pn(t.channelData[i]).copy(r,2+3*i);return n.copy(r,26),r.writeInt32BE(e,28),r[Qe.OBCIPacketSize-1]=Rn(Qe.OBCIStreamPacketRawAuxTimeSynced),r}function Fn(t,e){var n=new Uint8Array(Qe.OBCIPacketSize);n.fill(0),n[0]=Qe.OBCIByteStart,n[1]=t.sampleNumber;for(var r=0;r<Qe.OBCINumberOfChannelsDefault;r++)Pn(t.channelData[r]).copy(n,2+3*r);return n.writeInt32BE(e,28),n[Qe.OBCIPacketSize-1]=Rn(Qe.OBCIStreamPacketAccelTimeSynced),n}function Rn(t){return(t<0||t>15)&&(t=0),Qe.OBCIByteStop|t}function jn(t){return(240&t)===Qe.OBCIByteStop}function Mn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ln(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mn(Object(n),!0).forEach((function(e){zn(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function zn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Gn=function(t){var e=t.channelData;return Ln(Ln({},function(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},a=Object.keys(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}(t,["channelData"])),{},{data:e})},Un="ganglion",Vn={reader:"2d30c082-f39f-4ce6-923f-3484ea480596",writer:"2d30c083-f39f-4ce6-923f-3484ea480596",connection:"2d30c084-f39f-4ce6-923f-3484ea480596"},qn={filters:[{namePrefix:"Ganglion-"}],optionalServices:[65156]},Zn={start:"b",accelData:"n"};function Hn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Wn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Hn(Object(n),!0).forEach((function(e){Yn(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Hn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Yn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Qn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Kn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kn(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Jn(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function $n(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){Jn(a,r,i,o,s,"next",t)}function s(t){Jn(a,r,i,o,s,"throw",t)}o(void 0)}))}}function Xn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function er(t){var e=parseInt(t.rawDataPacket[0]);if(e<=Qe.OBCIGanglionByteId19Bit.max)return cn(t);switch(e){case Qe.OBCIGanglionByteIdMultiPacket:return processMultiBytePacket(t);case Qe.OBCIGanglionByteIdMultiPacketStop:return processMultiBytePacketStop(t);case Qe.OBCIGanglionByteIdImpedanceChannel1:case Qe.OBCIGanglionByteIdImpedanceChannel2:case Qe.OBCIGanglionByteIdImpedanceChannel3:case Qe.OBCIGanglionByteIdImpedanceChannel4:case Qe.OBCIGanglionByteIdImpedanceChannelReference:return processImpedanceData(t);default:return null}}var nr=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};function r(t){return{channelNumber:t,powerDown:!1,gain:24,inputType:"normal",bias:!0,srb2:!0,srb1:!1}}Xn(this,t),this.options=n,this.gatt=null,this.device=null,this.deviceName=null,this.service=null,this.characteristics=null,this.onDisconnect$=new Lt.Subject,this.boardName=Un,this.channelSize=4;var i=function(t){for(var e=[],n=0;n<t;n++)e.push(r(n));return e};function a(t){for(var e=[],n=0;n<3;n++)e.push(new Array(t));return e}this.rawDataPacketToSample={accelArray:[0,0,0],channelSettings:i(4),decompressedSamples:a(4),lastSampleNumber:0,rawDataPacket:new Uint8Array(33).buffer,rawDataPackets:[],scale:!0,sendCounts:!1,timeOffset:0,verbose:!1},this.connectionStatus=new zt.BehaviorSubject(!1),this.stream=(new Lt.Subject).pipe((0,Ut.map)((function(t){return e.eventToBufferMapper(t)})),(0,Gt.tap)((function(t){return e.setRawDataPacket(t)})),(0,Ut.map)((function(){return er(e.rawDataPacketToSample)})),(0,Ht.mergeMap)((function(t){return t})),(0,Ut.map)(Gn),(0,Zt.takeUntil)(this.onDisconnect$)),this.accelData=this.stream.pipe((0,qt.filter)((function(t){return t.accelData.length})))}var e,n,r,i;return e=t,(n=[{key:"eventToBufferMapper",value:function(t){return new Uint8Array(t.target.value.buffer)}},{key:"setRawDataPacket",value:function(t){this.rawDataPacketToSample.rawDataPacket=t}},{key:"connect",value:(i=$n(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.bluetooth.requestDevice(qn);case 2:return this.device=t.sent,this.addDisconnectedEvent(),t.next=6,this.device.gatt.connect();case 6:return this.gatt=t.sent,this.deviceName=this.gatt.device.name,t.next=10,this.gatt.getPrimaryService(65156);case 10:return this.service=t.sent,t.t0=this,t.next=14,this.service.getCharacteristics();case 14:t.t1=t.sent,t.t0.setCharacteristics.call(t.t0,t.t1),this.connectionStatus.next(!0);case 17:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"setCharacteristics",value:function(t){this.characteristics=Object.entries(Vn).reduce((function(e,n){var r=Qn(n,2),i=r[0],a=r[1];return Wn(Wn({},e),{},Yn({},i,t.find((function(t){return t.uuid===a}))))}),{})}},{key:"start",value:(r=$n(regeneratorRuntime.mark((function t(){var e,n,r,i,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.characteristics,n=e.reader,r=e.writer,i=Object.entries(Zn).reduce((function(t,e){var n=Qn(e,2),r=n[0],i=n[1];return Wn(Wn({},t),{},Yn({},r,(new TextEncoder).encode(i)))}),{}),n.startNotifications(),n.addEventListener("characteristicvaluechanged",(function(t){a.stream.next(t)})),!this.options.accelData){t.next=8;break}return t.next=7,r.writeValue(i.accelData);case 7:n.readValue();case 8:return t.next=10,r.writeValue(i.start);case 10:n.readValue();case 11:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"addDisconnectedEvent",value:function(){var t=this;(0,Wt.fromEvent)(this.device,"gattserverdisconnected").pipe((0,Vt.first)()).subscribe((function(){t.gatt=null,t.device=null,t.deviceName=null,t.service=null,t.characteristics=null,t.connectionStatus.next(!1)}))}},{key:"disconnect",value:function(){this.gatt&&(this.onDisconnect$.next(),this.gatt.disconnect())}}])&&tr(e.prototype,n),t}();function rr(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function ir(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){rr(a,r,i,o,s,"next",t)}function s(t){rr(a,r,i,o,s,"throw",t)}o(void 0)}))}}function ar(t){return function(t){if(Array.isArray(t))return or(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return or(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?or(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function or(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function sr(t){return(sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function cr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var ur=function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;cr(this,t),this.init=function(t,e){n.info=t,n.info.sps=200,n.info.deviceType="eeg";var r=1e6;if(n.info.eegChannelTags=[{ch:0,tag:"FP1",analyze:!0},{ch:1,tag:"FP2",analyze:!0},{ch:2,tag:"C3",analyze:!0},{ch:3,tag:"C4",analyze:!0}],!0===n.info.useFilters&&n.info.eegChannelTags.forEach((function(t,e){"other"!==t.tag?n.filters.push(new j(t.ch,n.info.sps,!0,r)):n.filters.push(new j(t.ch,n.info.sps,!1,r)),n.filters[n.filters.length-1].useScaling=!0,n.filters[n.filters.length-1].notch60.pop()})),!0===e)n.atlas=new C(location+":"+n.mode,{eegshared:{eegChannelTags:n.info.eegChannelTags,sps:n.info.sps}},"10_20",!0,!0,n.info.analysis),n.info.useAtlas=!0;else if("object"===sr(e)){var i;n.atlas=e,n.atlas.data.eegshared.eegChannelTags=n.info.eegChannelTags,n.atlas.data.eegshared.sps=n.info.sps,n.atlas.data.eegshared.frequencies=n.atlas.bandpassWindow(0,128,.5*n.info.sps),n.atlas.data.eegshared.bandFreqs=n.atlas.getBandFreqs(n.atlas.data.eegshared.frequencies),n.atlas.data.eeg=n.atlas.gen10_20Atlas(),n.atlas.data.coherence=n.atlas.genCoherenceMap(n.info.eegChannelTags),n.atlas.data.eegshared.eegChannelTags.forEach((function(t,e){void 0===n.atlas.getEEGDataByTag(t.tag)&&n.atlas.addEEGCoord(t.ch)})),n.atlas.settings.coherence=!0,n.atlas.settings.eeg=!0,n.info.useAtlas=!0,t.analysis.length>0&&((i=n.atlas.settings.analysis).push.apply(i,ar(n.info.analysis)),n.atlas.settings.analyzing||(n.atlas.settings.analyzing=!0,n.atlas.analyzer()))}},this.connect=ir(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.device=new nr,t.next=3,n.device.connect();case 3:return t.next=5,n.device.start();case 5:n.device.stream.subscribe((function(t){if(n.info.useAtlas){var e=t.timestamp;t.data.forEach((function(t,r){var i=n.atlas.getEEGDataByChannel(r);if(i.times.push(e),i.raw.push(t),i.count++,!0===n.info.useFilters){var a=0;void 0!==n.filters[r]&&(a=n.filters[r].apply(t)),i.filtered.push(a)}}))}})),!0===n.info.useAtlas&&(n.atlas.data.eegshared.startTime=Date.now(),!0!==n.atlas.settings.analyzing&&n.info.analysis.length>0&&(n.atlas.settings.analyzing=!0,setTimeout((function(){n.atlas.analyzer()}),1200))),n.atlas.settings.deviceConnected=!0,n.onconnect(),n.setIndicator(!0);case 10:case"end":return t.stop()}}),t)}))),this.disconnect=function(){n.device.disconnect(),n.atlas.settings.analyzing=!1,n.atlas.settings.deviceConnected=!1,n.ondisconnect(),n.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,e=(Math.floor(1e4*Math.random()),function(){return"\n            "}),r=function(){};n.ui=new G(e,t,void 0,r)},this.atlas=null,this.mode=e,this.device=null,this.filters=[],this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="1px solid white")}};function lr(t){return function(t){if(Array.isArray(t))return hr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return hr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?hr(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function fr(t){return(fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dr(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function pr(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){dr(a,r,i,o,s,"next",t)}function s(t){dr(a,r,i,o,s,"throw",t)}o(void 0)}))}}function vr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function mr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function yr(t,e,n){return e&&gr(t.prototype,e),n&&gr(t,n),t}var br=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"public",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"http://localhost:8000",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"http://127.0.0.1:8000";mr(this,t),wr.call(this),this.devices=[],this.state=new p({commandResult:{}}),this.atlas=new C("atlas",void 0,void 0,!0,!1),this.info={nDevices:0,auth:{url:new URL(a),username:e,password:n,access:i,appname:r.toLowerCase().split(" ").join("").replace(/^[^a-z]+|[^\w]+/gi,""),authenticated:!1},subscribed:!1,connections:[],localHostURL:o},this.socket=null}var e,n,r;return yr(t,[{key:"setLoginInfo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"public",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.info.auth.username=t,this.info.auth.password=e,this.info.auth.access=n,this.info.auth.appname=r}},{key:"connect",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"freeeeg32_2",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["eegfft"],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[["eegch","FP1","all"]],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],c=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(!0===a&&(console.log(this.socket),null==this.socket||1!==this.socket.readyState))return console.error("Server connection not found, please run login() first"),!1;if(this.devices.length>0&&(e.indexOf("eeg")>-1||e.indexOf("muse")>-1)){var u=this.devices.find((function(t,e){if("eeg"===t.deviceType)return!0}));u||(c=this.devices[0].atlas)}this.devices.push(new Cr(e,n,s,c,a,this.socket,o,this.info.auth));var l=this.devices.length-1;this.devices[l].onconnect=function(){t.info.nDevices++,r(),t.onconnected()},this.devices[l].ondisconnect=function(){i(),t.ondisconnected(),Array.isArray(t.devices[l].info.analysis)&&t.devices[l].info.analysis.length>0&&(t.devices[l].info.analyzing=!1),t.devices[l].info.streaming=!1,t.devices.splice(l,1),t.info.nDevices--},this.devices[l].init(),1===this.devices.length&&(this.atlas=this.devices[0].atlas),this.state.addToState("device"+l,this.devices[l].info),this.devices[l].connect()}},{key:"reconnect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.devices.length-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t>-1?(this.devices[t].connect(),e()):console.log("No devices connected")}},{key:"disconnect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.devices.length-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t>-1?(this.devices[t].info.streaming=!1,this.devices[t].disconnect(),e()):console.log("No devices connected")}},{key:"makeConnectOptions",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=Math.floor(1e4*Math.random())+"devicemenu",a='<div><span class="collapsible-content-label">Device Selection</span><hr></div><div class="device-gallery">',o=["muse","freeeeg32_2","freeeeg32_19","hegduinousb","hegduinobt","cyton","cyton_daisy","ganglion"];o.forEach((function(t,e){a+="\n\t\t\t<div id='brainsatplay-".concat(t,"' value='").concat(t,"' class='device-card'>\n\t\t\t<div id='brainsatplay-").concat(t,"-indicator' class='indicator'></div>\n\t\t\t").concat(t,"\n\t\t\t</div>")})),a+="</div>",e.insertAdjacentHTML("afterbegin",a),e.insertAdjacentHTML("beforeend","<button id='"+i+"disconnect'>Disconnect</button>"),o.forEach((function(e,i){document.getElementById("brainsatplay-".concat(e)).onclick=function(){"muse"===e?t.connect("muse",["eegcoherence"],n,r):"freeeeg32_2"===e?t.connect("freeeeg32_2",["eegcoherence"],n,r):"freeeeg32_19"===e?t.connect("freeeeg32_19",["eegfft"],n,r):"hegduinousb"===e?t.connect("hegduinousb",[],n,r):"hegduinobt"===e?t.connect("hegduinobt",[],n,r):"hegduinowifi"===e?t.connect("hegduinowifi",[],n,r):"cyton"===e?t.connect("cyton",["eegfft"],n,r):"cyton_daisy"===e?t.connect("cyton_daisy",["eegfft"],n,r):"ganglion"===e&&t.connect("ganglion",["eegcoherence"],n,r)}})),document.getElementById(i+"disconnect").onclick=function(){t.disconnect()}}},{key:"beginStream",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.devices[t].info.streaming&&(this.devices[t].info.streaming=!0,null!==e&&(this.devices[t].info.streamParams=e),this.devices[t].streamLoop())}},{key:"endStream",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.devices[t].info.streaming=!1}},{key:"getDevice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"freeeeg32_2",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=void 0;return this.devices.find((function(r,i){return r.info.deviceName.indexOf(t)>-1&&r.info.deviceNum===e||r.info.deviceType.indexOf(t)>-1&&r.info.deviceNum===e?(n=r,!0):void 0})),n}},{key:"addAnalysisMode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.data.device0.deviceName,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.getDevice(e,n),i=r.info.analysis.find((function(e,n){if(e===t)return!0}));i||r.info.analysis.push(t),r.atlas.settings.analyzing||(r.atlas.settings.analyzing=!0,r.atlas.analyzer())}},{key:"stopAnalysis",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.devices.length>0?""!==e&&"string"==typeof e?this.atlas.settings.analysis.find((function(n,r){if(e===n)return t.atlas.settings.analysis.splice(r,1),!0})):this.atlas.settings.analyzing=!1:console.error("no devices connected")}},{key:"getStreamData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={};for(var r in this.state.data)null===e?r.indexOf(t)>-1&&(n[r]=this.state.data[r]):r.indexOf(t)>-1&&r.indexOf(e)>-1&&(n[r]=this.state.data[r]);return n}},{key:"addAnalyzerFunc",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.devices.forEach((function(n,r){null!==n.atlas&&null!==t&&(n.atlas.analyzerOpts.indexOf(t)<0?(n.atlas.analyzerOpts.push(t),n.atlas.analyzerFuncs.push(e)):console.error("property "+t+" exists"))}))}},{key:"streamAppData",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.info.nDevices>0){var r=Object.assign(vr({},e+"newData",!0),n);this.state.addToState(e,r,(function(n){t.state.data[e][e+"newData"]||(t.state.data[e][e+"newData"]=!0)}));var i=function(){return!0===t.state.data[e][e+"newData"]?(t.state.data[e][e+"newData"]=!1,t.state.data[key]):void 0};this.addStreamFunc(e,i),this.addStreamParam([e])}}},{key:"addStreamFunc",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;"string"==typeof t&&"function"==typeof e&&void 0!==this.devices[n]?this.devices[n].addStreamFunc(t,e):console.error("addStreamFunc error")}},{key:"addStreamParam",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach((function(e,n){Array.isArray(e)&&t.devices.find((function(t){if(e[0].indexOf(t.info.deviceType)>-1)return"eeg"===t.info.deviceType?t.atlas.data.eegshared.eegChannelTags.find((function(n){if(n.tag===e[1]||n.ch===e[1])return t.info.streamParams.push(e),!0})):t.info.streamParams.push(e),!0}))}))}},{key:"login",value:(r=pr(regeneratorRuntime.mark((function t(){var e,n,r=this,i=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=i.length>0&&void 0!==i[0]&&i[0],n=i.length>1&&void 0!==i[1]?i[1]:this.info.auth,i.length>2&&void 0!==i[2]?i[2]:this.info.auth.url.toString(),null!=this.socket&&1===this.socket.readyState||(this.socket=this.setupWebSocket(n),this.info.auth.authenticated=!0,this.subscribed=!0),null!==this.socket&&1===this.socket.readyState&&!0===e&&this.devices.length>0&&this.devices.forEach((function(t,e){r.beginStream(e)}));case 5:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"signup",value:(n=pr(regeneratorRuntime.mark((function t(){var e,n,r,i,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=a.length>0&&void 0!==a[0]?a[0]:{},n=a.length>1&&void 0!==a[1]?a[1]:this.info.auth.url.toString(),n=this.checkURL(n),r=JSON.stringify(e),t.next=6,fetch(n.toString()+"signup",{method:"POST",mode:"cors",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:r}).then((function(t){return t.json().then((function(t){return t}))})).then((function(t){return console.log("\n"+t),t})).catch((function(t){console.error("\n"+t.message)}));case 6:return i=t.sent,t.abrupt("return",i);case 8:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"request",value:(e=pr(regeneratorRuntime.mark((function t(e){var n,r,i,a,o=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:"POST",r=o.length>2&&void 0!==o[2]?o[2]:"",i=o.length>3&&void 0!==o[3]?o[3]:this.info.auth.url.toString(),""===r){t.next=13;break}return i=this.checkURL(i),r=this.checkPathname(r),a={method:n,mode:"cors",headers:{Accept:"application/json","Content-Type":"application/json"}},"POST"===n&&(a.body=JSON.stringify(e)),t.next=10,fetch(i+r,a).then((function(t){return t.json().then((function(t){return t.message}))})).catch((function(t){console.error("\n"+t.message)}));case 10:return t.abrupt("return",t.sent);case 13:return console.error("You must provide a valid pathname to request resources from "+i),t.abrupt("return");case 15:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"processSocketMessage",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=JSON.parse(e);if(n.msg)if("userData"===n.msg)for(var r in n.userData)this.state.data[n.username+"_userData"][r]=n.userData[r];else"gameData"===n.msg?(null==this.state.data.multiplayer[n.id]&&(this.state.data.multiplayer[n.id]={userData:{}}),this.state.data.multiplayer[n.id].userData?n.userData.forEach((function(e,r){var i=t.state.data.multiplayer[n.id].userData[e.username];if(null!=i){var a=function(t){null==i.latest[t]&&(i.latest[t]=null),i.latest[t]=e[t],e[t].constructor==Object&&Object.keys(e[t]).forEach((function(n){null==i.history[t]?i.history[t]=e[t]:i.history[t][n].push(e[t][n])}))};for(var o in e)a(o)}else t.state.data.multiplayer[n.id].userData[e.username]={latest:{},history:e}})):this.state.data.multiplayer[n.id].userData={},this.state.data.multiplayer[n.id].spectators=n.spectators,this.state.data.multiplayer[n.id].usernames=n.usernames,this.state.data.multiplayer[n.id].t=Date.now()):"getUserDataResult"===n.msg||"getUsersResult"===n.msg||"getGameDataResult"===n.msg||"getGameInfoResult"===n.msg||"getGamesResult"===n.msg?this.state.data.commandResult=n:"gameCreated"===n.msg?(this.state.data.commandResult=n,this.info.auth.appname=n.gameInfo.id):"subscribedToUser"===n.msg||"userNotFound"===n.msg||"subscribedToGame"===n.msg||"leftGame"===n.msg||"gameDeleted"===n.msg||"unsubscribed"===n.msg||"gameNotFound"===n.msg?this.state.data.commandResult=n:"resetUsername"===n.msg?this.info.auth.username=n.username:"ping"===n.msg||console.log(n);else console.log(e)}},{key:"setupWebSocket",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.info.auth,n=null,r=["username&"+e.username,"password&"+e.password,"appname&"+e.appname];if("http:"===location.protocol)n=new WebSocket("ws://"+e.url.host,r);else{if("https:"!==location.protocol)return void console.log("invalid protocol");n=new WebSocket("wss://"+e.url.host,r)}return n.onerror=function(){console.log("error")},n.onopen=function(){console.log("socket opened")},n.onmessage=function(e){t.processSocketMessage(e.data)},n.onclose=function(t){console.log("close")},n}},{key:"subscribeToUser",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.info.auth.username,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){};if(null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({username:this.info.auth.username,cmd:["getUserData",e]})),n.forEach((function(n){var r=n;Array.isArray(r)&&(r=n.join("_")),t.state.data[e+"_"+r]=null}));var a=this.state.subscribe("commandResult",(function(o){"object"===fr(o)&&("getUserDataResult"===o.msg?(o.username===e&&t.socket.send(JSON.stringify({username:t.info.auth.username,cmd:["subscribeToUser",r,e,n]})),i(o),t.state.unsubscribe("commandResult",a)):"userNotFound"===o.msg&&o.username===e&&(t.state.unsubscribe("commandResult",a),console.log("User not found: ",e)))}))}}},{key:"unsubscribeFromUser",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.info.auth.username,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){};if(null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({cmd:["unsubscribeFromUser",r,e,n],username:this.info.auth.username}));var a=this.state.subscribe("commandResult",(function(n){if("unsubscribed"===n.msg&&n.username===e){for(var r in t.state.data)r.indexOf(e)>-1&&(t.state.unsubscribeAll(r),t.state.data[r]=void 0);i(n),t.state.unsubscribe("commandResult",a)}}))}}},{key:"getGames",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.info.auth.appname,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){};if(null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({username:this.info.auth.username,cmd:["getGames",e]}));var r=this.state.subscribe("commandResult",(function(i){"object"===fr(i)?"getGamesResult"===i.msg&&i.appname===e&&(console.log(i.gameInfo),n(i),t.state.unsubscribe("commandResult",r)):"gameNotFound"===i.msg&i.appname===e&&(t.state.unsubscribe("commandResult",r),console.log("Game not found: ",e))}))}}},{key:"subscribeToGame",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.info.auth.appname,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.info.auth.username,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){};if(console.log(this.info.auth.username),null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({username:this.info.auth.username,cmd:["getGameInfo",e]}));var a=this.state.subscribe("commandResult",(function(o){if("object"===fr(o))if("getGameInfoResult"===o.msg&&o.gameInfo.id===e){var s=!0;if(!1===n){var c=[];o.gameInfo.propnames.forEach((function(t){c.push(t.split("_"))})),s=t.configureStreamForGame(o.gameInfo.devices,c)}if(!0===s){t.socket.send(JSON.stringify({username:t.info.auth.username,cmd:["subscribeToGame",r,e,n]}));var u={};o.gameInfo.usernames.forEach((function(t){u[t]={latest:{},history:{}},o.gameInfo.propnames.forEach((function(e){u[t].latest[e]=null,u[t].history[e]=null}))})),t.state.data.multiplayer=vr({},o.gameInfo.id,{usernames:[],spectators:[],userData:u}),i(o)}t.state.unsubscribe("commandResult",a)}else"gameNotFound"===o.msg&o.appname===e&&(t.state.unsubscribe("commandResult",a),console.log("Game not found: ",e))}))}}},{key:"unsubscribeFromGame",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){};if(null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({cmd:["leaveGame",e],username:this.info.auth.username}));var r=this.state.subscribe("commandResult",(function(i){if("leftGame"===i.msg&&i.appname===e){for(var a in t.state.data)a.indexOf(e)>-1&&(t.state.unsubscribeAll(a),t.state.data[a]=void 0);n(i),t.state.unsubscribe("commandResult",r)}}))}}},{key:"configureStreamForGame",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=[];n.forEach((function(t,e){void 0===t[2]?r.push([t[0],t[1],"all"]):r.push(lr(t))}));var i=!1;return e.forEach((function(e,n){t.devices.find((function(n,a){if(n.info.deviceType===e){null===n.socket&&(n.socket=t.socket);var o=[];if(r.forEach((function(t){t[0].indexOf(n.info.deviceType)>-1&&("eeg"===n.info.deviceType?n.atlas.data.eegshared.eegChannelTags.find((function(e){if(e.tag===t[1]||e.ch===t[1])return o.push(t),!0})):o.push(t))})),o.length>0)return n.info.streamParams=o,!1===n.info.streaming&&(n.info.streaming=!0,n.streamLoop()),i=!0,!0}}))})),!!i||(console.error("Compatible device not found"),!1)}},{key:"sendWSCommand",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null!=this.socket&&1===this.socket.readyState){var n={cmd:t,username:this.info.auth.username};Object.assign(n,e);var r=JSON.stringify(n);console.log("Message sent: ",r),this.socket.send(r)}}},{key:"closeSocket",value:function(){this.socket.close()}},{key:"onconnectionLost",value:function(t){var e=!1;this.info.connections.find((function(n,r){if(n.username===t.username)return e=!0,!0})),!0===e&&(this.info.connections.splice(0,1),this.info.nDevices--)}},{key:"checkURL",value:function(t){return"/"!==t.slice(-1)&&(t+="/"),t}},{key:"checkPathname",value:function(t){return"/"===t.slice(0)&&t.splice(0,1),t}}]),t}(),wr=function(){var t=this;this.onconnected=function(){},this.ondisconnected=function(){},this.getDeviceData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eeg",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.devices.forEach((function(t,i){if(console.log("get"),t.info.deviceType.indexOf(e)>-1&&t.info.deviceNum===r)return"all"===n?t.atlas.data[e]:t.atlas.getDeviceDataByTag(e,n)}))},this.subscribe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eeg",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FP1",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){},a=void 0,o=n,s=null;return e.indexOf("eeg")>-1||e.indexOf("muse")>-1||e.indexOf("notion")>-1?(s="eeg","shared"===o&&(o="eeghared")):e.indexOf("heg")>-1&&(s="heg","shared"===o&&(o="hegshared")),null!==s&&t.devices.find((function(n,c){if(n.info.deviceName.indexOf(e)>-1&&!0===n.info.useAtlas){var u=void 0;return"string"==typeof o?o.indexOf("shared")>-1&&(u=n.atlas.getDeviceDataByTag(o,null)):u=null===o||"all"===o?n.atlas.data[s]:n.atlas.getDeviceDataByTag(s,o),void 0!==u&&(null===r||Array.isArray(u)||"object"!==fr(u[r])?a=t.state.addToState(o,u,i):"object"===fr(u[r])&&(a=t.state.addToState(o+"_"+r,u[r],i))),!0}})),a},this.unsubscribe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FP1",n=arguments.length>1?arguments[1]:void 0;t.state.unsubscribe(e,n)},this.unsubscribeAll=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FP1";t.state.unsubscribeAll(e)},this.makeGameBrowser=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){},a=Math.floor(1e6*Math.random())+e,o="<div id='"+a+"'><button id='"+a+"search'>Search</button><table id='"+a+"browser'></table></div>";("string"==typeof n||n instanceof String)&&(n=document.getElementById(n)),n.insertAdjacentHTML("beforeend",o),document.getElementById(a+"search").onclick=function(){t.getGames(e,(function(e){var n="";e.gameInfo.forEach((function(t){n+="<tr><td>"+t.id+"</td><td>"+t.usernames.length+"</td><td><button id='"+t.id+"connect'>Connect</button>Spectate:<input id='"+a+"spectate' type='checkbox'></td></tr>"})),document.getElementById(a+"browser").insertAdjacentHTML("afterbegin",n),e.gameInfo.forEach((function(e){document.getElementById(e.id+"connect").onclick=function(){t.subscribeToGame(e.id,document.getElementById(a+"spectate").checked,void 0,(function(n){r(e),document.getElementById(a).insertAdjacentHTML("afterbegin","<button id='"+a+"disconnect'>Disconnect</button>"),document.getElementById(a+"disconnect").onclick=function(){t.unsubscribeFromGame(e.id,(function(){i(e);var t=document.getElementById(a+"disconnect");t.parentNode.removeChild(t)}))}}))}}))}))}},this.kickPlayerFromGame=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){};if(null!==t.socket&&1===t.socket.readyState){t.socket.send({cmd:["leaveGame",e,n],username:t.info.auth.username});var i=t.state.subscribe("commandResult",(function(a){if("leftGame"===a.msg&&a.appname===e){for(var o in t.state.data)o.indexOf(n)>-1&&(t.state.unsubscribeAll(o),t.state.data[o]=void 0);r(a),t.state.unsubscribe("commandResult",i)}}))}}},Cr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"freeeeg32_2",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["eegfft"],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{username:"guest"};mr(this,t),Sr.call(this),this.info={deviceName:e,deviceType:null,streaming:a,streamParams:s,analysis:n,deviceNum:0,streamLoopTiming:100,streamCt:0,auth:c,sps:null,useFilters:r,useAtlas:!1,simulating:!1},this.device=null,this.deviceConfigs=[{name:"freeeeg32",cls:Y},{name:"muse",cls:nt},{name:"hegduino",cls:yt},{name:"cyton",cls:Dt},{name:"webgazer",cls:Mt},{name:"ganglion",cls:ur}],this.socket=o,this.streamTable=[],this.filters=[],this.atlas=null,this.pipeToAtlas=i}return yr(t,[{key:"onconnect",value:function(){}},{key:"ondisconnect",value:function(){}},{key:"configureDefaultStreamTable",value:function(){var t,e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=n;if(!0!==e.info.useAtlas);else{var i=!1;if(void 0!==(i="number"==typeof t?e.atlas.getEEGDataByChannel(t):e.atlas.getEEGDataByTag(t))){if("all"===r){if(0===i.count)return;if(r=i.count-i.lastRead,i.lastRead=i.count,0===r)return}if(i.filtered.length>0){var a=i.times.slice(i.times.length-r,i.times.length),o=i.filtered.slice(i.filtered.length-r,i.filtered.length);return{times:a,samples:o}}if(i.raw.length>0){var s=i.times.slice(i.times.length-r,i.times.length),c=i.raw.slice(i.raw.length-r,i.raw.length);return{times:s,samples:c}}return}}},i=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=n;if(!0!==e.info.useAtlas);else{var i=!1;if(void 0!==(i="number"==typeof t?e.atlas.getEEGFFTData(t):e.atlas.getEEGDataByTag(t))){if("all"===r){if(0===i.fftCount)return;if(r=i.fftCount-i.lastReadFFT,i.lastReadFFT=i.fftCount,0===r)return}var a=i.fftTimes.slice(i.fftTimes.length-r,i.fftTimes.length),o=i.ffts.slice(i.ffts.length-r,i.ffts.length);return{times:a,ffts:o}}}},a=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=n;if(!0!==e.info.useAtlas);else{console.log(t);var i=e.atlas.getCoherenceByTag(t);if(void 0!==i){if("all"===r){if(0===i.fftCount)return;if(r=i.fftCount-i.lastRead,i.lastRead=i.fftCount,0===r)return}var a=i.times.slice(i.fftTimes.length-r,i.fftTimes.length),o=i.ffts.slice(i.ffts.length-r,i.ffts.length);return{times:a,ffts:o}}}},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=n;if(!0!==e.info.useAtlas);else{var a=e.atlas.getDeviceDataByTag("heg",t);if("all"===i&&(i=a.count-a.lastRead,a.lastRead=a.count,i<=0))return;if(void 0!==a){if(void 0!==r){var o=a.times.slice(a.times.length-i,a.times.length),s=a[r].slice(a.ffts.length-i,a.ffts.length),c={times:o};return c[r]=s,c}return a}}};this.streamTable=[{prop:"eegch",callback:r},{prop:"eegfft",callback:i},{prop:"eegcoherence",callback:a},{prop:"hegdata",callback:o}],n.length>0&&(t=this.streamTable).push.apply(t,lr(n))}},{key:"addStreamFunc",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.streamTable.push({prop:t,callback:e})}},{key:"configureStreamParams",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[["prop","tag"]],e=[];t.forEach((function(t,n){e.push(t.join("_"))})),this.socket.send(JSON.stringify({cmd:["addProps",e],username:this.info.auth.username}))}},{key:"simulateData",value:function(){var t=this;if(!0===this.info.simulating){for(var e=Math.floor(100*this.info.sps/1e3),n=0;n<e;n++);"undefined"==typeof window?setTimeout((function(){t.simulateData}),100):setTimeout(requestAnimationFrame(this.simulateData),100)}}}]),t}(),Sr=function(){var t=this;this.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.info,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.pipeToAtlas;t.deviceConfigs.find((function(r,i){if(e.deviceName.indexOf(r.name)>-1)return t.device=new r.cls(e.deviceName,t.onconnect,t.ondisconnect),t.device.init(e,n),t.atlas=t.device.atlas,t.filters=t.device.filters,null!==t.atlas&&(t.pipeToAtlas=!0,t.configureDefaultStreamTable(),!0===t.info.streaming&&t.streamLoop()),!0}))},this.connect=function(){t.device.connect()},this.disconnect=function(){t.device.disconnect()},this.sendDataToSocket=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[["prop","tag","arg1"]],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={username:t.info.auth.username,userData:{}};Object.assign(r.userData,n),e.forEach((function(e,n){t.streamTable.find((function(t,n){if(e[0].indexOf(t.prop)>-1){var i=e.slice(1),a=t.callback.apply(t,lr(i));return void 0!==a&&(r.userData[e.join("_")]=a),!0}}))})),Object.keys(r.userData).length>0&&t.socket.send(JSON.stringify(r))},this.streamLoop=function(){if(!0===t.info.streaming){var e=[];if(0===t.info.streamParams.length)return console.error("No stream parameters set"),!1;t.info.streamParams.forEach((function(n,r){t.streamTable.find((function(t,r){if(t.prop===n[0])return e.push(n),!0}))})),e.length>0&&t.sendDataToSocket(e),t.info.streamCt++,setTimeout((function(){t.streamLoop()}),t.info.streamLoopTiming)}else t.info.streamCt=0}}})(),r})()}));