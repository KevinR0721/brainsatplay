/*! For license information please see brainsatplay.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.brainsatplay=t():e.brainsatplay=t()}(this,(function(){return(()=>{var e={7187:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,r){function i(){void 0!==s&&e.removeListener("error",s),n([].slice.call(arguments))}var s;"error"!==t&&(s=function(n){e.removeListener(t,i),r(n)},e.once("error",s)),e.once(t,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,s,a,c;if(o(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]),void 0===a)a=s[t]=n,++e._eventsCount;else if("function"==typeof a?a=s[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=u(e))>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,c=l,console&&console.warn&&console.warn(c)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):f(i,i.length)}function d(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var u=s[e];if(void 0===u)return!1;if("function"==typeof u)r(u,this,t);else{var c=u.length,l=f(u,c);for(n=0;n<c;++n)r(l[n],this,t)}return!0},s.prototype.addListener=function(e,t){return c(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return c(this,e,t,!0)},s.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,s,a;if(o(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){a=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return p(this,e,!0)},s.prototype.rawListeners=function(e){return p(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},s.prototype.listenerCount=d,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},6123:e=>{!function(t){const n=2*Math.PI;var r;r=function(e,t){var r=Math.random(),i=Math.random(),s=Math.sqrt(-2*Math.log(r))*Math.cos(n*i);return Math.sqrt(-2*Math.log(r)),Math.sin(n*i),s*t+e},e.exports=r}()},1481:(e,t,n)=>{!function(t){const r=n(6123);var i=function(e){var t=Math.abs(e),n=1/(1+t/2),r=n*Math.exp(-t*t-1.26551223+n*(1.00002368+n*(.37409196+n*(.09678418+n*(n*(.27886807+n*(n*(1.48851587+n*(.17087277*n-.82215223))-1.13520398))-.18628806)))));return e>=0?r:2-r},s=function(e,t){if(t<=0)throw new Error("Variance must be > 0 (but was "+t+")");this.mean=e,this.variance=t,this.standardDeviation=Math.sqrt(t)};s.prototype.pdf=function(e){var t=this.standardDeviation*Math.sqrt(2*Math.PI);return Math.exp(-Math.pow(e-this.mean,2)/(2*this.variance))/t},s.prototype.cdf=function(e){return.5*i(-(e-this.mean)/(this.standardDeviation*Math.sqrt(2)))},s.prototype.ppf=function(e){return this.mean-this.standardDeviation*Math.sqrt(2)*function(e){if(e>=2)return-100;if(e<=0)return 100;for(var t=e<1?e:2-e,n=Math.sqrt(-2*Math.log(t/2)),r=-.70711*((2.30753+.27061*n)/(1+n*(.99229+.04481*n))-n),s=0;s<2;s++){var a=i(r)-t;r+=a/(1.1283791670955126*Math.exp(-r*r)-r*a)}return e<1?r:-r}(2*e)},s.prototype.mul=function(e){if("number"==typeof e)return this.scale(e);var t=1/this.variance,n=1/e.variance;return u(t+n,t*this.mean+n*e.mean)},s.prototype.div=function(e){if("number"==typeof e)return this.scale(1/e);var t=1/this.variance,n=1/e.variance;return u(t-n,t*this.mean-n*e.mean)},s.prototype.add=function(e){return o(this.mean+e.mean,this.variance+e.variance)},s.prototype.sub=function(e){return o(this.mean-e.mean,this.variance+e.variance)},s.prototype.scale=function(e){return o(this.mean*e,this.variance*e*e)},s.prototype.random=function(e){let t=this.mean,n=this.standardDeviation;return Array(e).fill(0).map((()=>r(t,n)))};var a,o=function(e,t){return new s(e,t)},u=function(e,t){return o(t/e,1/e)};a=o,e.exports=a}()},9985:e=>{e.exports=function e(t,n,r){function i(a,o){if(!n[a]){if(!t[a]){if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,(function(e){return i(t[a][1][e]||e)}),c,c.exports,e,t,n,r)}return n[a].exports}for(var s=void 0,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){var r;r=this,function(e){"use strict";var t={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},n="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",r={5:n,"5module":n+" export import",6:n+" const class extends export import super"},i=/^in(stanceof)?$/,s="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࢽऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿯ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞿꟂ-Ᶎꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭧꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",a="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ංඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",o=new RegExp("["+s+"]"),u=new RegExp("["+s+a+"]");s=a=null;var c=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,477,28,11,0,9,21,155,22,13,52,76,44,33,24,27,35,30,0,12,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,0,33,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,0,161,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,270,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,754,9486,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,15,7472,3104,541],l=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,525,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,4,9,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,232,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,792487,239];function h(e,t){for(var n=65536,r=0;r<t.length;r+=2){if((n+=t[r])>e)return!1;if((n+=t[r+1])>=e)return!0}}function p(e,t){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&o.test(String.fromCharCode(e)):!1!==t&&h(e,c)))}function d(e,t){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&u.test(String.fromCharCode(e)):!1!==t&&(h(e,c)||h(e,l)))))}var f=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function m(e,t){return new f(e,{beforeExpr:!0,binop:t})}var g={beforeExpr:!0},y={startsExpr:!0},v={};function b(e,t){return void 0===t&&(t={}),t.keyword=e,v[e]=new f(e,t)}var x={num:new f("num",y),regexp:new f("regexp",y),string:new f("string",y),name:new f("name",y),eof:new f("eof"),bracketL:new f("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new f("]"),braceL:new f("{",{beforeExpr:!0,startsExpr:!0}),braceR:new f("}"),parenL:new f("(",{beforeExpr:!0,startsExpr:!0}),parenR:new f(")"),comma:new f(",",g),semi:new f(";",g),colon:new f(":",g),dot:new f("."),question:new f("?",g),arrow:new f("=>",g),template:new f("template"),invalidTemplate:new f("invalidTemplate"),ellipsis:new f("...",g),backQuote:new f("`",y),dollarBraceL:new f("${",{beforeExpr:!0,startsExpr:!0}),eq:new f("=",{beforeExpr:!0,isAssign:!0}),assign:new f("_=",{beforeExpr:!0,isAssign:!0}),incDec:new f("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new f("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:m("||",1),logicalAND:m("&&",2),bitwiseOR:m("|",3),bitwiseXOR:m("^",4),bitwiseAND:m("&",5),equality:m("==/!=/===/!==",6),relational:m("</>/<=/>=",7),bitShift:m("<</>>/>>>",8),plusMin:new f("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:m("%",10),star:m("*",10),slash:m("/",10),starstar:new f("**",{beforeExpr:!0}),_break:b("break"),_case:b("case",g),_catch:b("catch"),_continue:b("continue"),_debugger:b("debugger"),_default:b("default",g),_do:b("do",{isLoop:!0,beforeExpr:!0}),_else:b("else",g),_finally:b("finally"),_for:b("for",{isLoop:!0}),_function:b("function",y),_if:b("if"),_return:b("return",g),_switch:b("switch"),_throw:b("throw",g),_try:b("try"),_var:b("var"),_const:b("const"),_while:b("while",{isLoop:!0}),_with:b("with"),_new:b("new",{beforeExpr:!0,startsExpr:!0}),_this:b("this",y),_super:b("super",y),_class:b("class",y),_extends:b("extends",g),_export:b("export"),_import:b("import",y),_null:b("null",y),_true:b("true",y),_false:b("false",y),_in:b("in",{beforeExpr:!0,binop:7}),_instanceof:b("instanceof",{beforeExpr:!0,binop:7}),_typeof:b("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:b("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:b("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},w=/\r\n?|\n|\u2028|\u2029/,S=new RegExp(w.source,"g");function T(e,t){return 10===e||13===e||!t&&(8232===e||8233===e)}var C=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,A=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,_=Object.prototype,k=_.hasOwnProperty,I=_.toString;function E(e,t){return k.call(e,t)}var O=Array.isArray||function(e){return"[object Array]"===I.call(e)};function D(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}var B=function(e,t){this.line=e,this.column=t};B.prototype.offset=function(e){return new B(this.line,this.column+e)};var P=function(e,t,n){this.start=t,this.end=n,null!==e.sourceFile&&(this.source=e.sourceFile)};function F(e,t){for(var n=1,r=0;;){S.lastIndex=r;var i=S.exec(e);if(!(i&&i.index<t))return new B(n,t-r);++n,r=i.index+i[0].length}}var N={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function R(e){var t={};for(var n in N)t[n]=e&&E(e,n)?e[n]:N[n];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),O(t.onToken)){var r=t.onToken;t.onToken=function(e){return r.push(e)}}return O(t.onComment)&&(t.onComment=function(e,t){return function(n,r,i,s,a,o){var u={type:n?"Block":"Line",value:r,start:i,end:s};e.locations&&(u.loc=new P(this,a,o)),e.ranges&&(u.range=[i,s]),t.push(u)}}(t,t.onComment)),t}function L(e,t){return 2|(e?4:0)|(t?8:0)}var M=function(e,n,i){this.options=e=R(e),this.sourceFile=e.sourceFile,this.keywords=D(r[e.ecmaVersion>=6?6:"module"===e.sourceType?"5module":5]);var s="";if(!0!==e.allowReserved){for(var a=e.ecmaVersion;!(s=t[a]);a--);"module"===e.sourceType&&(s+=" await")}this.reservedWords=D(s);var o=(s?s+" ":"")+t.strict;this.reservedWordsStrict=D(o),this.reservedWordsStrictBind=D(o+" "+t.strictBind),this.input=String(n),this.containsEsc=!1,i?(this.pos=i,this.lineStart=this.input.lastIndexOf("\n",i-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(w).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=x.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null},z={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};M.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)},z.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},z.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0},z.inAsync.get=function(){return(4&this.currentVarScope().flags)>0},z.allowSuper.get=function(){return(64&this.currentThisScope().flags)>0},z.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},z.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},M.prototype.inNonArrowFunction=function(){return(2&this.currentThisScope().flags)>0},M.extend=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var n=this,r=0;r<e.length;r++)n=e[r](n);return n},M.parse=function(e,t){return new this(t,e).parse()},M.parseExpressionAt=function(e,t,n){var r=new this(n,e,t);return r.nextToken(),r.parseExpression()},M.tokenizer=function(e,t){return new this(t,e)},Object.defineProperties(M.prototype,z);var $=M.prototype,V=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)")/;function G(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}$.strictDirective=function(e){for(;;){A.lastIndex=e,e+=A.exec(this.input)[0].length;var t=V.exec(this.input.slice(e));if(!t)return!1;if("use strict"===(t[1]||t[2]))return!0;e+=t[0].length,A.lastIndex=e,e+=A.exec(this.input)[0].length,";"===this.input[e]&&e++}},$.eat=function(e){return this.type===e&&(this.next(),!0)},$.isContextual=function(e){return this.type===x.name&&this.value===e&&!this.containsEsc},$.eatContextual=function(e){return!!this.isContextual(e)&&(this.next(),!0)},$.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},$.canInsertSemicolon=function(){return this.type===x.eof||this.type===x.braceR||w.test(this.input.slice(this.lastTokEnd,this.start))},$.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},$.semicolon=function(){this.eat(x.semi)||this.insertSemicolon()||this.unexpected()},$.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},$.expect=function(e){this.eat(e)||this.unexpected()},$.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")},$.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var n=t?e.parenthesizedAssign:e.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},$.checkExpressionErrors=function(e,t){if(!e)return!1;var n=e.shorthandAssign,r=e.doubleProto;if(!t)return n>=0||r>=0;n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property")},$.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},$.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var U=M.prototype;U.parseTopLevel=function(e){var t={};for(e.body||(e.body=[]);this.type!==x.eof;){var n=this.parseStatement(null,!0,t);e.body.push(n)}if(this.inModule)for(var r=0,i=Object.keys(this.undefinedExports);r<i.length;r+=1){var s=i[r];this.raiseRecoverable(this.undefinedExports[s].start,"Export '"+s+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var K={kind:"loop"},j={kind:"switch"};U.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;A.lastIndex=this.pos;var t=A.exec(this.input),n=this.pos+t[0].length,r=this.input.charCodeAt(n);if(91===r)return!0;if(e)return!1;if(123===r)return!0;if(p(r,!0)){for(var s=n+1;d(this.input.charCodeAt(s),!0);)++s;var a=this.input.slice(n,s);if(!i.test(a))return!0}return!1},U.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;A.lastIndex=this.pos;var e=A.exec(this.input),t=this.pos+e[0].length;return!(w.test(this.input.slice(this.pos,t))||"function"!==this.input.slice(t,t+8)||t+8!==this.input.length&&d(this.input.charAt(t+8)))},U.parseStatement=function(e,t,n){var r,i=this.type,s=this.startNode();switch(this.isLet(e)&&(i=x._var,r="let"),i){case x._break:case x._continue:return this.parseBreakContinueStatement(s,i.keyword);case x._debugger:return this.parseDebuggerStatement(s);case x._do:return this.parseDoStatement(s);case x._for:return this.parseForStatement(s);case x._function:return e&&(this.strict||"if"!==e&&"label"!==e)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(s,!1,!e);case x._class:return e&&this.unexpected(),this.parseClass(s,!0);case x._if:return this.parseIfStatement(s);case x._return:return this.parseReturnStatement(s);case x._switch:return this.parseSwitchStatement(s);case x._throw:return this.parseThrowStatement(s);case x._try:return this.parseTryStatement(s);case x._const:case x._var:return r=r||this.value,e&&"var"!==r&&this.unexpected(),this.parseVarStatement(s,r);case x._while:return this.parseWhileStatement(s);case x._with:return this.parseWithStatement(s);case x.braceL:return this.parseBlock(!0,s);case x.semi:return this.parseEmptyStatement(s);case x._export:case x._import:if(this.options.ecmaVersion>10&&i===x._import){A.lastIndex=this.pos;var a=A.exec(this.input),o=this.pos+a[0].length;if(40===this.input.charCodeAt(o))return this.parseExpressionStatement(s,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===x._import?this.parseImport(s):this.parseExport(s,n);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(s,!0,!e);var u=this.value,c=this.parseExpression();return i===x.name&&"Identifier"===c.type&&this.eat(x.colon)?this.parseLabeledStatement(s,u,c,e):this.parseExpressionStatement(s,c)}},U.parseBreakContinueStatement=function(e,t){var n="break"===t;this.next(),this.eat(x.semi)||this.insertSemicolon()?e.label=null:this.type!==x.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var i=this.labels[r];if(null==e.label||i.name===e.label.name){if(null!=i.kind&&(n||"loop"===i.kind))break;if(e.label&&n)break}}return r===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,n?"BreakStatement":"ContinueStatement")},U.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},U.parseDoStatement=function(e){return this.next(),this.labels.push(K),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(x._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(x.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},U.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(K),this.enterScope(0),this.expect(x.parenL),this.type===x.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var n=this.isLet();if(this.type===x._var||this.type===x._const||n){var r=this.startNode(),i=n?"let":this.value;return this.next(),this.parseVar(r,!0,i),this.finishNode(r,"VariableDeclaration"),(this.type===x._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===r.declarations.length?(this.options.ecmaVersion>=9&&(this.type===x._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,r)):(t>-1&&this.unexpected(t),this.parseFor(e,r))}var s=new G,a=this.parseExpression(!0,s);return this.type===x._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===x._in?t>-1&&this.unexpected(t):e.await=t>-1),this.toAssignable(a,!1,s),this.checkLVal(a),this.parseForIn(e,a)):(this.checkExpressionErrors(s,!0),t>-1&&this.unexpected(t),this.parseFor(e,a))},U.parseFunctionStatement=function(e,t,n){return this.next(),this.parseFunction(e,H|(n?0:q),!1,t)},U.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(x._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")},U.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(x.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},U.parseSwitchStatement=function(e){var t;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(x.braceL),this.labels.push(j),this.enterScope(0);for(var n=!1;this.type!==x.braceR;)if(this.type===x._case||this.type===x._default){var r=this.type===x._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),r?t.test=this.parseExpression():(n&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),n=!0,t.test=null),this.expect(x.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},U.parseThrowStatement=function(e){return this.next(),w.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var W=[];U.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===x._catch){var t=this.startNode();if(this.next(),this.eat(x.parenL)){t.param=this.parseBindingAtom();var n="Identifier"===t.param.type;this.enterScope(n?32:0),this.checkLVal(t.param,n?4:2),this.expect(x.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0);t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(x._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},U.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},U.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(K),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")},U.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")},U.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},U.parseLabeledStatement=function(e,t,n,r){for(var i=0,s=this.labels;i<s.length;i+=1)s[i].name===t&&this.raise(n.start,"Label '"+t+"' is already declared");for(var a=this.type.isLoop?"loop":this.type===x._switch?"switch":null,o=this.labels.length-1;o>=0;o--){var u=this.labels[o];if(u.statementStart!==e.start)break;u.statementStart=this.start,u.kind=a}return this.labels.push({name:t,kind:a,statementStart:this.start}),e.body=this.parseStatement(r?-1===r.indexOf("label")?r+"label":r:"label"),this.labels.pop(),e.label=n,this.finishNode(e,"LabeledStatement")},U.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},U.parseBlock=function(e,t){for(void 0===e&&(e=!0),void 0===t&&(t=this.startNode()),t.body=[],this.expect(x.braceL),e&&this.enterScope(0);!this.eat(x.braceR);){var n=this.parseStatement(null);t.body.push(n)}return e&&this.exitScope(),this.finishNode(t,"BlockStatement")},U.parseFor=function(e,t){return e.init=t,this.expect(x.semi),e.test=this.type===x.semi?null:this.parseExpression(),this.expect(x.semi),e.update=this.type===x.parenR?null:this.parseExpression(),this.expect(x.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")},U.parseForIn=function(e,t){var n=this.type===x._in;return this.next(),"VariableDeclaration"===t.type&&null!=t.declarations[0].init&&(!n||this.options.ecmaVersion<8||this.strict||"var"!==t.kind||"Identifier"!==t.declarations[0].id.type)?this.raise(t.start,(n?"for-in":"for-of")+" loop variable declaration may not have an initializer"):"AssignmentPattern"===t.type&&this.raise(t.start,"Invalid left-hand side in for-loop"),e.left=t,e.right=n?this.parseExpression():this.parseMaybeAssign(),this.expect(x.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,n?"ForInStatement":"ForOfStatement")},U.parseVar=function(e,t,n){for(e.declarations=[],e.kind=n;;){var r=this.startNode();if(this.parseVarId(r,n),this.eat(x.eq)?r.init=this.parseMaybeAssign(t):"const"!==n||this.type===x._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===r.id.type||t&&(this.type===x._in||this.isContextual("of"))?r.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),e.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(x.comma))break}return e},U.parseVarId=function(e,t){e.id=this.parseBindingAtom(),this.checkLVal(e.id,"var"===t?1:2,!1)};var H=1,q=2;U.parseFunction=function(e,t,n,r){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(this.type===x.star&&t&q&&this.unexpected(),e.generator=this.eat(x.star)),this.options.ecmaVersion>=8&&(e.async=!!r),t&H&&(e.id=4&t&&this.type!==x.name?null:this.parseIdent(),!e.id||t&q||this.checkLVal(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?1:2:3));var i=this.yieldPos,s=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(L(e.async,e.generator)),t&H||(e.id=this.type===x.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,n,!1),this.yieldPos=i,this.awaitPos=s,this.awaitIdentPos=a,this.finishNode(e,t&H?"FunctionDeclaration":"FunctionExpression")},U.parseFunctionParams=function(e){this.expect(x.parenL),e.params=this.parseBindingList(x.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},U.parseClass=function(e,t){this.next();var n=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);var r=this.startNode(),i=!1;for(r.body=[],this.expect(x.braceL);!this.eat(x.braceR);){var s=this.parseClassElement(null!==e.superClass);s&&(r.body.push(s),"MethodDefinition"===s.type&&"constructor"===s.kind&&(i&&this.raise(s.start,"Duplicate constructor in the same class"),i=!0))}return e.body=this.finishNode(r,"ClassBody"),this.strict=n,this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},U.parseClassElement=function(e){var t=this;if(this.eat(x.semi))return null;var n=this.startNode(),r=function(e,r){void 0===r&&(r=!1);var i=t.start,s=t.startLoc;return!(!t.eatContextual(e)||(t.type===x.parenL||r&&t.canInsertSemicolon())&&(n.key&&t.unexpected(),n.computed=!1,n.key=t.startNodeAt(i,s),n.key.name=e,t.finishNode(n.key,"Identifier"),1))};n.kind="method",n.static=r("static");var i=this.eat(x.star),s=!1;i||(this.options.ecmaVersion>=8&&r("async",!0)?(s=!0,i=this.options.ecmaVersion>=9&&this.eat(x.star)):r("get")?n.kind="get":r("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var a=n.key,o=!1;return n.computed||n.static||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?n.static&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),i&&this.raise(a.start,"Constructor can't be a generator"),s&&this.raise(a.start,"Constructor can't be an async method"),n.kind="constructor",o=e),this.parseClassMethod(n,i,s,o),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},U.parseClassMethod=function(e,t,n,r){return e.value=this.parseMethod(t,n,r),this.finishNode(e,"MethodDefinition")},U.parseClassId=function(e,t){this.type===x.name?(e.id=this.parseIdent(),t&&this.checkLVal(e.id,2,!1)):(!0===t&&this.unexpected(),e.id=null)},U.parseClassSuper=function(e){e.superClass=this.eat(x._extends)?this.parseExprSubscripts():null},U.parseExport=function(e,t){if(this.next(),this.eat(x.star))return this.expectContextual("from"),this.type!==x.string&&this.unexpected(),e.source=this.parseExprAtom(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(x._default)){var n;if(this.checkExport(t,"default",this.lastTokStart),this.type===x._function||(n=this.isAsyncFunction())){var r=this.startNode();this.next(),n&&this.next(),e.declaration=this.parseFunction(r,4|H,!1,n)}else if(this.type===x._class){var i=this.startNode();e.declaration=this.parseClass(i,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==x.string&&this.unexpected(),e.source=this.parseExprAtom();else{for(var s=0,a=e.specifiers;s<a.length;s+=1){var o=a[s];this.checkUnreserved(o.local),this.checkLocalExport(o.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},U.checkExport=function(e,t,n){e&&(E(e,t)&&this.raiseRecoverable(n,"Duplicate export '"+t+"'"),e[t]=!0)},U.checkPatternExport=function(e,t){var n=t.type;if("Identifier"===n)this.checkExport(e,t.name,t.start);else if("ObjectPattern"===n)for(var r=0,i=t.properties;r<i.length;r+=1){var s=i[r];this.checkPatternExport(e,s)}else if("ArrayPattern"===n)for(var a=0,o=t.elements;a<o.length;a+=1){var u=o[a];u&&this.checkPatternExport(e,u)}else"Property"===n?this.checkPatternExport(e,t.value):"AssignmentPattern"===n?this.checkPatternExport(e,t.left):"RestElement"===n?this.checkPatternExport(e,t.argument):"ParenthesizedExpression"===n&&this.checkPatternExport(e,t.expression)},U.checkVariableExport=function(e,t){if(e)for(var n=0,r=t;n<r.length;n+=1){var i=r[n];this.checkPatternExport(e,i.id)}},U.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},U.parseExportSpecifiers=function(e){var t=[],n=!0;for(this.expect(x.braceL);!this.eat(x.braceR);){if(n)n=!1;else if(this.expect(x.comma),this.afterTrailingComma(x.braceR))break;var r=this.startNode();r.local=this.parseIdent(!0),r.exported=this.eatContextual("as")?this.parseIdent(!0):r.local,this.checkExport(e,r.exported.name,r.exported.start),t.push(this.finishNode(r,"ExportSpecifier"))}return t},U.parseImport=function(e){return this.next(),this.type===x.string?(e.specifiers=W,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===x.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},U.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===x.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,2),e.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(x.comma))return e}if(this.type===x.star){var r=this.startNode();return this.next(),this.expectContextual("as"),r.local=this.parseIdent(),this.checkLVal(r.local,2),e.push(this.finishNode(r,"ImportNamespaceSpecifier")),e}for(this.expect(x.braceL);!this.eat(x.braceR);){if(t)t=!1;else if(this.expect(x.comma),this.afterTrailingComma(x.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,2),e.push(this.finishNode(i,"ImportSpecifier"))}return e},U.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},U.isDirectiveCandidate=function(e){return"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"==typeof e.expression.value&&('"'===this.input[e.start]||"'"===this.input[e.start])};var X=M.prototype;X.toAssignable=function(e,t,n){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var r=0,i=e.properties;r<i.length;r+=1){var s=i[r];this.toAssignable(s,t),"RestElement"!==s.type||"ArrayPattern"!==s.argument.type&&"ObjectPattern"!==s.argument.type||this.raise(s.argument.start,"Unexpected token")}break;case"Property":"init"!==e.kind&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),"AssignmentPattern"===e.argument.type&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==e.operator&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,t,n);break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return e},X.toAssignableList=function(e,t){for(var n=e.length,r=0;r<n;r++){var i=e[r];i&&this.toAssignable(i,t)}if(n){var s=e[n-1];6===this.options.ecmaVersion&&t&&s&&"RestElement"===s.type&&"Identifier"!==s.argument.type&&this.unexpected(s.argument.start)}return e},X.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},X.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==x.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},X.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case x.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(x.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case x.braceL:return this.parseObj(!0)}return this.parseIdent()},X.parseBindingList=function(e,t,n){for(var r=[],i=!0;!this.eat(e);)if(i?i=!1:this.expect(x.comma),t&&this.type===x.comma)r.push(null);else{if(n&&this.afterTrailingComma(e))break;if(this.type===x.ellipsis){var s=this.parseRestBinding();this.parseBindingListItem(s),r.push(s),this.type===x.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),r.push(a)}return r},X.parseBindingListItem=function(e){return e},X.parseMaybeDefault=function(e,t,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(x.eq))return n;var r=this.startNodeAt(e,t);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},X.checkLVal=function(e,t,n){switch(void 0===t&&(t=0),e.type){case"Identifier":2===t&&"let"===e.name&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(E(n,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),n[e.name]=!0),0!==t&&5!==t&&this.declareName(e.name,t,e.start);break;case"MemberExpression":t&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ObjectPattern":for(var r=0,i=e.properties;r<i.length;r+=1){var s=i[r];this.checkLVal(s,t,n)}break;case"Property":this.checkLVal(e.value,t,n);break;case"ArrayPattern":for(var a=0,o=e.elements;a<o.length;a+=1){var u=o[a];u&&this.checkLVal(u,t,n)}break;case"AssignmentPattern":this.checkLVal(e.left,t,n);break;case"RestElement":this.checkLVal(e.argument,t,n);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,n);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var Z=M.prototype;Z.checkPropClash=function(e,t,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===e.type||this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var r,i=e.key;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var s=e.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===s&&(t.proto&&(n?n.doubleProto<0&&(n.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),t.proto=!0);else{var a=t[r="$"+r];a?("init"===s?this.strict&&a.init||a.get||a.set:a.init||a[s])&&this.raiseRecoverable(i.start,"Redefinition of property"):a=t[r]={init:!1,get:!1,set:!1},a[s]=!0}}},Z.parseExpression=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeAssign(e,t);if(this.type===x.comma){var s=this.startNodeAt(n,r);for(s.expressions=[i];this.eat(x.comma);)s.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(s,"SequenceExpression")}return i},Z.parseMaybeAssign=function(e,t,n){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var r=!1,i=-1,s=-1;t?(i=t.parenthesizedAssign,s=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new G,r=!0);var a=this.start,o=this.startLoc;this.type!==x.parenL&&this.type!==x.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(e,t);if(n&&(u=n.call(this,u,a,o)),this.type.isAssign){var c=this.startNodeAt(a,o);return c.operator=this.value,c.left=this.type===x.eq?this.toAssignable(u,!1,t):u,r||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=c.left.start&&(t.shorthandAssign=-1),this.checkLVal(u),this.next(),c.right=this.parseMaybeAssign(e),this.finishNode(c,"AssignmentExpression")}return r&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),s>-1&&(t.trailingComma=s),u},Z.parseMaybeConditional=function(e,t){var n=this.start,r=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(x.question)){var s=this.startNodeAt(n,r);return s.test=i,s.consequent=this.parseMaybeAssign(),this.expect(x.colon),s.alternate=this.parseMaybeAssign(e),this.finishNode(s,"ConditionalExpression")}return i},Z.parseExprOps=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)||i.start===n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,e)},Z.parseExprOp=function(e,t,n,r,i){var s=this.type.binop;if(null!=s&&(!i||this.type!==x._in)&&s>r){var a=this.type===x.logicalOR||this.type===x.logicalAND,o=this.value;this.next();var u=this.start,c=this.startLoc,l=this.parseExprOp(this.parseMaybeUnary(null,!1),u,c,s,i),h=this.buildBinary(t,n,e,l,o,a);return this.parseExprOp(h,t,n,r,i)}return e},Z.buildBinary=function(e,t,n,r,i,s){var a=this.startNodeAt(e,t);return a.left=n,a.operator=i,a.right=r,this.finishNode(a,s?"LogicalExpression":"BinaryExpression")},Z.parseMaybeUnary=function(e,t){var n,r=this.start,i=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))n=this.parseAwait(),t=!0;else if(this.type.prefix){var s=this.startNode(),a=this.type===x.incDec;s.operator=this.value,s.prefix=!0,this.next(),s.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),a?this.checkLVal(s.argument):this.strict&&"delete"===s.operator&&"Identifier"===s.argument.type?this.raiseRecoverable(s.start,"Deleting local variable in strict mode"):t=!0,n=this.finishNode(s,a?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var o=this.startNodeAt(r,i);o.operator=this.value,o.prefix=!1,o.argument=n,this.checkLVal(n),this.next(),n=this.finishNode(o,"UpdateExpression")}}return!t&&this.eat(x.starstar)?this.buildBinary(r,i,n,this.parseMaybeUnary(null,!1),"**",!1):n},Z.parseExprSubscripts=function(e){var t=this.start,n=this.startLoc,r=this.parseExprAtom(e);if("ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return r;var i=this.parseSubscripts(r,t,n);return e&&"MemberExpression"===i.type&&(e.parenthesizedAssign>=i.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=i.start&&(e.parenthesizedBind=-1)),i},Z.parseSubscripts=function(e,t,n,r){for(var i=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&"async"===this.input.slice(e.start,e.end);;){var s=this.parseSubscript(e,t,n,r,i);if(s===e||"ArrowFunctionExpression"===s.type)return s;e=s}},Z.parseSubscript=function(e,t,n,r,i){var s=this.eat(x.bracketL);if(s||this.eat(x.dot)){var a=this.startNodeAt(t,n);a.object=e,a.property=s?this.parseExpression():this.parseIdent("never"!==this.options.allowReserved),a.computed=!!s,s&&this.expect(x.bracketR),e=this.finishNode(a,"MemberExpression")}else if(!r&&this.eat(x.parenL)){var o=new G,u=this.yieldPos,c=this.awaitPos,l=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var h=this.parseExprList(x.parenR,this.options.ecmaVersion>=8,!1,o);if(i&&!this.canInsertSemicolon()&&this.eat(x.arrow))return this.checkPatternErrors(o,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=u,this.awaitPos=c,this.awaitIdentPos=l,this.parseArrowExpression(this.startNodeAt(t,n),h,!0);this.checkExpressionErrors(o,!0),this.yieldPos=u||this.yieldPos,this.awaitPos=c||this.awaitPos,this.awaitIdentPos=l||this.awaitIdentPos;var p=this.startNodeAt(t,n);p.callee=e,p.arguments=h,e=this.finishNode(p,"CallExpression")}else if(this.type===x.backQuote){var d=this.startNodeAt(t,n);d.tag=e,d.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(d,"TaggedTemplateExpression")}return e},Z.parseExprAtom=function(e){this.type===x.slash&&this.readRegexp();var t,n=this.potentialArrowAt===this.start;switch(this.type){case x._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),t=this.startNode(),this.next(),this.type!==x.parenL||this.allowDirectSuper||this.raise(t.start,"super() call outside constructor of a subclass"),this.type!==x.dot&&this.type!==x.bracketL&&this.type!==x.parenL&&this.unexpected(),this.finishNode(t,"Super");case x._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case x.name:var r=this.start,i=this.startLoc,s=this.containsEsc,a=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!s&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(x._function))return this.parseFunction(this.startNodeAt(r,i),0,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(x.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===x.name&&!s)return a=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(x.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[a],!0)}return a;case x.regexp:var o=this.value;return(t=this.parseLiteral(o.value)).regex={pattern:o.pattern,flags:o.flags},t;case x.num:case x.string:return this.parseLiteral(this.value);case x._null:case x._true:case x._false:return(t=this.startNode()).value=this.type===x._null?null:this.type===x._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case x.parenL:var u=this.start,c=this.parseParenAndDistinguishExpression(n);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(c)&&(e.parenthesizedAssign=u),e.parenthesizedBind<0&&(e.parenthesizedBind=u)),c;case x.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(x.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case x.braceL:return this.parseObj(!1,e);case x._function:return t=this.startNode(),this.next(),this.parseFunction(t,0);case x._class:return this.parseClass(this.startNode(),!1);case x._new:return this.parseNew();case x.backQuote:return this.parseTemplate();case x._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Z.parseExprImport=function(){var e=this.startNode();switch(this.next(),this.type){case x.parenL:return this.parseDynamicImport(e);default:this.unexpected()}},Z.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),!this.eat(x.parenR)){var t=this.start;this.eat(x.comma)&&this.eat(x.parenR)?this.raiseRecoverable(t,"Trailing comma is not allowed in import()"):this.unexpected(t)}return this.finishNode(e,"ImportExpression")},Z.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),110===t.raw.charCodeAt(t.raw.length-1)&&(t.bigint=t.raw.slice(0,-1)),this.next(),this.finishNode(t,"Literal")},Z.parseParenExpression=function(){this.expect(x.parenL);var e=this.parseExpression();return this.expect(x.parenR),e},Z.parseParenAndDistinguishExpression=function(e){var t,n=this.start,r=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var s,a=this.start,o=this.startLoc,u=[],c=!0,l=!1,h=new G,p=this.yieldPos,d=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==x.parenR;){if(c?c=!1:this.expect(x.comma),i&&this.afterTrailingComma(x.parenR,!0)){l=!0;break}if(this.type===x.ellipsis){s=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===x.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}u.push(this.parseMaybeAssign(!1,h,this.parseParenItem))}var f=this.start,m=this.startLoc;if(this.expect(x.parenR),e&&!this.canInsertSemicolon()&&this.eat(x.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=p,this.awaitPos=d,this.parseParenArrowList(n,r,u);u.length&&!l||this.unexpected(this.lastTokStart),s&&this.unexpected(s),this.checkExpressionErrors(h,!0),this.yieldPos=p||this.yieldPos,this.awaitPos=d||this.awaitPos,u.length>1?((t=this.startNodeAt(a,o)).expressions=u,this.finishNodeAt(t,"SequenceExpression",f,m)):t=u[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var g=this.startNodeAt(n,r);return g.expression=t,this.finishNode(g,"ParenthesizedExpression")}return t},Z.parseParenItem=function(e){return e},Z.parseParenArrowList=function(e,t,n){return this.parseArrowExpression(this.startNodeAt(e,t),n)};var Y=[];Z.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(x.dot)){e.meta=t;var n=this.containsEsc;return e.property=this.parseIdent(!0),("target"!==e.property.name||n)&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is new.target"),this.inNonArrowFunction()||this.raiseRecoverable(e.start,"new.target can only be used in functions"),this.finishNode(e,"MetaProperty")}var r=this.start,i=this.startLoc,s=this.type===x._import;return e.callee=this.parseSubscripts(this.parseExprAtom(),r,i,!0),s&&"ImportExpression"===e.callee.type&&this.raise(r,"Cannot use new with import()"),this.eat(x.parenL)?e.arguments=this.parseExprList(x.parenR,this.options.ecmaVersion>=8,!1):e.arguments=Y,this.finishNode(e,"NewExpression")},Z.parseTemplateElement=function(e){var t=e.isTagged,n=this.startNode();return this.type===x.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===x.backQuote,this.finishNode(n,"TemplateElement")},Z.parseTemplate=function(e){void 0===e&&(e={});var t=e.isTagged;void 0===t&&(t=!1);var n=this.startNode();this.next(),n.expressions=[];var r=this.parseTemplateElement({isTagged:t});for(n.quasis=[r];!r.tail;)this.type===x.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(x.dollarBraceL),n.expressions.push(this.parseExpression()),this.expect(x.braceR),n.quasis.push(r=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(n,"TemplateLiteral")},Z.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===x.name||this.type===x.num||this.type===x.string||this.type===x.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===x.star)&&!w.test(this.input.slice(this.lastTokEnd,this.start))},Z.parseObj=function(e,t){var n=this.startNode(),r=!0,i={};for(n.properties=[],this.next();!this.eat(x.braceR);){if(r)r=!1;else if(this.expect(x.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(x.braceR))break;var s=this.parseProperty(e,t);e||this.checkPropClash(s,i,t),n.properties.push(s)}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")},Z.parseProperty=function(e,t){var n,r,i,s,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(x.ellipsis))return e?(a.argument=this.parseIdent(!1),this.type===x.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===x.parenL&&t&&(t.parenthesizedAssign<0&&(t.parenthesizedAssign=this.start),t.parenthesizedBind<0&&(t.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,t),this.type===x.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(e||t)&&(i=this.start,s=this.startLoc),e||(n=this.eat(x.star)));var o=this.containsEsc;return this.parsePropertyName(a),!e&&!o&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(a)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(x.star),this.parsePropertyName(a,t)):r=!1,this.parsePropertyValue(a,e,n,r,i,s,t,o),this.finishNode(a,"Property")},Z.parsePropertyValue=function(e,t,n,r,i,s,a,o){if((n||r)&&this.type===x.colon&&this.unexpected(),this.eat(x.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===x.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(n,r);else if(t||o||!(this.options.ecmaVersion>=5)||e.computed||"Identifier"!==e.key.type||"get"!==e.key.name&&"set"!==e.key.name||this.type===x.comma||this.type===x.braceR)this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?((n||r)&&this.unexpected(),this.checkUnreserved(e.key),"await"!==e.key.name||this.awaitIdentPos||(this.awaitIdentPos=i),e.kind="init",t?e.value=this.parseMaybeDefault(i,s,e.key):this.type===x.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,s,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var u="get"===e.kind?0:1;if(e.value.params.length!==u){var c=e.value.start;"get"===e.kind?this.raiseRecoverable(c,"getter should have no params"):this.raiseRecoverable(c,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}},Z.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(x.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(x.bracketR),e.key;e.computed=!1}return e.key=this.type===x.num||this.type===x.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},Z.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},Z.parseMethod=function(e,t,n){var r=this.startNode(),i=this.yieldPos,s=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=e),this.options.ecmaVersion>=8&&(r.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|L(t,r.generator)|(n?128:0)),this.expect(x.parenL),r.params=this.parseBindingList(x.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1,!0),this.yieldPos=i,this.awaitPos=s,this.awaitIdentPos=a,this.finishNode(r,"FunctionExpression")},Z.parseArrowExpression=function(e,t,n){var r=this.yieldPos,i=this.awaitPos,s=this.awaitIdentPos;return this.enterScope(16|L(n,!1)),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1),this.yieldPos=r,this.awaitPos=i,this.awaitIdentPos=s,this.finishNode(e,"ArrowFunctionExpression")},Z.parseFunctionBody=function(e,t,n){var r=t&&this.type!==x.braceL,i=this.strict,s=!1;if(r)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);i&&!a||(s=this.strictDirective(this.end))&&a&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list");var o=this.labels;this.labels=[],s&&(this.strict=!0),this.checkParams(e,!i&&!s&&!t&&!n&&this.isSimpleParamList(e.params)),e.body=this.parseBlock(!1),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=o}this.exitScope(),this.strict&&e.id&&this.checkLVal(e.id,5),this.strict=i},Z.isSimpleParamList=function(e){for(var t=0,n=e;t<n.length;t+=1)if("Identifier"!==n[t].type)return!1;return!0},Z.checkParams=function(e,t){for(var n={},r=0,i=e.params;r<i.length;r+=1){var s=i[r];this.checkLVal(s,1,t?null:n)}},Z.parseExprList=function(e,t,n,r){for(var i=[],s=!0;!this.eat(e);){if(s)s=!1;else if(this.expect(x.comma),t&&this.afterTrailingComma(e))break;var a=void 0;n&&this.type===x.comma?a=null:this.type===x.ellipsis?(a=this.parseSpread(r),r&&this.type===x.comma&&r.trailingComma<0&&(r.trailingComma=this.start)):a=this.parseMaybeAssign(!1,r),i.push(a)}return i},Z.checkUnreserved=function(e){var t=e.start,n=e.end,r=e.name;this.inGenerator&&"yield"===r&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(r)&&this.raise(t,"Unexpected keyword '"+r+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(t,n).indexOf("\\")||(this.strict?this.reservedWordsStrict:this.reservedWords).test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+r+"' is reserved"))},Z.parseIdent=function(e,t){var n=this.startNode();return this.type===x.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(!!e),this.finishNode(n,"Identifier"),e||(this.checkUnreserved(n),"await"!==n.name||this.awaitIdentPos||(this.awaitIdentPos=n.start)),n},Z.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===x.semi||this.canInsertSemicolon()||this.type!==x.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(x.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,"YieldExpression")},Z.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!1),this.finishNode(e,"AwaitExpression")};var Q=M.prototype;Q.raise=function(e,t){var n=F(this.input,e);t+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(t);throw r.pos=e,r.loc=n,r.raisedAt=this.pos,r},Q.raiseRecoverable=Q.raise,Q.curPosition=function(){if(this.options.locations)return new B(this.curLine,this.pos-this.lineStart)};var J=M.prototype,ee=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[]};J.enterScope=function(e){this.scopeStack.push(new ee(e))},J.exitScope=function(){this.scopeStack.pop()},J.treatFunctionsAsVarInScope=function(e){return 2&e.flags||!this.inModule&&1&e.flags},J.declareName=function(e,t,n){var r=!1;if(2===t){var i=this.currentScope();r=i.lexical.indexOf(e)>-1||i.functions.indexOf(e)>-1||i.var.indexOf(e)>-1,i.lexical.push(e),this.inModule&&1&i.flags&&delete this.undefinedExports[e]}else if(4===t)this.currentScope().lexical.push(e);else if(3===t){var s=this.currentScope();r=this.treatFunctionsAsVar?s.lexical.indexOf(e)>-1:s.lexical.indexOf(e)>-1||s.var.indexOf(e)>-1,s.functions.push(e)}else for(var a=this.scopeStack.length-1;a>=0;--a){var o=this.scopeStack[a];if(o.lexical.indexOf(e)>-1&&!(32&o.flags&&o.lexical[0]===e)||!this.treatFunctionsAsVarInScope(o)&&o.functions.indexOf(e)>-1){r=!0;break}if(o.var.push(e),this.inModule&&1&o.flags&&delete this.undefinedExports[e],3&o.flags)break}r&&this.raiseRecoverable(n,"Identifier '"+e+"' has already been declared")},J.checkLocalExport=function(e){-1===this.scopeStack[0].lexical.indexOf(e.name)&&-1===this.scopeStack[0].var.indexOf(e.name)&&(this.undefinedExports[e.name]=e)},J.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},J.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(3&t.flags)return t}},J.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(3&t.flags&&!(16&t.flags))return t}};var te=function(e,t,n){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new P(e,n)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},ne=M.prototype;function re(e,t,n,r){return e.type=t,e.end=n,this.options.locations&&(e.loc.end=r),this.options.ranges&&(e.range[1]=n),e}ne.startNode=function(){return new te(this,this.start,this.startLoc)},ne.startNodeAt=function(e,t){return new te(this,e,t)},ne.finishNode=function(e,t){return re.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},ne.finishNodeAt=function(e,t,n,r){return re.call(this,e,t,n,r)};var ie=function(e,t,n,r,i){this.token=e,this.isExpr=!!t,this.preserveSpace=!!n,this.override=r,this.generator=!!i},se={b_stat:new ie("{",!1),b_expr:new ie("{",!0),b_tmpl:new ie("${",!1),p_stat:new ie("(",!1),p_expr:new ie("(",!0),q_tmpl:new ie("`",!0,!0,(function(e){return e.tryReadTemplateToken()})),f_stat:new ie("function",!1),f_expr:new ie("function",!0),f_expr_gen:new ie("function",!0,!1,null,!0),f_gen:new ie("function",!1,!1,null,!0)},ae=M.prototype;ae.initialContext=function(){return[se.b_stat]},ae.braceIsBlock=function(e){var t=this.curContext();return t===se.f_expr||t===se.f_stat||(e!==x.colon||t!==se.b_stat&&t!==se.b_expr?e===x._return||e===x.name&&this.exprAllowed?w.test(this.input.slice(this.lastTokEnd,this.start)):e===x._else||e===x.semi||e===x.eof||e===x.parenR||e===x.arrow||(e===x.braceL?t===se.b_stat:e!==x._var&&e!==x._const&&e!==x.name&&!this.exprAllowed):!t.isExpr)},ae.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if("function"===t.token)return t.generator}return!1},ae.updateContext=function(e){var t,n=this.type;n.keyword&&e===x.dot?this.exprAllowed=!1:(t=n.updateContext)?t.call(this,e):this.exprAllowed=n.beforeExpr},x.parenR.updateContext=x.braceR.updateContext=function(){if(1!==this.context.length){var e=this.context.pop();e===se.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr}else this.exprAllowed=!0},x.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?se.b_stat:se.b_expr),this.exprAllowed=!0},x.dollarBraceL.updateContext=function(){this.context.push(se.b_tmpl),this.exprAllowed=!0},x.parenL.updateContext=function(e){var t=e===x._if||e===x._for||e===x._with||e===x._while;this.context.push(t?se.p_stat:se.p_expr),this.exprAllowed=!0},x.incDec.updateContext=function(){},x._function.updateContext=x._class.updateContext=function(e){!e.beforeExpr||e===x.semi||e===x._else||e===x._return&&w.test(this.input.slice(this.lastTokEnd,this.start))||(e===x.colon||e===x.braceL)&&this.curContext()===se.b_stat?this.context.push(se.f_stat):this.context.push(se.f_expr),this.exprAllowed=!1},x.backQuote.updateContext=function(){this.curContext()===se.q_tmpl?this.context.pop():this.context.push(se.q_tmpl),this.exprAllowed=!1},x.star.updateContext=function(e){if(e===x._function){var t=this.context.length-1;this.context[t]===se.f_expr?this.context[t]=se.f_expr_gen:this.context[t]=se.f_gen}this.exprAllowed=!0},x.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==x.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var oe="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ue=oe+" Extended_Pictographic",ce={9:oe,10:ue,11:ue},le="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",he="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",pe=he+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",de={9:he,10:pe,11:pe+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho"},fe={};function me(e){var t=fe[e]={binary:D(ce[e]+" "+le),nonBinary:{General_Category:D(le),Script:D(de[e])}};t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}me(9),me(10),me(11);var ge=M.prototype,ye=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":""),this.unicodeProperties=fe[e.options.ecmaVersion>=11?11:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function ve(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function be(e){return 36===e||e>=40&&e<=43||46===e||63===e||e>=91&&e<=94||e>=123&&e<=125}function xe(e){return e>=65&&e<=90||e>=97&&e<=122}function we(e){return xe(e)||95===e}function Se(e){return we(e)||Te(e)}function Te(e){return e>=48&&e<=57}function Ce(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function Ae(e){return e>=65&&e<=70?e-65+10:e>=97&&e<=102?e-97+10:e-48}function _e(e){return e>=48&&e<=55}ye.prototype.reset=function(e,t,n){var r=-1!==n.indexOf("u");this.start=0|e,this.source=t+"",this.flags=n,this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchN=r&&this.parser.options.ecmaVersion>=9},ye.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)},ye.prototype.at=function(e){var t=this.source,n=t.length;if(e>=n)return-1;var r=t.charCodeAt(e);if(!this.switchU||r<=55295||r>=57344||e+1>=n)return r;var i=t.charCodeAt(e+1);return i>=56320&&i<=57343?(r<<10)+i-56613888:r},ye.prototype.nextIndex=function(e){var t=this.source,n=t.length;if(e>=n)return n;var r,i=t.charCodeAt(e);return!this.switchU||i<=55295||i>=57344||e+1>=n||(r=t.charCodeAt(e+1))<56320||r>57343?e+1:e+2},ye.prototype.current=function(){return this.at(this.pos)},ye.prototype.lookahead=function(){return this.at(this.nextIndex(this.pos))},ye.prototype.advance=function(){this.pos=this.nextIndex(this.pos)},ye.prototype.eat=function(e){return this.current()===e&&(this.advance(),!0)},ge.validateRegExpFlags=function(e){for(var t=e.validFlags,n=e.flags,r=0;r<n.length;r++){var i=n.charAt(r);-1===t.indexOf(i)&&this.raise(e.start,"Invalid regular expression flag"),n.indexOf(i,r+1)>-1&&this.raise(e.start,"Duplicate regular expression flag")}},ge.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))},ge.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,n=e.backReferenceNames;t<n.length;t+=1){var r=n[t];-1===e.groupNames.indexOf(r)&&e.raise("Invalid named capture referenced")}},ge.regexp_disjunction=function(e){for(this.regexp_alternative(e);e.eat(124);)this.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},ge.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},ge.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):!!(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))&&(this.regexp_eatQuantifier(e),!0)},ge.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!n,!0}return e.pos=t,!1},ge.regexp_eatQuantifier=function(e,t){return void 0===t&&(t=!1),!!this.regexp_eatQuantifierPrefix(e,t)&&(e.eat(63),!0)},ge.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},ge.regexp_eatBracedQuantifier=function(e,t){var n=e.pos;if(e.eat(123)){var r=0,i=-1;if(this.regexp_eatDecimalDigits(e)&&(r=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue),e.eat(125)))return-1!==i&&i<r&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=n}return!1},ge.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},ge.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},ge.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=t}return!1},ge.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):63===e.current()&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},ge.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},ge.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},ge.regexp_eatSyntaxCharacter=function(e){var t=e.current();return!!be(t)&&(e.lastIntValue=t,e.advance(),!0)},ge.regexp_eatPatternCharacters=function(e){for(var t=e.pos,n=0;-1!==(n=e.current())&&!be(n);)e.advance();return e.pos!==t},ge.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return!(-1===t||36===t||t>=40&&t<=43||46===t||63===t||91===t||94===t||124===t||(e.advance(),0))},ge.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e))return-1!==e.groupNames.indexOf(e.lastStringValue)&&e.raise("Duplicate capture group name"),void e.groupNames.push(e.lastStringValue);e.raise("Invalid group")}},ge.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},ge.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=ve(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=ve(e.lastIntValue);return!0}return!1},ge.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,n=e.current();return e.advance(),92===n&&this.regexp_eatRegExpUnicodeEscapeSequence(e)&&(n=e.lastIntValue),function(e){return p(e,!0)||36===e||95===e}(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)},ge.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,n=e.current();return e.advance(),92===n&&this.regexp_eatRegExpUnicodeEscapeSequence(e)&&(n=e.lastIntValue),function(e){return d(e,!0)||36===e||95===e||8204===e||8205===e}(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)},ge.regexp_eatAtomEscape=function(e){return!!(this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e))||(e.switchU&&(99===e.current()&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},ge.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var n=e.lastIntValue;if(e.switchU)return n>e.maxBackReference&&(e.maxBackReference=n),!0;if(n<=e.numCapturingParens)return!0;e.pos=t}return!1},ge.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},ge.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},ge.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},ge.regexp_eatZero=function(e){return 48===e.current()&&!Te(e.lookahead())&&(e.lastIntValue=0,e.advance(),!0)},ge.regexp_eatControlEscape=function(e){var t=e.current();return 116===t?(e.lastIntValue=9,e.advance(),!0):110===t?(e.lastIntValue=10,e.advance(),!0):118===t?(e.lastIntValue=11,e.advance(),!0):102===t?(e.lastIntValue=12,e.advance(),!0):114===t&&(e.lastIntValue=13,e.advance(),!0)},ge.regexp_eatControlLetter=function(e){var t=e.current();return!!xe(t)&&(e.lastIntValue=t%32,e.advance(),!0)},ge.regexp_eatRegExpUnicodeEscapeSequence=function(e){var t,n=e.pos;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var r=e.lastIntValue;if(e.switchU&&r>=55296&&r<=56319){var i=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var s=e.lastIntValue;if(s>=56320&&s<=57343)return e.lastIntValue=1024*(r-55296)+(s-56320)+65536,!0}e.pos=i,e.lastIntValue=r}return!0}if(e.switchU&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&(t=e.lastIntValue)>=0&&t<=1114111)return!0;e.switchU&&e.raise("Invalid unicode escape"),e.pos=n}return!1},ge.regexp_eatIdentityEscape=function(e){if(e.switchU)return!!this.regexp_eatSyntaxCharacter(e)||!!e.eat(47)&&(e.lastIntValue=47,!0);var t=e.current();return!(99===t||e.switchN&&107===t||(e.lastIntValue=t,e.advance(),0))},ge.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do{e.lastIntValue=10*e.lastIntValue+(t-48),e.advance()}while((t=e.current())>=48&&t<=57);return!0}return!1},ge.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(function(e){return 100===e||68===e||115===e||83===e||119===e||87===e}(t))return e.lastIntValue=-1,e.advance(),!0;if(e.switchU&&this.options.ecmaVersion>=9&&(80===t||112===t)){if(e.lastIntValue=-1,e.advance(),e.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(e)&&e.eat(125))return!0;e.raise("Invalid property name")}return!1},ge.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var n=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var r=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,n,r),!0}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,i),!0}return!1},ge.regexp_validateUnicodePropertyNameAndValue=function(e,t,n){E(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(n)||e.raise("Invalid property value")},ge.regexp_validateUnicodePropertyNameOrValue=function(e,t){e.unicodeProperties.binary.test(t)||e.raise("Invalid property name")},ge.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";we(t=e.current());)e.lastStringValue+=ve(t),e.advance();return""!==e.lastStringValue},ge.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";Se(t=e.current());)e.lastStringValue+=ve(t),e.advance();return""!==e.lastStringValue},ge.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},ge.regexp_eatCharacterClass=function(e){if(e.eat(91)){if(e.eat(94),this.regexp_classRanges(e),e.eat(93))return!0;e.raise("Unterminated character class")}return!1},ge.regexp_classRanges=function(e){for(;this.regexp_eatClassAtom(e);){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var n=e.lastIntValue;!e.switchU||-1!==t&&-1!==n||e.raise("Invalid character class"),-1!==t&&-1!==n&&t>n&&e.raise("Range out of order in character class")}}},ge.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var n=e.current();(99===n||_e(n))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var r=e.current();return 93!==r&&(e.lastIntValue=r,e.advance(),!0)},ge.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},ge.regexp_eatClassControlLetter=function(e){var t=e.current();return!(!Te(t)&&95!==t||(e.lastIntValue=t%32,e.advance(),0))},ge.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},ge.regexp_eatDecimalDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;Te(n=e.current());)e.lastIntValue=10*e.lastIntValue+(n-48),e.advance();return e.pos!==t},ge.regexp_eatHexDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;Ce(n=e.current());)e.lastIntValue=16*e.lastIntValue+Ae(n),e.advance();return e.pos!==t},ge.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var n=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=64*t+8*n+e.lastIntValue:e.lastIntValue=8*t+n}else e.lastIntValue=t;return!0}return!1},ge.regexp_eatOctalDigit=function(e){var t=e.current();return _e(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)},ge.regexp_eatFixedHexDigits=function(e,t){var n=e.pos;e.lastIntValue=0;for(var r=0;r<t;++r){var i=e.current();if(!Ce(i))return e.pos=n,!1;e.lastIntValue=16*e.lastIntValue+Ae(i),e.advance()}return!0};var ke=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new P(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},Ie=M.prototype;function Ee(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}Ie.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new ke(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Ie.getToken=function(){return this.next(),new ke(this)},"undefined"!=typeof Symbol&&(Ie[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===x.eof,value:t}}}}),Ie.curContext=function(){return this.context[this.context.length-1]},Ie.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(x.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},Ie.readToken=function(e){return p(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},Ie.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);return e<=55295||e>=57344?e:(e<<10)+this.input.charCodeAt(this.pos+1)-56613888},Ie.skipBlockComment=function(){var e,t=this.options.onComment&&this.curPosition(),n=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(-1===r&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations)for(S.lastIndex=n;(e=S.exec(this.input))&&e.index<this.pos;)++this.curLine,this.lineStart=e.index+e[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,r),n,this.pos,t,this.curPosition())},Ie.skipLineComment=function(e){for(var t=this.pos,n=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!T(r);)r=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,n,this.curPosition())},Ie.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(!(e>8&&e<14||e>=5760&&C.test(String.fromCharCode(e))))break e;++this.pos}}},Ie.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=e,this.value=t,this.updateContext(n)},Ie.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(x.ellipsis)):(++this.pos,this.finishToken(x.dot))},Ie.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(x.assign,2):this.finishOp(x.slash,1)},Ie.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),n=1,r=42===e?x.star:x.modulo;return this.options.ecmaVersion>=7&&42===e&&42===t&&(++n,r=x.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(x.assign,n+1):this.finishOp(r,n)},Ie.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?this.finishOp(124===e?x.logicalOR:x.logicalAND,2):61===t?this.finishOp(x.assign,2):this.finishOp(124===e?x.bitwiseOR:x.bitwiseAND,1)},Ie.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(x.assign,2):this.finishOp(x.bitwiseXOR,1)},Ie.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45!==t||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!w.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(x.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===t?this.finishOp(x.assign,2):this.finishOp(x.plusMin,1)},Ie.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),n=1;return t===e?(n=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(x.assign,n+1):this.finishOp(x.bitShift,n)):33!==t||60!==e||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===t&&(n=2),this.finishOp(x.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},Ie.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(x.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(x.arrow)):this.finishOp(61===e?x.eq:x.prefix,1)},Ie.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(x.parenL);case 41:return++this.pos,this.finishToken(x.parenR);case 59:return++this.pos,this.finishToken(x.semi);case 44:return++this.pos,this.finishToken(x.comma);case 91:return++this.pos,this.finishToken(x.bracketL);case 93:return++this.pos,this.finishToken(x.bracketR);case 123:return++this.pos,this.finishToken(x.braceL);case 125:return++this.pos,this.finishToken(x.braceR);case 58:return++this.pos,this.finishToken(x.colon);case 63:return++this.pos,this.finishToken(x.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(x.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 126:return this.finishOp(x.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ee(e)+"'")},Ie.finishOp=function(e,t){var n=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,n)},Ie.readRegexp=function(){for(var e,t,n=this.pos;;){this.pos>=this.input.length&&this.raise(n,"Unterminated regular expression");var r=this.input.charAt(this.pos);if(w.test(r)&&this.raise(n,"Unterminated regular expression"),e)e=!1;else{if("["===r)t=!0;else if("]"===r&&t)t=!1;else if("/"===r&&!t)break;e="\\"===r}++this.pos}var i=this.input.slice(n,this.pos);++this.pos;var s=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(s);var o=this.regexpState||(this.regexpState=new ye(this));o.reset(n,i,a),this.validateRegExpFlags(o),this.validateRegExpPattern(o);var u=null;try{u=new RegExp(i,a)}catch(e){}return this.finishToken(x.regexp,{pattern:i,flags:a,value:u})},Ie.readInt=function(e,t){for(var n=this.pos,r=0,i=0,s=null==t?1/0:t;i<s;++i){var a,o=this.input.charCodeAt(this.pos);if((a=o>=97?o-97+10:o>=65?o-65+10:o>=48&&o<=57?o-48:1/0)>=e)break;++this.pos,r=r*e+a}return this.pos===n||null!=t&&this.pos-n!==t?null:r},Ie.readRadixNumber=function(e){var t=this.pos;this.pos+=2;var n=this.readInt(e);return null==n&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(n="undefined"!=typeof BigInt?BigInt(this.input.slice(t,this.pos)):null,++this.pos):p(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(x.num,n)},Ie.readNumber=function(e){var t=this.pos;e||null!==this.readInt(10)||this.raise(t,"Invalid number");var n=this.pos-t>=2&&48===this.input.charCodeAt(t);n&&this.strict&&this.raise(t,"Invalid number");var r=this.input.charCodeAt(this.pos);if(!n&&!e&&this.options.ecmaVersion>=11&&110===r){var i=this.input.slice(t,this.pos),s="undefined"!=typeof BigInt?BigInt(i):null;return++this.pos,p(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(x.num,s)}n&&/[89]/.test(this.input.slice(t,this.pos))&&(n=!1),46!==r||n||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||n||(43!==(r=this.input.charCodeAt(++this.pos))&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number")),p(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var a=this.input.slice(t,this.pos),o=n?parseInt(a,8):parseFloat(a);return this.finishToken(x.num,o)},Ie.readCodePoint=function(){var e;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e},Ie.readString=function(e){for(var t="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var r=this.input.charCodeAt(this.pos);if(r===e)break;92===r?(t+=this.input.slice(n,this.pos),t+=this.readEscapedChar(!1),n=this.pos):(T(r,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(n,this.pos++),this.finishToken(x.string,t)};var Oe={};Ie.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e!==Oe)throw e;this.readInvalidTemplateToken()}this.inTemplateElement=!1},Ie.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Oe;this.raise(e,t)},Ie.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var n=this.input.charCodeAt(this.pos);if(96===n||36===n&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==x.template&&this.type!==x.invalidTemplate?(e+=this.input.slice(t,this.pos),this.finishToken(x.template,e)):36===n?(this.pos+=2,this.finishToken(x.dollarBraceL)):(++this.pos,this.finishToken(x.backQuote));if(92===n)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(T(n)){switch(e+=this.input.slice(t,this.pos),++this.pos,n){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:e+="\n";break;default:e+=String.fromCharCode(n)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}},Ie.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(x.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Ie.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ee(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(e){var n=this.pos-1;return this.invalidStringToken(n,"Invalid escape sequence in template string"),null}default:if(t>=48&&t<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(r,8);return i>255&&(r=r.slice(0,-1),i=parseInt(r,8)),this.pos+=r.length-1,t=this.input.charCodeAt(this.pos),"0"===r&&56!==t&&57!==t||!this.strict&&!e||this.invalidStringToken(this.pos-1-r.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return T(t)?"":String.fromCharCode(t)}},Ie.readHexChar=function(e){var t=this.pos,n=this.readInt(16,e);return null===n&&this.invalidStringToken(t,"Bad character escape sequence"),n},Ie.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,n=this.pos,r=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(d(i,r))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,e+=this.input.slice(n,this.pos);var s=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(t?p:d)(a,r)||this.invalidStringToken(s,"Invalid Unicode escape"),e+=Ee(a),n=this.pos}t=!1}return e+this.input.slice(n,this.pos)},Ie.readWord=function(){var e=this.readWord1(),t=x.name;return this.keywords.test(e)&&(t=v[e]),this.finishToken(t,e)};var De="7.1.0";M.acorn={Parser:M,version:De,defaultOptions:N,Position:B,SourceLocation:P,getLineInfo:F,Node:te,TokenType:f,tokTypes:x,keywordTypes:v,TokContext:ie,tokContexts:se,isIdentifierChar:d,isIdentifierStart:p,Token:ke,isNewLine:T,lineBreak:w,lineBreakG:S,nonASCIIwhitespace:C},e.Node=te,e.Parser=M,e.Position=B,e.SourceLocation=P,e.TokContext=ie,e.Token=ke,e.TokenType=f,e.defaultOptions=N,e.getLineInfo=F,e.isIdentifierChar=d,e.isIdentifierStart=p,e.isNewLine=T,e.keywordTypes=v,e.lineBreak=w,e.lineBreakG=S,e.nonASCIIwhitespace=C,e.parse=function(e,t){return M.parse(e,t)},e.parseExpressionAt=function(e,t,n){return M.parseExpressionAt(e,t,n)},e.tokContexts=se,e.tokTypes=x,e.tokenizer=function(e,t){return M.tokenizer(e,t)},e.version=De,Object.defineProperty(e,"__esModule",{value:!0})}("object"==typeof n&&void 0!==t?n:(r=r||self).acorn={})},{}],2:[function(e,t,n){},{}],3:[function(e,t,n){function r(e,t={}){const{contextName:n="gl",throwGetError:r,useTrackablePrimitives:o,readPixelsFile:u,recording:c=[],variables:l={},onReadPixels:h,onUnrecognizedArgumentLookup:p}=t,d=new Proxy(e,{get:function(t,d){switch(d){case"addComment":return _;case"checkThrowError":return k;case"getReadPixelsVariableName":return g;case"insertVariable":return w;case"reset":return x;case"setIndent":return T;case"toString":return b;case"getContextVariableName":return O}return"function"==typeof e[d]?function(){switch(d){case"getError":return r?c.push(`${v}if (${n}.getError() !== ${n}.NONE) throw new Error('error');`):c.push(`${v}${n}.getError();`),e.getError();case"getExtension":{const t=`${n}Variables${f.length}`;c.push(`${v}const ${t} = ${n}.getExtension('${arguments[0]}');`);const r=e.getExtension(arguments[0]);if(r&&"object"==typeof r){const e=i(r,{getEntity:S,useTrackablePrimitives:o,recording:c,contextName:t,contextVariables:f,variables:l,indent:v,onUnrecognizedArgumentLookup:p});return f.push(e),e}return f.push(null),r}case"readPixels":const t=f.indexOf(arguments[6]);let a;if(-1===t){const e=E(arguments[6]);e?(a=e,c.push(`${v}${e}`)):(a=`${n}Variable${f.length}`,f.push(arguments[6]),c.push(`${v}const ${a} = new ${arguments[6].constructor.name}(${arguments[6].length});`))}else a=`${n}Variable${t}`;g=a;const d=[arguments[0],arguments[1],arguments[2],arguments[3],S(arguments[4]),S(arguments[5]),a];return c.push(`${v}${n}.readPixels(${d.join(", ")});`),u&&A(arguments[2],arguments[3]),h&&h(a,d),e.readPixels.apply(e,arguments);case"drawBuffers":return c.push(`${v}${n}.drawBuffers([${s(arguments[0],{contextName:n,contextVariables:f,getEntity:S,addVariable:C,variables:l,onUnrecognizedArgumentLookup:p})}]);`),e.drawBuffers(arguments[0])}let t=e[d].apply(e,arguments);switch(typeof t){case"undefined":return void c.push(`${v}${I(d,arguments)};`);case"number":case"boolean":if(o&&-1===f.indexOf(a(t))){c.push(`${v}const ${n}Variable${f.length} = ${I(d,arguments)};`),f.push(t=a(t));break}default:null===t?c.push(`${I(d,arguments)};`):c.push(`${v}const ${n}Variable${f.length} = ${I(d,arguments)};`),f.push(t)}return t}:(m[e[d]]=d,e[d])}}),f=[],m={};let g,y=0,v="";return d;function b(){return c.join("\n")}function x(){for(;c.length>0;)c.pop()}function w(e,t){l[e]=t}function S(e){const t=m[e];return t?n+"."+t:e}function T(e){v=" ".repeat(e)}function C(e,t){const r=`${n}Variable${f.length}`;return c.push(`${v}const ${r} = ${t};`),f.push(e),r}function A(e,t){const r=`${n}Variable${f.length}`,i=`imageDatum${y}`;c.push(`${v}let ${i} = ["P3\\n# ${u}.ppm\\n", ${e}, ' ', ${t}, "\\n255\\n"].join("");`),c.push(`${v}for (let i = 0; i < ${i}.length; i += 4) {`),c.push(`${v}  ${i} += ${r}[i] + ' ' + ${r}[i + 1] + ' ' + ${r}[i + 2] + ' ';`),c.push(`${v}}`),c.push(`${v}if (typeof require !== "undefined") {`),c.push(`${v}  require('fs').writeFileSync('./${u}.ppm', ${i});`),c.push(`${v}}`),y++}function _(e){c.push(`${v}// ${e}`)}function k(){c.push(`${v}(() => {\n${v}const error = ${n}.getError();\n${v}if (error !== ${n}.NONE) {\n${v}  const names = Object.getOwnPropertyNames(gl);\n${v}  for (let i = 0; i < names.length; i++) {\n${v}    const name = names[i];\n${v}    if (${n}[name] === error) {\n${v}      throw new Error('${n} threw ' + name);\n${v}    }\n${v}  }\n${v}}\n${v}})();`)}function I(e,t){return`${n}.${e}(${s(t,{contextName:n,contextVariables:f,getEntity:S,addVariable:C,variables:l,onUnrecognizedArgumentLookup:p})})`}function E(e){if(l)for(const t in l)if(l[t]===e)return t;return null}function O(e){const t=f.indexOf(e);return-1!==t?`${n}Variable${t}`:null}}function i(e,t){const n=new Proxy(e,{get:function(t,n){return"function"==typeof t[n]?function(){switch(n){case"drawBuffersWEBGL":return l.push(`${p}${i}.drawBuffersWEBGL([${s(arguments[0],{contextName:i,contextVariables:o,getEntity:f,addVariable:g,variables:h,onUnrecognizedArgumentLookup:d})}]);`),e.drawBuffersWEBGL(arguments[0])}let t=e[n].apply(e,arguments);switch(typeof t){case"undefined":return void l.push(`${p}${m(n,arguments)};`);case"number":case"boolean":c&&-1===o.indexOf(a(t))?(l.push(`${p}const ${i}Variable${o.length} = ${m(n,arguments)};`),o.push(t=a(t))):(l.push(`${p}const ${i}Variable${o.length} = ${m(n,arguments)};`),o.push(t));break;default:null===t?l.push(`${m(n,arguments)};`):l.push(`${p}const ${i}Variable${o.length} = ${m(n,arguments)};`),o.push(t)}return t}:(r[e[n]]=n,e[n])}}),r={},{contextName:i,contextVariables:o,getEntity:u,useTrackablePrimitives:c,recording:l,variables:h,indent:p,onUnrecognizedArgumentLookup:d}=t;return n;function f(e){return r.hasOwnProperty(e)?`${i}.${r[e]}`:u(e)}function m(e,t){return`${i}.${e}(${s(t,{contextName:i,contextVariables:o,getEntity:f,addVariable:g,variables:h,onUnrecognizedArgumentLookup:d})})`}function g(e,t){const n=`${i}Variable${o.length}`;return o.push(e),l.push(`${p}const ${n} = ${t};`),n}}function s(e,t){const{variables:n,onUnrecognizedArgumentLookup:r}=t;return Array.from(e).map((e=>function(e){if(n)for(const t in n)if(n.hasOwnProperty(t)&&n[t]===e)return t;return r?r(e):null}(e)||function(e,t){const{contextName:n,contextVariables:r,getEntity:i,addVariable:s,onUnrecognizedArgumentLookup:a}=t;if(void 0===e)return"undefined";if(null===e)return"null";const o=r.indexOf(e);if(o>-1)return`${n}Variable${o}`;switch(e.constructor.name){case"String":const t=/\n/.test(e),n=/'/.test(e),r=/"/.test(e);return t?"`"+e+"`":n&&!r?'"'+e+'"':"'"+e+"'";case"Number":case"Boolean":return i(e);case"Array":return s(e,`new ${e.constructor.name}([${Array.from(e).join(",")}])`);case"Float32Array":case"Uint8Array":case"Uint16Array":case"Int32Array":return s(e,`new ${e.constructor.name}(${JSON.stringify(Array.from(e))})`);default:if(a){const t=a(e);if(t)return t}throw new Error(`unrecognized argument type ${e.constructor.name}`)}}(e,t))).join(", ")}function a(e){return new e.constructor(e)}void 0!==t&&(t.exports={glWiretap:r,glExtensionWiretap:i}),"undefined"!=typeof window&&(r.glExtensionWiretap=i,window.glWiretap=r)},{}],4:[function(e,t,n){function r(e){const t=new Array(e.length);for(let n=0;n<e.length;n++){const r=e[n];r.toArray?t[n]=r.toArray():t[n]=r}return t}function i(){const e=r(arguments),t=new Float32Array(this.output.x);for(let n=0;n<this.output.x;n++)this.thread.x=n,this.thread.y=0,this.thread.z=0,t[n]=this._fn.apply(this,e);return t}function s(){const e=r(arguments),t=new Array(this.output.y);for(let n=0;n<this.output.y;n++){const r=new Float32Array(this.output.x);for(let t=0;t<this.output.x;t++)this.thread.x=t,this.thread.y=n,this.thread.z=0,r[t]=this._fn.apply(this,e);t[n]=r}return t}function a(){const e=r(arguments);for(let t=0;t<this.output.y;t++)for(let n=0;n<this.output.x;n++)this.thread.x=n,this.thread.y=t,this.thread.z=0,this._fn.apply(this,e)}function o(){const e=r(arguments),t=new Array(this.output.z);for(let n=0;n<this.output.z;n++){const r=new Array(this.output.y);for(let t=0;t<this.output.y;t++){const i=new Float32Array(this.output.x);for(let r=0;r<this.output.x;r++)this.thread.x=r,this.thread.y=t,this.thread.z=n,i[r]=this._fn.apply(this,e);r[t]=i}t[n]=r}return t}function u(e){e.setOutput=t=>{e.output=l(t),e.graphical&&c(e)},e.toJSON=()=>{throw new Error("Not usable with gpuMock")},e.setConstants=t=>(e.constants=t,e),e.setGraphical=t=>(e.graphical=t,e),e.setCanvas=t=>(e.canvas=t,e),e.setContext=t=>(e.context=t,e),e.destroy=()=>{},e.validateSettings=()=>{},e.graphical&&e.output&&c(e),e.exec=function(){return new Promise(((t,n)=>{try{t(e.apply(e,arguments))}catch(e){n(e)}}))},e.getPixels=t=>{const{x:n,y:r}=e.output;return t?function(e,t,n){const r=n/2|0,i=4*t,s=new Uint8ClampedArray(4*t),a=e.slice(0);for(let e=0;e<r;++e){const t=e*i,r=(n-e-1)*i;s.set(a.subarray(t,t+i)),a.copyWithin(t,r,r+i),a.set(s,r)}return a}(e._imageData.data,n,r):e._imageData.data.slice(0)},e.color=function(t,n,r,i){void 0===i&&(i=1),t=Math.floor(255*t),n=Math.floor(255*n),r=Math.floor(255*r),i=Math.floor(255*i);const s=e.output.x,a=e.output.y,o=e.thread.x+(a-e.thread.y-1)*s;e._colorData[4*o+0]=t,e._colorData[4*o+1]=n,e._colorData[4*o+2]=r,e._colorData[4*o+3]=i};const t=()=>e,n=["setWarnVarUsage","setArgumentTypes","setTactic","setOptimizeFloatMemory","setDebug","setLoopMaxIterations","setConstantTypes","setFunctions","setNativeFunctions","setInjectedNative","setPipeline","setPrecision","setOutputToTexture","setImmutable","setStrictIntegers","setDynamicOutput","setHardcodeConstants","setDynamicArguments","setUseLegacyEncoder","setWarnVarUsage","addSubKernel"];for(let r=0;r<n.length;r++)e[n[r]]=t;return e}function c(e){const{x:t,y:n}=e.output;if(e.context&&e.context.createImageData){const r=new Uint8ClampedArray(t*n*4);e._imageData=e.context.createImageData(t,n),e._colorData=r}else{const r=new Uint8ClampedArray(t*n*4);e._imageData={data:r},e._colorData=r}}function l(e){let t=null;if(e.length)if(3===e.length){const[n,r,i]=e;t={x:n,y:r,z:i}}else if(2===e.length){const[n,r]=e;t={x:n,y:r}}else{const[n]=e;t={x:n}}else t=e;return t}t.exports={gpuMock:function(e,t={}){const n=t.output?l(t.output):null;function r(){return r.output.z?o.apply(r,arguments):r.output.y?r.graphical?a.apply(r,arguments):s.apply(r,arguments):i.apply(r,arguments)}return r._fn=e,r.constants=t.constants||null,r.context=t.context||null,r.canvas=t.canvas||null,r.graphical=t.graphical||!1,r._imageData=null,r._colorData=null,r.output=n,r.thread={x:0,y:0,z:0},u(r)}}},{}],5:[function(e,t,n){const{utils:r}=e("./utils");t.exports={alias:function(e,t){const n=t.toString();return new Function(`return function ${e} (${r.getArgumentNamesFromString(n).join(", ")}) {\n  ${r.getFunctionBodyFromString(n)}\n}`)()}}},{"./utils":114}],6:[function(e,t,n){const{FunctionNode:r}=e("../function-node");t.exports={CPUFunctionNode:class extends r{astFunction(e,t){if(!this.isRootKernel){t.push("function"),t.push(" "),t.push(this.name),t.push("(");for(let e=0;e<this.argumentNames.length;++e){const n=this.argumentNames[e];e>0&&t.push(", "),t.push("user_"),t.push(n)}t.push(") {\n")}for(let n=0;n<e.body.body.length;++n)this.astGeneric(e.body.body[n],t),t.push("\n");return this.isRootKernel||t.push("}\n"),t}astReturnStatement(e,t){const n=this.returnType||this.getType(e.argument);return this.returnType||(this.returnType=n),this.isRootKernel?(t.push(this.leadingReturnStatement),this.astGeneric(e.argument,t),t.push(";\n"),t.push(this.followingReturnStatement),t.push("continue;\n")):this.isSubKernel?(t.push(`subKernelResult_${this.name} = `),this.astGeneric(e.argument,t),t.push(";"),t.push(`return subKernelResult_${this.name};`)):(t.push("return "),this.astGeneric(e.argument,t),t.push(";")),t}astLiteral(e,t){if(isNaN(e.value))throw this.astErrorOutput("Non-numeric literal not supported : "+e.value,e);return t.push(e.value),t}astBinaryExpression(e,t){return t.push("("),this.astGeneric(e.left,t),t.push(e.operator),this.astGeneric(e.right,t),t.push(")"),t}astIdentifierExpression(e,t){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e);switch(e.name){case"Infinity":t.push("Infinity");break;default:this.constants&&this.constants.hasOwnProperty(e.name)?t.push("constants_"+e.name):t.push("user_"+e.name)}return t}astForStatement(e,t){if("ForStatement"!==e.type)throw this.astErrorOutput("Invalid for statement",e);const n=[],r=[],i=[],s=[];let a=null;if(e.init){this.pushState("in-for-loop-init"),this.astGeneric(e.init,n);for(let e=0;e<n.length;e++)n[e].includes&&n[e].includes(",")&&(a=!1);this.popState("in-for-loop-init")}else a=!1;if(e.test?this.astGeneric(e.test,r):a=!1,e.update?this.astGeneric(e.update,i):a=!1,e.body&&(this.pushState("loop-body"),this.astGeneric(e.body,s),this.popState("loop-body")),null===a&&(a=this.isSafe(e.init)&&this.isSafe(e.test)),a)t.push(`for (${n.join("")};${r.join("")};${i.join("")}){\n`),t.push(s.join("")),t.push("}\n");else{const e=this.getInternalVariableName("safeI");n.length>0&&t.push(n.join(""),";\n"),t.push(`for (let ${e}=0;${e}<LOOP_MAX;${e}++){\n`),r.length>0&&t.push(`if (!${r.join("")}) break;\n`),t.push(s.join("")),t.push(`\n${i.join("")};`),t.push("}\n")}return t}astWhileStatement(e,t){if("WhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statement",e);return t.push("for (let i = 0; i < LOOP_MAX; i++) {"),t.push("if ("),this.astGeneric(e.test,t),t.push(") {\n"),this.astGeneric(e.body,t),t.push("} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}astDoWhileStatement(e,t){if("DoWhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statement",e);return t.push("for (let i = 0; i < LOOP_MAX; i++) {"),this.astGeneric(e.body,t),t.push("if (!"),this.astGeneric(e.test,t),t.push(") {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}astAssignmentExpression(e,t){const n=this.getDeclaration(e.left);if(n&&!n.assignable)throw this.astErrorOutput(`Variable ${e.left.name} is not assignable here`,e);return this.astGeneric(e.left,t),t.push(e.operator),this.astGeneric(e.right,t),t}astBlockStatement(e,t){if(this.isState("loop-body")){this.pushState("block-body");for(let n=0;n<e.body.length;n++)this.astGeneric(e.body[n],t);this.popState("block-body")}else{t.push("{\n");for(let n=0;n<e.body.length;n++)this.astGeneric(e.body[n],t);t.push("}\n")}return t}astVariableDeclaration(e,t){t.push(`${e.kind} `);const{declarations:n}=e;for(let e=0;e<n.length;e++){e>0&&t.push(",");const r=n[e],i=this.getDeclaration(r.id);i.valueType||(i.valueType=this.getType(r.init)),this.astGeneric(r,t)}return this.isState("in-for-loop-init")||t.push(";"),t}astIfStatement(e,t){return t.push("if ("),this.astGeneric(e.test,t),t.push(")"),"BlockStatement"===e.consequent.type?this.astGeneric(e.consequent,t):(t.push(" {\n"),this.astGeneric(e.consequent,t),t.push("\n}\n")),e.alternate&&(t.push("else "),"BlockStatement"===e.alternate.type||"IfStatement"===e.alternate.type?this.astGeneric(e.alternate,t):(t.push(" {\n"),this.astGeneric(e.alternate,t),t.push("\n}\n"))),t}astSwitchStatement(e,t){const{discriminant:n,cases:r}=e;t.push("switch ("),this.astGeneric(n,t),t.push(") {\n");for(let e=0;e<r.length;e++)null!==r[e].test?(t.push("case "),this.astGeneric(r[e].test,t),t.push(":\n"),r[e].consequent&&r[e].consequent.length>0&&(this.astGeneric(r[e].consequent,t),t.push("break;\n"))):(t.push("default:\n"),this.astGeneric(r[e].consequent,t),r[e].consequent&&r[e].consequent.length>0&&t.push("break;\n"));t.push("\n}")}astThisExpression(e,t){return t.push("_this"),t}astMemberExpression(e,t){const{signature:n,type:r,property:i,xProperty:s,yProperty:a,zProperty:o,name:u,origin:c}=this.getMemberExpressionDetails(e);switch(n){case"this.thread.value":return t.push(`_this.thread.${u}`),t;case"this.output.value":switch(u){case"x":t.push("outputX");break;case"y":t.push("outputY");break;case"z":t.push("outputZ");break;default:throw this.astErrorOutput("Unexpected expression",e)}return t;case"value":throw this.astErrorOutput("Unexpected expression",e);case"value[]":case"value[][]":case"value[][][]":case"value.value":if("Math"===c)return t.push(Math[u]),t;switch(i){case"r":return t.push(`user_${u}[0]`),t;case"g":return t.push(`user_${u}[1]`),t;case"b":return t.push(`user_${u}[2]`),t;case"a":return t.push(`user_${u}[3]`),t}break;case"this.constants.value":case"this.constants.value[]":case"this.constants.value[][]":case"this.constants.value[][][]":break;case"fn()[]":return this.astGeneric(e.object,t),t.push("["),this.astGeneric(e.property,t),t.push("]"),t;case"fn()[][]":return this.astGeneric(e.object.object,t),t.push("["),this.astGeneric(e.object.property,t),t.push("]"),t.push("["),this.astGeneric(e.property,t),t.push("]"),t;default:throw this.astErrorOutput("Unexpected expression",e)}if(!e.computed)switch(r){case"Number":case"Integer":case"Float":case"Boolean":return t.push(`${c}_${u}`),t}const l=`${c}_${u}`;switch(r){case"Array(2)":case"Array(3)":case"Array(4)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":case"HTMLImageArray":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"HTMLImage":default:let e,n;if("constants"===c){const t=this.constants[u];n="Input"===this.constantTypes[u],e=n?t.size:null}else n=this.isInput(u),e=n?this.argumentSizes[this.argumentNames.indexOf(u)]:null;t.push(`${l}`),o&&a?n?(t.push("[("),this.astGeneric(o,t),t.push(`*${this.dynamicArguments?"(outputY * outputX)":e[1]*e[0]})+(`),this.astGeneric(a,t),t.push(`*${this.dynamicArguments?"outputX":e[0]})+`),this.astGeneric(s,t),t.push("]")):(t.push("["),this.astGeneric(o,t),t.push("]"),t.push("["),this.astGeneric(a,t),t.push("]"),t.push("["),this.astGeneric(s,t),t.push("]")):a?n?(t.push("[("),this.astGeneric(a,t),t.push(`*${this.dynamicArguments?"outputX":e[0]})+`),this.astGeneric(s,t),t.push("]")):(t.push("["),this.astGeneric(a,t),t.push("]"),t.push("["),this.astGeneric(s,t),t.push("]")):void 0!==s&&(t.push("["),this.astGeneric(s,t),t.push("]"))}return t}astCallExpression(e,t){if("CallExpression"!==e.type)throw this.astErrorOutput("Unknown CallExpression",e);let n=this.astMemberExpressionUnroll(e.callee);this.calledFunctions.indexOf(n)<0&&this.calledFunctions.push(n),this.isAstMathFunction(e),this.onFunctionCall&&this.onFunctionCall(this.name,n,e.arguments),t.push(n),t.push("(");const r=this.lookupFunctionArgumentTypes(n)||[];for(let i=0;i<e.arguments.length;++i){const s=e.arguments[i];let a=this.getType(s);r[i]||this.triggerImplyArgumentType(n,i,a,this),i>0&&t.push(", "),this.astGeneric(s,t)}return t.push(")"),t}astArrayExpression(e,t){const n=this.getType(e),r=e.elements.length,i=[];for(let t=0;t<r;++t){const n=[];this.astGeneric(e.elements[t],n),i.push(n.join(""))}switch(n){case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":t.push(`[${i.join(", ")}]`);break;default:t.push(`new Float32Array([${i.join(", ")}])`)}return t}astDebuggerStatement(e,t){return t.push("debugger;"),t}}}},{"../function-node":10}],7:[function(e,t,n){const{utils:r}=e("../../utils");t.exports={cpuKernelString:function(e,t){const n=[],i=[],s=[],a=!/^function/.test(e.color.toString());if(n.push("  const { context, canvas, constants: incomingConstants } = settings;",`  const output = new Int32Array(${JSON.stringify(Array.from(e.output))});`,`  const _constantTypes = ${JSON.stringify(e.constantTypes)};`,`  const _constants = ${function(e,t){const n=[];for(const r in t){if(!t.hasOwnProperty(r))continue;const i=t[r],s=e[r];switch(i){case"Number":case"Integer":case"Float":case"Boolean":n.push(`${r}:${s}`);break;case"Array(2)":case"Array(3)":case"Array(4)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":n.push(`${r}:new ${s.constructor.name}(${JSON.stringify(Array.from(s))})`)}}return`{ ${n.join()} }`}(e.constants,e.constantTypes)};`),i.push("    constants: _constants,","    context,","    output,","    thread: {x: 0, y: 0, z: 0},"),e.graphical){n.push(`  const _imageData = context.createImageData(${e.output[0]}, ${e.output[1]});`),n.push(`  const _colorData = new Uint8ClampedArray(${e.output[0]} * ${e.output[1]} * 4);`);const t=r.flattenFunctionToString((a?"function ":"")+e.color.toString(),{thisLookup:t=>{switch(t){case"_colorData":return"_colorData";case"_imageData":return"_imageData";case"output":return"output";case"thread":return"this.thread"}return JSON.stringify(e[t])},findDependency:(e,t)=>null}),o=r.flattenFunctionToString((a?"function ":"")+e.getPixels.toString(),{thisLookup:t=>{switch(t){case"_colorData":return"_colorData";case"_imageData":return"_imageData";case"output":return"output";case"thread":return"this.thread"}return JSON.stringify(e[t])},findDependency:()=>null});i.push("    _imageData,","    _colorData,",`    color: ${t},`),s.push(`  kernel.getPixels = ${o};`)}const o=[],u=Object.keys(e.constantTypes);for(let t=0;t<u.length;t++)o.push(e.constantTypes[u]);if(-1!==e.argumentTypes.indexOf("HTMLImageArray")||-1!==o.indexOf("HTMLImageArray")){const t=r.flattenFunctionToString((a?"function ":"")+e._imageTo3DArray.toString(),{doNotDefine:["canvas"],findDependency:(t,n)=>"this"===t?(a?"function ":"")+e[n].toString():null,thisLookup:e=>{switch(e){case"canvas":return;case"context":return"context"}}});s.push(t),i.push("    _mediaTo2DArray,"),i.push("    _imageTo3DArray,")}else if(-1!==e.argumentTypes.indexOf("HTMLImage")||-1!==o.indexOf("HTMLImage")){const t=r.flattenFunctionToString((a?"function ":"")+e._mediaTo2DArray.toString(),{findDependency:(e,t)=>null,thisLookup:e=>{switch(e){case"canvas":return"settings.canvas";case"context":return"settings.context"}throw new Error("unhandled thisLookup")}});s.push(t),i.push("    _mediaTo2DArray,")}return`function(settings) {\n${n.join("\n")}\n  for (const p in _constantTypes) {\n    if (!_constantTypes.hasOwnProperty(p)) continue;\n    const type = _constantTypes[p];\n    switch (type) {\n      case 'Number':\n      case 'Integer':\n      case 'Float':\n      case 'Boolean':\n      case 'Array(2)':\n      case 'Array(3)':\n      case 'Array(4)':\n      case 'Matrix(2)':\n      case 'Matrix(3)':\n      case 'Matrix(4)':\n        if (incomingConstants.hasOwnProperty(p)) {\n          console.warn('constant ' + p + ' of type ' + type + ' cannot be resigned');\n        }\n        continue;\n    }\n    if (!incomingConstants.hasOwnProperty(p)) {\n      throw new Error('constant ' + p + ' not found');\n    }\n    _constants[p] = incomingConstants[p];\n  }\n  const kernel = (function() {\n${e._kernelString}\n  })\n    .apply({ ${i.join("\n")} });\n  ${s.join("\n")}\n  return kernel;\n}`}}},{"../../utils":114}],8:[function(e,t,n){const{Kernel:r}=e("../kernel"),{FunctionBuilder:i}=e("../function-builder"),{CPUFunctionNode:s}=e("./function-node"),{utils:a}=e("../../utils"),{cpuKernelString:o}=e("./kernel-string");t.exports={CPUKernel:class extends r{static getFeatures(){return this.features}static get features(){return Object.freeze({kernelMap:!0,isIntegerDivisionAccurate:!0})}static get isSupported(){return!0}static isContextMatch(e){return!1}static get mode(){return"cpu"}static nativeFunctionArguments(){return null}static nativeFunctionReturnType(){throw new Error(`Looking up native function return type not supported on ${this.name}`)}static combineKernels(e){return e}static getSignature(e,t){return"cpu"+(t.length>0?":"+t.join(","):"")}constructor(e,t){super(e,t),this.mergeSettings(e.settings||t),this._imageData=null,this._colorData=null,this._kernelString=null,this._prependedString=[],this.thread={x:0,y:0,z:0},this.translatedSources=null}initCanvas(){return"undefined"!=typeof document?document.createElement("canvas"):"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(0,0):void 0}initContext(){return this.canvas?this.canvas.getContext("2d"):null}initPlugins(e){return[]}validateSettings(e){if(!this.output||0===this.output.length){if(1!==e.length)throw new Error("Auto output only supported for kernels with only one input");const t=a.getVariableType(e[0],this.strictIntegers);if("Array"===t)this.output=a.getDimensions(t);else{if("NumberTexture"!==t&&"ArrayTexture(4)"!==t)throw new Error("Auto output not supported for input type: "+t);this.output=e[0].output}}if(this.graphical&&2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");this.checkOutput()}translateSource(){if(this.leadingReturnStatement=this.output.length>1?"resultX[x] = ":"result[x] = ",this.subKernels){const e=[];for(let t=0;t<this.subKernels.length;t++){const{name:n}=this.subKernels[t];e.push(this.output.length>1?`resultX_${n}[x] = subKernelResult_${n};\n`:`result_${n}[x] = subKernelResult_${n};\n`)}this.followingReturnStatement=e.join("")}const e=i.fromKernel(this,s);this.translatedSources=e.getPrototypes("kernel"),this.graphical||this.returnType||(this.returnType=e.getKernelResultType())}build(){if(this.built)return;if(this.setupConstants(),this.setupArguments(arguments),this.validateSettings(arguments),this.translateSource(),this.graphical){const{canvas:e,output:t}=this;if(!e)throw new Error("no canvas available for using graphical output");const n=t[0],r=t[1]||1;e.width=n,e.height=r,this._imageData=this.context.createImageData(n,r),this._colorData=new Uint8ClampedArray(n*r*4)}const e=this.getKernelString();this.kernelString=e,this.debug&&(console.log("Function output:"),console.log(e));try{this.run=new Function([],e).bind(this)()}catch(e){console.error("An error occurred compiling the javascript: ",e)}this.buildSignature(arguments),this.built=!0}color(e,t,n,r){void 0===r&&(r=1),e=Math.floor(255*e),t=Math.floor(255*t),n=Math.floor(255*n),r=Math.floor(255*r);const i=this.output[0],s=this.output[1],a=this.thread.x+(s-this.thread.y-1)*i;this._colorData[4*a+0]=e,this._colorData[4*a+1]=t,this._colorData[4*a+2]=n,this._colorData[4*a+3]=r}getKernelString(){if(null!==this._kernelString)return this._kernelString;let e=null,{translatedSources:t}=this;return t.length>1?t=t.filter((t=>/^function/.test(t)?t:(e=t,!1))):e=t.shift(),this._kernelString=`  const LOOP_MAX = ${this._getLoopMaxString()};\n  ${this.injectedNative||""}\n  const _this = this;\n  ${this._resultKernelHeader()}\n  ${this._processConstants()}\n  return (${this.argumentNames.map((e=>"user_"+e)).join(", ")}) => {\n    ${this._prependedString.join("")}\n    ${this._earlyThrows()}\n    ${this._processArguments()}\n    ${this.graphical?this._graphicalKernelBody(e):this._resultKernelBody(e)}\n    ${t.length>0?t.join("\n"):""}\n  };`}toString(){return o(this)}_getLoopMaxString(){return this.loopMaxIterations?` ${parseInt(this.loopMaxIterations)};`:" 1000;"}_processConstants(){if(!this.constants)return"";const e=[];for(let t in this.constants)switch(this.constantTypes[t]){case"HTMLCanvas":case"HTMLImage":case"HTMLVideo":e.push(`    const constants_${t} = this._mediaTo2DArray(this.constants.${t});\n`);break;case"HTMLImageArray":e.push(`    const constants_${t} = this._imageTo3DArray(this.constants.${t});\n`);break;case"Input":e.push(`    const constants_${t} = this.constants.${t}.value;\n`);break;default:e.push(`    const constants_${t} = this.constants.${t};\n`)}return e.join("")}_earlyThrows(){if(this.graphical)return"";if(this.immutable)return"";if(!this.pipeline)return"";const e=[];for(let t=0;t<this.argumentTypes.length;t++)"Array"===this.argumentTypes[t]&&e.push(this.argumentNames[t]);if(0===e.length)return"";const t=[];for(let n=0;n<e.length;n++){const r=e[n],i=this._mapSubKernels((e=>`user_${r} === result_${e.name}`)).join(" || ");t.push(`user_${r} === result${i?` || ${i}`:""}`)}return`if (${t.join(" || ")}) throw new Error('Source and destination arrays are the same.  Use immutable = true');`}_processArguments(){const e=[];for(let t=0;t<this.argumentTypes.length;t++){const n=`user_${this.argumentNames[t]}`;switch(this.argumentTypes[t]){case"HTMLCanvas":case"HTMLImage":case"HTMLVideo":e.push(`    ${n} = this._mediaTo2DArray(${n});\n`);break;case"HTMLImageArray":e.push(`    ${n} = this._imageTo3DArray(${n});\n`);break;case"Input":e.push(`    ${n} = ${n}.value;\n`);break;case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"NumberTexture":case"MemoryOptimizedNumberTexture":e.push(`\n    if (${n}.toArray) {\n      if (!_this.textureCache) {\n        _this.textureCache = [];\n        _this.arrayCache = [];\n      }\n      const textureIndex = _this.textureCache.indexOf(${n});\n      if (textureIndex !== -1) {\n        ${n} = _this.arrayCache[textureIndex];\n      } else {\n        _this.textureCache.push(${n});\n        ${n} = ${n}.toArray();\n        _this.arrayCache.push(${n});\n      }\n    }`)}}return e.join("")}_mediaTo2DArray(e){const t=this.canvas,n=e.width>0?e.width:e.videoWidth,r=e.height>0?e.height:e.videoHeight;t.width<n&&(t.width=n),t.height<r&&(t.height=r);const i=this.context;i.drawImage(e,0,0,n,r);const s=i.getImageData(0,0,n,r).data,a=new Array(r);let o=0;for(let e=r-1;e>=0;e--){const t=a[e]=new Array(n);for(let e=0;e<n;e++){const n=new Float32Array(4);n[0]=s[o++]/255,n[1]=s[o++]/255,n[2]=s[o++]/255,n[3]=s[o++]/255,t[e]=n}}return a}getPixels(e){const[t,n]=this.output;return e?a.flipPixels(this._imageData.data,t,n):this._imageData.data.slice(0)}_imageTo3DArray(e){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=this._mediaTo2DArray(e[n]);return t}_resultKernelHeader(){if(this.graphical)return"";if(this.immutable)return"";if(!this.pipeline)return"";switch(this.output.length){case 1:return this._mutableKernel1DResults();case 2:return this._mutableKernel2DResults();case 3:return this._mutableKernel3DResults()}}_resultKernelBody(e){switch(this.output.length){case 1:return(!this.immutable&&this.pipeline?this._resultMutableKernel1DLoop(e):this._resultImmutableKernel1DLoop(e))+this._kernelOutput();case 2:return(!this.immutable&&this.pipeline?this._resultMutableKernel2DLoop(e):this._resultImmutableKernel2DLoop(e))+this._kernelOutput();case 3:return(!this.immutable&&this.pipeline?this._resultMutableKernel3DLoop(e):this._resultImmutableKernel3DLoop(e))+this._kernelOutput();default:throw new Error("unsupported size kernel")}}_graphicalKernelBody(e){switch(this.output.length){case 2:return this._graphicalKernel2DLoop(e)+this._graphicalOutput();default:throw new Error("unsupported size kernel")}}_graphicalOutput(){return"\n    this._imageData.data.set(this._colorData);\n    this.context.putImageData(this._imageData, 0, 0);\n    return;"}_getKernelResultTypeConstructorString(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return"Float32Array";case"Array(2)":case"Array(3)":case"Array(4)":return"Array";default:if(this.graphical)return"Float32Array";throw new Error(`unhandled returnType ${this.returnType}`)}}_resultImmutableKernel1DLoop(e){const t=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const result = new ${t}(outputX);\n    ${this._mapSubKernels((e=>`const result_${e.name} = new ${t}(outputX);\n`)).join("    ")}\n    ${this._mapSubKernels((e=>`let subKernelResult_${e.name};\n`)).join("    ")}\n    for (let x = 0; x < outputX; x++) {\n      this.thread.x = x;\n      this.thread.y = 0;\n      this.thread.z = 0;\n      ${e}\n    }`}_mutableKernel1DResults(){const e=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const result = new ${e}(outputX);\n    ${this._mapSubKernels((t=>`const result_${t.name} = new ${e}(outputX);\n`)).join("    ")}\n    ${this._mapSubKernels((e=>`let subKernelResult_${e.name};\n`)).join("    ")}`}_resultMutableKernel1DLoop(e){return`  const outputX = _this.output[0];\n    for (let x = 0; x < outputX; x++) {\n      this.thread.x = x;\n      this.thread.y = 0;\n      this.thread.z = 0;\n      ${e}\n    }`}_resultImmutableKernel2DLoop(e){const t=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    const result = new Array(outputY);\n    ${this._mapSubKernels((e=>`const result_${e.name} = new Array(outputY);\n`)).join("    ")}\n    ${this._mapSubKernels((e=>`let subKernelResult_${e.name};\n`)).join("    ")}\n    for (let y = 0; y < outputY; y++) {\n      this.thread.z = 0;\n      this.thread.y = y;\n      const resultX = result[y] = new ${t}(outputX);\n      ${this._mapSubKernels((e=>`const resultX_${e.name} = result_${e.name}[y] = new ${t}(outputX);\n`)).join("")}\n      for (let x = 0; x < outputX; x++) {\n        this.thread.x = x;\n        ${e}\n      }\n    }`}_mutableKernel2DResults(){const e=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    const result = new Array(outputY);\n    ${this._mapSubKernels((e=>`const result_${e.name} = new Array(outputY);\n`)).join("    ")}\n    ${this._mapSubKernels((e=>`let subKernelResult_${e.name};\n`)).join("    ")}\n    for (let y = 0; y < outputY; y++) {\n      const resultX = result[y] = new ${e}(outputX);\n      ${this._mapSubKernels((t=>`const resultX_${t.name} = result_${t.name}[y] = new ${e}(outputX);\n`)).join("")}\n    }`}_resultMutableKernel2DLoop(e){const t=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    for (let y = 0; y < outputY; y++) {\n      this.thread.z = 0;\n      this.thread.y = y;\n      const resultX = result[y];\n      ${this._mapSubKernels((e=>`const resultX_${e.name} = result_${e.name}[y] = new ${t}(outputX);\n`)).join("")}\n      for (let x = 0; x < outputX; x++) {\n        this.thread.x = x;\n        ${e}\n      }\n    }`}_graphicalKernel2DLoop(e){return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    for (let y = 0; y < outputY; y++) {\n      this.thread.z = 0;\n      this.thread.y = y;\n      for (let x = 0; x < outputX; x++) {\n        this.thread.x = x;\n        ${e}\n      }\n    }`}_resultImmutableKernel3DLoop(e){const t=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    const outputZ = _this.output[2];\n    const result = new Array(outputZ);\n    ${this._mapSubKernels((e=>`const result_${e.name} = new Array(outputZ);\n`)).join("    ")}\n    ${this._mapSubKernels((e=>`let subKernelResult_${e.name};\n`)).join("    ")}\n    for (let z = 0; z < outputZ; z++) {\n      this.thread.z = z;\n      const resultY = result[z] = new Array(outputY);\n      ${this._mapSubKernels((e=>`const resultY_${e.name} = result_${e.name}[z] = new Array(outputY);\n`)).join("      ")}\n      for (let y = 0; y < outputY; y++) {\n        this.thread.y = y;\n        const resultX = resultY[y] = new ${t}(outputX);\n        ${this._mapSubKernels((e=>`const resultX_${e.name} = resultY_${e.name}[y] = new ${t}(outputX);\n`)).join("        ")}\n        for (let x = 0; x < outputX; x++) {\n          this.thread.x = x;\n          ${e}\n        }\n      }\n    }`}_mutableKernel3DResults(){const e=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    const outputZ = _this.output[2];\n    const result = new Array(outputZ);\n    ${this._mapSubKernels((e=>`const result_${e.name} = new Array(outputZ);\n`)).join("    ")}\n    ${this._mapSubKernels((e=>`let subKernelResult_${e.name};\n`)).join("    ")}\n    for (let z = 0; z < outputZ; z++) {\n      const resultY = result[z] = new Array(outputY);\n      ${this._mapSubKernels((e=>`const resultY_${e.name} = result_${e.name}[z] = new Array(outputY);\n`)).join("      ")}\n      for (let y = 0; y < outputY; y++) {\n        const resultX = resultY[y] = new ${e}(outputX);\n        ${this._mapSubKernels((t=>`const resultX_${t.name} = resultY_${t.name}[y] = new ${e}(outputX);\n`)).join("        ")}\n      }\n    }`}_resultMutableKernel3DLoop(e){return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    const outputZ = _this.output[2];\n    for (let z = 0; z < outputZ; z++) {\n      this.thread.z = z;\n      const resultY = result[z];\n      for (let y = 0; y < outputY; y++) {\n        this.thread.y = y;\n        const resultX = resultY[y];\n        for (let x = 0; x < outputX; x++) {\n          this.thread.x = x;\n          ${e}\n        }\n      }\n    }`}_kernelOutput(){return this.subKernels?`\n    return {\n      result: result,\n      ${this.subKernels.map((e=>`${e.property}: result_${e.name}`)).join(",\n      ")}\n    };`:"\n    return result;"}_mapSubKernels(e){return null===this.subKernels?[""]:this.subKernels.map(e)}destroy(e){e&&delete this.canvas}static destroyContext(e){}toJSON(){const e=super.toJSON();return e.functionNodes=i.fromKernel(this,s).toJSON(),e}setOutput(e){super.setOutput(e);const[t,n]=this.output;this.graphical&&(this._imageData=this.context.createImageData(t,n),this._colorData=new Uint8ClampedArray(t*n*4))}prependString(e){if(this._kernelString)throw new Error("Kernel already built");this._prependedString.push(e)}hasPrependString(e){return this._prependedString.indexOf(e)>-1}}}},{"../../utils":114,"../function-builder":9,"../kernel":36,"./function-node":6,"./kernel-string":7}],9:[function(e,t,n){class r{static fromKernel(e,t,n){const{kernelArguments:i,kernelConstants:s,argumentNames:a,argumentSizes:o,argumentBitRatios:u,constants:c,constantBitRatios:l,debug:h,loopMaxIterations:p,nativeFunctions:d,output:f,optimizeFloatMemory:m,precision:g,plugins:y,source:v,subKernels:b,functions:x,leadingReturnStatement:w,followingReturnStatement:S,dynamicArguments:T,dynamicOutput:C}=e,A=new Array(i.length),_={};for(let e=0;e<i.length;e++)A[e]=i[e].type;for(let e=0;e<s.length;e++){const t=s[e];_[t.name]=t.type}const k=(e,t)=>G.needsArgumentType(e,t),I=(e,t,n)=>{G.assignArgumentType(e,t,n)},E=(e,t,n)=>G.lookupReturnType(e,t,n),O=e=>G.lookupFunctionArgumentTypes(e),D=(e,t)=>G.lookupFunctionArgumentName(e,t),B=(e,t)=>G.lookupFunctionArgumentBitRatio(e,t),P=(e,t,n,r)=>{G.assignArgumentType(e,t,n,r)},F=(e,t,n,r)=>{G.assignArgumentBitRatio(e,t,n,r)},N=(e,t,n)=>{G.trackFunctionCall(e,t,n)},R=(e,n)=>{const r=[];for(let t=0;t<e.params.length;t++)r.push(e.params[t].name);const i=new t(n,Object.assign({},L,{returnType:null,ast:e,name:e.id.name,argumentNames:r,lookupReturnType:E,lookupFunctionArgumentTypes:O,lookupFunctionArgumentName:D,lookupFunctionArgumentBitRatio:B,needsArgumentType:k,assignArgumentType:I,triggerImplyArgumentType:P,triggerImplyArgumentBitRatio:F,onFunctionCall:N}));i.traceFunctionAST(e),G.addFunctionNode(i)},L=Object.assign({isRootKernel:!1,onNestedFunction:R,lookupReturnType:E,lookupFunctionArgumentTypes:O,lookupFunctionArgumentName:D,lookupFunctionArgumentBitRatio:B,needsArgumentType:k,assignArgumentType:I,triggerImplyArgumentType:P,triggerImplyArgumentBitRatio:F,onFunctionCall:N,optimizeFloatMemory:m,precision:g,constants:c,constantTypes:_,constantBitRatios:l,debug:h,loopMaxIterations:p,output:f,plugins:y,dynamicArguments:T,dynamicOutput:C},n||{}),M=Object.assign({},L,{isRootKernel:!0,name:"kernel",argumentNames:a,argumentTypes:A,argumentSizes:o,argumentBitRatios:u,leadingReturnStatement:w,followingReturnStatement:S});if("object"==typeof v&&v.functionNodes)return(new r).fromJSON(v.functionNodes,t);const z=new t(v,M);let $=null;x&&($=x.map((e=>new t(e.source,{returnType:e.returnType,argumentTypes:e.argumentTypes,output:f,plugins:y,constants:c,constantTypes:_,constantBitRatios:l,optimizeFloatMemory:m,precision:g,lookupReturnType:E,lookupFunctionArgumentTypes:O,lookupFunctionArgumentName:D,lookupFunctionArgumentBitRatio:B,needsArgumentType:k,assignArgumentType:I,triggerImplyArgumentType:P,triggerImplyArgumentBitRatio:F,onFunctionCall:N,onNestedFunction:R}))));let V=null;b&&(V=b.map((e=>{const{name:n,source:r}=e;return new t(r,Object.assign({},L,{name:n,isSubKernel:!0,isRootKernel:!1}))})));const G=new r({kernel:e,rootNode:z,functionNodes:$,nativeFunctions:d,subKernelNodes:V});return G}constructor(e){if(e=e||{},this.kernel=e.kernel,this.rootNode=e.rootNode,this.functionNodes=e.functionNodes||[],this.subKernelNodes=e.subKernelNodes||[],this.nativeFunctions=e.nativeFunctions||[],this.functionMap={},this.nativeFunctionNames=[],this.lookupChain=[],this.functionNodeDependencies={},this.functionCalls={},this.rootNode&&(this.functionMap.kernel=this.rootNode),this.functionNodes)for(let e=0;e<this.functionNodes.length;e++)this.functionMap[this.functionNodes[e].name]=this.functionNodes[e];if(this.subKernelNodes)for(let e=0;e<this.subKernelNodes.length;e++)this.functionMap[this.subKernelNodes[e].name]=this.subKernelNodes[e];if(this.nativeFunctions)for(let e=0;e<this.nativeFunctions.length;e++){const t=this.nativeFunctions[e];this.nativeFunctionNames.push(t.name)}}addFunctionNode(e){if(!e.name)throw new Error("functionNode.name needs set");this.functionMap[e.name]=e,e.isRootKernel&&(this.rootNode=e)}traceFunctionCalls(e,t){if(e=e||"kernel",t=t||[],this.nativeFunctionNames.indexOf(e)>-1){const n=t.indexOf(e);if(-1===n)t.push(e);else{const e=t.splice(n,1)[0];t.push(e)}return t}const n=this.functionMap[e];if(n){const r=t.indexOf(e);if(-1===r){t.push(e),n.toString();for(let e=0;e<n.calledFunctions.length;++e)this.traceFunctionCalls(n.calledFunctions[e],t)}else{const e=t.splice(r,1)[0];t.push(e)}}return t}getPrototypeString(e){return this.getPrototypes(e).join("\n")}getPrototypes(e){return this.rootNode&&this.rootNode.toString(),e?this.getPrototypesFromFunctionNames(this.traceFunctionCalls(e,[]).reverse()):this.getPrototypesFromFunctionNames(Object.keys(this.functionMap))}getStringFromFunctionNames(e){const t=[];for(let n=0;n<e.length;++n)this.functionMap[e[n]]&&t.push(this.functionMap[e[n]].toString());return t.join("\n")}getPrototypesFromFunctionNames(e){const t=[];for(let n=0;n<e.length;++n){const r=e[n],i=this.nativeFunctionNames.indexOf(r);if(i>-1){t.push(this.nativeFunctions[i].source);continue}const s=this.functionMap[r];s&&t.push(s.toString())}return t}toJSON(){return this.traceFunctionCalls(this.rootNode.name).reverse().map((e=>{const t=this.nativeFunctions.indexOf(e);if(t>-1)return{name:e,source:this.nativeFunctions[t].source};if(this.functionMap[e])return this.functionMap[e].toJSON();throw new Error(`function ${e} not found`)}))}fromJSON(e,t){this.functionMap={};for(let n=0;n<e.length;n++){const r=e[n];this.functionMap[r.settings.name]=new t(r.ast,r.settings)}return this}getString(e){return e?this.getStringFromFunctionNames(this.traceFunctionCalls(e).reverse()):this.getStringFromFunctionNames(Object.keys(this.functionMap))}lookupReturnType(e,t,n){if("CallExpression"!==t.type)throw new Error(`expected ast type of "CallExpression", but is ${t.type}`);if(this._isNativeFunction(e))return this._lookupNativeFunctionReturnType(e);if(this._isFunction(e)){const r=this._getFunction(e);if(r.returnType)return r.returnType;{for(let e=0;e<this.lookupChain.length;e++)if(this.lookupChain[e].ast===t){if(0===r.argumentTypes.length&&t.arguments.length>0){const i=t.arguments;for(let t=0;t<i.length;t++)this.lookupChain.push({name:n.name,ast:i[e],requestingNode:n}),r.argumentTypes[t]=n.getType(i[t]),this.lookupChain.pop();return r.returnType=r.getType(r.getJsAST())}throw new Error("circlical logic detected!")}this.lookupChain.push({name:n.name,ast:t,requestingNode:n});const e=r.getType(r.getJsAST());return this.lookupChain.pop(),r.returnType=e}}return null}_getFunction(e){return this._isFunction(e)||new Error(`Function ${e} not found`),this.functionMap[e]}_isFunction(e){return Boolean(this.functionMap[e])}_getNativeFunction(e){for(let t=0;t<this.nativeFunctions.length;t++)if(this.nativeFunctions[t].name===e)return this.nativeFunctions[t];return null}_isNativeFunction(e){return Boolean(this._getNativeFunction(e))}_lookupNativeFunctionReturnType(e){let t=this._getNativeFunction(e);if(t)return t.returnType;throw new Error(`Native function ${e} not found`)}lookupFunctionArgumentTypes(e){return this._isNativeFunction(e)?this._getNativeFunction(e).argumentTypes:this._isFunction(e)?this._getFunction(e).argumentTypes:null}lookupFunctionArgumentName(e,t){return this._getFunction(e).argumentNames[t]}lookupFunctionArgumentBitRatio(e,t){if(!this._isFunction(e))throw new Error("function not found");if(this.rootNode.name===e){const e=this.rootNode.argumentNames.indexOf(t);if(-1!==e)return this.rootNode.argumentBitRatios[e]}const n=this._getFunction(e),r=n.argumentNames.indexOf(t);if(-1===r)throw new Error("argument not found");const i=n.argumentBitRatios[r];if("number"!=typeof i)throw new Error("argument bit ratio not found");return i}needsArgumentType(e,t){return!!this._isFunction(e)&&!this._getFunction(e).argumentTypes[t]}assignArgumentType(e,t,n,r){if(!this._isFunction(e))return;const i=this._getFunction(e);i.argumentTypes[t]||(i.argumentTypes[t]=n)}assignArgumentBitRatio(e,t,n,r){const i=this._getFunction(e);if(this._isNativeFunction(n))return null;const s=this._getFunction(n),a=i.argumentNames.indexOf(t);if(-1===a)throw new Error(`Argument ${t} not found in arguments from function ${e}`);const o=i.argumentBitRatios[a];if("number"!=typeof o)throw new Error(`Bit ratio for argument ${t} not found in function ${e}`);s.argumentBitRatios||(s.argumentBitRatios=new Array(s.argumentNames.length));const u=s.argumentBitRatios[a];if("number"==typeof u){if(u!==o)throw new Error(`Incompatible bit ratio found at function ${e} at argument ${t}`);return u}return s.argumentBitRatios[a]=o,o}trackFunctionCall(e,t,n){this.functionNodeDependencies[e]||(this.functionNodeDependencies[e]=new Set,this.functionCalls[e]=[]),this.functionNodeDependencies[e].add(t),this.functionCalls[e].push(n)}getKernelResultType(){return this.rootNode.returnType||this.rootNode.getType(this.rootNode.ast)}getSubKernelResultType(e){const t=this.subKernelNodes[e];let n=!1;for(let e=0;e<this.rootNode.functionCalls.length;e++)this.rootNode.functionCalls[e].ast.callee.name===t.name&&(n=!0);if(!n)throw new Error(`SubKernel ${t.name} never called by kernel`);return t.returnType||t.getType(t.getJsAST())}getReturnTypes(){const e={[this.rootNode.name]:this.rootNode.getType(this.rootNode.ast)},t=this.traceFunctionCalls(this.rootNode.name);for(let n=0;n<t.length;n++){const r=t[n],i=this.functionMap[r];e[r]=i.getType(i.ast)}return e}}t.exports={FunctionBuilder:r}},{}],10:[function(e,t,n){const r=e("acorn"),{utils:i}=e("../utils"),{FunctionTracer:s}=e("./function-tracer"),a={Number:"Number",Float:"Float",Integer:"Integer",Array:"Number","Array(2)":"Number","Array(3)":"Number","Array(4)":"Number","Matrix(2)":"Number","Matrix(3)":"Number","Matrix(4)":"Number",Array2D:"Number",Array3D:"Number",Input:"Number",HTMLCanvas:"Array(4)",HTMLImage:"Array(4)",HTMLVideo:"Array(4)",HTMLImageArray:"Array(4)",NumberTexture:"Number",MemoryOptimizedNumberTexture:"Number","Array1D(2)":"Array(2)","Array1D(3)":"Array(3)","Array1D(4)":"Array(4)","Array2D(2)":"Array(2)","Array2D(3)":"Array(3)","Array2D(4)":"Array(4)","Array3D(2)":"Array(2)","Array3D(3)":"Array(3)","Array3D(4)":"Array(4)","ArrayTexture(1)":"Number","ArrayTexture(2)":"Array(2)","ArrayTexture(3)":"Array(3)","ArrayTexture(4)":"Array(4)"};t.exports={FunctionNode:class{constructor(e,t){if(!e&&!t.ast)throw new Error("source parameter is missing");if(t=t||{},this.source=e,this.ast=null,this.name="string"==typeof e?t.isRootKernel?"kernel":t.name||i.getFunctionNameFromString(e):null,this.calledFunctions=[],this.constants={},this.constantTypes={},this.constantBitRatios={},this.isRootKernel=!1,this.isSubKernel=!1,this.debug=null,this.functions=null,this.identifiers=null,this.contexts=null,this.functionCalls=null,this.states=[],this.needsArgumentType=null,this.assignArgumentType=null,this.lookupReturnType=null,this.lookupFunctionArgumentTypes=null,this.lookupFunctionArgumentBitRatio=null,this.triggerImplyArgumentType=null,this.triggerImplyArgumentBitRatio=null,this.onNestedFunction=null,this.onFunctionCall=null,this.optimizeFloatMemory=null,this.precision=null,this.loopMaxIterations=null,this.argumentNames="string"==typeof this.source?i.getArgumentNamesFromString(this.source):null,this.argumentTypes=[],this.argumentSizes=[],this.argumentBitRatios=null,this.returnType=null,this.output=[],this.plugins=null,this.leadingReturnStatement=null,this.followingReturnStatement=null,this.dynamicOutput=null,this.dynamicArguments=null,this.strictTypingChecking=!1,this.fixIntegerDivisionAccuracy=null,t)for(const e in t)t.hasOwnProperty(e)&&this.hasOwnProperty(e)&&(this[e]=t[e]);this.literalTypes={},this.validate(),this._string=null,this._internalVariableNames={}}validate(){if("string"!=typeof this.source&&!this.ast)throw new Error("this.source not a string");if(!this.ast&&!i.isFunctionString(this.source))throw new Error("this.source not a function string");if(!this.name)throw new Error("this.name could not be set");if(this.argumentTypes.length>0&&this.argumentTypes.length!==this.argumentNames.length)throw new Error(`argumentTypes count of ${this.argumentTypes.length} exceeds ${this.argumentNames.length}`);if(this.output.length<1)throw new Error("this.output is not big enough")}isIdentifierConstant(e){return!!this.constants&&this.constants.hasOwnProperty(e)}isInput(e){return"Input"===this.argumentTypes[this.argumentNames.indexOf(e)]}pushState(e){this.states.push(e)}popState(e){if(this.state!==e)throw new Error(`Cannot popState ${e} when in ${this.state}`);this.states.pop()}isState(e){return this.state===e}get state(){return this.states[this.states.length-1]}astMemberExpressionUnroll(e){if("Identifier"===e.type)return e.name;if("ThisExpression"===e.type)return"this";if("MemberExpression"===e.type&&e.object&&e.property)return e.object.hasOwnProperty("name")&&"Math"!==e.object.name?this.astMemberExpressionUnroll(e.property):this.astMemberExpressionUnroll(e.object)+"."+this.astMemberExpressionUnroll(e.property);if(e.hasOwnProperty("expressions")){const t=e.expressions[0];if("Literal"===t.type&&0===t.value&&2===e.expressions.length)return this.astMemberExpressionUnroll(e.expressions[1])}throw this.astErrorOutput("Unknown astMemberExpressionUnroll",e)}getJsAST(e){if(this.ast)return this.ast;if("object"==typeof this.source)return this.traceFunctionAST(this.source),this.ast=this.source;if(null===(e=e||r))throw new Error("Missing JS to AST parser");const t=Object.freeze(e.parse(`const parser_${this.name} = ${this.source};`,{locations:!0})),n=t.body[0].declarations[0].init;if(this.traceFunctionAST(n),!t)throw new Error("Failed to parse JS code");return this.ast=n}traceFunctionAST(e){const{contexts:t,declarations:n,functions:r,identifiers:i,functionCalls:a}=new s(e);this.contexts=t,this.identifiers=i,this.functionCalls=a,this.functions=r;for(let e=0;e<n.length;e++){const t=n[e],{ast:r,inForLoopInit:i,inForLoopTest:s}=t,{init:a}=r,o=this.getDependencies(a);let u=null;if(i&&s)u="Integer";else if(a){const e=this.getType(a);switch(e){case"Integer":case"Float":case"Number":u="MemberExpression"===a.type?e:"Number";break;case"LiteralInteger":u="Number";break;default:u=e}}t.valueType=u,t.dependencies=o,t.isSafe=this.isSafeDependencies(o)}for(let e=0;e<r.length;e++)this.onNestedFunction(r[e],this.source)}getDeclaration(e){for(let t=0;t<this.identifiers.length;t++){const n=this.identifiers[t];if(e===n.ast)return n.declaration}return null}getVariableType(e){if("Identifier"!==e.type)throw new Error(`ast of ${e.type} not "Identifier"`);let t=null;const n=this.argumentNames.indexOf(e.name);if(-1===n){const t=this.getDeclaration(e);if(t)return t.valueType}else{const e=this.argumentTypes[n];e&&(t=e)}if(!t&&this.strictTypingChecking)throw new Error(`Declaration of ${name} not found`);return t}getLookupType(e){if(!a.hasOwnProperty(e))throw new Error(`unknown typeLookupMap ${e}`);return a[e]}getConstantType(e){if(this.constantTypes[e]){const t=this.constantTypes[e];return"Float"===t?"Number":t}throw new Error(`Type for constant "${e}" not declared`)}toString(){return this._string?this._string:this._string=this.astGeneric(this.getJsAST(),[]).join("").trim()}toJSON(){const e={source:this.source,name:this.name,constants:this.constants,constantTypes:this.constantTypes,isRootKernel:this.isRootKernel,isSubKernel:this.isSubKernel,debug:this.debug,output:this.output,loopMaxIterations:this.loopMaxIterations,argumentNames:this.argumentNames,argumentTypes:this.argumentTypes,argumentSizes:this.argumentSizes,returnType:this.returnType,leadingReturnStatement:this.leadingReturnStatement,followingReturnStatement:this.followingReturnStatement};return{ast:this.ast,settings:e}}getType(e){if(Array.isArray(e))return this.getType(e[e.length-1]);switch(e.type){case"BlockStatement":return this.getType(e.body);case"ArrayExpression":switch(this.getType(e.elements[0])){case"Array(2)":case"Array(3)":case"Array(4)":return`Matrix(${e.elements.length})`}return`Array(${e.elements.length})`;case"Literal":const t=this.astKey(e);return this.literalTypes[t]?this.literalTypes[t]:Number.isInteger(e.value)?"LiteralInteger":!0===e.value||!1===e.value?"Boolean":"Number";case"AssignmentExpression":return this.getType(e.left);case"CallExpression":if(this.isAstMathFunction(e))return"Number";if(!e.callee||!e.callee.name){if("SequenceExpression"===e.callee.type&&e.callee.expressions[e.callee.expressions.length-1].property.name){const t=e.callee.expressions[e.callee.expressions.length-1].property.name;return this.inferArgumentTypesIfNeeded(t,e.arguments),this.lookupReturnType(t,e,this)}if("this.color"===this.getVariableSignature(e.callee,!0))return null;if("MemberExpression"===e.callee.type&&e.callee.object&&e.callee.property&&e.callee.property.name&&e.arguments){const t=e.callee.property.name;return this.inferArgumentTypesIfNeeded(t,e.arguments),this.lookupReturnType(t,e,this)}throw this.astErrorOutput("Unknown call expression",e)}if(e.callee&&e.callee.name){const t=e.callee.name;return this.inferArgumentTypesIfNeeded(t,e.arguments),this.lookupReturnType(t,e,this)}throw this.astErrorOutput(`Unhandled getType Type "${e.type}"`,e);case"LogicalExpression":return"Boolean";case"BinaryExpression":switch(e.operator){case"%":case"/":if(this.fixIntegerDivisionAccuracy)return"Number";break;case">":case"<":return"Boolean";case"&":case"|":case"^":case"<<":case">>":case">>>":return"Integer"}const n=this.getType(e.left);if(this.isState("skip-literal-correction"))return n;if("LiteralInteger"===n){const t=this.getType(e.right);return"LiteralInteger"===t?e.left.value%1==0?"Integer":"Float":t}return a[n]||n;case"UpdateExpression":return this.getType(e.argument);case"UnaryExpression":return"~"===e.operator?"Integer":this.getType(e.argument);case"VariableDeclaration":{const t=e.declarations;let n;for(let e=0;e<t.length;e++){const r=t[e];n=this.getType(r)}if(!n)throw this.astErrorOutput("Unable to find type for declaration",e);return n}case"VariableDeclarator":const r=this.getDeclaration(e.id);if(!r)throw this.astErrorOutput("Unable to find declarator",e);if(!r.valueType)throw this.astErrorOutput("Unable to find declarator valueType",e);return r.valueType;case"Identifier":if("Infinity"===e.name)return"Number";if(this.isAstVariable(e)&&"value"===this.getVariableSignature(e))return this.getCheckVariableType(e);const i=this.findIdentifierOrigin(e);return i&&i.init?this.getType(i.init):null;case"ReturnStatement":return this.getType(e.argument);case"MemberExpression":if(this.isAstMathFunction(e)){switch(e.property.name){case"ceil":case"floor":case"round":return"Integer"}return"Number"}if(this.isAstVariable(e)){switch(this.getVariableSignature(e)){case"value[]":return this.getLookupType(this.getCheckVariableType(e.object));case"value[][]":return this.getLookupType(this.getCheckVariableType(e.object.object));case"value[][][]":return this.getLookupType(this.getCheckVariableType(e.object.object.object));case"value[][][][]":return this.getLookupType(this.getCheckVariableType(e.object.object.object.object));case"value.thread.value":case"this.thread.value":return"Integer";case"this.output.value":return this.dynamicOutput?"Integer":"LiteralInteger";case"this.constants.value":return this.getConstantType(e.property.name);case"this.constants.value[]":return this.getLookupType(this.getConstantType(e.object.property.name));case"this.constants.value[][]":return this.getLookupType(this.getConstantType(e.object.object.property.name));case"this.constants.value[][][]":return this.getLookupType(this.getConstantType(e.object.object.object.property.name));case"this.constants.value[][][][]":return this.getLookupType(this.getConstantType(e.object.object.object.object.property.name));case"fn()[]":case"fn()[][]":case"fn()[][][]":return this.getLookupType(this.getType(e.object));case"value.value":if(this.isAstMathVariable(e))return"Number";switch(e.property.name){case"r":case"g":case"b":case"a":return this.getLookupType(this.getCheckVariableType(e.object))}case"[][]":return"Number"}throw this.astErrorOutput("Unhandled getType MemberExpression",e)}throw this.astErrorOutput("Unhandled getType MemberExpression",e);case"ConditionalExpression":return this.getType(e.consequent);case"FunctionDeclaration":case"FunctionExpression":const s=this.findLastReturn(e.body);return s?this.getType(s):null;case"IfStatement":return this.getType(e.consequent);case"SequenceExpression":return this.getType(e.expressions[e.expressions.length-1]);default:throw this.astErrorOutput(`Unhandled getType Type "${e.type}"`,e)}}getCheckVariableType(e){const t=this.getVariableType(e);if(!t)throw this.astErrorOutput(`${e.type} is not defined`,e);return t}inferArgumentTypesIfNeeded(e,t){for(let n=0;n<t.length;n++){if(!this.needsArgumentType(e,n))continue;const r=this.getType(t[n]);if(!r)throw this.astErrorOutput(`Unable to infer argument ${n}`,t[n]);this.assignArgumentType(e,n,r)}}isAstMathVariable(e){return"MemberExpression"===e.type&&e.object&&"Identifier"===e.object.type&&"Math"===e.object.name&&e.property&&"Identifier"===e.property.type&&["E","PI","SQRT2","SQRT1_2","LN2","LN10","LOG2E","LOG10E"].indexOf(e.property.name)>-1}isAstMathFunction(e){return"CallExpression"===e.type&&e.callee&&"MemberExpression"===e.callee.type&&e.callee.object&&"Identifier"===e.callee.object.type&&"Math"===e.callee.object.name&&e.callee.property&&"Identifier"===e.callee.property.type&&["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","expm1","exp","floor","fround","imul","log","log2","log10","log1p","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc"].indexOf(e.callee.property.name)>-1}isAstVariable(e){return"Identifier"===e.type||"MemberExpression"===e.type}isSafe(e){return this.isSafeDependencies(this.getDependencies(e))}isSafeDependencies(e){return!e||!e.every||e.every((e=>e.isSafe))}getDependencies(e,t,n){if(t||(t=[]),!e)return null;if(Array.isArray(e)){for(let r=0;r<e.length;r++)this.getDependencies(e[r],t,n);return t}switch(e.type){case"AssignmentExpression":return this.getDependencies(e.left,t,n),this.getDependencies(e.right,t,n),t;case"ConditionalExpression":return this.getDependencies(e.test,t,n),this.getDependencies(e.alternate,t,n),this.getDependencies(e.consequent,t,n),t;case"Literal":t.push({origin:"literal",value:e.value,isSafe:!0!==n&&e.value>-1/0&&e.value<1/0&&!isNaN(e.value)});break;case"VariableDeclarator":return this.getDependencies(e.init,t,n);case"Identifier":const r=this.getDeclaration(e);if(r)t.push({name:e.name,origin:"declaration",isSafe:!n&&this.isSafeDependencies(r.dependencies)});else if(this.argumentNames.indexOf(e.name)>-1)t.push({name:e.name,origin:"argument",isSafe:!1});else if(this.strictTypingChecking)throw new Error(`Cannot find identifier origin "${e.name}"`);break;case"FunctionDeclaration":return this.getDependencies(e.body.body[e.body.body.length-1],t,n);case"ReturnStatement":return this.getDependencies(e.argument,t);case"BinaryExpression":case"LogicalExpression":return n="/"===e.operator||"*"===e.operator,this.getDependencies(e.left,t,n),this.getDependencies(e.right,t,n),t;case"UnaryExpression":case"UpdateExpression":return this.getDependencies(e.argument,t,n);case"VariableDeclaration":return this.getDependencies(e.declarations,t,n);case"ArrayExpression":return t.push({origin:"declaration",isSafe:!0}),t;case"CallExpression":return t.push({origin:"function",isSafe:!0}),t;case"MemberExpression":const i=this.getMemberExpressionDetails(e);switch(i.signature){case"value[]":this.getDependencies(e.object,t,n);break;case"value[][]":this.getDependencies(e.object.object,t,n);break;case"value[][][]":this.getDependencies(e.object.object.object,t,n);break;case"this.output.value":this.dynamicOutput&&t.push({name:i.name,origin:"output",isSafe:!1})}if(i)return i.property&&this.getDependencies(i.property,t,n),i.xProperty&&this.getDependencies(i.xProperty,t,n),i.yProperty&&this.getDependencies(i.yProperty,t,n),i.zProperty&&this.getDependencies(i.zProperty,t,n),t;case"SequenceExpression":return this.getDependencies(e.expressions,t,n);default:throw this.astErrorOutput(`Unhandled type ${e.type} in getDependencies`,e)}return t}getVariableSignature(e,t){if(!this.isAstVariable(e))throw new Error(`ast of type "${e.type}" is not a variable signature`);if("Identifier"===e.type)return"value";const n=[];for(;e;)e.computed?n.push("[]"):"ThisExpression"===e.type?n.unshift("this"):e.property&&e.property.name?"x"===e.property.name||"y"===e.property.name||"z"===e.property.name?n.unshift(t?"."+e.property.name:".value"):"constants"===e.property.name||"thread"===e.property.name||"output"===e.property.name?n.unshift("."+e.property.name):n.unshift(t?"."+e.property.name:".value"):e.name?n.unshift(t?e.name:"value"):e.callee&&e.callee.name?n.unshift(t?e.callee.name+"()":"fn()"):e.elements?n.unshift("[]"):n.unshift("unknown"),e=e.object;const r=n.join("");return t||["value","value[]","value[][]","value[][][]","value[][][][]","value.value","value.thread.value","this.thread.value","this.output.value","this.constants.value","this.constants.value[]","this.constants.value[][]","this.constants.value[][][]","this.constants.value[][][][]","fn()[]","fn()[][]","fn()[][][]","[][]"].indexOf(r)>-1?r:null}build(){return this.toString().length>0}astGeneric(e,t){if(null===e)throw this.astErrorOutput("NULL ast",e);if(Array.isArray(e)){for(let n=0;n<e.length;n++)this.astGeneric(e[n],t);return t}switch(e.type){case"FunctionDeclaration":return this.astFunctionDeclaration(e,t);case"FunctionExpression":return this.astFunctionExpression(e,t);case"ReturnStatement":return this.astReturnStatement(e,t);case"Literal":return this.astLiteral(e,t);case"BinaryExpression":return this.astBinaryExpression(e,t);case"Identifier":return this.astIdentifierExpression(e,t);case"AssignmentExpression":return this.astAssignmentExpression(e,t);case"ExpressionStatement":return this.astExpressionStatement(e,t);case"EmptyStatement":return this.astEmptyStatement(e,t);case"BlockStatement":return this.astBlockStatement(e,t);case"IfStatement":return this.astIfStatement(e,t);case"SwitchStatement":return this.astSwitchStatement(e,t);case"BreakStatement":return this.astBreakStatement(e,t);case"ContinueStatement":return this.astContinueStatement(e,t);case"ForStatement":return this.astForStatement(e,t);case"WhileStatement":return this.astWhileStatement(e,t);case"DoWhileStatement":return this.astDoWhileStatement(e,t);case"VariableDeclaration":return this.astVariableDeclaration(e,t);case"VariableDeclarator":return this.astVariableDeclarator(e,t);case"ThisExpression":return this.astThisExpression(e,t);case"SequenceExpression":return this.astSequenceExpression(e,t);case"UnaryExpression":return this.astUnaryExpression(e,t);case"UpdateExpression":return this.astUpdateExpression(e,t);case"LogicalExpression":return this.astLogicalExpression(e,t);case"MemberExpression":return this.astMemberExpression(e,t);case"CallExpression":return this.astCallExpression(e,t);case"ArrayExpression":return this.astArrayExpression(e,t);case"DebuggerStatement":return this.astDebuggerStatement(e,t);case"ConditionalExpression":return this.astConditionalExpression(e,t)}throw this.astErrorOutput("Unknown ast type : "+e.type,e)}astErrorOutput(e,t){if("string"!=typeof this.source)return new Error(e);const n=i.getAstString(this.source,t),r=this.source.substr(t.start).split(/\n/),s=r.length>0?r[r.length-1]:0;return new Error(`${e} on line ${r.length}, position ${s.length}:\n ${n}`)}astDebuggerStatement(e,t){return t}astConditionalExpression(e,t){if("ConditionalExpression"!==e.type)throw this.astErrorOutput("Not a conditional expression",e);return t.push("("),this.astGeneric(e.test,t),t.push("?"),this.astGeneric(e.consequent,t),t.push(":"),this.astGeneric(e.alternate,t),t.push(")"),t}astFunction(e,t){throw new Error(`"astFunction" not defined on ${this.constructor.name}`)}astFunctionDeclaration(e,t){return this.isChildFunction(e)?t:this.astFunction(e,t)}astFunctionExpression(e,t){return this.isChildFunction(e)?t:this.astFunction(e,t)}isChildFunction(e){for(let t=0;t<this.functions.length;t++)if(this.functions[t]===e)return!0;return!1}astReturnStatement(e,t){return t}astLiteral(e,t){return this.literalTypes[this.astKey(e)]="Number",t}astBinaryExpression(e,t){return t}astIdentifierExpression(e,t){return t}astAssignmentExpression(e,t){return t}astExpressionStatement(e,t){return this.astGeneric(e.expression,t),t.push(";"),t}astEmptyStatement(e,t){return t}astBlockStatement(e,t){return t}astIfStatement(e,t){return t}astSwitchStatement(e,t){return t}astBreakStatement(e,t){return t.push("break;"),t}astContinueStatement(e,t){return t.push("continue;\n"),t}astForStatement(e,t){return t}astWhileStatement(e,t){return t}astDoWhileStatement(e,t){return t}astVariableDeclarator(e,t){return this.astGeneric(e.id,t),null!==e.init&&(t.push("="),this.astGeneric(e.init,t)),t}astThisExpression(e,t){return t}astSequenceExpression(e,t){const{expressions:n}=e,r=[];for(let e=0;e<n.length;e++){const t=n[e],i=[];this.astGeneric(t,i),r.push(i.join(""))}return r.length>1?t.push("(",r.join(","),")"):t.push(r[0]),t}astUnaryExpression(e,t){return this.checkAndUpconvertBitwiseUnary(e,t)||(e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t)):(this.astGeneric(e.argument,t),t.push(e.operator))),t}checkAndUpconvertBitwiseUnary(e,t){}astUpdateExpression(e,t){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t)):(this.astGeneric(e.argument,t),t.push(e.operator)),t}astLogicalExpression(e,t){return t.push("("),this.astGeneric(e.left,t),t.push(e.operator),this.astGeneric(e.right,t),t.push(")"),t}astMemberExpression(e,t){return t}astCallExpression(e,t){return t}astArrayExpression(e,t){return t}getMemberExpressionDetails(e){if("MemberExpression"!==e.type)throw this.astErrorOutput(`Expression ${e.type} not a MemberExpression`,e);let t=null,n=null;const r=this.getVariableSignature(e);switch(r){case"value":return null;case"value.thread.value":case"this.thread.value":case"this.output.value":return{signature:r,type:"Integer",name:e.property.name};case"value[]":if("string"!=typeof e.object.name)throw this.astErrorOutput("Unexpected expression",e);return t=e.object.name,{name:t,origin:"user",signature:r,type:this.getVariableType(e.object),xProperty:e.property};case"value[][]":if("string"!=typeof e.object.object.name)throw this.astErrorOutput("Unexpected expression",e);return t=e.object.object.name,{name:t,origin:"user",signature:r,type:this.getVariableType(e.object.object),yProperty:e.object.property,xProperty:e.property};case"value[][][]":if("string"!=typeof e.object.object.object.name)throw this.astErrorOutput("Unexpected expression",e);return t=e.object.object.object.name,{name:t,origin:"user",signature:r,type:this.getVariableType(e.object.object.object),zProperty:e.object.object.property,yProperty:e.object.property,xProperty:e.property};case"value[][][][]":if("string"!=typeof e.object.object.object.object.name)throw this.astErrorOutput("Unexpected expression",e);return t=e.object.object.object.object.name,{name:t,origin:"user",signature:r,type:this.getVariableType(e.object.object.object.object),zProperty:e.object.object.property,yProperty:e.object.property,xProperty:e.property};case"value.value":if("string"!=typeof e.property.name)throw this.astErrorOutput("Unexpected expression",e);if(this.isAstMathVariable(e))return t=e.property.name,{name:t,origin:"Math",type:"Number",signature:r};switch(e.property.name){case"r":case"g":case"b":case"a":return t=e.object.name,{name:t,property:e.property.name,origin:"user",signature:r,type:"Number"};default:throw this.astErrorOutput("Unexpected expression",e)}case"this.constants.value":if("string"!=typeof e.property.name)throw this.astErrorOutput("Unexpected expression",e);if(t=e.property.name,n=this.getConstantType(t),!n)throw this.astErrorOutput("Constant has no type",e);return{name:t,type:n,origin:"constants",signature:r};case"this.constants.value[]":if("string"!=typeof e.object.property.name)throw this.astErrorOutput("Unexpected expression",e);if(t=e.object.property.name,n=this.getConstantType(t),!n)throw this.astErrorOutput("Constant has no type",e);return{name:t,type:n,origin:"constants",signature:r,xProperty:e.property};case"this.constants.value[][]":if("string"!=typeof e.object.object.property.name)throw this.astErrorOutput("Unexpected expression",e);if(t=e.object.object.property.name,n=this.getConstantType(t),!n)throw this.astErrorOutput("Constant has no type",e);return{name:t,type:n,origin:"constants",signature:r,yProperty:e.object.property,xProperty:e.property};case"this.constants.value[][][]":if("string"!=typeof e.object.object.object.property.name)throw this.astErrorOutput("Unexpected expression",e);if(t=e.object.object.object.property.name,n=this.getConstantType(t),!n)throw this.astErrorOutput("Constant has no type",e);return{name:t,type:n,origin:"constants",signature:r,zProperty:e.object.object.property,yProperty:e.object.property,xProperty:e.property};case"fn()[]":case"fn()[][]":case"[][]":return{signature:r,property:e.property};default:throw this.astErrorOutput("Unexpected expression",e)}}findIdentifierOrigin(e){const t=[this.ast];for(;t.length>0;){const n=t[0];if("VariableDeclarator"===n.type&&n.id&&n.id.name&&n.id.name===e.name)return n;if(t.shift(),n.argument)t.push(n.argument);else if(n.body)t.push(n.body);else if(n.declarations)t.push(n.declarations);else if(Array.isArray(n))for(let e=0;e<n.length;e++)t.push(n[e])}return null}findLastReturn(e){const t=[e||this.ast];for(;t.length>0;){const e=t.pop();if("ReturnStatement"===e.type)return e;if("FunctionDeclaration"!==e.type)if(e.argument)t.push(e.argument);else if(e.body)t.push(e.body);else if(e.declarations)t.push(e.declarations);else if(Array.isArray(e))for(let n=0;n<e.length;n++)t.push(e[n]);else e.consequent?t.push(e.consequent):e.cases&&t.push(e.cases)}return null}getInternalVariableName(e){return this._internalVariableNames.hasOwnProperty(e)||(this._internalVariableNames[e]=0),this._internalVariableNames[e]++,1===this._internalVariableNames[e]?e:e+this._internalVariableNames[e]}astKey(e,t=","){if(!e.start||!e.end)throw new Error("AST start and end needed");return`${e.start}${t}${e.end}`}}}},{"../utils":114,"./function-tracer":11,acorn:1}],11:[function(e,t,n){const{utils:r}=e("../utils");function i(e){return e.length>0?e[e.length-1]:null}const s="trackIdentifiers",a="memberExpression",o="inForLoopInit";t.exports={FunctionTracer:class{constructor(e){this.runningContexts=[],this.functionContexts=[],this.contexts=[],this.functionCalls=[],this.declarations=[],this.identifiers=[],this.functions=[],this.returnStatements=[],this.trackedIdentifiers=null,this.states=[],this.newFunctionContext(),this.scan(e)}isState(e){return this.states[this.states.length-1]===e}hasState(e){return this.states.indexOf(e)>-1}pushState(e){this.states.push(e)}popState(e){if(!this.isState(e))throw new Error(`Cannot pop the non-active state "${e}"`);this.states.pop()}get currentFunctionContext(){return i(this.functionContexts)}get currentContext(){return i(this.runningContexts)}newFunctionContext(){const e={"@contextType":"function"};this.contexts.push(e),this.functionContexts.push(e)}newContext(e){const t=Object.assign({"@contextType":"const/let"},this.currentContext);this.contexts.push(t),this.runningContexts.push(t),e();const{currentFunctionContext:n}=this;for(const e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e]);return this.runningContexts.pop(),t}useFunctionContext(e){const t=i(this.functionContexts);this.runningContexts.push(t),e(),this.runningContexts.pop()}getIdentifiers(e){const t=this.trackedIdentifiers=[];return this.pushState(s),e(),this.trackedIdentifiers=null,this.popState(s),t}getDeclaration(e){const{currentContext:t,currentFunctionContext:n,runningContexts:r}=this,i=t[e]||n[e]||null;if(!i&&t===n&&r.length>0){const t=r[r.length-2];if(t[e])return t[e]}return i}scan(e){if(e)if(Array.isArray(e))for(let t=0;t<e.length;t++)this.scan(e[t]);else switch(e.type){case"Program":this.useFunctionContext((()=>{this.scan(e.body)}));break;case"BlockStatement":this.newContext((()=>{this.scan(e.body)}));break;case"AssignmentExpression":case"LogicalExpression":case"BinaryExpression":this.scan(e.left),this.scan(e.right);break;case"UpdateExpression":if("++"===e.operator){const t=this.getDeclaration(e.argument.name);t&&(t.suggestedType="Integer")}this.scan(e.argument);break;case"UnaryExpression":this.scan(e.argument);break;case"VariableDeclaration":"var"===e.kind?this.useFunctionContext((()=>{e.declarations=r.normalizeDeclarations(e),this.scan(e.declarations)})):(e.declarations=r.normalizeDeclarations(e),this.scan(e.declarations));break;case"VariableDeclarator":{const{currentContext:t}=this,n=this.hasState(o),r={ast:e,context:t,name:e.id.name,origin:"declaration",inForLoopInit:n,inForLoopTest:null,assignable:t===this.currentFunctionContext||!n&&!t.hasOwnProperty(e.id.name),suggestedType:null,valueType:null,dependencies:null,isSafe:null};t[e.id.name]||(t[e.id.name]=r),this.declarations.push(r),this.scan(e.id),this.scan(e.init);break}case"FunctionExpression":case"FunctionDeclaration":0===this.runningContexts.length?this.scan(e.body):this.functions.push(e);break;case"IfStatement":this.scan(e.test),this.scan(e.consequent),e.alternate&&this.scan(e.alternate);break;case"ForStatement":{let t;const n=this.newContext((()=>{this.pushState(o),this.scan(e.init),this.popState(o),t=this.getIdentifiers((()=>{this.scan(e.test)})),this.scan(e.update),this.newContext((()=>{this.scan(e.body)}))}));if(t)for(const e in n)"@contextType"!==e&&t.indexOf(e)>-1&&(n[e].inForLoopTest=!0);break}case"DoWhileStatement":case"WhileStatement":this.newContext((()=>{this.scan(e.body),this.scan(e.test)}));break;case"Identifier":this.isState(s)&&this.trackedIdentifiers.push(e.name),this.identifiers.push({context:this.currentContext,declaration:this.getDeclaration(e.name),ast:e});break;case"ReturnStatement":this.returnStatements.push(e),this.scan(e.argument);break;case"MemberExpression":this.pushState(a),this.scan(e.object),this.scan(e.property),this.popState(a);break;case"ExpressionStatement":this.scan(e.expression);break;case"SequenceExpression":this.scan(e.expressions);break;case"CallExpression":this.functionCalls.push({context:this.currentContext,ast:e}),this.scan(e.arguments);break;case"ArrayExpression":this.scan(e.elements);break;case"ConditionalExpression":this.scan(e.test),this.scan(e.alternate),this.scan(e.consequent);break;case"SwitchStatement":this.scan(e.discriminant),this.scan(e.cases);break;case"SwitchCase":this.scan(e.test),this.scan(e.consequent);break;case"ThisExpression":case"Literal":case"DebuggerStatement":case"EmptyStatement":case"BreakStatement":case"ContinueStatement":break;default:throw new Error(`unhandled type "${e.type}"`)}}}}},{"../utils":114}],12:[function(e,t,n){const{glWiretap:r}=e("gl-wiretap"),{utils:i}=e("../../utils");function s(e){return e.toString().replace("=>","").replace(/^function /,"").replace(/utils[.]/g,"/*utils.*/")}function a(e,t){const n="single"===t.precision?e:`new Float32Array(${e}.buffer)`;return t.output[2]?`renderOutput(${n}, ${t.output[0]}, ${t.output[1]}, ${t.output[2]})`:t.output[1]?`renderOutput(${n}, ${t.output[0]}, ${t.output[1]})`:`renderOutput(${n}, ${t.output[0]})`}function o(e,t,n){const r=e.toArray.toString(),s=!/^function/.test(r);return`() => {\n  function framebuffer() { return ${n}; };\n  ${i.flattenFunctionToString(`${s?"function ":""}${r}`,{findDependency:(t,n)=>{if("utils"===t)return`const ${n} = ${i[n].toString()};`;if("this"===t)return"framebuffer"===n?"":`${s?"function ":""}${e[n].toString()}`;throw new Error("unhandled fromObject")},thisLookup:(n,r)=>{if("texture"===n)return t;if("context"===n)return r?null:"gl";if(e.hasOwnProperty(n))return JSON.stringify(e[n]);throw new Error(`unhandled thisLookup ${n}`)}})}\n  return toArray();\n  }`}function u(e,t,n,r,i){if(null===e)return null;if(null===t)return null;switch(typeof e){case"boolean":case"number":return null}if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)for(let i=0;i<t.length;i++){const s=t[i];if("HTMLImageArray"!==s.type&&s)continue;if(s.uploadValue!==e)continue;const a=n[i].indexOf(e);if(-1===a)continue;const o=`uploadValue_${s.name}[${a}]`;return r.insertVariable(o,e),o}for(let n=0;n<t.length;n++){const i=t[n];if(e!==i.uploadValue)continue;const s=`uploadValue_${i.name}`;return r.insertVariable(s,i),s}return null}t.exports={glKernelString:function(e,t,n,c,l){n.built||n.build.apply(n,t),t=t?Array.from(t).map((e=>{switch(typeof e){case"boolean":return new Boolean(e);case"number":return new Number(e);default:return e}})):null;const h=[],p=r(n.context,{useTrackablePrimitives:!0,onReadPixels:e=>{if(F.subKernels){if(d){const t=F.subKernels[f++].property;h.push(`    result${isNaN(t)?"."+t:`[${t}]`} = ${a(e,F)};`)}else h.push(`    const result = { result: ${a(e,F)} };`),d=!0;f===F.subKernels.length&&h.push("    return result;")}else e?h.push(`    return ${a(e,F)};`):h.push("    return null;")},onUnrecognizedArgumentLookup:e=>{const t=u(e,F.kernelArguments,[],p);return t||(u(e,F.kernelConstants,w?Object.keys(w).map((e=>w[e])):[],p)||null)}});let d=!1,f=0;const{source:m,canvas:g,output:y,pipeline:v,graphical:b,loopMaxIterations:x,constants:w,optimizeFloatMemory:S,precision:T,fixIntegerDivisionAccuracy:C,functions:A,nativeFunctions:_,subKernels:k,immutable:I,argumentTypes:E,constantTypes:O,kernelArguments:D,kernelConstants:B,tactic:P}=n,F=new e(m,{canvas:g,context:p,checkContext:!1,output:y,pipeline:v,graphical:b,loopMaxIterations:x,constants:w,optimizeFloatMemory:S,precision:T,fixIntegerDivisionAccuracy:C,functions:A,nativeFunctions:_,subKernels:k,immutable:I,argumentTypes:E,constantTypes:O,tactic:P});let N=[];if(p.setIndent(2),F.build.apply(F,t),N.push(p.toString()),p.reset(),F.kernelArguments.forEach(((e,n)=>{switch(e.type){case"Integer":case"Boolean":case"Number":case"Float":case"Array":case"Array(2)":case"Array(3)":case"Array(4)":case"HTMLCanvas":case"HTMLImage":case"HTMLVideo":p.insertVariable(`uploadValue_${e.name}`,e.uploadValue);break;case"HTMLImageArray":for(let r=0;r<t[n].length;r++){const i=t[n];p.insertVariable(`uploadValue_${e.name}[${r}]`,i[r])}break;case"Input":p.insertVariable(`uploadValue_${e.name}`,e.uploadValue);break;case"MemoryOptimizedNumberTexture":case"NumberTexture":case"Array1D(2)":case"Array1D(3)":case"Array1D(4)":case"Array2D(2)":case"Array2D(3)":case"Array2D(4)":case"Array3D(2)":case"Array3D(3)":case"Array3D(4)":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":p.insertVariable(`uploadValue_${e.name}`,t[n].texture);break;default:throw new Error(`unhandled kernelArgumentType insertion for glWiretap of type ${e.type}`)}})),N.push("/** start of injected functions **/"),N.push(`function ${s(i.flattenTo)}`),N.push(`function ${s(i.flatten2dArrayTo)}`),N.push(`function ${s(i.flatten3dArrayTo)}`),N.push(`function ${s(i.flatten4dArrayTo)}`),N.push(`function ${s(i.isArray)}`),F.renderOutput!==F.renderTexture&&F.formatValues&&N.push(`  const renderOutput = function ${s(F.formatValues)};`),N.push("/** end of injected functions **/"),N.push(`  const innerKernel = function (${F.kernelArguments.map((e=>e.varName)).join(", ")}) {`),p.setIndent(4),F.run.apply(F,t),F.renderKernels?F.renderKernels():F.renderOutput&&F.renderOutput(),N.push("    /** start setup uploads for kernel values **/"),F.kernelArguments.forEach((e=>{N.push("    "+e.getStringValueHandler().split("\n").join("\n    "))})),N.push("    /** end setup uploads for kernel values **/"),N.push(p.toString()),F.renderOutput===F.renderTexture){p.reset();const e=p.getContextVariableName(F.framebuffer);if(F.renderKernels){const t=F.renderKernels(),n=p.getContextVariableName(F.texture.texture);N.push(`    return {\n      result: {\n        texture: ${n},\n        type: '${t.result.type}',\n        toArray: ${o(t.result,n,e)}\n      },`);const{subKernels:r,mappedTextures:i}=F;for(let n=0;n<r.length;n++){const s=i[n],a=r[n],u=t[a.property],c=p.getContextVariableName(s.texture);N.push(`\n      ${a.property}: {\n        texture: ${c},\n        type: '${u.type}',\n        toArray: ${o(u,c,e)}\n      },`)}N.push("    };")}else{const t=F.renderOutput(),n=p.getContextVariableName(F.texture.texture);N.push(`    return {\n        texture: ${n},\n        type: '${t.type}',\n        toArray: ${o(t,n,e)}\n      };`)}}N.push("    "+(l?"\n"+l+"    ":"")),N.push(h.join("\n")),N.push("  };"),F.graphical&&(N.push(function(e){const t=e.getPixels.toString(),n=!/^function/.test(t);return i.flattenFunctionToString(`${n?"function ":""}${t}`,{findDependency:(e,t)=>"utils"===e?`const ${t} = ${i[t].toString()};`:null,thisLookup:t=>{if("context"===t)return null;if(e.hasOwnProperty(t))return JSON.stringify(e[t]);throw new Error(`unhandled thisLookup ${t}`)}})}(F)),N.push("  innerKernel.getPixels = getPixels;")),N.push("  return innerKernel;");let R=[];return B.forEach((e=>{R.push(`${e.getStringValueHandler()}`)})),`function kernel(settings) {\n  const { context, constants } = settings;\n  ${R.join("")}\n  ${c||""}\n${N.join("\n")}\n}`}}},{"../../utils":114,"gl-wiretap":3}],13:[function(e,t,n){const{Kernel:r}=e("../kernel"),{utils:i}=e("../../utils"),{GLTextureArray2Float:s}=e("./texture/array-2-float"),{GLTextureArray2Float2D:a}=e("./texture/array-2-float-2d"),{GLTextureArray2Float3D:o}=e("./texture/array-2-float-3d"),{GLTextureArray3Float:u}=e("./texture/array-3-float"),{GLTextureArray3Float2D:c}=e("./texture/array-3-float-2d"),{GLTextureArray3Float3D:l}=e("./texture/array-3-float-3d"),{GLTextureArray4Float:h}=e("./texture/array-4-float"),{GLTextureArray4Float2D:p}=e("./texture/array-4-float-2d"),{GLTextureArray4Float3D:d}=e("./texture/array-4-float-3d"),{GLTextureFloat:f}=e("./texture/float"),{GLTextureFloat2D:m}=e("./texture/float-2d"),{GLTextureFloat3D:g}=e("./texture/float-3d"),{GLTextureMemoryOptimized:y}=e("./texture/memory-optimized"),{GLTextureMemoryOptimized2D:v}=e("./texture/memory-optimized-2d"),{GLTextureMemoryOptimized3D:b}=e("./texture/memory-optimized-3d"),{GLTextureUnsigned:x}=e("./texture/unsigned"),{GLTextureUnsigned2D:w}=e("./texture/unsigned-2d"),{GLTextureUnsigned3D:S}=e("./texture/unsigned-3d"),{GLTextureGraphical:T}=e("./texture/graphical"),C={int:"Integer",float:"Number",vec2:"Array(2)",vec3:"Array(3)",vec4:"Array(4)"};t.exports={GLKernel:class extends r{static get mode(){return"gpu"}static getIsFloatRead(){const e=new this("function kernelFunction() {\n      return 1;\n    }",{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[1],precision:"single",returnType:"Number",tactic:"speed"});e.build(),e.run();const t=e.renderOutput();return e.destroy(!0),1===t[0]}static getIsIntegerDivisionAccurate(){const e=new this(function(e,t){return e[this.thread.x]/t[this.thread.x]}.toString(),{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[2],returnType:"Number",precision:"unsigned",tactic:"speed"}),t=[[6,6030401],[3,3991]];e.build.apply(e,t),e.run.apply(e,t);const n=e.renderOutput();return e.destroy(!0),2===n[0]&&1511===n[1]}static getIsSpeedTacticSupported(){const e=new this(function(e){return e[this.thread.x]}.toString(),{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[4],returnType:"Number",precision:"unsigned",tactic:"speed"}),t=[[0,1,2,3]];e.build.apply(e,t),e.run.apply(e,t);const n=e.renderOutput();return e.destroy(!0),0===Math.round(n[0])&&1===Math.round(n[1])&&2===Math.round(n[2])&&3===Math.round(n[3])}static get testCanvas(){throw new Error(`"testCanvas" not defined on ${this.name}`)}static get testContext(){throw new Error(`"testContext" not defined on ${this.name}`)}static getFeatures(){const e=this.testContext,t=this.getIsDrawBuffers();return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isSpeedTacticSupported:this.getIsSpeedTacticSupported(),isTextureFloat:this.getIsTextureFloat(),isDrawBuffers:t,kernelMap:t,channelCount:this.getChannelCount(),maxTextureSize:this.getMaxTextureSize(),lowIntPrecision:e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_INT),lowFloatPrecision:e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_FLOAT),mediumIntPrecision:e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_INT),mediumFloatPrecision:e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT),highIntPrecision:e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_INT),highFloatPrecision:e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT)})}static setupFeatureChecks(){throw new Error(`"setupFeatureChecks" not defined on ${this.name}`)}static getSignature(e,t){return e.getVariablePrecisionString()+(t.length>0?":"+t.join(","):"")}setFixIntegerDivisionAccuracy(e){return this.fixIntegerDivisionAccuracy=e,this}setPrecision(e){return this.precision=e,this}setFloatTextures(e){return i.warnDeprecated("method","setFloatTextures","setOptimizeFloatMemory"),this.floatTextures=e,this}static nativeFunctionArguments(e){const t=[],n=[],r=[],i=/^[a-zA-Z_]/,s=/[a-zA-Z_0-9]/;let a=0,o=null,u=null;for(;a<e.length;){const c=e[a],l=e[a+1],h=r.length>0?r[r.length-1]:null;if("FUNCTION_ARGUMENTS"!==h||"/"!==c||"*"!==l)if("MULTI_LINE_COMMENT"!==h||"*"!==c||"/"!==l)if("FUNCTION_ARGUMENTS"!==h||"/"!==c||"/"!==l)if("COMMENT"!==h||"\n"!==c)if(null!==h||"("!==c){if("FUNCTION_ARGUMENTS"===h){if(")"===c){r.pop();break}if("f"===c&&"l"===l&&"o"===e[a+2]&&"a"===e[a+3]&&"t"===e[a+4]&&" "===e[a+5]){r.push("DECLARE_VARIABLE"),u="float",o="",a+=6;continue}if("i"===c&&"n"===l&&"t"===e[a+2]&&" "===e[a+3]){r.push("DECLARE_VARIABLE"),u="int",o="",a+=4;continue}if("v"===c&&"e"===l&&"c"===e[a+2]&&"2"===e[a+3]&&" "===e[a+4]){r.push("DECLARE_VARIABLE"),u="vec2",o="",a+=5;continue}if("v"===c&&"e"===l&&"c"===e[a+2]&&"3"===e[a+3]&&" "===e[a+4]){r.push("DECLARE_VARIABLE"),u="vec3",o="",a+=5;continue}if("v"===c&&"e"===l&&"c"===e[a+2]&&"4"===e[a+3]&&" "===e[a+4]){r.push("DECLARE_VARIABLE"),u="vec4",o="",a+=5;continue}}else if("DECLARE_VARIABLE"===h){if(""===o){if(" "===c){a++;continue}if(!i.test(c))throw new Error("variable name is not expected string")}o+=c,s.test(l)||(r.pop(),n.push(o),t.push(C[u]))}a++}else r.push("FUNCTION_ARGUMENTS"),a++;else r.pop(),a++;else r.push("COMMENT"),a+=2;else r.pop(),a+=2;else r.push("MULTI_LINE_COMMENT"),a+=2}if(r.length>0)throw new Error("GLSL function was not parsable");return{argumentNames:n,argumentTypes:t}}static nativeFunctionReturnType(e){return C[e.match(/int|float|vec[2-4]/)[0]]}static combineKernels(e,t){e.apply(null,arguments);const{texSize:n,context:r,threadDim:s}=t.texSize;let a;if("single"===t.precision){const e=n[0],t=Math.ceil(n[1]/4);a=new Float32Array(e*t*4*4),r.readPixels(0,0,e,4*t,r.RGBA,r.FLOAT,a)}else{const e=new Uint8Array(n[0]*n[1]*4);r.readPixels(0,0,n[0],n[1],r.RGBA,r.UNSIGNED_BYTE,e),a=new Float32Array(e.buffer)}return a=a.subarray(0,s[0]*s[1]*s[2]),1===t.output.length?a:2===t.output.length?i.splitArray(a,t.output[0]):3===t.output.length?i.splitArray(a,t.output[0]*t.output[1]).map((function(e){return i.splitArray(e,t.output[0])})):void 0}constructor(e,t){super(e,t),this.transferValues=null,this.formatValues=null,this.TextureConstructor=null,this.renderOutput=null,this.renderRawOutput=null,this.texSize=null,this.translatedSource=null,this.compiledFragmentShader=null,this.compiledVertexShader=null,this.switchingKernels=null,this._textureSwitched=null,this._mappedTextureSwitched=null}checkTextureSize(){const{features:e}=this.constructor;if(this.texSize[0]>e.maxTextureSize||this.texSize[1]>e.maxTextureSize)throw new Error(`Texture size [${this.texSize[0]},${this.texSize[1]}] generated by kernel is larger than supported size [${e.maxTextureSize},${e.maxTextureSize}]`)}translateSource(){throw new Error(`"translateSource" not defined on ${this.constructor.name}`)}pickRenderStrategy(e){if(this.graphical)return this.renderRawOutput=this.readPackedPixelsToUint8Array,this.transferValues=e=>e,this.TextureConstructor=T,null;if("unsigned"===this.precision)if(this.renderRawOutput=this.readPackedPixelsToUint8Array,this.transferValues=this.readPackedPixelsToFloat32Array,this.pipeline)switch(this.renderOutput=this.renderTexture,null!==this.subKernels&&(this.renderKernels=this.renderKernelsToTextures),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=S,null):this.output[1]>0?(this.TextureConstructor=w,null):(this.TextureConstructor=x,null);case"Array(2)":case"Array(3)":case"Array(4)":return this.requestFallback(e)}else switch(null!==this.subKernels&&(this.renderKernels=this.renderKernelsToArrays),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.renderOutput=this.renderValues,this.output[2]>0?(this.TextureConstructor=S,this.formatValues=i.erect3DPackedFloat,null):this.output[1]>0?(this.TextureConstructor=w,this.formatValues=i.erect2DPackedFloat,null):(this.TextureConstructor=x,this.formatValues=i.erectPackedFloat,null);case"Array(2)":case"Array(3)":case"Array(4)":return this.requestFallback(e)}else{if("single"!==this.precision)throw new Error(`unhandled precision of "${this.precision}"`);if(this.renderRawOutput=this.readFloatPixelsToFloat32Array,this.transferValues=this.readFloatPixelsToFloat32Array,this.pipeline)switch(this.renderOutput=this.renderTexture,null!==this.subKernels&&(this.renderKernels=this.renderKernelsToTextures),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.optimizeFloatMemory?this.output[2]>0?(this.TextureConstructor=b,null):this.output[1]>0?(this.TextureConstructor=v,null):(this.TextureConstructor=y,null):this.output[2]>0?(this.TextureConstructor=g,null):this.output[1]>0?(this.TextureConstructor=m,null):(this.TextureConstructor=f,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=o,null):this.output[1]>0?(this.TextureConstructor=a,null):(this.TextureConstructor=s,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=l,null):this.output[1]>0?(this.TextureConstructor=c,null):(this.TextureConstructor=u,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=d,null):this.output[1]>0?(this.TextureConstructor=p,null):(this.TextureConstructor=h,null)}if(this.renderOutput=this.renderValues,null!==this.subKernels&&(this.renderKernels=this.renderKernelsToArrays),this.optimizeFloatMemory)switch(this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=b,this.formatValues=i.erectMemoryOptimized3DFloat,null):this.output[1]>0?(this.TextureConstructor=v,this.formatValues=i.erectMemoryOptimized2DFloat,null):(this.TextureConstructor=y,this.formatValues=i.erectMemoryOptimizedFloat,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=o,this.formatValues=i.erect3DArray2,null):this.output[1]>0?(this.TextureConstructor=a,this.formatValues=i.erect2DArray2,null):(this.TextureConstructor=s,this.formatValues=i.erectArray2,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=l,this.formatValues=i.erect3DArray3,null):this.output[1]>0?(this.TextureConstructor=c,this.formatValues=i.erect2DArray3,null):(this.TextureConstructor=u,this.formatValues=i.erectArray3,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=d,this.formatValues=i.erect3DArray4,null):this.output[1]>0?(this.TextureConstructor=p,this.formatValues=i.erect2DArray4,null):(this.TextureConstructor=h,this.formatValues=i.erectArray4,null)}else switch(this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=g,this.formatValues=i.erect3DFloat,null):this.output[1]>0?(this.TextureConstructor=m,this.formatValues=i.erect2DFloat,null):(this.TextureConstructor=f,this.formatValues=i.erectFloat,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=o,this.formatValues=i.erect3DArray2,null):this.output[1]>0?(this.TextureConstructor=a,this.formatValues=i.erect2DArray2,null):(this.TextureConstructor=s,this.formatValues=i.erectArray2,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=l,this.formatValues=i.erect3DArray3,null):this.output[1]>0?(this.TextureConstructor=c,this.formatValues=i.erect2DArray3,null):(this.TextureConstructor=u,this.formatValues=i.erectArray3,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=d,this.formatValues=i.erect3DArray4,null):this.output[1]>0?(this.TextureConstructor=p,this.formatValues=i.erect2DArray4,null):(this.TextureConstructor=h,this.formatValues=i.erectArray4,null)}}throw new Error(`unhandled return type "${this.returnType}"`)}getKernelString(){throw new Error("abstract method call")}getMainResultTexture(){switch(this.returnType){case"LiteralInteger":case"Float":case"Integer":case"Number":return this.getMainResultNumberTexture();case"Array(2)":return this.getMainResultArray2Texture();case"Array(3)":return this.getMainResultArray3Texture();case"Array(4)":return this.getMainResultArray4Texture();default:throw new Error(`unhandled returnType type ${this.returnType}`)}}getMainResultKernelNumberTexture(){throw new Error("abstract method call")}getMainResultSubKernelNumberTexture(){throw new Error("abstract method call")}getMainResultKernelArray2Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray2Texture(){throw new Error("abstract method call")}getMainResultKernelArray3Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray3Texture(){throw new Error("abstract method call")}getMainResultKernelArray4Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray4Texture(){throw new Error("abstract method call")}getMainResultGraphical(){throw new Error("abstract method call")}getMainResultMemoryOptimizedFloats(){throw new Error("abstract method call")}getMainResultPackedPixels(){throw new Error("abstract method call")}getMainResultString(){return this.graphical?this.getMainResultGraphical():"single"===this.precision?this.optimizeFloatMemory?this.getMainResultMemoryOptimizedFloats():this.getMainResultTexture():this.getMainResultPackedPixels()}getMainResultNumberTexture(){return i.linesToString(this.getMainResultKernelNumberTexture())+i.linesToString(this.getMainResultSubKernelNumberTexture())}getMainResultArray2Texture(){return i.linesToString(this.getMainResultKernelArray2Texture())+i.linesToString(this.getMainResultSubKernelArray2Texture())}getMainResultArray3Texture(){return i.linesToString(this.getMainResultKernelArray3Texture())+i.linesToString(this.getMainResultSubKernelArray3Texture())}getMainResultArray4Texture(){return i.linesToString(this.getMainResultKernelArray4Texture())+i.linesToString(this.getMainResultSubKernelArray4Texture())}getFloatTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} float;\n`}getIntTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic,!0)} int;\n`}getSampler2DTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} sampler2D;\n`}getSampler2DArrayTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} sampler2DArray;\n`}renderTexture(){return this.immutable?this.texture.clone():this.texture}readPackedPixelsToUint8Array(){if("unsigned"!==this.precision)throw new Error('Requires this.precision to be "unsigned"');const{texSize:e,context:t}=this,n=new Uint8Array(e[0]*e[1]*4);return t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,n),n}readPackedPixelsToFloat32Array(){return new Float32Array(this.readPackedPixelsToUint8Array().buffer)}readFloatPixelsToFloat32Array(){if("single"!==this.precision)throw new Error('Requires this.precision to be "single"');const{texSize:e,context:t}=this,n=e[0],r=e[1],i=new Float32Array(n*r*4);return t.readPixels(0,0,n,r,t.RGBA,t.FLOAT,i),i}getPixels(e){const{context:t,output:n}=this,[r,s]=n,a=new Uint8Array(r*s*4);return t.readPixels(0,0,r,s,t.RGBA,t.UNSIGNED_BYTE,a),new Uint8ClampedArray((e?a:i.flipPixels(a,r,s)).buffer)}renderKernelsToArrays(){const e={result:this.renderOutput()};for(let t=0;t<this.subKernels.length;t++)e[this.subKernels[t].property]=this.mappedTextures[t].toArray();return e}renderKernelsToTextures(){const e={result:this.renderOutput()};if(this.immutable)for(let t=0;t<this.subKernels.length;t++)e[this.subKernels[t].property]=this.mappedTextures[t].clone();else for(let t=0;t<this.subKernels.length;t++)e[this.subKernels[t].property]=this.mappedTextures[t];return e}resetSwitchingKernels(){const e=this.switchingKernels;return this.switchingKernels=null,e}setOutput(e){const t=this.toKernelOutput(e);if(this.program){if(!this.dynamicOutput)throw new Error("Resizing a kernel with dynamicOutput: false is not possible");const n=[t[0],t[1]||1,t[2]||1],r=i.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},n),s=this.texSize;if(s){const t=this.getVariablePrecisionString(s,this.tactic),n=this.getVariablePrecisionString(r,this.tactic);if(t!==n)return this.debug&&console.warn("Precision requirement changed, asking GPU instance to recompile"),void this.switchKernels({type:"outputPrecisionMismatch",precision:n,needed:e})}this.output=t,this.threadDim=n,this.texSize=r;const{context:a}=this;if(a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer),this.updateMaxTexSize(),this.framebuffer.width=this.texSize[0],this.framebuffer.height=this.texSize[1],a.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),this.canvas.width=this.maxTexSize[0],this.canvas.height=this.maxTexSize[1],this.texture&&this.texture.delete(),this.texture=null,this._setupOutputTexture(),this.mappedTextures&&this.mappedTextures.length>0){for(let e=0;e<this.mappedTextures.length;e++)this.mappedTextures[e].delete();this.mappedTextures=null,this._setupSubOutputTextures()}}else this.output=t;return this}renderValues(){return this.formatValues(this.transferValues(),this.output[0],this.output[1],this.output[2])}switchKernels(e){this.switchingKernels?this.switchingKernels.push(e):this.switchingKernels=[e]}getVariablePrecisionString(e=this.texSize,t=this.tactic,n=!1){if(!t){if(!this.constructor.features.isSpeedTacticSupported)return"highp";const t=this.constructor.features[n?"lowIntPrecision":"lowFloatPrecision"],r=this.constructor.features[n?"mediumIntPrecision":"mediumFloatPrecision"],i=this.constructor.features[n?"highIntPrecision":"highFloatPrecision"],s=Math.log2(e[0]*e[1]);if(s<=t.rangeMax)return"lowp";if(s<=r.rangeMax)return"mediump";if(s<=i.rangeMax)return"highp";throw new Error("The required size exceeds that of the ability of your system")}switch(t){case"speed":return"lowp";case"balanced":return"mediump";case"precision":return"highp";default:throw new Error(`Unknown tactic "${t}" use "speed", "balanced", "precision", or empty for auto`)}}updateTextureArgumentRefs(e,t){if(this.immutable)if(this.texture.texture===t.texture){const{prevArg:n}=e;n&&(1===n.texture._refs&&(this.texture.delete(),this.texture=n.clone(),this._textureSwitched=!0),n.delete()),e.prevArg=t.clone()}else if(this.mappedTextures&&this.mappedTextures.length>0){const{mappedTextures:n}=this;for(let r=0;r<n.length;r++){const i=n[r];if(i.texture===t.texture){const{prevArg:s}=e;return s&&(1===s.texture._refs&&(i.delete(),n[r]=s.clone(),this._mappedTextureSwitched[r]=!0),s.delete()),void(e.prevArg=t.clone())}}}}onActivate(e){if(this._textureSwitched=!0,this.texture=e.texture,this.mappedTextures){for(let e=0;e<this.mappedTextures.length;e++)this._mappedTextureSwitched[e]=!0;this.mappedTextures=e.mappedTextures}}initCanvas(){}}}},{"../../utils":114,"../kernel":36,"./texture/array-2-float":16,"./texture/array-2-float-2d":14,"./texture/array-2-float-3d":15,"./texture/array-3-float":19,"./texture/array-3-float-2d":17,"./texture/array-3-float-3d":18,"./texture/array-4-float":22,"./texture/array-4-float-2d":20,"./texture/array-4-float-3d":21,"./texture/float":25,"./texture/float-2d":23,"./texture/float-3d":24,"./texture/graphical":26,"./texture/memory-optimized":30,"./texture/memory-optimized-2d":28,"./texture/memory-optimized-3d":29,"./texture/unsigned":33,"./texture/unsigned-2d":31,"./texture/unsigned-3d":32}],14:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureArray2Float2D:class extends i{constructor(e){super(e),this.type="ArrayTexture(2)"}toArray(){return r.erect2DArray2(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./float":25}],15:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureArray2Float3D:class extends i{constructor(e){super(e),this.type="ArrayTexture(2)"}toArray(){return r.erect3DArray2(this.renderValues(),this.output[0],this.output[1],this.output[2])}}}},{"../../../utils":114,"./float":25}],16:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureArray2Float:class extends i{constructor(e){super(e),this.type="ArrayTexture(2)"}toArray(){return r.erectArray2(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./float":25}],17:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureArray3Float2D:class extends i{constructor(e){super(e),this.type="ArrayTexture(3)"}toArray(){return r.erect2DArray3(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./float":25}],18:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureArray3Float3D:class extends i{constructor(e){super(e),this.type="ArrayTexture(3)"}toArray(){return r.erect3DArray3(this.renderValues(),this.output[0],this.output[1],this.output[2])}}}},{"../../../utils":114,"./float":25}],19:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureArray3Float:class extends i{constructor(e){super(e),this.type="ArrayTexture(3)"}toArray(){return r.erectArray3(this.renderValues(),this.output[0])}}}},{"../../../utils":114,"./float":25}],20:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureArray4Float2D:class extends i{constructor(e){super(e),this.type="ArrayTexture(4)"}toArray(){return r.erect2DArray4(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./float":25}],21:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureArray4Float3D:class extends i{constructor(e){super(e),this.type="ArrayTexture(4)"}toArray(){return r.erect3DArray4(this.renderValues(),this.output[0],this.output[1],this.output[2])}}}},{"../../../utils":114,"./float":25}],22:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureArray4Float:class extends i{constructor(e){super(e),this.type="ArrayTexture(4)"}toArray(){return r.erectArray4(this.renderValues(),this.output[0])}}}},{"../../../utils":114,"./float":25}],23:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureFloat2D:class extends i{constructor(e){super(e),this.type="ArrayTexture(1)"}toArray(){return r.erect2DFloat(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./float":25}],24:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureFloat3D:class extends i{constructor(e){super(e),this.type="ArrayTexture(1)"}toArray(){return r.erect3DFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}}},{"../../../utils":114,"./float":25}],25:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTexture:i}=e("./index");t.exports={GLTextureFloat:class extends i{get textureType(){return this.context.FLOAT}constructor(e){super(e),this.type="ArrayTexture(1)"}renderRawOutput(){const e=this.context,t=this.size;e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer()),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0);const n=new Float32Array(t[0]*t[1]*4);return e.readPixels(0,0,t[0],t[1],e.RGBA,e.FLOAT,n),n}renderValues(){return this._deleted?null:this.renderRawOutput()}toArray(){return r.erectFloat(this.renderValues(),this.output[0])}}}},{"../../../utils":114,"./index":27}],26:[function(e,t,n){const{GLTextureUnsigned:r}=e("./unsigned");t.exports={GLTextureGraphical:class extends r{constructor(e){super(e),this.type="ArrayTexture(4)"}toArray(){return this.renderValues()}}}},{"./unsigned":33}],27:[function(e,t,n){const{Texture:r}=e("../../../texture");function i(e,t){e.activeTexture(e.TEXTURE15),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)}t.exports={GLTexture:class extends r{get textureType(){throw new Error(`"textureType" not implemented on ${this.name}`)}clone(){return new this.constructor(this)}beforeMutate(){return this.texture._refs>1&&(this.newTexture(),!0)}cloneTexture(){this.texture._refs--;const{context:e,size:t,texture:n,kernel:r}=this;r.debug&&console.warn("cloning internal texture"),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer()),i(e,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const s=e.createTexture();i(e,s),e.texImage2D(e.TEXTURE_2D,0,this.internalFormat,t[0],t[1],0,this.textureFormat,this.textureType,null),e.copyTexSubImage2D(e.TEXTURE_2D,0,0,0,0,0,t[0],t[1]),s._refs=1,this.texture=s}newTexture(){this.texture._refs--;const e=this.context,t=this.size;this.kernel.debug&&console.warn("new internal texture");const n=e.createTexture();i(e,n),e.texImage2D(e.TEXTURE_2D,0,this.internalFormat,t[0],t[1],0,this.textureFormat,this.textureType,null),n._refs=1,this.texture=n}clear(){if(this.texture._refs){this.texture._refs--;const e=this.context,t=this.texture=e.createTexture();i(e,t);const n=this.size;t._refs=1,e.texImage2D(e.TEXTURE_2D,0,this.internalFormat,n[0],n[1],0,this.textureFormat,this.textureType,null)}const{context:e,texture:t}=this;e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer()),e.bindTexture(e.TEXTURE_2D,t),i(e,t),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}delete(){this._deleted||(this._deleted=!0,this.texture._refs&&(this.texture._refs--,this.texture._refs)||this.context.deleteTexture(this.texture))}framebuffer(){return this._framebuffer||(this._framebuffer=this.kernel.getRawValueFramebuffer(this.size[0],this.size[1])),this._framebuffer}}}},{"../../../texture":113}],28:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureMemoryOptimized2D:class extends i{constructor(e){super(e),this.type="MemoryOptimizedNumberTexture"}toArray(){return r.erectMemoryOptimized2DFloat(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./float":25}],29:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureMemoryOptimized3D:class extends i{constructor(e){super(e),this.type="MemoryOptimizedNumberTexture"}toArray(){return r.erectMemoryOptimized3DFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}}},{"../../../utils":114,"./float":25}],30:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureFloat:i}=e("./float");t.exports={GLTextureMemoryOptimized:class extends i{constructor(e){super(e),this.type="MemoryOptimizedNumberTexture"}toArray(){return r.erectMemoryOptimizedFloat(this.renderValues(),this.output[0])}}}},{"../../../utils":114,"./float":25}],31:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureUnsigned:i}=e("./unsigned");t.exports={GLTextureUnsigned2D:class extends i{constructor(e){super(e),this.type="NumberTexture"}toArray(){return r.erect2DPackedFloat(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./unsigned":33}],32:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTextureUnsigned:i}=e("./unsigned");t.exports={GLTextureUnsigned3D:class extends i{constructor(e){super(e),this.type="NumberTexture"}toArray(){return r.erect3DPackedFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}}},{"../../../utils":114,"./unsigned":33}],33:[function(e,t,n){const{utils:r}=e("../../../utils"),{GLTexture:i}=e("./index");t.exports={GLTextureUnsigned:class extends i{get textureType(){return this.context.UNSIGNED_BYTE}constructor(e){super(e),this.type="NumberTexture"}renderRawOutput(){const{context:e}=this;e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer()),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0);const t=new Uint8Array(this.size[0]*this.size[1]*4);return e.readPixels(0,0,this.size[0],this.size[1],e.RGBA,e.UNSIGNED_BYTE,t),t}renderValues(){return this._deleted?null:new Float32Array(this.renderRawOutput().buffer)}toArray(){return r.erectPackedFloat(this.renderValues(),this.output[0])}}}},{"../../../utils":114,"./index":27}],34:[function(e,t,n){const r=e("gl"),{WebGLKernel:i}=e("../web-gl/kernel"),{glKernelString:s}=e("../gl/kernel-string");let a=null,o=null,u=null,c=null,l=null;t.exports={HeadlessGLKernel:class extends i{static get isSupported(){return null!==a||(this.setupFeatureChecks(),a=null!==u),a}static setupFeatureChecks(){if(o=null,c=null,"function"==typeof r)try{if(u=r(2,2,{preserveDrawingBuffer:!0}),!u||!u.getExtension)return;c={STACKGL_resize_drawingbuffer:u.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:u.getExtension("STACKGL_destroy_context"),OES_texture_float:u.getExtension("OES_texture_float"),OES_texture_float_linear:u.getExtension("OES_texture_float_linear"),OES_element_index_uint:u.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:u.getExtension("WEBGL_draw_buffers"),WEBGL_color_buffer_float:u.getExtension("WEBGL_color_buffer_float")},l=this.getFeatures()}catch(e){console.warn(e)}}static isContextMatch(e){try{return"ANGLE"===e.getParameter(e.RENDERER)}catch(e){return!1}}static getIsTextureFloat(){return Boolean(c.OES_texture_float)}static getIsDrawBuffers(){return Boolean(c.WEBGL_draw_buffers)}static getChannelCount(){return c.WEBGL_draw_buffers?u.getParameter(c.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1}static getMaxTextureSize(){return u.getParameter(u.MAX_TEXTURE_SIZE)}static get testCanvas(){return o}static get testContext(){return u}static get features(){return l}initCanvas(){return{}}initContext(){return r(2,2,{preserveDrawingBuffer:!0})}initExtensions(){this.extensions={STACKGL_resize_drawingbuffer:this.context.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:this.context.getExtension("STACKGL_destroy_context"),OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers")}}build(){super.build.apply(this,arguments),this.fallbackRequested||this.extensions.STACKGL_resize_drawingbuffer.resize(this.maxTexSize[0],this.maxTexSize[1])}destroyExtensions(){this.extensions.STACKGL_resize_drawingbuffer=null,this.extensions.STACKGL_destroy_context=null,this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null,this.extensions.WEBGL_draw_buffers=null}static destroyContext(e){const t=e.getExtension("STACKGL_destroy_context");t&&t.destroy&&t.destroy()}toString(){return s(this.constructor,arguments,this,"const gl = context || require('gl')(1, 1);\n","    if (!context) { gl.getExtension('STACKGL_destroy_context').destroy(); }\n")}setOutput(e){return super.setOutput(e),this.graphical&&this.extensions.STACKGL_resize_drawingbuffer&&this.extensions.STACKGL_resize_drawingbuffer.resize(this.maxTexSize[0],this.maxTexSize[1]),this}}}},{"../gl/kernel-string":12,"../web-gl/kernel":70,gl:2}],35:[function(e,t,n){t.exports={KernelValue:class{constructor(e,t){const{name:n,kernel:r,context:i,checkContext:s,onRequestContextHandle:a,onUpdateValueMismatch:o,origin:u,strictIntegers:c,type:l,tactic:h}=t;if(!n)throw new Error("name not set");if(!l)throw new Error("type not set");if(!u)throw new Error("origin not set");if("user"!==u&&"constants"!==u)throw new Error(`origin must be "user" or "constants" value is "${u}"`);if(!a)throw new Error("onRequestContextHandle is not set");this.name=n,this.origin=u,this.tactic=h,this.varName="constants"===u?`constants.${n}`:n,this.kernel=r,this.strictIntegers=c,this.type=e.type||l,this.size=e.size||null,this.index=null,this.context=i,this.checkContext=null==s||s,this.contextHandle=null,this.onRequestContextHandle=a,this.onUpdateValueMismatch=o,this.forceUploadEachRun=null}get id(){return`${this.origin}_${name}`}getSource(){throw new Error(`"getSource" not defined on ${this.constructor.name}`)}updateValue(e){throw new Error(`"updateValue" not defined on ${this.constructor.name}`)}}}},{}],36:[function(e,t,n){const{utils:r}=e("../utils"),{Input:i}=e("../input");t.exports={Kernel:class{static get isSupported(){throw new Error(`"isSupported" not implemented on ${this.name}`)}static isContextMatch(e){throw new Error(`"isContextMatch" not implemented on ${this.name}`)}static getFeatures(){throw new Error(`"getFeatures" not implemented on ${this.name}`)}static destroyContext(e){throw new Error(`"destroyContext" called on ${this.name}`)}static nativeFunctionArguments(){throw new Error(`"nativeFunctionArguments" called on ${this.name}`)}static nativeFunctionReturnType(){throw new Error(`"nativeFunctionReturnType" called on ${this.name}`)}static combineKernels(){throw new Error(`"combineKernels" called on ${this.name}`)}constructor(e,t){if("object"!=typeof e){if("string"!=typeof e)throw new Error("source not a string");if(!r.isFunctionString(e))throw new Error("source not a function string")}this.useLegacyEncoder=!1,this.fallbackRequested=!1,this.onRequestFallback=null,this.argumentNames="string"==typeof e?r.getArgumentNamesFromString(e):null,this.argumentTypes=null,this.argumentSizes=null,this.argumentBitRatios=null,this.kernelArguments=null,this.kernelConstants=null,this.forceUploadKernelConstants=null,this.source=e,this.output=null,this.debug=!1,this.graphical=!1,this.loopMaxIterations=0,this.constants=null,this.constantTypes=null,this.constantBitRatios=null,this.dynamicArguments=!1,this.dynamicOutput=!1,this.canvas=null,this.context=null,this.checkContext=null,this.gpu=null,this.functions=null,this.nativeFunctions=null,this.injectedNative=null,this.subKernels=null,this.validate=!0,this.immutable=!1,this.pipeline=!1,this.precision=null,this.tactic=null,this.plugins=null,this.returnType=null,this.leadingReturnStatement=null,this.followingReturnStatement=null,this.optimizeFloatMemory=null,this.strictIntegers=!1,this.fixIntegerDivisionAccuracy=null,this.built=!1,this.signature=null}mergeSettings(e){for(let t in e)if(e.hasOwnProperty(t)&&this.hasOwnProperty(t)){switch(t){case"output":if(!Array.isArray(e.output)){this.setOutput(e.output);continue}break;case"functions":this.functions=[];for(let t=0;t<e.functions.length;t++)this.addFunction(e.functions[t]);continue;case"graphical":e[t]&&!e.hasOwnProperty("precision")&&(this.precision="unsigned"),this[t]=e[t];continue;case"nativeFunctions":if(!e.nativeFunctions)continue;this.nativeFunctions=[];for(let t=0;t<e.nativeFunctions.length;t++){const n=e.nativeFunctions[t],{name:r,source:i}=n;this.addNativeFunction(r,i,n)}continue}this[t]=e[t]}this.canvas||(this.canvas=this.initCanvas()),this.context||(this.context=this.initContext()),this.plugins||(this.plugins=this.initPlugins(e))}build(){throw new Error(`"build" not defined on ${this.constructor.name}`)}run(){throw new Error(`"run" not defined on ${this.constructor.name}`)}initCanvas(){throw new Error(`"initCanvas" not defined on ${this.constructor.name}`)}initContext(){throw new Error(`"initContext" not defined on ${this.constructor.name}`)}initPlugins(e){throw new Error(`"initPlugins" not defined on ${this.constructor.name}`)}addFunction(e,t={}){if(e.name&&e.source&&e.argumentTypes&&"returnType"in e)this.functions.push(e);else if("settings"in e&&"source"in e)this.functions.push(this.functionToIGPUFunction(e.source,e.settings));else{if("string"!=typeof e&&"function"!=typeof e)throw new Error("function not properly defined");this.functions.push(this.functionToIGPUFunction(e,t))}return this}addNativeFunction(e,t,n={}){const{argumentTypes:r,argumentNames:i}=n.argumentTypes?function(e){const t=Object.keys(e),n=[];for(let r=0;r<t.length;r++){const i=t[r];n.push(e[i])}return{argumentTypes:n,argumentNames:t}}(n.argumentTypes):this.constructor.nativeFunctionArguments(t)||{};return this.nativeFunctions.push({name:e,source:t,settings:n,argumentTypes:r,argumentNames:i,returnType:n.returnType||this.constructor.nativeFunctionReturnType(t)}),this}setupArguments(e){if(this.kernelArguments=[],this.argumentTypes)for(let e=0;e<this.argumentTypes.length;e++)this.kernelArguments.push({type:this.argumentTypes[e]});else if(!this.argumentTypes){this.argumentTypes=[];for(let t=0;t<e.length;t++){const n=r.getVariableType(e[t],this.strictIntegers),i="Integer"===n?"Number":n;this.argumentTypes.push(i),this.kernelArguments.push({type:i})}}this.argumentSizes=new Array(e.length),this.argumentBitRatios=new Int32Array(e.length);for(let t=0;t<e.length;t++){const n=e[t];this.argumentSizes[t]=n.constructor===i?n.size:null,this.argumentBitRatios[t]=this.getBitRatio(n)}if(this.argumentNames.length!==e.length)throw new Error("arguments are miss-aligned")}setupConstants(){this.kernelConstants=[];let e=null===this.constantTypes;if(e&&(this.constantTypes={}),this.constantBitRatios={},this.constants)for(let t in this.constants){if(e){const e=r.getVariableType(this.constants[t],this.strictIntegers);this.constantTypes[t]=e,this.kernelConstants.push({name:t,type:e})}else this.kernelConstants.push({name:t,type:this.constantTypes[t]});this.constantBitRatios[t]=this.getBitRatio(this.constants[t])}}setOptimizeFloatMemory(e){return this.optimizeFloatMemory=e,this}toKernelOutput(e){return e.hasOwnProperty("x")?e.hasOwnProperty("y")?e.hasOwnProperty("z")?[e.x,e.y,e.z]:[e.x,e.y]:[e.x]:e}setOutput(e){return this.output=this.toKernelOutput(e),this}setDebug(e){return this.debug=e,this}setGraphical(e){return this.graphical=e,this.precision="unsigned",this}setLoopMaxIterations(e){return this.loopMaxIterations=e,this}setConstants(e){return this.constants=e,this}setConstantTypes(e){return this.constantTypes=e,this}setFunctions(e){for(let t=0;t<e.length;t++)this.addFunction(e[t]);return this}setNativeFunctions(e){for(let t=0;t<e.length;t++){const n=e[t],{name:r,source:i}=n;this.addNativeFunction(r,i,n)}return this}setInjectedNative(e){return this.injectedNative=e,this}setPipeline(e){return this.pipeline=e,this}setPrecision(e){return this.precision=e,this}setDimensions(e){return r.warnDeprecated("method","setDimensions","setOutput"),this.output=e,this}setOutputToTexture(e){return r.warnDeprecated("method","setOutputToTexture","setPipeline"),this.pipeline=e,this}setImmutable(e){return this.immutable=e,this}setCanvas(e){return this.canvas=e,this}setStrictIntegers(e){return this.strictIntegers=e,this}setDynamicOutput(e){return this.dynamicOutput=e,this}setHardcodeConstants(e){return r.warnDeprecated("method","setHardcodeConstants"),this.setDynamicOutput(e),this.setDynamicArguments(e),this}setDynamicArguments(e){return this.dynamicArguments=e,this}setUseLegacyEncoder(e){return this.useLegacyEncoder=e,this}setWarnVarUsage(e){return r.warnDeprecated("method","setWarnVarUsage"),this}getCanvas(){return r.warnDeprecated("method","getCanvas"),this.canvas}getWebGl(){return r.warnDeprecated("method","getWebGl"),this.context}setContext(e){return this.context=e,this}setArgumentTypes(e){if(Array.isArray(e))this.argumentTypes=e;else{this.argumentTypes=[];for(const t in e){if(!e.hasOwnProperty(t))continue;const n=this.argumentNames.indexOf(t);if(-1===n)throw new Error(`unable to find argument ${t}`);this.argumentTypes[n]=e[t]}}return this}setTactic(e){return this.tactic=e,this}requestFallback(e){if(!this.onRequestFallback)throw new Error(`"onRequestFallback" not defined on ${this.constructor.name}`);return this.fallbackRequested=!0,this.onRequestFallback(e)}validateSettings(){throw new Error(`"validateSettings" not defined on ${this.constructor.name}`)}addSubKernel(e){if(null===this.subKernels&&(this.subKernels=[]),!e.source)throw new Error('subKernel missing "source" property');if(!e.property&&isNaN(e.property))throw new Error('subKernel missing "property" property');if(!e.name)throw new Error('subKernel missing "name" property');return this.subKernels.push(e),this}destroy(e){throw new Error(`"destroy" called on ${this.constructor.name}`)}getBitRatio(e){if("single"===this.precision)return 4;if(Array.isArray(e[0]))return this.getBitRatio(e[0]);if(e.constructor===i)return this.getBitRatio(e.value);switch(e.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:return 1;case Uint16Array:case Int16Array:return 2;case Float32Array:case Int32Array:default:return 4}}getPixels(e){throw new Error(`"getPixels" called on ${this.constructor.name}`)}checkOutput(){if(!this.output||!r.isArray(this.output))throw new Error("kernel.output not an array");if(this.output.length<1)throw new Error("kernel.output is empty, needs at least 1 value");for(let e=0;e<this.output.length;e++)if(isNaN(this.output[e])||this.output[e]<1)throw new Error(`${this.constructor.name}.output[${e}] incorrectly defined as \`${this.output[e]}\`, needs to be numeric, and greater than 0`)}prependString(e){throw new Error(`"prependString" called on ${this.constructor.name}`)}hasPrependString(e){throw new Error(`"hasPrependString" called on ${this.constructor.name}`)}toJSON(){return{settings:{output:this.output,pipeline:this.pipeline,argumentNames:this.argumentNames,argumentsTypes:this.argumentTypes,constants:this.constants,pluginNames:this.plugins?this.plugins.map((e=>e.name)):null,returnType:this.returnType}}}buildSignature(e){const t=this.constructor;this.signature=t.getSignature(this,t.getArgumentTypes(this,e))}static getArgumentTypes(e,t){const n=new Array(t.length);for(let i=0;i<t.length;i++){const s=t[i],a=e.argumentTypes[i];if(s.type)n[i]=s.type;else switch(a){case"Number":case"Integer":case"Float":case"ArrayTexture(1)":n[i]=r.getVariableType(s);break;default:n[i]=a}}return n}static getSignature(e,t){throw new Error(`"getSignature" not implemented on ${this.name}`)}functionToIGPUFunction(e,t={}){if("string"!=typeof e&&"function"!=typeof e)throw new Error("source not a string or function");const n="string"==typeof e?e:e.toString();let i=[];return i=Array.isArray(t.argumentTypes)?t.argumentTypes:"object"==typeof t.argumentTypes?r.getArgumentNamesFromString(n).map((e=>t.argumentTypes[e]))||[]:t.argumentTypes||[],{name:r.getFunctionNameFromString(n)||null,source:n,argumentTypes:i,returnType:t.returnType||null}}onActivate(e){}}}},{"../input":110,"../utils":114}],37:[function(e,t,n){const r=`__HEADER__;\n__FLOAT_TACTIC_DECLARATION__;\n__INT_TACTIC_DECLARATION__;\n__SAMPLER_2D_TACTIC_DECLARATION__;\n\nconst int LOOP_MAX = __LOOP_MAX__;\n\n__PLUGINS__;\n__CONSTANTS__;\n\nvarying vec2 vTexCoord;\n\nfloat acosh(float x) {\n  return log(x + sqrt(x * x - 1.0));\n}\n\nfloat sinh(float x) {\n  return (pow(${Math.E}, x) - pow(${Math.E}, -x)) / 2.0;\n}\n\nfloat asinh(float x) {\n  return log(x + sqrt(x * x + 1.0));\n}\n\nfloat atan2(float v1, float v2) {\n  if (v1 == 0.0 || v2 == 0.0) return 0.0;\n  return atan(v1 / v2);\n}\n\nfloat atanh(float x) {\n  x = (x + 1.0) / (x - 1.0);\n  if (x < 0.0) {\n    return 0.5 * log(-x);\n  }\n  return 0.5 * log(x);\n}\n\nfloat cbrt(float x) {\n  if (x >= 0.0) {\n    return pow(x, 1.0 / 3.0);\n  } else {\n    return -pow(x, 1.0 / 3.0);\n  }\n}\n\nfloat cosh(float x) {\n  return (pow(${Math.E}, x) + pow(${Math.E}, -x)) / 2.0; \n}\n\nfloat expm1(float x) {\n  return pow(${Math.E}, x) - 1.0; \n}\n\nfloat fround(highp float x) {\n  return x;\n}\n\nfloat imul(float v1, float v2) {\n  return float(int(v1) * int(v2));\n}\n\nfloat log10(float x) {\n  return log2(x) * (1.0 / log2(10.0));\n}\n\nfloat log1p(float x) {\n  return log(1.0 + x);\n}\n\nfloat _pow(float v1, float v2) {\n  if (v2 == 0.0) return 1.0;\n  return pow(v1, v2);\n}\n\nfloat tanh(float x) {\n  float e = exp(2.0 * x);\n  return (e - 1.0) / (e + 1.0);\n}\n\nfloat trunc(float x) {\n  if (x >= 0.0) {\n    return floor(x); \n  } else {\n    return ceil(x);\n  }\n}\n\nvec4 _round(vec4 x) {\n  return floor(x + 0.5);\n}\n\nfloat _round(float x) {\n  return floor(x + 0.5);\n}\n\nconst int BIT_COUNT = 32;\nint modi(int x, int y) {\n  return x - y * (x / y);\n}\n\nint bitwiseOr(int a, int b) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 || b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseXOR(int a, int b) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 || b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseAnd(int a, int b) {\n  int result = 0;\n  int n = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 && b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseNot(int a) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (modi(a, 2) == 0) {\n      result += n;    \n    }\n    a = a / 2;\n    n = n * 2;\n  }\n  return result;\n}\nint bitwiseZeroFillLeftShift(int n, int shift) {\n  int maxBytes = BIT_COUNT;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (maxBytes >= n) {\n      break;\n    }\n    maxBytes *= 2;\n  }\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= shift) {\n      break;\n    }\n    n *= 2;\n  }\n\n  int result = 0;\n  int byteVal = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= maxBytes) break;\n    if (modi(n, 2) > 0) { result += byteVal; }\n    n = int(n / 2);\n    byteVal *= 2;\n  }\n  return result;\n}\n\nint bitwiseSignedRightShift(int num, int shifts) {\n  return int(floor(float(num) / pow(2.0, float(shifts))));\n}\n\nint bitwiseZeroFillRightShift(int n, int shift) {\n  int maxBytes = BIT_COUNT;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (maxBytes >= n) {\n      break;\n    }\n    maxBytes *= 2;\n  }\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= shift) {\n      break;\n    }\n    n /= 2;\n  }\n  int result = 0;\n  int byteVal = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= maxBytes) break;\n    if (modi(n, 2) > 0) { result += byteVal; }\n    n = int(n / 2);\n    byteVal *= 2;\n  }\n  return result;\n}\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nfloat integerMod(float x, float y) {\n  float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nint integerMod(int x, int y) {\n  return x - (y * int(x / y));\n}\n\n__DIVIDE_WITH_INTEGER_CHECK__;\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nfloat decode32(vec4 texel) {\n  __DECODE32_ENDIANNESS__;\n  texel *= 255.0;\n  vec2 gte128;\n  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(_round(exponent));\n  texel.b = texel.b - 128.0 * gte128.x;\n  res = dot(texel, SCALE_FACTOR) * exp2(_round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nfloat decode16(vec4 texel, int index) {\n  int channel = integerMod(index, 2);\n  if (channel == 0) return texel.r * 255.0 + texel.g * 65280.0;\n  if (channel == 1) return texel.b * 255.0 + texel.a * 65280.0;\n  return 0.0;\n}\n\nfloat decode8(vec4 texel, int index) {\n  int channel = integerMod(index, 4);\n  if (channel == 0) return texel.r * 255.0;\n  if (channel == 1) return texel.g * 255.0;\n  if (channel == 2) return texel.b * 255.0;\n  if (channel == 3) return texel.a * 255.0;\n  return 0.0;\n}\n\nvec4 legacyEncode32(float f) {\n  float F = abs(f);\n  float sign = f < 0.0 ? 1.0 : 0.0;\n  float exponent = floor(log2(F));\n  float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  texel.rg = integerMod(texel.rg, 256.0);\n  texel.b = integerMod(texel.b, 128.0);\n  texel.a = exponent*0.5 + 63.5;\n  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  texel = floor(texel);\n  texel *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return texel;\n}\n\n// https://github.com/gpujs/gpu.js/wiki/Encoder-details\nvec4 encode32(float value) {\n  if (value == 0.0) return vec4(0, 0, 0, 0);\n\n  float exponent;\n  float mantissa;\n  vec4  result;\n  float sgn;\n\n  sgn = step(0.0, -value);\n  value = abs(value);\n\n  exponent = floor(log2(value));\n\n  mantissa = value*pow(2.0, -exponent)-1.0;\n  exponent = exponent+127.0;\n  result   = vec4(0,0,0,0);\n\n  result.a = floor(exponent/2.0);\n  exponent = exponent - result.a*2.0;\n  result.a = result.a + 128.0*sgn;\n\n  result.b = floor(mantissa * 128.0);\n  mantissa = mantissa - result.b / 128.0;\n  result.b = result.b + exponent*128.0;\n\n  result.g = floor(mantissa*32768.0);\n  mantissa = mantissa - result.g/32768.0;\n\n  result.r = floor(mantissa*8388608.0);\n  return result/255.0;\n}\n// Dragons end here\n\nint index;\nivec3 threadId;\n\nivec3 indexTo3D(int idx, ivec3 texDim) {\n  int z = int(idx / (texDim.x * texDim.y));\n  idx -= z * int(texDim.x * texDim.y);\n  int y = int(idx / texDim.x);\n  int x = int(integerMod(idx, texDim.x));\n  return ivec3(x, y, z);\n}\n\nfloat get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  return decode32(texel);\n}\n\nfloat get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x * 2;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize.x * 2, texSize.y));\n  return decode16(texel, index);\n}\n\nfloat get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x * 4;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize.x * 4, texSize.y));\n  return decode8(texel, index);\n}\n\nfloat getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int channel = integerMod(index, 4);\n  index = index / 4;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  if (channel == 0) return texel.r;\n  if (channel == 1) return texel.g;\n  if (channel == 2) return texel.b;\n  if (channel == 3) return texel.a;\n  return 0.0;\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  return texture2D(tex, st / vec2(texSize));\n}\n\nfloat getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return result[0];\n}\n\nvec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return vec2(result[0], result[1]);\n}\n\nvec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + (texDim.x * (y + (texDim.y * z)));\n  int channel = integerMod(index, 2);\n  index = index / 2;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  if (channel == 0) return vec2(texel.r, texel.g);\n  if (channel == 1) return vec2(texel.b, texel.a);\n  return vec2(0.0, 0.0);\n}\n\nvec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return vec3(result[0], result[1], result[2]);\n}\n\nvec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));\n  int vectorIndex = fieldIndex / 4;\n  int vectorOffset = fieldIndex - vectorIndex * 4;\n  int readY = vectorIndex / texSize.x;\n  int readX = vectorIndex - readY * texSize.x;\n  vec4 tex1 = texture2D(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));\n  \n  if (vectorOffset == 0) {\n    return tex1.xyz;\n  } else if (vectorOffset == 1) {\n    return tex1.yzw;\n  } else {\n    readX++;\n    if (readX >= texSize.x) {\n      readX = 0;\n      readY++;\n    }\n    vec4 tex2 = texture2D(tex, vec2(readX, readY) / vec2(texSize));\n    if (vectorOffset == 2) {\n      return vec3(tex1.z, tex1.w, tex2.x);\n    } else {\n      return vec3(tex1.w, tex2.x, tex2.y);\n    }\n  }\n}\n\nvec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  return getImage2D(tex, texSize, texDim, z, y, x);\n}\n\nvec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int channel = integerMod(index, 2);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  return vec4(texel.r, texel.g, texel.b, texel.a);\n}\n\nvec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\nvoid color(sampler2D image) {\n  actualColor = texture2D(image, vTexCoord);\n}\n\nfloat modulo(float number, float divisor) {\n  if (number < 0.0) {\n    number = abs(number);\n    if (divisor < 0.0) {\n      divisor = abs(divisor);\n    }\n    return -mod(number, divisor);\n  }\n  if (divisor < 0.0) {\n    divisor = abs(divisor);\n  }\n  return mod(number, divisor);\n}\n\n__INJECTED_NATIVE__;\n__MAIN_CONSTANTS__;\n__MAIN_ARGUMENTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}`;t.exports={fragmentShader:r}},{}],38:[function(e,t,n){const{utils:r}=e("../../utils"),{FunctionNode:i}=e("../function-node"),s={Array:"sampler2D","Array(2)":"vec2","Array(3)":"vec3","Array(4)":"vec4","Matrix(2)":"mat2","Matrix(3)":"mat3","Matrix(4)":"mat4",Array2D:"sampler2D",Array3D:"sampler2D",Boolean:"bool",Float:"float",Input:"sampler2D",Integer:"int",Number:"float",LiteralInteger:"float",NumberTexture:"sampler2D",MemoryOptimizedNumberTexture:"sampler2D","ArrayTexture(1)":"sampler2D","ArrayTexture(2)":"sampler2D","ArrayTexture(3)":"sampler2D","ArrayTexture(4)":"sampler2D",HTMLVideo:"sampler2D",HTMLCanvas:"sampler2D",HTMLImage:"sampler2D",HTMLImageArray:"sampler2DArray"},a={"===":"==","!==":"!="};t.exports={WebGLFunctionNode:class extends i{constructor(e,t){super(e,t),t&&t.hasOwnProperty("fixIntegerDivisionAccuracy")&&(this.fixIntegerDivisionAccuracy=t.fixIntegerDivisionAccuracy)}astConditionalExpression(e,t){if("ConditionalExpression"!==e.type)throw this.astErrorOutput("Not a conditional expression",e);const n=this.getType(e.consequent),r=this.getType(e.alternate);return null===n&&null===r?(t.push("if ("),this.astGeneric(e.test,t),t.push(") {"),this.astGeneric(e.consequent,t),t.push(";"),t.push("} else {"),this.astGeneric(e.alternate,t),t.push(";"),t.push("}"),t):(t.push("("),this.astGeneric(e.test,t),t.push("?"),this.astGeneric(e.consequent,t),t.push(":"),this.astGeneric(e.alternate,t),t.push(")"),t)}astFunction(e,t){if(this.isRootKernel)t.push("void");else{this.returnType||this.findLastReturn()&&(this.returnType=this.getType(e.body),"LiteralInteger"===this.returnType&&(this.returnType="Number"));const{returnType:n}=this;if(n){const e=s[n];if(!e)throw new Error(`unknown type ${n}`);t.push(e)}else t.push("void")}if(t.push(" "),t.push(this.name),t.push("("),!this.isRootKernel)for(let n=0;n<this.argumentNames.length;++n){const i=this.argumentNames[n];n>0&&t.push(", ");let a=this.argumentTypes[this.argumentNames.indexOf(i)];if(!a)throw this.astErrorOutput(`Unknown argument ${i} type`,e);"LiteralInteger"===a&&(this.argumentTypes[n]=a="Number");const o=s[a];if(!o)throw this.astErrorOutput("Unexpected expression",e);const u=r.sanitizeName(i);"sampler2D"===o||"sampler2DArray"===o?t.push(`${o} user_${u},ivec2 user_${u}Size,ivec3 user_${u}Dim`):t.push(`${o} user_${u}`)}t.push(") {\n");for(let n=0;n<e.body.body.length;++n)this.astGeneric(e.body.body[n],t),t.push("\n");return t.push("}\n"),t}astReturnStatement(e,t){if(!e.argument)throw this.astErrorOutput("Unexpected return statement",e);this.pushState("skip-literal-correction");const n=this.getType(e.argument);this.popState("skip-literal-correction");const r=[];switch(this.returnType||(this.returnType="LiteralInteger"===n||"Integer"===n?"Number":n),this.returnType){case"LiteralInteger":case"Number":case"Float":switch(n){case"Integer":r.push("float("),this.astGeneric(e.argument,r),r.push(")");break;case"LiteralInteger":this.castLiteralToFloat(e.argument,r),"Integer"===this.getType(e)&&(r.unshift("float("),r.push(")"));break;default:this.astGeneric(e.argument,r)}break;case"Integer":switch(n){case"Float":case"Number":this.castValueToInteger(e.argument,r);break;case"LiteralInteger":this.castLiteralToInteger(e.argument,r);break;default:this.astGeneric(e.argument,r)}break;case"Array(4)":case"Array(3)":case"Array(2)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":case"Input":this.astGeneric(e.argument,r);break;default:throw this.astErrorOutput(`unhandled return type ${this.returnType}`,e)}return this.isRootKernel?(t.push(`kernelResult = ${r.join("")};`),t.push("return;")):this.isSubKernel?(t.push(`subKernelResult_${this.name} = ${r.join("")};`),t.push(`return subKernelResult_${this.name};`)):t.push(`return ${r.join("")};`),t}astLiteral(e,t){if(isNaN(e.value))throw this.astErrorOutput("Non-numeric literal not supported : "+e.value,e);const n=this.astKey(e);return Number.isInteger(e.value)?this.isState("casting-to-integer")||this.isState("building-integer")?(this.literalTypes[n]="Integer",t.push(`${e.value}`)):(this.isState("casting-to-float")||this.isState("building-float"),this.literalTypes[n]="Number",t.push(`${e.value}.0`)):this.isState("casting-to-integer")||this.isState("building-integer")?(this.literalTypes[n]="Integer",t.push(Math.round(e.value))):(this.literalTypes[n]="Number",t.push(`${e.value}`)),t}astBinaryExpression(e,t){if(this.checkAndUpconvertOperator(e,t))return t;if(this.fixIntegerDivisionAccuracy&&"/"===e.operator){switch(t.push("divWithIntCheck("),this.pushState("building-float"),this.getType(e.left)){case"Integer":this.castValueToFloat(e.left,t);break;case"LiteralInteger":this.castLiteralToFloat(e.left,t);break;default:this.astGeneric(e.left,t)}switch(t.push(", "),this.getType(e.right)){case"Integer":this.castValueToFloat(e.right,t);break;case"LiteralInteger":this.castLiteralToFloat(e.right,t);break;default:this.astGeneric(e.right,t)}return this.popState("building-float"),t.push(")"),t}t.push("(");const n=this.getType(e.left)||"Number",r=this.getType(e.right)||"Number";if(!n||!r)throw this.astErrorOutput("Unhandled binary expression",e);const i=n+" & "+r;switch(i){case"Integer & Integer":this.pushState("building-integer"),this.astGeneric(e.left,t),t.push(a[e.operator]||e.operator),this.astGeneric(e.right,t),this.popState("building-integer");break;case"Number & Float":case"Float & Number":case"Float & Float":case"Number & Number":this.pushState("building-float"),this.astGeneric(e.left,t),t.push(a[e.operator]||e.operator),this.astGeneric(e.right,t),this.popState("building-float");break;case"LiteralInteger & LiteralInteger":this.isState("casting-to-integer")||this.isState("building-integer")?(this.pushState("building-integer"),this.astGeneric(e.left,t),t.push(a[e.operator]||e.operator),this.astGeneric(e.right,t),this.popState("building-integer")):(this.pushState("building-float"),this.castLiteralToFloat(e.left,t),t.push(a[e.operator]||e.operator),this.castLiteralToFloat(e.right,t),this.popState("building-float"));break;case"Integer & Float":case"Integer & Number":if((">"===e.operator||"<"===e.operator&&"Literal"===e.right.type)&&!Number.isInteger(e.right.value)){this.pushState("building-float"),this.castValueToFloat(e.left,t),t.push(a[e.operator]||e.operator),this.astGeneric(e.right,t),this.popState("building-float");break}if(this.pushState("building-integer"),this.astGeneric(e.left,t),t.push(a[e.operator]||e.operator),this.pushState("casting-to-integer"),"Literal"===e.right.type){const n=[];if(this.astGeneric(e.right,n),"Integer"!==this.getType(e.right))throw this.astErrorOutput("Unhandled binary expression with literal",e);t.push(n.join(""))}else t.push("int("),this.astGeneric(e.right,t),t.push(")");this.popState("casting-to-integer"),this.popState("building-integer");break;case"Integer & LiteralInteger":this.pushState("building-integer"),this.astGeneric(e.left,t),t.push(a[e.operator]||e.operator),this.castLiteralToInteger(e.right,t),this.popState("building-integer");break;case"Number & Integer":this.pushState("building-float"),this.astGeneric(e.left,t),t.push(a[e.operator]||e.operator),this.castValueToFloat(e.right,t),this.popState("building-float");break;case"Float & LiteralInteger":case"Number & LiteralInteger":this.pushState("building-float"),this.astGeneric(e.left,t),t.push(a[e.operator]||e.operator),this.castLiteralToFloat(e.right,t),this.popState("building-float");break;case"LiteralInteger & Float":case"LiteralInteger & Number":this.isState("casting-to-integer")?(this.pushState("building-integer"),this.castLiteralToInteger(e.left,t),t.push(a[e.operator]||e.operator),this.castValueToInteger(e.right,t),this.popState("building-integer")):(this.pushState("building-float"),this.astGeneric(e.left,t),t.push(a[e.operator]||e.operator),this.pushState("casting-to-float"),this.astGeneric(e.right,t),this.popState("casting-to-float"),this.popState("building-float"));break;case"LiteralInteger & Integer":this.pushState("building-integer"),this.castLiteralToInteger(e.left,t),t.push(a[e.operator]||e.operator),this.astGeneric(e.right,t),this.popState("building-integer");break;case"Boolean & Boolean":this.pushState("building-boolean"),this.astGeneric(e.left,t),t.push(a[e.operator]||e.operator),this.astGeneric(e.right,t),this.popState("building-boolean");break;case"Float & Integer":this.pushState("building-float"),this.astGeneric(e.left,t),t.push(a[e.operator]||e.operator),this.castValueToFloat(e.right,t),this.popState("building-float");break;default:throw this.astErrorOutput(`Unhandled binary expression between ${i}`,e)}return t.push(")"),t}checkAndUpconvertOperator(e,t){const n=this.checkAndUpconvertBitwiseOperators(e,t);if(n)return n;const r={"%":this.fixIntegerDivisionAccuracy?"integerCorrectionModulo":"modulo","**":"pow"}[e.operator];if(!r)return null;switch(t.push(r),t.push("("),this.getType(e.left)){case"Integer":this.castValueToFloat(e.left,t);break;case"LiteralInteger":this.castLiteralToFloat(e.left,t);break;default:this.astGeneric(e.left,t)}switch(t.push(","),this.getType(e.right)){case"Integer":this.castValueToFloat(e.right,t);break;case"LiteralInteger":this.castLiteralToFloat(e.right,t);break;default:this.astGeneric(e.right,t)}return t.push(")"),t}checkAndUpconvertBitwiseOperators(e,t){const n={"&":"bitwiseAnd","|":"bitwiseOr","^":"bitwiseXOR","<<":"bitwiseZeroFillLeftShift",">>":"bitwiseSignedRightShift",">>>":"bitwiseZeroFillRightShift"}[e.operator];if(!n)return null;switch(t.push(n),t.push("("),this.getType(e.left)){case"Number":case"Float":this.castValueToInteger(e.left,t);break;case"LiteralInteger":this.castLiteralToInteger(e.left,t);break;default:this.astGeneric(e.left,t)}switch(t.push(","),this.getType(e.right)){case"Number":case"Float":this.castValueToInteger(e.right,t);break;case"LiteralInteger":this.castLiteralToInteger(e.right,t);break;default:this.astGeneric(e.right,t)}return t.push(")"),t}checkAndUpconvertBitwiseUnary(e,t){const n={"~":"bitwiseNot"}[e.operator];if(!n)return null;switch(t.push(n),t.push("("),this.getType(e.argument)){case"Number":case"Float":this.castValueToInteger(e.argument,t);break;case"LiteralInteger":this.castLiteralToInteger(e.argument,t);break;default:this.astGeneric(e.argument,t)}return t.push(")"),t}castLiteralToInteger(e,t){return this.pushState("casting-to-integer"),this.astGeneric(e,t),this.popState("casting-to-integer"),t}castLiteralToFloat(e,t){return this.pushState("casting-to-float"),this.astGeneric(e,t),this.popState("casting-to-float"),t}castValueToInteger(e,t){return this.pushState("casting-to-integer"),t.push("int("),this.astGeneric(e,t),t.push(")"),this.popState("casting-to-integer"),t}castValueToFloat(e,t){return this.pushState("casting-to-float"),t.push("float("),this.astGeneric(e,t),t.push(")"),this.popState("casting-to-float"),t}astIdentifierExpression(e,t){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e);const n=this.getType(e),i=r.sanitizeName(e.name);return"Infinity"===e.name?t.push("3.402823466e+38"):"Boolean"===n&&this.argumentNames.indexOf(i)>-1?t.push(`bool(user_${i})`):t.push(`user_${i}`),t}astForStatement(e,t){if("ForStatement"!==e.type)throw this.astErrorOutput("Invalid for statement",e);const n=[],r=[],i=[],s=[];let a=null;if(e.init){const{declarations:t}=e.init;t.length>1&&(a=!1),this.astGeneric(e.init,n);for(let e=0;e<t.length;e++)t[e].init&&"Literal"!==t[e].init.type&&(a=!1)}else a=!1;if(e.test?this.astGeneric(e.test,r):a=!1,e.update?this.astGeneric(e.update,i):a=!1,e.body&&(this.pushState("loop-body"),this.astGeneric(e.body,s),this.popState("loop-body")),null===a&&(a=this.isSafe(e.init)&&this.isSafe(e.test)),a){const e=n.join(""),a=";"!==e[e.length-1];t.push(`for (${e}${a?";":""}${r.join("")};${i.join("")}){\n`),t.push(s.join("")),t.push("}\n")}else{const e=this.getInternalVariableName("safeI");n.length>0&&t.push(n.join(""),"\n"),t.push(`for (int ${e}=0;${e}<LOOP_MAX;${e}++){\n`),r.length>0&&t.push(`if (!${r.join("")}) break;\n`),t.push(s.join("")),t.push(`\n${i.join("")};`),t.push("}\n")}return t}astWhileStatement(e,t){if("WhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statement",e);const n=this.getInternalVariableName("safeI");return t.push(`for (int ${n}=0;${n}<LOOP_MAX;${n}++){\n`),t.push("if (!"),this.astGeneric(e.test,t),t.push(") break;\n"),this.astGeneric(e.body,t),t.push("}\n"),t}astDoWhileStatement(e,t){if("DoWhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statement",e);const n=this.getInternalVariableName("safeI");return t.push(`for (int ${n}=0;${n}<LOOP_MAX;${n}++){\n`),this.astGeneric(e.body,t),t.push("if (!"),this.astGeneric(e.test,t),t.push(") break;\n"),t.push("}\n"),t}astAssignmentExpression(e,t){if("%="===e.operator)this.astGeneric(e.left,t),t.push("="),t.push("mod("),this.astGeneric(e.left,t),t.push(","),this.astGeneric(e.right,t),t.push(")");else{if("**="!==e.operator){const n=this.getType(e.left),r=this.getType(e.right);return this.astGeneric(e.left,t),t.push(e.operator),"Integer"!==n&&"Integer"===r?(t.push("float("),this.astGeneric(e.right,t),t.push(")")):this.astGeneric(e.right,t),t}this.astGeneric(e.left,t),t.push("="),t.push("pow("),this.astGeneric(e.left,t),t.push(","),this.astGeneric(e.right,t),t.push(")")}}astBlockStatement(e,t){if(this.isState("loop-body")){this.pushState("block-body");for(let n=0;n<e.body.length;n++)this.astGeneric(e.body[n],t);this.popState("block-body")}else{t.push("{\n");for(let n=0;n<e.body.length;n++)this.astGeneric(e.body[n],t);t.push("}\n")}return t}astVariableDeclaration(e,t){const n=e.declarations;if(!n||!n[0]||!n[0].init)throw this.astErrorOutput("Unexpected expression",e);const i=[];let a=null;const o=[];let u=[];for(let t=0;t<n.length;t++){const i=n[t],c=i.init,l=this.getDeclaration(i.id),h=this.getType(i.init);let p=h;"LiteralInteger"===p&&(p="Integer"===l.suggestedType?"Integer":"Number");const d=s[p];if(!d)throw this.astErrorOutput(`Markup type ${p} not handled`,e);const f=[];if("Integer"===h&&"Integer"===p){if(l.valueType="Number",0===t||null===a)f.push("float ");else if(p!==a)throw new Error("Unhandled declaration");a=p,f.push(`user_${r.sanitizeName(i.id.name)}=`),f.push("float("),this.astGeneric(c,f),f.push(")")}else l.valueType=p,0===t||null===a?f.push(`${d} `):p!==a&&(o.push(u.join(",")),u=[],f.push(`${d} `)),a=p,f.push(`user_${r.sanitizeName(i.id.name)}=`),"Number"===h&&"Integer"===p?c.left&&"Literal"===c.left.type?this.astGeneric(c,f):(f.push("int("),this.astGeneric(c,f),f.push(")")):"LiteralInteger"===h&&"Integer"===p?this.castLiteralToInteger(c,f):this.astGeneric(c,f);u.push(f.join(""))}return u.length>0&&o.push(u.join(",")),i.push(o.join(";")),t.push(i.join("")),t.push(";"),t}astIfStatement(e,t){return t.push("if ("),this.astGeneric(e.test,t),t.push(")"),"BlockStatement"===e.consequent.type?this.astGeneric(e.consequent,t):(t.push(" {\n"),this.astGeneric(e.consequent,t),t.push("\n}\n")),e.alternate&&(t.push("else "),"BlockStatement"===e.alternate.type||"IfStatement"===e.alternate.type?this.astGeneric(e.alternate,t):(t.push(" {\n"),this.astGeneric(e.alternate,t),t.push("\n}\n"))),t}astSwitchStatement(e,t){if("SwitchStatement"!==e.type)throw this.astErrorOutput("Invalid switch statement",e);const{discriminant:n,cases:r}=e,i=this.getType(n),s=`switchDiscriminant${this.astKey(e,"_")}`;switch(i){case"Float":case"Number":t.push(`float ${s} = `),this.astGeneric(n,t),t.push(";\n");break;case"Integer":t.push(`int ${s} = `),this.astGeneric(n,t),t.push(";\n")}if(1===r.length&&!r[0].test)return this.astGeneric(r[0].consequent,t),t;let a=!1,o=[],u=!1,c=!1;for(let e=0;e<r.length;e++){if(r[e].test){if(0!==e&&c?a?(t.push(`${s} == `),a=!1):t.push(` else if (${s} == `):(c=!0,t.push(`if (${s} == `)),"Integer"===i)switch(this.getType(r[e].test)){case"Number":case"Float":this.castValueToInteger(r[e].test,t);break;case"LiteralInteger":this.castLiteralToInteger(r[e].test,t)}else{if("Float"!==i)throw new Error("unhanlded");switch(this.getType(r[e].test)){case"LiteralInteger":this.castLiteralToFloat(r[e].test,t);break;case"Integer":this.castValueToFloat(r[e].test,t)}}if(!r[e].consequent||0===r[e].consequent.length){a=!0,t.push(" || ");continue}t.push(") {\n")}else{if(r.length>e+1){u=!0,this.astGeneric(r[e].consequent,o);continue}t.push(" else {\n")}this.astGeneric(r[e].consequent,t),t.push("\n}")}return u&&(t.push(" else {"),t.push(o.join("")),t.push("}")),t}astThisExpression(e,t){return t.push("this"),t}astMemberExpression(e,t){const{property:n,name:i,signature:s,origin:a,type:o,xProperty:u,yProperty:c,zProperty:l}=this.getMemberExpressionDetails(e);switch(s){case"value.thread.value":case"this.thread.value":if("x"!==i&&"y"!==i&&"z"!==i)throw this.astErrorOutput("Unexpected expression, expected `this.thread.x`, `this.thread.y`, or `this.thread.z`",e);return t.push(`threadId.${i}`),t;case"this.output.value":if(this.dynamicOutput)switch(i){case"x":this.isState("casting-to-float")?t.push("float(uOutputDim.x)"):t.push("uOutputDim.x");break;case"y":this.isState("casting-to-float")?t.push("float(uOutputDim.y)"):t.push("uOutputDim.y");break;case"z":this.isState("casting-to-float")?t.push("float(uOutputDim.z)"):t.push("uOutputDim.z");break;default:throw this.astErrorOutput("Unexpected expression",e)}else switch(i){case"x":this.isState("casting-to-integer")?t.push(this.output[0]):t.push(this.output[0],".0");break;case"y":this.isState("casting-to-integer")?t.push(this.output[1]):t.push(this.output[1],".0");break;case"z":this.isState("casting-to-integer")?t.push(this.output[2]):t.push(this.output[2],".0");break;default:throw this.astErrorOutput("Unexpected expression",e)}return t;case"value":throw this.astErrorOutput("Unexpected expression",e);case"value[]":case"value[][]":case"value[][][]":case"value[][][][]":case"value.value":if("Math"===a)return t.push(Math[i]),t;const s=r.sanitizeName(i);switch(n){case"r":return t.push(`user_${s}.r`),t;case"g":return t.push(`user_${s}.g`),t;case"b":return t.push(`user_${s}.b`),t;case"a":return t.push(`user_${s}.a`),t}break;case"this.constants.value":if(void 0===u)switch(o){case"Array(2)":case"Array(3)":case"Array(4)":return t.push(`constants_${r.sanitizeName(i)}`),t}case"this.constants.value[]":case"this.constants.value[][]":case"this.constants.value[][][]":case"this.constants.value[][][][]":break;case"fn()[]":return this.astCallExpression(e.object,t),t.push("["),t.push(this.memberExpressionPropertyMarkup(n)),t.push("]"),t;case"fn()[][]":return this.astCallExpression(e.object.object,t),t.push("["),t.push(this.memberExpressionPropertyMarkup(e.object.property)),t.push("]"),t.push("["),t.push(this.memberExpressionPropertyMarkup(e.property)),t.push("]"),t;case"[][]":return this.astArrayExpression(e.object,t),t.push("["),t.push(this.memberExpressionPropertyMarkup(n)),t.push("]"),t;default:throw this.astErrorOutput("Unexpected expression",e)}if(!1===e.computed)switch(o){case"Number":case"Integer":case"Float":case"Boolean":return t.push(`${a}_${r.sanitizeName(i)}`),t}const h=`${a}_${r.sanitizeName(i)}`;switch(o){case"Array(2)":case"Array(3)":case"Array(4)":this.astGeneric(e.object,t),t.push("["),t.push(this.memberExpressionPropertyMarkup(u)),t.push("]");break;case"HTMLImageArray":t.push(`getImage3D(${h}, ${h}Size, ${h}Dim, `),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"ArrayTexture(1)":t.push(`getFloatFromSampler2D(${h}, ${h}Size, ${h}Dim, `),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"Array1D(2)":case"Array2D(2)":case"Array3D(2)":t.push(`getMemoryOptimizedVec2(${h}, ${h}Size, ${h}Dim, `),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"ArrayTexture(2)":t.push(`getVec2FromSampler2D(${h}, ${h}Size, ${h}Dim, `),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"Array1D(3)":case"Array2D(3)":case"Array3D(3)":t.push(`getMemoryOptimizedVec3(${h}, ${h}Size, ${h}Dim, `),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"ArrayTexture(3)":t.push(`getVec3FromSampler2D(${h}, ${h}Size, ${h}Dim, `),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"Array1D(4)":case"Array2D(4)":case"Array3D(4)":t.push(`getMemoryOptimizedVec4(${h}, ${h}Size, ${h}Dim, `),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"ArrayTexture(4)":case"HTMLCanvas":case"HTMLImage":case"HTMLVideo":t.push(`getVec4FromSampler2D(${h}, ${h}Size, ${h}Dim, `),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"NumberTexture":case"Array":case"Array2D":case"Array3D":case"Array4D":case"Input":case"Number":case"Float":case"Integer":if("single"===this.precision)t.push(`getMemoryOptimized32(${h}, ${h}Size, ${h}Dim, `),this.memberExpressionXYZ(u,c,l,t),t.push(")");else{const e="user"===a?this.lookupFunctionArgumentBitRatio(this.name,i):this.constantBitRatios[i];switch(e){case 1:t.push(`get8(${h}, ${h}Size, ${h}Dim, `);break;case 2:t.push(`get16(${h}, ${h}Size, ${h}Dim, `);break;case 4:case 0:t.push(`get32(${h}, ${h}Size, ${h}Dim, `);break;default:throw new Error(`unhandled bit ratio of ${e}`)}this.memberExpressionXYZ(u,c,l,t),t.push(")")}break;case"MemoryOptimizedNumberTexture":t.push(`getMemoryOptimized32(${h}, ${h}Size, ${h}Dim, `),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":t.push(`${h}[${this.memberExpressionPropertyMarkup(c)}]`),c&&t.push(`[${this.memberExpressionPropertyMarkup(u)}]`);break;default:throw new Error(`unhandled member expression "${o}"`)}return t}astCallExpression(e,t){if(!e.callee)throw this.astErrorOutput("Unknown CallExpression",e);let n=null;const i=this.isAstMathFunction(e);if(n=i||e.callee.object&&"ThisExpression"===e.callee.object.type?e.callee.property.name:"SequenceExpression"!==e.callee.type||"Literal"!==e.callee.expressions[0].type||isNaN(e.callee.expressions[0].raw)?e.callee.name:e.callee.expressions[1].property.name,!n)throw this.astErrorOutput("Unhandled function, couldn't find name",e);switch(n){case"pow":n="_pow";break;case"round":n="_round"}if(this.calledFunctions.indexOf(n)<0&&this.calledFunctions.push(n),"random"===n&&this.plugins&&this.plugins.length>0)for(let e=0;e<this.plugins.length;e++){const n=this.plugins[e];if("Math.random()"===n.functionMatch&&n.functionReplace)return t.push(n.functionReplace),t}if(this.onFunctionCall&&this.onFunctionCall(this.name,n,e.arguments),t.push(n),t.push("("),i)for(let n=0;n<e.arguments.length;++n){const r=e.arguments[n],i=this.getType(r);switch(n>0&&t.push(", "),i){case"Integer":this.castValueToFloat(r,t);break;default:this.astGeneric(r,t)}}else{const i=this.lookupFunctionArgumentTypes(n)||[];for(let s=0;s<e.arguments.length;++s){const a=e.arguments[s];let o=i[s];s>0&&t.push(", ");const u=this.getType(a);switch(o||(this.triggerImplyArgumentType(n,s,u,this),o=u),u){case"Boolean":this.astGeneric(a,t);continue;case"Number":case"Float":if("Integer"===o){t.push("int("),this.astGeneric(a,t),t.push(")");continue}if("Number"===o||"Float"===o){this.astGeneric(a,t);continue}if("LiteralInteger"===o){this.castLiteralToFloat(a,t);continue}break;case"Integer":if("Number"===o||"Float"===o){t.push("float("),this.astGeneric(a,t),t.push(")");continue}if("Integer"===o){this.astGeneric(a,t);continue}break;case"LiteralInteger":if("Integer"===o){this.castLiteralToInteger(a,t);continue}if("Number"===o||"Float"===o){this.castLiteralToFloat(a,t);continue}if("LiteralInteger"===o){this.astGeneric(a,t);continue}break;case"Array(2)":case"Array(3)":case"Array(4)":if(o===u){if("Identifier"===a.type)t.push(`user_${r.sanitizeName(a.name)}`);else{if("ArrayExpression"!==a.type&&"MemberExpression"!==a.type&&"CallExpression"!==a.type)throw this.astErrorOutput(`Unhandled argument type ${a.type}`,e);this.astGeneric(a,t)}continue}break;case"HTMLCanvas":case"HTMLImage":case"HTMLImageArray":case"HTMLVideo":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"Array":case"Input":if(o===u){if("Identifier"!==a.type)throw this.astErrorOutput(`Unhandled argument type ${a.type}`,e);this.triggerImplyArgumentBitRatio(this.name,a.name,n,s);const i=r.sanitizeName(a.name);t.push(`user_${i},user_${i}Size,user_${i}Dim`);continue}}throw this.astErrorOutput(`Unhandled argument combination of ${u} and ${o} for argument named "${a.name}"`,e)}}return t.push(")"),t}astArrayExpression(e,t){const n=this.getType(e),r=e.elements.length;switch(n){case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":t.push(`mat${r}(`);break;default:t.push(`vec${r}(`)}for(let n=0;n<r;++n){n>0&&t.push(", ");const r=e.elements[n];this.astGeneric(r,t)}return t.push(")"),t}memberExpressionXYZ(e,t,n,r){return n?r.push(this.memberExpressionPropertyMarkup(n),", "):r.push("0, "),t?r.push(this.memberExpressionPropertyMarkup(t),", "):r.push("0, "),r.push(this.memberExpressionPropertyMarkup(e)),r}memberExpressionPropertyMarkup(e){if(!e)throw new Error("Property not set");const t=[];switch(this.getType(e)){case"Number":case"Float":this.castValueToInteger(e,t);break;case"LiteralInteger":this.castLiteralToInteger(e,t);break;default:this.astGeneric(e,t)}return t.join("")}}}},{"../../utils":114,"../function-node":10}],39:[function(e,t,n){const{WebGLKernelValueBoolean:r}=e("./kernel-value/boolean"),{WebGLKernelValueFloat:i}=e("./kernel-value/float"),{WebGLKernelValueInteger:s}=e("./kernel-value/integer"),{WebGLKernelValueHTMLImage:a}=e("./kernel-value/html-image"),{WebGLKernelValueDynamicHTMLImage:o}=e("./kernel-value/dynamic-html-image"),{WebGLKernelValueHTMLVideo:u}=e("./kernel-value/html-video"),{WebGLKernelValueDynamicHTMLVideo:c}=e("./kernel-value/dynamic-html-video"),{WebGLKernelValueSingleInput:l}=e("./kernel-value/single-input"),{WebGLKernelValueDynamicSingleInput:h}=e("./kernel-value/dynamic-single-input"),{WebGLKernelValueUnsignedInput:p}=e("./kernel-value/unsigned-input"),{WebGLKernelValueDynamicUnsignedInput:d}=e("./kernel-value/dynamic-unsigned-input"),{WebGLKernelValueMemoryOptimizedNumberTexture:f}=e("./kernel-value/memory-optimized-number-texture"),{WebGLKernelValueDynamicMemoryOptimizedNumberTexture:m}=e("./kernel-value/dynamic-memory-optimized-number-texture"),{WebGLKernelValueNumberTexture:g}=e("./kernel-value/number-texture"),{WebGLKernelValueDynamicNumberTexture:y}=e("./kernel-value/dynamic-number-texture"),{WebGLKernelValueSingleArray:v}=e("./kernel-value/single-array"),{WebGLKernelValueDynamicSingleArray:b}=e("./kernel-value/dynamic-single-array"),{WebGLKernelValueSingleArray1DI:x}=e("./kernel-value/single-array1d-i"),{WebGLKernelValueDynamicSingleArray1DI:w}=e("./kernel-value/dynamic-single-array1d-i"),{WebGLKernelValueSingleArray2DI:S}=e("./kernel-value/single-array2d-i"),{WebGLKernelValueDynamicSingleArray2DI:T}=e("./kernel-value/dynamic-single-array2d-i"),{WebGLKernelValueSingleArray3DI:C}=e("./kernel-value/single-array3d-i"),{WebGLKernelValueDynamicSingleArray3DI:A}=e("./kernel-value/dynamic-single-array3d-i"),{WebGLKernelValueSingleArray2:_}=e("./kernel-value/single-array2"),{WebGLKernelValueSingleArray3:k}=e("./kernel-value/single-array3"),{WebGLKernelValueSingleArray4:I}=e("./kernel-value/single-array4"),{WebGLKernelValueUnsignedArray:E}=e("./kernel-value/unsigned-array"),{WebGLKernelValueDynamicUnsignedArray:O}=e("./kernel-value/dynamic-unsigned-array"),D={unsigned:{dynamic:{Boolean:r,Integer:s,Float:i,Array:O,"Array(2)":!1,"Array(3)":!1,"Array(4)":!1,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:d,NumberTexture:y,"ArrayTexture(1)":y,"ArrayTexture(2)":y,"ArrayTexture(3)":y,"ArrayTexture(4)":y,MemoryOptimizedNumberTexture:m,HTMLCanvas:o,HTMLImage:o,HTMLImageArray:!1,HTMLVideo:c},static:{Boolean:r,Float:i,Integer:s,Array:E,"Array(2)":!1,"Array(3)":!1,"Array(4)":!1,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:p,NumberTexture:g,"ArrayTexture(1)":g,"ArrayTexture(2)":g,"ArrayTexture(3)":g,"ArrayTexture(4)":g,MemoryOptimizedNumberTexture:f,HTMLCanvas:a,HTMLImage:a,HTMLImageArray:!1,HTMLVideo:u}},single:{dynamic:{Boolean:r,Integer:s,Float:i,Array:b,"Array(2)":_,"Array(3)":k,"Array(4)":I,"Array1D(2)":w,"Array1D(3)":w,"Array1D(4)":w,"Array2D(2)":T,"Array2D(3)":T,"Array2D(4)":T,"Array3D(2)":A,"Array3D(3)":A,"Array3D(4)":A,Input:h,NumberTexture:y,"ArrayTexture(1)":y,"ArrayTexture(2)":y,"ArrayTexture(3)":y,"ArrayTexture(4)":y,MemoryOptimizedNumberTexture:m,HTMLCanvas:o,HTMLImage:o,HTMLImageArray:!1,HTMLVideo:c},static:{Boolean:r,Float:i,Integer:s,Array:v,"Array(2)":_,"Array(3)":k,"Array(4)":I,"Array1D(2)":x,"Array1D(3)":x,"Array1D(4)":x,"Array2D(2)":S,"Array2D(3)":S,"Array2D(4)":S,"Array3D(2)":C,"Array3D(3)":C,"Array3D(4)":C,Input:l,NumberTexture:g,"ArrayTexture(1)":g,"ArrayTexture(2)":g,"ArrayTexture(3)":g,"ArrayTexture(4)":g,MemoryOptimizedNumberTexture:f,HTMLCanvas:a,HTMLImage:a,HTMLImageArray:!1,HTMLVideo:u}}};t.exports={lookupKernelValueType:function(e,t,n,r){if(!e)throw new Error("type missing");if(!t)throw new Error("dynamic missing");if(!n)throw new Error("precision missing");r.type&&(e=r.type);const i=D[n][t];if(!1===i[e])return null;if(void 0===i[e])throw new Error(`Could not find a KernelValue for ${e}`);return i[e]},kernelValueMaps:D}},{"./kernel-value/boolean":41,"./kernel-value/dynamic-html-image":42,"./kernel-value/dynamic-html-video":43,"./kernel-value/dynamic-memory-optimized-number-texture":44,"./kernel-value/dynamic-number-texture":45,"./kernel-value/dynamic-single-array":46,"./kernel-value/dynamic-single-array1d-i":47,"./kernel-value/dynamic-single-array2d-i":48,"./kernel-value/dynamic-single-array3d-i":49,"./kernel-value/dynamic-single-input":50,"./kernel-value/dynamic-unsigned-array":51,"./kernel-value/dynamic-unsigned-input":52,"./kernel-value/float":53,"./kernel-value/html-image":54,"./kernel-value/html-video":55,"./kernel-value/integer":57,"./kernel-value/memory-optimized-number-texture":58,"./kernel-value/number-texture":59,"./kernel-value/single-array":60,"./kernel-value/single-array1d-i":61,"./kernel-value/single-array2":62,"./kernel-value/single-array2d-i":63,"./kernel-value/single-array3":64,"./kernel-value/single-array3d-i":65,"./kernel-value/single-array4":66,"./kernel-value/single-input":67,"./kernel-value/unsigned-array":68,"./kernel-value/unsigned-input":69}],40:[function(e,t,n){const{WebGLKernelValue:r}=e("./index"),{Input:i}=e("../../../input");t.exports={WebGLKernelArray:class extends r{checkSize(e,t){if(!this.kernel.validate)return;const{maxTextureSize:n}=this.kernel.constructor.features;if(e>n||t>n)throw e>t?new Error(`Argument texture width of ${e} larger than maximum size of ${n} for your GPU`):e<t?new Error(`Argument texture height of ${t} larger than maximum size of ${n} for your GPU`):new Error(`Argument texture height and width of ${t} larger than maximum size of ${n} for your GPU`)}setup(){this.requestTexture(),this.setupTexture(),this.defineTexture()}requestTexture(){this.texture=this.onRequestTexture()}defineTexture(){const{context:e}=this;e.activeTexture(this.contextHandle),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)}setupTexture(){this.contextHandle=this.onRequestContextHandle(),this.index=this.onRequestIndex(),this.dimensionsId=this.id+"Dim",this.sizeId=this.id+"Size"}getBitRatio(e){if(Array.isArray(e[0]))return this.getBitRatio(e[0]);if(e.constructor===i)return this.getBitRatio(e.value);switch(e.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:return 1;case Uint16Array:case Int16Array:return 2;case Float32Array:case Int32Array:default:return 4}}destroy(){this.prevArg&&this.prevArg.delete(),this.context.deleteTexture(this.texture)}}}},{"../../../input":110,"./index":56}],41:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValue:i}=e("./index");t.exports={WebGLKernelValueBoolean:class extends i{constructor(e,t){super(e,t),this.uploadValue=e}getSource(e){return"constants"===this.origin?`const bool ${this.id} = ${e};\n`:`uniform bool ${this.id};\n`}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}updateValue(e){"constants"!==this.origin&&this.kernel.setUniform1i(this.id,this.uploadValue=e)}}}},{"../../../utils":114,"./index":56}],42:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueHTMLImage:i}=e("./html-image");t.exports={WebGLKernelValueDynamicHTMLImage:class extends i{getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(e){const{width:t,height:n}=e;this.checkSize(t,n),this.dimensions=[t,n,1],this.textureSize=[t,n],this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"./html-image":54}],43:[function(e,t,n){const{WebGLKernelValueDynamicHTMLImage:r}=e("./dynamic-html-image");t.exports={WebGLKernelValueDynamicHTMLVideo:class extends r{}}},{"./dynamic-html-image":42}],44:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueMemoryOptimizedNumberTexture:i}=e("./memory-optimized-number-texture");t.exports={WebGLKernelValueDynamicMemoryOptimizedNumberTexture:class extends i{getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(e){this.dimensions=e.dimensions,this.checkSize(e.size[0],e.size[1]),this.textureSize=e.size,this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"./memory-optimized-number-texture":58}],45:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueNumberTexture:i}=e("./number-texture");t.exports={WebGLKernelValueDynamicNumberTexture:class extends i{getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(e){this.dimensions=e.dimensions,this.checkSize(e.size[0],e.size[1]),this.textureSize=e.size,this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"./number-texture":59}],46:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueSingleArray:i}=e("./single-array");t.exports={WebGLKernelValueDynamicSingleArray:class extends i{getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(e){this.dimensions=r.getDimensions(e,!0),this.textureSize=r.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"./single-array":60}],47:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueSingleArray1DI:i}=e("./single-array1d-i");t.exports={WebGLKernelValueDynamicSingleArray1DI:class extends i{getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(e){this.setShape(e),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"./single-array1d-i":61}],48:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueSingleArray2DI:i}=e("./single-array2d-i");t.exports={WebGLKernelValueDynamicSingleArray2DI:class extends i{getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(e){this.setShape(e),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"./single-array2d-i":63}],49:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueSingleArray3DI:i}=e("./single-array3d-i");t.exports={WebGLKernelValueDynamicSingleArray3DI:class extends i{getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(e){this.setShape(e),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"./single-array3d-i":65}],50:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueSingleInput:i}=e("./single-input");t.exports={WebGLKernelValueDynamicSingleInput:class extends i{getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(e){let[t,n,i]=e.size;this.dimensions=new Int32Array([t||1,n||1,i||1]),this.textureSize=r.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"./single-input":67}],51:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueUnsignedArray:i}=e("./unsigned-array");t.exports={WebGLKernelValueDynamicUnsignedArray:class extends i{getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(e){this.dimensions=r.getDimensions(e,!0),this.textureSize=r.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]);const t=this.getTransferArrayType(e);this.preUploadValue=new t(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"./unsigned-array":68}],52:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueUnsignedInput:i}=e("./unsigned-input");t.exports={WebGLKernelValueDynamicUnsignedInput:class extends i{getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(e){let[t,n,i]=e.size;this.dimensions=new Int32Array([t||1,n||1,i||1]),this.textureSize=r.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]);const s=this.getTransferArrayType(e.value);this.preUploadValue=new s(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"./unsigned-input":69}],53:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValue:i}=e("./index");t.exports={WebGLKernelValueFloat:class extends i{constructor(e,t){super(e,t),this.uploadValue=e}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}getSource(e){return"constants"===this.origin?Number.isInteger(e)?`const float ${this.id} = ${e}.0;\n`:`const float ${this.id} = ${e};\n`:`uniform float ${this.id};\n`}updateValue(e){"constants"!==this.origin&&this.kernel.setUniform1f(this.id,this.uploadValue=e)}}}},{"../../../utils":114,"./index":56}],54:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelArray:i}=e("./array");t.exports={WebGLKernelValueHTMLImage:class extends i{constructor(e,t){super(e,t);const{width:n,height:r}=e;this.checkSize(n,r),this.dimensions=[n,r,1],this.textureSize=[n,r],this.uploadValue=e}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);const{context:t}=this;t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.uploadValue=e),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],55:[function(e,t,n){const{WebGLKernelValueHTMLImage:r}=e("./html-image");t.exports={WebGLKernelValueHTMLVideo:class extends r{}}},{"./html-image":54}],56:[function(e,t,n){const{utils:r}=e("../../../utils"),{KernelValue:i}=e("../../kernel-value");t.exports={WebGLKernelValue:class extends i{constructor(e,t){super(e,t),this.dimensionsId=null,this.sizeId=null,this.initialValueConstructor=e.constructor,this.onRequestTexture=t.onRequestTexture,this.onRequestIndex=t.onRequestIndex,this.uploadValue=null,this.textureSize=null,this.bitRatio=null,this.prevArg=null}get id(){return`${this.origin}_${r.sanitizeName(this.name)}`}setup(){}getTransferArrayType(e){if(Array.isArray(e[0]))return this.getTransferArrayType(e[0]);switch(e.constructor){case Array:case Int32Array:case Int16Array:case Int8Array:return Float32Array;case Uint8ClampedArray:case Uint8Array:case Uint16Array:case Uint32Array:case Float32Array:case Float64Array:return e.constructor}return console.warn("Unfamiliar constructor type.  Will go ahead and use, but likley this may result in a transfer of zeros"),e.constructor}getStringValueHandler(){throw new Error(`"getStringValueHandler" not implemented on ${this.constructor.name}`)}getVariablePrecisionString(){return this.kernel.getVariablePrecisionString(this.textureSize||void 0,this.tactic||void 0)}destroy(){}}}},{"../../../utils":114,"../../kernel-value":35}],57:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValue:i}=e("./index");t.exports={WebGLKernelValueInteger:class extends i{constructor(e,t){super(e,t),this.uploadValue=e}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}getSource(e){return"constants"===this.origin?`const int ${this.id} = ${parseInt(e)};\n`:`uniform int ${this.id};\n`}updateValue(e){"constants"!==this.origin&&this.kernel.setUniform1i(this.id,this.uploadValue=e)}}}},{"../../../utils":114,"./index":56}],58:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelArray:i}=e("./array"),s="Source and destination textures are the same.  Use immutable = true and manually cleanup kernel output texture memory with texture.delete()";t.exports={WebGLKernelValueMemoryOptimizedNumberTexture:class extends i{constructor(e,t){super(e,t);const[n,r]=e.size;this.checkSize(n,r),this.dimensions=e.dimensions,this.textureSize=e.size,this.uploadValue=e.texture,this.forceUploadEachRun=!0}setup(){this.setupTexture()}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName}.texture;\n`}getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);if(this.checkContext&&e.context!==this.context)throw new Error(`Value ${this.name} (${this.type}) must be from same context`);const{kernel:t,context:n}=this;if(t.pipeline)if(t.immutable)t.updateTextureArgumentRefs(this,e);else{if(t.texture&&t.texture.texture===e.texture)throw new Error(s);if(t.mappedTextures){const{mappedTextures:n}=t;for(let t=0;t<n.length;t++)if(n[t].texture===e.texture)throw new Error(s)}}n.activeTexture(this.contextHandle),n.bindTexture(n.TEXTURE_2D,this.uploadValue=e.texture),this.kernel.setUniform1i(this.id,this.index)}},sameError:s}},{"../../../utils":114,"./array":40}],59:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelArray:i}=e("./array"),{sameError:s}=e("./memory-optimized-number-texture");t.exports={WebGLKernelValueNumberTexture:class extends i{constructor(e,t){super(e,t);const[n,r]=e.size;this.checkSize(n,r);const{size:i,dimensions:s}=e;this.bitRatio=this.getBitRatio(e),this.dimensions=s,this.textureSize=i,this.uploadValue=e.texture,this.forceUploadEachRun=!0}setup(){this.setupTexture()}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName}.texture;\n`}getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);if(this.checkContext&&e.context!==this.context)throw new Error(`Value ${this.name} (${this.type}) must be from same context`);const{kernel:t,context:n}=this;if(t.pipeline)if(t.immutable)t.updateTextureArgumentRefs(this,e);else{if(t.texture&&t.texture.texture===e.texture)throw new Error(s);if(t.mappedTextures){const{mappedTextures:n}=t;for(let t=0;t<n.length;t++)if(n[t].texture===e.texture)throw new Error(s)}}n.activeTexture(this.contextHandle),n.bindTexture(n.TEXTURE_2D,this.uploadValue=e.texture),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40,"./memory-optimized-number-texture":58}],60:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelArray:i}=e("./array");t.exports={WebGLKernelValueSingleArray:class extends i{constructor(e,t){super(e,t),this.bitRatio=4,this.dimensions=r.getDimensions(e,!0),this.textureSize=r.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return r.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);const{context:t}=this;r.flattenTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],61:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelArray:i}=e("./array");t.exports={WebGLKernelValueSingleArray1DI:class extends i{constructor(e,t){super(e,t),this.bitRatio=4,this.setShape(e)}setShape(e){const t=r.getDimensions(e,!0);this.textureSize=r.getMemoryOptimizedFloatTextureSize(t,this.bitRatio),this.dimensions=new Int32Array([t[1],1,1]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return r.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);const{context:t}=this;r.flatten2dArrayTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],62:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValue:i}=e("./index");t.exports={WebGLKernelValueSingleArray2:class extends i{constructor(e,t){super(e,t),this.uploadValue=e}getSource(e){return"constants"===this.origin?`const vec2 ${this.id} = vec2(${e[0]},${e[1]});\n`:`uniform vec2 ${this.id};\n`}getStringValueHandler(){return"constants"===this.origin?"":`const uploadValue_${this.name} = ${this.varName};\n`}updateValue(e){"constants"!==this.origin&&this.kernel.setUniform2fv(this.id,this.uploadValue=e)}}}},{"../../../utils":114,"./index":56}],63:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelArray:i}=e("./array");t.exports={WebGLKernelValueSingleArray2DI:class extends i{constructor(e,t){super(e,t),this.bitRatio=4,this.setShape(e)}setShape(e){const t=r.getDimensions(e,!0);this.textureSize=r.getMemoryOptimizedFloatTextureSize(t,this.bitRatio),this.dimensions=new Int32Array([t[1],t[2],1]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return r.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);const{context:t}=this;r.flatten3dArrayTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],64:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValue:i}=e("./index");t.exports={WebGLKernelValueSingleArray3:class extends i{constructor(e,t){super(e,t),this.uploadValue=e}getSource(e){return"constants"===this.origin?`const vec3 ${this.id} = vec3(${e[0]},${e[1]},${e[2]});\n`:`uniform vec3 ${this.id};\n`}getStringValueHandler(){return"constants"===this.origin?"":`const uploadValue_${this.name} = ${this.varName};\n`}updateValue(e){"constants"!==this.origin&&this.kernel.setUniform3fv(this.id,this.uploadValue=e)}}}},{"../../../utils":114,"./index":56}],65:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelArray:i}=e("./array");t.exports={WebGLKernelValueSingleArray3DI:class extends i{constructor(e,t){super(e,t),this.bitRatio=4,this.setShape(e)}setShape(e){const t=r.getDimensions(e,!0);this.textureSize=r.getMemoryOptimizedFloatTextureSize(t,this.bitRatio),this.dimensions=new Int32Array([t[1],t[2],t[3]]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return r.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);const{context:t}=this;r.flatten4dArrayTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],66:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValue:i}=e("./index");t.exports={WebGLKernelValueSingleArray4:class extends i{constructor(e,t){super(e,t),this.uploadValue=e}getSource(e){return"constants"===this.origin?`const vec4 ${this.id} = vec4(${e[0]},${e[1]},${e[2]},${e[3]});\n`:`uniform vec4 ${this.id};\n`}getStringValueHandler(){return"constants"===this.origin?"":`const uploadValue_${this.name} = ${this.varName};\n`}updateValue(e){"constants"!==this.origin&&this.kernel.setUniform4fv(this.id,this.uploadValue=e)}}}},{"../../../utils":114,"./index":56}],67:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelArray:i}=e("./array");t.exports={WebGLKernelValueSingleInput:class extends i{constructor(e,t){super(e,t),this.bitRatio=4;let[n,i,s]=e.size;this.dimensions=new Int32Array([n||1,i||1,s||1]),this.textureSize=r.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return r.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}.value, uploadValue_${this.name})`])}getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);const{context:t}=this;r.flattenTo(e.value,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],68:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelArray:i}=e("./array");t.exports={WebGLKernelValueUnsignedArray:class extends i{constructor(e,t){super(e,t),this.bitRatio=this.getBitRatio(e),this.dimensions=r.getDimensions(e,!0),this.textureSize=r.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]),this.TranserArrayType=this.getTransferArrayType(e),this.preUploadValue=new this.TranserArrayType(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer)}getStringValueHandler(){return r.linesToString([`const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,`const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,`flattenTo(${this.varName}, preUploadValue_${this.name})`])}getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);const{context:t}=this;r.flattenTo(e,this.preUploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.UNSIGNED_BYTE,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],69:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelArray:i}=e("./array");t.exports={WebGLKernelValueUnsignedInput:class extends i{constructor(e,t){super(e,t),this.bitRatio=this.getBitRatio(e);const[n,i,s]=e.size;this.dimensions=new Int32Array([n||1,i||1,s||1]),this.textureSize=r.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]),this.TranserArrayType=this.getTransferArrayType(e.value),this.preUploadValue=new this.TranserArrayType(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer)}getStringValueHandler(){return r.linesToString([`const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,`const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,`flattenTo(${this.varName}.value, preUploadValue_${this.name})`])}getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(value.constructor);const{context:t}=this;r.flattenTo(e.value,this.preUploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.UNSIGNED_BYTE,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],70:[function(e,t,n){const{GLKernel:r}=e("../gl/kernel"),{FunctionBuilder:i}=e("../function-builder"),{WebGLFunctionNode:s}=e("./function-node"),{utils:a}=e("../../utils"),o=e("../../plugins/math-random-uniformly-distributed"),{fragmentShader:u}=e("./fragment-shader"),{vertexShader:c}=e("./vertex-shader"),{glKernelString:l}=e("../gl/kernel-string"),{lookupKernelValueType:h}=e("./kernel-value-maps");let p=null,d=null,f=null,m=null,g=null;const y=[o],v=[],b={};t.exports={WebGLKernel:class extends r{static get isSupported(){return null!==p||(this.setupFeatureChecks(),p=this.isContextMatch(f)),p}static setupFeatureChecks(){"undefined"!=typeof document?d=document.createElement("canvas"):"undefined"!=typeof OffscreenCanvas&&(d=new OffscreenCanvas(0,0)),d&&(f=d.getContext("webgl")||d.getContext("experimental-webgl"),f&&f.getExtension&&(m={OES_texture_float:f.getExtension("OES_texture_float"),OES_texture_float_linear:f.getExtension("OES_texture_float_linear"),OES_element_index_uint:f.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:f.getExtension("WEBGL_draw_buffers")},g=this.getFeatures()))}static isContextMatch(e){return"undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext}static getIsTextureFloat(){return Boolean(m.OES_texture_float)}static getIsDrawBuffers(){return Boolean(m.WEBGL_draw_buffers)}static getChannelCount(){return m.WEBGL_draw_buffers?f.getParameter(m.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1}static getMaxTextureSize(){return f.getParameter(f.MAX_TEXTURE_SIZE)}static lookupKernelValueType(e,t,n,r){return h(e,t,n,r)}static get testCanvas(){return d}static get testContext(){return f}static get features(){return g}static get fragmentShader(){return u}static get vertexShader(){return c}constructor(e,t){super(e,t),this.program=null,this.pipeline=t.pipeline,this.endianness=a.systemEndianness(),this.extensions={},this.argumentTextureCount=0,this.constantTextureCount=0,this.fragShader=null,this.vertShader=null,this.drawBuffersMap=null,this.maxTexSize=null,this.onRequestSwitchKernel=null,this.texture=null,this.mappedTextures=null,this.mergeSettings(e.settings||t),this.threadDim=null,this.framebuffer=null,this.buffer=null,this.textureCache=[],this.programUniformLocationCache={},this.uniform1fCache={},this.uniform1iCache={},this.uniform2fCache={},this.uniform2fvCache={},this.uniform2ivCache={},this.uniform3fvCache={},this.uniform3ivCache={},this.uniform4fvCache={},this.uniform4ivCache={}}initCanvas(){if("undefined"!=typeof document){const e=document.createElement("canvas");return e.width=2,e.height=2,e}if("undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(0,0)}initContext(){const e={alpha:!1,depth:!1,antialias:!1};return this.canvas.getContext("webgl",e)||this.canvas.getContext("experimental-webgl",e)}initPlugins(e){const t=[],{source:n}=this;if("string"==typeof n)for(let e=0;e<y.length;e++){const r=y[e];n.match(r.functionMatch)&&t.push(r)}else if("object"==typeof n&&e.pluginNames)for(let n=0;n<y.length;n++){const r=y[n];e.pluginNames.some((e=>e===r.name))&&t.push(r)}return t}initExtensions(){this.extensions={OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers"),WEBGL_color_buffer_float:this.context.getExtension("WEBGL_color_buffer_float")}}validateSettings(e){if(!this.validate)return void(this.texSize=a.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output));const{features:t}=this.constructor;if(!0===this.optimizeFloatMemory&&!t.isTextureFloat)throw new Error("Float textures are not supported");if("single"===this.precision&&!t.isFloatRead)throw new Error("Single precision not supported");if(!this.graphical&&null===this.precision&&t.isTextureFloat&&(this.precision=t.isFloatRead?"single":"unsigned"),this.subKernels&&this.subKernels.length>0&&!this.extensions.WEBGL_draw_buffers)throw new Error("could not instantiate draw buffers extension");if(null===this.fixIntegerDivisionAccuracy?this.fixIntegerDivisionAccuracy=!t.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&t.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||0===this.output.length){if(1!==e.length)throw new Error("Auto output only supported for kernels with only one input");const t=a.getVariableType(e[0],this.strictIntegers);switch(t){case"Array":this.output=a.getDimensions(t);break;case"NumberTexture":case"MemoryOptimizedNumberTexture":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":this.output=e[0].output;break;default:throw new Error("Auto output not supported for input type: "+t)}}if(this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");return"precision"===this.precision&&(this.precision="unsigned",console.warn("Cannot use graphical mode and single precision at the same time")),void(this.texSize=a.clone(this.output))}null===this.precision&&t.isTextureFloat&&(this.precision="single"),this.texSize=a.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output),this.checkTextureSize()}updateMaxTexSize(){const{texSize:e,canvas:t}=this;if(null===this.maxTexSize){let n=v.indexOf(t);-1===n&&(n=v.length,v.push(t),b[n]=[e[0],e[1]]),this.maxTexSize=b[n]}this.maxTexSize[0]<e[0]&&(this.maxTexSize[0]=e[0]),this.maxTexSize[1]<e[1]&&(this.maxTexSize[1]=e[1])}setupArguments(e){this.kernelArguments=[],this.argumentTextureCount=0;const t=null===this.argumentTypes;if(t&&(this.argumentTypes=[]),this.argumentSizes=[],this.argumentBitRatios=[],e.length<this.argumentNames.length)throw new Error("not enough arguments for kernel");if(e.length>this.argumentNames.length)throw new Error("too many arguments for kernel");const{context:n}=this;let r=0;const i=()=>this.createTexture(),s=()=>this.constantTextureCount+r++,o=e=>{this.switchKernels({type:"argumentMismatch",needed:e})},u=()=>n.TEXTURE0+this.constantTextureCount+this.argumentTextureCount++;for(let r=0;r<e.length;r++){const c=e[r],l=this.argumentNames[r];let h;t?(h=a.getVariableType(c,this.strictIntegers),this.argumentTypes.push(h)):h=this.argumentTypes[r];const p=this.constructor.lookupKernelValueType(h,this.dynamicArguments?"dynamic":"static",this.precision,e[r]);if(null===p)return this.requestFallback(e);const d=new p(c,{name:l,type:h,tactic:this.tactic,origin:"user",context:n,checkContext:this.checkContext,kernel:this,strictIntegers:this.strictIntegers,onRequestTexture:i,onRequestIndex:s,onUpdateValueMismatch:o,onRequestContextHandle:u});this.kernelArguments.push(d),d.setup(),this.argumentSizes.push(d.textureSize),this.argumentBitRatios[r]=d.bitRatio}}createTexture(){const e=this.context.createTexture();return this.textureCache.push(e),e}setupConstants(e){const{context:t}=this;this.kernelConstants=[],this.forceUploadKernelConstants=[];let n=null===this.constantTypes;n&&(this.constantTypes={}),this.constantBitRatios={};let r=0;for(const i in this.constants){const s=this.constants[i];let o;n?(o=a.getVariableType(s,this.strictIntegers),this.constantTypes[i]=o):o=this.constantTypes[i];const u=this.constructor.lookupKernelValueType(o,"static",this.precision,s);if(null===u)return this.requestFallback(e);const c=new u(s,{name:i,type:o,tactic:this.tactic,origin:"constants",context:this.context,checkContext:this.checkContext,kernel:this,strictIntegers:this.strictIntegers,onRequestTexture:()=>this.createTexture(),onRequestIndex:()=>r++,onRequestContextHandle:()=>t.TEXTURE0+this.constantTextureCount++});this.constantBitRatios[i]=c.bitRatio,this.kernelConstants.push(c),c.setup(),c.forceUploadEachRun&&this.forceUploadKernelConstants.push(c)}}build(){if(this.built)return;if(this.initExtensions(),this.validateSettings(arguments),this.setupConstants(arguments),this.fallbackRequested)return;if(this.setupArguments(arguments),this.fallbackRequested)return;this.updateMaxTexSize(),this.translateSource();const e=this.pickRenderStrategy(arguments);if(e)return e;const{texSize:t,context:n,canvas:r}=this;n.enable(n.SCISSOR_TEST),this.pipeline&&this.precision,n.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),r.width=this.maxTexSize[0],r.height=this.maxTexSize[1];const i=this.threadDim=Array.from(this.output);for(;i.length<3;)i.push(1);const s=this.getVertexShader(arguments),a=n.createShader(n.VERTEX_SHADER);n.shaderSource(a,s),n.compileShader(a),this.vertShader=a;const o=this.getFragmentShader(arguments),u=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(u,o),n.compileShader(u),this.fragShader=u,this.debug&&(console.log("GLSL Shader Output:"),console.log(o)),!n.getShaderParameter(a,n.COMPILE_STATUS))throw new Error("Error compiling vertex shader: "+n.getShaderInfoLog(a));if(!n.getShaderParameter(u,n.COMPILE_STATUS))throw new Error("Error compiling fragment shader: "+n.getShaderInfoLog(u));const c=this.program=n.createProgram();n.attachShader(c,a),n.attachShader(c,u),n.linkProgram(c),this.framebuffer=n.createFramebuffer(),this.framebuffer.width=t[0],this.framebuffer.height=t[1],this.rawValueFramebuffers={};const l=new Float32Array([-1,-1,1,-1,-1,1,1,1]),h=new Float32Array([0,0,1,0,0,1,1,1]),p=l.byteLength;let d=this.buffer;d?n.bindBuffer(n.ARRAY_BUFFER,d):(d=this.buffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,d),n.bufferData(n.ARRAY_BUFFER,l.byteLength+h.byteLength,n.STATIC_DRAW)),n.bufferSubData(n.ARRAY_BUFFER,0,l),n.bufferSubData(n.ARRAY_BUFFER,p,h);const f=n.getAttribLocation(this.program,"aPos");n.enableVertexAttribArray(f),n.vertexAttribPointer(f,2,n.FLOAT,!1,0,0);const m=n.getAttribLocation(this.program,"aTexCoord");n.enableVertexAttribArray(m),n.vertexAttribPointer(m,2,n.FLOAT,!1,0,p),n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffer);let g=0;n.useProgram(this.program);for(let e in this.constants)this.kernelConstants[g++].updateValue(this.constants[e]);this._setupOutputTexture(),null!==this.subKernels&&this.subKernels.length>0&&(this._mappedTextureSwitched={},this._setupSubOutputTextures()),this.buildSignature(arguments),this.built=!0}translateSource(){const e=i.fromKernel(this,s,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});this.translatedSource=e.getPrototypeString("kernel"),this.setupReturnTypes(e)}setupReturnTypes(e){if(this.graphical||this.returnType||(this.returnType=e.getKernelResultType()),this.subKernels&&this.subKernels.length>0)for(let t=0;t<this.subKernels.length;t++){const n=this.subKernels[t];n.returnType||(n.returnType=e.getSubKernelResultType(t))}}run(){const{kernelArguments:e,texSize:t,forceUploadKernelConstants:n,context:r}=this;r.useProgram(this.program),r.scissor(0,0,t[0],t[1]),this.dynamicOutput&&(this.setUniform3iv("uOutputDim",new Int32Array(this.threadDim)),this.setUniform2iv("uTexSize",t)),this.setUniform2f("ratio",t[0]/this.maxTexSize[0],t[1]/this.maxTexSize[1]);for(let e=0;e<n.length;e++){const t=n[e];if(t.updateValue(this.constants[t.name]),this.switchingKernels)return}for(let t=0;t<e.length;t++)if(e[t].updateValue(arguments[t]),this.switchingKernels)return;if(this.plugins)for(let e=0;e<this.plugins.length;e++){const t=this.plugins[e];t.onBeforeRun&&t.onBeforeRun(this)}if(this.graphical)return this.pipeline?(r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer),this.immutable&&this._replaceOutputTexture(),r.drawArrays(r.TRIANGLE_STRIP,0,4),this.immutable?this.texture.clone():this.texture):(r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),void r.drawArrays(r.TRIANGLE_STRIP,0,4));r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer),this.immutable&&this._replaceOutputTexture(),null!==this.subKernels&&(this.immutable&&this._replaceSubOutputTextures(),this.drawBuffers()),r.drawArrays(r.TRIANGLE_STRIP,0,4)}drawBuffers(){this.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(this.drawBuffersMap)}getInternalFormat(){return this.context.RGBA}getTextureFormat(){const{context:e}=this;switch(this.getInternalFormat()){case e.RGBA:return e.RGBA;default:throw new Error("Unknown internal format")}}_replaceOutputTexture(){if(this.texture.beforeMutate()||this._textureSwitched){const e=this.context;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture.texture,0),this._textureSwitched=!1}}_setupOutputTexture(){const e=this.context,t=this.texSize;if(this.texture)return void e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture.texture,0);const n=this.createTexture();e.activeTexture(e.TEXTURE0+this.constantTextureCount+this.argumentTextureCount),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);const r=this.getInternalFormat();"single"===this.precision?e.texImage2D(e.TEXTURE_2D,0,r,t[0],t[1],0,e.RGBA,e.FLOAT,null):e.texImage2D(e.TEXTURE_2D,0,r,t[0],t[1],0,r,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0),this.texture=new this.TextureConstructor({texture:n,size:t,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this})}_replaceSubOutputTextures(){const e=this.context;for(let t=0;t<this.mappedTextures.length;t++){const n=this.mappedTextures[t];(n.beforeMutate()||this._mappedTextureSwitched[t])&&(e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t+1,e.TEXTURE_2D,n.texture,0),this._mappedTextureSwitched[t]=!1)}}_setupSubOutputTextures(){const e=this.context;if(this.mappedTextures){for(let t=0;t<this.subKernels.length;t++)e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t+1,e.TEXTURE_2D,this.mappedTextures[t].texture,0);return}const t=this.texSize;this.drawBuffersMap=[e.COLOR_ATTACHMENT0],this.mappedTextures=[];for(let n=0;n<this.subKernels.length;n++){const r=this.createTexture();this.drawBuffersMap.push(e.COLOR_ATTACHMENT0+n+1),e.activeTexture(e.TEXTURE0+this.constantTextureCount+this.argumentTextureCount+n),e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),"single"===this.precision?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.FLOAT,null):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n+1,e.TEXTURE_2D,r,0),this.mappedTextures.push(new this.TextureConstructor({texture:r,size:t,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this}))}}setUniform1f(e,t){if(this.uniform1fCache.hasOwnProperty(e)&&t===this.uniform1fCache[e])return;this.uniform1fCache[e]=t;const n=this.getUniformLocation(e);this.context.uniform1f(n,t)}setUniform1i(e,t){if(this.uniform1iCache.hasOwnProperty(e)&&t===this.uniform1iCache[e])return;this.uniform1iCache[e]=t;const n=this.getUniformLocation(e);this.context.uniform1i(n,t)}setUniform2f(e,t,n){if(this.uniform2fCache.hasOwnProperty(e)){const r=this.uniform2fCache[e];if(t===r[0]&&n===r[1])return}this.uniform2fCache[e]=[t,n];const r=this.getUniformLocation(e);this.context.uniform2f(r,t,n)}setUniform2fv(e,t){if(this.uniform2fvCache.hasOwnProperty(e)){const n=this.uniform2fvCache[e];if(t[0]===n[0]&&t[1]===n[1])return}this.uniform2fvCache[e]=t;const n=this.getUniformLocation(e);this.context.uniform2fv(n,t)}setUniform2iv(e,t){if(this.uniform2ivCache.hasOwnProperty(e)){const n=this.uniform2ivCache[e];if(t[0]===n[0]&&t[1]===n[1])return}this.uniform2ivCache[e]=t;const n=this.getUniformLocation(e);this.context.uniform2iv(n,t)}setUniform3fv(e,t){if(this.uniform3fvCache.hasOwnProperty(e)){const n=this.uniform3fvCache[e];if(t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2])return}this.uniform3fvCache[e]=t;const n=this.getUniformLocation(e);this.context.uniform3fv(n,t)}setUniform3iv(e,t){if(this.uniform3ivCache.hasOwnProperty(e)){const n=this.uniform3ivCache[e];if(t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2])return}this.uniform3ivCache[e]=t;const n=this.getUniformLocation(e);this.context.uniform3iv(n,t)}setUniform4fv(e,t){if(this.uniform4fvCache.hasOwnProperty(e)){const n=this.uniform4fvCache[e];if(t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3])return}this.uniform4fvCache[e]=t;const n=this.getUniformLocation(e);this.context.uniform4fv(n,t)}setUniform4iv(e,t){if(this.uniform4ivCache.hasOwnProperty(e)){const n=this.uniform4ivCache[e];if(t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3])return}this.uniform4ivCache[e]=t;const n=this.getUniformLocation(e);this.context.uniform4iv(n,t)}getUniformLocation(e){return this.programUniformLocationCache.hasOwnProperty(e)?this.programUniformLocationCache[e]:this.programUniformLocationCache[e]=this.context.getUniformLocation(this.program,e)}_getFragShaderArtifactMap(e){return{HEADER:this._getHeaderString(),LOOP_MAX:this._getLoopMaxString(),PLUGINS:this._getPluginsString(),CONSTANTS:this._getConstantsString(),DECODE32_ENDIANNESS:this._getDecode32EndiannessString(),ENCODE32_ENDIANNESS:this._getEncode32EndiannessString(),DIVIDE_WITH_INTEGER_CHECK:this._getDivideWithIntegerCheckString(),INJECTED_NATIVE:this._getInjectedNative(),MAIN_CONSTANTS:this._getMainConstantsString(),MAIN_ARGUMENTS:this._getMainArgumentsString(e),KERNEL:this.getKernelString(),MAIN_RESULT:this.getMainResultString(),FLOAT_TACTIC_DECLARATION:this.getFloatTacticDeclaration(),INT_TACTIC_DECLARATION:this.getIntTacticDeclaration(),SAMPLER_2D_TACTIC_DECLARATION:this.getSampler2DTacticDeclaration(),SAMPLER_2D_ARRAY_TACTIC_DECLARATION:this.getSampler2DArrayTacticDeclaration()}}_getVertShaderArtifactMap(e){return{FLOAT_TACTIC_DECLARATION:this.getFloatTacticDeclaration(),INT_TACTIC_DECLARATION:this.getIntTacticDeclaration(),SAMPLER_2D_TACTIC_DECLARATION:this.getSampler2DTacticDeclaration(),SAMPLER_2D_ARRAY_TACTIC_DECLARATION:this.getSampler2DArrayTacticDeclaration()}}_getHeaderString(){return null!==this.subKernels?"#extension GL_EXT_draw_buffers : require\n":""}_getLoopMaxString(){return this.loopMaxIterations?` ${parseInt(this.loopMaxIterations)};\n`:" 1000;\n"}_getPluginsString(){return this.plugins?this.plugins.map((e=>e.source&&this.source.match(e.functionMatch)?e.source:"")).join("\n"):"\n"}_getConstantsString(){const e=[],{threadDim:t,texSize:n}=this;return this.dynamicOutput?e.push("uniform ivec3 uOutputDim","uniform ivec2 uTexSize"):e.push(`ivec3 uOutputDim = ivec3(${t[0]}, ${t[1]}, ${t[2]})`,`ivec2 uTexSize = ivec2(${n[0]}, ${n[1]})`),a.linesToString(e)}_getTextureCoordinate(){const e=this.subKernels;return null===e||e.length<1?"varying vec2 vTexCoord;\n":"out vec2 vTexCoord;\n"}_getDecode32EndiannessString(){return"LE"===this.endianness?"":"  texel.rgba = texel.abgr;\n"}_getEncode32EndiannessString(){return"LE"===this.endianness?"":"  texel.rgba = texel.abgr;\n"}_getDivideWithIntegerCheckString(){return this.fixIntegerDivisionAccuracy?"float divWithIntCheck(float x, float y) {\n  if (floor(x) == x && floor(y) == y && integerMod(x, y) == 0.0) {\n    return float(int(x) / int(y));\n  }\n  return x / y;\n}\n\nfloat integerCorrectionModulo(float number, float divisor) {\n  if (number < 0.0) {\n    number = abs(number);\n    if (divisor < 0.0) {\n      divisor = abs(divisor);\n    }\n    return -(number - (divisor * floor(divWithIntCheck(number, divisor))));\n  }\n  if (divisor < 0.0) {\n    divisor = abs(divisor);\n  }\n  return number - (divisor * floor(divWithIntCheck(number, divisor)));\n}":""}_getMainArgumentsString(e){const t=[],{argumentNames:n}=this;for(let r=0;r<n.length;r++)t.push(this.kernelArguments[r].getSource(e[r]));return t.join("")}_getInjectedNative(){return this.injectedNative||""}_getMainConstantsString(){const e=[],{constants:t}=this;if(t){let n=0;for(const r in t)this.constants.hasOwnProperty(r)&&e.push(this.kernelConstants[n++].getSource(this.constants[r]))}return e.join("")}getRawValueFramebuffer(e,t){if(this.rawValueFramebuffers[e]||(this.rawValueFramebuffers[e]={}),!this.rawValueFramebuffers[e][t]){const n=this.context.createFramebuffer();n.width=e,n.height=t,this.rawValueFramebuffers[e][t]=n}return this.rawValueFramebuffers[e][t]}getKernelResultDeclaration(){switch(this.returnType){case"Array(2)":return"vec2 kernelResult";case"Array(3)":return"vec3 kernelResult";case"Array(4)":return"vec4 kernelResult";case"LiteralInteger":case"Float":case"Number":case"Integer":return"float kernelResult";default:if(this.graphical)return"float kernelResult";throw new Error(`unrecognized output type "${this.returnType}"`)}}getKernelString(){const e=[this.getKernelResultDeclaration()],{subKernels:t}=this;if(null!==t)switch(this.returnType){case"Number":case"Float":case"Integer":for(let n=0;n<t.length;n++){const r=t[n];e.push("Integer"===r.returnType?`int subKernelResult_${r.name} = 0`:`float subKernelResult_${r.name} = 0.0`)}break;case"Array(2)":for(let n=0;n<t.length;n++)e.push(`vec2 subKernelResult_${t[n].name}`);break;case"Array(3)":for(let n=0;n<t.length;n++)e.push(`vec3 subKernelResult_${t[n].name}`);break;case"Array(4)":for(let n=0;n<t.length;n++)e.push(`vec4 subKernelResult_${t[n].name}`)}return a.linesToString(e)+this.translatedSource}getMainResultGraphical(){return a.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = actualColor"])}getMainResultPackedPixels(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return this.getMainResultKernelPackedPixels()+this.getMainResultSubKernelPackedPixels();default:throw new Error(`packed output only usable with Numbers, "${this.returnType}" specified`)}}getMainResultKernelPackedPixels(){return a.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  gl_FragData[0] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(kernelResult)`])}getMainResultSubKernelPackedPixels(){const e=[];if(!this.subKernels)return"";for(let t=0;t<this.subKernels.length;t++)"Integer"===this.subKernels[t].returnType?e.push(`  gl_FragData[${t+1}] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(float(subKernelResult_${this.subKernels[t].name}))`):e.push(`  gl_FragData[${t+1}] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(subKernelResult_${this.subKernels[t].name})`);return a.linesToString(e)}getMainResultMemoryOptimizedFloats(){const e=["  index *= 4"];switch(this.returnType){case"Number":case"Integer":case"Float":const t=["r","g","b","a"];for(let n=0;n<t.length;n++){const r=t[n];this.getMainResultKernelMemoryOptimizedFloats(e,r),this.getMainResultSubKernelMemoryOptimizedFloats(e,r),n+1<t.length&&e.push("  index += 1")}break;default:throw new Error(`optimized output only usable with Numbers, ${this.returnType} specified`)}return a.linesToString(e)}getMainResultKernelMemoryOptimizedFloats(e,t){e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  gl_FragData[0].${t} = kernelResult`)}getMainResultSubKernelMemoryOptimizedFloats(e,t){if(!this.subKernels)return e;for(let n=0;n<this.subKernels.length;n++)"Integer"===this.subKernels[n].returnType?e.push(`  gl_FragData[${n+1}].${t} = float(subKernelResult_${this.subKernels[n].name})`):e.push(`  gl_FragData[${n+1}].${t} = subKernelResult_${this.subKernels[n].name}`)}getMainResultKernelNumberTexture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult"]}getMainResultSubKernelNumberTexture(){const e=[];if(!this.subKernels)return e;for(let t=0;t<this.subKernels.length;++t){const n=this.subKernels[t];"Integer"===n.returnType?e.push(`  gl_FragData[${t+1}][0] = float(subKernelResult_${n.name})`):e.push(`  gl_FragData[${t+1}][0] = subKernelResult_${n.name}`)}return e}getMainResultKernelArray2Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult[0]","  gl_FragData[0][1] = kernelResult[1]"]}getMainResultSubKernelArray2Texture(){const e=[];if(!this.subKernels)return e;for(let t=0;t<this.subKernels.length;++t)e.push(`  gl_FragData[${t+1}][0] = subKernelResult_${this.subKernels[t].name}[0]`,`  gl_FragData[${t+1}][1] = subKernelResult_${this.subKernels[t].name}[1]`);return e}getMainResultKernelArray3Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult[0]","  gl_FragData[0][1] = kernelResult[1]","  gl_FragData[0][2] = kernelResult[2]"]}getMainResultSubKernelArray3Texture(){const e=[];if(!this.subKernels)return e;for(let t=0;t<this.subKernels.length;++t)e.push(`  gl_FragData[${t+1}][0] = subKernelResult_${this.subKernels[t].name}[0]`,`  gl_FragData[${t+1}][1] = subKernelResult_${this.subKernels[t].name}[1]`,`  gl_FragData[${t+1}][2] = subKernelResult_${this.subKernels[t].name}[2]`);return e}getMainResultKernelArray4Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0] = kernelResult"]}getMainResultSubKernelArray4Texture(){const e=[];if(!this.subKernels)return e;switch(this.returnType){case"Number":case"Float":case"Integer":for(let t=0;t<this.subKernels.length;++t)"Integer"===this.subKernels[t].returnType?e.push(`  gl_FragData[${t+1}] = float(subKernelResult_${this.subKernels[t].name})`):e.push(`  gl_FragData[${t+1}] = subKernelResult_${this.subKernels[t].name}`);break;case"Array(2)":for(let t=0;t<this.subKernels.length;++t)e.push(`  gl_FragData[${t+1}][0] = subKernelResult_${this.subKernels[t].name}[0]`,`  gl_FragData[${t+1}][1] = subKernelResult_${this.subKernels[t].name}[1]`);break;case"Array(3)":for(let t=0;t<this.subKernels.length;++t)e.push(`  gl_FragData[${t+1}][0] = subKernelResult_${this.subKernels[t].name}[0]`,`  gl_FragData[${t+1}][1] = subKernelResult_${this.subKernels[t].name}[1]`,`  gl_FragData[${t+1}][2] = subKernelResult_${this.subKernels[t].name}[2]`);break;case"Array(4)":for(let t=0;t<this.subKernels.length;++t)e.push(`  gl_FragData[${t+1}][0] = subKernelResult_${this.subKernels[t].name}[0]`,`  gl_FragData[${t+1}][1] = subKernelResult_${this.subKernels[t].name}[1]`,`  gl_FragData[${t+1}][2] = subKernelResult_${this.subKernels[t].name}[2]`,`  gl_FragData[${t+1}][3] = subKernelResult_${this.subKernels[t].name}[3]`)}return e}replaceArtifacts(e,t){return e.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z]*[0-9]?)*)__;\n/g,((e,n)=>{if(t.hasOwnProperty(n))return t[n];throw`unhandled artifact ${n}`}))}getFragmentShader(e){return null!==this.compiledFragmentShader?this.compiledFragmentShader:this.compiledFragmentShader=this.replaceArtifacts(this.constructor.fragmentShader,this._getFragShaderArtifactMap(e))}getVertexShader(e){return null!==this.compiledVertexShader?this.compiledVertexShader:this.compiledVertexShader=this.replaceArtifacts(this.constructor.vertexShader,this._getVertShaderArtifactMap(e))}toString(){const e=a.linesToString(["const gl = context"]);return l(this.constructor,arguments,this,e)}destroy(e){if(!this.context)return;this.buffer&&this.context.deleteBuffer(this.buffer),this.framebuffer&&this.context.deleteFramebuffer(this.framebuffer);for(const e in this.rawValueFramebuffers){for(const t in this.rawValueFramebuffers[e])this.context.deleteFramebuffer(this.rawValueFramebuffers[e][t]),delete this.rawValueFramebuffers[e][t];delete this.rawValueFramebuffers[e]}if(this.vertShader&&this.context.deleteShader(this.vertShader),this.fragShader&&this.context.deleteShader(this.fragShader),this.program&&this.context.deleteProgram(this.program),this.texture){this.texture.delete();const e=this.textureCache.indexOf(this.texture.texture);e>-1&&this.textureCache.splice(e,1),this.texture=null}if(this.mappedTextures&&this.mappedTextures.length){for(let e=0;e<this.mappedTextures.length;e++){const t=this.mappedTextures[e];t.delete();const n=this.textureCache.indexOf(t.texture);n>-1&&this.textureCache.splice(n,1)}this.mappedTextures=null}if(this.kernelArguments)for(let e=0;e<this.kernelArguments.length;e++)this.kernelArguments[e].destroy();if(this.kernelConstants)for(let e=0;e<this.kernelConstants.length;e++)this.kernelConstants[e].destroy();for(;this.textureCache.length>0;){const e=this.textureCache.pop();this.context.deleteTexture(e)}if(e){const e=v.indexOf(this.canvas);e>=0&&(v[e]=null,b[e]=null)}if(this.destroyExtensions(),delete this.context,delete this.canvas,!this.gpu)return;const t=this.gpu.kernels.indexOf(this);-1!==t&&this.gpu.kernels.splice(t,1)}destroyExtensions(){this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null,this.extensions.WEBGL_draw_buffers=null}static destroyContext(e){const t=e.getExtension("WEBGL_lose_context");t&&t.loseContext()}toJSON(){const e=super.toJSON();return e.functionNodes=i.fromKernel(this,s).toJSON(),e.settings.threadDim=this.threadDim,e}}}},{"../../plugins/math-random-uniformly-distributed":112,"../../utils":114,"../function-builder":9,"../gl/kernel":13,"../gl/kernel-string":12,"./fragment-shader":37,"./function-node":38,"./kernel-value-maps":39,"./vertex-shader":71}],71:[function(e,t,n){t.exports={vertexShader:"__FLOAT_TACTIC_DECLARATION__;\n__INT_TACTIC_DECLARATION__;\n__SAMPLER_2D_TACTIC_DECLARATION__;\n\nattribute vec2 aPos;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}"}},{}],72:[function(e,t,n){const r=`#version 300 es\n__HEADER__;\n__FLOAT_TACTIC_DECLARATION__;\n__INT_TACTIC_DECLARATION__;\n__SAMPLER_2D_TACTIC_DECLARATION__;\n__SAMPLER_2D_ARRAY_TACTIC_DECLARATION__;\n\nconst int LOOP_MAX = __LOOP_MAX__;\n\n__PLUGINS__;\n__CONSTANTS__;\n\nin vec2 vTexCoord;\n\nfloat atan2(float v1, float v2) {\n  if (v1 == 0.0 || v2 == 0.0) return 0.0;\n  return atan(v1 / v2);\n}\n\nfloat cbrt(float x) {\n  if (x >= 0.0) {\n    return pow(x, 1.0 / 3.0);\n  } else {\n    return -pow(x, 1.0 / 3.0);\n  }\n}\n\nfloat expm1(float x) {\n  return pow(${Math.E}, x) - 1.0; \n}\n\nfloat fround(highp float x) {\n  return x;\n}\n\nfloat imul(float v1, float v2) {\n  return float(int(v1) * int(v2));\n}\n\nfloat log10(float x) {\n  return log2(x) * (1.0 / log2(10.0));\n}\n\nfloat log1p(float x) {\n  return log(1.0 + x);\n}\n\nfloat _pow(float v1, float v2) {\n  if (v2 == 0.0) return 1.0;\n  return pow(v1, v2);\n}\n\nfloat _round(float x) {\n  return floor(x + 0.5);\n}\n\n\nconst int BIT_COUNT = 32;\nint modi(int x, int y) {\n  return x - y * (x / y);\n}\n\nint bitwiseOr(int a, int b) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 || b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseXOR(int a, int b) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 || b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseAnd(int a, int b) {\n  int result = 0;\n  int n = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 && b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseNot(int a) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (modi(a, 2) == 0) {\n      result += n;    \n    }\n    a = a / 2;\n    n = n * 2;\n  }\n  return result;\n}\nint bitwiseZeroFillLeftShift(int n, int shift) {\n  int maxBytes = BIT_COUNT;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (maxBytes >= n) {\n      break;\n    }\n    maxBytes *= 2;\n  }\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= shift) {\n      break;\n    }\n    n *= 2;\n  }\n\n  int result = 0;\n  int byteVal = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= maxBytes) break;\n    if (modi(n, 2) > 0) { result += byteVal; }\n    n = int(n / 2);\n    byteVal *= 2;\n  }\n  return result;\n}\n\nint bitwiseSignedRightShift(int num, int shifts) {\n  return int(floor(float(num) / pow(2.0, float(shifts))));\n}\n\nint bitwiseZeroFillRightShift(int n, int shift) {\n  int maxBytes = BIT_COUNT;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (maxBytes >= n) {\n      break;\n    }\n    maxBytes *= 2;\n  }\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= shift) {\n      break;\n    }\n    n /= 2;\n  }\n  int result = 0;\n  int byteVal = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= maxBytes) break;\n    if (modi(n, 2) > 0) { result += byteVal; }\n    n = int(n / 2);\n    byteVal *= 2;\n  }\n  return result;\n}\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nfloat integerMod(float x, float y) {\n  float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nint integerMod(int x, int y) {\n  return x - (y * int(x/y));\n}\n\n__DIVIDE_WITH_INTEGER_CHECK__;\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nfloat decode32(vec4 texel) {\n  __DECODE32_ENDIANNESS__;\n  texel *= 255.0;\n  vec2 gte128;\n  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  texel.b = texel.b - 128.0 * gte128.x;\n  res = dot(texel, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nfloat decode16(vec4 texel, int index) {\n  int channel = integerMod(index, 2);\n  return texel[channel*2] * 255.0 + texel[channel*2 + 1] * 65280.0;\n}\n\nfloat decode8(vec4 texel, int index) {\n  int channel = integerMod(index, 4);\n  return texel[channel] * 255.0;\n}\n\nvec4 legacyEncode32(float f) {\n  float F = abs(f);\n  float sign = f < 0.0 ? 1.0 : 0.0;\n  float exponent = floor(log2(F));\n  float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  texel.rg = integerMod(texel.rg, 256.0);\n  texel.b = integerMod(texel.b, 128.0);\n  texel.a = exponent*0.5 + 63.5;\n  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  texel = floor(texel);\n  texel *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return texel;\n}\n\n// https://github.com/gpujs/gpu.js/wiki/Encoder-details\nvec4 encode32(float value) {\n  if (value == 0.0) return vec4(0, 0, 0, 0);\n\n  float exponent;\n  float mantissa;\n  vec4  result;\n  float sgn;\n\n  sgn = step(0.0, -value);\n  value = abs(value);\n\n  exponent = floor(log2(value));\n\n  mantissa = value*pow(2.0, -exponent)-1.0;\n  exponent = exponent+127.0;\n  result   = vec4(0,0,0,0);\n\n  result.a = floor(exponent/2.0);\n  exponent = exponent - result.a*2.0;\n  result.a = result.a + 128.0*sgn;\n\n  result.b = floor(mantissa * 128.0);\n  mantissa = mantissa - result.b / 128.0;\n  result.b = result.b + exponent*128.0;\n\n  result.g = floor(mantissa*32768.0);\n  mantissa = mantissa - result.g/32768.0;\n\n  result.r = floor(mantissa*8388608.0);\n  return result/255.0;\n}\n// Dragons end here\n\nint index;\nivec3 threadId;\n\nivec3 indexTo3D(int idx, ivec3 texDim) {\n  int z = int(idx / (texDim.x * texDim.y));\n  idx -= z * int(texDim.x * texDim.y);\n  int y = int(idx / texDim.x);\n  int x = int(integerMod(idx, texDim.x));\n  return ivec3(x, y, z);\n}\n\nfloat get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  return decode32(texel);\n}\n\nfloat get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + (texDim.x * (y + (texDim.y * z)));\n  int w = texSize.x * 2;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize.x * 2, texSize.y));\n  return decode16(texel, index);\n}\n\nfloat get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + (texDim.x * (y + (texDim.y * z)));\n  int w = texSize.x * 4;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize.x * 4, texSize.y));\n  return decode8(texel, index);\n}\n\nfloat getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + (texDim.x * (y + (texDim.y * z)));\n  int channel = integerMod(index, 4);\n  index = index / 4;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  index = index / 4;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  return texel[channel];\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  return texture(tex, st / vec2(texSize));\n}\n\nvec4 getImage3D(sampler2DArray tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  return texture(tex, vec3(st / vec2(texSize), z));\n}\n\nfloat getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return result[0];\n}\n\nvec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return vec2(result[0], result[1]);\n}\n\nvec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int channel = integerMod(index, 2);\n  index = index / 2;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  if (channel == 0) return vec2(texel.r, texel.g);\n  if (channel == 1) return vec2(texel.b, texel.a);\n  return vec2(0.0, 0.0);\n}\n\nvec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return vec3(result[0], result[1], result[2]);\n}\n\nvec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));\n  int vectorIndex = fieldIndex / 4;\n  int vectorOffset = fieldIndex - vectorIndex * 4;\n  int readY = vectorIndex / texSize.x;\n  int readX = vectorIndex - readY * texSize.x;\n  vec4 tex1 = texture(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));\n\n  if (vectorOffset == 0) {\n    return tex1.xyz;\n  } else if (vectorOffset == 1) {\n    return tex1.yzw;\n  } else {\n    readX++;\n    if (readX >= texSize.x) {\n      readX = 0;\n      readY++;\n    }\n    vec4 tex2 = texture(tex, vec2(readX, readY) / vec2(texSize));\n    if (vectorOffset == 2) {\n      return vec3(tex1.z, tex1.w, tex2.x);\n    } else {\n      return vec3(tex1.w, tex2.x, tex2.y);\n    }\n  }\n}\n\nvec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  return getImage2D(tex, texSize, texDim, z, y, x);\n}\n\nvec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int channel = integerMod(index, 2);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  return vec4(texel.r, texel.g, texel.b, texel.a);\n}\n\nvec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\nfloat modulo(float number, float divisor) {\n  if (number < 0.0) {\n    number = abs(number);\n    if (divisor < 0.0) {\n      divisor = abs(divisor);\n    }\n    return -mod(number, divisor);\n  }\n  if (divisor < 0.0) {\n    divisor = abs(divisor);\n  }\n  return mod(number, divisor);\n}\n\n__INJECTED_NATIVE__;\n__MAIN_CONSTANTS__;\n__MAIN_ARGUMENTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}`;t.exports={fragmentShader:r}},{}],73:[function(e,t,n){const{utils:r}=e("../../utils"),{WebGLFunctionNode:i}=e("../web-gl/function-node");t.exports={WebGL2FunctionNode:class extends i{astIdentifierExpression(e,t){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e);const n=this.getType(e),i=r.sanitizeName(e.name);return"Infinity"===e.name?t.push("intBitsToFloat(2139095039)"):"Boolean"===n&&this.argumentNames.indexOf(i)>-1?t.push(`bool(user_${i})`):t.push(`user_${i}`),t}}}},{"../../utils":114,"../web-gl/function-node":38}],74:[function(e,t,n){const{WebGL2KernelValueBoolean:r}=e("./kernel-value/boolean"),{WebGL2KernelValueFloat:i}=e("./kernel-value/float"),{WebGL2KernelValueInteger:s}=e("./kernel-value/integer"),{WebGL2KernelValueHTMLImage:a}=e("./kernel-value/html-image"),{WebGL2KernelValueDynamicHTMLImage:o}=e("./kernel-value/dynamic-html-image"),{WebGL2KernelValueHTMLImageArray:u}=e("./kernel-value/html-image-array"),{WebGL2KernelValueDynamicHTMLImageArray:c}=e("./kernel-value/dynamic-html-image-array"),{WebGL2KernelValueHTMLVideo:l}=e("./kernel-value/html-video"),{WebGL2KernelValueDynamicHTMLVideo:h}=e("./kernel-value/dynamic-html-video"),{WebGL2KernelValueSingleInput:p}=e("./kernel-value/single-input"),{WebGL2KernelValueDynamicSingleInput:d}=e("./kernel-value/dynamic-single-input"),{WebGL2KernelValueUnsignedInput:f}=e("./kernel-value/unsigned-input"),{WebGL2KernelValueDynamicUnsignedInput:m}=e("./kernel-value/dynamic-unsigned-input"),{WebGL2KernelValueMemoryOptimizedNumberTexture:g}=e("./kernel-value/memory-optimized-number-texture"),{WebGL2KernelValueDynamicMemoryOptimizedNumberTexture:y}=e("./kernel-value/dynamic-memory-optimized-number-texture"),{WebGL2KernelValueNumberTexture:v}=e("./kernel-value/number-texture"),{WebGL2KernelValueDynamicNumberTexture:b}=e("./kernel-value/dynamic-number-texture"),{WebGL2KernelValueSingleArray:x}=e("./kernel-value/single-array"),{WebGL2KernelValueDynamicSingleArray:w}=e("./kernel-value/dynamic-single-array"),{WebGL2KernelValueSingleArray1DI:S}=e("./kernel-value/single-array1d-i"),{WebGL2KernelValueDynamicSingleArray1DI:T}=e("./kernel-value/dynamic-single-array1d-i"),{WebGL2KernelValueSingleArray2DI:C}=e("./kernel-value/single-array2d-i"),{WebGL2KernelValueDynamicSingleArray2DI:A}=e("./kernel-value/dynamic-single-array2d-i"),{WebGL2KernelValueSingleArray3DI:_}=e("./kernel-value/single-array3d-i"),{WebGL2KernelValueDynamicSingleArray3DI:k}=e("./kernel-value/dynamic-single-array3d-i"),{WebGL2KernelValueSingleArray2:I}=e("./kernel-value/single-array2"),{WebGL2KernelValueSingleArray3:E}=e("./kernel-value/single-array3"),{WebGL2KernelValueSingleArray4:O}=e("./kernel-value/single-array4"),{WebGL2KernelValueUnsignedArray:D}=e("./kernel-value/unsigned-array"),{WebGL2KernelValueDynamicUnsignedArray:B}=e("./kernel-value/dynamic-unsigned-array"),P={unsigned:{dynamic:{Boolean:r,Integer:s,Float:i,Array:B,"Array(2)":!1,"Array(3)":!1,"Array(4)":!1,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:m,NumberTexture:b,"ArrayTexture(1)":b,"ArrayTexture(2)":b,"ArrayTexture(3)":b,"ArrayTexture(4)":b,MemoryOptimizedNumberTexture:y,HTMLCanvas:o,HTMLImage:o,HTMLImageArray:c,HTMLVideo:h},static:{Boolean:r,Float:i,Integer:s,Array:D,"Array(2)":!1,"Array(3)":!1,"Array(4)":!1,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:f,NumberTexture:v,"ArrayTexture(1)":v,"ArrayTexture(2)":v,"ArrayTexture(3)":v,"ArrayTexture(4)":v,MemoryOptimizedNumberTexture:y,HTMLCanvas:a,HTMLImage:a,HTMLImageArray:u,HTMLVideo:l}},single:{dynamic:{Boolean:r,Integer:s,Float:i,Array:w,"Array(2)":I,"Array(3)":E,"Array(4)":O,"Array1D(2)":T,"Array1D(3)":T,"Array1D(4)":T,"Array2D(2)":A,"Array2D(3)":A,"Array2D(4)":A,"Array3D(2)":k,"Array3D(3)":k,"Array3D(4)":k,Input:d,NumberTexture:b,"ArrayTexture(1)":b,"ArrayTexture(2)":b,"ArrayTexture(3)":b,"ArrayTexture(4)":b,MemoryOptimizedNumberTexture:y,HTMLCanvas:o,HTMLImage:o,HTMLImageArray:c,HTMLVideo:h},static:{Boolean:r,Float:i,Integer:s,Array:x,"Array(2)":I,"Array(3)":E,"Array(4)":O,"Array1D(2)":S,"Array1D(3)":S,"Array1D(4)":S,"Array2D(2)":C,"Array2D(3)":C,"Array2D(4)":C,"Array3D(2)":_,"Array3D(3)":_,"Array3D(4)":_,Input:p,NumberTexture:v,"ArrayTexture(1)":v,"ArrayTexture(2)":v,"ArrayTexture(3)":v,"ArrayTexture(4)":v,MemoryOptimizedNumberTexture:g,HTMLCanvas:a,HTMLImage:a,HTMLImageArray:u,HTMLVideo:l}}};t.exports={kernelValueMaps:P,lookupKernelValueType:function(e,t,n,r){if(!e)throw new Error("type missing");if(!t)throw new Error("dynamic missing");if(!n)throw new Error("precision missing");r.type&&(e=r.type);const i=P[n][t];if(!1===i[e])return null;if(void 0===i[e])throw new Error(`Could not find a KernelValue for ${e}`);return i[e]}}},{"./kernel-value/boolean":75,"./kernel-value/dynamic-html-image":77,"./kernel-value/dynamic-html-image-array":76,"./kernel-value/dynamic-html-video":78,"./kernel-value/dynamic-memory-optimized-number-texture":79,"./kernel-value/dynamic-number-texture":80,"./kernel-value/dynamic-single-array":81,"./kernel-value/dynamic-single-array1d-i":82,"./kernel-value/dynamic-single-array2d-i":83,"./kernel-value/dynamic-single-array3d-i":84,"./kernel-value/dynamic-single-input":85,"./kernel-value/dynamic-unsigned-array":86,"./kernel-value/dynamic-unsigned-input":87,"./kernel-value/float":88,"./kernel-value/html-image":90,"./kernel-value/html-image-array":89,"./kernel-value/html-video":91,"./kernel-value/integer":92,"./kernel-value/memory-optimized-number-texture":93,"./kernel-value/number-texture":94,"./kernel-value/single-array":95,"./kernel-value/single-array1d-i":96,"./kernel-value/single-array2":97,"./kernel-value/single-array2d-i":98,"./kernel-value/single-array3":99,"./kernel-value/single-array3d-i":100,"./kernel-value/single-array4":101,"./kernel-value/single-input":102,"./kernel-value/unsigned-array":103,"./kernel-value/unsigned-input":104}],75:[function(e,t,n){const{WebGLKernelValueBoolean:r}=e("../../web-gl/kernel-value/boolean");t.exports={WebGL2KernelValueBoolean:class extends r{}}},{"../../web-gl/kernel-value/boolean":41}],76:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGL2KernelValueHTMLImageArray:i}=e("./html-image-array");t.exports={WebGL2KernelValueDynamicHTMLImageArray:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2DArray ${this.id}`,`uniform ${e} ivec2 ${this.sizeId}`,`uniform ${e} ivec3 ${this.dimensionsId}`])}updateValue(e){const{width:t,height:n}=e[0];this.checkSize(t,n),this.dimensions=[t,n,e.length],this.textureSize=[t,n],this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"./html-image-array":89}],77:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueDynamicHTMLImage:i}=e("../../web-gl/kernel-value/dynamic-html-image");t.exports={WebGL2KernelValueDynamicHTMLImage:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`uniform ${e} ivec2 ${this.sizeId}`,`uniform ${e} ivec3 ${this.dimensionsId}`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-html-image":42}],78:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGL2KernelValueDynamicHTMLImage:i}=e("./dynamic-html-image");t.exports={WebGL2KernelValueDynamicHTMLVideo:class extends i{}}},{"../../../utils":114,"./dynamic-html-image":77}],79:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueDynamicMemoryOptimizedNumberTexture:i}=e("../../web-gl/kernel-value/dynamic-memory-optimized-number-texture");t.exports={WebGL2KernelValueDynamicMemoryOptimizedNumberTexture:class extends i{getSource(){return r.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-memory-optimized-number-texture":44}],80:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueDynamicNumberTexture:i}=e("../../web-gl/kernel-value/dynamic-number-texture");t.exports={WebGL2KernelValueDynamicNumberTexture:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`uniform ${e} ivec2 ${this.sizeId}`,`uniform ${e} ivec3 ${this.dimensionsId}`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-number-texture":45}],81:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGL2KernelValueSingleArray:i}=e("../../web-gl2/kernel-value/single-array");t.exports={WebGL2KernelValueDynamicSingleArray:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`uniform ${e} ivec2 ${this.sizeId}`,`uniform ${e} ivec3 ${this.dimensionsId}`])}updateValue(e){this.dimensions=r.getDimensions(e,!0),this.textureSize=r.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array":95}],82:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGL2KernelValueSingleArray1DI:i}=e("../../web-gl2/kernel-value/single-array1d-i");t.exports={WebGL2KernelValueDynamicSingleArray1DI:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`uniform ${e} ivec2 ${this.sizeId}`,`uniform ${e} ivec3 ${this.dimensionsId}`])}updateValue(e){this.setShape(e),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array1d-i":96}],83:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGL2KernelValueSingleArray2DI:i}=e("../../web-gl2/kernel-value/single-array2d-i");t.exports={WebGL2KernelValueDynamicSingleArray2DI:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`uniform ${e} ivec2 ${this.sizeId}`,`uniform ${e} ivec3 ${this.dimensionsId}`])}updateValue(e){this.setShape(e),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array2d-i":98}],84:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGL2KernelValueSingleArray3DI:i}=e("../../web-gl2/kernel-value/single-array3d-i");t.exports={WebGL2KernelValueDynamicSingleArray3DI:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`uniform ${e} ivec2 ${this.sizeId}`,`uniform ${e} ivec3 ${this.dimensionsId}`])}updateValue(e){this.setShape(e),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array3d-i":100}],85:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGL2KernelValueSingleInput:i}=e("../../web-gl2/kernel-value/single-input");t.exports={WebGL2KernelValueDynamicSingleInput:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`uniform ${e} ivec2 ${this.sizeId}`,`uniform ${e} ivec3 ${this.dimensionsId}`])}updateValue(e){let[t,n,i]=e.size;this.dimensions=new Int32Array([t||1,n||1,i||1]),this.textureSize=r.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(e)}}}},{"../../../utils":114,"../../web-gl2/kernel-value/single-input":102}],86:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueDynamicUnsignedArray:i}=e("../../web-gl/kernel-value/dynamic-unsigned-array");t.exports={WebGL2KernelValueDynamicUnsignedArray:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`uniform ${e} ivec2 ${this.sizeId}`,`uniform ${e} ivec3 ${this.dimensionsId}`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-unsigned-array":51}],87:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueDynamicUnsignedInput:i}=e("../../web-gl/kernel-value/dynamic-unsigned-input");t.exports={WebGL2KernelValueDynamicUnsignedInput:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`uniform ${e} ivec2 ${this.sizeId}`,`uniform ${e} ivec3 ${this.dimensionsId}`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-unsigned-input":52}],88:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueFloat:i}=e("../../web-gl/kernel-value/float");t.exports={WebGL2KernelValueFloat:class extends i{}}},{"../../../utils":114,"../../web-gl/kernel-value/float":53}],89:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelArray:i}=e("../../web-gl/kernel-value/array");t.exports={WebGL2KernelValueHTMLImageArray:class extends i{constructor(e,t){super(e,t),this.checkSize(e[0].width,e[0].height),this.dimensions=[e[0].width,e[0].height,e.length],this.textureSize=[e[0].width,e[0].height]}defineTexture(){const{context:e}=this;e.activeTexture(this.contextHandle),e.bindTexture(e.TEXTURE_2D_ARRAY,this.texture),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.NEAREST)}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2DArray ${this.id}`,`${e} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${e} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){const{context:t}=this;t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D_ARRAY,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage3D(t.TEXTURE_2D_ARRAY,0,t.RGBA,e[0].width,e[0].height,e.length,0,t.RGBA,t.UNSIGNED_BYTE,null);for(let n=0;n<e.length;n++){const r=0,i=0,s=1;t.texSubImage3D(t.TEXTURE_2D_ARRAY,0,r,i,n,e[n].width,e[n].height,s,t.RGBA,t.UNSIGNED_BYTE,this.uploadValue=e[n])}this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"../../web-gl/kernel-value/array":40}],90:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueHTMLImage:i}=e("../../web-gl/kernel-value/html-image");t.exports={WebGL2KernelValueHTMLImage:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`${e} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${e} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/html-image":54}],91:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGL2KernelValueHTMLImage:i}=e("./html-image");t.exports={WebGL2KernelValueHTMLVideo:class extends i{}}},{"../../../utils":114,"./html-image":90}],92:[function(e,t,n){const{WebGLKernelValueInteger:r}=e("../../web-gl/kernel-value/integer");t.exports={WebGL2KernelValueInteger:class extends r{getSource(e){const t=this.getVariablePrecisionString();return"constants"===this.origin?`const ${t} int ${this.id} = ${parseInt(e)};\n`:`uniform ${t} int ${this.id};\n`}updateValue(e){"constants"!==this.origin&&this.kernel.setUniform1i(this.id,this.uploadValue=e)}}}},{"../../web-gl/kernel-value/integer":57}],93:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueMemoryOptimizedNumberTexture:i}=e("../../web-gl/kernel-value/memory-optimized-number-texture");t.exports={WebGL2KernelValueMemoryOptimizedNumberTexture:class extends i{getSource(){const{id:e,sizeId:t,textureSize:n,dimensionsId:i,dimensions:s}=this,a=this.getVariablePrecisionString();return r.linesToString([`uniform sampler2D ${e}`,`${a} ivec2 ${t} = ivec2(${n[0]}, ${n[1]})`,`${a} ivec3 ${i} = ivec3(${s[0]}, ${s[1]}, ${s[2]})`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/memory-optimized-number-texture":58}],94:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueNumberTexture:i}=e("../../web-gl/kernel-value/number-texture");t.exports={WebGL2KernelValueNumberTexture:class extends i{getSource(){const{id:e,sizeId:t,textureSize:n,dimensionsId:i,dimensions:s}=this,a=this.getVariablePrecisionString();return r.linesToString([`uniform ${a} sampler2D ${e}`,`${a} ivec2 ${t} = ivec2(${n[0]}, ${n[1]})`,`${a} ivec3 ${i} = ivec3(${s[0]}, ${s[1]}, ${s[2]})`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/number-texture":59}],95:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueSingleArray:i}=e("../../web-gl/kernel-value/single-array");t.exports={WebGL2KernelValueSingleArray:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`${e} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${e} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);const{context:t}=this;r.flattenTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"../../web-gl/kernel-value/single-array":60}],96:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueSingleArray1DI:i}=e("../../web-gl/kernel-value/single-array1d-i");t.exports={WebGL2KernelValueSingleArray1DI:class extends i{updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);const{context:t}=this;r.flattenTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"../../web-gl/kernel-value/single-array1d-i":61}],97:[function(e,t,n){const{WebGLKernelValueSingleArray2:r}=e("../../web-gl/kernel-value/single-array2");t.exports={WebGL2KernelValueSingleArray2:class extends r{}}},{"../../web-gl/kernel-value/single-array2":62}],98:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueSingleArray2DI:i}=e("../../web-gl/kernel-value/single-array2d-i");t.exports={WebGL2KernelValueSingleArray2DI:class extends i{updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);const{context:t}=this;r.flattenTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"../../web-gl/kernel-value/single-array2d-i":63}],99:[function(e,t,n){const{WebGLKernelValueSingleArray3:r}=e("../../web-gl/kernel-value/single-array3");t.exports={WebGL2KernelValueSingleArray3:class extends r{}}},{"../../web-gl/kernel-value/single-array3":64}],100:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueSingleArray3DI:i}=e("../../web-gl/kernel-value/single-array3d-i");t.exports={WebGL2KernelValueSingleArray3DI:class extends i{updateValue(e){if(e.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(e.constructor);const{context:t}=this;r.flattenTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"../../web-gl/kernel-value/single-array3d-i":65}],101:[function(e,t,n){const{WebGLKernelValueSingleArray4:r}=e("../../web-gl/kernel-value/single-array4");t.exports={WebGL2KernelValueSingleArray4:class extends r{}}},{"../../web-gl/kernel-value/single-array4":66}],102:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueSingleInput:i}=e("../../web-gl/kernel-value/single-input");t.exports={WebGL2KernelValueSingleInput:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`${e} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${e} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(e){const{context:t}=this;r.flattenTo(e.value,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"../../web-gl/kernel-value/single-input":67}],103:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueUnsignedArray:i}=e("../../web-gl/kernel-value/unsigned-array");t.exports={WebGL2KernelValueUnsignedArray:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`${e} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${e} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/unsigned-array":68}],104:[function(e,t,n){const{utils:r}=e("../../../utils"),{WebGLKernelValueUnsignedInput:i}=e("../../web-gl/kernel-value/unsigned-input");t.exports={WebGL2KernelValueUnsignedInput:class extends i{getSource(){const e=this.getVariablePrecisionString();return r.linesToString([`uniform ${e} sampler2D ${this.id}`,`${e} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${e} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/unsigned-input":69}],105:[function(e,t,n){const{WebGLKernel:r}=e("../web-gl/kernel"),{WebGL2FunctionNode:i}=e("./function-node"),{FunctionBuilder:s}=e("../function-builder"),{utils:a}=e("../../utils"),{fragmentShader:o}=e("./fragment-shader"),{vertexShader:u}=e("./vertex-shader"),{lookupKernelValueType:c}=e("./kernel-value-maps");let l=null,h=null,p=null,d=null,f=null;t.exports={WebGL2Kernel:class extends r{static get isSupported(){return null!==l||(this.setupFeatureChecks(),l=this.isContextMatch(p)),l}static setupFeatureChecks(){"undefined"!=typeof document?h=document.createElement("canvas"):"undefined"!=typeof OffscreenCanvas&&(h=new OffscreenCanvas(0,0)),h&&(p=h.getContext("webgl2"),p&&p.getExtension&&(d={EXT_color_buffer_float:p.getExtension("EXT_color_buffer_float"),OES_texture_float_linear:p.getExtension("OES_texture_float_linear")},f=this.getFeatures()))}static isContextMatch(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext}static getFeatures(){const e=this.testContext;return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isSpeedTacticSupported:this.getIsSpeedTacticSupported(),kernelMap:!0,isTextureFloat:!0,isDrawBuffers:!0,channelCount:this.getChannelCount(),maxTextureSize:this.getMaxTextureSize(),lowIntPrecision:e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_INT),lowFloatPrecision:e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_FLOAT),mediumIntPrecision:e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_INT),mediumFloatPrecision:e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT),highIntPrecision:e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_INT),highFloatPrecision:e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT)})}static getIsTextureFloat(){return!0}static getChannelCount(){return p.getParameter(p.MAX_DRAW_BUFFERS)}static getMaxTextureSize(){return p.getParameter(p.MAX_TEXTURE_SIZE)}static lookupKernelValueType(e,t,n,r){return c(e,t,n,r)}static get testCanvas(){return h}static get testContext(){return p}static get features(){return f}static get fragmentShader(){return o}static get vertexShader(){return u}initContext(){return this.canvas.getContext("webgl2",{alpha:!1,depth:!1,antialias:!1})}initExtensions(){this.extensions={EXT_color_buffer_float:this.context.getExtension("EXT_color_buffer_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear")}}validateSettings(e){if(!this.validate)return void(this.texSize=a.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output));const{features:t}=this.constructor;if("single"===this.precision&&!t.isFloatRead)throw new Error("Float texture outputs are not supported");if(this.graphical||null!==this.precision||(this.precision=t.isFloatRead?"single":"unsigned"),null===this.fixIntegerDivisionAccuracy?this.fixIntegerDivisionAccuracy=!t.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&t.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||0===this.output.length){if(1!==e.length)throw new Error("Auto output only supported for kernels with only one input");const t=a.getVariableType(e[0],this.strictIntegers);switch(t){case"Array":this.output=a.getDimensions(t);break;case"NumberTexture":case"MemoryOptimizedNumberTexture":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":this.output=e[0].output;break;default:throw new Error("Auto output not supported for input type: "+t)}}if(this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");return"single"===this.precision&&(console.warn("Cannot use graphical mode and single precision at the same time"),this.precision="unsigned"),void(this.texSize=a.clone(this.output))}!this.graphical&&null===this.precision&&t.isTextureFloat&&(this.precision="single"),this.texSize=a.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output),this.checkTextureSize()}translateSource(){const e=s.fromKernel(this,i,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});this.translatedSource=e.getPrototypeString("kernel"),this.setupReturnTypes(e)}drawBuffers(){this.context.drawBuffers(this.drawBuffersMap)}getTextureFormat(){const{context:e}=this;switch(this.getInternalFormat()){case e.R32F:return e.RED;case e.RG32F:return e.RG;case e.RGBA32F:case e.RGBA:return e.RGBA;default:throw new Error("Unknown internal format")}}getInternalFormat(){const{context:e}=this;if("single"===this.precision){if(this.pipeline)switch(this.returnType){case"Number":case"Float":case"Integer":return this.optimizeFloatMemory?e.RGBA32F:e.R32F;case"Array(2)":return e.RG32F;case"Array(3)":case"Array(4)":return e.RGBA32F;default:throw new Error("Unhandled return type")}return e.RGBA32F}return e.RGBA}_setupOutputTexture(){const e=this.context;if(this.texture)return void e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture.texture,0);e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer);const t=e.createTexture(),n=this.texSize;e.activeTexture(e.TEXTURE0+this.constantTextureCount+this.argumentTextureCount),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);const r=this.getInternalFormat();"single"===this.precision?e.texStorage2D(e.TEXTURE_2D,1,r,n[0],n[1]):e.texImage2D(e.TEXTURE_2D,0,r,n[0],n[1],0,r,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.texture=new this.TextureConstructor({texture:t,size:n,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this})}_setupSubOutputTextures(){const e=this.context;if(this.mappedTextures){for(let t=0;t<this.subKernels.length;t++)e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t+1,e.TEXTURE_2D,this.mappedTextures[t].texture,0);return}const t=this.texSize;this.drawBuffersMap=[e.COLOR_ATTACHMENT0],this.mappedTextures=[];for(let n=0;n<this.subKernels.length;n++){const r=this.createTexture();this.drawBuffersMap.push(e.COLOR_ATTACHMENT0+n+1),e.activeTexture(e.TEXTURE0+this.constantTextureCount+this.argumentTextureCount+n),e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);const i=this.getInternalFormat();"single"===this.precision?e.texStorage2D(e.TEXTURE_2D,1,i,t[0],t[1]):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n+1,e.TEXTURE_2D,r,0),this.mappedTextures.push(new this.TextureConstructor({texture:r,size:t,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this}))}}_getHeaderString(){return""}_getTextureCoordinate(){const e=this.subKernels,t=this.getVariablePrecisionString(this.texSize,this.tactic);return null===e||e.length<1?`in ${t} vec2 vTexCoord;\n`:`out ${t} vec2 vTexCoord;\n`}_getMainArgumentsString(e){const t=[],n=this.argumentNames;for(let r=0;r<n.length;r++)t.push(this.kernelArguments[r].getSource(e[r]));return t.join("")}getKernelString(){const e=[this.getKernelResultDeclaration()],t=this.subKernels;if(null!==t)switch(e.push("layout(location = 0) out vec4 data0"),this.returnType){case"Number":case"Float":case"Integer":for(let n=0;n<t.length;n++){const r=t[n];e.push("Integer"===r.returnType?`int subKernelResult_${r.name} = 0`:`float subKernelResult_${r.name} = 0.0`,`layout(location = ${n+1}) out vec4 data${n+1}`)}break;case"Array(2)":for(let n=0;n<t.length;n++)e.push(`vec2 subKernelResult_${t[n].name}`,`layout(location = ${n+1}) out vec4 data${n+1}`);break;case"Array(3)":for(let n=0;n<t.length;n++)e.push(`vec3 subKernelResult_${t[n].name}`,`layout(location = ${n+1}) out vec4 data${n+1}`);break;case"Array(4)":for(let n=0;n<t.length;n++)e.push(`vec4 subKernelResult_${t[n].name}`,`layout(location = ${n+1}) out vec4 data${n+1}`)}else e.push("out vec4 data0");return a.linesToString(e)+this.translatedSource}getMainResultGraphical(){return a.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = actualColor"])}getMainResultPackedPixels(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return this.getMainResultKernelPackedPixels()+this.getMainResultSubKernelPackedPixels();default:throw new Error(`packed output only usable with Numbers, "${this.returnType}" specified`)}}getMainResultKernelPackedPixels(){return a.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  data0 = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(kernelResult)`])}getMainResultSubKernelPackedPixels(){const e=[];if(!this.subKernels)return"";for(let t=0;t<this.subKernels.length;t++)"Integer"===this.subKernels[t].returnType?e.push(`  data${t+1} = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(float(subKernelResult_${this.subKernels[t].name}))`):e.push(`  data${t+1} = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(subKernelResult_${this.subKernels[t].name})`);return a.linesToString(e)}getMainResultKernelMemoryOptimizedFloats(e,t){e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  data0.${t} = kernelResult`)}getMainResultSubKernelMemoryOptimizedFloats(e,t){if(!this.subKernels)return e;for(let n=0;n<this.subKernels.length;n++){const r=this.subKernels[n];"Integer"===r.returnType?e.push(`  data${n+1}.${t} = float(subKernelResult_${r.name})`):e.push(`  data${n+1}.${t} = subKernelResult_${r.name}`)}}getMainResultKernelNumberTexture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult"]}getMainResultSubKernelNumberTexture(){const e=[];if(!this.subKernels)return e;for(let t=0;t<this.subKernels.length;++t){const n=this.subKernels[t];"Integer"===n.returnType?e.push(`  data${t+1}[0] = float(subKernelResult_${n.name})`):e.push(`  data${t+1}[0] = subKernelResult_${n.name}`)}return e}getMainResultKernelArray2Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult[0]","  data0[1] = kernelResult[1]"]}getMainResultSubKernelArray2Texture(){const e=[];if(!this.subKernels)return e;for(let t=0;t<this.subKernels.length;++t){const n=this.subKernels[t];e.push(`  data${t+1}[0] = subKernelResult_${n.name}[0]`,`  data${t+1}[1] = subKernelResult_${n.name}[1]`)}return e}getMainResultKernelArray3Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult[0]","  data0[1] = kernelResult[1]","  data0[2] = kernelResult[2]"]}getMainResultSubKernelArray3Texture(){const e=[];if(!this.subKernels)return e;for(let t=0;t<this.subKernels.length;++t){const n=this.subKernels[t];e.push(`  data${t+1}[0] = subKernelResult_${n.name}[0]`,`  data${t+1}[1] = subKernelResult_${n.name}[1]`,`  data${t+1}[2] = subKernelResult_${n.name}[2]`)}return e}getMainResultKernelArray4Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = kernelResult"]}getMainResultSubKernelArray4Texture(){const e=[];if(!this.subKernels)return e;for(let t=0;t<this.subKernels.length;++t)e.push(`  data${t+1} = subKernelResult_${this.subKernels[t].name}`);return e}destroyExtensions(){this.extensions.EXT_color_buffer_float=null,this.extensions.OES_texture_float_linear=null}toJSON(){const e=super.toJSON();return e.functionNodes=s.fromKernel(this,i).toJSON(),e.settings.threadDim=this.threadDim,e}}}},{"../../utils":114,"../function-builder":9,"../web-gl/kernel":70,"./fragment-shader":72,"./function-node":73,"./kernel-value-maps":74,"./vertex-shader":106}],106:[function(e,t,n){t.exports={vertexShader:"#version 300 es\n__FLOAT_TACTIC_DECLARATION__;\n__INT_TACTIC_DECLARATION__;\n__SAMPLER_2D_TACTIC_DECLARATION__;\n\nin vec2 aPos;\nin vec2 aTexCoord;\n\nout vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}"}},{}],107:[function(e,t,n){const r=e("./index"),i=r.GPU;for(const e in r)r.hasOwnProperty(e)&&"GPU"!==e&&(i[e]=r[e]);function s(e){e.GPU||Object.defineProperty(e,"GPU",{get:()=>i})}"undefined"!=typeof window&&s(window),"undefined"!=typeof self&&s(self),t.exports=r},{"./index":109}],108:[function(e,t,n){const{gpuMock:r}=e("gpu-mock.js"),{utils:i}=e("./utils"),{Kernel:s}=e("./backend/kernel"),{CPUKernel:a}=e("./backend/cpu/kernel"),{HeadlessGLKernel:o}=e("./backend/headless-gl/kernel"),{WebGL2Kernel:u}=e("./backend/web-gl2/kernel"),{WebGLKernel:c}=e("./backend/web-gl/kernel"),{kernelRunShortcut:l}=e("./kernel-run-shortcut"),h=[o,u,c],p=["gpu","cpu"],d={headlessgl:o,webgl2:u,webgl:c};let f=!0;function m(e){if(!e)return{};const t=Object.assign({},e);return e.hasOwnProperty("floatOutput")&&(i.warnDeprecated("setting","floatOutput","precision"),t.precision=e.floatOutput?"single":"unsigned"),e.hasOwnProperty("outputToTexture")&&(i.warnDeprecated("setting","outputToTexture","pipeline"),t.pipeline=Boolean(e.outputToTexture)),e.hasOwnProperty("outputImmutable")&&(i.warnDeprecated("setting","outputImmutable","immutable"),t.immutable=Boolean(e.outputImmutable)),e.hasOwnProperty("floatTextures")&&(i.warnDeprecated("setting","floatTextures","optimizeFloatMemory"),t.optimizeFloatMemory=Boolean(e.floatTextures)),t}t.exports={GPU:class{static disableValidation(){f=!1}static enableValidation(){f=!0}static get isGPUSupported(){return h.some((e=>e.isSupported))}static get isKernelMapSupported(){return h.some((e=>e.isSupported&&e.features.kernelMap))}static get isOffscreenCanvasSupported(){return"undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas||"undefined"!=typeof importScripts}static get isWebGLSupported(){return c.isSupported}static get isWebGL2Supported(){return u.isSupported}static get isHeadlessGLSupported(){return o.isSupported}static get isCanvasSupported(){return"undefined"!=typeof HTMLCanvasElement}static get isGPUHTMLImageArraySupported(){return u.isSupported}static get isSinglePrecisionSupported(){return h.some((e=>e.isSupported&&e.features.isFloatRead&&e.features.isTextureFloat))}constructor(e){if(e=e||{},this.canvas=e.canvas||null,this.context=e.context||null,this.mode=e.mode,this.Kernel=null,this.kernels=[],this.functions=[],this.nativeFunctions=[],this.injectedNative=null,"dev"!==this.mode){if(this.chooseKernel(),e.functions)for(let t=0;t<e.functions.length;t++)this.addFunction(e.functions[t]);if(e.nativeFunctions)for(const t in e.nativeFunctions){if(!e.nativeFunctions.hasOwnProperty(t))continue;const n=e.nativeFunctions[t],{name:r,source:i}=n;this.addNativeFunction(r,i,n)}}}chooseKernel(){if(this.Kernel)return;let e=null;if(this.context){for(let t=0;t<h.length;t++){const n=h[t];if(n.isContextMatch(this.context)){if(!n.isSupported)throw new Error(`Kernel type ${n.name} not supported`);e=n;break}}if(null===e)throw new Error("unknown Context")}else if(this.mode){if(this.mode in d)f&&!d[this.mode].isSupported||(e=d[this.mode]);else if("gpu"===this.mode){for(let t=0;t<h.length;t++)if(h[t].isSupported){e=h[t];break}}else"cpu"===this.mode&&(e=a);if(!e)throw new Error(`A requested mode of "${this.mode}" and is not supported`)}else{for(let t=0;t<h.length;t++)if(h[t].isSupported){e=h[t];break}e||(e=a)}this.mode||(this.mode=e.mode),this.Kernel=e}createKernel(e,t){if(void 0===e)throw new Error("Missing source parameter");if("object"!=typeof e&&!i.isFunction(e)&&"string"!=typeof e)throw new Error("source parameter not a function");const n=this.kernels;if("dev"===this.mode){const i=r(e,m(t));return n.push(i),i}e="function"==typeof e?e.toString():e;const s={},o=m(t)||{};function u(t){console.warn("Falling back to CPU");const n=new a(e,{argumentTypes:p.argumentTypes,constantTypes:p.constantTypes,graphical:p.graphical,loopMaxIterations:p.loopMaxIterations,constants:p.constants,dynamicOutput:p.dynamicOutput,dynamicArgument:p.dynamicArguments,output:p.output,precision:p.precision,pipeline:p.pipeline,immutable:p.immutable,optimizeFloatMemory:p.optimizeFloatMemory,fixIntegerDivisionAccuracy:p.fixIntegerDivisionAccuracy,functions:p.functions,nativeFunctions:p.nativeFunctions,injectedNative:p.injectedNative,subKernels:p.subKernels,strictIntegers:p.strictIntegers,debug:p.debug});n.build.apply(n,t);const r=n.run.apply(n,t);return p.replaceKernel(n),r}t&&"object"==typeof t.argumentTypes&&(o.argumentTypes=Object.keys(t.argumentTypes).map((e=>t.argumentTypes[e])));const c=Object.assign({context:this.context,canvas:this.canvas,functions:this.functions,nativeFunctions:this.nativeFunctions,injectedNative:this.injectedNative,gpu:this,validate:f,onRequestFallback:u,onRequestSwitchKernel:function t(r,i,a){a.debug&&console.warn("Switching kernels");let o=null;if(a.signature&&!s[a.signature]&&(s[a.signature]=a),a.dynamicOutput)for(let e=r.length-1;e>=0;e--){const t=r[e];"outputPrecisionMismatch"===t.type&&(o=t.needed)}const c=a.constructor,l=c.getArgumentTypes(a,i),h=c.getSignature(a,l),d=s[h];if(d)return d.onActivate(a),d;const m=s[h]=new c(e,{argumentTypes:l,constantTypes:a.constantTypes,graphical:a.graphical,loopMaxIterations:a.loopMaxIterations,constants:a.constants,dynamicOutput:a.dynamicOutput,dynamicArgument:a.dynamicArguments,context:a.context,canvas:a.canvas,output:o||a.output,precision:a.precision,pipeline:a.pipeline,immutable:a.immutable,optimizeFloatMemory:a.optimizeFloatMemory,fixIntegerDivisionAccuracy:a.fixIntegerDivisionAccuracy,functions:a.functions,nativeFunctions:a.nativeFunctions,injectedNative:a.injectedNative,subKernels:a.subKernels,strictIntegers:a.strictIntegers,debug:a.debug,gpu:a.gpu,validate:f,returnType:a.returnType,tactic:a.tactic,onRequestFallback:u,onRequestSwitchKernel:t,texture:a.texture,mappedTextures:a.mappedTextures,drawBuffersMap:a.drawBuffersMap});return m.build.apply(m,i),p.replaceKernel(m),n.push(m),m}},o),h=new this.Kernel(e,c),p=l(h);return this.canvas||(this.canvas=h.canvas),this.context||(this.context=h.context),n.push(h),p}createKernelMap(){let e,t;const n=typeof arguments[arguments.length-2];if("function"===n||"string"===n?(e=arguments[arguments.length-2],t=arguments[arguments.length-1]):e=arguments[arguments.length-1],"dev"!==this.mode&&(!this.Kernel.isSupported||!this.Kernel.features.kernelMap)&&this.mode&&p.indexOf(this.mode)<0)throw new Error(`kernelMap not supported on ${this.Kernel.name}`);const r=m(t);if(t&&"object"==typeof t.argumentTypes&&(r.argumentTypes=Object.keys(t.argumentTypes).map((e=>t.argumentTypes[e]))),Array.isArray(arguments[0])){r.subKernels=[];const e=arguments[0];for(let t=0;t<e.length;t++){const n=e[t].toString(),s=i.getFunctionNameFromString(n);r.subKernels.push({name:s,source:n,property:t})}}else{r.subKernels=[];const e=arguments[0];for(let t in e){if(!e.hasOwnProperty(t))continue;const n=e[t].toString(),s=i.getFunctionNameFromString(n);r.subKernels.push({name:s||t,source:n,property:t})}}return this.createKernel(e,r)}combineKernels(){const e=arguments[arguments.length-1];if("cpu"===arguments[0].kernel.constructor.mode)return e;const t=arguments[0].canvas,n=arguments[0].context,r=arguments.length-1;for(let e=0;e<r;e++)arguments[e].setCanvas(t).setContext(n).setPipeline(!0);return function(){const t=e.apply(this,arguments);return t.toArray?t.toArray():t}}setFunctions(e){return this.functions=e,this}setNativeFunctions(e){return this.nativeFunctions=e,this}addFunction(e,t){return this.functions.push({source:e,settings:t}),this}addNativeFunction(e,t,n){if(this.kernels.length>0)throw new Error('Cannot call "addNativeFunction" after "createKernels" has been called.');return this.nativeFunctions.push(Object.assign({name:e,source:t},n)),this}injectNative(e){return this.injectedNative=e,this}destroy(){return new Promise(((e,t)=>{this.kernels||e(),setTimeout((()=>{try{for(let e=0;e<this.kernels.length;e++)this.kernels[e].destroy(!0);let e=this.kernels[0];e&&(e.kernel&&(e=e.kernel),e.constructor.destroyContext&&e.constructor.destroyContext(this.context))}catch(e){t(e)}e()}),0)}))}},kernelOrder:h,kernelTypes:p}},{"./backend/cpu/kernel":8,"./backend/headless-gl/kernel":34,"./backend/kernel":36,"./backend/web-gl/kernel":70,"./backend/web-gl2/kernel":105,"./kernel-run-shortcut":111,"./utils":114,"gpu-mock.js":4}],109:[function(e,t,n){const{GPU:r}=e("./gpu"),{alias:i}=e("./alias"),{utils:s}=e("./utils"),{Input:a,input:o}=e("./input"),{Texture:u}=e("./texture"),{FunctionBuilder:c}=e("./backend/function-builder"),{FunctionNode:l}=e("./backend/function-node"),{CPUFunctionNode:h}=e("./backend/cpu/function-node"),{CPUKernel:p}=e("./backend/cpu/kernel"),{HeadlessGLKernel:d}=e("./backend/headless-gl/kernel"),{WebGLFunctionNode:f}=e("./backend/web-gl/function-node"),{WebGLKernel:m}=e("./backend/web-gl/kernel"),{kernelValueMaps:g}=e("./backend/web-gl/kernel-value-maps"),{WebGL2FunctionNode:y}=e("./backend/web-gl2/function-node"),{WebGL2Kernel:v}=e("./backend/web-gl2/kernel"),{kernelValueMaps:b}=e("./backend/web-gl2/kernel-value-maps"),{GLKernel:x}=e("./backend/gl/kernel"),{Kernel:w}=e("./backend/kernel"),{FunctionTracer:S}=e("./backend/function-tracer"),T=e("./plugins/math-random-uniformly-distributed");t.exports={alias:i,CPUFunctionNode:h,CPUKernel:p,GPU:r,FunctionBuilder:c,FunctionNode:l,HeadlessGLKernel:d,Input:a,input:o,Texture:u,utils:s,WebGL2FunctionNode:y,WebGL2Kernel:v,webGL2KernelValueMaps:b,WebGLFunctionNode:f,WebGLKernel:m,webGLKernelValueMaps:g,GLKernel:x,Kernel:w,FunctionTracer:S,plugins:{mathRandom:T}}},{"./alias":5,"./backend/cpu/function-node":6,"./backend/cpu/kernel":8,"./backend/function-builder":9,"./backend/function-node":10,"./backend/function-tracer":11,"./backend/gl/kernel":13,"./backend/headless-gl/kernel":34,"./backend/kernel":36,"./backend/web-gl/function-node":38,"./backend/web-gl/kernel":70,"./backend/web-gl/kernel-value-maps":39,"./backend/web-gl2/function-node":73,"./backend/web-gl2/kernel":105,"./backend/web-gl2/kernel-value-maps":74,"./gpu":108,"./input":110,"./plugins/math-random-uniformly-distributed":112,"./texture":113,"./utils":114}],110:[function(e,t,n){class r{constructor(e,t){this.value=e,Array.isArray(t)?this.size=t:(this.size=new Int32Array(3),t.z?this.size=new Int32Array([t.x,t.y,t.z]):t.y?this.size=new Int32Array([t.x,t.y]):this.size=new Int32Array([t.x]));const[n,r,i]=this.size;if(i){if(this.value.length!==n*r*i)throw new Error(`Input size ${this.value.length} does not match ${n} * ${r} * ${i} = ${r*n*i}`)}else if(r){if(this.value.length!==n*r)throw new Error(`Input size ${this.value.length} does not match ${n} * ${r} = ${r*n}`)}else if(this.value.length!==n)throw new Error(`Input size ${this.value.length} does not match ${n}`)}toArray(){const{utils:t}=e("./utils"),[n,r,i]=this.size;return i?t.erectMemoryOptimized3DFloat(this.value.subarray?this.value:new Float32Array(this.value),n,r,i):r?t.erectMemoryOptimized2DFloat(this.value.subarray?this.value:new Float32Array(this.value),n,r):this.value}}t.exports={Input:r,input:function(e,t){return new r(e,t)}}},{"./utils":114}],111:[function(e,t,n){const{utils:r}=e("./utils");function i(e,t){if(t.kernel)return void(t.kernel=e);const n=r.allPropertiesOf(e);for(let r=0;r<n.length;r++){const i=n[r];"_"===i[0]&&"_"===i[1]||("function"==typeof e[i]?"add"===i.substring(0,3)||"set"===i.substring(0,3)?t[i]=function(){return t.kernel[i].apply(t.kernel,arguments),t}:t[i]=function(){return t.kernel[i].apply(t.kernel,arguments)}:(t.__defineGetter__(i,(()=>t.kernel[i])),t.__defineSetter__(i,(e=>{t.kernel[i]=e}))))}t.kernel=e}t.exports={kernelRunShortcut:function(e){let t=function(){return e.build.apply(e,arguments),t=function(){let t=e.run.apply(e,arguments);if(e.switchingKernels){const r=e.resetSwitchingKernels(),i=e.onRequestSwitchKernel(r,arguments,e);n.kernel=e=i,t=i.run.apply(i,arguments)}return e.renderKernels?e.renderKernels():e.renderOutput?e.renderOutput():t},t.apply(e,arguments)};const n=function(){return t.apply(e,arguments)};return n.exec=function(){return new Promise(((e,n)=>{try{e(t.apply(this,arguments))}catch(e){n(e)}}))},n.replaceKernel=function(t){i(e=t,n)},i(e,n),n}}},{"./utils":114}],112:[function(e,t,n){const r={name:"math-random-uniformly-distributed",onBeforeRun:e=>{e.setUniform1f("randomSeed1",Math.random()),e.setUniform1f("randomSeed2",Math.random())},functionMatch:"Math.random()",functionReplace:"nrand(vTexCoord)",functionReturnType:"Number",source:"// https://www.shadertoy.com/view/4t2SDh\n//note: uniformly distributed, normalized rand, [0,1]\nhighp float randomSeedShift = 1.0;\nhighp float slide = 1.0;\nuniform highp float randomSeed1;\nuniform highp float randomSeed2;\n\nhighp float nrand(highp vec2 n) {\n  highp float result = fract(sin(dot((n.xy + 1.0) * vec2(randomSeed1 * slide, randomSeed2 * randomSeedShift), vec2(12.9898, 78.233))) * 43758.5453);\n  randomSeedShift = result;\n  if (randomSeedShift > 0.5) {\n    slide += 0.00009; \n  } else {\n    slide += 0.0009;\n  }\n  return result;\n}"};t.exports=r},{}],113:[function(e,t,n){t.exports={Texture:class{constructor(e){const{texture:t,size:n,dimensions:r,output:i,context:s,type:a="NumberTexture",kernel:o,internalFormat:u,textureFormat:c}=e;if(!i)throw new Error('settings property "output" required.');if(!s)throw new Error('settings property "context" required.');if(!t)throw new Error('settings property "texture" required.');if(!o)throw new Error('settings property "kernel" required.');this.texture=t,t._refs?t._refs++:t._refs=1,this.size=n,this.dimensions=r,this.output=i,this.context=s,this.kernel=o,this.type=a,this._deleted=!1,this.internalFormat=u,this.textureFormat=c}toArray(){throw new Error(`Not implemented on ${this.constructor.name}`)}clone(){throw new Error(`Not implemented on ${this.constructor.name}`)}delete(){throw new Error(`Not implemented on ${this.constructor.name}`)}clear(){throw new Error(`Not implemented on ${this.constructor.name}`)}}}},{}],114:[function(e,t,n){const r=e("acorn"),{Input:i}=e("./input"),{Texture:s}=e("./texture"),a=/function ([^(]*)/,o=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,u=/([^\s,]+)/g,c={systemEndianness:()=>d,getSystemEndianness(){const e=new ArrayBuffer(4),t=new Uint32Array(e),n=new Uint8Array(e);if(t[0]=3735928559,239===n[0])return"LE";if(222===n[0])return"BE";throw new Error("unknown endianness")},isFunction:e=>"function"==typeof e,isFunctionString:e=>"string"==typeof e&&"function"===e.slice(0,"function".length).toLowerCase(),getFunctionNameFromString(e){const t=a.exec(e);return t&&0!==t.length?t[1].trim():null},getFunctionBodyFromString:e=>e.substring(e.indexOf("{")+1,e.lastIndexOf("}")),getArgumentNamesFromString(e){const t=e.replace(o,"");let n=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(u);return null===n&&(n=[]),n},clone(e){if(null===e||"object"!=typeof e||e.hasOwnProperty("isActiveClone"))return e;const t=e.constructor();for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e.isActiveClone=null,t[n]=c.clone(e[n]),delete e.isActiveClone);return t},isArray:e=>!isNaN(e.length),getVariableType(e,t){if(c.isArray(e))return e.length>0&&"IMG"===e[0].nodeName?"HTMLImageArray":"Array";switch(e.constructor){case Boolean:return"Boolean";case Number:return t&&Number.isInteger(e)?"Integer":"Float";case s:return e.type;case i:return"Input"}switch(e.nodeName){case"IMG":case"CANVAS":return"HTMLImage";case"VIDEO":return"HTMLVideo"}return e.hasOwnProperty("type")?e.type:"Unknown"},getKernelTextureSize(e,t){let[n,r,i]=t,s=(n||1)*(r||1)*(i||1);return e.optimizeFloatMemory&&"single"===e.precision&&(n=s=Math.ceil(s/4)),r>1&&n*r===s?new Int32Array([n,r]):c.closestSquareDimensions(s)},closestSquareDimensions(e){const t=Math.sqrt(e);let n=Math.ceil(t),r=Math.floor(t);for(;n*r<e;)n--,r=Math.ceil(e/n);return new Int32Array([r,Math.ceil(e/r)])},getMemoryOptimizedFloatTextureSize(e,t){const n=c.roundTo((e[0]||1)*(e[1]||1)*(e[2]||1)*(e[3]||1),4)/t;return c.closestSquareDimensions(n)},getMemoryOptimizedPackedTextureSize(e,t){const[n,r,i]=e,s=c.roundTo((n||1)*(r||1)*(i||1),4)/(4/t);return c.closestSquareDimensions(s)},roundTo:(e,t)=>Math.floor((e+t-1)/t)*t,getDimensions(e,t){let n;if(c.isArray(e)){const t=[];let r=e;for(;c.isArray(r);)t.push(r.length),r=r[0];n=t.reverse()}else if(e instanceof s)n=e.output;else{if(!(e instanceof i))throw new Error(`Unknown dimensions of ${e}`);n=e.size}if(t)for(n=Array.from(n);n.length<3;)n.push(1);return new Int32Array(n)},flatten2dArrayTo(e,t){let n=0;for(let r=0;r<e.length;r++)t.set(e[r],n),n+=e[r].length},flatten3dArrayTo(e,t){let n=0;for(let r=0;r<e.length;r++)for(let i=0;i<e[r].length;i++)t.set(e[r][i],n),n+=e[r][i].length},flatten4dArrayTo(e,t){let n=0;for(let r=0;r<e.length;r++)for(let i=0;i<e[r].length;i++)for(let s=0;s<e[r][i].length;s++)t.set(e[r][i][s],n),n+=e[r][i][s].length},flattenTo(e,t){c.isArray(e[0])?c.isArray(e[0][0])?c.isArray(e[0][0][0])?c.flatten4dArrayTo(e,t):c.flatten3dArrayTo(e,t):c.flatten2dArrayTo(e,t):t.set(e)},splitArray(e,t){const n=[];for(let r=0;r<e.length;r+=t)n.push(new e.constructor(e.buffer,4*r+e.byteOffset,t));return n},getAstString(e,t){const n=Array.isArray(e)?e:e.split(/\r?\n/g),r=t.loc.start,i=t.loc.end,s=[];if(r.line===i.line)s.push(n[r.line-1].substring(r.column,i.column));else{s.push(n[r.line-1].slice(r.column));for(let e=r.line;e<i.line;e++)s.push(n[e]);s.push(n[i.line-1].slice(0,i.column))}return s.join("\n")},allPropertiesOf(e){const t=[];do{t.push.apply(t,Object.getOwnPropertyNames(e))}while(e=Object.getPrototypeOf(e));return t},linesToString:e=>e.length>0?e.join(";\n")+";\n":"\n",warnDeprecated(e,t,n){n?console.warn(`You are using a deprecated ${e} "${t}". It has been replaced with "${n}". Fixing, but please upgrade as it will soon be removed.`):console.warn(`You are using a deprecated ${e} "${t}". It has been removed. Fixing, but please upgrade as it will soon be removed.`)},flipPixels:(e,t,n)=>{const r=n/2|0,i=4*t,s=new Uint8ClampedArray(4*t),a=e.slice(0);for(let e=0;e<r;++e){const t=e*i,r=(n-e-1)*i;s.set(a.subarray(t,t+i)),a.copyWithin(t,r,r+i),a.set(s,r)}return a},erectPackedFloat:(e,t)=>e.subarray(0,t),erect2DPackedFloat:(e,t,n)=>{const r=new Array(n);for(let i=0;i<n;i++){const n=i*t,s=n+t;r[i]=e.subarray(n,s)}return r},erect3DPackedFloat:(e,t,n,r)=>{const i=new Array(r);for(let s=0;s<r;s++){const r=new Array(n);for(let i=0;i<n;i++){const a=s*n*t+i*t,o=a+t;r[i]=e.subarray(a,o)}i[s]=r}return i},erectMemoryOptimizedFloat:(e,t)=>e.subarray(0,t),erectMemoryOptimized2DFloat:(e,t,n)=>{const r=new Array(n);for(let i=0;i<n;i++){const n=i*t;r[i]=e.subarray(n,n+t)}return r},erectMemoryOptimized3DFloat:(e,t,n,r)=>{const i=new Array(r);for(let s=0;s<r;s++){const r=new Array(n);for(let i=0;i<n;i++){const a=s*n*t+i*t;r[i]=e.subarray(a,a+t)}i[s]=r}return i},erectFloat:(e,t)=>{const n=new Float32Array(t);let r=0;for(let i=0;i<t;i++)n[i]=e[r],r+=4;return n},erect2DFloat:(e,t,n)=>{const r=new Array(n);let i=0;for(let s=0;s<n;s++){const n=new Float32Array(t);for(let r=0;r<t;r++)n[r]=e[i],i+=4;r[s]=n}return r},erect3DFloat:(e,t,n,r)=>{const i=new Array(r);let s=0;for(let a=0;a<r;a++){const r=new Array(n);for(let i=0;i<n;i++){const n=new Float32Array(t);for(let r=0;r<t;r++)n[r]=e[s],s+=4;r[i]=n}i[a]=r}return i},erectArray2:(e,t)=>{const n=new Array(t),r=4*t;let i=0;for(let t=0;t<r;t+=4)n[i++]=e.subarray(t,t+2);return n},erect2DArray2:(e,t,n)=>{const r=new Array(n),i=4*t;for(let s=0;s<n;s++){const n=new Array(t),a=s*i;let o=0;for(let t=0;t<i;t+=4)n[o++]=e.subarray(t+a,t+a+2);r[s]=n}return r},erect3DArray2:(e,t,n,r)=>{const i=4*t,s=new Array(r);for(let a=0;a<r;a++){const r=new Array(n);for(let s=0;s<n;s++){const o=new Array(t),u=a*i*n+s*i;let c=0;for(let t=0;t<i;t+=4)o[c++]=e.subarray(t+u,t+u+2);r[s]=o}s[a]=r}return s},erectArray3:(e,t)=>{const n=new Array(t),r=4*t;let i=0;for(let t=0;t<r;t+=4)n[i++]=e.subarray(t,t+3);return n},erect2DArray3:(e,t,n)=>{const r=4*t,i=new Array(n);for(let s=0;s<n;s++){const n=new Array(t),a=s*r;let o=0;for(let t=0;t<r;t+=4)n[o++]=e.subarray(t+a,t+a+3);i[s]=n}return i},erect3DArray3:(e,t,n,r)=>{const i=4*t,s=new Array(r);for(let a=0;a<r;a++){const r=new Array(n);for(let s=0;s<n;s++){const o=new Array(t),u=a*i*n+s*i;let c=0;for(let t=0;t<i;t+=4)o[c++]=e.subarray(t+u,t+u+3);r[s]=o}s[a]=r}return s},erectArray4:(e,t)=>{const n=new Array(e),r=4*t;let i=0;for(let t=0;t<r;t+=4)n[i++]=e.subarray(t,t+4);return n},erect2DArray4:(e,t,n)=>{const r=4*t,i=new Array(n);for(let s=0;s<n;s++){const n=new Array(t),a=s*r;let o=0;for(let t=0;t<r;t+=4)n[o++]=e.subarray(t+a,t+a+4);i[s]=n}return i},erect3DArray4:(e,t,n,r)=>{const i=4*t,s=new Array(r);for(let a=0;a<r;a++){const r=new Array(n);for(let s=0;s<n;s++){const o=new Array(t),u=a*i*n+s*i;let c=0;for(let t=0;t<i;t+=4)o[c++]=e.subarray(t+u,t+u+4);r[s]=o}s[a]=r}return s},flattenFunctionToString:(e,t)=>{const{findDependency:n,thisLookup:i,doNotDefine:s}=t;let a=t.flattened;a||(a=t.flattened={});const o=r.parse(e),u=[];let l=0;const h=function e(t){if(Array.isArray(t)){const n=[];for(let r=0;r<t.length;r++)n.push(e(t[r]));return n.join("")}switch(t.type){case"Program":return e(t.body)+("VariableDeclaration"===t.body[0].type?";":"");case"FunctionDeclaration":return`function ${t.id.name}(${t.params.map(e).join(", ")}) ${e(t.body)}`;case"BlockStatement":{const n=[];l+=2;for(let r=0;r<t.body.length;r++){const i=e(t.body[r]);i&&n.push(" ".repeat(l)+i,";\n")}return l-=2,`{\n${n.join("")}}`}case"VariableDeclaration":const r=c.normalizeDeclarations(t).map(e).filter((e=>null!==e));return r.length<1?"":`${t.kind} ${r.join(",")}`;case"VariableDeclarator":return t.init.object&&"ThisExpression"===t.init.object.type?i(t.init.property.name,!0)?`${t.id.name} = ${e(t.init)}`:null:`${t.id.name} = ${e(t.init)}`;case"CallExpression":if("subarray"===t.callee.property.name)return`${e(t.callee.object)}.${e(t.callee.property)}(${t.arguments.map((t=>e(t))).join(", ")})`;if("gl"===t.callee.object.name||"context"===t.callee.object.name)return`${e(t.callee.object)}.${e(t.callee.property)}(${t.arguments.map((t=>e(t))).join(", ")})`;if("ThisExpression"===t.callee.object.type)return u.push(n("this",t.callee.property.name)),`${t.callee.property.name}(${t.arguments.map((t=>e(t))).join(", ")})`;if(t.callee.object.name){const r=n(t.callee.object.name,t.callee.property.name);return null===r?`${t.callee.object.name}.${t.callee.property.name}(${t.arguments.map((t=>e(t))).join(", ")})`:(u.push(r),`${t.callee.property.name}(${t.arguments.map((t=>e(t))).join(", ")})`)}if("MemberExpression"===t.callee.object.type)return`${e(t.callee.object)}.${t.callee.property.name}(${t.arguments.map((t=>e(t))).join(", ")})`;throw new Error("unknown ast.callee");case"ReturnStatement":return`return ${e(t.argument)}`;case"BinaryExpression":return`(${e(t.left)}${t.operator}${e(t.right)})`;case"UnaryExpression":return t.prefix?`${t.operator} ${e(t.argument)}`:`${e(t.argument)} ${t.operator}`;case"ExpressionStatement":return`${e(t.expression)}`;case"SequenceExpression":return`(${e(t.expressions)})`;case"ArrowFunctionExpression":return`(${t.params.map(e).join(", ")}) => ${e(t.body)}`;case"Literal":return t.raw;case"Identifier":return t.name;case"MemberExpression":return"ThisExpression"===t.object.type?i(t.property.name):t.computed?`${e(t.object)}[${e(t.property)}]`:e(t.object)+"."+e(t.property);case"ThisExpression":return"this";case"NewExpression":return`new ${e(t.callee)}(${t.arguments.map((t=>e(t))).join(", ")})`;case"ForStatement":return`for (${e(t.init)};${e(t.test)};${e(t.update)}) ${e(t.body)}`;case"AssignmentExpression":return`${e(t.left)}${t.operator}${e(t.right)}`;case"UpdateExpression":return`${e(t.argument)}${t.operator}`;case"IfStatement":return`if (${e(t.test)}) ${e(t.consequent)}`;case"ThrowStatement":return`throw ${e(t.argument)}`;case"ObjectPattern":return t.properties.map(e).join(", ");case"ArrayPattern":return t.elements.map(e).join(", ");case"DebuggerStatement":return"debugger;";case"ConditionalExpression":return`${e(t.test)}?${e(t.consequent)}:${e(t.alternate)}`;case"Property":if("init"===t.kind)return e(t.key)}throw new Error(`unhandled ast.type of ${t.type}`)}(o);if(u.length>0){const e=[];for(let n=0;n<u.length;n++){const r=u[n];a[r]||(a[r]=!0),r&&e.push(c.flattenFunctionToString(r,t)+"\n")}return e.join("")+h}return h},normalizeDeclarations:e=>{if("VariableDeclaration"!==e.type)throw new Error('Ast is not of type "VariableDeclaration"');const t=[];for(let n=0;n<e.declarations.length;n++){const r=e.declarations[n];if(r.id&&"ObjectPattern"===r.id.type&&r.id.properties){const{properties:e}=r.id;for(let n=0;n<e.length;n++){const i=e[n];if("ObjectPattern"===i.value.type&&i.value.properties)for(let e=0;e<i.value.properties.length;e++){const n=i.value.properties[e];if("Property"!==n.type)throw new Error("unexpected state");t.push({type:"VariableDeclarator",id:{type:"Identifier",name:n.key.name},init:{type:"MemberExpression",object:{type:"MemberExpression",object:r.init,property:{type:"Identifier",name:i.key.name},computed:!1},property:{type:"Identifier",name:n.key.name},computed:!1}})}else{if("Identifier"!==i.value.type)throw new Error("unexpected state");t.push({type:"VariableDeclarator",id:{type:"Identifier",name:i.value&&i.value.name?i.value.name:i.key.name},init:{type:"MemberExpression",object:r.init,property:{type:"Identifier",name:i.key.name},computed:!1}})}}}else if(r.id&&"ArrayPattern"===r.id.type&&r.id.elements){const{elements:e}=r.id;for(let n=0;n<e.length;n++){const i=e[n];if("Identifier"!==i.type)throw new Error("unexpected state");t.push({type:"VariableDeclarator",id:{type:"Identifier",name:i.name},init:{type:"MemberExpression",object:r.init,property:{type:"Literal",value:n,raw:n.toString(),start:i.start,end:i.end},computed:!0}})}}else t.push(r)}return t},splitHTMLImageToRGB:(e,t)=>{const n=e.createKernel((function(e){return 255*e[this.thread.y][this.thread.x].r}),{output:[t.width,t.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),r=e.createKernel((function(e){return 255*e[this.thread.y][this.thread.x].g}),{output:[t.width,t.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),i=e.createKernel((function(e){return 255*e[this.thread.y][this.thread.x].b}),{output:[t.width,t.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),s=e.createKernel((function(e){return 255*e[this.thread.y][this.thread.x].a}),{output:[t.width,t.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),a=[n(t),r(t),i(t),s(t)];return a.rKernel=n,a.gKernel=r,a.bKernel=i,a.aKernel=s,a.gpu=e,a},splitRGBAToCanvases:(e,t,n,r)=>{const i=e.createKernel((function(e){const t=e[this.thread.y][this.thread.x];this.color(t.r/255,0,0,255)}),{output:[n,r],graphical:!0,argumentTypes:{v:"Array2D(4)"}});i(t);const s=e.createKernel((function(e){const t=e[this.thread.y][this.thread.x];this.color(0,t.g/255,0,255)}),{output:[n,r],graphical:!0,argumentTypes:{v:"Array2D(4)"}});s(t);const a=e.createKernel((function(e){const t=e[this.thread.y][this.thread.x];this.color(0,0,t.b/255,255)}),{output:[n,r],graphical:!0,argumentTypes:{v:"Array2D(4)"}});a(t);const o=e.createKernel((function(e){const t=e[this.thread.y][this.thread.x];this.color(255,255,255,t.a/255)}),{output:[n,r],graphical:!0,argumentTypes:{v:"Array2D(4)"}});return o(t),[i.canvas,s.canvas,a.canvas,o.canvas]},getMinifySafeName:e=>{try{const t=r.parse(`const value = ${e.toString()}`),{init:n}=t.body[0].declarations[0];return n.body.name||n.body.body[0].argument.name}catch(e){throw new Error("Unrecognized function type.  Please use `() => yourFunctionVariableHere` or function() { return yourFunctionVariableHere; }")}},sanitizeName:function(e){return l.test(e)&&(e=e.replace(l,"S_S")),h.test(e)?e=e.replace(h,"U_U"):p.test(e)&&(e=e.replace(p,"u_u")),e}},l=/\$/,h=/__/,p=/_/,d=c.getSystemEndianness();t.exports={utils:c}},{"./input":110,"./texture":113,acorn:1}]},{},[107])(107)},4139:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1717);function i(e){for(var t=[],n=0;n<e.length;n++)n%3==0?t.push(e[n]<<4|e[n+1]>>4):(t.push((15&e[n])<<8|e[n+1]),n++);return t}function s(e,t){function n(n){return{x:t*e.getInt16(n),y:t*e.getInt16(n+2),z:t*e.getInt16(n+4)}}return{sequenceId:e.getUint16(0),samples:[n(2),n(8),n(14)]}}t.parseControl=function(e){return e.pipe(r.concatMap((function(e){return e.split("")})),r.scan((function(e,t){return e.indexOf("}")>=0?t:e+t}),""),r.filter((function(e){return e.indexOf("}")>=0})),r.map((function(e){return JSON.parse(e)})))},t.decodeUnsigned12BitData=i,t.decodeEEGSamples=function(e){return i(e).map((function(e){return.48828125*(e-2048)}))},t.parseTelemetry=function(e){return{sequenceId:e.getUint16(0),batteryLevel:e.getUint16(2)/512,fuelGaugeVoltage:2.2*e.getUint16(4),temperature:e.getUint16(8)}},t.parseAccelerometer=function(e){return s(e,610352e-10)},t.parseGyroscope=function(e){return s(e,.0074768)}},7338:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{u(r.next(e))}catch(e){s(e)}}function o(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,o)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(4143),a=n(1717);t.decodeResponse=function(e){return(new TextDecoder).decode(e.subarray(1,1+e[0]))},t.encodeCommand=function(e){var t=(new TextEncoder).encode("X"+e+"\n");return t[0]=t.length-1,t},t.observableCharacteristic=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,e.startNotifications()];case 1:return n.sent(),t=s.fromEvent(e.service.device,"gattserverdisconnected"),[2,s.fromEvent(e,"characteristicvaluechanged").pipe(a.takeUntil(t),a.map((function(e){return e.target.value})))]}}))}))}},1335:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4143),i=n(1717),s=n(2306);t.zipSamples=function(e){var t=[],n=null;return e.pipe(i.mergeMap((function(e){if(e.timestamp!==n&&(n=e.timestamp,t.length)){var i=r.from([t.slice()]);return t.splice(0,t.length,e),i}return t.push(e),r.from([])})),i.concat(r.from([t])),i.mergeMap((function(e){var t=e[0].samples.map((function(t,n){for(var r=[NaN,NaN,NaN,NaN,NaN],i=0,a=e;i<a.length;i++){var o=a[i];r[o.electrode]=o.samples[n]}return{data:r,index:e[0].index,timestamp:e[0].timestamp+1e3*n/s.EEG_FREQUENCY}}));return r.from(t)})))}},2306:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{u(r.next(e))}catch(e){s(e)}}function o(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,o)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(4143),a=n(1717),o=n(4139),u=n(7338),c=n(1335);t.zipSamples=c.zipSamples,t.MUSE_SERVICE=65165;var l=["273e0003-4c4d-454d-96be-f03bac821358","273e0004-4c4d-454d-96be-f03bac821358","273e0005-4c4d-454d-96be-f03bac821358","273e0006-4c4d-454d-96be-f03bac821358","273e0007-4c4d-454d-96be-f03bac821358"];t.EEG_FREQUENCY=256,t.channelNames=["TP9","AF7","AF8","TP10","AUX"];var h=function(){function e(){this.enableAux=!1,this.deviceName="",this.connectionStatus=new s.BehaviorSubject(!1),this.gatt=null,this.lastIndex=null,this.lastTimestamp=null}return e.prototype.connect=function(e){return r(this,void 0,void 0,(function(){var n,r,c,h,p,d,f,m,g,y,v,b,x,w,S,T,C=this;return i(this,(function(A){switch(A.label){case 0:return e?(this.gatt=e,[3,4]):[3,1];case 1:return[4,navigator.bluetooth.requestDevice({filters:[{services:[t.MUSE_SERVICE]}]})];case 2:return n=A.sent(),r=this,[4,n.gatt.connect()];case 3:r.gatt=A.sent(),A.label=4;case 4:return this.deviceName=this.gatt.device.name||null,[4,this.gatt.getPrimaryService(t.MUSE_SERVICE)];case 5:return c=A.sent(),s.fromEvent(this.gatt.device,"gattserverdisconnected").pipe(a.first()).subscribe((function(){C.gatt=null,C.connectionStatus.next(!1)})),h=this,[4,c.getCharacteristic("273e0001-4c4d-454d-96be-f03bac821358")];case 6:return h.controlChar=A.sent(),p=this,[4,u.observableCharacteristic(this.controlChar)];case 7:return p.rawControlData=A.sent().pipe(a.map((function(e){return u.decodeResponse(new Uint8Array(e.buffer))})),a.share()),this.controlResponses=o.parseControl(this.rawControlData),[4,c.getCharacteristic("273e000b-4c4d-454d-96be-f03bac821358")];case 8:return d=A.sent(),f=this,[4,u.observableCharacteristic(d)];case 9:return f.telemetryData=A.sent().pipe(a.map(o.parseTelemetry)),[4,c.getCharacteristic("273e0009-4c4d-454d-96be-f03bac821358")];case 10:return m=A.sent(),g=this,[4,u.observableCharacteristic(m)];case 11:return g.gyroscopeData=A.sent().pipe(a.map(o.parseGyroscope)),[4,c.getCharacteristic("273e000a-4c4d-454d-96be-f03bac821358")];case 12:return y=A.sent(),v=this,[4,u.observableCharacteristic(y)];case 13:v.accelerometerData=A.sent().pipe(a.map(o.parseAccelerometer)),this.eventMarkers=new s.Subject,this.eegCharacteristics=[],b=[],x=this.enableAux?l.length:4,w=function(e){var t,n,r,s;return i(this,(function(i){switch(i.label){case 0:return t=l[e],[4,c.getCharacteristic(t)];case 1:return n=i.sent(),s=(r=b).push,[4,u.observableCharacteristic(n)];case 2:return s.apply(r,[i.sent().pipe(a.map((function(t){var n=t.getUint16(0);return{electrode:e,index:n,samples:o.decodeEEGSamples(new Uint8Array(t.buffer).subarray(2)),timestamp:C.getTimestamp(n)}})))]),S.eegCharacteristics.push(n),[2]}}))},S=this,T=0,A.label=14;case 14:return T<x?[5,w(T)]:[3,17];case 15:A.sent(),A.label=16;case 16:return T++,[3,14];case 17:return this.eegReadings=s.merge.apply(void 0,b),this.connectionStatus.next(!0),[2]}}))}))},e.prototype.sendCommand=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.controlChar.writeValue(u.encodeCommand(e))];case 1:return t.sent(),[2]}}))}))},e.prototype.start=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,this.pause()];case 1:return t.sent(),e=this.enableAux?"p20":"p21",[4,this.controlChar.writeValue(u.encodeCommand(e))];case 2:return t.sent(),[4,this.controlChar.writeValue(u.encodeCommand("s"))];case 3:return t.sent(),[4,this.resume()];case 4:return t.sent(),[2]}}))}))},e.prototype.pause=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.sendCommand("h")];case 1:return e.sent(),[2]}}))}))},e.prototype.resume=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.sendCommand("d")];case 1:return e.sent(),[2]}}))}))},e.prototype.deviceInfo=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return e=this.controlResponses.pipe(a.filter((function(e){return!!e.fw})),a.take(1)).toPromise(),[4,this.sendCommand("v1")];case 1:return t.sent(),[2,e]}}))}))},e.prototype.injectMarker=function(e,t){return void 0===t&&(t=(new Date).getTime()),r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.eventMarkers.next({value:e,timestamp:t})];case 1:return n.sent(),[2]}}))}))},e.prototype.disconnect=function(){this.gatt&&(this.lastIndex=null,this.lastTimestamp=null,this.gatt.disconnect(),this.connectionStatus.next(!1))},e.prototype.getTimestamp=function(e){var n=1/t.EEG_FREQUENCY*1e3*12;for(null!==this.lastIndex&&null!==this.lastTimestamp||(this.lastIndex=e,this.lastTimestamp=(new Date).getTime()-n);this.lastIndex-e>4096;)e+=65536;return e===this.lastIndex?this.lastTimestamp:e>this.lastIndex?(this.lastTimestamp+=n*(e-this.lastIndex),this.lastIndex=e,this.lastTimestamp):this.lastTimestamp-n*(this.lastIndex-e)},e}();t.MuseClient=h},4155:e=>{var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var o,u=[],c=!1,l=-1;function h(){c&&o&&(c=!1,o.length?u=o.concat(u):l=-1,u.length&&p())}function p(){if(!c){var e=a(h);c=!0;for(var t=u.length;t;){for(o=u,u=[];++l<t;)o&&o[l].run();l=-1,t=u.length}o=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new d(e,t)),1!==u.length||c||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},5666:e=>{var t=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,s=Object.create(i.prototype),a=new I(r||[]);return s._invoke=function(e,t,n){var r=h;return function(i,s){if(r===d)throw new Error("Generator is already running");if(r===f){if("throw"===i)throw s;return O()}for(n.method=i,n.arg=s;;){var a=n.delegate;if(a){var o=A(a,n);if(o){if(o===m)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var u=l(e,t,n);if("normal"===u.type){if(r=n.done?f:p,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=f,n.method="throw",n.arg=u.arg)}}}(e,n,a),s}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h="suspendedStart",p="suspendedYield",d="executing",f="completed",m={};function g(){}function y(){}function v(){}var b={};b[s]=function(){return this};var x=Object.getPrototypeOf,w=x&&x(x(E([])));w&&w!==n&&r.call(w,s)&&(b=w);var S=v.prototype=g.prototype=Object.create(b);function T(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(i,s,a,o){var u=l(e[i],e,s);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,o)}),(function(e){n("throw",e,a,o)})):t.resolve(h).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,o)}))}o(u.arg)}var i;this._invoke=function(e,r){function s(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(s,s):s()}}function A(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var s=i.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function E(e){if(e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:O}}function O(){return{value:t,done:!0}}return y.prototype=S.constructor=v,v.constructor=y,y.displayName=u(v,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,o,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},T(C.prototype),C.prototype[a]=function(){return this},e.AsyncIterator=C,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var a=new C(c(t,n,r,i),s);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},T(S),u(S,o,"Generator"),S[s]=function(){return this},S.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return o.type="throw",o.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:E(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}},7576:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4143);t.BehaviorSubject=r.BehaviorSubject},5345:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4143);t.Subject=r.Subject},969:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4143);t.fromEvent=r.fromEvent},5624:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1717);t.filter=r.filter},6097:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1717);t.first=r.first},1709:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1717);t.map=r.map},3895:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1717);t.mergeMap=r.mergeMap},6740:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1717);t.takeUntil=r.takeUntil},698:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1717);t.tap=r.tap},9122:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(7576))},8314:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(5345))},4143:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ArgumentOutOfRangeError:()=>O.W,AsyncSubject:()=>l.c,BehaviorSubject:()=>u.X,ConnectableObservable:()=>i.c,EMPTY:()=>X.E,EmptyError:()=>D.K,GroupedObservable:()=>s.T,NEVER:()=>he,Notification:()=>A.P,NotificationKind:()=>A.W,ObjectUnsubscribedError:()=>B.N,Observable:()=>r.y,ReplaySubject:()=>c.t,Scheduler:()=>S.b,Subject:()=>o.xQ,Subscriber:()=>C.L,Subscription:()=>T.w,TimeoutError:()=>F.W,UnsubscriptionError:()=>P.B,VirtualAction:()=>w,VirtualTimeScheduler:()=>x,animationFrame:()=>b,animationFrameScheduler:()=>v,asap:()=>h.e,asapScheduler:()=>h.E,async:()=>p.P,asyncScheduler:()=>p.z,bindCallback:()=>z,bindNodeCallback:()=>G,combineLatest:()=>W.aj,concat:()=>H.z,config:()=>Ee.v,defer:()=>q.P,empty:()=>X.c,forkJoin:()=>Q,from:()=>Y.D,fromEvent:()=>te,fromEventPattern:()=>re,generate:()=>ie,identity:()=>I.y,iif:()=>ae,interval:()=>ue,isObservable:()=>E,merge:()=>le.T,never:()=>pe,noop:()=>k.Z,observable:()=>a.L,of:()=>de.of,onErrorResumeNext:()=>fe,pairs:()=>me,partition:()=>xe,pipe:()=>_.z,queue:()=>d.c,queueScheduler:()=>d.N,race:()=>we.S3,range:()=>Se,scheduled:()=>Ie.x,throwError:()=>Ce._,timer:()=>Ae.H,using:()=>_e,zip:()=>ke.$R});var r=n(2772),i=n(3140),s=n(1120),a=n(5050),o=n(211),u=n(9233),c=n(2630),l=n(364),h=n(6650),p=n(964),d=n(2546),f=n(5987),m=n(6114),g=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return f.ZT(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame((function(){return t.flush(null)}))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(m.o),y=n(8399),v=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return f.ZT(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(y.v))(g),b=v,x=function(e){function t(t,n){void 0===t&&(t=w),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return f.ZT(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(y.v),w=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return f.ZT(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var i=e.actions;return i.push(this),i.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){void 0===n&&(n=0)},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(m.o),S=n(8725),T=n(8760),C=n(979),A=n(2632),_=n(2561),k=n(3306),I=n(3608);function E(e){return!!e&&(e instanceof r.y||"function"==typeof e.lift&&"function"==typeof e.subscribe)}var O=n(6565),D=n(6929),B=n(1016),P=n(8782),F=n(1462),N=n(5709),R=n(3642),L=n(9026),M=n(7507);function z(e,t,n){if(t){if(!(0,M.K)(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return z(e,n).apply(void 0,r).pipe((0,N.U)((function(e){return(0,L.k)(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var s,a=this,o={context:a,subject:s,callbackFunc:e,scheduler:n};return new r.y((function(r){if(n){var i={args:t,subscriber:r,params:o};return n.schedule($,0,i)}if(!s){s=new l.c;try{e.apply(a,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.next(e.length<=1?e[0]:e),s.complete()}]))}catch(e){(0,R._)(s)?s.error(e):console.warn(e)}}return s.subscribe(r)}))}}function $(e){var t=this,n=e.args,r=e.subscriber,i=e.params,s=i.callbackFunc,a=i.context,o=i.scheduler,u=i.subject;if(!u){u=i.subject=new l.c;try{s.apply(a,n.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.length<=1?e[0]:e;t.add(o.schedule(V,0,{value:r,subject:u}))}]))}catch(e){u.error(e)}}this.add(u.subscribe(r))}function V(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function G(e,t,n){if(t){if(!(0,M.K)(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return G(e,n).apply(void 0,r).pipe((0,N.U)((function(e){return(0,L.k)(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var s={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new r.y((function(r){var i=s.context,a=s.subject;if(n)return n.schedule(U,0,{params:s,subscriber:r,context:i});if(!a){a=s.subject=new l.c;try{e.apply(i,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.shift();n?a.error(n):(a.next(e.length<=1?e[0]:e),a.complete())}]))}catch(e){(0,R._)(a)?a.error(e):console.warn(e)}}return a.subscribe(r)}))}}function U(e){var t=this,n=e.params,r=e.subscriber,i=e.context,s=n.callbackFunc,a=n.args,o=n.scheduler,u=n.subject;if(!u){u=n.subject=new l.c;try{s.apply(i,a.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.shift();if(r)t.add(o.schedule(j,0,{err:r,subject:u}));else{var i=e.length<=1?e[0]:e;t.add(o.schedule(K,0,{value:i,subject:u}))}}]))}catch(e){this.add(o.schedule(j,0,{err:e,subject:u}))}}this.add(u.subscribe(r))}function K(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function j(e){var t=e.err;e.subject.error(t)}var W=n(5142),H=n(9795),q=n(1410),X=n(5631),Z=n(2009),Y=n(5760);function Q(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if((0,L.k)(n))return J(n,null);if((0,Z.K)(n)&&Object.getPrototypeOf(n)===Object.prototype){var r=Object.keys(n);return J(r.map((function(e){return n[e]})),r)}}if("function"==typeof e[e.length-1]){var i=e.pop();return J(e=1===e.length&&(0,L.k)(e[0])?e[0]:e,null).pipe((0,N.U)((function(e){return i.apply(void 0,e)})))}return J(e,null)}function J(e,t){return new r.y((function(n){var r=e.length;if(0!==r)for(var i=new Array(r),s=0,a=0,o=function(o){var u=(0,Y.D)(e[o]),c=!1;n.add(u.subscribe({next:function(e){c||(c=!0,a++),i[o]=e},error:function(e){return n.error(e)},complete:function(){++s!==r&&c||(a===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=i[n],e}),{}):i),n.complete())}}))},u=0;u<r;u++)o(u);else n.complete()}))}var ee=n(4156);function te(e,t,n,i){return(0,ee.m)(n)&&(i=n,n=void 0),i?te(e,t,n).pipe((0,N.U)((function(e){return(0,L.k)(e)?i.apply(void 0,e):i(e)}))):new r.y((function(r){ne(e,t,(function(e){arguments.length>1?r.next(Array.prototype.slice.call(arguments)):r.next(e)}),r,n)}))}function ne(e,t,n,r,i){var s;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(e)){var a=e;e.addEventListener(t,n,i),s=function(){return a.removeEventListener(t,n,i)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(e)){var o=e;e.on(t,n),s=function(){return o.off(t,n)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(e)){var u=e;e.addListener(t,n),s=function(){return u.removeListener(t,n)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var c=0,l=e.length;c<l;c++)ne(e[c],t,n,r,i)}r.add(s)}function re(e,t,n){return n?re(e,t).pipe((0,N.U)((function(e){return(0,L.k)(e)?n.apply(void 0,e):n(e)}))):new r.y((function(n){var r,i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{r=e(i)}catch(e){return void n.error(e)}if((0,ee.m)(t))return function(){return t(i,r)}}))}function ie(e,t,n,i,s){var a,o;if(1==arguments.length){var u=e;o=u.initialState,t=u.condition,n=u.iterate,a=u.resultSelector||I.y,s=u.scheduler}else void 0===i||(0,M.K)(i)?(o=e,a=I.y,s=i):(o=e,a=i);return new r.y((function(e){var r=o;if(s)return s.schedule(se,0,{subscriber:e,iterate:n,condition:t,resultSelector:a,state:r});for(;;){if(t){var i=void 0;try{i=t(r)}catch(t){return void e.error(t)}if(!i){e.complete();break}}var u=void 0;try{u=a(r)}catch(t){return void e.error(t)}if(e.next(u),e.closed)break;try{r=n(r)}catch(t){return void e.error(t)}}}))}function se(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(e){return void t.error(e)}if(!r)return void t.complete();if(t.closed)return}var i;try{i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function ae(e,t,n){return void 0===t&&(t=X.E),void 0===n&&(n=X.E),(0,q.P)((function(){return e()?t:n}))}var oe=n(5812);function ue(e,t){return void 0===e&&(e=0),void 0===t&&(t=p.P),(!(0,oe.k)(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=p.P),new r.y((function(n){return n.add(t.schedule(ce,e,{subscriber:n,counter:0,period:e})),n}))}function ce(e){var t=e.subscriber,n=e.counter,r=e.period;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}var le=n(4370),he=new r.y(k.Z);function pe(){return he}var de=n(8170);function fe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return X.E;var n=e[0],i=e.slice(1);return 1===e.length&&(0,L.k)(n)?fe.apply(void 0,n):new r.y((function(e){var t=function(){return e.add(fe.apply(void 0,i).subscribe(e))};return(0,Y.D)(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})}))}function me(e,t){return t?new r.y((function(n){var r=Object.keys(e),i=new T.w;return i.add(t.schedule(ge,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i})):new r.y((function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()}))}function ge(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription,s=e.obj;if(!r.closed)if(n<t.length){var a=t[n];r.next([a,s[a]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:s}))}else r.complete()}var ye=n(8463),ve=n(7843),be=n(6008);function xe(e,t,n){return[(0,be.h)(t,n)(new r.y((0,ve.s)(e))),(0,be.h)((0,ye.f)(t,n))(new r.y((0,ve.s)(e)))]}var we=n(8821);function Se(e,t,n){return void 0===e&&(e=0),new r.y((function(r){void 0===t&&(t=e,e=0);var i=0,s=e;if(n)return n.schedule(Te,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(s++),r.closed)break}}))}function Te(e){var t=e.start,n=e.index,r=e.count,i=e.subscriber;n>=r?i.complete():(i.next(t),i.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}var Ce=n(4944),Ae=n(9604);function _e(e,t){return new r.y((function(n){var r,i;try{r=e()}catch(e){return void n.error(e)}try{i=t(r)}catch(e){return void n.error(e)}var s=(i?(0,Y.D)(i):X.E).subscribe(n);return function(){s.unsubscribe(),r&&r.unsubscribe()}}))}var ke=n(5080),Ie=n(8107),Ee=n(150)},364:(e,t,n)=>{"use strict";n.d(t,{c:()=>a});var r=n(5987),i=n(211),s=n(8760),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return r.ZT(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),s.w.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),s.w.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(i.xQ)},9233:(e,t,n)=>{"use strict";n.d(t,{X:()=>a});var r=n(5987),i=n(211),s=n(1016),a=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return r.ZT(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new s.N;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(i.xQ)},2632:(e,t,n)=>{"use strict";n.d(t,{W:()=>r,P:()=>o});var r,i=n(5631),s=n(8170),a=n(4944);r||(r={});var o=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return(0,s.of)(this.value);case"E":return(0,a._)(this.error);case"C":return(0,i.c)()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}()},2772:(e,t,n)=>{"use strict";n.d(t,{y:()=>l});var r=n(3642),i=n(979),s=n(3142),a=n(2174),o=n(5050),u=n(2561),c=n(150),l=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,o=function(e,t,n){if(e){if(e instanceof i.L)return e;if(e[s.b])return e[s.b]()}return e||t||n?new i.L(e,t,n):new i.L(a.c)}(e,t,n);if(r?o.add(r.call(o,this.source)):o.add(this.source||c.v.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),c.v.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){c.v.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),(0,r._)(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=h(t))((function(t,r){var i;i=n.subscribe((function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[o.L]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:(0,u.U)(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=h(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function h(e){if(e||(e=c.v.Promise||Promise),!e)throw new Error("no Promise impl found");return e}},2174:(e,t,n)=>{"use strict";n.d(t,{c:()=>s});var r=n(150),i=n(1644),s={closed:!0,next:function(e){},error:function(e){if(r.v.useDeprecatedSynchronousErrorHandling)throw e;(0,i.z)(e)},complete:function(){}}},2039:(e,t,n)=>{"use strict";n.d(t,{L:()=>i});var r=n(5987),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.ZT(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(n(979).L)},2630:(e,t,n)=>{"use strict";n.d(t,{t:()=>l});var r=n(5987),i=n(211),s=n(2546),a=n(8760),o=n(9276),u=n(1016),c=n(8253),l=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=t<1?1:t,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return r.ZT(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new h(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,s=r.length;if(this.closed)throw new u.N;if(this.isStopped||this.hasError?t=a.w.EMPTY:(this.observers.push(e),t=new c.W(this,e)),i&&e.add(e=new o.ht(e,i)),n)for(var l=0;l<s&&!e.closed;l++)e.next(r[l]);else for(l=0;l<s&&!e.closed;l++)e.next(r[l].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||s.c).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,s=0;s<i&&!(e-r[s].time<n);)s++;return i>t&&(s=Math.max(s,i-t)),s>0&&r.splice(0,s),r},t}(i.xQ),h=function(){return function(e,t){this.time=e,this.value=t}}()},8725:(e,t,n)=>{"use strict";n.d(t,{b:()=>r});var r=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}()},211:(e,t,n)=>{"use strict";n.d(t,{Yc:()=>l,xQ:()=>h});var r=n(5987),i=n(2772),s=n(979),a=n(8760),o=n(1016),u=n(8253),c=n(3142),l=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return r.ZT(t,e),t}(s.L),h=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return r.ZT(t,e),t.prototype[c.b]=function(){return new l(this)},t.prototype.lift=function(e){var t=new p(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new o.N;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new o.N;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new o.N;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new o.N;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new o.N;return this.hasError?(e.error(this.thrownError),a.w.EMPTY):this.isStopped?(e.complete(),a.w.EMPTY):(this.observers.push(e),new u.W(this,e))},t.prototype.asObservable=function(){var e=new i.y;return e.source=this,e},t.create=function(e,t){return new p(e,t)},t}(i.y),p=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return r.ZT(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):a.w.EMPTY},t}(h)},8253:(e,t,n)=>{"use strict";n.d(t,{W:()=>i});var r=n(5987),i=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return r.ZT(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(n(8760).w)},979:(e,t,n)=>{"use strict";n.d(t,{L:()=>l});var r=n(5987),i=n(4156),s=n(2174),a=n(8760),o=n(3142),u=n(150),c=n(1644),l=function(e){function t(n,r,i){var a=e.call(this)||this;switch(a.syncErrorValue=null,a.syncErrorThrown=!1,a.syncErrorThrowable=!1,a.isStopped=!1,arguments.length){case 0:a.destination=s.c;break;case 1:if(!n){a.destination=s.c;break}if("object"==typeof n){n instanceof t?(a.syncErrorThrowable=n.syncErrorThrowable,a.destination=n,n.add(a)):(a.syncErrorThrowable=!0,a.destination=new h(a,n));break}default:a.syncErrorThrowable=!0,a.destination=new h(a,n,r,i)}return a}return r.ZT(t,e),t.prototype[o.b]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(a.w),h=function(e){function t(t,n,r,a){var o,u=e.call(this)||this;u._parentSubscriber=t;var c=u;return(0,i.m)(n)?o=n:n&&(o=n.next,r=n.error,a=n.complete,n!==s.c&&(c=Object.create(n),(0,i.m)(c.unsubscribe)&&u.add(c.unsubscribe.bind(c)),c.unsubscribe=u.unsubscribe.bind(u))),u._context=c,u._next=o,u._error=r,u._complete=a,u}return r.ZT(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;u.v.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=u.v.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):(0,c.z)(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;(0,c.z)(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};u.v.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),u.v.useDeprecatedSynchronousErrorHandling)throw e;(0,c.z)(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!u.v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return u.v.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):((0,c.z)(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(l)},8760:(e,t,n)=>{"use strict";n.d(t,{w:()=>o});var r=n(9026),i=n(2009),s=n(4156),a=n(8782),o=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,o=n._parentOrParents,c=n._ctorUnsubscribe,l=n._unsubscribe,h=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,o instanceof e)o.remove(this);else if(null!==o)for(var p=0;p<o.length;++p)o[p].remove(this);if((0,s.m)(l)){c&&(this._unsubscribe=void 0);try{l.call(this)}catch(e){t=e instanceof a.B?u(e.errors):[e]}}if((0,r.k)(h)){p=-1;for(var d=h.length;++p<d;){var f=h[p];if((0,i.K)(f))try{f.unsubscribe()}catch(e){t=t||[],e instanceof a.B?t=t.concat(u(e.errors)):t.push(e)}}}if(t)throw new a.B(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof e){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var s=this._subscriptions;return null===s?this._subscriptions=[n]:s.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=((t=new e).closed=!0,t),e}();function u(e){return e.reduce((function(e,t){return e.concat(t instanceof a.B?t.errors:t)}),[])}},150:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});var r=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack,r=e},get useDeprecatedSynchronousErrorHandling(){return r}}},7604:(e,t,n)=>{"use strict";n.d(t,{IY:()=>o,Ds:()=>u,ft:()=>c});var r=n(5987),i=n(979),s=n(2772),a=n(7843),o=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return r.ZT(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(i.L),u=(i.L,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.ZT(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(i.L));function c(e,t){if(!t.closed){if(e instanceof s.y)return e.subscribe(t);var n;try{n=(0,a.s)(e)(t)}catch(e){t.error(e)}return n}}i.L},3140:(e,t,n)=>{"use strict";n.d(t,{c:()=>c,N:()=>l});var r=n(5987),i=n(211),s=n(2772),a=n(979),o=n(8760),u=n(3018),c=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return r.ZT(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new o.w).add(this.source.subscribe(new h(this.getSubject(),this))),e.closed&&(this._connection=null,e=o.w.EMPTY)),e},t.prototype.refCount=function(){return(0,u.x)()(this)},t}(s.y),l=function(){var e=c.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),h=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return r.ZT(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(i.Yc);a.L},5142:(e,t,n)=>{"use strict";n.d(t,{aj:()=>l,Ms:()=>h});var r=n(5987),i=n(7507),s=n(9026),a=n(2039),o=n(2080),u=n(3375),c={};function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=void 0,r=void 0;return(0,i.K)(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&(0,s.k)(e[0])&&(e=e[0]),(0,u.n)(e,r).lift(new h(n))}var h=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new p(e,this.resultSelector))},e}(),p=function(e){function t(t,n){var r=e.call(this,t)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return r.ZT(t,e),t.prototype._next=function(e){this.values.push(c),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add((0,o.D)(this,r,void 0,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=this.values,i=r[n],s=this.toRespond?i===c?--this.toRespond:this.toRespond:0;r[n]=t,0===s&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(a.L)},9795:(e,t,n)=>{"use strict";n.d(t,{z:()=>s});var r=n(8170),i=n(2257);function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,i.u)()(r.of.apply(void 0,e))}},1410:(e,t,n)=>{"use strict";n.d(t,{P:()=>a});var r=n(2772),i=n(5760),s=n(5631);function a(e){return new r.y((function(t){var n;try{n=e()}catch(e){return void t.error(e)}return(n?(0,i.D)(n):(0,s.c)()).subscribe(t)}))}},5631:(e,t,n)=>{"use strict";n.d(t,{E:()=>i,c:()=>s});var r=n(2772),i=new r.y((function(e){return e.complete()}));function s(e){return e?function(e){return new r.y((function(t){return e.schedule((function(){return t.complete()}))}))}(e):i}},5760:(e,t,n)=>{"use strict";n.d(t,{D:()=>a});var r=n(2772),i=n(7843),s=n(8107);function a(e,t){return t?(0,s.x)(e,t):e instanceof r.y?e:new r.y((0,i.s)(e))}},3375:(e,t,n)=>{"use strict";n.d(t,{n:()=>a});var r=n(2772),i=n(6900),s=n(3109);function a(e,t){return t?(0,s.r)(e,t):new r.y((0,i.V)(e))}},4370:(e,t,n)=>{"use strict";n.d(t,{T:()=>o});var r=n(2772),i=n(7507),s=n(2556),a=n(3375);function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Number.POSITIVE_INFINITY,o=null,u=e[e.length-1];return(0,i.K)(u)?(o=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(n=e.pop())):"number"==typeof u&&(n=e.pop()),null===o&&1===e.length&&e[0]instanceof r.y?e[0]:(0,s.J)(n)((0,a.n)(e,o))}},8170:(e,t,n)=>{"use strict";n.d(t,{of:()=>a});var r=n(7507),i=n(3375),s=n(3109);function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return(0,r.K)(n)?(e.pop(),(0,s.r)(e,n)):(0,i.n)(e)}},8821:(e,t,n)=>{"use strict";n.d(t,{S3:()=>u});var r=n(5987),i=n(9026),s=n(3375),a=n(2039),o=n(2080);function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!(0,i.k)(e[0]))return e[0];e=e[0]}return(0,s.n)(e,void 0).lift(new c)}var c=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new l(e))},e}(),l=function(e){function t(t){var n=e.call(this,t)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}return r.ZT(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=e[n],i=(0,o.D)(this,r,void 0,n);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},t.prototype.notifyNext=function(e,t,n){if(!this.hasFirst){this.hasFirst=!0;for(var r=0;r<this.subscriptions.length;r++)if(r!==n){var i=this.subscriptions[r];i.unsubscribe(),this.remove(i)}this.subscriptions=null}this.destination.next(t)},t}(a.L)},4944:(e,t,n)=>{"use strict";n.d(t,{_:()=>i});var r=n(2772);function i(e,t){return t?new r.y((function(n){return t.schedule(s,0,{error:e,subscriber:n})})):new r.y((function(t){return t.error(e)}))}function s(e){var t=e.error;e.subscriber.error(t)}},9604:(e,t,n)=>{"use strict";n.d(t,{H:()=>o});var r=n(2772),i=n(964),s=n(5812),a=n(7507);function o(e,t,n){void 0===e&&(e=0);var o=-1;return(0,s.k)(t)?o=Number(t)<1?1:Number(t):(0,a.K)(t)&&(n=t),(0,a.K)(n)||(n=i.P),new r.y((function(t){var r=(0,s.k)(e)?e:+e-n.now();return n.schedule(u,r,{index:0,period:o,subscriber:t})}))}function u(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}},5080:(e,t,n)=>{"use strict";n.d(t,{$R:()=>c,mx:()=>l});var r=n(5987),i=n(3375),s=n(9026),a=n(979),o=n(999),u=n(7604);function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return"function"==typeof n&&e.pop(),(0,i.n)(e,void 0).lift(new l(n))}var l=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new h(e,this.resultSelector))},e}(),h=function(e){function t(t,n,r){void 0===r&&(r=Object.create(null));var i=e.call(this,t)||this;return i.resultSelector=n,i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:void 0,i}return r.ZT(t,e),t.prototype._next=function(e){var t=this.iterators;(0,s.k)(e)?t.push(new d(e)):"function"==typeof e[o.hZ]?t.push(new p(e[o.hZ]())):t.push(new f(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0!==t){this.active=t;for(var n=0;n<t;n++){var r=e[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}else this.destination.complete()},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++)if("function"==typeof(a=e[r]).hasValue&&!a.hasValue())return;var i=!1,s=[];for(r=0;r<t;r++){var a,o=(a=e[r]).next();if(a.hasCompleted()&&(i=!0),o.done)return void n.complete();s.push(o.value)}this.resultSelector?this._tryresultSelector(s):n.next(s),i&&n.complete()},t.prototype._tryresultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(a.L),p=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return Boolean(e&&e.done)},e}(),d=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[o.hZ]=function(){return this},e.prototype.next=function(e){var t=this.index++,n=this.array;return t<this.length?{value:n[t],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),f=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return r.ZT(t,e),t.prototype[o.hZ]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return this.buffer.length>0},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return(0,u.ft)(this.observable,new u.IY(this))},t}(u.Ds)},2257:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});var r=n(2556);function i(){return(0,r.J)(1)}},6008:(e,t,n)=>{"use strict";n.d(t,{h:()=>s});var r=n(5987),i=n(979);function s(e,t){return function(n){return n.lift(new a(e,t))}}var a=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.predicate,this.thisArg))},e}(),o=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return r.ZT(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(i.L)},1120:(e,t,n)=>{"use strict";n.d(t,{v:()=>u,T:()=>p});var r=n(5987),i=n(979),s=n(8760),a=n(2772),o=n(211);function u(e,t,n,r){return function(i){return i.lift(new c(e,t,n,r))}}var c=function(){function e(e,t,n,r){this.keySelector=e,this.elementSelector=t,this.durationSelector=n,this.subjectSelector=r}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},e}(),l=function(e){function t(t,n,r,i,s){var a=e.call(this,t)||this;return a.keySelector=n,a.elementSelector=r,a.durationSelector=i,a.subjectSelector=s,a.groups=null,a.attemptedToUnsubscribe=!1,a.count=0,a}return r.ZT(t,e),t.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r,i=n.get(t);if(this.elementSelector)try{r=this.elementSelector(e)}catch(e){this.error(e)}else r=e;if(!i){i=this.subjectSelector?this.subjectSelector():new o.xQ,n.set(t,i);var s=new p(t,i,this);if(this.destination.next(s),this.durationSelector){var a=void 0;try{a=this.durationSelector(new p(t,i))}catch(e){return void this.error(e)}this.add(a.subscribe(new h(t,i,this)))}}i.closed||i.next(r)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach((function(t,n){t.error(e)})),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach((function(e,t){e.complete()})),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))},t}(i.L),h=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return r.ZT(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(i.L),p=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return r.ZT(t,e),t.prototype._subscribe=function(e){var t=new s.w,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new d(n)),t.add(r.subscribe(e)),t},t}(a.y),d=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return r.ZT(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(s.w)},5709:(e,t,n)=>{"use strict";n.d(t,{U:()=>s});var r=n(5987),i=n(979);function s(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new a(e,t))}}var a=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.project,this.thisArg))},e}(),o=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return r.ZT(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(i.L)},2556:(e,t,n)=>{"use strict";n.d(t,{J:()=>s});var r=n(7746),i=n(3608);function s(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),(0,r.zg)(i.y,e)}},7746:(e,t,n)=>{"use strict";n.d(t,{zg:()=>o,VS:()=>l});var r=n(5987),i=n(5709),s=n(5760),a=n(7604);function o(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(o((function(n,r){return(0,s.D)(e(n,r)).pipe((0,i.U)((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new u(e,n))})}var u=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.project,this.concurrent))},e}(),c=function(e){function t(t,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=e.call(this,t)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return r.ZT(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new a.IY(this),n=this.destination;n.add(t);var r=(0,a.ft)(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(a.Ds),l=o},9276:(e,t,n)=>{"use strict";n.d(t,{QV:()=>a,ht:()=>u});var r=n(5987),i=n(979),s=n(2632);function a(e,t){return void 0===t&&(t=0),function(n){return n.lift(new o(e,t))}}var o=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.scheduler,this.delay))},e}(),u=function(e){function t(t,n,r){void 0===r&&(r=0);var i=e.call(this,t)||this;return i.scheduler=n,i.delay=r,i}return r.ZT(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new c(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(s.P.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(s.P.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(s.P.createComplete()),this.unsubscribe()},t}(i.L),c=function(){return function(e,t){this.notification=e,this.destination=t}}()},3018:(e,t,n)=>{"use strict";n.d(t,{x:()=>s});var r=n(5987),i=n(979);function s(){return function(e){return e.lift(new a(e))}}var a=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new o(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i},e}(),o=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return r.ZT(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},t}(i.L)},3109:(e,t,n)=>{"use strict";n.d(t,{r:()=>s});var r=n(2772),i=n(8760);function s(e,t){return new r.y((function(n){var r=new i.w,s=0;return r.add(t.schedule((function(){s!==e.length?(n.next(e[s++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}},8107:(e,t,n)=>{"use strict";n.d(t,{x:()=>l});var r=n(2772),i=n(8760),s=n(5050),a=n(3109),o=n(999),u=n(336),c=n(9217);function l(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[s.L]}(e))return function(e,t){return new r.y((function(n){var r=new i.w;return r.add(t.schedule((function(){var i=e[s.L]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if((0,u.t)(e))return function(e,t){return new r.y((function(n){var r=new i.w;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if((0,c.z)(e))return(0,a.r)(e,t);if(function(e){return e&&"function"==typeof e[o.hZ]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new r.y((function(n){var r,s=new i.w;return s.add((function(){r&&"function"==typeof r.return&&r.return()})),s.add(t.schedule((function(){r=e[o.hZ](),s.add(t.schedule((function(){if(!n.closed){var e,t;try{var i=r.next();e=i.value,t=i.done}catch(e){return void n.error(e)}t?n.complete():(n.next(e),this.schedule())}})))}))),s}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}},6114:(e,t,n)=>{"use strict";n.d(t,{o:()=>i});var r=n(5987),i=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return r.ZT(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(e){n=!0,r=!!e&&e||new Error(e)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return r.ZT(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(n(8760).w))},8399:(e,t,n)=>{"use strict";n.d(t,{v:()=>s});var r=n(5987),i=n(8725),s=function(e){function t(n,r){void 0===r&&(r=i.b.now);var s=e.call(this,n,(function(){return t.delegate&&t.delegate!==s?t.delegate.now():r()}))||this;return s.actions=[],s.active=!1,s.scheduled=void 0,s}return r.ZT(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(i.b)},6650:(e,t,n)=>{"use strict";n.d(t,{e:()=>l,E:()=>c});var r=n(5987),i=1,s=function(){return Promise.resolve()}(),a={};function o(e){return e in a&&(delete a[e],!0)}var u=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return r.ZT(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=(u=t.flush.bind(t,null),c=i++,a[c]=!0,s.then((function(){return o(c)&&u()})),c)));var u,c},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(o(n),t.scheduled=void 0)},t}(n(6114).o),c=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.ZT(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(n(8399).v))(u),l=c},964:(e,t,n)=>{"use strict";n.d(t,{z:()=>i,P:()=>s});var r=n(6114),i=new(n(8399).v)(r.o),s=i},2546:(e,t,n)=>{"use strict";n.d(t,{c:()=>a,N:()=>s});var r=n(5987),i=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return r.ZT(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(n(6114).o),s=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.ZT(t,e),t}(n(8399).v))(i),a=s},999:(e,t,n)=>{"use strict";function r(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}n.d(t,{hZ:()=>i});var i=r()},5050:(e,t,n)=>{"use strict";n.d(t,{L:()=>r});var r=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}()},3142:(e,t,n)=>{"use strict";n.d(t,{b:()=>r});var r=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}()},6565:(e,t,n)=>{"use strict";n.d(t,{W:()=>r});var r=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}()},6929:(e,t,n)=>{"use strict";n.d(t,{K:()=>r});var r=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}()},1016:(e,t,n)=>{"use strict";n.d(t,{N:()=>r});var r=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}()},1462:(e,t,n)=>{"use strict";n.d(t,{W:()=>r});var r=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}()},8782:(e,t,n)=>{"use strict";n.d(t,{B:()=>r});var r=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}()},3642:(e,t,n)=>{"use strict";n.d(t,{_:()=>i});var r=n(979);function i(e){for(;e;){var t=e,n=t.closed,i=t.destination,s=t.isStopped;if(n||s)return!1;e=i&&i instanceof r.L?i:null}return!0}},1644:(e,t,n)=>{"use strict";function r(e){setTimeout((function(){throw e}),0)}n.d(t,{z:()=>r})},3608:(e,t,n)=>{"use strict";function r(e){return e}n.d(t,{y:()=>r})},9026:(e,t,n)=>{"use strict";n.d(t,{k:()=>r});var r=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}()},9217:(e,t,n)=>{"use strict";n.d(t,{z:()=>r});var r=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e}},4156:(e,t,n)=>{"use strict";function r(e){return"function"==typeof e}n.d(t,{m:()=>r})},5812:(e,t,n)=>{"use strict";n.d(t,{k:()=>i});var r=n(9026);function i(e){return!(0,r.k)(e)&&e-parseFloat(e)+1>=0}},2009:(e,t,n)=>{"use strict";function r(e){return null!==e&&"object"==typeof e}n.d(t,{K:()=>r})},336:(e,t,n)=>{"use strict";function r(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}n.d(t,{t:()=>r})},7507:(e,t,n)=>{"use strict";function r(e){return e&&"function"==typeof e.schedule}n.d(t,{K:()=>r})},3306:(e,t,n)=>{"use strict";function r(){}n.d(t,{Z:()=>r})},8463:(e,t,n)=>{"use strict";function r(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}n.d(t,{f:()=>r})},2561:(e,t,n)=>{"use strict";n.d(t,{z:()=>i,U:()=>s});var r=n(3608);function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(e)}function s(e){return 0===e.length?r.y:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}},7843:(e,t,n)=>{"use strict";n.d(t,{s:()=>l});var r=n(6900),i=n(1644),s=n(999),a=n(5050),o=n(9217),u=n(336),c=n(2009),l=function(e){if(e&&"function"==typeof e[a.L])return l=e,function(e){var t=l[a.L]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if((0,o.z)(e))return(0,r.V)(e);if((0,u.t)(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,i.z),e};if(e&&"function"==typeof e[s.hZ])return t=e,function(e){for(var n=t[s.hZ]();;){var r=void 0;try{r=n.next()}catch(t){return e.error(t),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,l,h=(0,c.K)(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+h+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},6900:(e,t,n)=>{"use strict";n.d(t,{V:()=>r});var r=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}}},2080:(e,t,n)=>{"use strict";n.d(t,{D:()=>o});var r=n(5987),i=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return r.ZT(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(n(979).L),s=n(7843),a=n(2772);function o(e,t,n,r,o){if(void 0===o&&(o=new i(e,n,r)),!o.closed)return t instanceof a.y?t.subscribe(o):(0,s.s)(t)(o)}},1717:(e,t,n)=>{"use strict";n.r(t),n.d(t,{audit:()=>s,auditTime:()=>l,buffer:()=>h,bufferCount:()=>m,bufferTime:()=>x,bufferToggle:()=>O,bufferWhen:()=>P,catchError:()=>R,combineAll:()=>$,combineLatest:()=>U,concat:()=>j,concatAll:()=>W.u,concatMap:()=>q,concatMapTo:()=>X,count:()=>Z,debounce:()=>J,debounceTime:()=>ne,defaultIfEmpty:()=>ae,delay:()=>he,delayWhen:()=>ge,dematerialize:()=>we,distinct:()=>Ce,distinctUntilChanged:()=>ke,distinctUntilKeyChanged:()=>Oe,elementAt:()=>Ge,endWith:()=>Ke,every:()=>je,exhaust:()=>qe,exhaustMap:()=>Qe,expand:()=>tt,filter:()=>Be.h,finalize:()=>it,find:()=>ot,findIndex:()=>lt,first:()=>pt,flatMap:()=>H.VS,groupBy:()=>dt.v,ignoreElements:()=>ft,isEmpty:()=>yt,last:()=>Tt,map:()=>Ye.U,mapTo:()=>Ct,materialize:()=>kt,max:()=>Nt,merge:()=>Lt,mergeAll:()=>Mt.J,mergeMap:()=>H.zg,mergeMapTo:()=>zt,mergeScan:()=>$t,min:()=>Ut,multicast:()=>jt,observeOn:()=>Ht.QV,onErrorResumeNext:()=>qt,pairwise:()=>Yt,partition:()=>tn,pluck:()=>nn,publish:()=>an,publishBehavior:()=>un,publishLast:()=>ln,publishReplay:()=>pn,race:()=>fn,reduce:()=>Ft,refCount:()=>kn.x,repeat:()=>mn,repeatWhen:()=>vn,retry:()=>wn,retryWhen:()=>Cn,sample:()=>In,sampleTime:()=>Dn,scan:()=>Ot,sequenceEqual:()=>Nn,share:()=>$n,shareReplay:()=>Vn,single:()=>Gn,skip:()=>jn,skipLast:()=>qn,skipUntil:()=>Yn,skipWhile:()=>er,startWith:()=>rr,subscribeOn:()=>or,switchAll:()=>pr,switchMap:()=>cr,switchMapTo:()=>dr,take:()=>ze,takeLast:()=>xt,takeUntil:()=>fr,takeWhile:()=>yr,tap:()=>Sr,throttle:()=>_r,throttleTime:()=>Er,throwIfEmpty:()=>Fe,timeInterval:()=>Fr,timeout:()=>Vr,timeoutWith:()=>Lr,timestamp:()=>Gr,toArray:()=>jr,window:()=>Wr,windowCount:()=>Xr,windowTime:()=>Qr,windowToggle:()=>si,windowWhen:()=>ui,withLatestFrom:()=>hi,zip:()=>mi,zipAll:()=>gi});var r=n(5987),i=n(7604);function s(e){return function(t){return t.lift(new a(e))}}var a=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.durationSelector))},e}(),o=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r}return r.ZT(t,e),t.prototype._next=function(e){if(this.value=e,this.hasValue=!0,!this.throttled){var t=void 0;try{t=(0,this.durationSelector)(e)}catch(e){return this.destination.error(e)}var n=(0,i.ft)(t,new i.IY(this));!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}},t.prototype.clearThrottle=function(){var e=this,t=e.value,n=e.hasValue,r=e.throttled;r&&(this.remove(r),this.throttled=void 0,r.unsubscribe()),n&&(this.value=void 0,this.hasValue=!1,this.destination.next(t))},t.prototype.notifyNext=function(){this.clearThrottle()},t.prototype.notifyComplete=function(){this.clearThrottle()},t}(i.Ds),u=n(964),c=n(9604);function l(e,t){return void 0===t&&(t=u.P),s((function(){return(0,c.H)(e,t)}))}function h(e){return function(t){return t.lift(new p(e))}}var p=function(){function e(e){this.closingNotifier=e}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.closingNotifier))},e}(),d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.buffer=[],r.add((0,i.ft)(n,new i.IY(r))),r}return r.ZT(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype.notifyNext=function(){var e=this.buffer;this.buffer=[],this.destination.next(e)},t}(i.Ds),f=n(979);function m(e,t){return void 0===t&&(t=null),function(n){return n.lift(new g(e,t))}}var g=function(){function e(e,t){this.bufferSize=e,this.startBufferEvery=t,this.subscriberClass=t&&e!==t?v:y}return e.prototype.call=function(e,t){return t.subscribe(new this.subscriberClass(e,this.bufferSize,this.startBufferEvery))},e}(),y=function(e){function t(t,n){var r=e.call(this,t)||this;return r.bufferSize=n,r.buffer=[],r}return r.ZT(t,e),t.prototype._next=function(e){var t=this.buffer;t.push(e),t.length==this.bufferSize&&(this.destination.next(t),this.buffer=[])},t.prototype._complete=function(){var t=this.buffer;t.length>0&&this.destination.next(t),e.prototype._complete.call(this)},t}(f.L),v=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.bufferSize=n,i.startBufferEvery=r,i.buffers=[],i.count=0,i}return r.ZT(t,e),t.prototype._next=function(e){var t=this,n=t.bufferSize,r=t.startBufferEvery,i=t.buffers,s=t.count;this.count++,s%r==0&&i.push([]);for(var a=i.length;a--;){var o=i[a];o.push(e),o.length===n&&(i.splice(a,1),this.destination.next(o))}},t.prototype._complete=function(){for(var t=this.buffers,n=this.destination;t.length>0;){var r=t.shift();r.length>0&&n.next(r)}e.prototype._complete.call(this)},t}(f.L),b=n(7507);function x(e){var t=arguments.length,n=u.P;(0,b.K)(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],t--);var r=null;t>=2&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return t>=3&&(i=arguments[2]),function(t){return t.lift(new w(e,r,i,n))}}var w=function(){function e(e,t,n,r){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new T(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),S=function(){return function(){this.buffer=[]}}(),T=function(e){function t(t,n,r,i,s){var a=e.call(this,t)||this;a.bufferTimeSpan=n,a.bufferCreationInterval=r,a.maxBufferSize=i,a.scheduler=s,a.contexts=[];var o=a.openContext();if(a.timespanOnly=null==r||r<0,a.timespanOnly){var u={subscriber:a,context:o,bufferTimeSpan:n};a.add(o.closeAction=s.schedule(C,n,u))}else{var c={subscriber:a,context:o},l={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:a,scheduler:s};a.add(o.closeAction=s.schedule(_,n,c)),a.add(s.schedule(A,r,l))}return a}return r.ZT(t,e),t.prototype._next=function(e){for(var t,n=this.contexts,r=n.length,i=0;i<r;i++){var s=n[i],a=s.buffer;a.push(e),a.length==this.maxBufferSize&&(t=s)}t&&this.onBufferFull(t)},t.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts,n=this.destination;t.length>0;){var r=t.shift();n.next(r.buffer)}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.contexts=null},t.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var n=this.bufferTimeSpan,r={subscriber:this,context:e,bufferTimeSpan:n};this.add(e.closeAction=this.scheduler.schedule(C,n,r))}},t.prototype.openContext=function(){var e=new S;return this.contexts.push(e),e},t.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;(t?t.indexOf(e):-1)>=0&&t.splice(t.indexOf(e),1)},t}(f.L);function C(e){var t=e.subscriber,n=e.context;n&&t.closeContext(n),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function A(e){var t=e.bufferCreationInterval,n=e.bufferTimeSpan,r=e.subscriber,i=e.scheduler,s=r.openContext();r.closed||(r.add(s.closeAction=i.schedule(_,n,{subscriber:r,context:s})),this.schedule(e,t))}function _(e){var t=e.subscriber,n=e.context;t.closeContext(n)}var k=n(8760),I=n(2080),E=n(2039);function O(e,t){return function(n){return n.lift(new D(e,t))}}var D=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new B(e,this.openings,this.closingSelector))},e}(),B=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.closingSelector=r,i.contexts=[],i.add((0,I.D)(i,n)),i}return r.ZT(t,e),t.prototype._next=function(e){for(var t=this.contexts,n=t.length,r=0;r<n;r++)t[r].buffer.push(e)},t.prototype._error=function(t){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var n=t.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t){e?this.closeBuffer(e):this.openBuffer(t)},t.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},t.prototype.openBuffer=function(e){try{var t=this.closingSelector.call(this,e);t&&this.trySubscribe(t)}catch(e){this._error(e)}},t.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var n=e.buffer,r=e.subscription;this.destination.next(n),t.splice(t.indexOf(e),1),this.remove(r),r.unsubscribe()}},t.prototype.trySubscribe=function(e){var t=this.contexts,n=new k.w,r={buffer:[],subscription:n};t.push(r);var i=(0,I.D)(this,e,r);!i||i.closed?this.closeBuffer(r):(i.context=r,this.add(i),n.add(i))},t}(E.L);function P(e){return function(t){return t.lift(new F(e))}}var F=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new N(e,this.closingSelector))},e}(),N=function(e){function t(t,n){var r=e.call(this,t)||this;return r.closingSelector=n,r.subscribing=!1,r.openBuffer(),r}return r.ZT(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.buffer=void 0,this.subscribing=!1},t.prototype.notifyNext=function(){this.openBuffer()},t.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},t.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe());var t,n=this.buffer;this.buffer&&this.destination.next(n),this.buffer=[];try{t=(0,this.closingSelector)()}catch(e){return this.error(e)}e=new k.w,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add((0,i.ft)(t,new i.IY(this))),this.subscribing=!1},t}(i.Ds);function R(e){return function(t){var n=new L(e),r=t.lift(n);return n.caught=r}}var L=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new M(e,this.selector,this.caught))},e}(),M=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.selector=n,i.caught=r,i}return r.ZT(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle();var r=new i.IY(this);this.add(r);var s=(0,i.ft)(n,r);s!==r&&this.add(s)}},t}(i.Ds),z=n(5142);function $(e){return function(t){return t.lift(new z.Ms(e))}}var V=n(9026),G=n(5760);function U(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null;return"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&(0,V.k)(e[0])&&(e=e[0].slice()),function(t){return t.lift.call((0,G.D)([t].concat(e)),new z.Ms(n))}}var K=n(9795);function j(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(K.z.apply(void 0,[t].concat(e)))}}var W=n(2257),H=n(7746);function q(e,t){return(0,H.zg)(e,t,1)}function X(e,t){return q((function(){return e}),t)}function Z(e){return function(t){return t.lift(new Y(e,t))}}var Y=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Q(e,this.predicate,this.source))},e}(),Q=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.count=0,i.index=0,i}return r.ZT(t,e),t.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},t.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t&&this.count++},t.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},t}(f.L);function J(e){return function(t){return t.lift(new ee(e))}}var ee=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new te(e,this.durationSelector))},e}(),te=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r}return r.ZT(t,e),t.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.emitValue(),this.destination.complete()},t.prototype._tryNext=function(e,t){var n=this.durationSubscription;this.value=e,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=(0,i.ft)(t,new i.IY(this)))&&!n.closed&&this.add(this.durationSubscription=n)},t.prototype.notifyNext=function(){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){if(this.hasValue){var t=this.value,n=this.durationSubscription;n&&(this.durationSubscription=void 0,n.unsubscribe(),this.remove(n)),this.value=void 0,this.hasValue=!1,e.prototype._next.call(this,t)}},t}(i.Ds);function ne(e,t){return void 0===t&&(t=u.P),function(n){return n.lift(new re(e,t))}}var re=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new ie(e,this.dueTime,this.scheduler))},e}(),ie=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return r.ZT(t,e),t.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(se,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}},t.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},t}(f.L);function se(e){e.debouncedNext()}function ae(e){return void 0===e&&(e=null),function(t){return t.lift(new oe(e))}}var oe=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new ue(e,this.defaultValue))},e}(),ue=function(e){function t(t,n){var r=e.call(this,t)||this;return r.defaultValue=n,r.isEmpty=!0,r}return r.ZT(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(f.L);function ce(e){return e instanceof Date&&!isNaN(+e)}var le=n(2632);function he(e,t){void 0===t&&(t=u.P);var n=ce(e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new pe(n,t))}}var pe=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new de(e,this.delay,this.scheduler))},e}(),de=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return r.ZT(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var s=Math.max(0,n[0].time-r.now());this.schedule(e,s)}else this.unsubscribe(),t.active=!1},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler,n=new fe(t.now()+this.delay,e);this.queue.push(n),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(le.P.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(le.P.createComplete()),this.unsubscribe()},t}(f.L),fe=function(){return function(e,t){this.time=e,this.notification=t}}(),me=n(2772);function ge(e,t){return t?function(n){return new be(n,t).lift(new ye(e))}:function(t){return t.lift(new ye(e))}}var ye=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new ve(e,this.delayDurationSelector))},e}(),ve=function(e){function t(t,n){var r=e.call(this,t)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}return r.ZT(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(e),this.removeSubscription(i),this.tryComplete()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},t.prototype._next=function(e){var t=this.index++;try{var n=this.delayDurationSelector(e,t);n&&this.tryDelay(n,e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},t.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e);return-1!==t&&this.delayNotifierSubscriptions.splice(t,1),e.outerValue},t.prototype.tryDelay=function(e,t){var n=(0,I.D)(this,e,t);n&&!n.closed&&(this.destination.add(n),this.delayNotifierSubscriptions.push(n))},t.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},t}(E.L),be=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subscriptionDelay=n,r}return r.ZT(t,e),t.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new xe(e,this.source))},t}(me.y),xe=function(e){function t(t,n){var r=e.call(this)||this;return r.parent=t,r.source=n,r.sourceSubscribed=!1,r}return r.ZT(t,e),t.prototype._next=function(e){this.subscribeToSource()},t.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},t.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},t.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},t}(f.L);function we(){return function(e){return e.lift(new Se)}}var Se=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Te(e))},e}(),Te=function(e){function t(t){return e.call(this,t)||this}return r.ZT(t,e),t.prototype._next=function(e){e.observe(this.destination)},t}(f.L);function Ce(e,t){return function(n){return n.lift(new Ae(e,t))}}var Ae=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new _e(e,this.keySelector,this.flushes))},e}(),_e=function(e){function t(t,n,r){var s=e.call(this,t)||this;return s.keySelector=n,s.values=new Set,r&&s.add((0,i.ft)(r,new i.IY(s))),s}return r.ZT(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t,n=this.destination;try{t=this.keySelector(e)}catch(e){return void n.error(e)}this._finalizeNext(t,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(i.Ds);function ke(e,t){return function(n){return n.lift(new Ie(e,t))}}var Ie=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Ee(e,this.compare,this.keySelector))},e}(),Ee=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return r.ZT(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var n=this.keySelector;t=n?n(e):e}catch(e){return this.destination.error(e)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,t)}catch(e){return this.destination.error(e)}else this.hasKey=!0;r||(this.key=t,this.destination.next(e))},t}(f.L);function Oe(e,t){return ke((function(n,r){return t?t(n[e],r[e]):n[e]===r[e]}))}var De=n(6565),Be=n(6008),Pe=n(6929);function Fe(e){return void 0===e&&(e=Le),function(t){return t.lift(new Ne(e))}}var Ne=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new Re(e,this.errorFactory))},e}(),Re=function(e){function t(t,n){var r=e.call(this,t)||this;return r.errorFactory=n,r.hasValue=!1,r}return r.ZT(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(f.L);function Le(){return new Pe.K}var Me=n(5631);function ze(e){return function(t){return 0===e?(0,Me.c)():t.lift(new $e(e))}}var $e=function(){function e(e){if(this.total=e,this.total<0)throw new De.W}return e.prototype.call=function(e,t){return t.subscribe(new Ve(e,this.total))},e}(),Ve=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return r.ZT(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(f.L);function Ge(e,t){if(e<0)throw new De.W;var n=arguments.length>=2;return function(r){return r.pipe((0,Be.h)((function(t,n){return n===e})),ze(1),n?ae(t):Fe((function(){return new De.W})))}}var Ue=n(8170);function Ke(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return(0,K.z)(t,Ue.of.apply(void 0,e))}}function je(e,t){return function(n){return n.lift(new We(e,t,n))}}var We=function(){function e(e,t,n){this.predicate=e,this.thisArg=t,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new He(e,this.predicate,this.thisArg,this.source))},e}(),He=function(e){function t(t,n,r,i){var s=e.call(this,t)||this;return s.predicate=n,s.thisArg=r,s.source=i,s.index=0,s.thisArg=r||s,s}return r.ZT(t,e),t.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},t.prototype._next=function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t||this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(f.L);function qe(){return function(e){return e.lift(new Xe)}}var Xe=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Ze(e))},e}(),Ze=function(e){function t(t){var n=e.call(this,t)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}return r.ZT(t,e),t.prototype._next=function(e){this.hasSubscription||(this.hasSubscription=!0,this.add((0,i.ft)(e,new i.IY(this))))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(i.Ds),Ye=n(5709);function Qe(e,t){return t?function(n){return n.pipe(Qe((function(n,r){return(0,G.D)(e(n,r)).pipe((0,Ye.U)((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new Je(e))}}var Je=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new et(e,this.project))},e}(),et=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}return r.ZT(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.hasSubscription=!0,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new i.IY(this),n=this.destination;n.add(t);var r=(0,i.ft)(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(i.Ds);function tt(e,t,n){return void 0===t&&(t=Number.POSITIVE_INFINITY),t=(t||0)<1?Number.POSITIVE_INFINITY:t,function(r){return r.lift(new nt(e,t,n))}}var nt=function(){function e(e,t,n){this.project=e,this.concurrent=t,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new rt(e,this.project,this.concurrent,this.scheduler))},e}(),rt=function(e){function t(t,n,r,i){var s=e.call(this,t)||this;return s.project=n,s.concurrent=r,s.scheduler=i,s.index=0,s.active=0,s.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(s.buffer=[]),s}return r.ZT(t,e),t.dispatch=function(e){var t=e.subscriber,n=e.result,r=e.value,i=e.index;t.subscribeToProjection(n,r,i)},t.prototype._next=function(e){var n=this.destination;if(n.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){n.next(e);try{var i=(0,this.project)(e,r);if(this.scheduler){var s={subscriber:this,result:i,value:e,index:r};this.destination.add(this.scheduler.schedule(t.dispatch,0,s))}else this.subscribeToProjection(i,e,r)}catch(e){n.error(e)}}else this.buffer.push(e)}},t.prototype.subscribeToProjection=function(e,t,n){this.active++,this.destination.add((0,i.ft)(e,new i.IY(this)))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this._next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e&&e.length>0&&this._next(e.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},t}(i.Ds);function it(e){return function(t){return t.lift(new st(e))}}var st=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new at(e,this.callback))},e}(),at=function(e){function t(t,n){var r=e.call(this,t)||this;return r.add(new k.w(n)),r}return r.ZT(t,e),t}(f.L);function ot(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return function(n){return n.lift(new ut(e,n,!1,t))}}var ut=function(){function e(e,t,n,r){this.predicate=e,this.source=t,this.yieldIndex=n,this.thisArg=r}return e.prototype.call=function(e,t){return t.subscribe(new ct(e,this.predicate,this.source,this.yieldIndex,this.thisArg))},e}(),ct=function(e){function t(t,n,r,i,s){var a=e.call(this,t)||this;return a.predicate=n,a.source=r,a.yieldIndex=i,a.thisArg=s,a.index=0,a}return r.ZT(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete(),this.unsubscribe()},t.prototype._next=function(e){var t=this.predicate,n=this.thisArg,r=this.index++;try{t.call(n||this,e,r,this.source)&&this.notifyComplete(this.yieldIndex?r:e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},t}(f.L);function lt(e,t){return function(n){return n.lift(new ut(e,n,!0,t))}}var ht=n(3608);function pt(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?(0,Be.h)((function(t,n){return e(t,n,r)})):ht.y,ze(1),n?ae(t):Fe((function(){return new Pe.K})))}}var dt=n(1120);function ft(){return function(e){return e.lift(new mt)}}var mt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new gt(e))},e}(),gt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.ZT(t,e),t.prototype._next=function(e){},t}(f.L);function yt(){return function(e){return e.lift(new vt)}}var vt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new bt(e))},e}(),bt=function(e){function t(t){return e.call(this,t)||this}return r.ZT(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype._next=function(e){this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(f.L);function xt(e){return function(t){return 0===e?(0,Me.c)():t.lift(new wt(e))}}var wt=function(){function e(e){if(this.total=e,this.total<0)throw new De.W}return e.prototype.call=function(e,t){return t.subscribe(new St(e,this.total))},e}(),St=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.ring=new Array,r.count=0,r}return r.ZT(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var s=t++%n;e.next(r[s])}e.complete()},t}(f.L);function Tt(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?(0,Be.h)((function(t,n){return e(t,n,r)})):ht.y,xt(1),n?ae(t):Fe((function(){return new Pe.K})))}}function Ct(e){return function(t){return t.lift(new At(e))}}var At=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new _t(e,this.value))},e}(),_t=function(e){function t(t,n){var r=e.call(this,t)||this;return r.value=n,r}return r.ZT(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(f.L);function kt(){return function(e){return e.lift(new It)}}var It=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Et(e))},e}(),Et=function(e){function t(t){return e.call(this,t)||this}return r.ZT(t,e),t.prototype._next=function(e){this.destination.next(le.P.createNext(e))},t.prototype._error=function(e){var t=this.destination;t.next(le.P.createError(e)),t.complete()},t.prototype._complete=function(){var e=this.destination;e.next(le.P.createComplete()),e.complete()},t}(f.L);function Ot(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Dt(e,t,n))}}var Dt=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new Bt(e,this.accumulator,this.seed,this.hasSeed))},e}(),Bt=function(e){function t(t,n,r,i){var s=e.call(this,t)||this;return s.accumulator=n,s._seed=r,s.hasSeed=i,s.index=0,s}return r.ZT(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(e){this.destination.error(e)}this.seed=t,this.destination.next(t)},t}(f.L),Pt=n(2561);function Ft(e,t){return arguments.length>=2?function(n){return(0,Pt.z)(Ot(e,t),xt(1),ae(t))(n)}:function(t){return(0,Pt.z)(Ot((function(t,n,r){return e(t,n,r+1)})),xt(1))(t)}}function Nt(e){return Ft("function"==typeof e?function(t,n){return e(t,n)>0?t:n}:function(e,t){return e>t?e:t})}var Rt=n(4370);function Lt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(Rt.T.apply(void 0,[t].concat(e)))}}var Mt=n(2556);function zt(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?(0,H.zg)((function(){return e}),t,n):("number"==typeof t&&(n=t),(0,H.zg)((function(){return e}),n))}function $t(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return r.lift(new Vt(e,t,n))}}var Vt=function(){function e(e,t,n){this.accumulator=e,this.seed=t,this.concurrent=n}return e.prototype.call=function(e,t){return t.subscribe(new Gt(e,this.accumulator,this.seed,this.concurrent))},e}(),Gt=function(e){function t(t,n,r,i){var s=e.call(this,t)||this;return s.accumulator=n,s.acc=r,s.concurrent=i,s.hasValue=!1,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return r.ZT(t,e),t.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++,n=this.destination,r=void 0;try{r=(0,this.accumulator)(this.acc,e,t)}catch(e){return n.error(e)}this.active++,this._innerSub(r)}else this.buffer.push(e)},t.prototype._innerSub=function(e){var t=new i.IY(this),n=this.destination;n.add(t);var r=(0,i.ft)(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},t.prototype.notifyNext=function(e){var t=this.destination;this.acc=e,this.hasValue=!0,t.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},t}(i.Ds);function Ut(e){return Ft("function"==typeof e?function(t,n){return e(t,n)<0?t:n}:function(e,t){return e<t?e:t})}var Kt=n(3140);function jt(e,t){return function(n){var r;if(r="function"==typeof e?e:function(){return e},"function"==typeof t)return n.lift(new Wt(r,t));var i=Object.create(n,Kt.N);return i.source=n,i.subjectFactory=r,i}}var Wt=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(e);return i.add(t.subscribe(r)),i},e}(),Ht=n(9276);function qt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===e.length&&(0,V.k)(e[0])&&(e=e[0]),function(t){return t.lift(new Xt(e))}}var Xt=function(){function e(e){this.nextSources=e}return e.prototype.call=function(e,t){return t.subscribe(new Zt(e,this.nextSources))},e}(),Zt=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.nextSources=n,r}return r.ZT(t,e),t.prototype.notifyError=function(){this.subscribeToNextSource()},t.prototype.notifyComplete=function(){this.subscribeToNextSource()},t.prototype._error=function(e){this.subscribeToNextSource(),this.unsubscribe()},t.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},t.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();if(e){var t=new i.IY(this),n=this.destination;n.add(t);var r=(0,i.ft)(e,t);r!==t&&n.add(r)}else this.destination.complete()},t}(i.Ds);function Yt(){return function(e){return e.lift(new Qt)}}var Qt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Jt(e))},e}(),Jt=function(e){function t(t){var n=e.call(this,t)||this;return n.hasPrev=!1,n}return r.ZT(t,e),t.prototype._next=function(e){var t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)},t}(f.L),en=n(8463);function tn(e,t){return function(n){return[(0,Be.h)(e,t)(n),(0,Be.h)((0,en.f)(e,t))(n)]}}function nn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(t){return(0,Ye.U)(rn(e,n))(t)}}function rn(e,t){return function(n){for(var r=n,i=0;i<t;i++){var s=null!=r?r[e[i]]:void 0;if(void 0===s)return;r=s}return r}}var sn=n(211);function an(e){return e?jt((function(){return new sn.xQ}),e):jt(new sn.xQ)}var on=n(9233);function un(e){return function(t){return jt(new on.X(e))(t)}}var cn=n(364);function ln(){return function(e){return jt(new cn.c)(e)}}var hn=n(2630);function pn(e,t,n,r){n&&"function"!=typeof n&&(r=n);var i="function"==typeof n?n:void 0,s=new hn.t(e,t,r);return function(e){return jt((function(){return s}),i)(e)}}var dn=n(8821);function fn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return 1===e.length&&(0,V.k)(e[0])&&(e=e[0]),t.lift.call(dn.S3.apply(void 0,[t].concat(e)))}}function mn(e){return void 0===e&&(e=-1),function(t){return 0===e?(0,Me.c)():e<0?t.lift(new gn(-1,t)):t.lift(new gn(e-1,t))}}var gn=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new yn(e,this.count,this.source))},e}(),yn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return r.ZT(t,e),t.prototype.complete=function(){if(!this.isStopped){var t=this.source,n=this.count;if(0===n)return e.prototype.complete.call(this);n>-1&&(this.count=n-1),t.subscribe(this._unsubscribeAndRecycle())}},t}(f.L);function vn(e){return function(t){return t.lift(new bn(e))}}var bn=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new xn(e,this.notifier,t))},e}(),xn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i.sourceIsBeingSubscribedTo=!0,i}return r.ZT(t,e),t.prototype.notifyNext=function(){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},t.prototype.notifyComplete=function(){if(!1===this.sourceIsBeingSubscribedTo)return e.prototype.complete.call(this)},t.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return e.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next(void 0)}},t.prototype._unsubscribe=function(){var e=this.notifications,t=this.retriesSubscription;e&&(e.unsubscribe(),this.notifications=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype._unsubscribeAndRecycle=function(){var t=this._unsubscribe;return this._unsubscribe=null,e.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=t,this},t.prototype.subscribeToRetries=function(){var t;this.notifications=new sn.xQ;try{t=(0,this.notifier)(this.notifications)}catch(t){return e.prototype.complete.call(this)}this.retries=t,this.retriesSubscription=(0,i.ft)(t,new i.IY(this))},t}(i.Ds);function wn(e){return void 0===e&&(e=-1),function(t){return t.lift(new Sn(e,t))}}var Sn=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Tn(e,this.count,this.source))},e}(),Tn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return r.ZT(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return e.prototype.error.call(this,t);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(f.L);function Cn(e){return function(t){return t.lift(new An(e,t))}}var An=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new _n(e,this.notifier,this.source))},e}(),_n=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i}return r.ZT(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,s=this.retriesSubscription;if(r)this.errors=void 0,this.retriesSubscription=void 0;else{n=new sn.xQ;try{r=(0,this.notifier)(n)}catch(t){return e.prototype.error.call(this,t)}s=(0,i.ft)(r,new i.IY(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=s,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(i.Ds),kn=n(3018);function In(e){return function(t){return t.lift(new En(e))}}var En=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new On(e),r=t.subscribe(n);return r.add((0,i.ft)(this.notifier,new i.IY(n))),r},e}(),On=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasValue=!1,t}return r.ZT(t,e),t.prototype._next=function(e){this.value=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},t}(i.Ds);function Dn(e,t){return void 0===t&&(t=u.P),function(n){return n.lift(new Bn(e,t))}}var Bn=function(){function e(e,t){this.period=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Pn(e,this.period,this.scheduler))},e}(),Pn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.period=n,i.scheduler=r,i.hasValue=!1,i.add(r.schedule(Fn,n,{subscriber:i,period:n})),i}return r.ZT(t,e),t.prototype._next=function(e){this.lastValue=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},t}(f.L);function Fn(e){var t=e.subscriber,n=e.period;t.notifyNext(),this.schedule(e,n)}function Nn(e,t){return function(n){return n.lift(new Rn(e,t))}}var Rn=function(){function e(e,t){this.compareTo=e,this.comparator=t}return e.prototype.call=function(e,t){return t.subscribe(new Ln(e,this.compareTo,this.comparator))},e}(),Ln=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.compareTo=n,i.comparator=r,i._a=[],i._b=[],i._oneComplete=!1,i.destination.add(n.subscribe(new Mn(t,i))),i}return r.ZT(t,e),t.prototype._next=function(e){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(e),this.checkValues())},t.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},t.prototype.checkValues=function(){for(var e=this,t=e._a,n=e._b,r=e.comparator;t.length>0&&n.length>0;){var i=t.shift(),s=n.shift(),a=!1;try{a=r?r(i,s):i===s}catch(e){this.destination.error(e)}a||this.emit(!1)}},t.prototype.emit=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype.nextB=function(e){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(e),this.checkValues())},t.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},t}(f.L),Mn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.parent=n,r}return r.ZT(t,e),t.prototype._next=function(e){this.parent.nextB(e)},t.prototype._error=function(e){this.parent.error(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},t}(f.L);function zn(){return new sn.xQ}function $n(){return function(e){return(0,kn.x)()(jt(zn)(e))}}function Vn(e,t,n){var r;return r=e&&"object"==typeof e?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n},function(e){return e.lift(function(e){var t,n,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,s=e.windowTime,a=void 0===s?Number.POSITIVE_INFINITY:s,o=e.refCount,u=e.scheduler,c=0,l=!1,h=!1;return function(e){var r;c++,!t||l?(l=!1,t=new hn.t(i,a,u),r=t.subscribe(this),n=e.subscribe({next:function(e){t.next(e)},error:function(e){l=!0,t.error(e)},complete:function(){h=!0,n=void 0,t.complete()}}),h&&(n=void 0)):r=t.subscribe(this),this.add((function(){c--,r.unsubscribe(),r=void 0,n&&!h&&o&&0===c&&(n.unsubscribe(),n=void 0,t=void 0)}))}}(r))}}function Gn(e){return function(t){return t.lift(new Un(e,t))}}var Un=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Kn(e,this.predicate,this.source))},e}(),Kn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.seenValue=!1,i.index=0,i}return r.ZT(t,e),t.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)},t.prototype._next=function(e){var t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)},t.prototype.tryNext=function(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new Pe.K)},t}(f.L);function jn(e){return function(t){return t.lift(new Wn(e))}}var Wn=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new Hn(e,this.total))},e}(),Hn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return r.ZT(t,e),t.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},t}(f.L);function qn(e){return function(t){return t.lift(new Xn(e))}}var Xn=function(){function e(e){if(this._skipCount=e,this._skipCount<0)throw new De.W}return e.prototype.call=function(e,t){return 0===this._skipCount?t.subscribe(new f.L(e)):t.subscribe(new Zn(e,this._skipCount))},e}(),Zn=function(e){function t(t,n){var r=e.call(this,t)||this;return r._skipCount=n,r._count=0,r._ring=new Array(n),r}return r.ZT(t,e),t.prototype._next=function(e){var t=this._skipCount,n=this._count++;if(n<t)this._ring[n]=e;else{var r=n%t,i=this._ring,s=i[r];i[r]=e,this.destination.next(s)}},t}(f.L);function Yn(e){return function(t){return t.lift(new Qn(e))}}var Qn=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new Jn(e,this.notifier))},e}(),Jn=function(e){function t(t,n){var r=e.call(this,t)||this;r.hasValue=!1;var s=new i.IY(r);r.add(s),r.innerSubscription=s;var a=(0,i.ft)(n,s);return a!==s&&(r.add(a),r.innerSubscription=a),r}return r.ZT(t,e),t.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},t.prototype.notifyNext=function(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},t.prototype.notifyComplete=function(){},t}(i.Ds);function er(e){return function(t){return t.lift(new tr(e))}}var tr=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new nr(e,this.predicate))},e}(),nr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.predicate=n,r.skipping=!0,r.index=0,r}return r.ZT(t,e),t.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},t.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(e){this.destination.error(e)}},t}(f.L);function rr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return(0,b.K)(n)?(e.pop(),function(t){return(0,K.z)(e,t,n)}):function(t){return(0,K.z)(e,t)}}var ir=n(6650),sr=n(5812),ar=function(e){function t(t,n,r){void 0===n&&(n=0),void 0===r&&(r=ir.e);var i=e.call(this)||this;return i.source=t,i.delayTime=n,i.scheduler=r,(!(0,sr.k)(n)||n<0)&&(i.delayTime=0),r&&"function"==typeof r.schedule||(i.scheduler=ir.e),i}return r.ZT(t,e),t.create=function(e,n,r){return void 0===n&&(n=0),void 0===r&&(r=ir.e),new t(e,n,r)},t.dispatch=function(e){var t=e.source,n=e.subscriber;return this.add(t.subscribe(n))},t.prototype._subscribe=function(e){var n=this.delayTime,r=this.source;return this.scheduler.schedule(t.dispatch,n,{source:r,subscriber:e})},t}(me.y);function or(e,t){return void 0===t&&(t=0),function(n){return n.lift(new ur(e,t))}}var ur=function(){function e(e,t){this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return new ar(t,this.delay,this.scheduler).subscribe(e)},e}();function cr(e,t){return"function"==typeof t?function(n){return n.pipe(cr((function(n,r){return(0,G.D)(e(n,r)).pipe((0,Ye.U)((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new lr(e))}}var lr=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new hr(e,this.project))},e}(),hr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.index=0,r}return r.ZT(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this._innerSub(t)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe();var n=new i.IY(this),r=this.destination;r.add(n),this.innerSubscription=(0,i.ft)(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(i.Ds);function pr(){return cr(ht.y)}function dr(e,t){return t?cr((function(){return e}),t):cr((function(){return e}))}function fr(e){return function(t){return t.lift(new mr(e))}}var mr=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new gr(e),r=(0,i.ft)(this.notifier,new i.IY(n));return r&&!n.seenValue?(n.add(r),t.subscribe(n)):n},e}(),gr=function(e){function t(t){var n=e.call(this,t)||this;return n.seenValue=!1,n}return r.ZT(t,e),t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(i.Ds);function yr(e,t){return void 0===t&&(t=!1),function(n){return n.lift(new vr(e,t))}}var vr=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new br(e,this.predicate,this.inclusive))},e}(),br=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.inclusive=r,i.index=0,i}return r.ZT(t,e),t.prototype._next=function(e){var t,n=this.destination;try{t=this.predicate(e,this.index++)}catch(e){return void n.error(e)}this.nextOrComplete(e,t)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;Boolean(t)?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(f.L),xr=n(3306),wr=n(4156);function Sr(e,t,n){return function(r){return r.lift(new Tr(e,t,n))}}var Tr=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new Cr(e,this.nextOrObserver,this.error,this.complete))},e}(),Cr=function(e){function t(t,n,r,i){var s=e.call(this,t)||this;return s._tapNext=xr.Z,s._tapError=xr.Z,s._tapComplete=xr.Z,s._tapError=r||xr.Z,s._tapComplete=i||xr.Z,(0,wr.m)(n)?(s._context=s,s._tapNext=n):n&&(s._context=n,s._tapNext=n.next||xr.Z,s._tapError=n.error||xr.Z,s._tapComplete=n.complete||xr.Z),s}return r.ZT(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(f.L),Ar={leading:!0,trailing:!1};function _r(e,t){return void 0===t&&(t=Ar),function(n){return n.lift(new kr(e,!!t.leading,!!t.trailing))}}var kr=function(){function e(e,t,n){this.durationSelector=e,this.leading=t,this.trailing=n}return e.prototype.call=function(e,t){return t.subscribe(new Ir(e,this.durationSelector,this.leading,this.trailing))},e}(),Ir=function(e){function t(t,n,r,i){var s=e.call(this,t)||this;return s.destination=t,s.durationSelector=n,s._leading=r,s._trailing=i,s._hasValue=!1,s}return r.ZT(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._hasValue,t=this._sendValue;e&&(this.destination.next(t),this.throttle(t)),this._hasValue=!1,this._sendValue=void 0},t.prototype.throttle=function(e){var t=this.tryDurationSelector(e);t&&this.add(this._throttled=(0,i.ft)(t,new i.IY(this)))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=void 0,t&&this.send()},t.prototype.notifyNext=function(){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()},t}(i.Ds);function Er(e,t,n){return void 0===t&&(t=u.P),void 0===n&&(n=Ar),function(r){return r.lift(new Or(e,t,n.leading,n.trailing))}}var Or=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new Dr(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),Dr=function(e){function t(t,n,r,i,s){var a=e.call(this,t)||this;return a.duration=n,a.scheduler=r,a.leading=i,a.trailing=s,a._hasTrailingValue=!1,a._trailingValue=null,a}return r.ZT(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Br,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(f.L);function Br(e){e.subscriber.clearThrottle()}var Pr=n(1410);function Fr(e){return void 0===e&&(e=u.P),function(t){return(0,Pr.P)((function(){return t.pipe(Ot((function(t,n){var r=t.current;return{value:n,current:e.now(),last:r}}),{current:e.now(),value:void 0,last:void 0}),(0,Ye.U)((function(e){var t=e.current,n=e.last,r=e.value;return new Nr(r,t-n)})))}))}}var Nr=function(){return function(e,t){this.value=e,this.interval=t}}(),Rr=n(1462);function Lr(e,t,n){return void 0===n&&(n=u.P),function(r){var i=ce(e),s=i?+e-n.now():Math.abs(e);return r.lift(new Mr(s,i,t,n))}}var Mr=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new zr(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),zr=function(e){function t(t,n,r,i,s){var a=e.call(this,t)||this;return a.absoluteTimeout=n,a.waitFor=r,a.withObservable=i,a.scheduler=s,a.scheduleTimeout(),a}return r.ZT(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add((0,i.ft)(t,new i.IY(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},t}(i.Ds),$r=n(4944);function Vr(e,t){return void 0===t&&(t=u.P),Lr(e,(0,$r._)(new Rr.W),t)}function Gr(e){return void 0===e&&(e=u.P),(0,Ye.U)((function(t){return new Ur(t,e.now())}))}var Ur=function(){return function(e,t){this.value=e,this.timestamp=t}}();function Kr(e,t,n){return 0===n?[t]:(e.push(t),e)}function jr(){return Ft(Kr,[])}function Wr(e){return function(t){return t.lift(new Hr(e))}}var Hr=function(){function e(e){this.windowBoundaries=e}return e.prototype.call=function(e,t){var n=new qr(e),r=t.subscribe(n);return r.closed||n.add((0,i.ft)(this.windowBoundaries,new i.IY(n))),r},e}(),qr=function(e){function t(t){var n=e.call(this,t)||this;return n.window=new sn.xQ,t.next(n.window),n}return r.ZT(t,e),t.prototype.notifyNext=function(){this.openWindow()},t.prototype.notifyError=function(e){this._error(e)},t.prototype.notifyComplete=function(){this._complete()},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e)},t.prototype._complete=function(){this.window.complete(),this.destination.complete()},t.prototype._unsubscribe=function(){this.window=null},t.prototype.openWindow=function(){var e=this.window;e&&e.complete();var t=this.destination,n=this.window=new sn.xQ;t.next(n)},t}(i.Ds);function Xr(e,t){return void 0===t&&(t=0),function(n){return n.lift(new Zr(e,t))}}var Zr=function(){function e(e,t){this.windowSize=e,this.startWindowEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new Yr(e,this.windowSize,this.startWindowEvery))},e}(),Yr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.destination=t,i.windowSize=n,i.startWindowEvery=r,i.windows=[new sn.xQ],i.count=0,t.next(i.windows[0]),i}return r.ZT(t,e),t.prototype._next=function(e){for(var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,s=i.length,a=0;a<s&&!this.closed;a++)i[a].next(e);var o=this.count-r+1;if(o>=0&&o%t==0&&!this.closed&&i.shift().complete(),++this.count%t==0&&!this.closed){var u=new sn.xQ;i.push(u),n.next(u)}},t.prototype._error=function(e){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()},t.prototype._unsubscribe=function(){this.count=0,this.windows=null},t}(f.L);function Qr(e){var t=u.P,n=null,r=Number.POSITIVE_INFINITY;return(0,b.K)(arguments[3])&&(t=arguments[3]),(0,b.K)(arguments[2])?t=arguments[2]:(0,sr.k)(arguments[2])&&(r=Number(arguments[2])),(0,b.K)(arguments[1])?t=arguments[1]:(0,sr.k)(arguments[1])&&(n=Number(arguments[1])),function(i){return i.lift(new Jr(e,n,r,t))}}var Jr=function(){function e(e,t,n,r){this.windowTimeSpan=e,this.windowCreationInterval=t,this.maxWindowSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new ti(e,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},e}(),ei=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._numberOfNextedValues=0,t}return r.ZT(t,e),t.prototype.next=function(t){this._numberOfNextedValues++,e.prototype.next.call(this,t)},Object.defineProperty(t.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),t}(sn.xQ),ti=function(e){function t(t,n,r,i,s){var a=e.call(this,t)||this;a.destination=t,a.windowTimeSpan=n,a.windowCreationInterval=r,a.maxWindowSize=i,a.scheduler=s,a.windows=[];var o=a.openWindow();if(null!==r&&r>=0){var u={subscriber:a,window:o,context:null},c={windowTimeSpan:n,windowCreationInterval:r,subscriber:a,scheduler:s};a.add(s.schedule(ii,n,u)),a.add(s.schedule(ri,r,c))}else{var l={subscriber:a,window:o,windowTimeSpan:n};a.add(s.schedule(ni,n,l))}return a}return r.ZT(t,e),t.prototype._next=function(e){for(var t=this.windows,n=t.length,r=0;r<n;r++){var i=t[r];i.closed||(i.next(e),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},t.prototype._error=function(e){for(var t=this.windows;t.length>0;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){for(var e=this.windows;e.length>0;){var t=e.shift();t.closed||t.complete()}this.destination.complete()},t.prototype.openWindow=function(){var e=new ei;return this.windows.push(e),this.destination.next(e),e},t.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)},t}(f.L);function ni(e){var t=e.subscriber,n=e.windowTimeSpan,r=e.window;r&&t.closeWindow(r),e.window=t.openWindow(),this.schedule(e,n)}function ri(e){var t=e.windowTimeSpan,n=e.subscriber,r=e.scheduler,i=e.windowCreationInterval,s=n.openWindow(),a=this,o={action:a,subscription:null},u={subscriber:n,window:s,context:o};o.subscription=r.schedule(ii,t,u),a.add(o.subscription),a.schedule(e,i)}function ii(e){var t=e.subscriber,n=e.window,r=e.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),t.closeWindow(n)}function si(e,t){return function(n){return n.lift(new ai(e,t))}}var ai=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new oi(e,this.openings,this.closingSelector))},e}(),oi=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=(0,I.D)(i,n,n)),i}return r.ZT(t,e),t.prototype._next=function(e){var t=this.contexts;if(t)for(var n=t.length,r=0;r<n;r++)t[r].window.next(e)},t.prototype._error=function(t){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var s=n[i];s.window.error(t),s.subscription.unsubscribe()}e.prototype._error.call(this,t)},t.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var n=t.length,r=-1;++r<n;){var i=t[r];i.window.complete(),i.subscription.unsubscribe()}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var t=e.length,n=-1;++n<t;){var r=e[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},t.prototype.notifyNext=function(e,t,n,r,i){if(e===this.openings){var s=void 0;try{s=(0,this.closingSelector)(t)}catch(e){return this.error(e)}var a=new sn.xQ,o=new k.w,u={window:a,subscription:o};this.contexts.push(u);var c=(0,I.D)(this,s,u);c.closed?this.closeWindow(this.contexts.length-1):(c.context=u,o.add(c)),this.destination.next(a)}else this.closeWindow(this.contexts.indexOf(e))},t.prototype.notifyError=function(e){this.error(e)},t.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},t.prototype.closeWindow=function(e){if(-1!==e){var t=this.contexts,n=t[e],r=n.window,i=n.subscription;t.splice(e,1),r.complete(),i.unsubscribe()}},t}(E.L);function ui(e){return function(t){return t.lift(new ci(e))}}var ci=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new li(e,this.closingSelector))},e}(),li=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.closingSelector=n,r.openWindow(),r}return r.ZT(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.openWindow(i)},t.prototype.notifyError=function(e){this._error(e)},t.prototype.notifyComplete=function(e){this.openWindow(e)},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()},t.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},t.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},t.prototype.openWindow=function(e){void 0===e&&(e=null),e&&(this.remove(e),e.unsubscribe());var t=this.window;t&&t.complete();var n,r=this.window=new sn.xQ;this.destination.next(r);try{n=(0,this.closingSelector)()}catch(e){return this.destination.error(e),void this.window.error(e)}this.add(this.closingNotification=(0,I.D)(this,n))},t}(E.L);function hi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;"function"==typeof e[e.length-1]&&(n=e.pop());var r=e;return t.lift(new pi(r,n))}}var pi=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new di(e,this.observables,this.project))},e}(),di=function(e){function t(t,n,r){var i=e.call(this,t)||this;i.observables=n,i.project=r,i.toRespond=[];var s=n.length;i.values=new Array(s);for(var a=0;a<s;a++)i.toRespond.push(a);for(a=0;a<s;a++){var o=n[a];i.add((0,I.D)(i,o,void 0,a))}return i}return r.ZT(t,e),t.prototype.notifyNext=function(e,t,n){this.values[n]=t;var r=this.toRespond;if(r.length>0){var i=r.indexOf(n);-1!==i&&r.splice(i,1)}},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(E.L),fi=n(5080);function mi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(fi.$R.apply(void 0,[t].concat(e)))}}function gi(e){return function(t){return t.lift(new fi.mx(e))}}},5987:(e,t,n)=>{"use strict";n.d(t,{ZT:()=>i});var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}},9126:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(969))},8111:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(5624))},173:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(6097))},2068:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(1709))},904:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(3895))},8120:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(6740))},9890:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(698))},1301:(e,t,n)=>{var r=n(7187).EventEmitter;function i(e,t,n,r,i){for(var s=0;s<i;++s,++t,++r)if(e[t]!==n[r])return!1;return!0}function s(e){"string"==typeof e&&(e=new Buffer(e));var t,n,r=e.length;for(this.maxMatches=1/0,this.matches=0,this._occ=new Array(256),this._lookbehind_size=0,this._needle=e,this._bufpos=0,this._lookbehind=new Buffer(r),n=0;n<256;++n)this._occ[n]=r;if(r>=1)for(t=0;t<r-1;++t)this._occ[e[t]]=r-1-t}(0,n(9539).inherits)(s,r),s.prototype.reset=function(){this._lookbehind_size=0,this.matches=0,this._bufpos=0},s.prototype.push=function(e,t){var n,r;for(Buffer.isBuffer(e)||(e=new Buffer(e,"binary")),r=e.length,this._bufpos=t||0;n!==r&&this.matches<this.maxMatches;)n=this._sbmh_feed(e);return n},s.prototype._sbmh_feed=function(e){var t=e.length,n=this._needle,r=n.length,s=-this._lookbehind_size,a=n[r-1],o=this._occ,u=this._lookbehind;if(s<0){for(;s<0&&s<=t-r;){if((l=this._sbmh_lookup_char(e,s+r-1))===a&&this._sbmh_memcmp(e,s,r-1))return this._lookbehind_size=0,++this.matches,s>-this._lookbehind_size?this.emit("info",!0,u,0,this._lookbehind_size+s):this.emit("info",!0),this._bufpos=s+r,s+r;s+=o[l]}if(s<0)for(;s<0&&!this._sbmh_memcmp(e,s,t-s);)s++;if(!(s>=0)){var c=this._lookbehind_size+s;return c>0&&this.emit("info",!1,u,0,c),u.copy(u,0,c,this._lookbehind_size-c),this._lookbehind_size-=c,e.copy(u,this._lookbehind_size),this._lookbehind_size+=t,this._bufpos=t,t}this.emit("info",!1,u,0,this._lookbehind_size),this._lookbehind_size=0}for(s>=0&&(s+=this._bufpos);s<=t-r;){var l;if((l=e[s+r-1])===a&&e[s]===n[0]&&i(n,0,e,s,r-1))return++this.matches,s>0?this.emit("info",!0,e,this._bufpos,s):this.emit("info",!0),this._bufpos=s+r,s+r;s+=o[l]}if(s<t){for(;s<t&&(e[s]!==n[0]||!i(e,s,n,0,t-s));)++s;s<t&&(e.copy(u,0,s,s+(t-s)),this._lookbehind_size=t-s)}return s>0&&this.emit("info",!1,e,this._bufpos,s<t?s:t),this._bufpos=t,t},s.prototype._sbmh_lookup_char=function(e,t){return t<0?this._lookbehind[this._lookbehind_size+t]:e[t]},s.prototype._sbmh_memcmp=function(e,t,n){for(var r=0;r<n;){if(this._sbmh_lookup_char(e,t+r)!==this._needle[r])return!1;++r}return!0},e.exports=s},1496:e=>{"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},384:e=>{e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},9539:(e,t,n)=>{var r=n(4155),i=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},s=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(u(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,a=String(e).replace(s,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),o=r[n];n<i;o=r[++n])g(o)||!w(o)?a+=" "+o:a+=" "+u(o);return a},t.deprecate=function(e,n){if(void 0!==r&&!0===r.noDeprecation)return e;if(void 0===r)return function(){return t.deprecate(e,n).apply(this,arguments)};var i=!1;return function(){if(!i){if(r.throwDeprecation)throw new Error(n);r.traceDeprecation?console.trace(n):console.error(n),i=!0}return e.apply(this,arguments)}};var a,o={};function u(e,n){var r={seen:[],stylize:l};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),m(n)?r.showHidden=n:n&&t._extend(r,n),b(r.showHidden)&&(r.showHidden=!1),b(r.depth)&&(r.depth=2),b(r.colors)&&(r.colors=!1),b(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),h(r,e,r.depth)}function c(e,t){var n=u.styles[t];return n?"["+u.colors[n][0]+"m"+e+"["+u.colors[n][1]+"m":e}function l(e,t){return e}function h(e,n,r){if(e.customInspect&&n&&C(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return v(i)||(i=h(e,i,r)),i}var s=function(e,t){if(b(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return y(t)?e.stylize(""+t,"number"):m(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}(e,n);if(s)return s;var a=Object.keys(n),o=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(n)),T(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return p(n);if(0===a.length){if(C(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(x(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(S(n))return e.stylize(Date.prototype.toString.call(n),"date");if(T(n))return p(n)}var c,l="",w=!1,A=["{","}"];return f(n)&&(w=!0,A=["[","]"]),C(n)&&(l=" [Function"+(n.name?": "+n.name:"")+"]"),x(n)&&(l=" "+RegExp.prototype.toString.call(n)),S(n)&&(l=" "+Date.prototype.toUTCString.call(n)),T(n)&&(l=" "+p(n)),0!==a.length||w&&0!=n.length?r<0?x(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=w?function(e,t,n,r,i){for(var s=[],a=0,o=t.length;a<o;++a)E(t,String(a))?s.push(d(e,t,n,r,String(a),!0)):s.push("");return i.forEach((function(i){i.match(/^\d+$/)||s.push(d(e,t,n,r,i,!0))})),s}(e,n,r,o,a):a.map((function(t){return d(e,n,r,o,t,w)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(c,l,A)):A[0]+l+A[1]}function p(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,i,s){var a,o,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?o=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(o=e.stylize("[Setter]","special")),E(r,i)||(a="["+i+"]"),o||(e.seen.indexOf(u.value)<0?(o=g(n)?h(e,u.value,null):h(e,u.value,n-1)).indexOf("\n")>-1&&(o=s?o.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+o.split("\n").map((function(e){return"   "+e})).join("\n")):o=e.stylize("[Circular]","special")),b(a)){if(s&&i.match(/^\d+$/))return o;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+o}function f(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function g(e){return null===e}function y(e){return"number"==typeof e}function v(e){return"string"==typeof e}function b(e){return void 0===e}function x(e){return w(e)&&"[object RegExp]"===A(e)}function w(e){return"object"==typeof e&&null!==e}function S(e){return w(e)&&"[object Date]"===A(e)}function T(e){return w(e)&&("[object Error]"===A(e)||e instanceof Error)}function C(e){return"function"==typeof e}function A(e){return Object.prototype.toString.call(e)}function _(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(b(a)&&(a=r.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var n=r.pid;o[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else o[e]=function(){};return o[e]},t.inspect=u,u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=m,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=y,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=b,t.isRegExp=x,t.isObject=w,t.isDate=S,t.isError=T,t.isFunction=C,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(384);var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(){var e=new Date,t=[_(e.getHours()),_(e.getMinutes()),_(e.getSeconds())].join(":");return[e.getDate(),k[e.getMonth()],t].join(" ")}function E(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",I(),t.format.apply(t,arguments))},t.inherits=n(1496),t._extend=function(e,t){if(!t||!w(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var O="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function D(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(O&&e[O]){var t;if("function"!=typeof(t=e[O]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,O,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),i=[],s=0;s<arguments.length;s++)i.push(arguments[s]);i.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),O&&Object.defineProperty(t,O,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,i(e))},t.promisify.custom=O,t.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);var i=t.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var s=this,a=function(){return i.apply(s,arguments)};e.apply(this,t).then((function(e){r.nextTick(a,null,e)}),(function(e){r.nextTick(D,e,a)}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,i(e)),t}},4763:e=>{e.exports=Worker}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{Session:()=>Jr,addWorker:()=>ci,postToWorker:()=>li,workerResponses:()=>ii,workerThreadrot:()=>oi,workerThreads:()=>ai,workers:()=>si});var e,t=n(4763),i=n.n(t),s=n(9985);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return Math.sqrt(e*e+t*t)}function u(e,t){for(var n=0,r=0;r<t;r++)n+=e[r];return n/t}function c(e,t,n){for(var r=0,i=0;i<n;i++)r+=(e[i]-t)*(e[i]-t);return Math.sqrt(r)}function l(e,t,n,r,i,s,a,o){for(var u=0,c=0;c<a;c++){var l=c+o,h=0;l<a&&(h=r[l]),u+=(e[c]-t)*(h-i)}return u/(n*s)}function h(e,t,n){for(var r=0,i=0,s=1/t,a=6.28318530718*n*s,o=0;o<t;o++){var u=a*o;r+=e[o]*Math.cos(u),i-=e[o]*Math.sin(u)}return[r*s,i*s]}function p(e,t,n,r){for(var i=0,s=0,a=1/t,o=6.28318530718*n*a,u=0;u<t;u++){var c=o*u;i+=e[u+(t-1)*r]*Math.cos(c),s-=e[u+(t-1)*r]*Math.sin(c)}return[i*a,s*a]}function d(e,t,n,r){var i=0,s=0,a=6.28318530718*n*(1/t),o=1,u=0,c=.25*r;if(n<=c)for(;n<=c;)c*=.5,o+=1;for(var l=0;l<t;l+=o){var h=l;h>t&&(h=t);var p=a*h;i+=e[h]*Math.cos(p),s-=e[h]*Math.sin(p),u+=1}return[i/u,s/u]}function f(e,t,n,r,i){var s=0,a=0,o=6.28318530718*n*(1/t),u=1,c=0,l=.25*i;if(n<=l)for(;n<=l;)l*=.5,u+=1;for(var h=0;h<t;h+=u){var p=h;p>t&&(p=t);var d=o*p;s+=e[p+(t-1)*r]*Math.cos(d),a-=e[p+(t-1)*r]*Math.sin(d),c+=1}return[s/c,a/c]}function m(e,t,n){for(var r=0,i=0,s=1/t,a=6.28318530718*n*s,o=0;o<t;o++){var u=a*o;r+=e[o]*Math.cos(u),i=e[o]*Math.sin(u)-i}return[r*s,i*s]}function g(e,t,n,r){for(var i=0,s=0,a=1/t,o=6.28318530718*n*a,u=0;u<t;u++){var c=o*u;i+=e[u+(t-1)*r]*Math.cos(c),s=e[u+(t-1)*r]*Math.sin(c)-s}return[i*a,s*a]}function y(e,t,n,r){var i=0,s=0,a=6.28318530718*n*(1/t),o=1,u=0,c=.25*r;if(n<=c)for(;n<=c;)c*=.5,o+=1;for(var l=0;l<t;l+=o){var h=l;h>t&&(h=t);var p=a*h;i+=e[h]*Math.cos(p),s=e[h]*Math.sin(p)-s,u+=1}return[i/u,s/u]}function v(e,t,n,r,i){for(var s=2*i+1,a=0,o=0,u=0,c=-i;c<=i;)if(this.thread.x+c<0||this.thread.x+c>=t)c++;else{for(var l=-i;l<=i;)if(this.thread.y+l<0||this.thread.y+l>=n)l++;else{var h=r[(l+i)*s+c+i],p=e[this.thread.y+c][this.thread.x+l];a+=p.r*h,o+=p.g*h,u+=p.b*h,l++}c++}this.color(a,o,u)}function b(e,t,n,r){var i=d(e,t,this.thread.x,r);return o(i[0],i[1])*n}function x(e,t,n,r){var i=y(e,t,this.thread.x,r);return o(i[0],i[1])*n}var w=(a(e={correlogramsKern:function(e,t){var n=2*Math.floor(this.thread.x/t),r=this.thread.x-Math.floor(this.thread.x/t)*t,i=u(e[n],t),s=u(e[n+1],t),a=c(e[n],i,t),o=c(e[n+1],s,t);return l(e[n],i,a,e[n+1],s,o,t,r)},correlogramsPCKern:function(e,t,n,r){var i=2*Math.floor(this.thread.x/t),s=this.thread.x-Math.floor(this.thread.x/t)*t,a=n[i],o=n[i+1],u=r[i],c=r[i+1];return l(e[i],a,u,e[i+1],o,c,t,s)},dftKern:function(e,t,n){var r=h(e,t,this.thread.x);return o(r[0],r[1])*n},idftKern:function(e,t,n){var r=m(e,t,this.thread.x);return o(r[0],r[1])*n},fftKern:b,ifftKern:x,dft_windowedKern:function(e,t,n,r,i){var s;return o((s=h(e,t,this.thread.x/t*(r-n)+n))[0],s[1])*i},idft_windowedKern:function(e,t,n,r,i){var s;return o((s=m(e,t,this.thread.x/t*(r-n)+n))[0],s[1])*i},fft_windowedKern:function(e,t,n,r,i){var s;return o((s=d(e,t,this.thread.x/t*(r-n)+n))[0],s[1])*i},ifft_windowedKern:function(e,t,n,r,i){var s;return o((s=y(e,t,this.thread.x/t*(r-n)+n))[0],s[1])*i},listdft2DKern:function(e,t){var n=this.output.x,r=h(e[this.thread.y],n,this.thread.x);return o(r[0],r[1])*t},listdft1DKern:function(e,t,n){var r=[0,0];if(this.thread.x<=t)r=h(e,t,this.thread.x);else{var i=Math.floor(this.thread.x/t);r=p(e,t,this.thread.x-i*t,i)}return o(r[0],r[1])*n},listfft1DKern:function(e,t,n,r){var i=[0,0];if(this.thread.x<=t)i=d(e,t,this.thread.x,r);else{var s=Math.floor(this.thread.x/t);i=f(e,t,this.thread.x-s*t,s,r)}return o(i[0],i[1])*n},listfft1D_windowedKern:function(e,t,n,r,i){var s=[0,0];if(this.thread.x<t)s=d(e,t,this.thread.x/t*(r-n)+n,t);else{var a=Math.floor(this.thread.x/t);s=f(e,t,(this.thread.x-a*t)/t*(r-n)+n-a*t,a,t)}return o(s[0],s[1])*i},listdft1D_windowedKern:function(e,t,n,r,i){var s=[0,0];if(this.thread.x<t)s=h(e,t,this.thread.x/t*(r-n)+n);else{var a=Math.floor(this.thread.x/t);s=p(e,t,(this.thread.x-a*t)/t*(r-n)+n-a*t,a)}return o(s[0],s[1])*i},listidft1D_windowedKern:function(e,t,n,r,i){var s=[0,0];if(this.thread.x<t)s=m(e,t,this.thread.x/t*(r-n)+n);else{var a=Math.floor(this.thread.x/t);s=g(e,t,(this.thread.x-a*t)/t*(r-n)+n-a*t,a)}return o(2*s[0],2*s[1])*i},bulkArrayMulKern:function(e,t,n,r){for(var i=e[n*Math.floor(this.thread.x/t)][this.thread.x],s=0;s<n;s++)i*=e[s][this.thread.x];return i*r}},"fftKern",b),a(e,"ifftKern",x),a(e,"multiImgConv2DKern",(function(e,t,n,r,i,s,a){for(var o=0;o<s;o++){var u=i[o],c=(Math.sqrt(u)-1)/2;v(e,t,n,r[o],c)}if(0===a)return[this.color.r,this.color.g,this.color.b]})),e),S=[function(e,t){return e+t},function(e,t){return e-t},function(e,t){return e*t},function(e,t){return e/t},function(e,t,n,r){return[e+n,t+r]},function(e,t,n,r){return[e-n,t-r]},function(e,t,n,r){return[e*n-t*r,e*r+t*n]},function(e,t){var n=Math.exp(e);return[n*Math.cos(t),n*Math.sin(t)]},o,function(e){return 0-e},function(e){for(var t=Math.sqrt(e),n=3;n<=t;){if(e%n==0)return n;n+=2}},u,c,function(e,t,n){for(var r=0,i=0,s=0;s<n;s++)r+=(i=e[s]-t)*i;return r/n},function(e,t,n){for(var r=0,i=0,s=0;s<n;s++)r+=(i=e[s]-t)*i;return Math.sqrt(r/n)},l,function(e,t,n){for(var r=0,i=0;i<t;i++)r+=Math.exp(e[i]);return Math.exp(e[n])/r},h,p,m,g,d,y,v];function T(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{setDynamicOutput:!0,setDynamicArguments:!0,setPipeline:!0,setImmutable:!0},r=e.createKernel(t);return n.setDynamicOutput&&r.setDynamicOutput(!0),n.setDynamicArguments&&r.setDynamicArguments(!0),n.setPipeline&&r.setPipeline(!0),n.setImmutable&&r.setImmutable(!0),r}var E=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s.GPU;A(this,e),this.gpu=t,this.kernel,this.PI=3.141592653589793,this.SQRT1_2=.7071067811865476,this.addFunctions(),this.imgkernels={edgeDetection:[-1,-1,-1,-1,8,-1,-1,-1,-1],boxBlur:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],sobelLeft:[1,0,-1,2,0,-2,1,0,-1],sobelRight:[-1,0,1,-2,0,2,-1,0,1],sobelTop:[1,2,1,0,0,0,-1,-2,-1],sobelBottom:[-1,2,1,0,0,0,1,2,1],identity:[0,0,0,0,1,0,0,0,0],gaussian3x3:[1,2,1,2,4,2,1,2,1],guassian7x7:[0,0,0,5,0,0,0,0,5,18,32,18,5,0,0,18,64,100,64,18,0,5,32,100,100,100,32,5,0,18,64,100,64,18,0,0,5,18,32,18,5,0,0,0,0,5,0,0,0],emboss:[-2,-1,0,-1,1,1,0,1,2],sharpen:[0,-1,0,-1,5,-1,0,-1,0]}}var t,n;return t=e,(n=[{key:"addFunctions",value:function(){var e=this;S.forEach((function(t){return e.gpu.addFunction(t)})),this.correlograms=I(this.gpu,w.correlogramsKern),this.correlogramsPC=I(this.gpu,w.correlogramsKern),this.dft=I(this.gpu,w.dftKern),this.idft=I(this.gpu,w.idftKern),this.dft_windowed=I(this.gpu,w.dft_windowedKern),this.idft_windoed=I(this.gpu,w.idft_windowedKern),this.fft=I(this.gpu,w.fftKern),this.ifft=I(this.gpu,w.ifftKern),this.fft_windowed=I(this.gpu,w.fft_windowedKern),this.ifft_windowed=I(this.gpu,w.ifft_windowedKern),this.listdft2D=I(this.gpu,w.listdft2DKern),this.listdft1D=I(this.gpu,w.listdft1DKern),this.listdft1D_windowed=I(this.gpu,w.listdft1D_windowedKern),this.listfft1D=I(this.gpu,w.listfft1DKern),this.listfft1D_windowed=I(this.gpu,w.listfft1D_windowedKern),this.listidft1D_windowed=I(this.gpu,w.listidft1D_windowedKern),this.bulkArrayMul=I(this.gpu,w.bulkArrayMulKern),this.multiConv2D=I(this.gpu,w.multiImgConv2DKern),this.gpuCoherence=function(t,n,r,i,s){var a=e.listdft1D_windowed(t,n,r,i,s,new Array(Math.ceil(t/n)).fill(0));return e.bulkArrayMul(a,n,5,1)}}},{key:"gpuXCors",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!0===n){var i=[],s=[];e.forEach((function(e,t){i.push(e.reduce((function(e,t){return t+e}))/e.length),s.push(Math.sqrt(i[t].reduce((function(e,t){return e+Math.pow(t-mean1,2)}))))}));for(var a=[],o=[],u=[],c=0;c<e.length;c++)for(var l=c;l<e.length;l++){var h;(h=u).push.apply(h,T(e[c]).concat(T(e[l]))),a.push(i[c],i[l]),o.push(s[c],s[l])}this.correlogramsPC.setOutput([u.length]),this.correlogramsPC.setLoopMaxIterations(2*e[0].length),t=this.correlogramsPC(u,e[0].length,a,o)}else{for(u=[],c=0;c<e.length;c++)for(l=c;l<e.length;l++){var p;(p=u).push.apply(p,T(e[c]).concat(T(e[l])))}this.correlograms.setOutput([u.length]),this.correlograms.setLoopMaxIterations(2*e[0].length),t=this.correlograms(u,e[0].length)}if(!0===r)return t;var d=t.toArray();t.delete();var f=[];for(c=0;c<e.length;c++)f.push(d.splice(0,e[0].length));return f}},{key:"gpuDFT",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e.length,s=i/t;this.dft.setOutput([e.length]),this.dft.setLoopMaxIterations(i);var a=this.dft(e,i,n,DCoffset);if(!1===r){var o=this.makeFrequencyDistribution(i,s),u=a.toArray();return a.delete(),[o,this.orderMagnitudes(u)]}var c=a;return a.delete(),c}},{key:"MultiChannelDFT",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=[];e.forEach((function(e){var t;(t=i).push.apply(t,T(e))}));var s=e[0].length,a=s/t;this.listdft1D.setOutput([i.length]),this.listdft1D.setLoopMaxIterations(s);var o=this.listdft1D(i,s,n);if(!1===r){var u=[],c=this.makeFrequencyDistribution(s,a);i=o.toArray();for(var l=0;l<i.length;l+=s)u.push(this.orderMagnitudes(T(i.slice(l,l+s))));return o.delete(),[c,u]}var h=o;return o.delete(),h}},{key:"MultiChannelDFT_Bandpass",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=[];e.forEach((function(e){var t;(t=a).push.apply(t,T(e))}));var o=2*r,u=e[0].length,c=u/t;this.listdft1D_windowed.setOutput([a.length]),this.listdft1D_windowed.setLoopMaxIterations(u);var l=this.listdft1D_windowed(a,c,n,o,i);if(!0===s)return l;a=l.toArray(),l.delete();var h=this.bandPassWindow(n,r,c);return[h,this.orderBPMagnitudes(a,t,c,u)]}},{key:"gpuFFT",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e.length,s=i/t;this.fft.setOutput([e.length]),this.fft.setLoopMaxIterations(i);var a=this.fft(e,i,n,DCoffset);if(!1===r){var o=this.makeFrequencyDistribution(i,s),u=a.toArray();return a.delete(),[o,this.orderMagnitudes(u)]}var c=a;return a.delete(),c}},{key:"MultiChannelFFT",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=[];e.forEach((function(e){var t;(t=i).push.apply(t,T(e))}));var s=e[0].length,a=s/t;this.listfft1D.setOutput([i.length]),this.listfft1D.setLoopMaxIterations(s);var o=this.listfft1D(i,s,n);if(!1===r){var u=[],c=this.makeFrequencyDistribution(s,a);i=o.toArray();for(var l=0;l<i.length;l+=s)u.push(this.orderMagnitudes(T(i.slice(l,l+s))));return o.delete(),[c,u]}var h=o;return o.delete(),h}},{key:"MultiChannelFFT_Bandpass",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=[];e.forEach((function(e){var t;(t=a).push.apply(t,T(e))}));var o=2*r,u=e[0].length,c=u/t;this.listfft1D_windowed.setOutput([a.length]),this.listfft1D_windowed.setLoopMaxIterations(u);var l=this.listfft1D_windowed(a,c,n,o,i);if(!0===s)return l;a=l.toArray(),l.delete();var h=this.bandPassWindow(n,r,c);return[h,this.orderBPMagnitudes(a,t,c,u)]}},{key:"orderMagnitudes",value:function(e){return[].concat(T(e.slice(Math.ceil(.5*e.length),e.length)),T(e.slice(0,Math.ceil(.5*e.length))))}},{key:"makeFrequencyDistribution",value:function(e,t){for(var n=e,r=t/n,i=[],s=-n/2;s<n/2;s++){var a=s*r;i.push(a)}return i}},{key:"orderBPMagnitudes",value:function(e,t,n,r){for(var i=[],s=0;s<e.length;s+=r)i.push(T(e.slice(s,Math.ceil(.5*r+s))));var a=[],o=1/n;return t>1?(i.forEach((function(e,t){a.push([]);for(var r=1/Math.max.apply(Math,T(e)),i=0;i<e.length;i++)if(0==i)a[t]=e.slice(i,Math.floor(n)),i=Math.floor(n);else{var s=i-Math.floor(Math.floor(i*o)*n)-1;a[t][s]=a[t][s]*e[i-1]*r}a[t]=T(a[t].slice(0,Math.ceil(.5*a[t].length)))})),a):i}},{key:"bandPassWindow",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=2*t,s=(i-e)/n,a=[];if(!0===r)for(var o=0;o<Math.ceil(.5*n);o+=s)a.push(e+(i-e)*o/n);else for(o=-Math.ceil(.5*n);o<Math.ceil(.5*n);o+=s)a.push(e+(i-e)*o/n);return a}}])&&_(t.prototype,n),e}();function O(e){return function(e){if(Array.isArray(e))return D(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var P=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"genSineWave",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:512,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=[],o=[],u=1/r,c=0;c<n;c+=u){var l=Math.sin(2*Math.PI*e*c)*t;l+=Math.sin(2*Math.PI*i*c)*s,a.push(l),o.push(c)}return[o,a]}},{key:"mean",value:function(e){return e.reduce((function(e,t){return t+e}))/e.length}},{key:"variance",value:function(e){for(var t=this.mean(e),n=[],r=0;r<e.length;r++)n.push((e[r]-t)/(e.length-1));return n}},{key:"transpose",value:function(e){return e[0].map((function(t,n){return e.map((function(e){return e[n]}))}))}},{key:"matmul",value:function(e,t){for(var n=e.length,r=e[0].length,i=(t.length,t[0].length),s=new Array(n),a=0;a<n;++a){s[a]=new Array(i);for(var o=0;o<i;++o){s[a][o]=0;for(var u=0;u<r;++u)s[a][o]+=e[a][u]*t[u][o]}}return s}},{key:"cov2d",value:function(e){var t=this,n=this.transpose(e),r=[],i=[],s=[];e.forEach((function(e,n){i.push(t.mean(e))})),n.forEach((function(e,n){s.push(t.mean(e))})),e.forEach((function(t,n){r.push([]);for(var a=0;a<t.length;a++)r[n].push((e[n][a]-i[n])*(e[n][a]-s[a])/(t.length-1))})),console.log(r);for(var a=this.transpose(r),o=r.length,u=r[0].length,c=(a.length,a[0].length),l=new Array(o),h=0;h<o;++h){l[h]=new Array(c);for(var p=0;p<c;++p){l[h][p]=0;for(var d=0;d<u;++d)l[h][p]+=r[h][d]*a[d][p]/(e[0].length-1)}}return l}},{key:"cov1d",value:function(e,t){return this.cov2d([e,t])}},{key:"crosscorrelation",value:function(e,t){var n=[].concat(O(t),O(Array(t.length).fill(0))),r=this.mean(e),i=this.mean(t),s=e.reduce((function(e,t){return e+Math.pow(t-r,2)}));s=Math.sqrt(s);for(var a=t.reduce((function(e,t){return e+Math.pow(t-r,2)})),o=1/(s*(a=Math.sqrt(a))),u=new Array(e.length).fill(0),c=0;c<e.length;c++){var l=e.reduce((function(e,t,s){return e+(t-r)*(n[c+s]-i)}));u[c]=l*o}return u}},{key:"autocorrelation",value:function(e){for(var t=[].concat(O(e),O(Array(e.length).fill(0))),n=this.mean(e),r=e.reduce((function(e,t){return e+Math.pow(t-n,2)})),i=1/((r=Math.sqrt(r))*r),s=new Array(e.length).fill(0),a=0;a<e.length;a++){var o=e.reduce((function(e,r,i){return e+(r-n)*(t[a+i]-n)}));s[a]=o*i}return s}},{key:"correlograms",value:function(t){var n=[];return t.forEach((function(r,i){t.forEach((function(t,s){s>=i&&n.push(e.crosscorrelation(r,t))}))})),n}},{key:"sma",value:function(e,t){for(var n=[],r=0;r<e.length;r++)if(0==r)n.push(e[0]);else if(r<t){var i=e.slice(0,r+1);n.push(i.reduce((function(e,t){return t+e}))/(r+1))}else i=e.slice(r-t,r),n.push(i.reduce((function(e,t){return t+e}))/t);return n}},{key:"interpolateArray",value:function(e,t){var n=this.canvas.height/e.length,r=function(e,t,r){return(e+(t-e)*r)*n},i=new Array,s=new Number((e.length-1)/(t-1));i[0]=e[0];for(var a=1;a<t-1;a++){var o=a*s,u=new Number(Math.floor(o)).toFixed(),c=new Number(Math.ceil(o)).toFixed(),l=o-u;i[a]=r(e[u],e[c],l)}return i[t-1]=e[e.length-1],i}},{key:"isExtrema",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"peak",n=O(e);if(e.length>1){var r=!0;return n.forEach((function(e,i){"peak"===t?(i<Math.floor(.5*n.length)&&e>=n[Math.floor(.5*n.length)]||i>Math.floor(.5*n.length)&&e>=n[Math.floor(.5*n.length)])&&(r=!1):(i<Math.floor(.5*n.length)&&e<=n[Math.floor(.5*n.length)]||i>Math.floor(.5*n.length)&&e<=n[Math.floor(.5*n.length)])&&(r=!1)})),"peak"!==t&&"valley"!==t&&!1===r&&(r=!0,n.forEach((function(e,t){(t<Math.floor(.5*n.length)&&e>=n[Math.floor(.5*n.length)]||t>Math.floor(.5*n.length)&&e>=n[Math.floor(.5*n.length)])&&(r=!1)}))),r}}},{key:"isCriticalPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"peak",n=O(e);if(e.length>1){var r=!0;return n.forEach((function(e,i){"peak"===t?(i<.5*n.length&&e<=0||i>.5*n.length&&e>0)&&(r=!1):(i<.5*n.length&&e>=0||i>.5*n.length&&e<0)&&(r=!1)})),"peak"!==t&&"valley"!==t&&!1===r&&(r=!0,n.forEach((function(e,t){(t<.5*n.length&&e<=0||t>.5*n.length&&e>0)&&(r=!1)}))),r}}}],null&&B(t.prototype,null),n&&B(t,n),e}();function F(e){return function(e){if(Array.isArray(e))return N(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var R=new E;function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $(e,t,n){return t&&z(e.prototype,t),n&&z(e,n),e}n(5666);var V=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];M(this,e),this.addFunc=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=null;return null!==n&&(null===e?t.listeners.forEach((function(e,t){r=e.listener.addFunc(n)})):t.listeners.find((function(t,i){t.key===e&&(r=t.listener.addFunc(n))}))),r},this.removeFuncs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===e?t.listeners.forEach((function(e,t){e.listener.removeFuncs(n)})):t.listeners.find((function(t,r){t.name===e&&t.listener.removeFuncs(n)}))},this.debug=n,this.listeners=[]}return $(e,[{key:"addListener",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.debug;if(void 0!==t){var a=e;null===a&&(a=Math.floor(1e5*Math.random()));var o={key:a,listener:new G(t,n,r,i,s)};this.listeners.push(o)}else console.error("You must assign an object")}},{key:"hasKey",value:function(e){var t=!1;return this.listeners.forEach((function(n,r){n.key===e&&(t=!0)})),t}},{key:"getKeyIndices",value:function(e){var t=[];return this.listeners.find((function(n,r){n.key===e&&t.push(r)})),t}},{key:"onchange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===e?this.listeners.forEach((function(e,n){e.listener.onchange=t})):this.listeners.find((function(n,r){n.name===e&&(n.listener.onchange=t)}))}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e?this.listeners.forEach((function(e,t){e.listener.stop()})):this.listeners.find((function(t,n){t.name===e&&t.listener.stop()}))}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e?this.listeners.forEach((function(e,t){e.listener.start()})):this.listeners.find((function(t,n){t.name===e&&t.listener.start()}))}},{key:"remove",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===t)this.listeners.splice(0,this.listeners.length);else{var n=[];this.listeners.find((function(e,r){e.name===t&&n.push(r)})),n.reverse().forEach((function(t){e.listeners[t].stop(),e.listeners.splice(t,1)}))}}}]),e}(),G=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"__ANY__",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onchange,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"FRAMERATE",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];M(this,e),U.call(this),this.debug=a,this.onchange=i,this.onchangeFuncs=[],this.object=t,this.propName=r,this.propOld=void 0,this.setListenerRef(r),this.running=!0,this.interval,s<=0?(this.interval=10,console.log("Min recommended interval set: 10ms")):this.interval=s,"undefined"==typeof window?setTimeout((function(){n.check()}),60):this.checker=requestAnimationFrame(this.check)}return $(e,[{key:"removeFuncs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e?this.onchangeFuncs=[]:void 0!==this.onchangeFuncs[e]&&this.onchangeFuncs.splice(e,1)}},{key:"start",value:function(){var e=this;this.running=!0,"undefined"==typeof window?setTimeout((function(){e.check()}),60):this.checker=requestAnimationFrame(this.check)}},{key:"stop",value:function(){this.running=!1,cancelAnimationFrame(this.checker)}}]),e}(),U=function(){var e=this;this.onchange=function(t){console.log(e.propName," changed from: ",e.propOld," to: ",e.object[e.propName])},this.addFunc=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null!==t&&e.onchangeFuncs.push(t),e.onchangeFuncs.length-1},this.onchangeMulti=function(t){e.onchangeFuncs.forEach((function(n,r){!0===e.debug&&console.log(n),n(t)}))},this.setListenerRef=function(t){"__ANY__"===t||null==t?e.propOld=JSON.stringifyFast(e.object):Array.isArray(e.object[t])?e.propOld=JSON.stringifyFast(e.object[t].slice(e.object[t].length-20)):"object"===L(e.object[t])?e.propOld=JSON.stringifyFast(e.object[t]):"function"==typeof e.object[t]?e.propOld=e.object[t].toString():e.propOld=e.object[t],!0===e.debug&&console.log("propname",t,", new assignment: ",e.propOld)},this.check=function(){if("__ANY__"===e.propName||null===e.propName||void 0===e.propName)e.propOld!==JSON.stringifyFast(e.object)&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object),e.setListenerRef(e.propName));else if(Array.isArray(e.object[e.propName]))e.propOld!==JSON.stringifyFast(e.object[e.propName].slice(e.object[e.propName].length-20))&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object[e.propName]),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object[e.propName]),e.setListenerRef(e.propName));else if("object"===L(e.object[e.propName])){var t=JSON.stringifyFast(e.object[e.propName]);e.propOld!==t&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object[e.propName]),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object[e.propName]),e.setListenerRef(e.propName))}else"function"==typeof e.object[e.propName]?e.propOld!==e.object[e.propName].toString()&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object[e.propName].toString()),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object[e.propName].toString()),e.setListenerRef(e.propName)):e.object[e.propName]!==e.propOld&&(!0===e.debug&&console.log("onchange: ",e.onchange),e.onchange(e.object[e.propName]),e.onchangeFuncs.length>0&&e.onchangeMulti(e.object[e.propName]),e.setListenerRef(e.propName));!0===e.running&&(!0===e.debug&&console.log("checking",e.object,e.propName),"FRAMERATE"===e.interval?"undefined"==typeof window?setTimeout((function(){e.check()}),60):e.checker=requestAnimationFrame(e.check):setTimeout((function(){e.check}),e.interval))}};function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return W(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?W(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function H(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}void 0===JSON.stringifyFast&&(JSON.stringifyFast=function(){var e=new Map,t=[],n=["this"];function r(t,r){var i=r;if(null!==i&&"object"===L(r)){var s=e.get(i),a=r.constructor.name;if(s)return"[Circular Reference]"+s;if("Array"===a&&r.length>20)i=r.slice(r.length-20),e.set(i,n.join("."));else if("Object"!==a&&"Number"!==a&&"String"!==a&&"Boolean"!==a)i="instanceof_"+a,e.set(i,n.join("."));else if("object"===L(i)){var o={};for(var u in i)Array.isArray(i[u])?o[u]=i[u].slice(i[u].length-20):o[u]=i[u]}else e.set(i,n.join("."))}return i}return function(i,s){try{return t.push(i),JSON.stringify(i,r,s)}finally{e.clear(),t.length=0,n.length=1}}}());var X=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FRAMERATE";H(this,e),this.data=n,this.data.stateUpdateInterval=r,this.pushToState={},this.prev=Object.assign({},this.data),this.listener=new V;var i=function(){t.listener.listeners.forEach((function(e,n){e.interval=t.data.stateUpdateInterval}))};this.listener.addListener("interval",this.data,"stateUpdateInterval",i,r);var s=function(){if(Object.keys(t.pushToState).length>0){Object.assign(t.prev,t.data),Object.assign(t.data,t.pushToState);var e,n=j(Object.getOwnPropertyNames(t.pushToState));try{for(n.s();!(e=n.n()).done;){var r=e.value;delete t.pushToState[r]}}catch(e){n.e(e)}finally{n.f()}}};this.listener.addListener("push",this.pushToState,"__ANY__",s,r)}var t,n;return t=e,(n=[{key:"addToState",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.data[e]=t,null!==n)return this.addSecondaryKeyResponse(e,n,r)}},{key:"getState",value:function(){return JSON.parse(JSON.stringifyFast(this.data))}},{key:"setState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(this.pushToState,e),this.pushToState}},{key:"setPrimaryKeyResponse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null!==t&&(this.listener.hasKey(e)?this.listener.onchange(e,t):null!==e&&this.listener.addListener(e,this.data,e,t,this.data.stateUpdateInterval,n))}},{key:"addSecondaryKeyResponse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null!==t)return this.listener.hasKey(e)?this.listener.addFunc(e,t):null!==e?(this.listener.addListener(e,this.data,e,(function(){}),this.data.stateUpdateInterval,n),this.listener.addFunc(e,t)):this.listener.addFunc("state",t)}},{key:"removeSecondaryKeyResponse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!==e?this.listener.hasKey(e)&&this.listener.removeFuncs(e,t):console.error("provide key")}},{key:"clearAllKeyResponses",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.listener.hasKey(e)&&this.listener.remove(e)}},{key:"subscribe",value:function(e,t){if(void 0!==this.data[e])return this.addSecondaryKeyResponse(e,t);this.addToState(k,null,t)}},{key:"unsubscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!==t?this.removeSecondaryKeyResponse(e,t):console.error("Specify a subcription function index")}},{key:"unsubscribeAll",value:function(e){this.clearAllKeyResponses(e)}}])&&q(t.prototype,n),e}();function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e){return function(e){if(Array.isArray(e))return J(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}void 0===JSON.stringifyFast&&(JSON.stringifyFast=function(){var e=new Map,t=[],n=["this"];function r(t,r){var i=r;if(null!==i&&"object"===K(r)){var s=e.get(i),a=r.constructor.name;if(s)return"[Circular Reference]"+s;if("Array"===a&&r.length>20)i=r.slice(r.length-20),e.set(i,n.join("."));else if("Object"!==a&&"Number"!==a&&"String"!==a&&"Boolean"!==a)i="instanceof_"+a,e.set(i,n.join("."));else if("object"===K(i)){var o={};for(var u in i)Array.isArray(i[u])?o[u]=i[u].slice(i[u].length-20):o[u]=i[u]}else e.set(i,n.join("."))}return i}return function(i,s){try{return t.push(i),JSON.stringify(i,r,s)}finally{e.clear(),t.length=0,n.length=1}}}());var ne=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"atlas",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{eegshared:{eegChannelTags:[{ch:0,tag:"FP1",analyze:!0},{ch:1,tag:"FP2",analyze:!0}],sps:512}},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"10_20",s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:["eegfft"];ee(this,e),this.getDeviceDataByTag=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eeg",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FP1",r=void 0;return"number"==typeof n&&"eeg"===e&&t.data[e+"shared"][e+"ChannelTags"].find((function(e,t){if(e.ch===n&&null!==e.tag)return n=e.tag,!0})),e.indexOf("shared")<0?(t.data[e].find((function(e,t){if(e.tag===n)return r=e,!0})),r):null===n||"all"===n?t.data[e]:"string"==typeof n||"number"==typeof n?(t.data[e].find((function(e,t){if(e.tag===n)return r=e,!0})),r):r},this.getEEGDataByChannel=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=void 0;return t.data.eegshared.eegChannelTags.find((function(r,i){if(r.ch===e&&!1!==(n=null===r.tag||"other"===r.tag?t.getEEGDataByTag(r.ch):t.getEEGDataByTag(r.tag)))return!0})),n},this.getEEGDataByTag=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FP1",n=void 0;return t.data.eeg.find((function(t,r){if(t.tag===e)return n=t,!0})),n},this.getCoherenceByTag=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FP1_FZ",n=void 0;return t.data.coherence.find((function(t,r){if(t.tag===e)return n=t,!0})),n},this.getLatestFFTData=function(){var e=[];return t.data.eegshared.eegChannelTags.forEach((function(n,r){if(!0===n.analyze){var i=t.getEEGDataByTag(n.tag);if(0===i.fftCount)e.push({tag:i.tag,fftCount:i.fftCount});else{var s=i.fftCount-1;e.push({tag:i.tag,fftCount:i.fftCount,time:i.fftTimes[s],fft:i.ffts[s],slice:{delta:i.slices.delta[s],theta:i.slices.theta[s],alpha1:i.slices.alpha1[s],alpha2:i.slices.alpha2[s],beta:i.slices.beta[s],lowgamma:i.slices.lowgamma[s],highgamma:i.slices.highgamma[s]},mean:{delta:i.means.delta[s],theta:i.means.theta[s],alpha1:i.means.alpha1[s],alpha2:i.means.alpha2[s],beta:i.means.beta[s],lowgamma:i.slices.lowgamma[s],highgamma:i.means.highgamma[s]}})}}})),e},this.getLatestCoherenceData=function(){var e=[];return t.data.coherence.forEach((function(t,n){var r=t.fftCount-1;e.push({tag:t.tag,fftCount:t.fftCount,time:t.times[r],fft:t.ffts[r],slice:{delta:t.slices.delta[r],theta:t.slices.theta[r],alpha1:t.slices.alpha1[r],alpha2:t.slices.alpha2[r],beta:t.slices.beta[r],gamma:t.slices.gamma[r]},mean:{delta:t.means.delta[r],theta:t.means.theta[r],alpha1:t.means.alpha1[r],alpha2:t.means.alpha2[r],beta:t.means.beta[r],gamma:t.means.gamma[r]}})})),e},this.getFrontalData=function(){var e=void 0;if(t.settings.eeg){var n=t.getEEGDataByTag("FP1"),r=t.getEEGDataByTag("FP2");n&&r||(n=t.getEEGDataByTag("AF7"),r=t.getEEGDataByTag("AF8")),n&&r&&(e=[n,r])}return e},this.getFrontalCoherenceData=function(){var e,n,r,i=void 0;return t.settings.coherence&&(i=null!==(e=null!==(n=null!==(r=t.getCoherenceByTag("FP2_FP1"))&&void 0!==r?r:t.getCoherenceByTag("FP1_FP2"))&&void 0!==n?n:t.getCoherenceByTag("AF7_AF8"))&&void 0!==e?e:t.getCoherenceByTag("AF8_AF7")),i},this.getCNCoherenceData=function(){var e=void 0;return t.settings.coherence&&void 0===(e=t.getCoherenceByTag("C3_C4"))&&(e=t.getCoherenceByTag("C4_C3")),e},this.getCNData=function(){var e=void 0;if(t.settings.eeg){var n=t.getEEGDataByTag("C3"),r=t.getEEGDataByTag("C4");n&&r&&(e=[n,r])}return e},this.getCoherenceScore=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"alpha1";if(e.fftCount>0){var r=e.fftCount,i=Math.min(20,r),s=e.means[n].slice(r-i);return t.mean(s)}return 0},this.getAlphaRatio=function(e){return e.fftCount>0?e.means.alpha2[eeg_ch.fftCount-1]/e.means.alpha1[eeg_ch.fftCount-1]:0},this.getThetaBetaRatio=function(e){return e.fftCount>0?e.means.theta[e.fftCount-1]/e.means.beta[e.fftCount-1]:0},this.getAlphaBetaRatio=function(e){return e.fftCount>0?.5*(e.means.alpha1[eeg_ch.fftCount-1]+e.means.alpha2[eeg_ch.fftCount-1])/e.means.beta[eeg_ch.fftCount-1]:0},this.get40HzGamma=function(e){if(e.fftCount>0){var n=e.slices.lowgamma[eeg_ch.fftCount-1],r=[];return n.forEach((function(e,n){t.eegshared.freqBins.lowgamma[n]>38&&t.eegshared.freqBins.lowgamma[n]<42&&r.push(e)})),t.max.apply(t,r)}return 0},this.getLowGammaScore=function(e){if(e.fftCount>0){var n=e.fftCount,r=20;n<r&&(r=n);var i=e.means.lowgamma.slice(n-r);return e.means.lowgamma[n-1]-t.mean(i)}return 0},this.getHEGRatioScore=function(e){if(e.count>0){var n=e.count,r=40;n<r&&(r=n);var i=e.ratio.slice(n-r);return e.ratio[n-1]-t.mean(i)}return 0},this.getBlink=function(){var e=[!1,!1];return null==t.data.blink&&(t.data.blink={blinkDuration:1,blinkThreshold:220,lastBlink:Date.now()}),Date.now()-t.data.blink.lastBlink>1e3*t.data.blink.blinkDuration&&([["AF7","FP1"],["AF8","FP2"]].forEach((function(n,r){var i,s=null!==(i=t.getEEGDataByTag(n[0]))&&void 0!==i?i:t.getEEGDataByTag(n[1]),a=s.filtered.slice(s.filtered.length-t.data.blink.blinkDuration*t.data.eegshared.sps),o=Math.max.apply(Math,Q(a.map((function(e){return Math.abs(e)}))));e[r]=o>t.data.blink.blinkThreshold})),t.data.blink.lastBlink=Date.now()),e},this.beatDetection=function(e,n){var r=Math.floor(n/4);r%2==0&&(r+=1);var i=Math.round(.5*r),s=Math.floor(3*n);s%2==0&&(s+=1);var a=Math.round(.5*s),o=e.beat_detect;if(o.rir.push(e.red[e.count-1]+e.ir[e.count-1]),o.rir.length>r?o.rir[o.rir.length-1]=t.mean(o.rir.slice(o.rir.length-r)):o.rir[o.rir.length-1]=t.mean(o.rir),o.rir.length>s?o.rir2.push(t.mean(o.rir.slice(o.rir.length-s))):o.rir2.push(t.mean(o.rir)),e.count>1){if(o.drir_dt.push((o.rir[e.count-1]-o.rir[e.count-2])/(e.times[e.count-1]-e.times[e.count-2])),o.drir_dt.length>r){o.drir_dt[o.drir_dt.length-1]=t.mean(o.drir_dt.slice(o.drir_dt.length-r));var u=o.localmins.length,c=o.localmaxs.length;if(t.isExtrema(o.rir.slice(o.rir.length-r),"valley")?o.localmins.push({idx:e.count-i,val:o.rir[e.count-i],t:e.times[e.count-i]}):t.isExtrema(o.rir.slice(o.rir.length-r),"peak")&&o.localmaxs.push({idx:e.count-i,val:o.rir[e.count-i],t:e.times[e.count-i]}),o.localmins.length>1&&o.localmaxs.length>1){if(o.localmins.length>o.localmaxs.length+2)for(;o.localmins.length>o.localmaxs.length+2;)o.localmins.splice(o.localmins.length-2,1);else if(o.localmaxs.length>o.localmins.length+2)for(;o.localmaxs.length>o.localmins.length+2;)o.localmaxs.splice(o.localmins.length-2,1);if(u<o.localmins.length&&o.val_dists.push({dt:o.localmins[o.localmins.length-1].t-o.localmins[o.localmins.length-2].t,t:o.localmins[o.localmins.length-1].t,y0:o.localmins[o.localmins.length-2].val,y1:o.localmins[o.localmins.length-1].val}),c<o.localmaxs.length&&o.peak_dists.push({dt:o.localmaxs[o.localmaxs.length-1].t-o.localmaxs[o.localmaxs.length-2].t,t:o.localmaxs[o.localmaxs.length-1].t,y0:o.localmaxs[o.localmaxs.length-2].val,y1:o.localmaxs[o.localmaxs.length-1].val}),o.peak_dists.length>1&&o.val_dists.length>1)if(o.val_dists[o.val_dists.length-1].t>o.peak_dists[o.peak_dists.length-1].t){if(0===o.beats.length)o.beats.push({t:o.peak_dists[o.peak_dists.length-1].t,hrv:0,bpm:60*(o.peak_dists[o.peak_dists.length-1].dt+o.val_dists[o.val_dists.length-1].dt)/2e3,height0:o.peak_dists[o.peak_dists.length-1].y0-o.val_dists[o.val_dists.length-1].y0,height1:o.peak_dists[o.peak_dists.length-1].y1-o.val_dists[o.val_dists.length-1].y1});else if(o.beats[o.beats.length-1].t!==o.peak_dists[o.peak_dists.length-1].t){var l=60*(o.peak_dists[o.peak_dists.length-1].dt+o.val_dists[o.val_dists.length-1].dt)/2e3;o.beats.push({t:o.peak_dists[o.peak_dists.length-1].t,hrv:Math.abs(l-o.beats[o.beats.length-1].bpm),bpm:l,height0:o.peak_dists[o.peak_dists.length-1].y0-o.val_dists[o.val_dists.length-1].y0,height1:o.peak_dists[o.peak_dists.length-1].y1-o.val_dists[o.val_dists.length-1].y1})}}else if(0===o.beats.length)o.beats.push({t:o.peak_dists[o.peak_dists.length-2].t,hrv:0,bpm:60*(o.peak_dists[o.peak_dists.length-2].dt+o.val_dists[o.val_dists.length-1].dt)/2e3,height0:o.peak_dists[o.peak_dists.length-2].y0-o.val_dists[o.val_dists.length-2].y0,height1:o.peak_dists[o.peak_dists.length-2].y1-o.val_dists[o.val_dists.length-2].y1});else if(o.beats[o.beats.length-1].t!==o.peak_dists[o.peak_dists.length-2].t){var h=60*(o.peak_dists[o.peak_dists.length-2].dt+o.val_dists[o.val_dists.length-1].dt)/2e3;o.beats.push({t:o.peak_dists[o.peak_dists.length-2].t,hrv:Math.abs(h-o.beats[o.beats.length-2].bpm),bpm:h,height0:o.peak_dists[o.peak_dists.length-2].y0-o.val_dists[o.val_dists.length-2].y0,height1:o.peak_dists[o.peak_dists.length-2].y1-o.val_dists[o.val_dists.length-2].y1})}}}if(o.rir2.length>s){var p=o.localmins2.length,d=o.localmaxs2.length;if(t.isExtrema(o.rir2.slice(o.rir2.length-s),"valley")?o.localmins2.push({idx:e.count-a,val:o.rir[e.count-a],t:e.times[e.count-a]}):t.isExtrema(o.rir2.slice(o.rir2.length-s),"peak")&&o.localmaxs2.push({idx:e.count-a,val:o.rir[e.count-a],t:e.times[e.count-a]}),o.localmins2.length>1&&o.localmaxs2.length>1){if(o.localmins2.length>o.localmaxs2.length+2)for(;o.localmins2.length>o.localmaxs2.length+2;)o.localmins2.splice(o.localmins2.length-2,1);else if(o.localmaxs2.length>o.localmins2.length+2)for(;o.localmaxs2.length>o.localmins2.length+2;)o.localmaxs2.splice(o.localmins2.length-2,1);if(p<o.localmins2.length&&o.val_dists2.push({dt:o.localmins2[o.localmins2.length-1].t-o.localmins2[o.localmins2.length-2].t,t:o.localmins2[o.localmins2.length-1].t,y0:o.localmins2[o.localmins2.length-2].val,y1:o.localmins2[o.localmins2.length-1].val}),d<o.localmaxs2.length&&o.peak_dists2.push({dt:o.localmaxs2[o.localmaxs2.length-1].t-o.localmaxs2[o.localmaxs2.length-2].t,t:o.localmaxs2[o.localmaxs2.length-1].t,y0:o.localmaxs2[o.localmaxs2.length-2].val,y1:o.localmaxs2[o.localmaxs2.length-1].val}),o.peak_dists2.length>1&&o.val_dists2.length>1)if(o.val_dists2[o.val_dists2.length-1].t>o.peak_dists2[o.peak_dists2.length-1].t){if(0===o.breaths.length)o.breaths.push(Y({t:o.peak_dists2[o.peak_dists2.length-1].t,bpm:12e4/(o.peak_dists2[o.peak_dists2.length-1].dt+o.val_dists2[o.val_dists2.length-1].dt),brv:0,height0:o.peak_dists2[o.peak_dists2.length-1].y0-o.val_dists2[o.val_dists2.length-1].y0},"height0",o.peak_dists2[o.peak_dists2.length-1].y1-o.val_dists2[o.val_dists2.length-1].y1));else if(o.breaths[o.breaths.length-1].t!==o.peak_dists2[o.peak_dists2.length-1].t){var f=12e4/(o.peak_dists2[o.peak_dists2.length-1].dt+o.val_dists2[o.val_dists2.length-1].dt);o.breaths.push(Y({t:o.peak_dists2[o.peak_dists2.length-1].t,bpm:f,brv:Math.abs(f-o.breaths[o.breaths.length-1].bpm),height0:o.peak_dists2[o.peak_dists2.length-1].y0-o.val_dists2[o.val_dists2.length-1].y0},"height0",o.peak_dists2[o.peak_dists2.length-1].y1-o.val_dists2[o.val_dists2.length-1].y1))}}else if(0===o.breaths.length)o.breaths.push(Y({t:o.peak_dists2[o.peak_dists2.length-2].t,bpm:12e4/(o.peak_dists2[o.peak_dists2.length-2].dt+o.val_dists2[o.val_dists2.length-2].dt),brv:0,height0:o.peak_dists2[o.peak_dists2.length-2].y0-o.val_dists2[o.val_dists2.length-2].y0},"height0",o.peak_dists2[o.peak_dists2.length-2].y1-o.val_dists2[o.val_dists2.length-2].y1));else if(o.breaths[o.breaths.length-1].t!==o.peak_dists2[o.peak_dists2.length-2].t){var m=12e4/(o.peak_dists2[o.peak_dists2.length-2].dt+o.val_dists2[o.val_dists2.length-2].dt);o.breaths.push(Y({t:o.peak_dists2[o.peak_dists2.length-2].t,bpm:m,brv:Math.abs(m-o.breaths[o.breaths.length-1].bpm),height0:o.peak_dists2[o.peak_dists2.length-2].y0-o.val_dists2[o.val_dists2.length-2].y0},"height0",o.peak_dists2[o.peak_dists2.length-2].y1-o.val_dists2[o.val_dists2.length-2].y1))}}}}},this.mapFFTData=function(e,n,r){t.data.eeg.find((function(i,s){if(i.tag===r){if(i.fftCount++,i.fftTimes.push(n),i.ffts.push(e),t.data.eegshared.bandFreqs.scp[1].length>0){var a=e.slice(t.data.eegshared.bandFreqs.scp[1][0],t.data.eegshared.bandFreqs.scp[1][t.data.eegshared.bandFreqs.scp[1].length-1]+1);i.slices.scp.push(a),i.means.scp.push(t.mean(a))}if(t.data.eegshared.bandFreqs.scp[1].length>0){var o=e.slice(t.data.eegshared.bandFreqs.delta[1][0],t.data.eegshared.bandFreqs.delta[1][t.data.eegshared.bandFreqs.delta[1].length-1]+1);i.slices.delta.push(o),i.means.delta.push(t.mean(o))}if(t.data.eegshared.bandFreqs.theta[1].length>0){var u=e.slice(t.data.eegshared.bandFreqs.theta[1][0],t.data.eegshared.bandFreqs.theta[1][t.data.eegshared.bandFreqs.theta[1].length-1]+1);i.slices.theta.push(u),i.means.theta.push(t.mean(u))}if(t.data.eegshared.bandFreqs.alpha1[1].length>0){var c=e.slice(t.data.eegshared.bandFreqs.alpha1[1][0],t.data.eegshared.bandFreqs.alpha1[1][t.data.eegshared.bandFreqs.alpha1[1].length-1]+1);i.slices.alpha1.push(c),i.means.alpha1.push(t.mean(c))}if(t.data.eegshared.bandFreqs.alpha2[1].length>0){var l=e.slice(t.data.eegshared.bandFreqs.alpha2[1][0],t.data.eegshared.bandFreqs.alpha2[1][t.data.eegshared.bandFreqs.alpha2[1].length-1]+1);i.slices.alpha2.push(l),i.means.alpha2.push(t.mean(l))}if(t.data.eegshared.bandFreqs.beta[1].length>0){var h=e.slice(t.data.eegshared.bandFreqs.beta[1][0],t.data.eegshared.bandFreqs.beta[1][t.data.eegshared.bandFreqs.beta[1].length-1]+1);i.slices.beta.push(h),i.means.beta.push(t.mean(h))}if(t.data.eegshared.bandFreqs.lowgamma[1].length>0){var p=e.slice(t.data.eegshared.bandFreqs.lowgamma[1][0],t.data.eegshared.bandFreqs.lowgamma[1][t.data.eegshared.bandFreqs.lowgamma[1].length-1]+1);i.slices.lowgamma.push(p),i.means.lowgamma.push(t.mean(p))}if(t.data.eegshared.bandFreqs.highgamma[1].length>0){var d=e.slice(t.data.eegshared.bandFreqs.highgamma[1][0],t.data.eegshared.bandFreqs.highgamma[1][t.data.eegshared.bandFreqs.highgamma[1].length-1]+1);i.slices.highgamma.push(d),i.means.highgamma.push(t.mean(d))}return!0}}))},this.mapCoherenceData=function(e,n){e.forEach((function(e,r){if(t.data.coherence[r].fftCount++,t.data.coherence[r].ffts.push(e),t.data.coherence[r].fftTimes.push(n),t.data.eegshared.bandFreqs.scp[1].length>0){var i=e.slice(t.data.eegshared.bandFreqs.scp[1][0],t.data.eegshared.bandFreqs.scp[1][t.data.eegshared.bandFreqs.scp[1].length-1]+1);t.data.coherence[r].slices.scp.push(i),t.data.coherence[r].means.scp.push(t.mean(i))}if(t.data.eegshared.bandFreqs.delta[1].length>0){var s=e.slice(t.data.eegshared.bandFreqs.delta[1][0],t.data.eegshared.bandFreqs.delta[1][t.data.eegshared.bandFreqs.delta[1].length-1]+1);t.data.coherence[r].slices.delta.push(s),t.data.coherence[r].means.delta.push(t.mean(s))}if(t.data.eegshared.bandFreqs.theta[1].length>0){var a=e.slice(t.data.eegshared.bandFreqs.theta[1][0],t.data.eegshared.bandFreqs.theta[1][t.data.eegshared.bandFreqs.theta[1].length-1]+1);t.data.coherence[r].slices.theta.push(a),t.data.coherence[r].means.theta.push(t.mean(a))}if(t.data.eegshared.bandFreqs.alpha1[1].length>0){var o=e.slice(t.data.eegshared.bandFreqs.alpha1[1][0],t.data.eegshared.bandFreqs.alpha1[1][t.data.eegshared.bandFreqs.alpha1[1].length-1]+1);t.data.coherence[r].slices.alpha1.push(o),t.data.coherence[r].means.alpha1.push(t.mean(o))}if(t.data.eegshared.bandFreqs.alpha2[1].length>0){var u=e.slice(t.data.eegshared.bandFreqs.alpha2[1][0],t.data.eegshared.bandFreqs.alpha2[1][t.data.eegshared.bandFreqs.alpha2[1].length-1]+1);t.data.coherence[r].slices.alpha2.push(u),t.data.coherence[r].means.alpha2.push(t.mean(u))}if(t.data.eegshared.bandFreqs.beta[1].length>0){var c=e.slice(t.data.eegshared.bandFreqs.beta[1][0],t.data.eegshared.bandFreqs.beta[1][t.data.eegshared.bandFreqs.beta[1].length-1]+1);t.data.coherence[r].slices.beta.push(c),t.data.coherence[r].means.beta.push(t.mean(c))}if(t.data.eegshared.bandFreqs.lowgamma[1].length>0){var l=e.slice(t.data.eegshared.bandFreqs.lowgamma[1][0],t.data.eegshared.bandFreqs.lowgamma[1][t.data.eegshared.bandFreqs.lowgamma[1].length-1]+1);t.data.coherence[r].slices.lowgamma.push(l),t.data.coherence[r].means.lowgamma.push(t.mean(l))}if(t.data.eegshared.bandFreqs.highgamma[1].length>0){var h=e.slice(t.data.eegshared.bandFreqs.highgamma[1][0],t.data.eegshared.bandFreqs.highgamma[1][t.data.eegshared.bandFreqs.highgamma[1].length-1]+1);t.data.coherence[r].slices.highgamma.push(h),t.data.coherence[r].means.highgamma.push(t.mean(h))}}))},this.bufferEEGSignals=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=Math.floor(t.data.eegshared.sps*e),r=[],i=null,s=0;s<t.data.eegshared.eegChannelTags.length;s++)if(!0===t.data.eegshared.eegChannelTags[s].analyze&&null!==t.data.eegshared.eegChannelTags[s].tag&&"other"!==t.data.eegshared.eegChannelTags[s].tag){var a=t.getEEGDataByTag(t.data.eegshared.eegChannelTags[s].tag);void 0!==a&&(a.filtered.length>0?r.push(a.filtered.slice(a.filtered.length-n)):a.raw.length>0&&r.push(a.raw.slice(a.raw.length-n)),null===i&&(i=a.times[a.times.length-1]))}return!0===t.settings.analyzing&&(t.workerPostTime=i),r},this.readyEEGDataForWriting=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end",r=["TimeStamps","UnixTime"],i=[],s=0,a=0,o=[],u=null;if(t.data.eegshared.eegChannelTags.forEach((function(e,n){null===u&&"other"!==e.tag&&!0===e.analyze&&(u=t.getEEGDataByChannel(e.ch)),o.push(t.getEEGDataByChannel(e.ch))})),o.length>0){if("end"===n&&(n=o[0].count),o[0].count<e&&(e=t.atlas.rolloverLimit-2e3),0!==e)for(;u.fftTimes[s]<o[0].times[e];)s++;for(var c=function(e){var n=[];if(n.push(t.toISOLocal(new Date(o[0].times[e])),o[0].times[e]),o.forEach((function(t,i){0===e&&r.push(t.tag),t.filtered.length>e?n.push(t.filtered[e].toFixed(0)):t.raw.length>e&&n.push(t.raw[e].toFixed(0))})),u.fftCount>=s&&u.fftTimes[s]===o[0].times[e]&&(o.forEach((function(i,a){if(0===s&&!t.data.eegshared.eegChannelTags.find((function(e,t){if(!(i.tag!==e.ch&&i.tag!==e.tag||!1!==e.analyze&&"other"!==e.tag))return!0}))){var u=Q(t.data.eegshared.frequencies).map((function(e,t){return e.toFixed(3)}));r.push(i.tag+"; FFT Hz:",u.join(","))}o[0].times[e]===i.fftTimes[s]&&n.push(Q(i.ffts[s]).map((function(e,t){return e.toFixed(3)})))})),t.settings.coherence&&t.data.coherence.forEach((function(e,i){if(0===s){var a=Q(t.data.eegshared.frequencies).map((function(e,t){return e.toFixed(3)}));r.push(e.tag+"; FFT Hz:",a.join(","))}if(o[0].fftTimes[s]===e.fftTimes[s])try{n.push(Q(e.ffts[s]).map((function(e,t){return e.toFixed(3)})))}catch(t){console.log(t,s,e)}})),s++),t.data.other.notes.length>0){if(0===e)r.push("Notes");else for(;t.data.other.notes[a].time<o[0].times[e];)a++;t.data.other.notes[a].time<=o[0].times[e]&&(n.push(t.data.other.notes[a].note),nodeidx++)}i.push(n.join(","))},l=e;l<n;l++)c(l);return[r.join(",")+"\n",i.join("\n")]}},this.readyHEGDataForWriting=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=["TimeStamps","UnixTime","Red","IR","Ambient","Ratio"],s=[],a=t.data.heg[r];"end"===n&&(n=a.times.length);for(var o=e;o<n;o++){var u=a.times[o];if(s.push([u,t.toISOLocal(new Date(u)),a.red[o],a.ir[o],a.ambient[o],a.ratio[o]].join(",")),t.data.other.notes.length>0){if(0===o)i.push("Notes");else for(;t.data.other.notes[noteidx].time<u;)noteidx++;t.data.other.notes[noteidx].time<=u&&(line.push(t.data.other.notes[noteidx].note),nodeidx++)}}return[i.join(",")+"\n",s.join("\n")]},this.workeronmessage=function(e){if(e.origin===t.name){if("multidftbandpass"===e.foo||"multidft"===e.foo){var n=Q(e.output[1]),r=0;t.data.eegshared.eegChannelTags.forEach((function(e,i){null!==e.tag&&"other"!==e.tag&&!0===e.analyze&&(t.mapFFTData(n[r],t.workerPostTime,e.tag),r++)})),t.checkRollover("eeg")}else if("coherence"===e.foo){n=Q(e.output[1]);var i=Q(e.output[2]),s=0;t.data.eegshared.eegChannelTags.forEach((function(e,r){null!==e.tag&&"other"!==e.tag&&!0===e.analyze&&(t.mapFFTData(n[s],t.workerPostTime,e.tag),s++)})),t.mapCoherenceData(i,t.workerPostTime),t.checkRollover("eeg")}t.workerWaiting=!1}},this.analyzer=function(){!0===t.settings.analyzing&&(t.settings.analysis.forEach((function(e,n){t.analyzerOpts.forEach((function(n,r){n===e&&t.analyzerFuncs[r]()}))})),"undefined"==typeof window?setTimeout((function(){t.analyzer()}),60):setTimeout((function(){requestAnimationFrame(t.analyzer)}),50))},this.makeFeedbackOptions=function(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.getElementById(e.props.id).querySelector(".brainsatplay-neurofeedback-container"),i=e.props.id,s="";if(t.settings.deviceConnected){r.style.pointerEvents="auto";var a=function(){return t.getCoherenceScore(t.getFrontalCoherenceData(),"alpha1")},o=function(){var e=t.getFrontalData(),n=[];return e.forEach((function(e){n.push(t.getThetaBetaRatio(e))})),Math.min(1/(n.reduce((function(e,t){return e+t}))/n.length),1)},u=function(){var e=t.data.heg[0].count;if(e>1){var n=40;e<n&&(n=e);var r=t.data.heg[0].ratio.slice(e-n);return t.data.heg[0].ratio[e-1]-t.mean(r)}},c=function(e){var n=t.data.heg[0].beat_detect[e],r=t.data.heg[0].beat_detect.prevBeatLength;if(t.data.heg[0].beat_detect.prevBeatLength=n.length,r<n.length&&(console.log("beat"),n[n.length-1].tRead=Date.now()),0<n.length){var i=(Date.now()-n[n.length-1].tRead)/1e3*n[n.length-1].bpm/30;return i<1?1-(.5+.5*Math.cos(2*Math.PI*i)):0}return 0},l=function(){return c("beats")},h=function(){return c("breaths")};n=[{label:"Select your neurofeedback",function:e.defaultNeurofeedback}],t.settings.heg&&n.push({label:"HEG Ratio",function:u},{label:"Heartbeat",function:l},{label:"Breath",function:h}),t.settings.eeg&&n.push({label:"Frontal Alpha Coherence",function:a},{label:"Focus",function:o});var p=document.getElementById("".concat(i,"-neurofeedbackselector"));null==p&&(s='<div><select id="'.concat(i,'-neurofeedbackselector">'),n.forEach((function(e,t){s+=0===t?"<option value=".concat(e.function.name," disabled>").concat(e.label,"</option>"):1===t?"<option value=".concat(e.function.name," selected>").concat(e.label,"</option>"):"<option value=".concat(e.function.name,">").concat(e.label,"</option>"),t===n.length-1&&(s+="</select></div>")})),r.innerHTML+=s,p=document.getElementById("".concat(i,"-neurofeedbackselector"))),e.getNeurofeedback=n.find((function(e){return e.function.name==p.value})).function,p.onchange=function(t){e.getNeurofeedback=n.find((function(e){return e.function.name==t.target.value})).function}}},this.name=n,this.config=i,this.state=new X({deviceConnected:!1,analyzing:!1,analysis:o,heg:!1,eeg:!1,coherence:!1,eyetracker:!1,accelerometer:!1,hrv:!1,fnirs:!1,ecg:!1,spo2:!1,emg:!1}),this.settings=this.state.data,this.data={eegshared:{eegChannelTags:[],sps:1,startTime:0,frequencies:[],bandFreqs:{scp:[[],[]],delta:[[],[]],theta:[[],[]],alpha1:[[],[]],alpha2:[[],[]],beta:[[],[]],lowgamma:[[],[]],highgamma:[[],[]]}},eeg:[],coherence:[],heg:[],fnirs:[],accelerometer:[],hrv:[],spo2:[],emg:[],ecg:[],eyetracker:[],other:{notes:[],games:{}}},Object.assign(this.data,r),this.rolloverLimit=60030,"10_20"===i?(this.settings.eeg=!0,this.data.eeg=this.gen10_20Atlas(this.data.eegshared.eegChannelTags)):"muse"===i?(this.settings.eeg=!0,this.data.eeg=this.genMuseAtlas()):"big"===i?(this.settings.eeg=!0,this.data.eeg=this.gen10_20Atlas()):"hegduino"===i?(this.addHEGCoord(this.data.heg.length,0,60,60),this.settings.heg=!0):"eyetracker"===i&&(this.settings.eyetracker=!0,this.addEyeTracker(this.data.eyetracker.length)),!0===s&&(this.settings.coherence=!0,this.data.coherence=this.genCoherenceMap(this.data.eegshared.eegChannelTags)),this.data.eegshared.eegChannelTags&&this.data.eegshared.eegChannelTags.forEach((function(e,n){void 0===t.getEEGDataByTag(e.tag)&&t.addEEGCoord(e.ch)})),this.data.eegshared.sps&&(this.data.eegshared.frequencies=this.bandpassWindow(0,128,.5*this.data.eegshared.sps),this.data.eegshared.bandFreqs=this.getBandFreqs(this.data.eegshared.frequencies)),this.analyzerOpts=[],this.analyzerFuncs=[],this.workerPostTime=0,this.workerWaiting=!1,this.workerIdx=0,!0===a&&(this.addDefaultAnalyzerFuncs(),ii||(ii=[]),ii.push(this.workeronmessage))}var t,n;return t=e,(n=[{key:"genEEGCoordinateStruct",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i={scp:[],delta:[],theta:[],alpha1:[],alpha2:[],beta:[],lowgamma:[],highgamma:[]},s={tag:e,position:{x:t,y:n,z:r},count:0,times:[],raw:[],filtered:[],fftCount:0,fftTimes:[],ffts:[],slices:JSON.parse(JSON.stringify(i)),means:JSON.parse(JSON.stringify(i)),lastReadFFT:0,lastRead:0};return s}},{key:"addEEGCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:999,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:999;this.data.eeg.push(this.genEEGCoordinateStruct(e,t,n,r))}},{key:"genMuseAtlas",value:function(){var e=this,t=[],n=[[-21.5,70.2,-.1],[28.4,69.1,-.4],[-54.8,33.9,-3.5],[56.6,30.8,-4.1]];function r(e,t){var n=[];return e.forEach((function(e,r){n.push(.5*(e+t[r]))})),n}var i=[r(n[0],n[2]),r(n[1],n[3]),[-80.2,-31.3,-10.7],[81.9,-34.2,-8.2]];return["AF7","AF8","TP9","TP10"].forEach((function(n,r){t.push(e.genEEGCoordinateStruct(n,i[r][0],i[r][1],i[r][2]))})),t}},{key:"gen10_20Atlas",value:function(e){var t=this,n={FP1:[-21.2,66.9,12.1],FPZ:[1.4,65.1,11.3],FP2:[24.3,66.3,12.5],AF7:[-41.7,52.8,11.3],AF3:[-32.7,48.4,32.8],AFZ:[1.8,54.8,37.9],AF4:[35.1,50.1,31.1],AF8:[43.9,52.7,9.3],F5:[-51.4,26.7,24.7],F3:[-39.7,25.3,44.7],F1:[-22.1,26.8,54.9],FZ:[0,26.8,60.6],F2:[23.6,28.2,55.6],F4:[41.9,27.5,43.9],F6:[52.9,28.7,25.2],F7:[-52.1,28.6,3.8],F8:[53.2,28.4,3.1],FC5:[-59.1,3,26.1],FC3:[-45.5,2.4,51.3],FC1:[-24.7,.3,66.4],FCZ:[1,1,72.8],FC2:[26.1,3.2,66],FC4:[47.5,4.6,49.7],FC6:[60.5,4.9,25.5],FT9:[-53.8,-2.1,-29.1],FT7:[-59.2,3.4,-2.1],FT8:[60.2,4.7,-2.8],FT10:[55,-3.6,-31],T7:[-65.8,-17.8,-2.9],T5:[-61.5,-65.3,1.1],T3:[-70.2,-21.3,-10.7],T4:[71.9,-25.2,-8.2],T6:[59.3,-67.6,3.8],T8:[67.4,-18.5,-3.4],C5:[-63.6,-18.9,25.8],C3:[-49.1,-20.7,53.2],C1:[-25.1,-22.5,70.1],CZ:[.8,-21.9,77.4],C2:[26.7,-20.9,69.5],C4:[50.3,-18.8,53],C6:[65.2,-18,26.4],CP5:[-61.8,-46.2,22.5],CP3:[-46.9,-47.7,49.7],CP1:[-24,-49.1,66.1],CPZ:[.7,-47.9,72.6],CP2:[25.8,-47.1,66],CP4:[49.5,-45.5,50.7],CP6:[62.9,-44.6,24.4],TP9:[-73.6,-46.7,-4],TP7:[-63.6,-44.7,-4],TP8:[64.6,-45.4,-3.7],TP10:[74.6,-47.4,-3.7],P9:[-50.8,-51.3,-37.7],P7:[-55.9,-64.8,0],P5:[-52.7,-67.1,19.9],P3:[-41.4,-67.8,42.4],P1:[-21.6,-71.3,52.6],PZ:[.7,-69.3,56.9],P2:[24.4,-69.9,53.5],P4:[44.2,-65.8,42.7],P6:[54.4,-65.3,20.2],P8:[56.4,-64.4,.1],P10:[51,-53.9,-36.5],PO7:[-44,-81.7,1.6],PO3:[-33.3,-84.3,26.5],POZ:[0,-87.9,33.5],PO4:[35.2,-82.6,26.1],PO8:[43.3,-82,.7],O1:[-25.8,-93.3,7.7],Oz:[.3,-97.1,8.7],O2:[25,-95.2,6.2]},r=[];if(null==e)for(var i in n)r.push(this.genEEGCoordinateStruct(i,n[i][0],n[i][1],n[i][2]));else e.forEach((function(e){var i=e.tag;n[i]&&r.push(t.genEEGCoordinateStruct(i,n[i][0],n[i][1],n[i][2]))})),["FP1","FP2","FZ","F3","F4","F7","F8","CZ","C3","C4","T3","T4","T5","T6","PZ","P3","P4","O1","O2"].forEach((function(e,i){r.find((function(t){return t.tag===e}))||r.push(t.genEEGCoordinateStruct(e,n[e][0],n[e][1],n[e][2]))}));return r}},{key:"genCoherenceStruct",value:function(e,t,n,r){var i={scp:[],delta:[],theta:[],alpha1:[],alpha2:[],beta:[],lowgamma:[],highgamma:[]};return{tag:e+"_"+t,x0:null==n?void 0:n.x,y0:null==n?void 0:n.y,z0:null==n?void 0:n.z,x1:null==r?void 0:r.x,y1:null==r?void 0:r.y,z1:null==r?void 0:r.z,fftCount:0,fftTimes:[],ffts:[],slices:JSON.parse(JSON.stringify(i)),means:JSON.parse(JSON.stringify(i)),lastRead:0}}},{key:"genCoherenceMap",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data.eegshared.eegChannelTags,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=1,i=0,s=0;s<e.length*(e.length+1)/2-e.length;s++){if(!1===t||!0===t&&null!==e[i].tag&&null!==e[i+r].tag&&"other"!==e[i].tag&&"other"!==e[i+r].tag&&!0===e[i].analyze&&!0===e[i+r].analyze){var a=this.getEEGDataByTag(e[i].tag),o=this.getEEGDataByTag(e[i+r].tag);n.push(this.genCoherenceStruct(e[i].tag,e[i+r].tag,a.position,o.position))}++r+i===e.length&&(i++,r=1)}return n}},{key:"genHEGStruct",value:function(e,t,n,r){return{tag:e,position:{x:t,y:n,z:r},count:0,times:[],red:[],ir:[],ambient:[],ratio:[],beat_detect:{beats:[],breaths:[],rir:[],rir2:[],drir_dt:[],localmins:[],localmaxs:[],val_dists:[],peak_dists:[],localmins2:[],localmaxs2:[],val_dists2:[],peak_dists2:[]},lastRead:0,startTime:0}}},{key:"addHEGCoord",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"heg1",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.data.heg.push(this.genHEGStruct(e,t,n,r))}},{key:"genFNIRSStruct",value:function(e,t,n,r){return{tag:e,position:{x:t,y:n,z:r},count:0,times:[],red:[],ir:[],ir2:[],ambient:[],lastRead:0}}},{key:"addFNIRSCoord",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"banana1",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.data.fnirs.push(this.genHEGStruct(e,t,n,r))}},{key:"genAccelerometerStruct",value:function(e,t,n,r){return{tag:e,position:{x:t,y:n,z:r},count:0,times:[],Ax:[],Ay:[],Az:[],Gx:[],Gy:[],Gz:[],lastRead:0,startTime:0}}},{key:"addAccelerometerCoord",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"accel1",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.data.accelerometer.push(this.genAccelerometerStruct(e,t,n,r))}},{key:"genHRVStruct",value:function(e){return{tag:e,count:0,times:[],raw:[],filtered:[],bpm:[],hrv:[],lastRead:0,startTime:0}}},{key:"addHRV",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hrv1";this.data.hrv.push(genHRVStruct(e))}},{key:"genEyeTrackerStruct",value:function(e){return{tag:e,count:0,times:[],x:[],y:[],smax:[],smay:[],lastRead:0,startTime:0}}},{key:"addEyeTracker",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eyes";this.data.eyetracker.push(this.genEyeTrackerStruct(e))}},{key:"makeNote",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"event",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(void 0===t){if(this.settings.eeg){var n=this.getEEGDataByChannel(this.data.eegshared.eegChannelTags[0].ch);t=n.times[n.times.length-1],this.data.other.notes.push({time:t,note:e})}this.settings.heg?(t=this.data.heg[0].times[this.data.heg[0].times.length-1],this.data.other.notes.push({time:t,note:e})):this.data.other.notes.push({time:Date.now(),note:e})}else this.data.other.notes.push({time:t,note:e})}},{key:"getCoordPositions",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eeg",t=[],n=0;n<this.data[e].length;n++)t.push([this.data[e][n].position.x,this.data[e][n].position.y,this.data[e][n].position.z]);return t}},{key:"mean",value:function(e){return e.reduce((function(e,t){return t+e}))/e.length}},{key:"isExtrema",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"peak",n=Q(e);if(n.length%2==0&&n.pop(),e.length>1){var r=!0;return n.forEach((function(e,i){"peak"===t?(i<Math.floor(.5*n.length)&&e>=n[Math.floor(.5*n.length)]||i>Math.floor(.5*n.length)&&e>=n[Math.floor(.5*n.length)])&&(r=!1):(i<Math.floor(.5*n.length)&&e<=n[Math.floor(.5*n.length)]||i>Math.floor(.5*n.length)&&e<=n[Math.floor(.5*n.length)])&&(r=!1)})),"peak"!==t&&"valley"!==t&&!1===r&&(r=!0,n.forEach((function(e,t){(t<Math.floor(.5*n.length)&&e>=n[Math.floor(.5*n.length)]||t>Math.floor(.5*n.length)&&e>=n[Math.floor(.5*n.length)])&&(r=!1)}))),r}}},{key:"isCriticalPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"peak",n=Q(e);if(n.length%2==0&&n.pop(),e.length>1){var r=!0;return n.forEach((function(e,i){"peak"===t?(i<.5*n.length&&e<=0||i>.5*n.length&&e>0)&&(r=!1):(i<.5*n.length&&e>=0||i>.5*n.length&&e<0)&&(r=!1)})),"peak"!==t&&"valley"!==t&&!1===r&&(r=!0,n.forEach((function(e,t){(t<.5*n.length&&e<=0||t>.5*n.length&&e>0)&&(r=!1)}))),r}}},{key:"setDefaultTags",value:function(){return[{ch:0,tag:null},{ch:1,tag:null},{ch:2,tag:null},{ch:3,tag:null},{ch:4,tag:null},{ch:5,tag:null},{ch:6,tag:null},{ch:7,tag:null},{ch:8,tag:null},{ch:9,tag:null},{ch:10,tag:null},{ch:11,tag:null},{ch:12,tag:null},{ch:13,tag:null},{ch:14,tag:null},{ch:15,tag:null},{ch:16,tag:null},{ch:17,tag:null},{ch:18,tag:null},{ch:19,tag:null},{ch:20,tag:null},{ch:21,tag:null},{ch:22,tag:null},{ch:23,tag:null},{ch:24,tag:null},{ch:25,tag:null},{ch:26,tag:null},{ch:27,tag:null},{ch:28,tag:null},{ch:29,tag:null},{ch:30,tag:null},{ch:31,tag:null}]}},{key:"getBandFreqs",value:function(e){var t=[[],[]],n=[[],[]],r=[[],[]],i=[[],[]],s=[[],[]],a=[[],[]],o=[[],[]],u=[[],[]];return e.forEach((function(e,c){e>=.1&&e<=1?(t[0].push(e),t[1].push(c)):e>=1&&e<=4?(n[0].push(e),n[1].push(c)):e>4&&e<=8?(r[0].push(e),r[1].push(c)):e>8&&e<=10?(i[0].push(e),i[1].push(c)):e>10&&e<=12?(s[0].push(e),s[1].push(c)):e>12&&e<=30?(a[0].push(e),a[1].push(c)):e>30&&e<=45?(o[0].push(e),o[1].push(c)):e>45&&(u[0].push(e),u[1].push(c))})),{scp:t,delta:n,theta:r,alpha1:i,alpha2:s,beta:a,lowgamma:o,highgamma:u}}},{key:"bandpassWindow",value:function(e,t,n){for(var r=(t-e)/n,i=[],s=0;s<t;)i.push(s),s+=r;return i}},{key:"toISOLocal",value:function(e){var t=function(e){return("0"+e).slice(-2)},n=e.getTimezoneOffset(),r=n<0?"+":"-";return n=Math.abs(n),e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+("00"+e.getMilliseconds()).slice(-3)+"(UTC"+r+t(n/60|0)+":00)"}},{key:"regenAtlasses",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512;this.data.eeg=this.makeAtlas10_20();var r=this.bandPassWindow(e,t,n);this.data.eegshared.frequencies=r,this.data.eegshared.bandFreqs=this.getBandFreqs(r),this.coherenceMap=this.genCoherenceMap()}},{key:"addDefaultAnalyzerFuncs",value:function(){var e=this;this.analyzerOpts.push("eegfft","eegcoherence"),this.analyzerFuncs.push((function(){if(!1===e.workerWaiting){var t=e.bufferEEGSignals(1);t.length>0&&t[0].length>=e.data.eegshared.sps&&(li({foo:"multidftbandpass",input:[t,1,0,128,1],origin:e.name},e.workerIdx),e.workerWaiting=!0)}}),(function(){if(!1===e.workerWaiting){var t=e.bufferEEGSignals(1);t.length>0&&t[0].length>=e.data.eegshared.sps&&(li({foo:"coherence",input:[t,1,0,128,1],origin:e.name},e.workerIdx),e.workerWaiting=!0)}}))}},{key:"addAnalyzerFunc",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=this.analyzerOpts.find((function(t,r){if(t==t)return e.analyzerFuncs[r]=n,!0}));void 0===r&&(this.analyzerOpts.push(t),this.analyzerFuncs.push(n))}},{key:"checkRollover",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===t)for(var n in this.data)Array.isArray(this.data[n])&&this.data[n].forEach((function(t,n){for(var r in t)if(Array.isArray(t[r])||"object"!==Z(t[r]))Array.isArray(t[r])&&t[r].length>e.rolloverLimit&&(t[r].splice(0,t[r].length-e.rolloverLimit-2e3),"ffts"===r?(t.fftCount=t[r].length,t.lastReadFFT>t[r].length&&(t.lastReadFFT=t[r].length)):"times"===r&&(t.count=t[r].length,t.lastRead>t[r].length&&(t.lastRead=t[r].length)));else for(var i in t[r])Array.isArray(t[r][i])&&t[r][i].length>e.rolloverLimit&&t[r][i].splice(0,t[r][i].length-e.rolloverLimit-2e3)}));else Array.isArray(this.data[t])&&this.data[t].forEach((function(t,n){for(var r in t)if(Array.isArray(t[r])||"object"!==Z(t[r]))Array.isArray(t[r])&&t[r].length>e.rolloverLimit&&(t[r].splice(0,t[r].length-e.rolloverLimit-2e3),"ffts"===r?(t.fftCount=t[r].length,t.lastReadFFT=t[r].length):"times"===r&&(t.count=t[r].length,t.lastRead=t[r].length));else for(var i in t[r])Array.isArray(t[r][i])&&t[r][i].length>e.rolloverLimit&&t[r][i].splice(0,t[r][i].length-e.rolloverLimit-2e3)}))}}])&&te(t.prototype,n),e}();function re(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function ie(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){re(s,r,i,a,o,"next",e)}function o(e){re(s,r,i,a,o,"throw",e)}a(void 0)}))}}function se(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ce=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.onDecodedCallback,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onConnectedCallback,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onDisconnectedCallback,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.decode,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:115200;oe(this,e),this.onDecodedCallback=t,this.onConnectedCallback=n,this.onDisconnectedCallback=r,this.decode=i,this.connected=!1,this.subscribed=!1,this.buffer=[],this.startByte=160,this.stopByte=192,this.searchString=new Uint8Array([this.stopByte,this.startByte]),this.readRate=16.666667,this.readBufferSize=2e3,this.sps=512,this.nChannels=32,this.nPeripheralChannels=6,this.updateMs=1e3/this.sps,this.stepSize=1/Math.pow(2,24),this.vref=2.5,this.gain=8,this.vscale=this.vref/this.gain*this.stepSize,this.uVperStep=this.vref/this.gain*this.stepSize*1e6,this.scalar=1/(1e6/(this.vref/this.gain*this.stepSize)),this.maxBufferedSamples=60*this.sps*2,this.data={count:0,startms:0,ms:[],A0:[],A1:[],A2:[],A3:[],A4:[],A5:[],A6:[],A7:[],A8:[],A9:[],A10:[],A11:[],A12:[],A13:[],A14:[],A15:[],A16:[],A17:[],A18:[],A19:[],A20:[],A21:[],A22:[],A23:[],A24:[],A25:[],A26:[],A27:[],A28:[],A29:[],A30:[],A31:[],Ax:[],Ay:[],Az:[],Gx:[],Gy:[],Gz:[]},this.resetDataBuffers(),navigator.serial||console.error("`navigator.serial not found! Enable #enable-experimental-web-platform-features in chrome://flags (search 'experimental')"),this.port=null,this.reader=null,this.baudrate=s}var t,n,r,i,s,a,o;return t=e,(n=[{key:"resetDataBuffers",value:function(){for(var e in this.data.count=0,this.data.startms=0,this.data)"object"===ae(this.data[e])&&(this.data[e]=new Array(this.maxBufferedSamples).fill(0))}},{key:"setScalar",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/(Math.pow(2,23)-1),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4.5;this.stepSize=t,this.vref=n,this.gain=e,this.vscale=this.vref/this.gain*this.stepSize,this.uVperStep=this.vref/this.gain*this.stepSize*1e6,this.scalar=1/(1e6/(this.vref/this.gain*this.stepSize))}},{key:"getLatestData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"A0",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=t;return n<=1?[this.data[e][this.data.count-1]]:(n>this.data.count&&(n=this.data.count),this.data[e].slice(this.data.count-n,this.data.count))}},{key:"bytesToInt16",value:function(e,t){return 256*e+t}},{key:"int16ToBytes",value:function(e){return[255&e,e>>8&255]}},{key:"bytesToInt24",value:function(e,t,n){return 65536*e+256*t+n}},{key:"int24ToBytes",value:function(e){return[255&e,e>>8&255,e>>16&255]}},{key:"decode",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.buffer,t=this.searchString,n=e,r=this.boyerMoore(t),i=r.byteLength,s=[],a=0,o=r(n);-1!==o;o=r(n,o+i))s.push(o);if(s.length>=2){for(var u=1;u<s.length;u++)if(s[u]-s[u-1]!=105);else{var c=e.slice(s[u-1],s[u]+1);for(this.data.count<this.maxBufferedSamples&&this.data.count++,this.data.count-1==0?(this.data.ms[this.data.count-1]=Date.now(),this.data.startms=this.data.ms[0]):(this.data.ms[this.data.count-1]=this.data.ms[this.data.count-2]+this.updateMs,this.data.count>=this.maxBufferedSamples&&(this.data.ms.splice(0,5120),this.data.ms.push(new Array(5120).fill(0)))),o=3;o<99;o+=3){var l="A"+(o-3)/3;this.data[l][this.data.count-1]=this.bytesToInt24(c[o],c[o+1],c[o+2]),this.data.count>=this.maxBufferedSamples&&(this.data[l].splice(0,5120),this.data[l].push(new Array(5120).fill(0)))}this.data.Ax[this.data.count-1]=this.bytesToInt16(c[99],c[100]),this.data.Ay[this.data.count-1]=this.bytesToInt16(c[101],c[102]),this.data.Az[this.data.count-1]=this.bytesToInt16(c[103],c[104]),this.data.count>=this.maxBufferedSamples&&(this.data.Ax.splice(0,5120),this.data.Ay.splice(0,5120),this.data.Az.splice(0,5120),this.data.Ax.push(new Array(5120).fill(0)),this.data.Ay.push(new Array(5120).fill(0)),this.data.Az.push(new Array(5120).fill(0)),this.data.count-=5120),a++}return a>0&&e.splice(0,s[s.length-1]),a}}},{key:"onDecodedCallback",value:function(e){}},{key:"onConnectedCallback",value:function(){console.log("port connected!")}},{key:"onDisconnectedCallback",value:function(){console.log("port disconnected!")}},{key:"onReceive",value:function(e){var t,n;(t=this.buffer).push.apply(t,function(e){if(Array.isArray(e))return se(e)}(n=e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return se(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?se(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var r=this.decode(this.buffer);!1===r||0===r||isNaN(r)||this.onDecodedCallback(r)}},{key:"onPortSelected",value:(o=ie(regeneratorRuntime.mark((function e(t){var n,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:this.baudrate,e.prev=1,e.prev=2,e.next=5,t.open({baudRate:n,bufferSize:this.readBufferSize});case 5:this.onConnectedCallback(),this.connected=!0,this.subscribed=!0,this.subscribe(t),e.next=19;break;case 11:return e.prev=11,e.t0=e.catch(2),e.next=15,t.open({baudrate:n,buffersize:this.readBufferSize});case 15:this.onConnectedCallback(),this.connected=!0,this.subscribed=!0,this.subscribe(t);case 19:e.next=25;break;case 21:e.prev=21,e.t1=e.catch(1),console.log(e.t1),this.connected=!1;case 25:case"end":return e.stop()}}),e,this,[[1,21],[2,11]])}))),function(e){return o.apply(this,arguments)})},{key:"subscribe",value:(a=ie(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.port.readable&&!0===this.subscribed&&(this.reader=t.readable.getReader(),(n=function(){var e=ie(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.reader.read();case 3:if(t=e.sent,i=t.value,!t.done&&!1!==r.subscribed){e.next=9;break}return e.next=9,r.reader.releaseLock();case 9:if(i)try{r.onReceive(i)}catch(e){console.log(e)}!0===r.subscribed&&setTimeout((function(){n()}),r.readRate),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0),r.closePort();case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}())());case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"subscribeSafe",value:(s=ie(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:new Promise((function(e,r){for(;n.port.readable&&!0===n.subscribed;){n.reader=t.readable.getReader();for(var i=!0,s=new Promise((function(e,t){return n.reader.read()})),a=new Promise((function(e,t){setTimeout(e,100,"readfail")}));!0===i;)Promise.race([s,a]).then((function(e){if(console.log("newpromise"),"readfail"===e)console.log(e);else{var t=e.value;!0===e.done||!0===n.subscribed?new Promise((function(e,t){e(n.reader.releaseLock())})).then((function(){i=!1})):n.onReceive(t)}}))}e("not readable")}));case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"closePort",value:(i=ie(regeneratorRuntime.mark((function e(){var t,n=this,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]?r[0]:this.port,this.port&&(this.subscribed=!1,setTimeout(ie(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.reader){e.next=4;break}return e.next=3,n.reader.releaseLock();case 3:n.reader=null;case 4:return e.next=6,t.close();case 6:n.port=null,n.connected=!1,n.onDisconnectedCallback();case 9:case"end":return e.stop()}}),e)}))),100));case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setupSerialAsync",value:(r=ie(regeneratorRuntime.mark((function e(){var t,n=this,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:this.baudrate,e.next=4,navigator.serial.requestPort();case 4:this.port=e.sent,navigator.serial.addEventListener("disconnect",(function(e){n.closePort(n.port)})),this.onPortSelected(this.port,t);case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"asUint8Array",value:function(e){if(e instanceof Uint8Array)return e;if("string"==typeof e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r>127)throw new TypeError("Only ASCII patterns are supported");t[n]=r}return t}return new Uint8Array(e)}},{key:"boyerMoore",value:function(e){var t=this,n=this.asUint8Array(e),r=n.length;if(0===r)throw new TypeError("patternBuffer must be at least 1 byte long");for(var i=new Int32Array(256),s=0;s<256;s++)i[s]=-1;for(var a=0;a<r;a++)i[n[a]]=a;var o=function(e,r,s){var a=t.asUint8Array(e);void 0===r&&(r=0),void 0===s&&(s=a.length);for(var o,u=n,c=i,l=s-u.length,h=u.length-1,p=r;p<=l;p+=o){o=0;for(var d=h;d>=0;d--){var f=a[p+d];if(u[d]!==f){o=Math.max(1,d-c[f]);break}}if(0===o)return p}return-1};return o.byteLength=n.byteLength,o}}])&&ue(t.prototype,n),e}();function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pe(e,t,n){return t&&he(e.prototype,t),n&&he(e,n),e}var de=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/Math.sqrt(2),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;le(this,e);var a=["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"];if(a.indexOf(t)<0)return console.error("Valid types: 'lowpass','highpass','bandpass','notch','peak','lowshelf','highshelf'"),!1;this.type=t,this.freq=n,this.sps=r,this.Q=i,this.dbGain=s,this.a0=0,this.a1=0,this.a2=0,this.b0=0,this.b1=0,this.b2=0,this.x1=0,this.x2=0,this.y1=0,this.y2=0;var o=Math.pow(10,s/40),u=2*Math.PI*n/r,c=Math.sin(u),l=Math.cos(u),h=c/(2*i),p=Math.sqrt(o+o);this[t](o,c,l,h,p),this.b0/=this.a0,this.b1/=this.a0,this.b2/=this.a0,this.a1/=this.a0,this.a2/=this.a0}return pe(e,[{key:"lowpass",value:function(e,t,n,r,i){this.b0=.5*(1-n),this.b1=1-n,this.b2=.5*(1-n),this.a0=1+r,this.a1=-2*n,this.a2=1-r}},{key:"highpass",value:function(e,t,n,r,i){this.b0=.5*(1+n),this.b1=-(1+n),this.b2=.5*(1+n),this.a0=1+r,this.a1=-2*n,this.a2=1-r}},{key:"bandpass",value:function(e,t,n,r,i){this.b0=r,this.b1=0,this.b2=-r,this.a0=1+r,this.a1=-2*n,this.a2=1-r}},{key:"notch",value:function(e,t,n,r,i){this.b0=1,this.b1=-2*n,this.b2=1,this.a0=1+r,this.a1=-2*n,this.a2=1-r}},{key:"peak",value:function(e,t,n,r,i){this.b0=1+r*e,this.b1=-2*n,this.b2=1-r*e,this.a0=1+r/e,this.a1=-2*n,this.a2=1-r/e}},{key:"lowshelf",value:function(e,t,n,r,i){this.b0=e*(e+1-(e-1)*n+i*t),this.b1=2*e*(e-1-(e+1)*n),this.b2=e*(e+1-(e-1)*n-i*t),this.a0=e+1+(e+1)*n+i*t,this.a1=2*(e-1+(e+1)*n),this.a2=e+1+(e-1)*n-i*t}},{key:"highshelf",value:function(e,t,n,r,i){this.b0=e*(e+1+(e-1)*n+i*t),this.b1=2*e*(e-1+(e+1)*n),this.b2=e*(e+1-(e-1)*n-i*t),this.a0=e+1-(e+1)*n-i*t,this.a1=2*(e-1-(e+1)*n),this.a2=e+1-(e-1)*n-i*t}},{key:"applyFilter",value:function(e){var t=this.b0*e+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;return this.x2=this.x1,this.x1=e,this.y2=this.y1,this.y1=t,t}},{key:"zResult",value:function(e){try{var t=Math.pow(Math.sin(Math.PI*e*2/(2*this.sps)),2);return(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*t+16*this.b0*this.b2*t*t)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*t+16*this.a2*t*t)}catch(e){return-200}}}],[{key:"calcCenterFrequency",value:function(e,t){return(e+t)/2}},{key:"calcBandwidth",value:function(e,t){return t-this.calcCenterFrequency(e,t)}},{key:"calcBandpassQ",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.pow(10,Math.floor(Math.log10(e))),r=n*Math.sqrt((e-t)*(e+t))/(2*t);return r}},{key:"calcNotchQ",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.pow(10,Math.floor(Math.log10(e))),r=n*e*t/Math.sqrt((e-t)*(e+t));return r}}]),e}(),fe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.995;le(this,e),this.r=t,this.y1=this.y2=this.x1=this.x2=0}return pe(e,[{key:"applyFilter",value:function(e){this.x2=this.x1,this.x1=e;var t=this.x1-this.x2+this.r*this.y1;return this.y2=this.y1,this.y1=t,t}}]),e}(),me=function(e,t,n){return new de("notch",e,t,de.calcNotchQ(e,n),0)},ge=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.pow(10,Math.floor(Math.log10(de.calcCenterFrequency(e,t))));return new de("bandpass",de.calcCenterFrequency(e,t),n,de.calcBandpassQ(de.calcCenterFrequency(e,t),de.calcBandwidth(e,t),r),0)},ye=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"A0",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;le(this,e),this.channel=t,this.idx=0,this.sps=n,this.filtering=r,this.bplower=3,this.bpupper=45,this.scalingFactor=i,this.useSMA4=!1,this.last4=[],this.useNotch50=!0,this.useNotch60=!0,this.useLp1=!1,this.useBp1=!1,this.useDCB=!0,this.useScaling=!1,this.notch50=[me(50,n,1),me(100,n,1)],this.notch60=[me(60,n,1),me(120,n,1)],this.lp1=[new de("lowpass",50,n),new de("lowpass",50,n),new de("lowpass",50,n),new de("lowpass",50,n)],this.bp1=[ge(this.bplower,this.bpupper,n,9.75),ge(this.bplower,this.bpupper,n,9.75),ge(this.bplower,this.bpupper,n,9.75),ge(this.bplower,this.bpupper,n,9.75)],this.dcb=new fe(.995)}return pe(e,[{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sps;this.notch50=me(50,e,1),this.notch60=me(60,e,1),this.lp1=[new de("lowpass",50,e),new de("lowpass",50,e),new de("lowpass",50,e),new de("lowpass",50,e)],this.bp1=[ge(this.bplower,this.bpupper,e,9.75),ge(this.bplower,this.bpupper,e,9.75),ge(this.bplower,this.bpupper,e,9.75),ge(this.bplower,this.bpupper,e,9.75)],this.dcb=new fe(.995)}},{key:"setBandpass",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.bplower,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.bpupper,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.sps;this.bplower=e,this.bpupper=t,this.bp1=[ge(e,t,n),ge(e,t,n),ge(e,t,n),ge(e,t,n)]}},{key:"apply",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastidx+1,n=e;return!0===this.filtering&&(!0===this.useDCB&&(n=this.dcb.applyFilter(n)),!0===this.useSMA4&&(t<4||(n=this.last4.reduce((function(e,t){return e+t}))/this.last4.length,this.last4.shift()),this.last4.push(n)),!0===this.useNotch50&&this.notch50.forEach((function(e,t){n=e.applyFilter(n)})),!0===this.useNotch60&&this.notch60.forEach((function(e,t){n=e.applyFilter(n)})),!0===this.useLp1&&this.lp1.forEach((function(e,t){n=e.applyFilter(n)})),!0===this.useBp1&&(this.bp1.forEach((function(e,t){n=e.applyFilter(n)})),n*=this.bp1.length),!0===this.useScaling&&(n*=this.scalingFactor)),this.lastidx=t,n}}]),e}();function ve(e){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var we=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.templateStringGen,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(e){},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NEVER";be(this,e),this.onchange=function(){arguments.length>0&&void 0!==arguments[0]||t.renderSettings.props},this.onRender=function(){arguments.length>0&&void 0!==arguments[0]||t.renderSettings.props},this.onRender=s,this.onchange=a,this.parentNode=r,"string"==typeof r&&(this.parentNode=document.getElementById(r)),this.renderSettings={templateStringGen:n,props:i},this.templateString="",this.templateString="function"==typeof n?n(i):n;var u=o;if(this.renderSettings.props==={}&&(u="NEVER"),this.node=null,this.listener=new V,Object.keys(this.renderSettings.props).length>0&&null!=u&&"NEVER"!==u){console.log("making listeners for ",n);var c=function(){t.updateNode()};this.listener.addListener("templateChange",this.renderSettings,"templateStringGen",c,u);var l=function(){t.updateNode(),t.onchange()};this.listener.addListener("props",this.renderSettings,"props",l,u)}this.renderNode()}var t,n;return t=e,(n=[{key:"appendFragment",value:function(e,t){var n=document.createElement("template");n.innerHTML=e;var r=n.content;return t.appendChild(r),t.children[t.children.length-1]}},{key:"deleteFragment",value:function(e,t){var n=document.getElementById(t);e.removeChild(n)}},{key:"removeParent",value:function(e){var t=document.getElementById(e);t.parentNode.parentNode.removeChild(t.parentNode)}},{key:"renderNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parentNode;this.node=this.appendFragment(this.templateString,e),this.onRender()}},{key:"updateNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parentNode,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.node,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.props;e.removeChild(t),"function"==typeof this.renderSettings.templateStringGen?this.templateString=this.renderSettings.templateStringGen(this.props):this.templateString=this.renderSettings.templateStringGen,this.renderNode(e,n)}},{key:"deleteNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.node;"string"==typeof e?(thisNode=document.getElementById(e),thisNode.parentNode.removeChild(thisNode),this.node=null):"object"===ve(e)&&(e.parentNode.removeChild(e),this.node=null)}},{key:"appendStylesheet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.node;if("string"==typeof e){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=e,t.insertAdjacentElement("afterbegin",n)}else if(Array.isArray(e))e.forEach((function(e){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=e,t.insertAdjacentElement("afterbegin",n)}));else if("function"==typeof e){var r=e();t.insertAdjacentHTML("afterbegin",r)}}}])&&xe(t.prototype,n),e}();function Se(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function Te(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){Se(s,r,i,a,o,"next",e)}function o(e){Se(s,r,i,a,o,"throw",e)}a(void 0)}))}}function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e){return function(e){if(Array.isArray(e))return _e(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return _e(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_e(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Ie=function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"freeeeg32_2",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;ke(this,e),this.init=function(e,n){if(e.sps=512,e.deviceType="eeg","freeeeg32_2"===t.mode?e.eegChannelTags=[{ch:4,tag:"FP2",analyze:!0},{ch:24,tag:"FP1",analyze:!0},{ch:8,tag:"other",analyze:!1}]:"freeeeg32_19"===t.mode?e.eegChannelTags=[{ch:4,tag:"FP2",analyze:!0},{ch:24,tag:"FP1",analyze:!0},{ch:0,tag:"O2",analyze:!0},{ch:1,tag:"T6",analyze:!0},{ch:2,tag:"T4",analyze:!0},{ch:3,tag:"F8",analyze:!0},{ch:5,tag:"F4",analyze:!0},{ch:6,tag:"C4",analyze:!0},{ch:7,tag:"P4",analyze:!0},{ch:25,tag:"F3",analyze:!0},{ch:26,tag:"C3",analyze:!0},{ch:27,tag:"P3",analyze:!0},{ch:28,tag:"O1",analyze:!0},{ch:29,tag:"T5",analyze:!0},{ch:30,tag:"T3",analyze:!0},{ch:31,tag:"F7",analyze:!0},{ch:16,tag:"FZ",analyze:!0},{ch:12,tag:"PZ",analyze:!0},{ch:8,tag:"other",analyze:!1}]:e.eegChannelTags=[{ch:4,tag:"FP2",analyze:!0},{ch:24,tag:"FP1",analyze:!0},{ch:8,tag:"other",analyze:!1}],t.device=new ce((function(n){t.atlas.data.eegshared.eegChannelTags.forEach((function(r,i){var s,a,o,u,c=t.device.getLatestData("A"+r.ch,n),l=new Array(c.length).fill(0);if("other"!==r.tag&&!0===e.useFilters)t.filters.forEach((function(e,t){e.channel===r.ch&&c.forEach((function(t,n){l[n]=e.apply(t)}))})),!0===e.useAtlas&&((u=null!==r.tag?t.atlas.getEEGDataByTag(r.tag):t.atlas.getEEGDataByChannel(r.ch)).count+=n,(s=u.times).push.apply(s,Ae(t.device.data.ms.slice(t.device.data.count-n,t.device.data.count))),(a=u.filtered).push.apply(a,Ae(l)),(o=u.raw).push.apply(o,Ae(c)));else if(!0===e.useAtlas){var h,p,d=t.atlas.getEEGDataByChannel(r.ch);d.count+=n,(h=d.times).push.apply(h,Ae(t.device.data.ms.slice(t.device.data.count-n,t.device.data.count))),(p=d.raw).push.apply(p,Ae(c))}}))}),(function(){!0===e.useAtlas&&(t.atlas.data.eegshared.startTime=Date.now(),!0!==t.atlas.settings.analyzing&&e.analysis.length>0&&(t.atlas.settings.analyzing=!0,t.atlas.settings.deviceConnected=!0,setTimeout((function(){t.atlas.analyzer()}),1200)),t.onconnect())}),(function(){t.atlas.settings.analyzing=!1,t.ondisconnect()})),!0===e.useFilters&&e.eegChannelTags.forEach((function(n,r){"other"!==n.tag?t.filters.push(new ye(n.ch,e.sps,!0,t.device.uVperStep)):t.filters.push(new ye(n.ch,e.sps,!1,t.device.uVperStep)),t.filters[t.filters.length-1].useScaling=!0})),!0===n)t.atlas=new ne(location+":"+t.mode,{eegshared:{eegChannelTags:e.eegChannelTags,sps:e.sps}},"10_20",!0,!0,e.analysis),e.useAtlas=!0;else if("object"===Ce(n)){var r;t.atlas=n,t.atlas.data.eegshared.eegChannelTags=e.eegChannelTags,t.atlas.data.eegshared.sps=e.sps,t.atlas.data.eegshared.frequencies=t.atlas.bandpassWindow(0,128,.5*e.sps),t.atlas.data.eegshared.bandFreqs=t.atlas.getBandFreqs(t.atlas.data.eegshared.frequencies),t.atlas.data.eeg=t.atlas.gen10_20Atlas(),t.atlas.data.coherence=t.atlas.genCoherenceMap(e.eegChannelTags),t.atlas.data.eegshared.eegChannelTags.forEach((function(e,n){void 0===t.atlas.getEEGDataByTag(e.tag)&&t.atlas.addEEGCoord(e.ch)})),t.atlas.settings.coherence=!0,t.atlas.settings.eeg=!0,e.useAtlas=!0,e.analysis.length>0&&((r=t.atlas.settings.analysis).push.apply(r,Ae(e.analysis)),t.atlas.settings.analyzing||(t.atlas.settings.analyzing=!0,t.atlas.analyzer()))}},this.connect=Te(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.device.setupSerialAsync();case 2:t.setIndicator(!0);case 3:case"end":return e.stop()}}),e)}))),this.disconnect=function(){t.device.closePort(),t.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){arguments.length>0&&void 0!==arguments[0]||document.body,Math.floor(1e4*Math.random())},this.atlas=null,this.mode=n,this.device=null,this.filters=[],this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?(document.getElementById("brainsatplay-".concat(t.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(t.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(t.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(t.mode,"-indicator")).style.border="1px solid white")}},Ee=n(2306);function Oe(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function De(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){Oe(s,r,i,a,o,"next",e)}function o(e){Oe(s,r,i,a,o,"throw",e)}a(void 0)}))}}function Be(e){return function(e){if(Array.isArray(e))return Pe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Re=function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;Ne(this,e),this.init=function(e,t){if(e.sps=256,e.deviceType="eeg",e.eegChannelTags=[{ch:0,tag:"TP9",analyze:!0},{ch:1,tag:"AF7",analyze:!0},{ch:2,tag:"AF8",analyze:!0},{ch:3,tag:"TP10",analyze:!0}],n.device=new Ee.MuseClient,!0===e.useFilters&&e.eegChannelTags.forEach((function(t,r){"other"!==t.tag?n.filters.push(new ye(t.ch,e.sps,!0,1)):n.filters.push(new ye(t.ch,e.sps,!1,1))})),!0===t)n.atlas=new ne(location+":"+n.mode,{eegshared:{eegChannelTags:e.eegChannelTags,sps:e.sps}},"muse",!0,!0,e.analysis),e.useAtlas=!0;else if("object"===Fe(t)){var r;n.atlas=t,n.atlas.data.eegshared.eegChannelTags=e.eegChannelTags,n.atlas.data.eegshared.sps=e.sps,n.atlas.data.eegshared.frequencies=n.atlas.bandpassWindow(0,128,.5*e.sps),n.atlas.data.eegshared.bandFreqs=n.atlas.getBandFreqs(n.atlas.data.eegshared.frequencies),n.atlas.data.eeg=n.atlas.genMuseAtlas(),n.atlas.data.coherence=n.atlas.genCoherenceMap(e.eegChannelTags),n.atlas.settings.coherence=!0,n.atlas.settings.eeg=!0,e.useAtlas=!0,e.analysis.length>0&&((r=n.atlas.settings.analysis).push.apply(r,Be(e.analysis)),n.atlas.settings.analyzing||(n.atlas.settings.analyzing=!0,n.atlas.analyzer()))}n.info=e},this.connect=De(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.device.connect();case 2:return e.next=4,n.device.start();case 4:n.device.eegReadings.subscribe((function(e){if(n.info.useAtlas){var t,r,i=Array(e.samples.length).fill(e.timestamp);i=i.map((function(e,t){return e-(1-n.info.sps/i.length*t/10)}));var s=n.atlas.getEEGDataByChannel(e.electrode);if((t=s.times).push.apply(t,Be(i)),(r=s.raw).push.apply(r,Be(e.samples)),s.count+=e.samples.length,!0===n.info.useFilters){var a,o=new Array(e.samples.length).fill(0);void 0!==n.filters[e.electrode]&&e.samples.forEach((function(t,r){o[r]=n.filters[e.electrode].apply(t)})),(a=s.filtered).push.apply(a,Be(o))}}})),n.atlas.data.eegshared.startTime=Date.now(),n.atlas.settings.deviceConnected=!0,!0!==n.atlas.settings.analyzing&&n.info.analysis.length>0&&(n.atlas.settings.analyzing=!0,setTimeout((function(){n.atlas.analyzer()}),1200)),n.device.gatt.device.addEventListener("gattserverdisconnected",(function(){n.atlas.analyzing=!1,n.atlas.settings.deviceConnected=!1,n.ondisconnect()})),n.onconnect(),n.setIndicator(!0);case 11:case"end":return e.stop()}}),e)}))),this.disconnect=function(){n.device.disconnect(),n.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,t=(Math.floor(1e4*Math.random()),function(){return"\n            "}),r=function(){};n.ui=new we(t,e,void 0,r)},this.atlas=null,this.mode=t,this.device=null,this.filters=[],this.info,this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="1px solid white")}};function Le(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function Me(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){Le(s,r,i,a,o,"next",e)}function o(e){Le(s,r,i,a,o,"throw",e)}a(void 0)}))}}function ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ve(e,t,n){return t&&$e(e.prototype,t),n&&$e(e,n),e}var Ge=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"usb",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"http://192.168.4.1/";ze(this,e),this.interface=null,this.mode=t,"usb"===t||"serial"===t?this.setupSerialDevice(n,r,i):"ble"===t||"bt"===t?this.setupBLEDevice(n,r,i):"wifi"!==t&&"events"!==t&&"sse"!==t||this.setupSSEDevice(s,n,r,i)}return Ve(e,[{key:"setupSerialDevice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.interface=new We,this.interface.onConnectedCallback=t,this.interface.onReadLine=e,this.interface.onDisconnectedCallback=n}},{key:"setupBLEDevice",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.interface=new Ue,this.interface.onConnectedCallback=n,this.interface.onDisconnectedCallback=r,this.interface.onNotificationCallback=function(n){var r=e.interface.decoder.decode(n.target.value);t(r)}}},{key:"setupSSEDevice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http://192.168.4.1/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=function(e){t(e.data)};this.interface=new je(e+"events",n,r,void 0,[{tag:"heg",callback:i}]),this.interface.newPostFunction("sendCommand",e+"command")}},{key:"sendCommand",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";"usb"===this.mode||"serial"===this.mode||"ble"===this.mode||"bt"===this.mode?this.interface.sendMessage(e):"wifi"!==this.mode&&"events"!==this.mode&&"sse"!==this.mode||this.interface.sendCommand(e)}},{key:"connect",value:function(e){"usb"===this.mode||"serial"===this.mode?navigator.serial?this.interface.setupSerialAsync():chrome.serial?this.interface.connectSelected(!0,e):(console.error("ERROR: Cannot locate navigator.serial. Enable #experimental-web-platform-features in chrome://flags"),alert("Serial support not found. Enable #experimental-web-platform-features in chrome://flags or use a chrome extension")):"ble"===this.mode||"bt"===this.mode?this.interface.connect():"wifi"!==this.mode&&"events"!==this.mode&&"sse"!==this.mode||this.interface.open()}},{key:"disconnect",value:function(){"usb"===this.mode||"serial"===this.mode?navigator.serial?this.interface.closePort():this.interface.connectSelected(!1):"ble"===this.mode||"bt"===this.mode?this.interface.disconnect():"wifi"!==this.mode&&"events"!==this.mode&&"sse"!==this.mode||this.interface.close()}}]),e}(),Ue=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"6e400002-b5a3-f393-e0a9-e50e24dcca9e",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"6e400003-b5a3-f393-e0a9-e50e24dcca9e",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"main_body",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"blebutton",o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];ze(this,e),Ke.call(this),this.serviceUUID=t,this.rxUUID=n,this.txUUID=r,this.encoder=new TextEncoder("utf-8"),this.decoder=new TextDecoder("utf-8"),this.device=null,this.server=null,this.service=null,this.rxchar=null,this.txchar=null,this.parentId=s,this.buttonId=a,this.async=o,this.android=navigator.userAgent.toLowerCase().indexOf("android")>-1,this.n,!0===i&&this.initUI(s,a)}var t,n,r;return Ve(e,[{key:"initUI",value:function(e,t){var n=this;null!==this.device&&this.device.gatt.connected&&(this.device.gatt.disconnect(),console.log("device disconnected"));var r='<button id="'+t+'">BLE Connect</button>';HEGwebAPI.appendFragment(r,e),document.getElementById(t).onclick=function(){!1===n.async?n.connect():n.initBLEasync()}}},{key:"connectAsync",value:(r=Me(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.bluetooth.requestDevice({filters:[{namePrefix:"HEG"}],optionalServices:[this.serviceUUID]});case 2:return this.device=e.sent,console.log("BLE Device: ",this.device),e.next=6,null===(t=this.device.gatt)||void 0===t?void 0:t.connect();case 6:if(n=e.sent){e.next=9;break}throw"no connection";case 9:return this.device.addEventListener("gattserverdisconnected",onDisconnected),this.server=n,e.next=13,this.server.getPrimaryService(this.serviceUUID);case 13:return r=e.sent,e.next=16,r.getCharacteristic(this.rxUUID);case 16:return i=e.sent,e.next=19,i.writeValue(this.encoder.encode("t"));case 19:if(1!=this.android){e.next=22;break}return e.next=22,i.writeValue(this.encoder.encode("o"));case 22:return e.next=24,r.getCharacteristic(this.txUUID);case 24:return this.characteristic=e.sent,this.onConnectedCallback(),e.abrupt("return",!0);case 27:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"readDeviceAsync",value:(n=Me(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.characteristic){e.next=3;break}throw console.log("HEG not connected"),"error";case 3:this.doReadHeg=!0,t="";case 5:if(!this.doReadHeg){e.next=14;break}return e.t0=this.decoder,e.next=9,this.characteristic.readValue();case 9:e.t1=e.sent,(n=e.t0.decode.call(e.t0,e.t1))!==this.data&&(t=n,console.log(t),this.n+=1,this.onReadAsyncCallback(t)),e.next=5;break;case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"initBLEasync",value:(t=Me(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connectAsync();case 2:this.readDeviceasync(),this.spsinterval();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Ke=function(){var e=this;this.connect=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.serviceUUID,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.rxUUID,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.txUUID;function i(e){return function(t){return new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))}}navigator.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:[t]}).then((function(t){return e.device=t,t.gatt.connect()})).then(i(100)).then((function(e){return e.getPrimaryService(t)})).then(i(100)).then((function(t){return e.service=t,t.getCharacteristic(n).then(i(100)).then((function(t){return e.rxchar=t,t.writeValue(e.encoder.encode("t"))})),1==e.android&&t.getCharacteristic(n).then(i(1e3)).then((function(t){return t.writeValue(e.encoder.encode("o"))})),t.getCharacteristic(r)})).then(i(1100)).then((function(t){return e.txchar=t,t.startNotifications()})).then(i(100)).then((function(t){t.addEventListener("characteristicvaluechanged",e.onNotificationCallback)})).then(i(100)).then(e.onConnectedCallback()).catch((function(t){console.error(t),e.onErrorCallback(t)}))},this.onNotificationCallback=function(t){var n=e.decoder.decode(t.target.value);console.log("BLE MSG: ",n)},this.onConnectedCallback=function(){},this.sendMessage=function(t){e.rxchar.writeValue(e.encoder.encode(t))},this.disconnect=function(){var t;null===(t=e.server)||void 0===t||t.disconnect(),e.onDisconnectedCallback()},this.onDisconnectedCallback=function(){console.log("BLE device disconnected!")},this.onReadAsyncCallback=function(e){console.log("BLE Data: ",e)},this.stopReadAsync=function(){e.doReadHeg=!1,tx.writeValue(e.encoder.encode("f"))},this.spsinterval=function(){setTimeout((function(){console.log("SPS",e.n+""),e.n=0,e.spsinterval()}),1e3)}},je=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http://192.168.4.1/events",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onOpen,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onError,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.onMsg,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];ze(this,e),this.onOpen=function(e){console.log("Events Connected!",e.data)},this.onError=function(e){console.log("event source error:",e.data),e.target.readyState!==EventSource.OPEN&&console.log("Events Disconnected")},this.onMsg=function(e){console.log("event source:",e.data)},this.open=function(){t.createEventListeners()},this.close=function(){t.removeEventListeners()},this.hostUrl=n,this.onOpen=r,this.onError=i,this.onMsg=s,this.source=null,this.customCallbacks=a,this.createEventListeners(n,custom)}return Ve(e,[{key:"createEventListeners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.hostUrl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.customCallbacks,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.source;null!==n&&this.removeEventListeners(t,n),window.EventSource&&((n=new EventSource(e)).addEventListener("open",this.onOpen,!1),n.addEventListener("error",this.onError,!1),n.addEventListener("message",this.onMsg,!1),t.length>0&&t.forEach((function(e,t){n.addEventListener(e.tag,e.callback,!1)})))}},{key:"removeEventListeners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.custom,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.source;window.EventSource&&(t.close(),t.removeEventListener("open",this.openEvent,!1),t.removeEventListener("error",this.errorEvent,!1),t.removeEventListener("message",this.messageEvent,!1),e.length>0&&e.forEach((function(e,n){t.removeEventListener(e.tag,e.callback,!1)})),t=null)}},{key:"newPostFunction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"post",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.hostUrl,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,s=function(){var e=new XMLHttpRequest;e.open("POST",t,!0,r,i),e.send(n),e.onerror=function(){e.abort()}};return this[e]=s,s}}]),e}(),We=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"serialmenu";ze(this,e),this.onGetDevices=function(e){document.getElementById("serialports").innerHTML="";for(var n=[],r=0;r<e.length;r++)console.log(e[r].path);e.forEach((function(e){var r=e.displayName+"("+e.path+")";if(console.log("displayName "+r),r||(r=e.path),n.push({option:r,value:e.path}),console.log(t.defaultUI),1==t.defaultUI){var i=document.createElement("option");i.text=r,i.value=e.path,console.log("option",i),document.getElementById("serialports").appendChild(i)}})),t.displayPorts=n},this.onReceive=function(e){if(e.connectionId===t.connectionId){var n,r=new Uint8Array(e.data),i=String.fromCharCode.apply(null,r);for(t.encodedBuffer+=decodeURIComponent(escape(i)),console.log(t.encodedBuffer.length);(n=t.encodedBuffer.indexOf("\n"))>=0;){var s=t.encodedBuffer.substr(0,n+1);1==t.recordData&&t.recorded.push(s),(t.monitoring=!0)&&(t.newSamples++,t.monitorData.push(s)),t.onReadLine(s),t.encodedBuffer=t.encodedBuffer.substr(n+1)}}else console.log("ERR: Receive ID:",e.connectionId)},this.onConnectComplete=function(e){t.connectionId=e.connectionId,console.log("Connected! ID:",t.connectionId),chrome.serial.onReceive.addListener(t.onReceive),chrome.serial.onReceiveError.addListener(t.onReceiveError),t.onConnectedCallback()},this.displayPorts=[],this.defaultUI=n,this.encodedBuffer="",this.connectionId=-1,this.recordData=!1,this.recorded=[],this.port=null,this.decoder=null,this.subscribed=!1,this.reader=null,this.writer=null,this.monitoring=!1,this.newSamples=0,this.monitorSamples=1e4,this.monitorData=[],this.monitorIdx=0,chrome.serial?(!0===n&&this.setupSelect(r,!1),this.setupSerial()):navigator.serial?(this.decoder=new TextDecoder,!0===n&&this.setupSelect(r,!0)):(console.log("ERROR: Cannot locate navigator.serial. Enable #experimental-web-platform-features in chrome://flags"),alert("Serial support not found. Enable #experimental-web-platform-features in chrome://flags or use a chrome extension"))}var t,n,r,i,s;return Ve(e,[{key:"setupSelect",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(chrome.serial){var r=document.createElement("select");r.setAttribute("id","serialports"),(i=document.createDocumentFragment()).appendChild(r),document.getElementById(e).innerHTML='<button id="refreshSerial">Get</button><button id="connectSerial">Set</button>',document.getElementById(e).appendChild(i),document.getElementById("connectSerial").onclick=function(){n?t.setupSerialAsync():(-1!==t.connectionId&&t.connectSelected(!1),t.connectSelected(!0,document.getElementById("serialports").value))}}else if(navigator.serial){var i=document.createDocumentFragment();document.getElementById(e).innerHTML='<button id="refreshSerial">Set USB Device</button>',document.getElementById(e).appendChild(i)}document.getElementById("refreshSerial").onclick=function(){n?t.setupSerialAsync():t.setupSerial()}}},{key:"onReceiveError",value:function(e){console.log("onReceiveError"),e.connectionId===this.connectionId&&(console.log("Error from ID:",e.connectionId),this.onError.dispatch(e.error),console.log("Error: "+e.error))}},{key:"onConnectedCallback",value:function(){console.log("USB device Ready!")}},{key:"onDisconnectedCallback",value:function(){console.log("USB device disconnected!")}},{key:"sendMessage",value:function(e){e+="\n";for(var t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);chrome.serial?this.connectionId>-1?(chrome.serial.send(this.connectionId,n.buffer,this.onSendCallback),console.log("Send message:",e)):console.log("Device is disconnected!"):navigator.serial&&this.port.writable&&this.sendMessageAsync(n.buffer)}},{key:"onSendCallback",value:function(e){console.log("sendInfo",e)}},{key:"onReadLine",value:function(e){console.log(e)}},{key:"connectSelected",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(1==e&&""!==t)console.log("Connecting",t),chrome.serial.connect(t,{bitrate:115200},this.onConnectComplete);else{if(console.log("Disconnect"+t),this.connectionId<0)return void console.log("connectionId",this.connectionId);this.encodedBuffer="",chrome.serial.onReceive.removeListener(this.onReceive),chrome.serial.onReceiveError.removeListener(this.onReceiveError),chrome.serial.flush(this.connectionId,(function(){console.log("chrome.serial.flush",this.connectionId)})),chrome.serial.disconnect(this.connectionId,(function(){console.log("chrome.serial.disconnect",this.connectionId)}))}}},{key:"setupSerial",value:function(){chrome.serial.getDevices(this.onGetDevices)}},{key:"sendMessageAsync",value:(s=Me(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.port.writable.getWriter(),e.next=3,n.write(t);case 3:n.releaseLock();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"onPortSelected",value:(i=Me(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.open({baudRate:115200,bufferSize:1e3});case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,t.open({baudrate:115200,buffersize:1e3});case 9:this.onConnectedCallback(),this.subscribed=!0,this.subscribe(t);case 12:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(e){return i.apply(this,arguments)})},{key:"onReceiveAsync",value:function(e){var t;for(this.encodedBuffer+=this.decoder.decode(e);(t=this.encodedBuffer.indexOf("\n"))>=0;){var n=this.encodedBuffer.substr(0,t+1);1==this.recordData&&this.recorded.push(n),(this.monitoring=!0)&&(this.newSamples++,this.monitorData.push(n)),this.onReadLine(n),this.encodedBuffer=this.encodedBuffer.substr(t+1)}}},{key:"subscribe",value:(r=Me(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.port.readable&&!0===this.subscribed&&(this.reader=t.readable.getReader(),(n=function(){var e=Me(regeneratorRuntime.mark((function e(){var i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.reader.read();case 3:if(i=e.sent,s=i.value,!i.done&&!1!==r.subscribed){e.next=9;break}return e.next=9,r.reader.releaseLock();case 9:if(s)try{r.onReceiveAsync(s),!0===r.subscribed&&setTimeout((function(){n()}),30)}catch(e){console.log(e)}e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0),e.t0.message.includes("framing")||e.t0.message.includes("overflow")||e.t0.message.includes("Overflow")||e.t0.message.includes("break")?(r.subscribed=!1,setTimeout(Me(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.reader){e.next=4;break}return e.next=3,r.reader.releaseLock();case 3:r.reader=null;case 4:r.subscribed=!0,r.subscribe(t);case 6:case"end":return e.stop()}}),e)}))),30)):e.t0.message.includes("parity")||e.t0.message.includes("Parity")?(r.closePort(),setTimeout((function(){r.onPortSelected(r.port)}),100)):r.closePort();case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}())());case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"closePort",value:(n=Me(regeneratorRuntime.mark((function e(){var t,n=this,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]?r[0]:this.port,this.port&&(this.subscribed=!1,setTimeout(Me(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.reader){e.next=4;break}return e.next=3,n.reader.releaseLock();case 3:n.reader=null;case 4:return e.next=6,t.close();case 6:n.connected=!1,n.onDisconnectedCallback();case 8:case"end":return e.stop()}}),e)}))),50));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setupSerialAsync",value:(t=Me(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,navigator.serial.requestPort();case 3:this.port=e.sent,navigator.serial.addEventListener("disconnect",(function(e){t.closePort()})),this.onPortSelected(this.port);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveCsv",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.recorded,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).toISOString(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"|",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Header\n",i=r;e.forEach((function(e){i+=e.split(n).join(",")+"\n"}));var s=document.createElement("a");s.href="data:text/csv;charset=utf-8,"+encodeURI(i),s.target="_blank",s.download=""!==t?t+".csv":(new Date).toISOString()+".csv",s.click()}},{key:"openFile",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:",",n=document.createElement("input");n.type="file",n.onchange=function(r){e.csvDat=[];var i=r.target.files[0],s=new FileReader;s.readAsText(i),s.onload=function(n){var r=n.target.result.split("\n");r.pop(),r.forEach((function(n,r){if(0==r)var i=n.split(t);else i=n.split(t),e.csvDat.push(i)})),e.onOpen()},n.value=""},n.click()}},{key:"onOpen",value:function(){alert("CSV Opened!")}}]),e}();function He(e){return function(e){if(Array.isArray(e))return qe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return qe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Xe(e){return(Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Qe=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hegduinousb",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;Ze(this,e),this.init=function(e,n){e.sps=32,e.deviceType="heg";var r=function(n){if(n.indexOf("|")>-1){var r=n.split("|");if(r.length>3){var i=t.atlas.data.heg[e.deviceNum];i.count++,1===i.count&&(i.startTime=Date.now()),"ble"===t.device.mode&&!0===t.device.interface.android?(i.times.push(Date.now()),i.red.push(parseFloat(r[0])),i.ir.push(parseFloat(r[1])),i.ratio.push(parseFloat(r[2]))):(i.times.push(Date.now()),i.red.push(parseFloat(r[1])),i.ir.push(parseFloat(r[2])),i.ratio.push(parseFloat(r[3])),i.ambient.push(parseFloat(r[4]))),t.atlas.beatDetection(i,e.sps)}}else console.log("HEGDUINO: ",n)};if("hegduinowifi"===t.mode||"hegduinosse"===t.mode?(e.sps=20,t.device=new Ge("wifi",r,(function(){!0!==t.atlas.settings.analyzing&&e.analysis.length>0&&(t.atlas.settings.analyzing=!0,setTimeout((function(){t.atlas.analyzer()}),1200)),t.atlas.settings.deviceConnected=!0,t.onconnect()}),(function(){t.atlas.settings.analyzing=!1,t.atlas.settings.deviceConnected=!1,t.ondisconnect()}))):"hegduinobt"===t.mode||"hegduinoble"===t.mode?t.device=new Ge("ble",r,(function(){!0!==t.atlas.settings.analyzing&&e.analysis.length>0&&(t.atlas.settings.analyzing=!0,setTimeout((function(){t.atlas.analyzer()}),1200)),t.atlas.settings.deviceConnected=!0,t.onconnect()}),(function(){t.atlas.settings.analyzing=!1,t.atlas.settings.deviceConnected=!1,t.ondisconnect()})):"hegduinoserial"!==t.mode&&"hegduinousb"!==t.mode||(t.device=new Ge("usb",r,(function(){!0!==t.atlas.settings.analyzing&&e.analysis.length>0&&(t.atlas.settings.analyzing=!0,setTimeout((function(){t.atlas.analyzer()}),1200)),t.atlas.settings.deviceConnected=!0,t.onconnect()}),(function(){t.atlas.settings.analyzing=!1,t.atlas.settings.deviceConnected=!1,t.ondisconnect()}))),!0===n)t.atlas=new ne(location+":"+t.mode,{hegshared:{sps:e.sps}},"hegduino",!1,!0,e.analysis),e.deviceNum=t.atlas.data.heg.length-1,e.useAtlas=!0;else if("object"===Xe(n)){var i;t.atlas=n,e.deviceNum=t.atlas.data.heg.length,t.atlas.data.hegshared={sps:e.sps},t.atlas.addHEGCoord(t.atlas.data.heg.length),t.atlas.settings.heg=!0,e.useAtlas=!0,e.analysis.length>0&&((i=t.atlas.settings.analysis).push.apply(i,He(e.analysis)),t.atlas.settings.analyzing||(t.atlas.settings.analyzing=!0,t.atlas.analyzer()))}},this.connect=function(){t.device.connect(),t.setIndicator(!0)},this.disconnect=function(){t.device.disconnect(),t.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,n=Math.floor(1e4*Math.random()),r=function(){return"\n            <div id='"+n+"hegduinoControls'>\n                <button id='"+n+"hegon'>On</button>\n                <button id='"+n+"hegoff'>Off</button>\n                <input id='"+n+"hegcmd' type='text' placeholder='R'></input><button id='"+n+"sendcmd'>Send</button>\n            </div>\n            "},i=function(){document.getElementById(n+"hegon").onclick=function(){t.device.sendCommand("t")},document.getElementById(n+"hegoff").onclick=function(){t.device.sendCommand("f")},document.getElementById(n+"sendcmd").onclick=function(){t.device.sendCommand(elm(n+"hegcmd").value)}};t.ui=new we(r,e,void 0,i)},this.atlas=null,this.mode=n,this.device=null,this.filters=[],this.ui=null,this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?(document.getElementById("brainsatplay-".concat(t.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(t.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(t.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(t.mode,"-indicator")).style.border="1px solid white")}}var t,n;return t=e,(n=[{key:"mean",value:function(e){return e.reduce((function(e,t){return t+e}))/e.length}}])&&Ye(t.prototype,n),e}();function Je(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function et(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){Je(s,r,i,a,o,"next",e)}function o(e){Je(s,r,i,a,o,"throw",e)}a(void 0)}))}}function tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nt(e){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function it(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var st=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.onDecodedCallback,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onConnectedCallback,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onDisconnectedCallback,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"daisy",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.decode,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:115200;rt(this,e),this.onDecodedCallback=t,this.onConnectedCallback=n,this.onDisconnectedCallback=r,this.decode=s,this.connected=!1,this.subscribed=!1,this.buffer=[],this.startByte=160,this.stopByte=192,this.searchString=new Uint8Array([this.stopByte,this.startByte]),this.readRate=16.666667,this.readBufferSize=2e3,this.sps=250,this.nChannels=16,this.nPeripheralChannels=6,this.updateMs=1e3/this.sps,this.stepSize=1/(Math.pow(2,23)-1),this.vref=4.5,this.gain=24,this.vscale=this.vref/this.gain*this.stepSize,this.uVperStep=this.vref/this.gain*this.stepSize*1e6,this.scalar=1/(1e6/(this.vref/this.gain*this.stepSize)),this.maxBufferedSamples=60*this.sps*1,this.mode=i,this.data={count:0,startms:0,ms:[],A0:[],A1:[],A2:[],A3:[],A4:[],A5:[],A6:[],A7:[],A8:[],A9:[],A10:[],A11:[],A12:[],A13:[],A14:[],A15:[],Ax:[],Ay:[],Az:[],Gx:[],Gy:[],Gz:[]},this.resetDataBuffers(),navigator.serial||console.error("`navigator.serial not found! Enable #enable-experimental-web-platform-features in chrome://flags (search 'experimental')"),this.port=null,this.reader=null,this.baudrate=a}var t,n,r,i,s,a,o,u;return t=e,(n=[{key:"resetDataBuffers",value:function(){for(var e in this.data.count=0,this.data.startms=0,this.data)"object"===nt(this.data[e])&&(this.data[e]=new Array(this.maxBufferedSamples).fill(0))}},{key:"setScalar",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/(Math.pow(2,23)-1),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4.5;this.stepSize=t,this.vref=n,this.gain=e,this.vscale=this.vref/this.gain*this.stepSize,this.uVperStep=this.vref/this.gain*this.stepSize*1e6,this.scalar=1/(1e6/(this.vref/this.gain*this.stepSize))}},{key:"getLatestData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"A0",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=t;return n<=1?[this.data[e][this.data.count-1]]:(n>this.data.count&&(n=this.data.count),this.data[e].slice(this.data.count-n,this.data.count))}},{key:"bytesToInt16",value:function(e,t){var n=(255&e)<<8|255&t;return(8388608&n)>0?n|=4294901760:n&=65535,n}},{key:"int16ToBytes",value:function(e){return[255&e,e>>8&255]}},{key:"bytesToInt24",value:function(e,t,n){var r=(255&e)<<16|(255&t)<<8|255&n;return(8388608&r)>0?r|=4278190080:r&=16777215,r}},{key:"int24ToBytes",value:function(e){return[255&e,e>>8&255,e>>16&255]}},{key:"decode",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.buffer,t=this.searchString,n=e,r=this.boyerMoore(t),i=r.byteLength,s=[],a=0,o=r(n);-1!==o;o=r(n,o+i))s.push(o);if(s.length>=2){for(var u=1;u<s.length;u++)if(s[u]-s[u-1]==33){var c=e.slice(s[u-1],s[u]+1);for(this.data.count<this.maxBufferedSamples&&this.data.count++,this.data.count-1==0?(this.data.ms[this.data.count-1]=Date.now(),this.data.startms=this.data.ms[0]):(this.data.ms[this.data.count-1]=this.data.ms[this.data.count-2]+this.updateMs,this.data.count>=this.maxBufferedSamples&&(this.data.ms.splice(0,5120),this.data.ms.push(new Array(5120).fill(0)))),o=3;o<27;o+=3){var l=void 0;l="daisy"===this.mode?c[2]%2!=0?"A"+(o-3)/3:"A"+(8+(o-3)/3):"A"+(o-3)/3,this.data[l][this.data.count-1]=this.bytesToInt24(c[o],c[o+1],c[o+2]),this.data.count>=this.maxBufferedSamples&&(this.data[l].splice(0,5120),this.data[l].push(new Array(5120).fill(0)))}this.data.Ax[this.data.count-1]=this.bytesToInt16(c[27],c[28]),this.data.Ay[this.data.count-1]=this.bytesToInt16(c[29],c[30]),this.data.Az[this.data.count-1]=this.bytesToInt16(c[31],c[32]),this.data.count>=this.maxBufferedSamples&&(this.data.Ax.splice(0,5120),this.data.Ay.splice(0,5120),this.data.Az.splice(0,5120),this.data.Ax.push(new Array(5120).fill(0)),this.data.Ay.push(new Array(5120).fill(0)),this.data.Az.push(new Array(5120).fill(0)),this.data.count-=5120),a++}return a>0&&e.splice(0,s[s.length-1]),a}}},{key:"onDecodedCallback",value:function(e){}},{key:"onConnectedCallback",value:function(){console.log("port connected!")}},{key:"onDisconnectedCallback",value:function(){console.log("port disconnected!")}},{key:"onReceive",value:function(e){var t,n;(t=this.buffer).push.apply(t,function(e){if(Array.isArray(e))return tt(e)}(n=e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return tt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tt(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var r=this.decode(this.buffer);!1===r||0===r||isNaN(r)||this.onDecodedCallback(r)}},{key:"sendMsg",value:(u=et(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=unescape(encodeURIComponent(t+="\n")),r=new Uint8Array(n.length),i=this.port.writable.getWriter(),e.next=6,i.write(r.buffer);case 6:return i.releaseLock(),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"onPortSelected",value:(o=et(regeneratorRuntime.mark((function e(t){var n,r=this,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:this.baudrate,e.prev=1,e.prev=2,e.next=5,t.open({baudRate:n,bufferSize:this.readBufferSize});case 5:setTimeout((function(){r.onConnectedCallback(),r.connected=!0,r.subscribed=!0,r.sendMsg("b"),r.subscribe(t)}),500),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(2),e.next=12,t.open({baudrate:n,buffersize:this.readBufferSize});case 12:setTimeout((function(){r.onConnectedCallback(),r.connected=!0,r.subscribed=!0,r.sendMsg("b"),r.subscribe(t)}),500);case 13:e.next=19;break;case 15:e.prev=15,e.t1=e.catch(1),console.log(e.t1),this.connected=!1;case 19:case"end":return e.stop()}}),e,this,[[1,15],[2,8]])}))),function(e){return o.apply(this,arguments)})},{key:"subscribe",value:(a=et(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.port.readable&&!0===this.subscribed&&(this.reader=t.readable.getReader(),(n=function(){var e=et(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.reader.read();case 3:if(t=e.sent,i=t.value,!t.done&&!1!==r.subscribed){e.next=9;break}return e.next=9,r.reader.releaseLock();case 9:if(i)try{r.onReceive(i)}catch(e){console.log(e)}!0===r.subscribed&&setTimeout((function(){n()}),r.readRate),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0),r.closePort();case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}())());case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"subscribeSafe",value:(s=et(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:new Promise((function(e,r){for(;n.port.readable&&!0===n.subscribed;){n.reader=t.readable.getReader();for(var i=!0,s=new Promise((function(e,t){return n.reader.read()})),a=new Promise((function(e,t){setTimeout(e,100,"readfail")}));!0===i;)Promise.race([s,a]).then((function(e){if(console.log("newpromise"),"readfail"===e)console.log(e);else{var t=e.value;!0===e.done||!0===n.subscribed?new Promise((function(e,t){e(n.reader.releaseLock())})).then((function(){i=!1})):n.onReceive(t)}}))}e("not readable")}));case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"closePort",value:(i=et(regeneratorRuntime.mark((function e(){var t,n=this,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]?r[0]:this.port,this.port&&(this.subscribed=!1,this.sendMsg("s"),setTimeout(et(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.reader&&(n.reader=null),e.next=3,t.close();case 3:n.port=null,n.connected=!1,n.onDisconnectedCallback();case 6:case"end":return e.stop()}}),e)}))),100));case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setupSerialAsync",value:(r=et(regeneratorRuntime.mark((function e(){var t,n=this,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:this.baudrate,e.next=4,navigator.serial.requestPort();case 4:this.port=e.sent,navigator.serial.addEventListener("disconnect",(function(e){n.closePort(n.port)})),this.onPortSelected(this.port,t);case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"asUint8Array",value:function(e){if(e instanceof Uint8Array)return e;if("string"==typeof e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r>127)throw new TypeError("Only ASCII patterns are supported");t[n]=r}return t}return new Uint8Array(e)}},{key:"boyerMoore",value:function(e){var t=this,n=this.asUint8Array(e),r=n.length;if(0===r)throw new TypeError("patternBuffer must be at least 1 byte long");for(var i=new Int32Array(256),s=0;s<256;s++)i[s]=-1;for(var a=0;a<r;a++)i[n[a]]=a;var o=function(e,r,s){var a=t.asUint8Array(e);void 0===r&&(r=0),void 0===s&&(s=a.length);for(var o,u=n,c=i,l=s-u.length,h=u.length-1,p=r;p<=l;p+=o){o=0;for(var d=h;d>=0;d--){var f=a[p+d];if(u[d]!==f){o=Math.max(1,d-c[f]);break}}if(0===o)return p}return-1};return o.byteLength=n.byteLength,o}}])&&it(t.prototype,n),e}();function at(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function ot(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){at(s,r,i,a,o,"next",e)}function o(e){at(s,r,i,a,o,"throw",e)}a(void 0)}))}}function ut(e){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ct(e){return function(e){if(Array.isArray(e))return lt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return lt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ht(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var pt,dt=function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"cyton_daisy",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;ht(this,e),this.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{sps:null,deviceType:null,eegChannelTags:null,analysis:["eegfft"],useAtlas:void 0},n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.sps=250,e.deviceType="eeg";var r=function(n){t.atlas.data.eegshared.eegChannelTags.forEach((function(r,i){var s,a,o,u,c=t.device.getLatestData("A"+r.ch,n),l=new Array(c.length).fill(0);if("other"!==r.tag&&!0===e.useFilters)t.filters.forEach((function(e,t){e.channel===r.ch&&c.forEach((function(t,n){l[n]=e.apply(t)}))})),!0===e.useAtlas&&((u=null!==r.tag?t.atlas.getEEGDataByTag(r.tag):t.atlas.getEEGDataByChannel(r.ch)).count+=n,(s=u.times).push.apply(s,ct(t.device.data.ms.slice(t.device.data.count-n,t.device.data.count))),(a=u.filtered).push.apply(a,ct(l)),(o=u.raw).push.apply(o,ct(c)));else if(!0===e.useAtlas){var h,p,d=t.atlas.getEEGDataByChannel(r.ch);d.count+=n,(h=d.times).push.apply(h,ct(t.device.data.ms.slice(t.device.data.count-n,t.device.data.count))),(p=d.raw).push.apply(p,ct(c))}}))},i=function(){!0===e.useAtlas&&(t.atlas.data.eegshared.startTime=Date.now(),!0!==t.atlas.settings.analyzing&&e.analysis.length>0&&(t.atlas.settings.analyzing=!0,setTimeout((function(){t.atlas.analyzer()}),1200))),t.atlas.settings.deviceConnected=!0,t.onconnect()},s=function(){t.atlas.settings.analyzing=!1,t.atlas.settings.deviceConnected=!1,t.ondisconnect()},a=[];if(t.mode.indexOf("daisy")>-1?(a=[{ch:0,tag:"FP1",analyze:!0},{ch:1,tag:"FP2",analyze:!0},{ch:2,tag:"C3",analyze:!0},{ch:3,tag:"C4",analyze:!0},{ch:4,tag:"P7",analyze:!0},{ch:5,tag:"P8",analyze:!0},{ch:6,tag:"O1",analyze:!0},{ch:7,tag:"O2",analyze:!0},{ch:8,tag:"F7",analyze:!0},{ch:9,tag:"F8",analyze:!0},{ch:10,tag:"F3",analyze:!0},{ch:11,tag:"F4",analyze:!0},{ch:12,tag:"T7",analyze:!0},{ch:13,tag:"T8",analyze:!0},{ch:14,tag:"P3",analyze:!0},{ch:15,tag:"P4",analyze:!0}],t.device=new st(r,i,s,"daisy")):(a=[{ch:0,tag:"FP1",analyze:!0},{ch:1,tag:"FP2",analyze:!0},{ch:2,tag:"C3",analyze:!0},{ch:3,tag:"C4",analyze:!0},{ch:4,tag:"P7",analyze:!0},{ch:5,tag:"P8",analyze:!0},{ch:6,tag:"O1",analyze:!0},{ch:7,tag:"O2",analyze:!0}],t.device=new st(r,i,s,"single")),!0===e.useFilters&&a.forEach((function(n,r){"other"!==n.tag?t.filters.push(new ye(n.ch,e.sps,!0,t.device.uVperStep)):t.filters.push(new ye(n.ch,e.sps,!1,t.device.uVperStep))})),e.eegChannelTags=a,!0===n){var o="10_20";t.atlas=new ne(location+":"+t.mode,{eegshared:{eegChannelTags:e.eegChannelTags,sps:e.sps}},o,!0,!0,e.analysis),e.useAtlas=!0}else if("object"===ut(n)){var u;t.atlas=n,t.atlas.data.eegshared.eegChannelTags=e.eegChannelTags,t.atlas.data.eegshared.sps=e.sps,t.atlas.data.eegshared.frequencies=t.atlas.bandpassWindow(0,128,.5*e.sps),t.atlas.data.eegshared.bandFreqs=t.atlas.getBandFreqs(t.atlas.data.eegshared.frequencies),t.atlas.data.eeg=t.atlas.gen10_20Atlas(),t.atlas.data.coherence=t.atlas.genCoherenceMap(e.eegChannelTags),t.atlas.data.eegshared.eegChannelTags.forEach((function(e,n){void 0===t.atlas.getEEGDataByTag(e.tag)&&t.atlas.addEEGCoord(e.ch)})),t.atlas.settings.coherence=!0,t.atlas.settings.eeg=!0,e.useAtlas=!0,e.analysis.length>0&&((u=t.atlas.settings.analysis).push.apply(u,ct(e.analysis)),t.atlas.settings.analyzing||(t.atlas.settings.analyzing=!0,t.atlas.analyzer()))}},this.connect=ot(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.device.setupSerialAsync();case 2:t.setIndicator(!0);case 3:case"end":return e.stop()}}),e)}))),this.disconnect=function(){t.device.closePort(),t.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,n=(Math.floor(1e4*Math.random()),function(){return"\n            "}),r=function(){};t.ui=new we(n,e,void 0,r)},this.atlas=null,this.mode=n,this.device=null,this.filters=[],this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?(document.getElementById("brainsatplay-".concat(t.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(t.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(t.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(t.mode,"-indicator")).style.border="1px solid white")}};function ft(e){return function(e){if(Array.isArray(e))return mt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return mt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gt(e){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var vt=function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;yt(this,e),this.init=function(e,t){if(e.deviceType="eyetracker",!0===t)n.atlas=new ne(location+":"+n.mode,void 0,"eyetracker",!0,!0,e.analysis),e.deviceNum=n.atlas.data.heg.length-1,e.useAtlas=!0,e.deviceNum=n.atlas.data.eyetracker.length-1;else if("object"===gt(t)){var r;n.atlas=t,e.deviceNum=n.atlas.data.eyetracker.length,n.atlas.addEyeTracker(n.atlas.data.eyetracker.length),n.atlas.settings.eyetracker=!0,e.useAtlas=!0,e.analysis.length>0&&((r=n.atlas.settings.analysis).push.apply(r,ft(e.analysis)),n.atlas.settings.analyzing||(n.atlas.settings.analyzing=!0,n.atlas.analyzer()))}n.info=e},this.connect=function(){pt.setGazeListener((function(e,t){if(null!=e&&(e.x,e.y,!0===n.info.useAtlas)){var r=n.atlas.data.eyetracker[n.info.deviceNum];0===r.times.length&&(r.startTime=Date.now()),r.times.push(Date.now()),r.x.push(e.x),r.y.push(e.y),r.x.length>10?(r.smax.push(r.x.slice(r.x.length-10).reduce((function(e,t){return e+t}))/10),r.smay.push(r.y.slice(r.y.length-10).reduce((function(e,t){return e+t}))/10)):(r.smax.push(r.x.slice(0).reduce((function(e,t){return e+t}))/r.x.length),r.smay.push(r.y.slice(0).reduce((function(e,t){return e+t}))/r.y.length))}})).begin(),n.atlas.settings.deviceConnected=!0,n.onconnect(),n.setIndicator(!0)},this.disconnect=function(){pt.end(),n.atlas.settings.deviceConnected=!1,n.ondisconnect(),n.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,t=(Math.floor(1e4*Math.random()),function(){return"\n            "}),r=function(){};n.ui=new we(t,e,void 0,r)},this.atlas=null,this.mode=t,this.device=null,this.filters=[],this.info,this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="1px solid white")}},bt=n(8314),xt=n(9122),wt=n(9890),St=n(2068),Tt=n(173),Ct=n(8111),At=n(8120),_t=n(904),kt=n(9126);function It(e){return(It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Et="normal",Ot="shorted",Dt="biasMethod",Bt="mvdd",Pt="temp",Ft="testSig",Nt="biasDrp",Rt="biasDrn",Lt="1hour",Mt="2hour",zt="4hour",$t="12hour",Vt="24hour",Gt="5min",Ut="15min",Kt="30min",jt="14sec",Wt="CH1SET",Ht="CH2SET",qt="CH3SET",Xt="CH4SET",Zt="CH5SET",Yt="CH6SET",Qt="CH7SET",Jt="CH8SET",en="analog",tn="default",nn="debug",rn="digital",sn="cyton",an="cytonBLE",on="daisy",un="ganglion",cn="none",ln="none",hn="good",pn=1e6,dn="Ganglion",fn="\nLIS3DH Registers\n0x07.0\n0x08.0\n0x09.0\n0x0A.0\n0x0B.0\n0x0C.0\n0x0D.0\n0x0E.0\n0x0F.33\n\n0x1F.0\n0x20.8\n0x21.0\n0x22.0\n0x23.18\n0x24.0\n0x25.0\n0x26.0\n0x27.0\n0x28.0\n0x29.0\n0x2A.0\n0x2B.0\n0x2C.0\n0x2D.0\n0x2E.0\n0x2F.20\n0x30.0\n0x31.0\n0x32.0\n0x33.0\n\n0x38.0\n0x39.0\n0x3A.0\n0x3B.0\n0x3C.0\n0x3D.0\n",mn="\nLIS3DH Registers\n0x07 00\n0x08 00\n0x09 00\n0x0A 00\n0x0B 00\n0x0C 00\n0x0D 00\n0x0E 00\n0x0F 33\n\n0x1F 00\n0x20 08\n0x21 00\n0x22 00\n0x23 18\n0x24 00\n0x25 00\n0x26 00\n0x27 00\n0x28 00\n0x29 00\n0x2A 00\n0x2B 00\n0x2C 00\n0x2D 00\n0x2E 00\n0x2F 20\n0x30 00\n0x31 00\n0x32 00\n0x33 00\n\n0x38 00\n0x39 00\n0x3A 00\n0x3B 00\n0x3C 00\n0x3D 00\n",gn="\nBoard ADS Registers\nADS_ID, 00, 3E, 0, 0, 1, 1, 1, 1, 1, 0\nCONFIG1, 01, 96, 1, 0, 0, 1, 0, 1, 1, 0\nCONFIG2, 02, C0, 1, 1, 0, 0, 0, 0, 0, 0\nCONFIG3, 03, EC, 1, 1, 1, 0, 1, 1, 0, 0\nLOFF, 04, 02, 0, 0, 0, 0, 0, 0, 1, 0\nCH1SET, 05, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH2SET, 06, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH3SET, 07, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH4SET, 08, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH5SET, 09, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH6SET, 0A, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH7SET, 0B, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH8SET, 0C, 68, 0, 1, 1, 0, 1, 0, 0, 0\nBIAS_SENSP, 0D, FF, 1, 1, 1, 1, 1, 1, 1, 1\nBIAS_SENSN, 0E, FF, 1, 1, 1, 1, 1, 1, 1, 1\nLOFF_SENSP, 0F, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_SENSN, 10, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_FLIP, 11, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_STATP, 12, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_STATN, 13, 00, 0, 0, 0, 0, 0, 0, 0, 0\nGPIO, 14, 0F, 0, 0, 0, 0, 1, 1, 1, 1\nMISC1, 15, 00, 0, 0, 0, 0, 0, 0, 0, 0\nMISC2, 16, 00, 0, 0, 0, 0, 0, 0, 0, 0\nCONFIG4, 17, 00, 0, 0, 0, 0, 0, 0, 0, 0\n",yn="\nDaisy ADS Registers\nADS_ID, 00, 3E, 0, 0, 1, 1, 1, 1, 1, 0\nCONFIG1, 01, 96, 1, 0, 0, 1, 0, 1, 1, 0\nCONFIG2, 02, C0, 1, 1, 0, 0, 0, 0, 0, 0\nCONFIG3, 03, EC, 1, 1, 1, 0, 1, 1, 0, 0\nLOFF, 04, 02, 0, 0, 0, 0, 0, 0, 1, 0\nCH1SET, 05, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH2SET, 06, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH3SET, 07, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH4SET, 08, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH5SET, 09, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH6SET, 0A, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH7SET, 0B, 68, 0, 1, 1, 0, 1, 0, 0, 0\nCH8SET, 0C, 68, 0, 1, 1, 0, 1, 0, 0, 0\nBIAS_SENSP, 0D, FF, 1, 1, 1, 1, 1, 1, 1, 1\nBIAS_SENSN, 0E, FF, 1, 1, 1, 1, 1, 1, 1, 1\nLOFF_SENSP, 0F, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_SENSN, 10, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_FLIP, 11, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_STATP, 12, 00, 0, 0, 0, 0, 0, 0, 0, 0\nLOFF_STATN, 13, 00, 0, 0, 0, 0, 0, 0, 0, 0\nGPIO, 14, 0F, 0, 0, 0, 0, 1, 1, 1, 1\nMISC1, 15, 00, 0, 0, 0, 0, 0, 0, 0, 0\nMISC2, 16, 00, 0, 0, 0, 0, 0, 0, 0, 0\nCONFIG4, 17, 00, 0, 0, 0, 0, 0, 0, 0, 0\n",vn={OBCIChannelOff1:"1",OBCIChannelOff2:"2",OBCIChannelOff3:"3",OBCIChannelOff4:"4",OBCIChannelOff5:"5",OBCIChannelOff6:"6",OBCIChannelOff7:"7",OBCIChannelOff8:"8",OBCIChannelOff9:"q",OBCIChannelOff10:"w",OBCIChannelOff11:"e",OBCIChannelOff12:"r",OBCIChannelOff13:"t",OBCIChannelOff14:"y",OBCIChannelOff15:"u",OBCIChannelOff16:"i",commandChannelOff:function(e){return new Promise((function(t,n){switch(e){case 1:t("1");break;case 2:t("2");break;case 3:t("3");break;case 4:t("4");break;case 5:t("5");break;case 6:t("6");break;case 7:t("7");break;case 8:t("8");break;case 9:t("q");break;case 10:t("w");break;case 11:t("e");break;case 12:t("r");break;case 13:t("t");break;case 14:t("y");break;case 15:t("u");break;case 16:t("i");break;default:n(Error("Error [commandChannelOff]: Invalid Channel Number"))}}))},OBCIChannelOn1:"!",OBCIChannelOn2:"@",OBCIChannelOn3:"#",OBCIChannelOn4:"$",OBCIChannelOn5:"%",OBCIChannelOn6:"^",OBCIChannelOn7:"&",OBCIChannelOn8:"*",OBCIChannelOn9:"Q",OBCIChannelOn10:"W",OBCIChannelOn11:"E",OBCIChannelOn12:"R",OBCIChannelOn13:"T",OBCIChannelOn14:"Y",OBCIChannelOn15:"U",OBCIChannelOn16:"I",commandChannelOn:function(e){return new Promise((function(t,n){switch(e){case 1:t("!");break;case 2:t("@");break;case 3:t("#");break;case 4:t("$");break;case 5:t("%");break;case 6:t("^");break;case 7:t("&");break;case 8:t("*");break;case 9:t("Q");break;case 10:t("W");break;case 11:t("E");break;case 12:t("R");break;case 13:t("T");break;case 14:t("Y");break;case 15:t("U");break;case 16:t("I");break;default:n(Error("Error [commandChannelOn]: Invalid Channel Number"))}}))},OBCITestSignalConnectToDC:"p",OBCITestSignalConnectToGround:"0",OBCITestSignalConnectToPulse1xFast:"=",OBCITestSignalConnectToPulse1xSlow:"-",OBCITestSignalConnectToPulse2xFast:"]",OBCITestSignalConnectToPulse2xSlow:"[",getTestSignalCommand:function(e){return new Promise((function(t,n){switch(e){case"dc":t("p");break;case"ground":t("0");break;case"pulse1xFast":t("=");break;case"pulse1xSlow":t("-");break;case"pulse2xFast":t("]");break;case"pulse2xSlow":t("[");break;case"none":t("d");break;default:n(Error("Invalid selection! Check your spelling."))}}))},OBCIChannelCmdADCNormal:"0",OBCIChannelCmdADCShorted:"1",OBCIChannelCmdADCBiasDRP:"6",OBCIChannelCmdADCBiasDRN:"7",OBCIChannelCmdADCBiasMethod:"2",OBCIChannelCmdADCMVDD:"3",OBCIChannelCmdADCTemp:"4",OBCIChannelCmdADCTestSig:"5",OBCIChannelCmdBiasInclude:"1",OBCIChannelCmdBiasRemove:"0",OBCIChannelCmdChannel1:"1",OBCIChannelCmdChannel2:"2",OBCIChannelCmdChannel3:"3",OBCIChannelCmdChannel4:"4",OBCIChannelCmdChannel5:"5",OBCIChannelCmdChannel6:"6",OBCIChannelCmdChannel7:"7",OBCIChannelCmdChannel8:"8",OBCIChannelCmdChannel9:"Q",OBCIChannelCmdChannel10:"W",OBCIChannelCmdChannel11:"E",OBCIChannelCmdChannel12:"R",OBCIChannelCmdChannel13:"T",OBCIChannelCmdChannel14:"Y",OBCIChannelCmdChannel15:"U",OBCIChannelCmdChannel16:"I",commandChannelForCmd:Cn,OBCIChannelCmdGain1:"0",OBCIChannelCmdGain2:"1",OBCIChannelCmdGain4:"2",OBCIChannelCmdGain6:"3",OBCIChannelCmdGain8:"4",OBCIChannelCmdGain12:"5",OBCIChannelCmdGain24:"6",commandForGain:Tn,gainForCommand:function(e){switch(String(e)){case"0":return 1;case"1":return 2;case"2":return 4;case"3":return 6;case"4":return 8;case"5":return 12;case"6":return 24;default:throw new Error("Invalid gain setting of ".concat(e," gain must be (0,1,2,3,4,5,6)"))}},OBCIChannelCmdLatch:"X",OBCIChannelCmdPowerOff:"1",OBCIChannelCmdPowerOn:"0",OBCIChannelCmdSet:"x",OBCIChannelCmdSRB1Connect:"1",OBCIChannelCmdSRB1Diconnect:"0",OBCIChannelCmdSRB2Connect:"1",OBCIChannelCmdSRB2Diconnect:"0",channelSettingsObjectDefault:An,channelSettingsArrayInit:function(e){for(var t=[],n=0;n<e;n++)t.push(An(n));return t},OBCIStringADCNormal:Et,OBCIStringADCShorted:Ot,OBCIStringADCBiasMethod:Dt,OBCIStringADCMvdd:Bt,OBCIStringADCTemp:Pt,OBCIStringADCTestSig:Ft,OBCIStringADCBiasDrp:Nt,OBCIStringADCBiasDrn:Rt,commandForADCString:Sn,inputTypeForCommand:function(e){switch(String(e)){case"0":return Et;case"1":return Ot;case"2":return Dt;case"3":return Bt;case"4":return Pt;case"5":return Ft;case"6":return Nt;case"7":return Rt;default:throw new Error("Invalid input type, must be less than 8")}},OBCIChannelDefaultAllSet:"d",OBCIChannelDefaultAllGet:"D",OBCIChannelImpedanceLatch:"Z",OBCIChannelImpedanceSet:"z",OBCIChannelImpedanceTestSignalApplied:"1",OBCIChannelImpedanceTestSignalAppliedNot:"0",OBCISDLogForHour1:"G",OBCISDLogForHour2:"H",OBCISDLogForHour4:"J",OBCISDLogForHour12:"K",OBCISDLogForHour24:"L",OBCISDLogForMin5:"A",OBCISDLogForMin15:"S",OBCISDLogForMin30:"F",OBCISDLogForSec14:"a",OBCISDLogStop:"j",OBCIStringSDHour1:Lt,OBCIStringSDHour2:Mt,OBCIStringSDHour4:zt,OBCIStringSDHour12:$t,OBCIStringSDHour24:Vt,OBCIStringSDMin5:Gt,OBCIStringSDMin15:Ut,OBCIStringSDMin30:Kt,OBCIStringSDSec14:jt,sdSettingForString:function(e){return new Promise((function(t,n){switch(e){case Lt:t("G");break;case Mt:t("H");break;case zt:t("J");break;case $t:t("K");break;case Vt:t("L");break;case Gt:t("A");break;case Ut:t("S");break;case Kt:t("F");break;case jt:t("a");break;default:n(Error(TypeError))}}))},OBCIStreamStart:"b",OBCIStreamStop:"s",OBCIAccelStart:"n",OBCIAccelStop:"N",OBCIMiscQueryRegisterSettings:"?",OBCIMiscQueryRegisterSettingsChannel1:Wt,OBCIMiscQueryRegisterSettingsChannel2:Ht,OBCIMiscQueryRegisterSettingsChannel3:qt,OBCIMiscQueryRegisterSettingsChannel4:Xt,OBCIMiscQueryRegisterSettingsChannel5:Zt,OBCIMiscQueryRegisterSettingsChannel6:Yt,OBCIMiscQueryRegisterSettingsChannel7:Qt,OBCIMiscQueryRegisterSettingsChannel8:Jt,channelSettingsKeyForChannel:function(e){return new Promise((function(t,n){switch(e){case 1:t(new Buffer(Wt));break;case 2:t(new Buffer(Ht));break;case 3:t(new Buffer(qt));break;case 4:t(new Buffer(Xt));break;case 5:t(new Buffer(Zt));break;case 6:t(new Buffer(Yt));break;case 7:t(new Buffer(Qt));break;case 8:t(new Buffer(Jt));break;default:n(Error("Invalid channel number"))}}))},OBCIMiscSoftReset:"v",OBCIChannelMaxNumber8:"c",OBCIChannelMaxNumber16:"C",OBCIChannelMaxNumber8NoDaisyToRemove:"",OBCIChannelMaxNumber8SuccessDaisyRemoved:"daisy removed",OBCIChannelMaxNumber16DaisyAlreadyAttached:"16",OBCIChannelMaxNumber16DaisyAttached:"daisy attached16",OBCIChannelMaxNumber16NoDaisyAttached:"no daisy to attach!8",OBCIFilterDisable:"g",OBCIFilterEnable:"f",OBCITrigger:"`",OBCINumberOfChannelsCyton:8,OBCINumberOfChannelsCytonBLE:2,OBCINumberOfChannelsDaisy:16,OBCINumberOfChannelsDefault:8,OBCINumberOfChannelsGanglion:4,OBCIBoardCyton:sn,OBCIBoardCytonBLE:an,OBCIBoardDaisy:on,OBCIBoardDefault:"default",OBCIBoardGanglion:un,OBCIBoardNone:cn,numberOfChannelsForBoardType:function(e){switch(e){case on:return 16;case un:return 4;case cn:return 0;case an:return 2;case sn:default:return 8}},boardTypeForNumberOfChannels:function(e){switch(e){case 16:return on;case 4:return un;case 0:return cn;case 2:return an;case 8:default:return sn}},OBCISampleRate1000:1e3,OBCISampleRate125:125,OBCISampleRate12800:12800,OBCISampleRate1600:1600,OBCISampleRate16000:16e3,OBCISampleRate200:200,OBCISampleRate2000:2e3,OBCISampleRate250:250,OBCISampleRate25600:25600,OBCISampleRate3200:3200,OBCISampleRate400:400,OBCISampleRate4000:4e3,OBCISampleRate500:500,OBCISampleRate6400:6400,OBCISampleRate800:800,OBCISampleRate8000:8e3,OBCISampleNumberMax:255,OBCIPacketSize:33,OBCIPacketSizeBLECyton:20,OBCIPacketSizeBLERaw:12,OBCIByteStart:160,OBCIByteStop:192,OBCIErrorInvalidByteLength:"Invalid Packet Byte Length",OBCIErrorInvalidByteStart:"Invalid Start Byte",OBCIErrorInvalidByteStop:"Invalid Stop Byte",OBCIErrorInvalidData:"Invalid data - try again",OBCIErrorInvalidType:"Invalid type - check comments for input type",OBCIErrorMissingRegisterSetting:"Missing register setting",OBCIErrorMissingRequiredProperty:"Missing property in JSON",OBCIErrorNobleAlreadyScanning:"Scan already under way",OBCIErrorNobleNotAlreadyScanning:"No scan started",OBCIErrorNobleNotInPoweredOnState:"Please turn blue tooth on.",OBCIErrorTimeSyncIsNull:"'this.sync.curSyncObj' must not be null",OBCIErrorTimeSyncNoComma:"Missed the time sync sent confirmation. Try sync again",OBCIErrorUndefinedOrNullInput:"Undefined or Null Input",OBCIMasterBufferSize:4096,OBCILeadOffDriveInAmps:6e-9,OBCILeadOffFrequencyHz:31.5,getChannelSetter:function(e,t,n,r,i,s,a){var o,u,c,l;return new Promise((function(h,p){bn(e)||p(Error("channelNumber must be of type 'number' ")),xn(t)||p(Error("powerDown must be of type 'boolean' ")),bn(n)||p(Error("gain must be of type 'number' ")),wn(r)||p(Error("inputType must be of type 'string' ")),xn(i)||p(Error("bias must be of type 'boolean' ")),xn(s)||p(Error("srb1 must be of type 'boolean' ")),xn(a)||p(Error("srb2 must be of type 'boolean' "));var d=Cn(e).catch((function(e){return p(e)}));o=t?"1":"0";var f=Tn(n).catch((function(e){return p(e)})),m=Sn(r).catch((function(e){return p(e)}));u=i?"1":"0",c=s?"1":"0",l=a?"1":"0";var g={channelNumber:e,powerDown:t,gain:n,inputType:r,bias:i,srb2:s,srb1:a};Promise.all([d,f,m]).then((function(e){var t=["x",e[0],o,e[1],e[2],u,c,l,"X"];h({commandArray:t,newChannelSettingsObject:g})}))}))},getImpedanceSetter:function(e,t,n){var r,i;return new Promise((function(s,a){bn(e)||a(Error("channelNumber must be of type 'number' ")),xn(t)||a(Error("pInputApplied must be of type 'boolean' ")),xn(n)||a(Error("nInputApplied must be of type 'boolean' ")),i=t?"1":"0",r=n?"1":"0",Cn(e).then((function(e){s(["z",e,i,r,"Z"])})).catch((function(e){return a(e)}))}))},getSampleRateSetter:function(e,t){return new Promise((function(n,r){if(!wn(e))return r(Error("board type must be of type 'string' "));if(!bn(t))return r(Error("sampleRate must be of type 'number' "));var i;if(t=Math.floor(t),e===sn||e===on)i=kn;else{if(e!==un)return r(Error("boardType must be either ".concat(sn," or ").concat(un)));i=In}i(t).then((function(e){n(["~",e])})).catch((function(e){return r(e)}))}))},getBoardModeSetter:function(e){return new Promise((function(t,n){if(!wn(e))return n(Error("board mode must be of type 'string' "));En(e).then((function(e){t(["/",e])})).catch((function(e){return n(e)}))}))},OBCIWriteIntervalDelayMSLong:50,OBCIWriteIntervalDelayMSNone:0,OBCIWriteIntervalDelayMSShort:10,OBCISyncTimeSent:",",OBCISyncTimeSet:"<",OBCIRadioKey:240,OBCIRadioCmdChannelGet:0,OBCIRadioCmdChannelSet:1,OBCIRadioCmdChannelSetOverride:2,OBCIRadioCmdPollTimeGet:3,OBCIRadioCmdPollTimeSet:4,OBCIRadioCmdBaudRateSetDefault:5,OBCIRadioCmdBaudRateSetFast:6,OBCIRadioCmdSystemStatus:7,OBCIImpedanceTextBad:"bad",OBCIImpedanceTextGood:hn,OBCIImpedanceTextInit:"init",OBCIImpedanceTextOk:"ok",OBCIImpedanceTextNone:ln,OBCIImpedanceThresholdBadMax:pn,OBCIImpedanceSeriesResistor:2200,getTextForRawImpedance:function(e){return e>0&&e<5e3?hn:e>5001&&e<1e4?"ok":e>10001&&e<pn?"bad":ln},OBCISimulatorPortName:"OpenBCISimulator",OBCIStreamPacketStandardAccel:0,OBCIStreamPacketStandardRawAux:1,OBCIStreamPacketUserDefinedType:2,OBCIStreamPacketAccelTimeSyncSet:3,OBCIStreamPacketAccelTimeSynced:4,OBCIStreamPacketRawAuxTimeSyncSet:5,OBCIStreamPacketRawAuxTimeSynced:6,OBCIStreamPacketImpedance:7,isNumber:bn,isBoolean:xn,isString:wn,isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},OBCIPacketPositionStartByte:0,OBCIPacketPositionStopByte:32,OBCIPacketPositionStartAux:26,OBCIPacketPositionStopAux:31,OBCIPacketPositionChannelDataStart:2,OBCIPacketPositionChannelDataStop:25,OBCIPacketPositionSampleNumber:1,OBCIPacketPositionTimeSyncAuxStart:26,OBCIPacketPositionTimeSyncAuxStop:28,OBCIPacketPositionTimeSyncTimeStart:28,OBCIPacketPositionTimeSyncTimeStop:32,OBCISimulatorLineNoiseHz60:"60Hz",OBCISimulatorLineNoiseHz50:"50Hz",OBCISimulatorLineNoiseNone:"none",OBCISimulatorFragmentationRandom:"random",OBCISimulatorFragmentationFullBuffers:"fullBuffers",OBCISimulatorFragmentationOneByOne:"oneByOne",OBCISimulatorFragmentationNone:"none",OBCIFirmwareV1:"v1",OBCIFirmwareV2:"v2",OBCIFirmwareV3:"v3",OBCIAccelAxisX:7,OBCIAccelAxisY:8,OBCIAccelAxisZ:9,OBCIStreamPacketTimeByteSize:4,OBCIParseDaisy:"Daisy",OBCIParseFailure:"Failure",OBCIParseFirmware:"v2",OBCIParseEOT:"$$$",OBCIParseSuccess:"Success",OBCIParsingChannelSettings:2,OBCIParsingEOT:4,OBCIParsingNormal:3,OBCIParsingReset:0,OBCIParsingTimeSyncSent:1,OBCITimeoutProcessBytes:500,OBCISimulatorRawAux:"rawAux",OBCISimulatorStandard:"standard",OBCIRadioChannelMax:25,OBCIRadioChannelMin:1,OBCIRadioPollTimeMax:255,OBCIRadioPollTimeMin:0,OBCITimeSyncArraySize:10,OBCITimeSyncMultiplierWithSyncConf:.9,OBCITimeSyncMultiplierWithoutSyncConf:.75,OBCITimeSyncThresholdTransFailureMS:10,OBCIBoardModeSet:"/",OBCIBoardModeCmdDefault:"0",OBCIBoardModeCmdDebug:"1",OBCIBoardModeCmdAnalog:"2",OBCIBoardModeCmdDigital:"3",OBCIBoardModeCmdGetCur:"/",OBCIBoardModeAnalog:en,OBCIBoardModeDefault:tn,OBCIBoardModeDebug:nn,OBCIBoardModeDigital:rn,OBCISampleRateSet:"~",OBCISampleRateCmdCyton16000:"0",OBCISampleRateCmdCyton8000:"1",OBCISampleRateCmdCyton4000:"2",OBCISampleRateCmdCyton2000:"3",OBCISampleRateCmdCyton1000:"4",OBCISampleRateCmdCyton500:"5",OBCISampleRateCmdCyton250:"6",OBCISampleRateCmdGang25600:"0",OBCISampleRateCmdGang12800:"1",OBCISampleRateCmdGang6400:"2",OBCISampleRateCmdGang3200:"3",OBCISampleRateCmdGang1600:"4",OBCISampleRateCmdGang800:"5",OBCISampleRateCmdGang400:"6",OBCISampleRateCmdGang200:"7",OBCISampleRateCmdGetCur:"~",OBCIWifiAttach:"{",OBCIWifiRemove:"}",OBCIWifiReset:";",OBCIWifiStatus:":",OBCIRadioBaudRateDefault:115200,OBCIRadioBaudRateDefaultStr:"default",OBCIRadioBaudRateFast:230400,OBCIRadioBaudRateFastStr:"fast",OBCIEmitterAccelerometer:"accelerometer",OBCIEmitterBlePoweredUp:"blePoweredOn",OBCIEmitterClose:"close",OBCIEmitterDroppedPacket:"droppedPacket",OBCIEmitterEot:"eot",OBCIEmitterError:"error",OBCIEmitterGanglionFound:"ganglionFound",OBCIEmitterHardSet:"hardSet",OBCIEmitterImpedance:"impedance",OBCIEmitterImpedanceArray:"impedanceArray",OBCIEmitterMessage:"message",OBCIEmitterQuery:"query",OBCIEmitterRawDataPacket:"rawDataPacket",OBCIEmitterReady:"ready",OBCIEmitterRFduino:"rfduino",OBCIEmitterSample:"sample",OBCIEmitterScanStopped:"scanStopped",OBCIEmitterSynced:"synced",OBCIEmitterWifiShield:"wifiShield",OBCIGanglionAccelAxisX:1,OBCIGanglionAccelAxisY:2,OBCIGanglionAccelAxisZ:3,OBCIGanglionBleSearchTime:2e4,OBCIGanglionByteIdUncompressed:0,OBCIGanglionByteId18Bit:{max:100,min:1},OBCIGanglionByteId19Bit:{max:200,min:101},OBCIGanglionByteIdImpedanceChannel1:201,OBCIGanglionByteIdImpedanceChannel2:202,OBCIGanglionByteIdImpedanceChannel3:203,OBCIGanglionByteIdImpedanceChannel4:204,OBCIGanglionByteIdImpedanceChannelReference:205,OBCIGanglionByteIdMultiPacket:206,OBCIGanglionByteIdMultiPacketStop:207,OBCIGanglionMCP3912Gain:51,OBCIGanglionMCP3912Vref:1.2,OBCIGanglionPacketSize:20,OBCIGanglionPacket18Bit:{auxByte:20,byteId:0,dataStart:1,dataStop:19},OBCIGanglionPacket19Bit:{byteId:0,dataStart:1,dataStop:20},OBCIGanglionPrefix:dn,OBCIGanglionSamplesPerPacket:2,OBCIGanglionSyntheticDataEnable:"t",OBCIGanglionSyntheticDataDisable:"T",OBCIGanglionImpedanceStart:"z",OBCIGanglionImpedanceStop:"Z",OBCIGanglionScaleFactorPerCountVolts:1.8699498629276494e-9,SimbleeUuidService:"fe84",SimbleeUuidReceive:"2d30c082f39f4ce6923f3484ea480596",SimbleeUuidSend:"2d30c083f39f4ce6923f3484ea480596",SimbleeUuidDisconnect:"2d30c084f39f4ce6923f3484ea480596",RFduinoUuidService:"2220",RFduinoUuidReceive:"2221",RFduinoUuidSend:"2222",RFduinoUuidSendTwo:"2223",OBCICytonBLESamplesPerPacket:3,OBCIGanglionAccelScaleFactor:.016,OBCINobleEmitterPeripheralConnect:"connect",OBCINobleEmitterPeripheralDisconnect:"disconnect",OBCINobleEmitterPeripheralDiscover:"discover",OBCINobleEmitterPeripheralServicesDiscover:"servicesDiscover",OBCINobleEmitterServiceCharacteristicsDiscover:"characteristicsDiscover",OBCINobleEmitterServiceRead:"read",OBCINobleEmitterDiscover:"discover",OBCINobleEmitterScanStart:"scanStart",OBCINobleEmitterScanStop:"scanStop",OBCINobleEmitterStateChange:"stateChange",OBCINobleStatePoweredOn:"poweredOn",getPeripheralLocalNames:function(e){return new Promise((function(t,n){var r=[];return e.forEach((function(e){r.push(e.advertisement.localName)})),r.length>0?t(r):n(Error("No peripherals discovered with prefix equal to ".concat(dn)))}))},getPeripheralWithLocalName:function(e,t){return new Promise((function(n,r){return"object"!==It(e)?r(Error("pArray must be of type Object")):(e.forEach((function(e){if(e.advertisement.hasOwnProperty("localName")&&e.advertisement.localName===t)return n(e)})),r(Error("No peripheral found with localName: ".concat(t))))}))},getVersionNumber:function(e){return Number(e[1])},isPeripheralGanglion:function(e){return!!(e&&e.hasOwnProperty("advertisement")&&null!==e.advertisement&&e.advertisement.hasOwnProperty("localName")&&void 0!==e.advertisement.localName&&null!==e.advertisement.localName&&e.advertisement.localName.indexOf(dn)>-1)},commandSampleRateForCmdCyton:kn,commandSampleRateForCmdGanglion:In,commandBoardModeForMode:En,rawDataToSampleObjectDefault:function(e){return void 0===e&&(e=8),{accelArray:[0,0,0],channelSettings:vn.channelSettingsArrayInit(e),decompressedSamples:_n(e),lastSampleNumber:0,rawDataPacket:Buffer.alloc(33),rawDataPackets:[],scale:!0,sendCounts:!1,timeOffset:0,verbose:!1}},OBCIProtocolBLE:"ble",OBCIProtocolSerial:"serial",OBCIProtocolWifi:"wifi",OBCIRegisterQueryAccelerometerFirmwareV1:fn,OBCIRegisterQueryAccelerometerFirmwareV3:mn,OBCIRegisterQueryCyton:gn,OBCIRegisterQueryCytonDaisy:yn,OBCIRegisterQueryNameMISC1:"MISC1",OBCIRegisterQueryNameBIASSENSP:"BIAS_SENSP",OBCIRegisterQueryNameCHnSET:["CH1SET","CH2SET","CH3SET","CH4SET","CH5SET","CH6SET","CH7SET","CH8SET"],OBCIRegisterQuerySizeCytonFirmwareV1:gn.length+fn.length,OBCIRegisterQuerySizeCytonDaisyFirmwareV1:gn.length+yn.length+fn.length,OBCIRegisterQuerySizeCytonFirmwareV3:gn.length+mn.length,OBCIRegisterQuerySizeCytonDaisyFirmwareV3:gn.length+yn.length+mn.length};function bn(e){return"number"==typeof e}function xn(e){return"boolean"==typeof e}function wn(e){return"string"==typeof e}function Sn(e){return new Promise((function(t,n){switch(e){case Et:t("0");break;case Ot:t("1");break;case Dt:t("2");break;case Bt:t("3");break;case Pt:t("4");break;case Ft:t("5");break;case Nt:t("6");break;case Rt:t("7");break;default:n(Error("Invalid ADC string"))}}))}function Tn(e){return new Promise((function(t,n){switch(e){case 1:t("0");break;case 2:t("1");break;case 4:t("2");break;case 6:t("3");break;case 8:t("4");break;case 12:t("5");break;case 24:t("6");break;default:n(Error("Invalid gain setting of "+e+" gain must be (1,2,4,6,8,12,24)"))}}))}function Cn(e){return new Promise((function(t,n){switch(e){case 1:t("1");break;case 2:t("2");break;case 3:t("3");break;case 4:t("4");break;case 5:t("5");break;case 6:t("6");break;case 7:t("7");break;case 8:t("8");break;case 9:t("Q");break;case 10:t("W");break;case 11:t("E");break;case 12:t("R");break;case 13:t("T");break;case 14:t("Y");break;case 15:t("U");break;case 16:t("I");break;default:n(Error("Invalid channel number"))}}))}function An(e){return{channelNumber:e,powerDown:!1,gain:24,inputType:Et,bias:!0,srb2:!0,srb1:!1}}function _n(e){for(var t=[],n=0;n<3;n++)t.push(new Array(e));return t}function kn(e){return new Promise((function(t,n){switch(e){case 16e3:t("0");break;case 8e3:t("1");break;case 4e3:t("2");break;case 2e3:t("3");break;case 1e3:t("4");break;case 500:t("5");break;case 250:t("6");break;default:n(Error("Invalid sample rate"))}}))}function In(e){return new Promise((function(t,n){switch(e){case 25600:t("0");break;case 12800:t("1");break;case 6400:t("2");break;case 3200:t("3");break;case 1600:t("4");break;case 800:t("5");break;case 400:t("6");break;case 200:t("7");break;default:n(Error("Invalid sample rate"))}}))}function En(e){return new Promise((function(t,n){switch(e){case tn:t("0");break;case nn:t("1");break;case en:t("2");break;case rn:t("3");break;default:n(Error("Invalid sample rate"))}}))}const On=vn;var Dn=n(1481),Bn=n.n(Dn),Pn=n(1301),Fn=n.n(Pn),Nn=4.5,Rn=.002/Math.pow(2,4),Ln={extractRawDataPackets:function(e){if(!e)return{buffer:e,rawDataPackets:[]};var t=e.length,n=[];if(t<On.OBCIPacketSize)return{buffer:e,rawDataPackets:n};for(var r=0;r<=t-On.OBCIPacketSize;){if(e[r]===On.OBCIByteStart&&yr(e[r+On.OBCIPacketSize-1])){var i;i=Uint8Array.from(e.slice(r,r+On.OBCIPacketSize)),n.push(i);var s;s=r>0?Uint8Array.concat([Uint8Array.from(e.slice(0,r)),Uint8Array.from(e.slice(r+On.OBCIPacketSize))]):Uint8Array.from(e.slice(On.OBCIPacketSize)),e=0===s.length?null:Uint8Array.from(s),r=-1,t-=On.OBCIPacketSize}r++}return{buffer:e,rawDataPackets:n}},extractRawBLEDataPackets:function(e){var t=[];if(On.isNull(e))return t;if(e.byteLength!==On.OBCIPacketSizeBLECyton)return t;var n=[0,0,0];n[0]=e[1],n[1]=n[0]+1,n[1]>255&&(n[1]-=256),n[2]=n[1]+1,n[2]>255&&(n[2]-=256);for(var r=0;r<On.OBCICytonBLESamplesPerPacket;r++){var i=Ln.samplePacketZero(n[r]);i[0]=On.OBCIByteStart,i[On.OBCIPacketPositionStopByte]=e[0],e.copy(i,On.OBCIPacketPositionChannelDataStart,On.OBCIPacketPositionChannelDataStart+6*r,On.OBCIPacketPositionChannelDataStart+6+6*r),t.push(i)}return t},transformRawDataPacketToSample:qn,transformRawDataPacketsToSample:function(e){for(var t=[],n=0;n<e.rawDataPackets.length;n++){e.rawDataPacket=e.rawDataPackets[n];var r=qn(e);t.push(r),r.hasOwnProperty("sampleNumber")?e.lastSampleNumber=r.sampleNumber:r.hasOwnProperty("impedanceValue")||(e.lastSampleNumber=e.rawDataPacket[On.OBCIPacketPositionSampleNumber])}return t},convertGanglionArrayToBuffer:function(e,t){for(var n=0;n<On.OBCINumberOfChannelsGanglion;n++)t.writeInt16BE(e[n]>>8,3*n),t.writeInt8(255&e[n],3*n+2)},getRawPacketType:or,getFromTimePacketAccel:tr,getFromTimePacketTime:er,getFromTimePacketRawAux:nr,ganglionFillRawDataPacket:function(e){if(On.isUndefined(e)||On.isUndefined(e.rawDataPacket)||On.isNull(e.rawDataPacket)||On.isUndefined(e.data)||On.isNull(e.data))throw new Error(On.OBCIErrorUndefinedOrNullInput);if(!e.hasOwnProperty("sampleNumber"))throw new Error(On.OBCIErrorUndefinedOrNullInput);if(e.rawDataPacket.byteLength!==On.OBCIPacketSize)throw new Error(On.OBCIErrorInvalidByteLength);if(e.data.byteLength!==On.OBCIPacketSizeBLERaw)throw new Error(On.OBCIErrorInvalidByteLength);e.data.copy(e.rawDataPacket,On.OBCIPacketPositionChannelDataStart),e.rawDataPacket[On.OBCIPacketPositionSampleNumber]=e.sampleNumber,e.rawDataPacket[On.OBCIPacketPositionStartByte]=On.OBCIByteStart,e.rawDataPacket[On.OBCIPacketPositionStopByte]=On.OBCIStreamPacketStandardRawAux},parsePacketStandardAccel:function(e){if(On.isUndefined(e)||On.isUndefined(e.rawDataPacket)||On.isNull(e.rawDataPacket))throw new Error(On.OBCIErrorUndefinedOrNullInput);if(e.rawDataPacket.byteLength!==On.OBCIPacketSize)throw new Error(On.OBCIErrorInvalidByteLength);if(e.rawDataPacket[0]!==On.OBCIByteStart)throw new Error(On.OBCIErrorInvalidByteStart);var t={};return(On.isUndefined(e.scale)||On.isNull(e.scale))&&(e.scale=!0),e.scale?t.accelData=rr(e.rawDataPacket.slice(On.OBCIPacketPositionStartAux,On.OBCIPacketPositionStopAux+1)):t.accelDataCounts=ir(e.rawDataPacket.slice(On.OBCIPacketPositionStartAux,On.OBCIPacketPositionStopAux+1)),e.scale?t.channelData=sr(e):t.channelDataCounts=ar(e),t.auxData=Uint8Array.from(e.rawDataPacket.slice(On.OBCIPacketPositionStartAux,On.OBCIPacketPositionStopAux+1)),t.sampleNumber=e.rawDataPacket[On.OBCIPacketPositionSampleNumber],t.startByte=e.rawDataPacket[0],t.stopByte=e.rawDataPacket[On.OBCIPacketPositionStopByte],t.valid=!0,t.timestamp=Date.now(),t.boardTime=0,t},parsePacketStandardRawAux:function(e){if(On.isUndefined(e)||On.isUndefined(e.rawDataPacket)||On.isNull(e.rawDataPacket))throw new Error(On.OBCIErrorUndefinedOrNullInput);if(e.rawDataPacket.byteLength!==On.OBCIPacketSize)throw new Error(On.OBCIErrorInvalidByteLength);if(e.rawDataPacket[0]!==On.OBCIByteStart)throw new Error(On.OBCIErrorInvalidByteStart);var t={};return(On.isUndefined(e.scale)||On.isNull(e.scale))&&(e.scale=!0),e.scale?t.channelData=sr(e):t.channelDataCounts=ar(e),t.auxData=Uint8Array.from(e.rawDataPacket.slice(On.OBCIPacketPositionStartAux,On.OBCIPacketPositionStopAux+1)),t.sampleNumber=e.rawDataPacket[On.OBCIPacketPositionSampleNumber],t.startByte=e.rawDataPacket[0],t.stopByte=e.rawDataPacket[On.OBCIPacketPositionStopByte],t.valid=!0,t.timestamp=Date.now(),t.boardTime=0,t},parsePacketTimeSyncedAccel:function(e){if(On.isUndefined(e)||On.isUndefined(e.rawDataPacket)||On.isNull(e.rawDataPacket))throw new Error(On.OBCIErrorUndefinedOrNullInput);if(e.rawDataPacket.byteLength!==On.OBCIPacketSize)throw new Error(On.OBCIErrorInvalidByteLength);if(e.rawDataPacket[0]!==On.OBCIByteStart)throw new Error(On.OBCIErrorInvalidByteStart);var t={};return t.sampleNumber=e.rawDataPacket[On.OBCIPacketPositionSampleNumber],t.startByte=e.rawDataPacket[0],t.stopByte=e.rawDataPacket[On.OBCIPacketPositionStopByte],t.boardTime=er(e.rawDataPacket),e.hasOwnProperty("timeOffset")?t.timestamp=t.boardTime+e.timeOffset:t.timestamp=Date.now(),t.auxData=nr(e.rawDataPacket),(On.isUndefined(e.scale)||On.isNull(e.scale))&&(e.scale=!0),e.scale?t.channelData=sr(e):t.channelDataCounts=ar(e),tr(e)&&(e.scale?t.accelData=e.accelArray:t.accelDataCounts=e.accelArray),t.valid=!0,t},parsePacketTimeSyncedRawAux:function(e){if(On.isUndefined(e)||On.isUndefined(e.rawDataPacket)||On.isNull(e.rawDataPacket))throw new Error(On.OBCIErrorUndefinedOrNullInput);if(e.rawDataPacket.byteLength!==On.OBCIPacketSize)throw new Error(On.OBCIErrorInvalidByteLength);if(e.rawDataPacket[0]!==On.OBCIByteStart)throw new Error(On.OBCIErrorInvalidByteStart);var t={};return t.sampleNumber=e.rawDataPacket[On.OBCIPacketPositionSampleNumber],t.startByte=e.rawDataPacket[0],t.stopByte=e.rawDataPacket[On.OBCIPacketPositionStopByte],t.boardTime=er(e.rawDataPacket),e.hasOwnProperty("timeOffset")?t.timestamp=t.boardTime+e.timeOffset:t.timestamp=Date.now(),t.auxData=nr(e.rawDataPacket),(On.isUndefined(e.scale)||On.isNull(e.scale))&&(e.scale=!0),e.scale?t.channelData=sr(e):t.channelDataCounts=ar(e),t.valid=!0,t},parsePacketImpedance:function(e){if(On.isUndefined(e)||On.isUndefined(e.rawDataPacket)||On.isNull(e.rawDataPacket))throw new Error(On.OBCIErrorUndefinedOrNullInput);if(e.rawDataPacket.byteLength!==On.OBCIPacketSize)throw new Error(On.OBCIErrorInvalidByteLength);var t={};return t.channelNumber=e.rawDataPacket[1],5===t.channelNumber&&(t.channelNumber=0),t.impedanceValue=Number(e.rawDataPacket.toString().match(/\d+/)[0]),t},convertSampleToPacketStandard:function(e){var t=new Uint8Array(On.OBCIPacketSize);t.fill(0),t[0]=On.OBCIByteStart,t[1]=e.sampleNumber;for(var n=0;n<On.OBCINumberOfChannelsDefault;n++)hr(e.channelData[n]).copy(t,2+3*n);for(var r=0;r<3;r++)pr(e.auxData[r]).copy(t,On.OBCIPacketSize-1-6+2*r);return t[On.OBCIPacketSize-1]=On.OBCIByteStop,t},convertSampleToPacketRawAux:function(e,t){var n=new Uint8Array(On.OBCIPacketSize);n.fill(0),n[0]=On.OBCIByteStart,n[1]=e.sampleNumber;for(var r=0;r<On.OBCINumberOfChannelsDefault;r++)hr(e.channelData[r]).copy(n,2+3*r);return t.copy(n,26),n[On.OBCIPacketSize-1]=gr(On.OBCIStreamPacketStandardRawAux),n},convertSampleToPacketAccelTimeSyncSet:function(e,t){var n=mr(e,t);return n[On.OBCIPacketPositionStopByte]=gr(On.OBCIStreamPacketAccelTimeSyncSet),n},convertSampleToPacketAccelTimeSynced:mr,convertSampleToPacketRawAuxTimeSyncSet:function(e,t,n){var r=fr(e,t,n);return r[On.OBCIPacketPositionStopByte]=gr(On.OBCIStreamPacketRawAuxTimeSyncSet),r},convertSampleToPacketRawAuxTimeSynced:fr,debugPrettyPrint:function(e){if(null==e)console.log("== Sample is undefined ==");else{console.log("-- Sample --"),console.log("---- Start Byte: "+e.startByte),console.log("---- Sample Number: "+e.sampleNumber);for(var t=0;t<8;t++)console.log("---- Channel Data "+(t+1)+": "+e.channelData[t]);if(e.accelData)for(var n=0;n<3;n++)console.log("---- Accel Data "+n+": "+e.accelData[n]);e.auxData&&console.log("---- Aux Data "+e.auxData),console.log("---- Stop Byte: "+e.stopByte)}},samplePrintHeader:function(){return"All voltages in Volts!sampleNumber, channel1, channel2, channel3, channel4, channel5, channel6, channel7, channel8, aux1, aux2, aux3\n"},samplePrintLine:function(e){return new Promise((function(t,n){null==e&&n(Error("undefined sample")),t(e.sampleNumber+","+e.channelData[0].toFixed(8)+","+e.channelData[1].toFixed(8)+","+e.channelData[2].toFixed(8)+","+e.channelData[3].toFixed(8)+","+e.channelData[4].toFixed(8)+","+e.channelData[5].toFixed(8)+","+e.channelData[6].toFixed(8)+","+e.channelData[7].toFixed(8)+","+e.auxData[0].toFixed(8)+","+e.auxData[1].toFixed(8)+","+e.auxData[2].toFixed(8)+"\n")}))},floatTo3ByteBuffer:hr,floatTo2ByteBuffer:pr,impedanceCalculationForChannel:function(e,t){var n=Math.sqrt(2);return new Promise((function(r,i){null==e&&i(Error("Sample Object cannot be null or undefined")),void 0!==e.channelData&&null!==e.channelData||i(Error("Channel cannot be null or undefined")),(t<1||t>On.OBCINumberOfChannelsDefault)&&i(Error("Channel number invalid."));var s=t-1;e.channelData[s]<0&&(e.channelData[s]*=-1),r(n*e.channelData[s]/On.OBCILeadOffDriveInAmps)}))},impedanceCalculationForAllChannels:function(e){var t=Math.sqrt(2);return new Promise((function(n,r){null==e&&r(Error("Sample Object cannot be null or undefined")),void 0!==e.channelData&&null!==e.channelData||r(Error("Channel cannot be null or undefined"));for(var i=[],s=e.channelData.length,a=0;a<s;a++){e.channelData[a]<0&&(e.channelData[a]*=-1);var o=t*e.channelData[a]/On.OBCILeadOffDriveInAmps;i.push(o)}e.impedances=i,n(e)}))},interpret16bitAsInt32:function(e){var t=0;return e[0]>127&&(t=65535),t<<16|e[0]<<8|e[1]},interpret24bitAsInt32:function(e){var t=0;return e[0]>127&&(t=255),t<<24|e[0]<<16|e[1]<<8|e[2]},impedanceArray:function(e){for(var t=[],n=0;n<e;n++)t.push(Hn(n+1));return t},impedanceObject:Hn,impedanceSummarize:function(e){e.raw>On.OBCIImpedanceThresholdBadMax?e.text=On.OBCIImpedanceTextNone:e.text=On.getTextForRawImpedance(e.raw)},newSample:cr,newSampleNoScale:lr,randomSample:function(e,t,n,r){var i=Bn()(0,1),s=1e6,a=new Array(e+1);a.fill(0);var o=[0,0,0],u=0,c=Math.floor(t/25);c<1&&(c=1);var l=new Array(e).fill(0),h=new Array(e).fill(0),p=new Array(e).fill(0);return function(d){for(var f,m=cr(),g=0;g<e;g++){switch(f=i.ppf(Math.random())*Math.sqrt(t/2)/s,g){case 0:case 1:n&&(a[g]+=2*Math.PI*10/t,a[g]>2*Math.PI&&(a[g]-=2*Math.PI),f+=5*Math.SQRT2*Math.sin(a[g])/s);break;default:r===On.OBCISimulatorLineNoiseHz60?(a[g]+=2*Math.PI*60/t,a[g]>2*Math.PI&&(a[g]-=2*Math.PI),f+=8*Math.SQRT2*Math.sin(a[g])/s):r===On.OBCISimulatorLineNoiseHz50&&(a[g]+=2*Math.PI*50/t,a[g]>2*Math.PI&&(a[g]-=2*Math.PI),f+=8*Math.SQRT2*Math.sin(a[g])/s)}l[g]=.99765*l[g]+.099046*f,h[g]=.963*h[g]+.2965164*f,p[g]=.57*p[g]+1.0526913*f,m.channelData[g]=l[g]+h[g]+p[g]+.1848*f}if(m.sampleNumber=255===d?0:d+1,u===c){var y=[0,0,0];y[0]=.1*Math.random()*(Math.random()>.5?-1:1),y[1]=.1*Math.random()*(Math.random()>.5?-1:1),y[2]=1-.4*Math.random()*(Math.random()>.5?-1:1),m.auxData=y,u=0}else u++,m.auxData=o;return m}},scaleFactorAux:Rn,impedanceCalculateArray:function(e,t){if(t.buffer.push(e.channelData),t.count++,t.count>=t.window){for(var n=[],r=0;r<e.channelData.length;r++){for(var i=0,s=0;s<t.window;s++)t.buffer[r][s]>i&&(i=t.buffer[r][s]);for(var a=0,o=0;o<t.window;o++)t.buffer[r][o]<a&&(a=t.buffer[r][o]);var u=i-a;n.push(u/2/On.OBCILeadOffDriveInAmps)}return t.count=0,n}return null},impedanceTestObjDefault:function(e){var t=e||{};return t.active=!1,t.buffer=[],t.count=0,t.isTestingPInput=!1,t.isTestingNInput=!1,t.onChannel=0,t.sampleNumber=0,t.continuousMode=!1,t.impedanceForChannel=0,t.window=40,t},samplePacket:function(e){return new Uint8Array([160,ur(e),0,0,1,0,0,2,0,0,3,0,0,4,0,0,5,0,0,6,0,0,7,0,0,8,0,0,0,1,0,2,gr(On.OBCIStreamPacketStandardAccel)])},samplePacketZero:function(e){return new Uint8Array([160,ur(e),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,gr(On.OBCIStreamPacketStandardAccel)])},samplePacketReal:function(e){return new Uint8Array([160,ur(e),143,242,64,143,223,244,144,43,182,143,191,191,127,255,255,127,255,255,148,37,52,32,182,125,0,224,0,224,15,112,gr(On.OBCIStreamPacketStandardAccel)])},samplePacketStandardRawAux:function(e){return new Uint8Array([160,ur(e),0,0,1,0,0,2,0,0,3,0,0,4,0,0,5,0,0,6,0,0,7,0,0,8,0,1,2,3,4,5,gr(On.OBCIStreamPacketStandardRawAux)])},samplePacketAccelTimeSyncSet:function(e){return new Uint8Array([160,ur(e),0,0,1,0,0,2,0,0,3,0,0,4,0,0,5,0,0,6,0,0,7,0,0,8,0,1,0,0,0,1,gr(On.OBCIStreamPacketAccelTimeSyncSet)])},samplePacketAccelTimeSynced:function(e){return new Uint8Array([160,ur(e),0,0,1,0,0,2,0,0,3,0,0,4,0,0,5,0,0,6,0,0,7,0,0,8,0,1,0,0,0,1,gr(On.OBCIStreamPacketAccelTimeSynced)])},samplePacketRawAuxTimeSyncSet:function(e){return new Uint8Array([160,ur(e),0,0,1,0,0,2,0,0,3,0,0,4,0,0,5,0,0,6,0,0,7,0,0,8,0,1,0,0,0,1,gr(On.OBCIStreamPacketRawAuxTimeSyncSet)])},samplePacketRawAuxTimeSynced:function(e){return new Uint8Array([160,ur(e),0,0,1,0,0,2,0,0,3,0,0,4,0,0,5,0,0,6,0,0,7,0,0,8,0,1,0,0,0,1,gr(On.OBCIStreamPacketRawAuxTimeSynced)])},samplePacketImpedance:function(e){return new Uint8Array([160,e,54,52,49,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,gr(On.OBCIStreamPacketImpedance)])},samplePacketUserDefined:function(){return new Uint8Array([160,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,gr(On.OBCIStreamPacketUserDefinedType)])},samplePacketCytonBLE:function(e){return new Uint8Array([192,ur(e),0,0,1,0,0,2,0,0,10,0,0,20,0,0,100,0,0,200])},countADSPresent:function(e){var t=new(Fn())(new Uint8Array("ADS1299"));return t.reset(),t.push(e),t.matches},doesBufferHaveEOT:function(e){var t=new(Fn())(new Uint8Array(On.OBCIParseEOT));return t.reset(),t.push(e),t.matches>=1},getBiasSetFromADSRegisterQuery:Yn,getBooleanFromRegisterQuery:Xn,getChannelDataArray:sr,getChannelDataArrayNoScale:ar,getDataArrayAccel:rr,getDataArrayAccelNoScale:ir,getFirmware:function(e){var t=e.toString().match(/v\d.\d*.\d*/);if(t){var n=t[0].split(".");return{major:Number(n[0][1]),minor:Number(n[1]),patch:Number(n[2]),raw:t[0]}}return t},getSRB1FromADSRegisterQuery:Zn,getNumFromThreeCSVADSRegisterQuery:Qn,isEven:dr,isFailureInBuffer:function(e){var t=new(Fn())(new Uint8Array(On.OBCIParseFailure));return t.reset(),t.push(e),t.matches>=1},isOdd:function(e){return e%2==1},isStopByte:yr,isSuccessInBuffer:function(e){var t=new(Fn())(new Uint8Array(On.OBCIParseSuccess));return t.reset(),t.push(e),t.matches>=1},isTimeSyncSetConfirmationInBuffer:function(e){if(e){var t=e.length;switch(t){case 0:return!1;case 1:return e[0]===On.OBCISyncTimeSent.charCodeAt(0);case 2:return e[1]===On.OBCIByteStart?e[0]===On.OBCISyncTimeSent.charCodeAt(0):!!yr(e[0])&&e[1]===On.OBCISyncTimeSent.charCodeAt(0);default:if(e[0]===On.OBCISyncTimeSent.charCodeAt(0)&&e[1]===On.OBCIByteStart)return!0;for(var n=1;n<t;n++)if(n===t-1){if(yr(e[n-1]))return e[n]===On.OBCISyncTimeSent.charCodeAt(0)}else if(yr(e[n-1])&&e[n+1]===On.OBCIByteStart)return e[n]===On.OBCISyncTimeSent.charCodeAt(0);return!1}}},makeDaisySampleObject:function(e,t){var n={};return e.hasOwnProperty("channelData")&&(n.channelData=e.channelData.concat(t.channelData)),e.hasOwnProperty("channelDataCounts")&&(n.channelDataCounts=e.channelDataCounts.concat(t.channelDataCounts)),n.sampleNumber=Math.floor(t.sampleNumber/2),n.auxData={lower:e.auxData,upper:t.auxData},n.stopByte=e.stopByte,n.timestamp=(e.timestamp+t.timestamp)/2,n._timestamps={lower:e.timestamp,upper:t.timestamp},e.hasOwnProperty("accelData")&&(e.accelData[0]>0||e.accelData[1]>0||e.accelData[2]>0?n.accelData=e.accelData:n.accelData=t.accelData),e.hasOwnProperty("accelDataCounts")&&(e.accelDataCounts[0]>0||e.accelDataCounts[1]>0||e.accelDataCounts[2]>0?n.accelDataCounts=e.accelDataCounts:n.accelDataCounts=t.accelDataCounts),n.valid=!0,n},makeDaisySampleObjectWifi:function(e,t){var n={};return e.hasOwnProperty("channelData")&&(n.channelData=e.channelData.concat(t.channelData)),e.hasOwnProperty("channelDataCounts")&&(n.channelDataCounts=e.channelDataCounts.concat(t.channelDataCounts)),n.sampleNumber=t.sampleNumber,n.auxData={lower:e.auxData,upper:t.auxData},e.hasOwnProperty("timestamp")&&(n.timestamp=e.timestamp),n.stopByte=e.stopByte,n._timestamps={lower:e.timestamp,upper:t.timestamp},e.hasOwnProperty("accelData")&&(e.accelData[0]>0||e.accelData[1]>0||e.accelData[2]>0?n.accelData=e.accelData:n.accelData=t.accelData),e.hasOwnProperty("accelDataCounts")&&(e.accelDataCounts[0]>0||e.accelDataCounts[1]>0||e.accelDataCounts[2]>0?n.accelDataCounts=e.accelDataCounts:n.accelDataCounts=t.accelDataCounts),n.valid=!0,n},makeTailByteFromPacketType:gr,newSyncObject:function(){return{boardTime:0,correctedTransmissionTime:!1,error:null,timeSyncSent:0,timeSyncSentConfirmation:0,timeSyncSetPacket:0,timeRoundTrip:0,timeTransmission:0,timeOffset:0,timeOffsetMaster:0,valid:!1}},setChSetFromADSRegisterQuery:Jn,stripToEOTBuffer:function(e){var t=e.indexOf(On.OBCIParseEOT);return t>=0?(t+=On.OBCIParseEOT.length)<e.byteLength?Uint8Array.from(e.slice(t)):null:e},syncChannelSettingsWithRawData:function(e){if(On.isUndefined(e)||On.isUndefined(e.channelSettings)||On.isNull(e.channelSettings)||On.isUndefined(e.data)||On.isNull(e.data))throw new Error(On.OBCIErrorUndefinedOrNullInput);if(!Array.isArray(e.channelSettings))throw new Error("".concat(On.OBCIErrorInvalidType," channelSettings"));if(e.channelSettings.length===On.OBCINumberOfChannelsCyton){if(e.data.toString().match(/Daisy ADS/))throw new Error("raw data mismatch - expected only cyton register info but also found daisy");if(null==e.data.toString().match(/Board ADS/))throw new Error(On.OBCIErrorInvalidData)}else{if(null==e.data.toString().match(/Daisy ADS/))throw new Error("raw data mismatch - expected daisy register info but none found");if(null==e.data.toString().match(/Board ADS/))throw new Error("no Board ADS info found")}e.channelSettings.forEach((function(e){if(!(e.hasOwnProperty("channelNumber")&&e.hasOwnProperty("powerDown")&&e.hasOwnProperty("gain")&&e.hasOwnProperty("inputType")&&e.hasOwnProperty("bias")&&e.hasOwnProperty("srb2")&&e.hasOwnProperty("srb1")))throw new Error(On.OBCIErrorMissingRequiredProperty)}));var t=null,n=!1,r=!1,i=e.data.toString().match(/Board ADS/),s=e.data.toString().slice(i.index,On.OBCIRegisterQueryCyton.length);if(Zn(s)&&(n=!0),e.channelSettings.length>On.OBCINumberOfChannelsCyton){var a=e.data.toString().match(/Daisy ADS/);t=e.data.toString().slice(a.index,a.index+On.OBCIRegisterQueryCytonDaisy.length),Zn(s)&&(r=!0)}e.channelSettings.forEach((function(e){e.channelNumber<On.OBCINumberOfChannelsCyton?(Jn(s,e),e.bias=Yn(s,e.channelNumber),e.srb1=n):(Jn(t,e),e.bias=Yn(t,e.channelNumber-On.OBCINumberOfChannelsCyton),e.srb1=r)}))},droppedPacketCheck:function(e,t){if(e===On.OBCISampleNumberMax&&0===t)return null;if(t-e==1)return null;var n=[];if(e>t){for(var r=On.OBCISampleNumberMax-e,i=0;i<r;i++)n.push(e+i+1);e=-1}for(var s=1;s<t-e;s++)n.push(e+s);return n},convert18bitAsInt32:Un,convert19bitAsInt32:Kn,decompressDeltas18Bit:jn,decompressDeltas19Bit:Wn,sampleCompressedData:function(e){return new Uint8Array([e,0,0,0,0,8,0,5,0,0,72,0,9,240,1,176,0,48,0,8])},sampleBLERaw:function(){return new Uint8Array([0,0,1,0,0,2,0,0,3,0,0,4])},sampleImpedanceChannel1:function(){return new Uint8Array([On.OBCIGanglionByteIdImpedanceChannel1,0,0,1])},sampleImpedanceChannel2:function(){return new Uint8Array([On.OBCIGanglionByteIdImpedanceChannel2,0,0,1])},sampleImpedanceChannel3:function(){return new Uint8Array([On.OBCIGanglionByteIdImpedanceChannel3,0,0,1])},sampleImpedanceChannel4:function(){return new Uint8Array([On.OBCIGanglionByteIdImpedanceChannel4,0,0,1])},sampleImpedanceChannelReference:function(){return new Uint8Array([On.OBCIGanglionByteIdImpedanceChannelReference,0,0,1])},sampleMultiBytePacket:function(e){var t=new Uint8Array([On.OBCIGanglionByteIdMultiPacket]);return Uint8Array.concat([t,e])},sampleMultiBytePacketStop:function(e){var t=new Uint8Array([On.OBCIGanglionByteIdMultiPacketStop]);return Uint8Array.concat([t,e])},sampleOtherData:function(e){var t=new Uint8Array([255]);return Uint8Array.concat([t,e])},sampleUncompressedData:function(){return new Uint8Array([0,0,0,1,0,0,2,0,0,3,0,0,4,1,2,3,4,5,6,7])},parseGanglion:function(e){var t=parseInt(e.rawDataPacket[0]);if(t<=On.OBCIGanglionByteId19Bit.max)return Gn(e);switch(t){case On.OBCIGanglionByteIdMultiPacket:return Mn(e);case On.OBCIGanglionByteIdMultiPacketStop:return zn(e);case On.OBCIGanglionByteIdImpedanceChannel1:case On.OBCIGanglionByteIdImpedanceChannel2:case On.OBCIGanglionByteIdImpedanceChannel3:case On.OBCIGanglionByteIdImpedanceChannel4:case On.OBCIGanglionByteIdImpedanceChannelReference:return function(e){var t;switch(parseInt(e.rawDataPacket[0])){case On.OBCIGanglionByteIdImpedanceChannel1:t=1;break;case On.OBCIGanglionByteIdImpedanceChannel2:t=2;break;case On.OBCIGanglionByteIdImpedanceChannel3:t=3;break;case On.OBCIGanglionByteIdImpedanceChannel4:t=4;break;case On.OBCIGanglionByteIdImpedanceChannelReference:t=0}for(var n={channelNumber:t,impedanceValue:0},r=e.rawDataPacket.length;Number.isNaN(Number(e.rawDataPacket.slice(1,r)))&&0!==r;)r--;return 0!==r&&(n.impedanceValue=Number(e.rawDataPacket.slice(1,r))),n}(e);default:return null}},processMultiBytePacket:Mn,processMultiBytePacketStop:zn};function Mn(e){e.multiPacketBuffer?e.multiPacketBuffer=Uint8Array.concat([Uint8Array.from(e.multiPacketBuffer),Uint8Array.from(e.rawDataPacket.slice(On.OBCIGanglionPacket19Bit.dataStart,On.OBCIGanglionPacket19Bit.dataStop))]):e.multiPacketBuffer=e.rawDataPacket.slice(On.OBCIGanglionPacket19Bit.dataStart,On.OBCIGanglionPacket19Bit.dataStop)}function zn(e){Mn(e);var t=e.multiPacketBuffer.toString();return e.multiPacketBuffer=null,{message:t}}function $n(e,t){for(var n=1;n<3;n++)for(var r=0;r<4;r++)e.decompressedSamples[n][r]=e.decompressedSamples[n-1][r]-t[n-1][r]}function Vn(e,t,n){var r;if(n)(r=lr(e)).channelDataCounts=t;else{r=cr(e);for(var i=0;i<On.OBCINumberOfChannelsGanglion;i++)r.channelData.push(t[i]*On.OBCIGanglionScaleFactorPerCountVolts)}return r.timestamp=Date.now(),r}function Gn(e){return parseInt(e.rawDataPacket[0])===On.OBCIGanglionByteIdUncompressed?function(e){e.lastSampleNumber=On.OBCIGanglionByteIdUncompressed;for(var t=0;t<4;t++)e.decompressedSamples[0][t]=Ln.interpret24bitAsInt32(e.rawDataPacket.slice(1+3*t,1+3*t+3));return[Vn(0,e.decompressedSamples[0],e.sendCounts)]}(e):function(e){e.lastSampleNumber=parseInt(e.rawDataPacket[0]);var t=[];if(e.lastSampleNumber<=On.OBCIGanglionByteId18Bit.max)switch($n(e,jn(e.rawDataPacket.slice(On.OBCIGanglionPacket18Bit.dataStart,On.OBCIGanglionPacket18Bit.dataStop))),t.push(Vn(2*e.lastSampleNumber-1,e.decompressedSamples[1],e.sendCounts)),t.push(Vn(2*e.lastSampleNumber,e.decompressedSamples[2],e.sendCounts)),e.lastSampleNumber%10){case On.OBCIGanglionAccelAxisX:e.accelArray[0]=e.sendCounts?e.rawDataPacket.readInt8(On.OBCIGanglionPacket18Bit.auxByte-1):e.rawDataPacket.readInt8(On.OBCIGanglionPacket18Bit.auxByte-1)*On.OBCIGanglionAccelScaleFactor;break;case On.OBCIGanglionAccelAxisY:e.accelArray[1]=e.sendCounts?e.rawDataPacket.readInt8(On.OBCIGanglionPacket18Bit.auxByte-1):e.rawDataPacket.readInt8(On.OBCIGanglionPacket18Bit.auxByte-1)*On.OBCIGanglionAccelScaleFactor;break;case On.OBCIGanglionAccelAxisZ:e.accelArray[2]=e.sendCounts?e.rawDataPacket.readInt8(On.OBCIGanglionPacket18Bit.auxByte-1):e.rawDataPacket.readInt8(On.OBCIGanglionPacket18Bit.auxByte-1)*On.OBCIGanglionAccelScaleFactor,e.sendCounts?t[0].accelData=e.accelArray:t[0].accelDataCounts=e.accelArray}else $n(e,Wn(e.rawDataPacket.slice(On.OBCIGanglionPacket19Bit.dataStart,On.OBCIGanglionPacket19Bit.dataStop))),t.push(Vn(2*(e.lastSampleNumber-100)-1,e.decompressedSamples[1],e.sendCounts)),t.push(Vn(2*(e.lastSampleNumber-100),e.decompressedSamples[2],e.sendCounts));for(var n=0;n<On.OBCINumberOfChannelsGanglion;n++)e.decompressedSamples[0][n]=e.decompressedSamples[2][n];return t}(e)}function Un(e){var t=0;return!0&e[2]&&(t=16383),t<<18|e[0]<<16|e[1]<<8|e[2]}function Kn(e){var t=0;return!0&e[2]&&(t=8191),t<<19|e[0]<<16|e[1]<<8|e[2]}function jn(e){var t=new Array(On.OBCIGanglionSamplesPerPacket);t[0]=[0,0,0,0],t[1]=[0,0,0,0];for(var n,r=[],i=0;i<On.OBCIGanglionSamplesPerPacket;i++)r.push([0,0,0,0]);return n=new Uint8Array([e[0]>>6,(63&e[0])<<2|e[1]>>6,(63&e[1])<<2|e[2]>>6]),r[0][0]=Un(n),n=new Uint8Array([(63&e[2])>>4,e[2]<<4|e[3]>>4,e[3]<<4|e[4]>>4]),r[0][1]=Un(n),n=new Uint8Array([(15&e[4])>>2,e[4]<<6|e[5]>>2,e[5]<<6|e[6]>>2]),r[0][2]=Un(n),n=new Uint8Array([3&e[6],e[7],e[8]]),r[0][3]=Un(n),n=new Uint8Array([e[9]>>6,(63&e[9])<<2|e[10]>>6,(63&e[10])<<2|e[11]>>6]),r[1][0]=Un(n),n=new Uint8Array([(63&e[11])>>4,e[11]<<4|e[12]>>4,e[12]<<4|e[13]>>4]),r[1][1]=Un(n),n=new Uint8Array([(15&e[13])>>2,e[13]<<6|e[14]>>2,e[14]<<6|e[15]>>2]),r[1][2]=Un(n),n=new Uint8Array([3&e[15],e[16],e[17]]),r[1][3]=Un(n),r}function Wn(e){var t=new Array(On.OBCIGanglionSamplesPerPacket);t[0]=[0,0,0,0],t[1]=[0,0,0,0];for(var n,r=[],i=0;i<On.OBCIGanglionSamplesPerPacket;i++)r.push([0,0,0,0]);return n=new Uint8Array([e[0]>>5,(31&e[0])<<3|e[1]>>5,(31&e[1])<<3|e[2]>>5]),r[0][0]=Kn(n),n=new Uint8Array([(31&e[2])>>2,e[2]<<6|e[3]>>2,e[3]<<6|e[4]>>2]),r[0][1]=Kn(n),n=new Uint8Array([(3&e[4])<<1|e[5]>>7,(127&e[5])<<1|e[6]>>7,(127&e[6])<<1|e[7]>>7]),r[0][2]=Kn(n),n=new Uint8Array([(127&e[7])>>4,(15&e[7])<<4|e[8]>>4,(15&e[8])<<4|e[9]>>4]),r[0][3]=Kn(n),n=new Uint8Array([(15&e[9])>>1,e[9]<<7|e[10]>>1,e[10]<<7|e[11]>>1]),r[1][0]=Kn(n),n=new Uint8Array([(1&e[11])<<2|e[12]>>6,e[12]<<2|e[13]>>6,e[13]<<2|e[14]>>6]),r[1][1]=Kn(n),n=new Uint8Array([(56&e[14])>>3,(7&e[14])<<5|(248&e[15])>>3,(7&e[15])<<5|(248&e[16])>>3]),r[1][2]=Kn(n),n=new Uint8Array([7&e[16],e[17],e[18]]),r[1][3]=Kn(n),r}function Hn(e){return{channel:e,P:{raw:-1,text:On.OBCIImpedanceTextInit},N:{raw:-1,text:On.OBCIImpedanceTextInit}}}function qn(e){var t;try{switch(or(e.rawDataPacket[On.OBCIPacketPositionStopByte])){case On.OBCIStreamPacketStandardAccel:t=Ln.parsePacketStandardAccel(e);break;case On.OBCIStreamPacketStandardRawAux:t=Ln.parsePacketStandardRawAux(e);break;case On.OBCIStreamPacketAccelTimeSyncSet:case On.OBCIStreamPacketAccelTimeSynced:t=Ln.parsePacketTimeSyncedAccel(e);break;case On.OBCIStreamPacketRawAuxTimeSyncSet:case On.OBCIStreamPacketRawAuxTimeSynced:t=Ln.parsePacketTimeSyncedRawAux(e);break;case On.OBCIStreamPacketImpedance:t=Ln.parsePacketImpedance(e);break;default:t={error:"bad stop byte ".concat(e.rawDataPacket.slice(32,33).toString("hex")),valid:!1,rawDataPacket:e.rawDataPacket},e.verbose&&console.log(t.error)}}catch(n){t={error:n,valid:!1,rawDataPacket:e.rawDataPacket},e.verbose&&console.log(n)}return t}function Xn(e,t,n){var r=e.match(t);if(r){var i=parseInt(e.charAt(r.index+n));if(Number.isNaN(i))throw new Error(On.OBCIErrorInvalidData);return Boolean(i)}throw new Error(On.OBCIErrorMissingRegisterSetting)}function Zn(e){return Xn(e,On.OBCIRegisterQueryNameMISC1,21)}function Yn(e,t){return Xn(e,On.OBCIRegisterQueryNameBIASSENSP,20+3*t)}function Qn(e,t,n){var r=e.match(t);if(r){var i=parseInt(e.charAt(r.index+n)),s=parseInt(e.charAt(r.index+n+3)),a=parseInt(e.charAt(r.index+n+6));if(Number.isNaN(i)||Number.isNaN(s)||Number.isNaN(a))throw new Error(On.OBCIErrorInvalidData);return i<<2|s<<1|a}throw new Error(On.OBCIErrorMissingRegisterSetting)}function Jn(e,t){var n=On.OBCIRegisterQueryNameCHnSET[t.channelNumber];void 0===n&&(n=On.OBCIRegisterQueryNameCHnSET[t.channelNumber-On.OBCINumberOfChannelsCyton]),t.powerDown=Xn(e,n,16),t.gain=On.gainForCommand(Qn(e,n,19)),t.inputType=On.inputTypeForCommand(Qn(e,n,31)),t.srb2=Xn(e,n,28)}function er(e){var t=On.OBCIPacketSize-1;if(e.byteLength!==On.OBCIPacketSize)throw new Error(On.OBCIErrorInvalidByteLength);return e.readUInt32BE(t-On.OBCIStreamPacketTimeByteSize)}function tr(e){var t=On.OBCIPacketSize-1-On.OBCIStreamPacketTimeByteSize-2;if(e.rawDataPacket.byteLength!==On.OBCIPacketSize)throw new Error(On.OBCIErrorInvalidByteLength);var n=e.rawDataPacket[On.OBCIPacketPositionSampleNumber],r=Ln.interpret16bitAsInt32(e.rawDataPacket.slice(t,t+2));switch(n%10){case On.OBCIAccelAxisX:return e.accelArray[0]=e.scale?r*Rn:r,!1;case On.OBCIAccelAxisY:return e.accelArray[1]=e.scale?r*Rn:r,!1;case On.OBCIAccelAxisZ:return e.accelArray[2]=e.scale?r*Rn:r,!0;default:return!1}}function nr(e){if(e.byteLength!==On.OBCIPacketSize)throw new Error(On.OBCIErrorInvalidByteLength);return Uint8Array.from(e.slice(On.OBCIPacketPositionTimeSyncAuxStart,On.OBCIPacketPositionTimeSyncAuxStop))}function rr(e){for(var t=[],n=0;n<3;n++){var r=2*n;t.push(Ln.interpret16bitAsInt32(e.slice(r,r+2))*Rn)}return t}function ir(e){for(var t=[],n=0;n<3;n++){var r=2*n;t.push(Ln.interpret16bitAsInt32(e.slice(r,r+2)))}return t}function sr(e){if(!Array.isArray(e.channelSettings))throw new Error("Error [getChannelDataArray]: Channel Settings must be an array!");e.hasOwnProperty("protocol")||(e.protocol=On.OBCIProtocolSerial);var t=[],n=e.channelSettings.length,r=e.rawDataPacket[On.OBCIPacketPositionSampleNumber],i=n===On.OBCINumberOfChannelsDaisy,s=On.OBCINumberOfChannelsCyton;i||(s=e.channelSettings.length);for(var a=0;a<s;a++){if(!e.channelSettings[a].hasOwnProperty("gain"))throw new Error("Error [getChannelDataArray]: Invalid channel settings object at index ".concat(a));if(!On.isNumber(e.channelSettings[a].gain))throw new Error("Error [getChannelDataArray]: Property gain of channelSettingsObject not or type Number");var o=0;if(e.protocol===On.OBCIProtocolSerial)o=dr(r)&&i?Nn/e.channelSettings[a+On.OBCINumberOfChannelsDefault].gain/(Math.pow(2,23)-1):Nn/e.channelSettings[a].gain/(Math.pow(2,23)-1);else if(e.protocol===On.OBCIProtocolWifi)o=i?e.lastSampleNumber===r?Nn/e.channelSettings[a+On.OBCINumberOfChannelsDefault].gain/(Math.pow(2,23)-1):Nn/e.channelSettings[a].gain/(Math.pow(2,23)-1):e.channelSettings.length===On.OBCINumberOfChannelsCyton?Nn/e.channelSettings[a].gain/(Math.pow(2,23)-1):On.OBCIGanglionScaleFactorPerCountVolts;else{if(e.protocol!==On.OBCIProtocolBLE)throw new Error("Error [getChannelDataArray]: Invalid protocol must be wifi or serial");o=Nn/e.channelSettings[a].gain/(Math.pow(2,23)-1)}t.push(o*Ln.interpret24bitAsInt32(e.rawDataPacket.slice(3*a+On.OBCIPacketPositionChannelDataStart,3*a+On.OBCIPacketPositionChannelDataStart+3)))}return t}function ar(e){if(!Array.isArray(e.channelSettings))throw new Error("Error [getChannelDataArrayNoScale]: Channel Settings must be an array!");var t=[],n=e.channelSettings.length;n>On.OBCINumberOfChannelsDefault&&(n=On.OBCINumberOfChannelsDefault);for(var r=0;r<n;r++)t.push(Ln.interpret24bitAsInt32(e.rawDataPacket.slice(3*r+On.OBCIPacketPositionChannelDataStart,3*r+On.OBCIPacketPositionChannelDataStart+3)));return t}function or(e){return 15&e}function ur(e){return e||0===e?e>255&&(e=255):e=69,e}function cr(e){return e||0===e?e>255&&(e=255):e=0,{startByte:On.OBCIByteStart,sampleNumber:e,channelData:[],accelData:[],auxData:null,stopByte:On.OBCIByteStop,boardTime:0,timestamp:0,valid:!0}}function lr(e){return e||0===e?e>255&&(e=255):e=0,{startByte:On.OBCIByteStart,sampleNumber:e,channelDataCounts:[],accelDataCounts:[],auxData:null,stopByte:On.OBCIByteStop,boardTime:0,timestamp:0,valid:!0}}function hr(e){var t=new Uint8Array(3);t.fill(0);var n=e/(.1875/(Math.pow(2,23)-1));return n=Math.floor(n),t[2]=255&n,t[1]=(65280&n)>>8,t[0]=(n&255<<16)>>16,t}function pr(e){var t=new Uint8Array(2);t.fill(0);var n=e/Rn;return n=Math.floor(n),t[1]=255&n,t[0]=(65280&n)>>8,t}function dr(e){return e%2==0}function fr(e,t,n){var r=new Uint8Array(On.OBCIPacketSize);r.fill(0),r[0]=On.OBCIByteStart,r[1]=e.sampleNumber;for(var i=0;i<On.OBCINumberOfChannelsDefault;i++)hr(e.channelData[i]).copy(r,2+3*i);return n.copy(r,26),r.writeInt32BE(t,28),r[On.OBCIPacketSize-1]=gr(On.OBCIStreamPacketRawAuxTimeSynced),r}function mr(e,t){var n=new Uint8Array(On.OBCIPacketSize);n.fill(0),n[0]=On.OBCIByteStart,n[1]=e.sampleNumber;for(var r=0;r<On.OBCINumberOfChannelsDefault;r++)hr(e.channelData[r]).copy(n,2+3*r);return n.writeInt32BE(t,28),n[On.OBCIPacketSize-1]=gr(On.OBCIStreamPacketAccelTimeSynced),n}function gr(e){return(e<0||e>15)&&(e=0),On.OBCIByteStop|e}function yr(e){return(240&e)===On.OBCIByteStop}function vr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function br(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vr(Object(n),!0).forEach((function(t){xr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var wr=function(e){var t=e.channelData;return br(br({},function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,["channelData"])),{},{data:t})},Sr="ganglion",Tr={reader:"2d30c082-f39f-4ce6-923f-3484ea480596",writer:"2d30c083-f39f-4ce6-923f-3484ea480596",connection:"2d30c084-f39f-4ce6-923f-3484ea480596"},Cr={filters:[{namePrefix:"Ganglion-"}],optionalServices:[65156]},Ar={start:"b",accelData:"n"};function _r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_r(Object(n),!0).forEach((function(t){Ir(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ir(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Er(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,i,s=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(s.push(r.value),!t||s.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Or(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Or(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Or(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Dr(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function Br(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){Dr(s,r,i,a,o,"next",e)}function o(e){Dr(s,r,i,a,o,"throw",e)}a(void 0)}))}}function Pr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Nr(e){var t=parseInt(e.rawDataPacket[0]);if(t<=On.OBCIGanglionByteId19Bit.max)return Gn(e);switch(t){case On.OBCIGanglionByteIdMultiPacket:return processMultiBytePacket(e);case On.OBCIGanglionByteIdMultiPacketStop:return processMultiBytePacketStop(e);case On.OBCIGanglionByteIdImpedanceChannel1:case On.OBCIGanglionByteIdImpedanceChannel2:case On.OBCIGanglionByteIdImpedanceChannel3:case On.OBCIGanglionByteIdImpedanceChannel4:case On.OBCIGanglionByteIdImpedanceChannelReference:return processImpedanceData(e);default:return null}}var Rr=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};function r(e){return{channelNumber:e,powerDown:!1,gain:24,inputType:"normal",bias:!0,srb2:!0,srb1:!1}}Pr(this,e),this.options=n,this.gatt=null,this.device=null,this.deviceName=null,this.service=null,this.characteristics=null,this.onDisconnect$=new bt.Subject,this.boardName=Sr,this.channelSize=4;var i=function(e){for(var t=[],n=0;n<e;n++)t.push(r(n));return t};function s(e){for(var t=[],n=0;n<3;n++)t.push(new Array(e));return t}this.rawDataPacketToSample={accelArray:[0,0,0],channelSettings:i(4),decompressedSamples:s(4),lastSampleNumber:0,rawDataPacket:new Uint8Array(33).buffer,rawDataPackets:[],scale:!0,sendCounts:!1,timeOffset:0,verbose:!1},this.connectionStatus=new xt.BehaviorSubject(!1),this.stream=(new bt.Subject).pipe((0,St.map)((function(e){return t.eventToBufferMapper(e)})),(0,wt.tap)((function(e){return t.setRawDataPacket(e)})),(0,St.map)((function(){return Nr(t.rawDataPacketToSample)})),(0,_t.mergeMap)((function(e){return e})),(0,St.map)(wr),(0,At.takeUntil)(this.onDisconnect$)),this.accelData=this.stream.pipe((0,Ct.filter)((function(e){return e.accelData.length})))}var t,n,r,i;return t=e,(n=[{key:"eventToBufferMapper",value:function(e){return new Uint8Array(e.target.value.buffer)}},{key:"setRawDataPacket",value:function(e){this.rawDataPacketToSample.rawDataPacket=e}},{key:"connect",value:(i=Br(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.bluetooth.requestDevice(Cr);case 2:return this.device=e.sent,this.addDisconnectedEvent(),e.next=6,this.device.gatt.connect();case 6:return this.gatt=e.sent,this.deviceName=this.gatt.device.name,e.next=10,this.gatt.getPrimaryService(65156);case 10:return this.service=e.sent,e.t0=this,e.next=14,this.service.getCharacteristics();case 14:e.t1=e.sent,e.t0.setCharacteristics.call(e.t0,e.t1),this.connectionStatus.next(!0);case 17:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setCharacteristics",value:function(e){this.characteristics=Object.entries(Tr).reduce((function(t,n){var r=Er(n,2),i=r[0],s=r[1];return kr(kr({},t),{},Ir({},i,e.find((function(e){return e.uuid===s}))))}),{})}},{key:"start",value:(r=Br(regeneratorRuntime.mark((function e(){var t,n,r,i,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.characteristics,n=t.reader,r=t.writer,i=Object.entries(Ar).reduce((function(e,t){var n=Er(t,2),r=n[0],i=n[1];return kr(kr({},e),{},Ir({},r,(new TextEncoder).encode(i)))}),{}),n.startNotifications(),n.addEventListener("characteristicvaluechanged",(function(e){s.stream.next(e)})),!this.options.accelData){e.next=8;break}return e.next=7,r.writeValue(i.accelData);case 7:n.readValue();case 8:return e.next=10,r.writeValue(i.start);case 10:n.readValue();case 11:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"addDisconnectedEvent",value:function(){var e=this;(0,kt.fromEvent)(this.device,"gattserverdisconnected").pipe((0,Tt.first)()).subscribe((function(){e.gatt=null,e.device=null,e.deviceName=null,e.service=null,e.characteristics=null,e.connectionStatus.next(!1)}))}},{key:"disconnect",value:function(){this.gatt&&(this.onDisconnect$.next(),this.gatt.disconnect())}}])&&Fr(t.prototype,n),e}();function Lr(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function Mr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){Lr(s,r,i,a,o,"next",e)}function o(e){Lr(s,r,i,a,o,"throw",e)}a(void 0)}))}}function zr(e){return function(e){if(Array.isArray(e))return $r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return $r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$r(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vr(e){return(Vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Ur=function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.onconnect,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ondisconnect;Gr(this,e),this.init=function(e,t){n.info=e,n.info.sps=200,n.info.deviceType="eeg";var r=1e6;if(n.info.eegChannelTags=[{ch:0,tag:"FP1",analyze:!0},{ch:1,tag:"FP2",analyze:!0},{ch:2,tag:"C3",analyze:!0},{ch:3,tag:"C4",analyze:!0}],!0===n.info.useFilters&&n.info.eegChannelTags.forEach((function(e,t){"other"!==e.tag?n.filters.push(new ye(e.ch,n.info.sps,!0,r)):n.filters.push(new ye(e.ch,n.info.sps,!1,r)),n.filters[n.filters.length-1].useScaling=!0,n.filters[n.filters.length-1].notch60.pop()})),!0===t)n.atlas=new ne(location+":"+n.mode,{eegshared:{eegChannelTags:n.info.eegChannelTags,sps:n.info.sps}},"10_20",!0,!0,n.info.analysis),n.info.useAtlas=!0;else if("object"===Vr(t)){var i;n.atlas=t,n.atlas.data.eegshared.eegChannelTags=n.info.eegChannelTags,n.atlas.data.eegshared.sps=n.info.sps,n.atlas.data.eegshared.frequencies=n.atlas.bandpassWindow(0,128,.5*n.info.sps),n.atlas.data.eegshared.bandFreqs=n.atlas.getBandFreqs(n.atlas.data.eegshared.frequencies),n.atlas.data.eeg=n.atlas.gen10_20Atlas(),n.atlas.data.coherence=n.atlas.genCoherenceMap(n.info.eegChannelTags),n.atlas.data.eegshared.eegChannelTags.forEach((function(e,t){void 0===n.atlas.getEEGDataByTag(e.tag)&&n.atlas.addEEGCoord(e.ch)})),n.atlas.settings.coherence=!0,n.atlas.settings.eeg=!0,n.info.useAtlas=!0,e.analysis.length>0&&((i=n.atlas.settings.analysis).push.apply(i,zr(n.info.analysis)),n.atlas.settings.analyzing||(n.atlas.settings.analyzing=!0,n.atlas.analyzer()))}},this.connect=Mr(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.device=new Rr,e.next=3,n.device.connect();case 3:return e.next=5,n.device.start();case 5:n.device.stream.subscribe((function(e){if(n.info.useAtlas){var t=e.timestamp;e.data.forEach((function(e,r){var i=n.atlas.getEEGDataByChannel(r);if(i.times.push(t),i.raw.push(e),i.count++,!0===n.info.useFilters){var s=0;void 0!==n.filters[r]&&(s=n.filters[r].apply(e)),i.filtered.push(s)}}))}})),!0===n.info.useAtlas&&(n.atlas.data.eegshared.startTime=Date.now(),!0!==n.atlas.settings.analyzing&&n.info.analysis.length>0&&(n.atlas.settings.analyzing=!0,setTimeout((function(){n.atlas.analyzer()}),1200))),n.atlas.settings.deviceConnected=!0,n.onconnect(),n.setIndicator(!0);case 10:case"end":return e.stop()}}),e)}))),this.disconnect=function(){n.device.disconnect(),n.atlas.settings.analyzing=!1,n.atlas.settings.deviceConnected=!1,n.ondisconnect(),n.setIndicator(!1)},this.onconnect=function(){},this.ondisconnect=function(){},this.addControls=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,t=(Math.floor(1e4*Math.random()),function(){return"\n            "}),r=function(){};n.ui=new we(t,e,void 0,r)},this.atlas=null,this.mode=t,this.device=null,this.filters=[],this.onconnect=r,this.ondisconnect=i,this.setIndicator=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="lime",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="none"):(document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.background="transparent",document.getElementById("brainsatplay-".concat(n.mode,"-indicator")).style.border="1px solid white")}};function Kr(e){return function(e){if(Array.isArray(e))return jr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return jr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jr(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Wr(e){return(Wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hr(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function qr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){Hr(s,r,i,a,o,"next",e)}function o(e){Hr(s,r,i,a,o,"throw",e)}a(void 0)}))}}function Xr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Zr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Yr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qr(e,t,n){return t&&Yr(e.prototype,t),n&&Yr(e,n),e}var Jr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"public",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"http://localhost:8000",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"http://127.0.0.1:8000";Zr(this,e),ei.call(this),this.devices=[],this.state=new X({commandResult:{}}),this.atlas=new ne("atlas",void 0,void 0,!0,!1),this.info={nDevices:0,auth:{url:new URL(s),username:t,password:n,access:i,appname:r.toLowerCase().split(" ").join("").replace(/^[^a-z]+|[^\w]+/gi,""),authenticated:!1},subscribed:!1,connections:[],localHostURL:a},this.socket=null}var t,n,r;return Qr(e,[{key:"setLoginInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"public",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.info.auth.username=e,this.info.auth.password=t,this.info.auth.access=n,this.info.auth.appname=r}},{key:"connect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"freeeeg32_2",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["eegfft"],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[["eegch","FP1","all"]],o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(!0===s&&(console.log(this.socket),null==this.socket||1!==this.socket.readyState))return console.error("Server connection not found, please run login() first"),!1;if(this.devices.length>0&&(t.indexOf("eeg")>-1||t.indexOf("muse")>-1)){var c=this.devices.find((function(e,t){if("eeg"===e.deviceType)return!0}));c||(u=this.devices[0].atlas)}this.devices.push(new ti(t,n,o,u,s,this.socket,a,this.info.auth));var l=this.devices.length-1;this.devices[l].onconnect=function(){e.info.nDevices++,r(),e.onconnected()},this.devices[l].ondisconnect=function(){i(),e.ondisconnected(),Array.isArray(e.devices[l].info.analysis)&&e.devices[l].info.analysis.length>0&&(e.devices[l].info.analyzing=!1),e.devices[l].info.streaming=!1,e.devices.splice(l,1),e.info.nDevices--},this.devices[l].init(),1===this.devices.length&&(this.atlas=this.devices[0].atlas),this.state.addToState("device"+l,this.devices[l].info),this.devices[l].connect()}},{key:"reconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.devices.length-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e>-1?(this.devices[e].connect(),t()):console.log("No devices connected")}},{key:"disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.devices.length-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e>-1?(this.devices[e].info.streaming=!1,this.devices[e].disconnect(),t()):console.log("No devices connected")}},{key:"makeConnectOptions",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=Math.floor(1e4*Math.random())+"devicemenu",s='<div><span class="collapsible-content-label">Device Selection</span><hr></div><div class="device-gallery">',a=["muse","freeeeg32_2","freeeeg32_19","hegduinousb","hegduinobt","cyton","cyton_daisy","ganglion"];a.forEach((function(e,t){s+="\n\t\t\t<div id='brainsatplay-".concat(e,"' value='").concat(e,"' class='device-card'>\n\t\t\t<div id='brainsatplay-").concat(e,"-indicator' class='indicator'></div>\n\t\t\t").concat(e,"\n\t\t\t</div>")})),s+="</div>",t.insertAdjacentHTML("afterbegin",s),t.insertAdjacentHTML("beforeend","<button id='"+i+"disconnect'>Disconnect</button>"),a.forEach((function(t,i){document.getElementById("brainsatplay-".concat(t)).onclick=function(){"muse"===t?e.connect("muse",["eegcoherence"],n,r):"freeeeg32_2"===t?e.connect("freeeeg32_2",["eegcoherence"],n,r):"freeeeg32_19"===t?e.connect("freeeeg32_19",["eegfft"],n,r):"hegduinousb"===t?e.connect("hegduinousb",[],n,r):"hegduinobt"===t?e.connect("hegduinobt",[],n,r):"hegduinowifi"===t?e.connect("hegduinowifi",[],n,r):"cyton"===t?e.connect("cyton",["eegfft"],n,r):"cyton_daisy"===t?e.connect("cyton_daisy",["eegfft"],n,r):"ganglion"===t&&e.connect("ganglion",["eegcoherence"],n,r)}})),document.getElementById(i+"disconnect").onclick=function(){e.disconnect()}}},{key:"beginStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.devices[e].info.streaming&&(this.devices[e].info.streaming=!0,null!==t&&(this.devices[e].info.streamParams=t),this.devices[e].streamLoop())}},{key:"endStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.devices[e].info.streaming=!1}},{key:"getDevice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"freeeeg32_2",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=void 0;return this.devices.find((function(r,i){return r.info.deviceName.indexOf(e)>-1&&r.info.deviceNum===t||r.info.deviceType.indexOf(e)>-1&&r.info.deviceNum===t?(n=r,!0):void 0})),n}},{key:"addAnalysisMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.data.device0.deviceName,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.getDevice(t,n),i=r.info.analysis.find((function(t,n){if(t===e)return!0}));i||r.info.analysis.push(e),r.atlas.settings.analyzing||(r.atlas.settings.analyzing=!0,r.atlas.analyzer())}},{key:"stopAnalysis",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.devices.length>0?""!==t&&"string"==typeof t?this.atlas.settings.analysis.find((function(n,r){if(t===n)return e.atlas.settings.analysis.splice(r,1),!0})):this.atlas.settings.analyzing=!1:console.error("no devices connected")}},{key:"getStreamData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={};for(var r in this.state.data)null===t?r.indexOf(e)>-1&&(n[r]=this.state.data[r]):r.indexOf(e)>-1&&r.indexOf(t)>-1&&(n[r]=this.state.data[r]);return n}},{key:"addAnalyzerFunc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.devices.forEach((function(n,r){null!==n.atlas&&null!==e&&(n.atlas.analyzerOpts.indexOf(e)<0?(n.atlas.analyzerOpts.push(e),n.atlas.analyzerFuncs.push(t)):console.error("property "+e+" exists"))}))}},{key:"streamAppData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.info.nDevices>0){var r=Object.assign(Xr({},t+"newData",!0),n);this.state.addToState(t,r,(function(n){e.state.data[t][t+"newData"]||(e.state.data[t][t+"newData"]=!0)}));var i=function(){return!0===e.state.data[t][t+"newData"]?(e.state.data[t][t+"newData"]=!1,e.state.data[key]):void 0};this.addStreamFunc(t,i),this.addStreamParam([t])}}},{key:"addStreamFunc",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;"string"==typeof e&&"function"==typeof t&&void 0!==this.devices[n]?this.devices[n].addStreamFunc(e,t):console.error("addStreamFunc error")}},{key:"addStreamParam",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.forEach((function(t,n){Array.isArray(t)&&e.devices.find((function(e){if(t[0].indexOf(e.info.deviceType)>-1)return"eeg"===e.info.deviceType?e.atlas.data.eegshared.eegChannelTags.find((function(n){if(n.tag===t[1]||n.ch===t[1])return e.info.streamParams.push(t),!0})):e.info.streamParams.push(t),!0}))}))}},{key:"login",value:(r=qr(regeneratorRuntime.mark((function e(){var t,n,r=this,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]&&i[0],n=i.length>1&&void 0!==i[1]?i[1]:this.info.auth,i.length>2&&void 0!==i[2]?i[2]:this.info.auth.url.toString(),null!=this.socket&&1===this.socket.readyState||(this.socket=this.setupWebSocket(n),this.info.auth.authenticated=!0,this.subscribed=!0),null!==this.socket&&1===this.socket.readyState&&!0===t&&this.devices.length>0&&this.devices.forEach((function(e,t){r.beginStream(t)}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"signup",value:(n=qr(regeneratorRuntime.mark((function e(){var t,n,r,i,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:this.info.auth.url.toString(),n=this.checkURL(n),r=JSON.stringify(t),e.next=6,fetch(n.toString()+"signup",{method:"POST",mode:"cors",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:r}).then((function(e){return e.json().then((function(e){return e}))})).then((function(e){return console.log("\n"+e),e})).catch((function(e){console.error("\n"+e.message)}));case 6:return i=e.sent,e.abrupt("return",i);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"request",value:(t=qr(regeneratorRuntime.mark((function e(t){var n,r,i,s,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:"POST",r=a.length>2&&void 0!==a[2]?a[2]:"",i=a.length>3&&void 0!==a[3]?a[3]:this.info.auth.url.toString(),""===r){e.next=13;break}return i=this.checkURL(i),r=this.checkPathname(r),s={method:n,mode:"cors",headers:{Accept:"application/json","Content-Type":"application/json"}},"POST"===n&&(s.body=JSON.stringify(t)),e.next=10,fetch(i+r,s).then((function(e){return e.json().then((function(e){return e.message}))})).catch((function(e){console.error("\n"+e.message)}));case 10:return e.abrupt("return",e.sent);case 13:return console.error("You must provide a valid pathname to request resources from "+i),e.abrupt("return");case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"processSocketMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=JSON.parse(t);if(n.msg)if("userData"===n.msg)for(var r in n.userData)this.state.data[n.username+"_userData"][r]=n.userData[r];else"gameData"===n.msg?(null==this.state.data.multiplayer[n.id]&&(this.state.data.multiplayer[n.id]={userData:{}}),this.state.data.multiplayer[n.id].userData?n.userData.forEach((function(t,r){var i=e.state.data.multiplayer[n.id].userData[t.username];if(null!=i){var s=function(e){null==i.latest[e]&&(i.latest[e]=null),i.latest[e]=t[e],t[e].constructor==Object&&Object.keys(t[e]).forEach((function(n){null==i.history[e]?i.history[e]=t[e]:i.history[e][n].push(t[e][n])}))};for(var a in t)s(a)}else e.state.data.multiplayer[n.id].userData[t.username]={latest:{},history:t}})):this.state.data.multiplayer[n.id].userData={},this.state.data.multiplayer[n.id].spectators=n.spectators,this.state.data.multiplayer[n.id].usernames=n.usernames,this.state.data.multiplayer[n.id].t=Date.now()):"getUserDataResult"===n.msg||"getUsersResult"===n.msg||"getGameDataResult"===n.msg||"getGameInfoResult"===n.msg||"getGamesResult"===n.msg?this.state.data.commandResult=n:"gameCreated"===n.msg?(this.state.data.commandResult=n,this.info.auth.appname=n.gameInfo.id):"subscribedToUser"===n.msg||"userNotFound"===n.msg||"subscribedToGame"===n.msg||"leftGame"===n.msg||"gameDeleted"===n.msg||"unsubscribed"===n.msg||"gameNotFound"===n.msg?this.state.data.commandResult=n:"resetUsername"===n.msg?this.info.auth.username=n.username:"ping"===n.msg||console.log(n);else console.log(t)}},{key:"setupWebSocket",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.info.auth,n=null,r=["username&"+t.username,"password&"+t.password,"appname&"+t.appname];if("http:"===location.protocol)n=new WebSocket("ws://"+t.url.host,r);else{if("https:"!==location.protocol)return void console.log("invalid protocol");n=new WebSocket("wss://"+t.url.host,r)}return n.onerror=function(){console.log("error")},n.onopen=function(){console.log("socket opened")},n.onmessage=function(t){e.processSocketMessage(t.data)},n.onclose=function(e){console.log("close")},n}},{key:"subscribeToUser",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.info.auth.username,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){};if(null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({username:this.info.auth.username,cmd:["getUserData",t]})),n.forEach((function(n){var r=n;Array.isArray(r)&&(r=n.join("_")),e.state.data[t+"_"+r]=null}));var s=this.state.subscribe("commandResult",(function(a){"object"===Wr(a)&&("getUserDataResult"===a.msg?(a.username===t&&e.socket.send(JSON.stringify({username:e.info.auth.username,cmd:["subscribeToUser",r,t,n]})),i(a),e.state.unsubscribe("commandResult",s)):"userNotFound"===a.msg&&a.username===t&&(e.state.unsubscribe("commandResult",s),console.log("User not found: ",t)))}))}}},{key:"unsubscribeFromUser",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.info.auth.username,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){};if(null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({cmd:["unsubscribeFromUser",r,t,n],username:this.info.auth.username}));var s=this.state.subscribe("commandResult",(function(n){if("unsubscribed"===n.msg&&n.username===t){for(var r in e.state.data)r.indexOf(t)>-1&&(e.state.unsubscribeAll(r),e.state.data[r]=void 0);i(n),e.state.unsubscribe("commandResult",s)}}))}}},{key:"getGames",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.info.auth.appname,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){};if(null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({username:this.info.auth.username,cmd:["getGames",t]}));var r=this.state.subscribe("commandResult",(function(i){"object"===Wr(i)?"getGamesResult"===i.msg&&i.appname===t&&(console.log(i.gameInfo),n(i),e.state.unsubscribe("commandResult",r)):"gameNotFound"===i.msg&i.appname===t&&(e.state.unsubscribe("commandResult",r),console.log("Game not found: ",t))}))}}},{key:"subscribeToGame",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.info.auth.appname,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.info.auth.username,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){};if(console.log(this.info.auth.username),null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({username:this.info.auth.username,cmd:["getGameInfo",t]}));var s=this.state.subscribe("commandResult",(function(a){if("object"===Wr(a))if("getGameInfoResult"===a.msg&&a.gameInfo.id===t){var o=!0;if(!1===n){var u=[];a.gameInfo.propnames.forEach((function(e){u.push(e.split("_"))})),o=e.configureStreamForGame(a.gameInfo.devices,u)}if(!0===o){e.socket.send(JSON.stringify({username:e.info.auth.username,cmd:["subscribeToGame",r,t,n]}));var c={};a.gameInfo.usernames.forEach((function(e){c[e]={latest:{},history:{}},a.gameInfo.propnames.forEach((function(t){c[e].latest[t]=null,c[e].history[t]=null}))})),e.state.data.multiplayer=Xr({},a.gameInfo.id,{usernames:[],spectators:[],userData:c}),i(a)}e.state.unsubscribe("commandResult",s)}else"gameNotFound"===a.msg&a.appname===t&&(e.state.unsubscribe("commandResult",s),console.log("Game not found: ",t))}))}}},{key:"unsubscribeFromGame",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){};if(null!==this.socket&&1===this.socket.readyState){this.socket.send(JSON.stringify({cmd:["leaveGame",t],username:this.info.auth.username}));var r=this.state.subscribe("commandResult",(function(i){if("leftGame"===i.msg&&i.appname===t){for(var s in e.state.data)s.indexOf(t)>-1&&(e.state.unsubscribeAll(s),e.state.data[s]=void 0);n(i),e.state.unsubscribe("commandResult",r)}}))}}},{key:"configureStreamForGame",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=[];n.forEach((function(e,t){void 0===e[2]?r.push([e[0],e[1],"all"]):r.push(Kr(e))}));var i=!1;return t.forEach((function(t,n){e.devices.find((function(n,s){if(n.info.deviceType===t){null===n.socket&&(n.socket=e.socket);var a=[];if(r.forEach((function(e){e[0].indexOf(n.info.deviceType)>-1&&("eeg"===n.info.deviceType?n.atlas.data.eegshared.eegChannelTags.find((function(t){if(t.tag===e[1]||t.ch===e[1])return a.push(e),!0})):a.push(e))})),a.length>0)return n.info.streamParams=a,!1===n.info.streaming&&(n.info.streaming=!0,n.streamLoop()),i=!0,!0}}))})),!!i||(console.error("Compatible device not found"),!1)}},{key:"sendWSCommand",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null!=this.socket&&1===this.socket.readyState){var n={cmd:e,username:this.info.auth.username};Object.assign(n,t);var r=JSON.stringify(n);console.log("Message sent: ",r),this.socket.send(r)}}},{key:"closeSocket",value:function(){this.socket.close()}},{key:"onconnectionLost",value:function(e){var t=!1;this.info.connections.find((function(n,r){if(n.username===e.username)return t=!0,!0})),!0===t&&(this.info.connections.splice(0,1),this.info.nDevices--)}},{key:"checkURL",value:function(e){return"/"!==e.slice(-1)&&(e+="/"),e}},{key:"checkPathname",value:function(e){return"/"===e.slice(0)&&e.splice(0,1),e}}]),e}(),ei=function(){var e=this;this.onconnected=function(){},this.ondisconnected=function(){},this.getDeviceData=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eeg",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e.devices.forEach((function(e,i){if(console.log("get"),e.info.deviceType.indexOf(t)>-1&&e.info.deviceNum===r)return"all"===n?e.atlas.data[t]:e.atlas.getDeviceDataByTag(t,n)}))},this.subscribe=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eeg",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FP1",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){},s=void 0,a=n,o=null;return t.indexOf("eeg")>-1||t.indexOf("muse")>-1||t.indexOf("notion")>-1?(o="eeg","shared"===a&&(a="eeghared")):t.indexOf("heg")>-1&&(o="heg","shared"===a&&(a="hegshared")),null!==o&&e.devices.find((function(n,u){if(n.info.deviceName.indexOf(t)>-1&&!0===n.info.useAtlas){var c=void 0;return"string"==typeof a?a.indexOf("shared")>-1&&(c=n.atlas.getDeviceDataByTag(a,null)):c=null===a||"all"===a?n.atlas.data[o]:n.atlas.getDeviceDataByTag(o,a),void 0!==c&&(null===r||Array.isArray(c)||"object"!==Wr(c[r])?s=e.state.addToState(a,c,i):"object"===Wr(c[r])&&(s=e.state.addToState(a+"_"+r,c[r],i))),!0}})),s},this.unsubscribe=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FP1",n=arguments.length>1?arguments[1]:void 0;e.state.unsubscribe(t,n)},this.unsubscribeAll=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FP1";e.state.unsubscribeAll(t)},this.makeGameBrowser=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){},s=Math.floor(1e6*Math.random())+t,a="<div id='"+s+"'><button id='"+s+"search'>Search</button><table id='"+s+"browser'></table></div>";("string"==typeof n||n instanceof String)&&(n=document.getElementById(n)),n.insertAdjacentHTML("beforeend",a),document.getElementById(s+"search").onclick=function(){e.getGames(t,(function(t){var n="";t.gameInfo.forEach((function(e){n+="<tr><td>"+e.id+"</td><td>"+e.usernames.length+"</td><td><button id='"+e.id+"connect'>Connect</button>Spectate:<input id='"+s+"spectate' type='checkbox'></td></tr>"})),document.getElementById(s+"browser").insertAdjacentHTML("afterbegin",n),t.gameInfo.forEach((function(t){document.getElementById(t.id+"connect").onclick=function(){e.subscribeToGame(t.id,document.getElementById(s+"spectate").checked,void 0,(function(n){r(t),document.getElementById(s).insertAdjacentHTML("afterbegin","<button id='"+s+"disconnect'>Disconnect</button>"),document.getElementById(s+"disconnect").onclick=function(){e.unsubscribeFromGame(t.id,(function(){i(t);var e=document.getElementById(s+"disconnect");e.parentNode.removeChild(e)}))}}))}}))}))}},this.kickPlayerFromGame=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){};if(null!==e.socket&&1===e.socket.readyState){e.socket.send({cmd:["leaveGame",t,n],username:e.info.auth.username});var i=e.state.subscribe("commandResult",(function(s){if("leftGame"===s.msg&&s.appname===t){for(var a in e.state.data)a.indexOf(n)>-1&&(e.state.unsubscribeAll(a),e.state.data[a]=void 0);r(s),e.state.unsubscribe("commandResult",i)}}))}}},ti=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"freeeeg32_2",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["eegfft"],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{username:"guest"};Zr(this,e),ni.call(this),this.info={deviceName:t,deviceType:null,streaming:s,streamParams:o,analysis:n,deviceNum:0,streamLoopTiming:100,streamCt:0,auth:u,sps:null,useFilters:r,useAtlas:!1,simulating:!1},this.device=null,this.deviceConfigs=[{name:"freeeeg32",cls:Ie},{name:"muse",cls:Re},{name:"hegduino",cls:Qe},{name:"cyton",cls:dt},{name:"webgazer",cls:vt},{name:"ganglion",cls:Ur}],this.socket=a,this.streamTable=[],this.filters=[],this.atlas=null,this.pipeToAtlas=i}return Qr(e,[{key:"onconnect",value:function(){}},{key:"ondisconnect",value:function(){}},{key:"configureDefaultStreamTable",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=n;if(!0!==t.info.useAtlas);else{var i=!1;if(void 0!==(i="number"==typeof e?t.atlas.getEEGDataByChannel(e):t.atlas.getEEGDataByTag(e))){if("all"===r){if(0===i.count)return;if(r=i.count-i.lastRead,i.lastRead=i.count,0===r)return}if(i.filtered.length>0){var s=i.times.slice(i.times.length-r,i.times.length),a=i.filtered.slice(i.filtered.length-r,i.filtered.length);return{times:s,samples:a}}if(i.raw.length>0){var o=i.times.slice(i.times.length-r,i.times.length),u=i.raw.slice(i.raw.length-r,i.raw.length);return{times:o,samples:u}}return}}},i=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=n;if(!0!==t.info.useAtlas);else{var i=!1;if(void 0!==(i="number"==typeof e?t.atlas.getEEGFFTData(e):t.atlas.getEEGDataByTag(e))){if("all"===r){if(0===i.fftCount)return;if(r=i.fftCount-i.lastReadFFT,i.lastReadFFT=i.fftCount,0===r)return}var s=i.fftTimes.slice(i.fftTimes.length-r,i.fftTimes.length),a=i.ffts.slice(i.ffts.length-r,i.ffts.length);return{times:s,ffts:a}}}},s=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=n;if(!0!==t.info.useAtlas);else{console.log(e);var i=t.atlas.getCoherenceByTag(e);if(void 0!==i){if("all"===r){if(0===i.fftCount)return;if(r=i.fftCount-i.lastRead,i.lastRead=i.fftCount,0===r)return}var s=i.times.slice(i.fftTimes.length-r,i.fftTimes.length),a=i.ffts.slice(i.ffts.length-r,i.ffts.length);return{times:s,ffts:a}}}},a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=n;if(!0!==t.info.useAtlas);else{var s=t.atlas.getDeviceDataByTag("heg",e);if("all"===i&&(i=s.count-s.lastRead,s.lastRead=s.count,i<=0))return;if(void 0!==s){if(void 0!==r){var a=s.times.slice(s.times.length-i,s.times.length),o=s[r].slice(s.ffts.length-i,s.ffts.length),u={times:a};return u[r]=o,u}return s}}};this.streamTable=[{prop:"eegch",callback:r},{prop:"eegfft",callback:i},{prop:"eegcoherence",callback:s},{prop:"hegdata",callback:a}],n.length>0&&(e=this.streamTable).push.apply(e,Kr(n))}},{key:"addStreamFunc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.streamTable.push({prop:e,callback:t})}},{key:"configureStreamParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[["prop","tag"]],t=[];e.forEach((function(e,n){t.push(e.join("_"))})),this.socket.send(JSON.stringify({cmd:["addProps",t],username:this.info.auth.username}))}},{key:"simulateData",value:function(){var e=this;if(!0===this.info.simulating){for(var t=Math.floor(100*this.info.sps/1e3),n=0;n<t;n++);"undefined"==typeof window?setTimeout((function(){e.simulateData}),100):setTimeout(requestAnimationFrame(this.simulateData),100)}}}]),e}(),ni=function(){var e=this;this.init=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.info,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.pipeToAtlas;e.deviceConfigs.find((function(r,i){if(t.deviceName.indexOf(r.name)>-1)return e.device=new r.cls(t.deviceName,e.onconnect,e.ondisconnect),e.device.init(t,n),e.atlas=e.device.atlas,e.filters=e.device.filters,null!==e.atlas&&(e.pipeToAtlas=!0,e.configureDefaultStreamTable(),!0===e.info.streaming&&e.streamLoop()),!0}))},this.connect=function(){e.device.connect()},this.disconnect=function(){e.device.disconnect()},this.sendDataToSocket=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[["prop","tag","arg1"]],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={username:e.info.auth.username,userData:{}};Object.assign(r.userData,n),t.forEach((function(t,n){e.streamTable.find((function(e,n){if(t[0].indexOf(e.prop)>-1){var i=t.slice(1),s=e.callback.apply(e,Kr(i));return void 0!==s&&(r.userData[t.join("_")]=s),!0}}))})),Object.keys(r.userData).length>0&&e.socket.send(JSON.stringify(r))},this.streamLoop=function(){if(!0===e.info.streaming){var t=[];if(0===e.info.streamParams.length)return console.error("No stream parameters set"),!1;e.info.streamParams.forEach((function(n,r){e.streamTable.find((function(e,r){if(e.prop===n[0])return t.push(n),!0}))})),t.length>0&&e.sendDataToSocket(t),e.info.streamCt++,setTimeout((function(){e.streamLoop()}),e.info.streamLoopTiming)}else e.info.streamCt=0}},ri="data:text/javascript;base64,"+btoa((function(e){console.time("worker");var t="function not defined";switch(e.data.foo){case"xcor":t=P.crosscorrelation(e.data.input[0],e.data.input[1]);break;case"autocor":t=P.autocorrelation(e.data.input);break;case"cov1d":t=P.cov1d(e.data.input[0],e.data.input[1]);break;case"cov2d":t=P.cov2d(e.data.input);break;case"sma":t=P.sma(e.data.input[0],e.data.input[1]);break;case"dft":var n=1;void 0!==e.data.input[2]&&(n=e.data.input[2]),t=R.gpuDFT(e.data.input[0],e.data.input[1],n);break;case"multidft":n=1,void 0!==e.data.input[2]&&(n=e.data.input[2]),t=R.MultiChannelDFT(e.data.input[0],e.data.input[1],n);break;case"multidftbandpass":n=1,void 0!==e.data.input[4]&&(n=e.data.input[4]),t=R.MultiChannelDFT_Bandpass(e.data.input[0],e.data.input[1],e.data.input[2],e.data.input[3],n);break;case"fft":n=1,void 0!==e.data.input[2]&&(n=e.data.input[2]),t=R.gpuFFT(e.data.input[0],e.data.input[1],n);break;case"multifft":n=1,void 0!==e.data.input[2]&&(n=e.data.input[2]),t=R.MultiChannelFFT(e.data.input[0],e.data.input[1],n);break;case"multifftbandpass":n=1,void 0!==e.data.input[4]&&(n=e.data.input[4]),t=R.MultiChannelFFT_Bandpass(e.data.input[0],e.data.input[1],e.data.input[2],e.data.input[3],n);break;case"gpucoh":t=R.gpuCoherence(e.data.input[0],e.data.input[1],e.data.input[2],e.data.input[3],e.data.input[4]);break;case"coherence":var r,i=P.correlograms(e.data.input[0]),s=[].concat(F(e.data.input[0]),F(i)),a=(n=1,(r=R.MultiChannelDFT_Bandpass(s,e.data.input[1],e.data.input[2],e.data.input[3],n))[1].splice(e.data.input[0].length,s.length-e.data.input[0].length)),o=[],u=e.data.input[0].length,c=0,l=0;a.forEach((function(e,t){if(l+c===u){var n=a.splice(t,1);c++,a.splice.apply(a,[c,0].concat(F(n))),l=0}l++}));var h=[];c=0,l=1,a.forEach((function(e,t){var n=new Array(e.length).fill(0);t<u?(e.forEach((function(e,t){n[t]=e})),h.push(n)):(e.forEach((function(e,t){n[t]=e*e/(h[c][t]*h[c+l][t]),n[t]>1&&(n[t]=1)})),++l+c===u&&(c++,l=1),o.push(n))})),t=[r[0],r[1],o]}console.timeEnd("worker"),postMessage({output:t,foo:e.data.foo,origin:e.data.origin})})),ii=[],si=[],ai=2,oi=0;try{si=[];for(var ui=0;ui<ai;ui++)si.push(new(i())(ri)),si[ui].onmessage=function(e){var t=e.data;ii.forEach((function(e,n){e(t)}))};console.log("worker threads: ",si.length)}catch(e){console.error(e)}var ci=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:workerURL;try{return si.push(new(i())(new URL(e,"file:///Users/garrettflynn/Documents/Github/eegpwatestground/src/library/brainsatplay.js"),{name:"eegworker_"+si.length,type:"module"})),si[ui].onmessage=function(e){var t=e.data;ii.forEach((function(e,n){e(t)}))},console.log("worker threads: ",si.length),si.length-1}catch(e){console.log(e)}},li=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t?(si[oi].postMessage(e),ai>1&&++oi>=ai&&(oi=0)):si[t].postMessage(e)}})(),r})()}));